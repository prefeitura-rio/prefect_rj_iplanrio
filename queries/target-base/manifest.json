{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/manifest/v11.json", "dbt_version": "1.7.3", "generated_at": "2024-09-30T15:20:48.865127Z", "invocation_id": "de8e99cd-4c70-4f63-8ed8-c02cb00d801a", "env": {}, "project_name": "rj_smtr", "project_id": "81a5df3524de8b2909a0203a698e6ed6", "user_id": "25b3fcf6-f078-44d5-a087-8ff45a33860b", "send_anonymous_usage_stats": true, "adapter_type": "bigquery"}, "nodes": {"model.rj_smtr.view_integracao": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_jae", "name": "view_integracao", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_jae/view_integracao.sql", "original_file_path": "models/dashboard_bilhetagem_jae/view_integracao.sql", "unique_id": "model.rj_smtr.view_integracao", "fqn": ["rj_smtr", "dashboard_bilhetagem_jae", "view_integracao"], "alias": "view_integracao", "checksum": {"name": "sha256", "checksum": "402966e575a3288317c04a144b181d2fea3785a2ec9b2e45147ffd1deaf50120"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela de integra\u00e7\u00f5es realizadas entre modos do sistema de transporte municipal, contendo os valores da reparti\u00e7\u00e3o tarif\u00e1ria (quando houver). [Dados em fase de teste]", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao": {"name": "id_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perna_origem": {"name": "perna_origem", "description": "N\u00famero da sequ\u00eancia da transa\u00e7\u00e3o atual dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_origem": {"name": "modo_origem", "description": "Tipo de transporte (\u00d4nibus, Van, BRT) da transa\u00e7\u00e3o atual da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_origem_perna": {"name": "modo_origem_perna", "description": "Concatena\u00e7\u00e3o da colunas modo_origem e perna_origem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio_origem": {"name": "consorcio_origem", "description": "Nome do cons\u00f3rcio da transa\u00e7\u00e3o atual da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_origem": {"name": "descricao_servico_origem", "description": "Descri\u00e7\u00e3o do servi\u00e7o da transa\u00e7\u00e3o atual da integra\u00e7\u00e3o (vindo da tabela cadastro.servicos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_origem_perna": {"name": "descricao_servico_origem_perna", "description": "Concatena\u00e7\u00e3o da colunas descricao_servico_origem e perna_origem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perna_destino": {"name": "perna_destino", "description": "N\u00famero da sequ\u00eancia da pr\u00f3xima transa\u00e7\u00e3o dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_destino": {"name": "modo_destino", "description": "Tipo de transporte (\u00d4nibus, Van, BRT) da pr\u00f3xima transa\u00e7\u00e3o da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_destino_perna": {"name": "modo_destino_perna", "description": "Concatena\u00e7\u00e3o da colunas modo_destino e perna_destino", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio_destino": {"name": "consorcio_destino", "description": "Nome do cons\u00f3rcio da pr\u00f3xima transa\u00e7\u00e3o da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_destino": {"name": "descricao_servico_destino", "description": "Descri\u00e7\u00e3o do servi\u00e7o da pr\u00f3xima transa\u00e7\u00e3o da integra\u00e7\u00e3o (vindo da tabela cadastro.servicos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_destino_perna": {"name": "descricao_servico_destino_perna", "description": "Concatena\u00e7\u00e3o da colunas descricao_servico_destino e perna_destino", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_integracao_minutos": {"name": "tempo_integracao_minutos", "description": "Tempo em minutos entre a trasa\u00e7\u00e3o atual e a pr\u00f3xima transa\u00e7\u00e3o da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_bilhetagem_jae"}, "created_at": 1727709587.5893867, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_jae`.`view_integracao`", "raw_code": "WITH servicos AS (\n    SELECT\n        * EXCEPT(rn)\n    FROM\n        (\n            SELECT\n                *,\n                ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n            FROM\n                {{ ref(\"servicos\") }}\n        )\n    WHERE\n        rn = 1\n),\ndados_filtrados AS (\n    SELECT\n        i.data,\n        i.hora,\n        i.id_integracao,\n        i.sequencia_integracao,\n        i.modo,\n        s.descricao_servico,\n        i.consorcio,\n        i.datetime_transacao\n    FROM\n        {{ ref(\"integracao\") }} i\n    LEFT JOIN\n        servicos s\n    USING(id_servico_jae)\n    WHERE\n        data >= \"2024-02-24\"\n        AND servico NOT IN (\"888888\", \"999999\")\n        AND id_operadora != \"2\"\n)\nSELECT\n    a.data,\n    a.hora,\n    a.id_integracao,\n    a.sequencia_integracao AS perna_origem,\n    a.modo AS modo_origem,\n    CONCAT(a.modo, '(', a.sequencia_integracao, ')') AS modo_origem_perna,\n    a.consorcio AS consorcio_origem,\n    a.descricao_servico AS descricao_servico_origem,\n    CONCAT(a.descricao_servico, '(', a.sequencia_integracao, ')') AS descricao_servico_origem_perna,\n    b.sequencia_integracao AS perna_destino,\n    b.modo AS modo_destino,\n    CONCAT(b.modo, '(', b.sequencia_integracao, ')') AS modo_destino_perna,\n    b.consorcio AS consorcio_destino,\n    b.descricao_servico AS descricao_servico_destino,\n    CONCAT(b.descricao_servico, '(', b.sequencia_integracao, ')') AS descricao_servico_destino_perna,\n    TIMESTAMP_DIFF(b.datetime_transacao, a.datetime_transacao, MINUTE) AS tempo_integracao_minutos\nFROM\n    dados_filtrados a\nJOIN\n    dados_filtrados b\nON\n    a.id_integracao = b.id_integracao\n    AND a.sequencia_integracao = b.sequencia_integracao - 1", "language": "sql", "refs": [{"name": "servicos", "package": null, "version": null}, {"name": "integracao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.servicos", "model.rj_smtr.integracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_jae/view_integracao.sql", "compiled": true, "compiled_code": "WITH servicos AS (\n    SELECT\n        * EXCEPT(rn)\n    FROM\n        (\n            SELECT\n                *,\n                ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n            FROM\n                `rj-smtr`.`cadastro`.`servicos`\n        )\n    WHERE\n        rn = 1\n),\ndados_filtrados AS (\n    SELECT\n        i.data,\n        i.hora,\n        i.id_integracao,\n        i.sequencia_integracao,\n        i.modo,\n        s.descricao_servico,\n        i.consorcio,\n        i.datetime_transacao\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`integracao` i\n    LEFT JOIN\n        servicos s\n    USING(id_servico_jae)\n    WHERE\n        data >= \"2024-02-24\"\n        AND servico NOT IN (\"888888\", \"999999\")\n        AND id_operadora != \"2\"\n)\nSELECT\n    a.data,\n    a.hora,\n    a.id_integracao,\n    a.sequencia_integracao AS perna_origem,\n    a.modo AS modo_origem,\n    CONCAT(a.modo, '(', a.sequencia_integracao, ')') AS modo_origem_perna,\n    a.consorcio AS consorcio_origem,\n    a.descricao_servico AS descricao_servico_origem,\n    CONCAT(a.descricao_servico, '(', a.sequencia_integracao, ')') AS descricao_servico_origem_perna,\n    b.sequencia_integracao AS perna_destino,\n    b.modo AS modo_destino,\n    CONCAT(b.modo, '(', b.sequencia_integracao, ')') AS modo_destino_perna,\n    b.consorcio AS consorcio_destino,\n    b.descricao_servico AS descricao_servico_destino,\n    CONCAT(b.descricao_servico, '(', b.sequencia_integracao, ')') AS descricao_servico_destino_perna,\n    TIMESTAMP_DIFF(b.datetime_transacao, a.datetime_transacao, MINUTE) AS tempo_integracao_minutos\nFROM\n    dados_filtrados a\nJOIN\n    dados_filtrados b\nON\n    a.id_integracao = b.id_integracao\n    AND a.sequencia_integracao = b.sequencia_integracao - 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.view_passageiros_tile_hora": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_jae", "name": "view_passageiros_tile_hora", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_jae/view_passageiros_tile_hora.sql", "original_file_path": "models/dashboard_bilhetagem_jae/view_passageiros_tile_hora.sql", "unique_id": "model.rj_smtr.view_passageiros_tile_hora", "fqn": ["rj_smtr", "dashboard_bilhetagem_jae", "view_passageiros_tile_hora"], "alias": "view_passageiros_tile_hora", "checksum": {"name": "sha256", "checksum": "119edff8be1a04f9f26e85cba0c4992860d88d5fd2aa09141c6b9b37dc5857b3"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View criada para uso no painel de bilhetagem. Junta os dados da tabela br_rj_riodejaneiro_bilhetagem.passageiros_tile_hora com a tabela cadastro.servicos", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome do servi\u00e7o na tabela cadastro.servicos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico": {"name": "descricao_servico", "description": "Descri\u00e7\u00e3o do servi\u00e7o na tabela cadastro.servicos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_completo_servico": {"name": "nome_completo_servico", "description": "Concatena\u00e7\u00e3o das colunas servico e descricao_servico, separadas por ' - '", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_smtr": {"name": "tipo_transacao_smtr", "description": "Tipo de transa\u00e7\u00e3o realizada no padr\u00e3o usado pela SMTR (Tarifa Cheia, Integra\u00e7\u00e3o e Gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_detalhe_smtr": {"name": "tipo_transacao_detalhe_smtr", "description": "Detalhamento sobre a transa\u00e7\u00e3o, de acordo com o tipo (Tarifa Cheia = tipo do pagamento, Gratuidade = tipo da gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tile_id": {"name": "tile_id", "description": "Identificador do hex\u00e1gono da geolocaliza\u00e7\u00e3o da transa\u00e7\u00e3o na tabela rj-smtr.br_rj_riodejaneiro_geo.h3_res9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiros": {"name": "quantidade_passageiros", "description": "Quantidade de transa\u00e7\u00f5es que aconteceram em determinada data e hora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_bilhetagem_jae"}, "created_at": 1727709587.5842876, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_jae`.`view_passageiros_tile_hora`", "raw_code": "WITH servicos AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n      FROM\n        {{ ref(\"servicos\") }}\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  p.data,\n  p.hora,\n  p.modo,\n  p.consorcio,\n  p.id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  CONCAT(s.servico, ' - ' ,s.descricao_servico) AS nome_completo_servico,\n  p.sentido,\n  CASE\n    WHEN p.tipo_transacao_smtr = \"Integral\" THEN \"Tarifa Integral\"\n    ELSE p.tipo_transacao_smtr\n  END AS tipo_transacao_smtr,\n  p.tipo_transacao_detalhe_smtr,\n  p.tile_id,\n  p.quantidade_passageiros\nFROM\n  {{ ref(\"passageiros_tile_hora\") }} p\nLEFT JOIN\n  servicos s\nUSING(id_servico_jae)", "language": "sql", "refs": [{"name": "servicos", "package": null, "version": null}, {"name": "passageiros_tile_hora", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.servicos", "model.rj_smtr.passageiros_tile_hora"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_jae/view_passageiros_tile_hora.sql", "compiled": true, "compiled_code": "WITH servicos AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n      FROM\n        `rj-smtr`.`cadastro`.`servicos`\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  p.data,\n  p.hora,\n  p.modo,\n  p.consorcio,\n  p.id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  CONCAT(s.servico, ' - ' ,s.descricao_servico) AS nome_completo_servico,\n  p.sentido,\n  CASE\n    WHEN p.tipo_transacao_smtr = \"Integral\" THEN \"Tarifa Integral\"\n    ELSE p.tipo_transacao_smtr\n  END AS tipo_transacao_smtr,\n  p.tipo_transacao_detalhe_smtr,\n  p.tile_id,\n  p.quantidade_passageiros\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`passageiros_tile_hora` p\nLEFT JOIN\n  servicos s\nUSING(id_servico_jae)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.view_passageiros_hora": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_jae", "name": "view_passageiros_hora", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_jae/view_passageiros_hora.sql", "original_file_path": "models/dashboard_bilhetagem_jae/view_passageiros_hora.sql", "unique_id": "model.rj_smtr.view_passageiros_hora", "fqn": ["rj_smtr", "dashboard_bilhetagem_jae", "view_passageiros_hora"], "alias": "view_passageiros_hora", "checksum": {"name": "sha256", "checksum": "ee1b2d555e0385df3bbeda89b8d98b5a9d6a5b4f5b93905af5797918cb62ea88"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View criada para uso no painel de bilhetagem. Junta os dados da tabela br_rj_riodejaneiro_bilhetagem.passageiros_hora (exceto os do tipo RioCard) com a tabela cadastro.servicos", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome do servi\u00e7o na tabela cadastro.servicos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico": {"name": "descricao_servico", "description": "Descri\u00e7\u00e3o do servi\u00e7o na tabela cadastro.servicos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_completo_servico": {"name": "nome_completo_servico", "description": "Concatena\u00e7\u00e3o das colunas servico e descricao_servico, separadas por ' - '", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude_servico": {"name": "latitude_servico", "description": "Latitude do stop no GTFS (apenas para modo BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude_servico": {"name": "longitude_servico", "description": "Longitude do stop no GTFS (apenas para modo BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_smtr": {"name": "tipo_transacao_smtr", "description": "Tipo de transa\u00e7\u00e3o realizada no padr\u00e3o usado pela SMTR (Tarifa Cheia, Integra\u00e7\u00e3o e Gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_detalhe_smtr": {"name": "tipo_transacao_detalhe_smtr", "description": "Detalhamento sobre a transa\u00e7\u00e3o, de acordo com o tipo (Tarifa Cheia = tipo do pagamento, Gratuidade = tipo da gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiros": {"name": "quantidade_passageiros", "description": "Quantidade de transa\u00e7\u00f5es que aconteceram em determinada data e hora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_bilhetagem_jae"}, "created_at": 1727709587.5827305, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_jae`.`view_passageiros_hora`", "raw_code": "-- depends_on: {{ ref('view_passageiros_tile_hora') }}\nWITH servicos AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n      FROM\n        {{ ref(\"servicos\") }}\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  p.data,\n  p.hora,\n  p.modo,\n  p.consorcio,\n  p.id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  CONCAT(s.servico, ' - ' ,s.descricao_servico) AS nome_completo_servico,\n  s.latitude AS latitude_servico,\n  s.longitude AS longitude_servico,\n  p.sentido,\n  CASE\n    WHEN p.tipo_transacao_smtr = \"Integral\" THEN \"Tarifa Integral\"\n    ELSE p.tipo_transacao_smtr\n  END AS tipo_transacao_smtr,\n  p.tipo_transacao_detalhe_smtr,\n  p.quantidade_passageiros\nFROM\n  {{ ref(\"passageiros_hora\") }} p\nLEFT JOIN\n  servicos s\nUSING(id_servico_jae)", "language": "sql", "refs": [{"name": "view_passageiros_tile_hora", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}, {"name": "passageiros_hora", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.view_passageiros_tile_hora", "model.rj_smtr.servicos", "model.rj_smtr.passageiros_hora"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_jae/view_passageiros_hora.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`dashboard_bilhetagem_jae`.`view_passageiros_tile_hora`\nWITH servicos AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY id_servico_jae ORDER BY data_inicio_vigencia) AS rn\n      FROM\n        `rj-smtr`.`cadastro`.`servicos`\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  p.data,\n  p.hora,\n  p.modo,\n  p.consorcio,\n  p.id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  CONCAT(s.servico, ' - ' ,s.descricao_servico) AS nome_completo_servico,\n  s.latitude AS latitude_servico,\n  s.longitude AS longitude_servico,\n  p.sentido,\n  CASE\n    WHEN p.tipo_transacao_smtr = \"Integral\" THEN \"Tarifa Integral\"\n    ELSE p.tipo_transacao_smtr\n  END AS tipo_transacao_smtr,\n  p.tipo_transacao_detalhe_smtr,\n  p.quantidade_passageiros\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`passageiros_hora` p\nLEFT JOIN\n  servicos s\nUSING(id_servico_jae)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_operadora_empresa": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_stu", "name": "staging_operadora_empresa", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_stu/staging_operadora_empresa.sql", "original_file_path": "models/br_rj_riodejaneiro_stu/staging_operadora_empresa.sql", "unique_id": "model.rj_smtr.staging_operadora_empresa", "fqn": ["rj_smtr", "br_rj_riodejaneiro_stu", "staging_operadora_empresa"], "alias": "operadora_empresa", "checksum": {"name": "sha256", "checksum": "c030943e7c768f10adc9ff6b2cf67507576ae00f8c95bf010de2067e23a23211"}, "config": {"enabled": true, "alias": "operadora_empresa", "schema": "br_rj_riodejaneiro_stu", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com tratamento b\u00e1sico das empresas operadoras.", "columns": {"data": {"name": "data", "description": "Data de captura", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perm_autor": {"name": "perm_autor", "description": "Permiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura pela SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cnpj": {"name": "cnpj", "description": "CNPJ da empresa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_registro": {"name": "data_registro", "description": "Data de registro da empresa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo": {"name": "processo", "description": "Processo de registro da empresa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "razao_social": {"name": "razao_social", "description": "Raz\u00e3o social da empresa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_modo": {"name": "id_modo", "description": "Identificador do modo de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_permissao": {"name": "tipo_permissao", "description": "Tipo de permiss\u00e3o da empresa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_stu/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_stu", "alias": "operadora_empresa"}, "created_at": 1727709588.7407756, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_stu`.`operadora_empresa`", "raw_code": "{{\n  config(\n    alias='operadora_empresa',\n  )\n}}\n\nWITH\n    operadora_empresa AS (\n        SELECT\n            data,\n            SAFE_CAST(Perm_Autor AS STRING) AS perm_autor,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CNPJ') AS STRING) AS cnpj,\n            DATE(PARSE_TIMESTAMP('%d/%m/%Y', SAFE_CAST(JSON_VALUE(content, '$.Data') AS STRING)), \"America/Sao_Paulo\") AS data_registro,\n            SAFE_CAST(JSON_VALUE(content, '$.Processo') AS STRING) AS processo,\n            SAFE_CAST(JSON_VALUE(content, '$.Razao_Social') AS STRING) AS razao_social,\n            SAFE_CAST(JSON_VALUE(content, '$.id_modo') AS STRING) AS id_modo,\n            SAFE_CAST(JSON_VALUE(content, '$.modo') AS STRING) AS modo,\n            SAFE_CAST(JSON_VALUE(content, '$.tipo_permissao') AS STRING) AS tipo_permissao\n        FROM\n            {{ source(\"br_rj_riodejaneiro_stu_staging\", \"operadora_empresa\") }}\n    ),\n    operadora_empresa_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY COALESCE(cnpj, perm_autor), modo ORDER BY timestamp_captura DESC, data_registro DESC) AS rn\n        FROM\n            operadora_empresa\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_empresa_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_stu_staging", "operadora_empresa"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_stu/staging_operadora_empresa.sql", "compiled": true, "compiled_code": "\n\nWITH\n    operadora_empresa AS (\n        SELECT\n            data,\n            SAFE_CAST(Perm_Autor AS STRING) AS perm_autor,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CNPJ') AS STRING) AS cnpj,\n            DATE(PARSE_TIMESTAMP('%d/%m/%Y', SAFE_CAST(JSON_VALUE(content, '$.Data') AS STRING)), \"America/Sao_Paulo\") AS data_registro,\n            SAFE_CAST(JSON_VALUE(content, '$.Processo') AS STRING) AS processo,\n            SAFE_CAST(JSON_VALUE(content, '$.Razao_Social') AS STRING) AS razao_social,\n            SAFE_CAST(JSON_VALUE(content, '$.id_modo') AS STRING) AS id_modo,\n            SAFE_CAST(JSON_VALUE(content, '$.modo') AS STRING) AS modo,\n            SAFE_CAST(JSON_VALUE(content, '$.tipo_permissao') AS STRING) AS tipo_permissao\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_stu_staging`.`operadora_empresa`\n    ),\n    operadora_empresa_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY COALESCE(cnpj, perm_autor), modo ORDER BY timestamp_captura DESC, data_registro DESC) AS rn\n        FROM\n            operadora_empresa\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_empresa_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_operadora_pessoa_fisica": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_stu", "name": "staging_operadora_pessoa_fisica", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_stu/staging_operadora_pessoa_fisica.sql", "original_file_path": "models/br_rj_riodejaneiro_stu/staging_operadora_pessoa_fisica.sql", "unique_id": "model.rj_smtr.staging_operadora_pessoa_fisica", "fqn": ["rj_smtr", "br_rj_riodejaneiro_stu", "staging_operadora_pessoa_fisica"], "alias": "operadora_pessoa_fisica", "checksum": {"name": "sha256", "checksum": "da74500c5bd825156358ba647ba09f6a22e3786896b2040bd76b92b36be1c652"}, "config": {"enabled": true, "alias": "operadora_pessoa_fisica", "schema": "br_rj_riodejaneiro_stu", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com tratamento b\u00e1sico dos operadores pessoa f\u00edsica.", "columns": {"data": {"name": "data", "description": "Data de captura", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perm_autor": {"name": "perm_autor", "description": "Permiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura pela SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cpf": {"name": "cpf", "description": "CPF do operador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_registro": {"name": "data_registro", "description": "Data de registro do operador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ratr": {"name": "ratr", "description": "Registro de auxiliar de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo": {"name": "processo", "description": "Processo de registro do operador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome": {"name": "nome", "description": "Nome do operador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_modo": {"name": "id_modo", "description": "Identificador do modo de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_permissao": {"name": "tipo_permissao", "description": "Tipo de permiss\u00e3o do operador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_stu/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_stu", "alias": "operadora_pessoa_fisica"}, "created_at": 1727709588.7426739, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_stu`.`operadora_pessoa_fisica`", "raw_code": "{{\n  config(\n    alias='operadora_pessoa_fisica',\n  )\n}}\n\nWITH\n    operadora_pessoa_fisica AS (\n        SELECT\n            data,\n            SAFE_CAST(Perm_Autor AS STRING) AS perm_autor,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CPF') AS STRING) AS cpf,\n            PARSE_DATE('%d/%m/%Y', LEFT(SAFE_CAST(JSON_VALUE(content, '$.Data') AS STRING), 10)) AS data_registro,\n            SAFE_CAST(JSON_VALUE(content, '$.Ratr') AS STRING) AS ratr,\n            SAFE_CAST(JSON_VALUE(content, '$.Processo') AS STRING) AS processo,\n            SAFE_CAST(JSON_VALUE(content, '$.Nome') AS STRING) AS nome,\n            SAFE_CAST(JSON_VALUE(content, '$.Placa') AS STRING) AS placa,\n            SAFE_CAST(JSON_VALUE(content, '$.id_modo') AS STRING) AS id_modo,\n            SAFE_CAST(JSON_VALUE(content, '$.modo') AS STRING) AS modo,\n            SAFE_CAST(JSON_VALUE(content, '$.tipo_permissao') AS STRING) AS tipo_permissao\n        FROM\n            {{ source(\"br_rj_riodejaneiro_stu_staging\", \"operadora_pessoa_fisica\") }}\n    ),\n    operadora_pessoa_fisica_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY COALESCE(cpf, perm_autor), modo ORDER BY timestamp_captura DESC, data_registro DESC) AS rn\n        FROM\n            operadora_pessoa_fisica\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_pessoa_fisica_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_stu_staging", "operadora_pessoa_fisica"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_stu/staging_operadora_pessoa_fisica.sql", "compiled": true, "compiled_code": "\n\nWITH\n    operadora_pessoa_fisica AS (\n        SELECT\n            data,\n            SAFE_CAST(Perm_Autor AS STRING) AS perm_autor,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CPF') AS STRING) AS cpf,\n            PARSE_DATE('%d/%m/%Y', LEFT(SAFE_CAST(JSON_VALUE(content, '$.Data') AS STRING), 10)) AS data_registro,\n            SAFE_CAST(JSON_VALUE(content, '$.Ratr') AS STRING) AS ratr,\n            SAFE_CAST(JSON_VALUE(content, '$.Processo') AS STRING) AS processo,\n            SAFE_CAST(JSON_VALUE(content, '$.Nome') AS STRING) AS nome,\n            SAFE_CAST(JSON_VALUE(content, '$.Placa') AS STRING) AS placa,\n            SAFE_CAST(JSON_VALUE(content, '$.id_modo') AS STRING) AS id_modo,\n            SAFE_CAST(JSON_VALUE(content, '$.modo') AS STRING) AS modo,\n            SAFE_CAST(JSON_VALUE(content, '$.tipo_permissao') AS STRING) AS tipo_permissao\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_stu_staging`.`operadora_pessoa_fisica`\n    ),\n    operadora_pessoa_fisica_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY COALESCE(cpf, perm_autor), modo ORDER BY timestamp_captura DESC, data_registro DESC) AS rn\n        FROM\n            operadora_pessoa_fisica\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_pessoa_fisica_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.veiculo_indicadores_dia": {"database": "rj-smtr", "schema": "dashboard_controle_vinculo_jae_riocard", "name": "veiculo_indicadores_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_controle_vinculo_jae_riocard/veiculo_indicadores_dia.sql", "original_file_path": "models/dashboard_controle_vinculo_jae_riocard/veiculo_indicadores_dia.sql", "unique_id": "model.rj_smtr.veiculo_indicadores_dia", "fqn": ["rj_smtr", "dashboard_controle_vinculo_jae_riocard", "veiculo_indicadores_dia"], "alias": "veiculo_indicadores_dia", "checksum": {"name": "sha256", "checksum": "7ae05acb3278c75f2e5ecdf3c6b6cb83e2daf23c896269bb0927bcbed70112c8"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_controle_vinculo_jae_riocard", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela de indicadores para acompanhar o v\u00ednculo do validador da Ja\u00e9 com o validador da RioCard em cada ve\u00edculo", "columns": {"data": {"name": "data", "description": "data", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "empresa": {"name": "empresa", "description": "Nome da empresa operadora de \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "numero_serie_validador": {"name": "numero_serie_validador", "description": "N\u00famero de s\u00e9rio do validador da Ja\u00e9 instalado no ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_veiculo_licenciamento": {"name": "indicador_veiculo_licenciamento", "description": "Indica se o ve\u00edculo est\u00e1 licenciado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_veiculo_gps_sppo": {"name": "indicador_veiculo_gps_sppo", "description": "Indica se o ve\u00edculo emitiu sinal de GPS no dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_veiculo_controle_ronald": {"name": "indicador_veiculo_controle_ronald", "description": "Indica se o ve\u00edculo est\u00e1 listado na planilha de controle de instala\u00e7\u00e3o de validadores da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_validador_ativo": {"name": "indicador_validador_ativo", "description": "Indica se o validador foi ligado no dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_riocard": {"name": "quantidade_transacao_riocard", "description": "Quantidade de transa\u00e7\u00f5es do RioCard capturadas pelo validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_gps_sppo": {"name": "quantidade_gps_sppo", "description": "Quantidade de sinais de GPS enviados pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_gps_validador": {"name": "quantidade_gps_validador", "description": "Quantidade de sinais de GPS enviados pelo validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_gps_validador_sppo": {"name": "percentual_gps_validador_sppo", "description": "Percentual de sinais de GPS do validador em rela\u00e7\u00e3o ao do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_controle_vinculo_jae_riocard/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_controle_vinculo_jae_riocard", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709587.593603, "relation_name": "`rj-smtr`.`dashboard_controle_vinculo_jae_riocard`.`veiculo_indicadores_dia`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH gps_sppo AS (\n  SELECT\n    data,\n    SUBSTR(id_veiculo, 2) AS id_veiculo,\n    COUNT(DISTINCT timestamp_gps) AS quantidade_gps_sppo\n  FROM\n    {{ ref(\"gps_sppo\") }}\n  WHERE\n    DATA = DATE_SUB(DATE('{{ var(\"run_date\") }}'), INTERVAL 1 DAY)\n  GROUP BY\n    1,\n    2\n),\nplanilha_ronald AS (\n  SELECT DISTINCT\n    TRIM(numero_ordem_veiculo) AS numero_ordem_veiculo,\n    TRIM(numero_serie_validador) AS id_validador,\n    empresa\n  FROM\n    {{ source(\"dashboard_controle_vinculo_jae_riocard_staging\", \"relatorio_instalacao_jae\") }}\n  WHERE\n    LENGTH(numero_ordem_veiculo) = 5\n    AND numero_ordem_veiculo != '99999'\n),\ngps_sppo_planilha AS (\n  SELECT\n    COALESCE(g.data, DATE_SUB(DATE('{{ var(\"run_date\") }}'), INTERVAL 1 DAY)) AS data,\n    COALESCE(g.id_veiculo, TRIM(r.numero_ordem_veiculo)) AS id_veiculo,\n    COALESCE(g.quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n    TRIM(r.id_validador) AS id_validador,\n    r.empresa,\n    g.id_veiculo IS NOT NULL AS indicador_veiculo_gps_sppo,\n    r.numero_ordem_veiculo IS NOT NULL AS indicador_veiculo_controle_ronald\n  FROM\n    gps_sppo g\n  FULL OUTER JOIN\n    planilha_ronald r\n  ON\n    g.id_veiculo = TRIM(r.numero_ordem_veiculo)\n),\nsppo_licenciamento AS (\n  SELECT DISTINCT\n    SUBSTR(id_veiculo, 2) AS id_veiculo\n  FROM\n    {{ ref(\"sppo_licenciamento\") }}\n  WHERE\n    data = \"2024-03-25\"\n),\ngps_sppo_licenciamento AS (\n  SELECT\n    COALESCE(g.data, DATE_SUB(DATE('{{ var(\"run_date\") }}'), INTERVAL 1 DAY)) AS data,\n    COALESCE(g.id_veiculo, l.id_veiculo) AS id_veiculo,\n    COALESCE(g.quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n    g.id_validador,\n    g.empresa,\n    l.id_veiculo IS NOT NULL AS indicador_veiculo_licenciamento,\n    COALESCE(g.indicador_veiculo_gps_sppo, FALSE) AS indicador_veiculo_gps_sppo,\n    COALESCE(g.indicador_veiculo_controle_ronald, FALSE) AS indicador_veiculo_controle_ronald\n  FROM\n    gps_sppo_planilha g\n  FULL OUTER JOIN\n    sppo_licenciamento l\n  ON\n    l.id_veiculo = g.id_veiculo\n),\ngps_validador AS (\n  SELECT\n    data,\n    id_validador,\n    COUNT(DISTINCT id_transmissao_gps) AS quantidade_gps_validador\n  FROM\n    {{ ref(\"gps_validador\") }}\n  WHERE\n    data = DATE_SUB(DATE('{{ var(\"run_date\") }}'), INTERVAL 1 DAY)\n  GROUP BY\n    1,\n    2\n),\ntransacao_riocard AS (\n  SELECT DISTINCT\n    data,\n    id_transacao,\n    id_validador\n  FROM\n    {{ ref(\"transacao_riocard\") }}\n  WHERE\n    data = DATE_SUB(DATE('{{ var(\"run_date\") }}'), INTERVAL 1 DAY)\n),\ntransacao_agg AS (\n  SELECT\n    data,\n    id_validador,\n    COUNT(*) AS quantidade_transacao\n  FROM\n    transacao_riocard\n  GROUP BY\n    1,\n    2\n)\nSELECT\n  gs.data,\n  gs.id_veiculo,\n  gs.empresa,\n  gs.id_validador AS numero_serie_validador,\n  gs.indicador_veiculo_licenciamento,\n  gs.indicador_veiculo_gps_sppo,\n  gs.indicador_veiculo_controle_ronald,\n  gv.id_validador IS NOT NULL AS indicador_validador_ativo,\n  IFNULL(t.quantidade_transacao, 0) AS quantidade_transacao_riocard,\n  IFNULL(quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n  IFNULL(quantidade_gps_validador, 0) AS quantidade_gps_validador,\n  SAFE_DIVIDE(quantidade_gps_validador, quantidade_gps_sppo) AS percentual_gps_validador_sppo\nFROM\n  gps_sppo_licenciamento gs\nLEFT JOIN\n  gps_validador gv\nON\n  gs.id_validador = gv.id_validador\n  AND gs.data = gv.data\nLEFT JOIN\n  transacao_agg t\nON\n  gs.id_validador = t.id_validador\n  AND gs.data = t.data", "language": "sql", "refs": [{"name": "gps_sppo", "package": null, "version": null}, {"name": "sppo_licenciamento", "package": null, "version": null}, {"name": "gps_validador", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}], "sources": [["dashboard_controle_vinculo_jae_riocard_staging", "relatorio_instalacao_jae"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae", "model.rj_smtr.gps_sppo", "model.rj_smtr.sppo_licenciamento", "model.rj_smtr.gps_validador", "model.rj_smtr.transacao_riocard"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_controle_vinculo_jae_riocard/veiculo_indicadores_dia.sql", "compiled": true, "compiled_code": "\n\nWITH gps_sppo AS (\n  SELECT\n    data,\n    SUBSTR(id_veiculo, 2) AS id_veiculo,\n    COUNT(DISTINCT timestamp_gps) AS quantidade_gps_sppo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_sppo`\n  WHERE\n    DATA = DATE_SUB(DATE('2022-01-01T01:00:00'), INTERVAL 1 DAY)\n  GROUP BY\n    1,\n    2\n),\nplanilha_ronald AS (\n  SELECT DISTINCT\n    TRIM(numero_ordem_veiculo) AS numero_ordem_veiculo,\n    TRIM(numero_serie_validador) AS id_validador,\n    empresa\n  FROM\n    `rj-smtr-staging`.`dashboard_controle_vinculo_jae_riocard_staging`.`relatorio_instalacao_jae`\n  WHERE\n    LENGTH(numero_ordem_veiculo) = 5\n    AND numero_ordem_veiculo != '99999'\n),\ngps_sppo_planilha AS (\n  SELECT\n    COALESCE(g.data, DATE_SUB(DATE('2022-01-01T01:00:00'), INTERVAL 1 DAY)) AS data,\n    COALESCE(g.id_veiculo, TRIM(r.numero_ordem_veiculo)) AS id_veiculo,\n    COALESCE(g.quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n    TRIM(r.id_validador) AS id_validador,\n    r.empresa,\n    g.id_veiculo IS NOT NULL AS indicador_veiculo_gps_sppo,\n    r.numero_ordem_veiculo IS NOT NULL AS indicador_veiculo_controle_ronald\n  FROM\n    gps_sppo g\n  FULL OUTER JOIN\n    planilha_ronald r\n  ON\n    g.id_veiculo = TRIM(r.numero_ordem_veiculo)\n),\nsppo_licenciamento AS (\n  SELECT DISTINCT\n    SUBSTR(id_veiculo, 2) AS id_veiculo\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_licenciamento`\n  WHERE\n    data = \"2024-03-25\"\n),\ngps_sppo_licenciamento AS (\n  SELECT\n    COALESCE(g.data, DATE_SUB(DATE('2022-01-01T01:00:00'), INTERVAL 1 DAY)) AS data,\n    COALESCE(g.id_veiculo, l.id_veiculo) AS id_veiculo,\n    COALESCE(g.quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n    g.id_validador,\n    g.empresa,\n    l.id_veiculo IS NOT NULL AS indicador_veiculo_licenciamento,\n    COALESCE(g.indicador_veiculo_gps_sppo, FALSE) AS indicador_veiculo_gps_sppo,\n    COALESCE(g.indicador_veiculo_controle_ronald, FALSE) AS indicador_veiculo_controle_ronald\n  FROM\n    gps_sppo_planilha g\n  FULL OUTER JOIN\n    sppo_licenciamento l\n  ON\n    l.id_veiculo = g.id_veiculo\n),\ngps_validador AS (\n  SELECT\n    data,\n    id_validador,\n    COUNT(DISTINCT id_transmissao_gps) AS quantidade_gps_validador\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`\n  WHERE\n    data = DATE_SUB(DATE('2022-01-01T01:00:00'), INTERVAL 1 DAY)\n  GROUP BY\n    1,\n    2\n),\ntransacao_riocard AS (\n  SELECT DISTINCT\n    data,\n    id_transacao,\n    id_validador\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\n  WHERE\n    data = DATE_SUB(DATE('2022-01-01T01:00:00'), INTERVAL 1 DAY)\n),\ntransacao_agg AS (\n  SELECT\n    data,\n    id_validador,\n    COUNT(*) AS quantidade_transacao\n  FROM\n    transacao_riocard\n  GROUP BY\n    1,\n    2\n)\nSELECT\n  gs.data,\n  gs.id_veiculo,\n  gs.empresa,\n  gs.id_validador AS numero_serie_validador,\n  gs.indicador_veiculo_licenciamento,\n  gs.indicador_veiculo_gps_sppo,\n  gs.indicador_veiculo_controle_ronald,\n  gv.id_validador IS NOT NULL AS indicador_validador_ativo,\n  IFNULL(t.quantidade_transacao, 0) AS quantidade_transacao_riocard,\n  IFNULL(quantidade_gps_sppo, 0) AS quantidade_gps_sppo,\n  IFNULL(quantidade_gps_validador, 0) AS quantidade_gps_validador,\n  SAFE_DIVIDE(quantidade_gps_validador, quantidade_gps_sppo) AS percentual_gps_validador_sppo\nFROM\n  gps_sppo_licenciamento gs\nLEFT JOIN\n  gps_validador gv\nON\n  gs.id_validador = gv.id_validador\n  AND gs.data = gv.data\nLEFT JOIN\n  transacao_agg t\nON\n  gs.id_validador = t.id_validador\n  AND gs.data = t.data", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_recursos_sppo_bloqueio_via": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "staging_recursos_sppo_bloqueio_via", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_bloqueio_via.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_bloqueio_via.sql", "unique_id": "model.rj_smtr.staging_recursos_sppo_bloqueio_via", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "staging_recursos_sppo_bloqueio_via"], "alias": "staging_recursos_sppo_bloqueio_via", "checksum": {"name": "sha256", "checksum": "9bebebe031fbcf02920f4e4dcccdfb858da26c5732c70c3ebd6f71fbf893e0a3"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.924648, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_bloqueio_via`", "raw_code": "{{ config(\n  materialized = 'view',\n  )\n}}\n\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  {{source('br_rj_riodejaneiro_recursos_staging',\n    'recursos_sppo_bloqueio_via')}}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_recursos_staging", "recursos_sppo_bloqueio_via"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_bloqueio_via.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_bloqueio_via`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_bloqueio_via_ultimo_julgamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/recursos_sppo_bloqueio_via_ultimo_julgamento.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_bloqueio_via_ultimo_julgamento.sql", "unique_id": "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_bloqueio_via_ultimo_julgamento"], "alias": "recursos_sppo_bloqueio_via_ultimo_julgamento", "checksum": {"name": "sha256", "checksum": "27a9dc2e447eda76ab670dc2b9168473814e26d223adf4cbd0d58bbcb4a58c21"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.9269423, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_bloqueio_via_ultimo_julgamento`", "raw_code": "{{  config(\n    materialized = 'incremental',\n  )\n}}\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_bloqueio_via') }},\n    UNNEST(items) items\n  {% if is_incremental() -%}\n    WHERE\n        DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n{% if is_incremental() %}\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      {{ this }} AS t\n    USING (id_recurso)\n  )\n{% else %}\n  julgamento AS (\n    SELECT\n      id_recurso,\n      julgamento,\n      data_julgamento,\n      LAG(julgamento) OVER (PARTITION BY id_recurso ORDER BY data_julgamento) AS ultimo_julgamento\n    FROM\n        pivotado\n    WHERE\n      julgamento IS NOT NULL\n  )\n{% endif %}\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n)\nWHERE rn=1", "language": "sql", "refs": [{"name": "staging_recursos_sppo_bloqueio_via", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_bloqueio_via"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_bloqueio_via_ultimo_julgamento.sql", "compiled": true, "compiled_code": "\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_bloqueio_via`,\n    UNNEST(items) items\n  WHERE\n        DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_bloqueio_via_ultimo_julgamento` AS t\n    USING (id_recurso)\n  )\n\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n)\nWHERE rn=1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_recursos_sppo_viagens_individuais": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "staging_recursos_sppo_viagens_individuais", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_viagens_individuais.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_viagens_individuais.sql", "unique_id": "model.rj_smtr.staging_recursos_sppo_viagens_individuais", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "staging_recursos_sppo_viagens_individuais"], "alias": "staging_recursos_sppo_viagens_individuais", "checksum": {"name": "sha256", "checksum": "52a65a21f31d8977a66812d096ed7cc6c4153a74637058f477b955275df5a17a"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.9379954, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_viagens_individuais`", "raw_code": "{{ config(\n  materialized = 'view',\n  )\n}}\n\n\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  {{source('br_rj_riodejaneiro_recursos_staging',\n    'recursos_sppo_viagens_individuais')}}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_recursos_staging", "recursos_sppo_viagens_individuais"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_viagens_individuais.sql", "compiled": true, "compiled_code": "\n\n\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_viagens_individuais`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_viagens_individuais_ultimo_julgamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/recursos_sppo_viagens_individuais_ultimo_julgamento.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_viagens_individuais_ultimo_julgamento.sql", "unique_id": "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_viagens_individuais_ultimo_julgamento"], "alias": "recursos_sppo_viagens_individuais_ultimo_julgamento", "checksum": {"name": "sha256", "checksum": "dd685a970633ad4ea55322511452ce2611c278a383c8e1b54829c5803ab204ec"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.940811, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_viagens_individuais_ultimo_julgamento`", "raw_code": "{{  config(\n    materialized = 'incremental',\n  )\n}}\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_viagens_individuais') }},\n    UNNEST(items) items\n  {% if is_incremental() -%}\n    WHERE\n        DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n{% if is_incremental() %}\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      {{ this }} AS t\n    USING (id_recurso)\n  )\n{% else %}\n  julgamento AS (\n    SELECT\n      id_recurso,\n      julgamento,\n      data_julgamento,\n      LAG(julgamento) OVER (PARTITION BY id_recurso ORDER BY data_julgamento) AS ultimo_julgamento\n    FROM\n      pivotado\n    WHERE\n      julgamento IS NOT NULL\n  )\n{% endif %}\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n\n)\nWHERE rn=1", "language": "sql", "refs": [{"name": "staging_recursos_sppo_viagens_individuais", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_viagens_individuais"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_viagens_individuais_ultimo_julgamento.sql", "compiled": true, "compiled_code": "\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_viagens_individuais`,\n    UNNEST(items) items\n  WHERE\n        DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_viagens_individuais_ultimo_julgamento` AS t\n    USING (id_recurso)\n  )\n\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n\n)\nWHERE rn=1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_recursos_sppo_reprocessamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "staging_recursos_sppo_reprocessamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_reprocessamento.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_reprocessamento.sql", "unique_id": "model.rj_smtr.staging_recursos_sppo_reprocessamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "staging_recursos_sppo_reprocessamento"], "alias": "staging_recursos_sppo_reprocessamento", "checksum": {"name": "sha256", "checksum": "ad18c0a2f95e6a6c626f1e2f592e3c5a0a51574431fdf7d2c29795dd8ba91305"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.9479308, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_reprocessamento`", "raw_code": "{{ config(\n  materialized = 'view',\n  )\n}}\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  {{source('br_rj_riodejaneiro_recursos_staging',\n    'recursos_sppo_reprocessamento')}}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_recursos_staging", "recursos_sppo_reprocessamento"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/staging_recursos_sppo_reprocessamento.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  JSON_EXTRACT_ARRAY(content, '$.customFieldValues') AS items,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.createdDate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_recurso,\n  SAFE_CAST(protocol AS STRING) AS id_recurso,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S', REGEXP_REPLACE(JSON_VALUE(content, '$.lastUpdate'), r'(\\.\\d+)?$', '')), 'America/Sao_Paulo') AS datetime_update,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), 'America/Sao_Paulo') AS datetime_captura,\n  data\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_reprocessamento`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_reprocessamento_ultimo_julgamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos_staging/recursos_sppo_reprocessamento_ultimo_julgamento.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_reprocessamento_ultimo_julgamento.sql", "unique_id": "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_reprocessamento_ultimo_julgamento"], "alias": "recursos_sppo_reprocessamento_ultimo_julgamento", "checksum": {"name": "sha256", "checksum": "bd550916feb1afa2638a2171dbec2808b4901a6a2312e1cc554cc963adeee05b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos_staging"}, "created_at": 1727709585.950212, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_reprocessamento_ultimo_julgamento`", "raw_code": "{{  config(\n    materialized = 'incremental',\n  )\n}}\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_reprocessamento') }},\n    UNNEST(items) items\n  {% if is_incremental() -%}\n    WHERE\n        DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n{% if is_incremental() %}\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      {{ this }} AS t\n    USING (id_recurso)\n  )\n{% else %}\n  julgamento AS (\n    SELECT\n      id_recurso,\n      julgamento,\n      data_julgamento,\n      LAG(julgamento) OVER (PARTITION BY id_recurso ORDER BY data_julgamento) AS ultimo_julgamento\n    FROM\n      pivotado\n    WHERE\n      julgamento IS NOT NULL\n  )\n{% endif %}\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n)\nWHERE rn=1", "language": "sql", "refs": [{"name": "staging_recursos_sppo_reprocessamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_reprocessamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos_staging/recursos_sppo_reprocessamento_ultimo_julgamento.sql", "compiled": true, "compiled_code": "\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_update AS data_julgamento,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS julgamento,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_reprocessamento`,\n    UNNEST(items) items\n  WHERE\n        DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n),\npivotado AS (\n  SELECT * EXCEPT(field_id)\n  FROM\n    exploded\n  WHERE field_id = '111865'\n\n),\n\n  julgamento AS (\n    SELECT\n      p.id_recurso,\n      p.julgamento,\n      p.data_julgamento,\n      t.julgamento AS ultimo_julgamento\n    FROM\n      pivotado p\n    LEFT JOIN\n      `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_reprocessamento_ultimo_julgamento` AS t\n    USING (id_recurso)\n  )\n\n\nSELECT\n  id_recurso,\n  data_julgamento,\n  julgamento\nFROM\n(\n  SELECT\n    ROW_NUMBER() OVER(PARTITION BY j.id_recurso ORDER BY j.data_julgamento DESC) AS rn,\n    *\n  FROM\n    julgamento j\n  WHERE\n    j.julgamento != j.ultimo_julgamento OR j.ultimo_julgamento IS NULL\n)\nWHERE rn=1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.my_second_dbt_model": {"database": "rj-smtr", "schema": "dbt", "name": "my_second_dbt_model", "resource_type": "model", "package_name": "rj_smtr", "path": "example/my_second_dbt_model.sql", "original_file_path": "models/example/my_second_dbt_model.sql", "unique_id": "model.rj_smtr.my_second_dbt_model", "fqn": ["rj_smtr", "example", "my_second_dbt_model"], "alias": "my_second_dbt_model", "checksum": {"name": "sha256", "checksum": "dc8c458292bc2fb8ce4591cb70c1e23046e3c2e33fb1c2ce732658f90e231f1e"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "A starter dbt model", "columns": {"id": {"name": "id", "description": "The primary key for this table", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/example/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}}, "created_at": 1727709587.595305, "relation_name": "`rj-smtr`.`dbt`.`my_second_dbt_model`", "raw_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom {{ ref('my_first_dbt_model') }}\nwhere id = 1", "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.my_first_dbt_model"]}, "compiled_path": "target-base/compiled/rj_smtr/models/example/my_second_dbt_model.sql", "compiled": true, "compiled_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom `rj-smtr`.`dbt`.`my_first_dbt_model`\nwhere id = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.my_first_dbt_model": {"database": "rj-smtr", "schema": "dbt", "name": "my_first_dbt_model", "resource_type": "model", "package_name": "rj_smtr", "path": "example/my_first_dbt_model.sql", "original_file_path": "models/example/my_first_dbt_model.sql", "unique_id": "model.rj_smtr.my_first_dbt_model", "fqn": ["rj_smtr", "example", "my_first_dbt_model"], "alias": "my_first_dbt_model", "checksum": {"name": "sha256", "checksum": "0f0a39768ca58b1f5b1e85acbb46843e16a97d88db12e7a25d1533b2e8f77b36"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "A starter dbt model", "columns": {"id": {"name": "id", "description": "The primary key for this table", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/example/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table"}, "created_at": 1727709587.5946045, "relation_name": "`rj-smtr`.`dbt`.`my_first_dbt_model`", "raw_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n{{ config(materialized='table') }}\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/example/my_first_dbt_model.sql", "compiled": true, "compiled_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.balanco_servico_ano": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_servico_ano", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_servico_ano.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_servico_ano.sql", "unique_id": "model.rj_smtr.balanco_servico_ano", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_servico_ano"], "alias": "balanco_servico_ano", "checksum": {"name": "sha256", "checksum": "199056bc4c534508c823845d8d0ddc95ef16e54fc76d3bff39690d29a3e60a17"}, "config": {"enabled": true, "alias": "balanco_servico_ano", "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por servi\u00e7o e ano para servi\u00e7os-dia subsidiados. Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024", "columns": {"ano": {"name": "ano", "description": "Ano", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "alias": "balanco_servico_ano"}, "created_at": 1727709587.7506642, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_ano`", "raw_code": "{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\n\r\nselect\r\n  extract(year from data) as ano,\r\n  consorcio,\r\n  servico,\r\n  sum(km_subsidiada) as km_subsidiada,\r\n  sum(receita_total_esperada) as receita_total_esperada,\r\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\r\n  sum(subsidio_esperado) as subsidio_esperado,\r\n  sum(subsidio_glosado) as subsidio_glosado,\r\n  sum(receita_total_aferida) as receita_total_aferida,\r\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\r\n  sum(subsidio_pago) as subsidio_pago,\r\n  sum(saldo) as saldo\r\nfrom {{ ref(\"balanco_servico_dia\" ~ var('encontro_contas_modo')) }}\r\ngroup by 1,2,3\r\norder by 1,2,3", "language": "sql", "refs": [{"name": "balanco_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.balanco_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/balanco_servico_ano.sql", "compiled": true, "compiled_code": "\n\nselect\n  extract(year from data) as ano,\n  consorcio,\n  servico,\n  sum(km_subsidiada) as km_subsidiada,\n  sum(receita_total_esperada) as receita_total_esperada,\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\n  sum(subsidio_esperado) as subsidio_esperado,\n  sum(subsidio_glosado) as subsidio_glosado,\n  sum(receita_total_aferida) as receita_total_aferida,\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\n  sum(subsidio_pago) as subsidio_pago,\n  sum(saldo) as saldo\nfrom `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia`\ngroup by 1,2,3\norder by 1,2,3", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_balanco_rdo_servico_dia": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "aux_balanco_rdo_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/aux_balanco_rdo_servico_dia.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/aux_balanco_rdo_servico_dia.sql", "unique_id": "model.rj_smtr.aux_balanco_rdo_servico_dia", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "aux_balanco_rdo_servico_dia"], "alias": "aux_balanco_rdo_servico_dia", "checksum": {"name": "sha256", "checksum": "02c3ab15da6f66650109f92229eafa36f6b6d31206aca7d6b8473b75ecb42a8a"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "projeto_subsidio_sppo_encontro_contas"}, "created_at": 1727709585.9665258, "relation_name": null, "raw_code": "{{\r\n    config(\r\n        materialized=\"ephemeral\",\r\n    )\r\n}}\r\n\r\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\r\nWITH\r\n  recursos AS (\r\n  SELECT\r\n    data,\r\n    id_recurso,\r\n    tipo_recurso,\r\n    servico,\r\n    SUM(valor_pago) AS valor_pago\r\n  FROM\r\n    {{ ref(\"recursos_sppo_servico_dia_pago\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4),\r\nservico_dia_atipico as (\r\nSELECT\r\n  DISTINCT data, servico\r\nFROM\r\n  recursos\r\nWHERE\r\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\r\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\r\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\r\n  valor_pago != 0\r\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\r\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\r\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\r\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\r\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\r\n            AND tipo_recurso = \"Reprocessamento\")\r\n),\r\n\r\n-- 3. Calcula a receita tarifaria por servico e dia\r\nrdo AS (\r\n  SELECT\r\n    data,\r\n    consorcio,\r\n    CASE\r\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\r\n    ELSE\r\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\r\n  END\r\n    AS servico,\r\n    linha,\r\n    tipo_servico,\r\n    ordem_servico,\r\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\r\n  FROM\r\n    {{ ref(\"rdo40_registros\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\r\n  WHERE\r\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\r\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\r\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\r\n    and (length(linha) != 4 and linha not like \"2%\") --  Remove rodoviarios\r\n  group by 1,2,3,4,5,6\r\n),\r\n-- Remove servicos nao subsidiados\r\nsumario_dia AS (\r\n  SELECT\r\n    DATA,\r\n    consorcio,\r\n    servico,\r\n    SUM(km_apurada) AS km_subsidiada,\r\n    sum(valor_subsidio_pago) as subsidio_pago\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_historico\") }}\r\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\r\n  WHERE\r\n    DATA BETWEEN \"2022-06-01\"\r\n    AND \"2023-12-31\"\r\n    and valor_subsidio_pago = 0\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3),\r\nrdo_filtrada as (\r\n    select rdo.* from\r\n    (\r\n      select * from rdo\r\n      left join servico_dia_atipico sda\r\n      using (data, servico)\r\n      where sda.data is null\r\n    ) rdo\r\n    left join sumario_dia sd\r\n    using (data, servico)\r\n    where sd.servico is null\r\n)\r\nSELECT\r\n  bsd.data,\r\n  bsd.consorcio,\r\n  bsd.servico,\r\n  bsd.km_subsidiada,\r\n  bsd.receita_tarifaria_aferida,\r\n  rdo.data as data_rdo,\r\n  rdo.consorcio as consorcio_rdo,\r\n  rdo.servico as servico_tratado_rdo,\r\n  rdo.linha as linha_rdo,\r\n  rdo.tipo_servico as tipo_servico_rdo,\r\n  rdo.ordem_servico as ordem_servico_rdo,\r\n  rdo.receita_tarifaria_aferida as receita_tarifaria_aferida_rdo\r\nFROM\r\n  {{ ref(\"balanco_servico_dia\" ~ var('encontro_contas_modo')) }} bsd\r\nFULL JOIN\r\n  rdo_filtrada rdo\r\nUSING\r\n  (data, servico)", "language": "sql", "refs": [{"name": "recursos_sppo_servico_dia_pago", "package": null, "version": null}, {"name": "rdo40_registros", "package": null, "version": null}, {"name": "sumario_servico_dia_historico", "package": null, "version": null}, {"name": "balanco_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.recursos_sppo_servico_dia_pago", "model.rj_smtr.rdo40_registros", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.balanco_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/aux_balanco_rdo_servico_dia.sql", "compiled": true, "compiled_code": "\n\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\nWITH\n  recursos AS (\n  SELECT\n    data,\n    id_recurso,\n    tipo_recurso,\n    servico,\n    SUM(valor_pago) AS valor_pago\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n  GROUP BY\n    1,\n    2,\n    3,\n    4),\nservico_dia_atipico as (\nSELECT\n  DISTINCT data, servico\nFROM\n  recursos\nWHERE\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\n  valor_pago != 0\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\n            AND tipo_recurso = \"Reprocessamento\")\n),\n\n-- 3. Calcula a receita tarifaria por servico e dia\nrdo AS (\n  SELECT\n    data,\n    consorcio,\n    CASE\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\n    ELSE\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\n  END\n    AS servico,\n    linha,\n    tipo_servico,\n    ordem_servico,\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n  WHERE\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\n    and (length(linha) != 4 and linha not like \"2%\") --  Remove rodoviarios\n  group by 1,2,3,4,5,6\n),\n-- Remove servicos nao subsidiados\nsumario_dia AS (\n  SELECT\n    DATA,\n    consorcio,\n    servico,\n    SUM(km_apurada) AS km_subsidiada,\n    sum(valor_subsidio_pago) as subsidio_pago\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\n  WHERE\n    DATA BETWEEN \"2022-06-01\"\n    AND \"2023-12-31\"\n    and valor_subsidio_pago = 0\n  GROUP BY\n    1,\n    2,\n    3),\nrdo_filtrada as (\n    select rdo.* from\n    (\n      select * from rdo\n      left join servico_dia_atipico sda\n      using (data, servico)\n      where sda.data is null\n    ) rdo\n    left join sumario_dia sd\n    using (data, servico)\n    where sd.servico is null\n)\nSELECT\n  bsd.data,\n  bsd.consorcio,\n  bsd.servico,\n  bsd.km_subsidiada,\n  bsd.receita_tarifaria_aferida,\n  rdo.data as data_rdo,\n  rdo.consorcio as consorcio_rdo,\n  rdo.servico as servico_tratado_rdo,\n  rdo.linha as linha_rdo,\n  rdo.tipo_servico as tipo_servico_rdo,\n  rdo.ordem_servico as ordem_servico_rdo,\n  rdo.receita_tarifaria_aferida as receita_tarifaria_aferida_rdo\nFROM\n  `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia` bsd\nFULL JOIN\n  rdo_filtrada rdo\nUSING\n  (data, servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.balanco_consorcio_ano": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_consorcio_ano", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_consorcio_ano.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_consorcio_ano.sql", "unique_id": "model.rj_smtr.balanco_consorcio_ano", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_consorcio_ano"], "alias": "balanco_consorcio_ano", "checksum": {"name": "sha256", "checksum": "8b811b1f9aa36d0c867436b1dd07ddee99fe79138a6d7a6e659bb8aeae074495"}, "config": {"enabled": true, "alias": "balanco_consorcio_ano", "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por cons\u00f3rcio e ano para servi\u00e7os-dia subsidiados. Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024", "columns": {"ano": {"name": "ano", "description": "Ano", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "alias": "balanco_consorcio_ano"}, "created_at": 1727709587.7489288, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_consorcio_ano`", "raw_code": "{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\n\r\nselect\r\n  extract(year from data) as ano,\r\n  consorcio,\r\n  sum(km_subsidiada) as km_subsidiada,\r\n  sum(receita_total_esperada) as receita_total_esperada,\r\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\r\n  sum(subsidio_esperado) as subsidio_esperado,\r\n  sum(subsidio_glosado) as subsidio_glosado,\r\n  sum(receita_total_aferida) as receita_total_aferida,\r\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\r\n  sum(subsidio_pago) as subsidio_pago,\r\n  sum(saldo) as saldo\r\nfrom {{ ref(\"balanco_servico_dia\" ~ var('encontro_contas_modo')) }}\r\ngroup by 1,2\r\norder by 1,2", "language": "sql", "refs": [{"name": "balanco_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.balanco_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/balanco_consorcio_ano.sql", "compiled": true, "compiled_code": "\n\nselect\n  extract(year from data) as ano,\n  consorcio,\n  sum(km_subsidiada) as km_subsidiada,\n  sum(receita_total_esperada) as receita_total_esperada,\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\n  sum(subsidio_esperado) as subsidio_esperado,\n  sum(subsidio_glosado) as subsidio_glosado,\n  sum(receita_total_aferida) as receita_total_aferida,\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\n  sum(subsidio_pago) as subsidio_pago,\n  sum(saldo) as saldo\nfrom `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia`\ngroup by 1,2\norder by 1,2", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.balanco_servico_quinzena": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_servico_quinzena", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_servico_quinzena.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_servico_quinzena.sql", "unique_id": "model.rj_smtr.balanco_servico_quinzena", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_servico_quinzena"], "alias": "balanco_servico_quinzena", "checksum": {"name": "sha256", "checksum": "87d910ca0ab96677e596dc61c8b6cd479471f4eb7c32f23d809bc2fffbca640a"}, "config": {"enabled": true, "alias": "balanco_servico_quinzena", "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por servi\u00e7o e quinzena para servi\u00e7os-dia subsidiados. Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024", "columns": {"quinzena": {"name": "quinzena", "description": "Quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicial_quinzena": {"name": "data_inicial_quinzena", "description": "Data inicial da quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_final_quinzena": {"name": "data_final_quinzena", "description": "Data final da quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_dias_subsidiado": {"name": "quantidade_dias_subsidiado", "description": "Quantidade de dias subsidiado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "alias": "balanco_servico_quinzena"}, "created_at": 1727709587.7544723, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_quinzena`", "raw_code": "{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\n\r\nWITH\r\n  q1 AS (\r\n  SELECT\r\n    FORMAT_DATE('%Y-%m-Q1', date) AS quinzena,\r\n    date AS data_inicial_quinzena,\r\n    DATE_ADD(date, INTERVAL 14 DAY) AS data_final_quinzena\r\n  FROM\r\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\r\n  q2 AS (\r\n  SELECT\r\n    FORMAT_DATE('%Y-%m-Q2', date) AS quinzena,\r\n    DATE_ADD(date, INTERVAL 15 DAY) AS data_inicial_quinzena,\r\n    LAST_DAY(date) AS data_final_quinzena\r\n  FROM\r\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\r\n  quinzenas AS (\r\n  SELECT\r\n    *\r\n  FROM\r\n    q1\r\n  UNION ALL\r\n  SELECT\r\n    *\r\n  FROM\r\n    q2\r\n  ORDER BY\r\n    data_inicial_quinzena )\r\nSELECT\r\n  quinzena,\r\n  data_inicial_quinzena,\r\n  data_final_quinzena,\r\n  consorcio,\r\n  servico,\r\n  COUNT(DATA) AS quantidade_dias_subsidiado,\r\n  SUM(km_subsidiada) AS km_subsidiada,\r\n  SUM(receita_total_esperada) AS receita_total_esperada,\r\n  SUM(receita_tarifaria_esperada) AS receita_tarifaria_esperada,\r\n  SUM(subsidio_esperado) AS subsidio_esperado,\r\n  SUM(subsidio_glosado) AS subsidio_glosado,\r\n  SUM(receita_total_aferida) AS receita_total_aferida,\r\n  SUM(receita_tarifaria_aferida) AS receita_tarifaria_aferida,\r\n  SUM(subsidio_pago) AS subsidio_pago,\r\n  SUM(saldo) AS saldo\r\nFROM\r\n  quinzenas qz\r\nLEFT JOIN\r\n  {{ ref(\"balanco_servico_dia\" ~ var('encontro_contas_modo')) }} bs\r\nON\r\n  bs.data BETWEEN qz.data_inicial_quinzena\r\n  AND qz.data_final_quinzena\r\nGROUP BY\r\n  quinzena,\r\n  data_inicial_quinzena,\r\n  data_final_quinzena,\r\n  consorcio,\r\n  servico\r\nORDER BY\r\n  data_inicial_quinzena,\r\n  consorcio,\r\n  servico", "language": "sql", "refs": [{"name": "balanco_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.balanco_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/balanco_servico_quinzena.sql", "compiled": true, "compiled_code": "\n\nWITH\n  q1 AS (\n  SELECT\n    FORMAT_DATE('%Y-%m-Q1', date) AS quinzena,\n    date AS data_inicial_quinzena,\n    DATE_ADD(date, INTERVAL 14 DAY) AS data_final_quinzena\n  FROM\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\n  q2 AS (\n  SELECT\n    FORMAT_DATE('%Y-%m-Q2', date) AS quinzena,\n    DATE_ADD(date, INTERVAL 15 DAY) AS data_inicial_quinzena,\n    LAST_DAY(date) AS data_final_quinzena\n  FROM\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\n  quinzenas AS (\n  SELECT\n    *\n  FROM\n    q1\n  UNION ALL\n  SELECT\n    *\n  FROM\n    q2\n  ORDER BY\n    data_inicial_quinzena )\nSELECT\n  quinzena,\n  data_inicial_quinzena,\n  data_final_quinzena,\n  consorcio,\n  servico,\n  COUNT(DATA) AS quantidade_dias_subsidiado,\n  SUM(km_subsidiada) AS km_subsidiada,\n  SUM(receita_total_esperada) AS receita_total_esperada,\n  SUM(receita_tarifaria_esperada) AS receita_tarifaria_esperada,\n  SUM(subsidio_esperado) AS subsidio_esperado,\n  SUM(subsidio_glosado) AS subsidio_glosado,\n  SUM(receita_total_aferida) AS receita_total_aferida,\n  SUM(receita_tarifaria_aferida) AS receita_tarifaria_aferida,\n  SUM(subsidio_pago) AS subsidio_pago,\n  SUM(saldo) AS saldo\nFROM\n  quinzenas qz\nLEFT JOIN\n  `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia` bs\nON\n  bs.data BETWEEN qz.data_inicial_quinzena\n  AND qz.data_final_quinzena\nGROUP BY\n  quinzena,\n  data_inicial_quinzena,\n  data_final_quinzena,\n  consorcio,\n  servico\nORDER BY\n  data_inicial_quinzena,\n  consorcio,\n  servico", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.balanco_consorcio_dia": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_consorcio_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_consorcio_dia.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_consorcio_dia.sql", "unique_id": "model.rj_smtr.balanco_consorcio_dia", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_consorcio_dia"], "alias": "balanco_consorcio_dia", "checksum": {"name": "sha256", "checksum": "8665c620e7ab1cb2e1c5dc3c4d7275eaff1fe53618e85521597a10eeff22bbce"}, "config": {"enabled": true, "alias": "balanco_consorcio_dia", "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por cons\u00f3rcio e dia para servi\u00e7os-dia subsidiados. Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024", "columns": {"data": {"name": "data", "description": "Data", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "alias": "balanco_consorcio_dia"}, "created_at": 1727709587.749865, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_consorcio_dia`", "raw_code": "{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\n\r\nselect\r\n  data,\r\n  consorcio,\r\n  sum(km_subsidiada) as km_subsidiada,\r\n  sum(receita_total_esperada) as receita_total_esperada,\r\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\r\n  sum(subsidio_esperado) as subsidio_esperado,\r\n  sum(subsidio_glosado) as subsidio_glosado,\r\n  sum(receita_total_aferida) as receita_total_aferida,\r\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\r\n  sum(subsidio_pago) as subsidio_pago,\r\n  sum(saldo) as saldo\r\nfrom {{ ref(\"balanco_servico_dia\" ~ var('encontro_contas_modo')) }}\r\ngroup by 1,2\r\norder by 1,2", "language": "sql", "refs": [{"name": "balanco_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.balanco_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/balanco_consorcio_dia.sql", "compiled": true, "compiled_code": "\n\nselect\n  data,\n  consorcio,\n  sum(km_subsidiada) as km_subsidiada,\n  sum(receita_total_esperada) as receita_total_esperada,\n  sum(receita_tarifaria_esperada) as receita_tarifaria_esperada,\n  sum(subsidio_esperado) as subsidio_esperado,\n  sum(subsidio_glosado) as subsidio_glosado,\n  sum(receita_total_aferida) as receita_total_aferida,\n  sum(receita_tarifaria_aferida) as receita_tarifaria_aferida,\n  sum(subsidio_pago) as subsidio_pago,\n  sum(saldo) as saldo\nfrom `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia`\ngroup by 1,2\norder by 1,2", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.receita_tarifaria_servico_nao_identificado_quinzena": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "receita_tarifaria_servico_nao_identificado_quinzena", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/receita_tarifaria_servico_nao_identificado_quinzena.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/receita_tarifaria_servico_nao_identificado_quinzena.sql", "unique_id": "model.rj_smtr.receita_tarifaria_servico_nao_identificado_quinzena", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "receita_tarifaria_servico_nao_identificado_quinzena"], "alias": "receita_tarifaria_servico_nao_identificado_quinzena", "checksum": {"name": "sha256", "checksum": "a91df4346259513472fdad12b2ad02b4e70aa0e867ed68386d4afa9eb3472cdd"}, "config": {"enabled": true, "alias": "receita_tarifaria_servico_nao_identificado_quinzena", "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Receita tarif\u00e1ria proveniente do RDO para servi\u00e7os de \u00f4nibus dos cons\u00f3rcios que n\u00e3o foram identificados nos planos operacionais dos respectivos dias.", "columns": {"quinzena": {"name": "quinzena", "description": "Quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicial_quinzena": {"name": "data_inicial_quinzena", "description": "Data inicial da quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_final_quinzena": {"name": "data_final_quinzena", "description": "Data final da quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio_rdo": {"name": "consorcio_rdo", "description": "Cons\u00f3rcio informado no RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_tratado_rdo": {"name": "servico_tratado_rdo", "description": "Servi\u00e7o tratado com base no campo linha do RDO, utilizado para cruzamento com o plano operacional", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha_rdo": {"name": "linha_rdo", "description": "Linha conforme RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_servico_rdo": {"name": "tipo_servico_rdo", "description": "Tipo do servi\u00e7o conforme RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ordem_servico_rdo": {"name": "ordem_servico_rdo", "description": "Ordem do servi\u00e7o conforme o RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_dias_rdo": {"name": "quantidade_dias_rdo", "description": "Quantidade de dias em que o servi\u00e7o foi encontrado no RDO na respectiva quinzena", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida_rdo": {"name": "receita_tarifaria_aferida_rdo", "description": "Receita tarif\u00e1ria aferida com base no RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "alias": "receita_tarifaria_servico_nao_identificado_quinzena"}, "created_at": 1727709587.7573552, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`receita_tarifaria_servico_nao_identificado_quinzena`", "raw_code": "{% if var(\"encontro_contas_modo\") == \"\" %}\r\n{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\nWITH\r\n  q1 AS (\r\n  SELECT\r\n    FORMAT_DATE('%Y-%m-Q1', date) AS quinzena,\r\n    date AS data_inicial_quinzena,\r\n    DATE_ADD(date, INTERVAL 14 DAY) AS data_final_quinzena\r\n  FROM\r\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\r\n  q2 AS (\r\n  SELECT\r\n    FORMAT_DATE('%Y-%m-Q2', date) AS quinzena,\r\n    DATE_ADD(date, INTERVAL 15 DAY) AS data_inicial_quinzena,\r\n    LAST_DAY(date) AS data_final_quinzena\r\n  FROM\r\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\r\n  quinzenas AS (\r\n  SELECT\r\n    *\r\n  FROM\r\n    q1\r\n  UNION ALL\r\n  SELECT\r\n    *\r\n  FROM\r\n    q2\r\n  ORDER BY\r\n    data_inicial_quinzena )\r\nSELECT\r\n  quinzena,\r\n  data_inicial_quinzena,\r\n  data_final_quinzena,\r\n  consorcio_rdo,\r\n  servico_tratado_rdo,\r\n  linha_rdo,\r\n  tipo_servico_rdo,\r\n  ordem_servico_rdo,\r\n  COUNT(data_rdo) AS quantidade_dias_rdo,\r\n  SUM(receita_tarifaria_aferida_rdo) AS receita_tarifaria_aferida_rdo\r\nFROM\r\n  quinzenas qz\r\nLEFT JOIN (\r\n  SELECT * from {{ ref(\"aux_balanco_rdo_servico_dia\") }} WHERE servico is null\r\n) bs\r\nON\r\n  bs.data_rdo BETWEEN qz.data_inicial_quinzena\r\n  AND qz.data_final_quinzena\r\nGROUP BY\r\n  1,2,3,4,5,6,7,8\r\nORDER BY\r\n  2,4,5,6,7,8\r\n{% else %}\r\n{{ config(enabled=false) }}\r\n{% endif %}", "language": "sql", "refs": [{"name": "aux_balanco_rdo_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_balanco_rdo_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/receita_tarifaria_servico_nao_identificado_quinzena.sql", "compiled": true, "compiled_code": "\n\nWITH\n   __dbt__cte__aux_balanco_rdo_servico_dia as (\n\n\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\nWITH\n  recursos AS (\n  SELECT\n    data,\n    id_recurso,\n    tipo_recurso,\n    servico,\n    SUM(valor_pago) AS valor_pago\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n  GROUP BY\n    1,\n    2,\n    3,\n    4),\nservico_dia_atipico as (\nSELECT\n  DISTINCT data, servico\nFROM\n  recursos\nWHERE\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\n  valor_pago != 0\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\n            AND tipo_recurso = \"Reprocessamento\")\n),\n\n-- 3. Calcula a receita tarifaria por servico e dia\nrdo AS (\n  SELECT\n    data,\n    consorcio,\n    CASE\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\n    ELSE\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\n  END\n    AS servico,\n    linha,\n    tipo_servico,\n    ordem_servico,\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n  WHERE\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\n    and (length(linha) != 4 and linha not like \"2%\") --  Remove rodoviarios\n  group by 1,2,3,4,5,6\n),\n-- Remove servicos nao subsidiados\nsumario_dia AS (\n  SELECT\n    DATA,\n    consorcio,\n    servico,\n    SUM(km_apurada) AS km_subsidiada,\n    sum(valor_subsidio_pago) as subsidio_pago\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\n  WHERE\n    DATA BETWEEN \"2022-06-01\"\n    AND \"2023-12-31\"\n    and valor_subsidio_pago = 0\n  GROUP BY\n    1,\n    2,\n    3),\nrdo_filtrada as (\n    select rdo.* from\n    (\n      select * from rdo\n      left join servico_dia_atipico sda\n      using (data, servico)\n      where sda.data is null\n    ) rdo\n    left join sumario_dia sd\n    using (data, servico)\n    where sd.servico is null\n)\nSELECT\n  bsd.data,\n  bsd.consorcio,\n  bsd.servico,\n  bsd.km_subsidiada,\n  bsd.receita_tarifaria_aferida,\n  rdo.data as data_rdo,\n  rdo.consorcio as consorcio_rdo,\n  rdo.servico as servico_tratado_rdo,\n  rdo.linha as linha_rdo,\n  rdo.tipo_servico as tipo_servico_rdo,\n  rdo.ordem_servico as ordem_servico_rdo,\n  rdo.receita_tarifaria_aferida as receita_tarifaria_aferida_rdo\nFROM\n  `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia` bsd\nFULL JOIN\n  rdo_filtrada rdo\nUSING\n  (data, servico)\n), q1 AS (\n  SELECT\n    FORMAT_DATE('%Y-%m-Q1', date) AS quinzena,\n    date AS data_inicial_quinzena,\n    DATE_ADD(date, INTERVAL 14 DAY) AS data_final_quinzena\n  FROM\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\n  q2 AS (\n  SELECT\n    FORMAT_DATE('%Y-%m-Q2', date) AS quinzena,\n    DATE_ADD(date, INTERVAL 15 DAY) AS data_inicial_quinzena,\n    LAST_DAY(date) AS data_final_quinzena\n  FROM\n    UNNEST(GENERATE_DATE_ARRAY('2022-06-01', '2023-12-31', INTERVAL 1 MONTH)) AS date ),\n  quinzenas AS (\n  SELECT\n    *\n  FROM\n    q1\n  UNION ALL\n  SELECT\n    *\n  FROM\n    q2\n  ORDER BY\n    data_inicial_quinzena )\nSELECT\n  quinzena,\n  data_inicial_quinzena,\n  data_final_quinzena,\n  consorcio_rdo,\n  servico_tratado_rdo,\n  linha_rdo,\n  tipo_servico_rdo,\n  ordem_servico_rdo,\n  COUNT(data_rdo) AS quantidade_dias_rdo,\n  SUM(receita_tarifaria_aferida_rdo) AS receita_tarifaria_aferida_rdo\nFROM\n  quinzenas qz\nLEFT JOIN (\n  SELECT * from __dbt__cte__aux_balanco_rdo_servico_dia WHERE servico is null\n) bs\nON\n  bs.data_rdo BETWEEN qz.data_inicial_quinzena\n  AND qz.data_final_quinzena\nGROUP BY\n  1,2,3,4,5,6,7,8\nORDER BY\n  2,4,5,6,7,8\n", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_balanco_rdo_servico_dia", "sql": " __dbt__cte__aux_balanco_rdo_servico_dia as (\n\n\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\nWITH\n  recursos AS (\n  SELECT\n    data,\n    id_recurso,\n    tipo_recurso,\n    servico,\n    SUM(valor_pago) AS valor_pago\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n  GROUP BY\n    1,\n    2,\n    3,\n    4),\nservico_dia_atipico as (\nSELECT\n  DISTINCT data, servico\nFROM\n  recursos\nWHERE\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\n  valor_pago != 0\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\n            AND tipo_recurso = \"Reprocessamento\")\n),\n\n-- 3. Calcula a receita tarifaria por servico e dia\nrdo AS (\n  SELECT\n    data,\n    consorcio,\n    CASE\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\n    ELSE\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\n  END\n    AS servico,\n    linha,\n    tipo_servico,\n    ordem_servico,\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n  WHERE\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\n    and (length(linha) != 4 and linha not like \"2%\") --  Remove rodoviarios\n  group by 1,2,3,4,5,6\n),\n-- Remove servicos nao subsidiados\nsumario_dia AS (\n  SELECT\n    DATA,\n    consorcio,\n    servico,\n    SUM(km_apurada) AS km_subsidiada,\n    sum(valor_subsidio_pago) as subsidio_pago\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\n  WHERE\n    DATA BETWEEN \"2022-06-01\"\n    AND \"2023-12-31\"\n    and valor_subsidio_pago = 0\n  GROUP BY\n    1,\n    2,\n    3),\nrdo_filtrada as (\n    select rdo.* from\n    (\n      select * from rdo\n      left join servico_dia_atipico sda\n      using (data, servico)\n      where sda.data is null\n    ) rdo\n    left join sumario_dia sd\n    using (data, servico)\n    where sd.servico is null\n)\nSELECT\n  bsd.data,\n  bsd.consorcio,\n  bsd.servico,\n  bsd.km_subsidiada,\n  bsd.receita_tarifaria_aferida,\n  rdo.data as data_rdo,\n  rdo.consorcio as consorcio_rdo,\n  rdo.servico as servico_tratado_rdo,\n  rdo.linha as linha_rdo,\n  rdo.tipo_servico as tipo_servico_rdo,\n  rdo.ordem_servico as ordem_servico_rdo,\n  rdo.receita_tarifaria_aferida as receita_tarifaria_aferida_rdo\nFROM\n  `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia` bsd\nFULL JOIN\n  rdo_filtrada rdo\nUSING\n  (data, servico)\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.balanco_servico_dia": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_servico_dia.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_servico_dia.sql", "unique_id": "model.rj_smtr.balanco_servico_dia", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_servico_dia"], "alias": "balanco_servico_dia", "checksum": {"name": "sha256", "checksum": "5e2e93775d609293a51a01eb10a21b0a6a284976bf2332be084279338dbfd9b1"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por servico e dia para servi\u00e7os-dia subsidiados. Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024", "columns": {"data": {"name": "data", "description": "Data", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas"}, "created_at": 1727709587.7515035, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia`", "raw_code": "{% if var(\"encontro_contas_modo\") == \"\" %}\r\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\r\nWITH\r\n  recursos AS (\r\n  SELECT\r\n    data,\r\n    id_recurso,\r\n    tipo_recurso,\r\n    -- consorcio,\r\n    servico,\r\n    SUM(valor_pago) AS valor_pago\r\n  FROM\r\n    {{ ref(\"recursos_sppo_servico_dia_pago\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4),\r\nservico_dia_atipico as (\r\nSELECT\r\n  DISTINCT data, servico\r\nFROM\r\n  recursos\r\nWHERE\r\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\r\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\r\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\r\n  valor_pago != 0\r\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\r\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\r\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\r\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\r\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\r\n            AND tipo_recurso = \"Reprocessamento\")\r\n),\r\n\r\n-- 1. Calcula a km subsidiada por servico e dia\r\nsumario_dia AS (  -- Km apurada por servico e dia\r\n  SELECT\r\n    DATA,\r\n    consorcio,\r\n    servico,\r\n    SUM(km_apurada) AS km_subsidiada,\r\n    sum(valor_subsidio_pago) as subsidio_pago\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_historico\") }}\r\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\r\n  WHERE\r\n    DATA BETWEEN \"2022-06-01\"\r\n    AND \"2023-12-31\"\r\n    and valor_subsidio_pago > 0\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3),\r\n  viagem_remunerada AS ( -- Km subsidiada pos regra do teto de 120% por servico e dia\r\n  SELECT\r\n    DATA,\r\n    servico,\r\n    SUM(distancia_planejada) AS km_subsidiada\r\n  FROM\r\n    {{ ref(\"viagens_remuneradas\") }}\r\n    -- `rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas`\r\n  WHERE\r\n    DATA BETWEEN \"2023-09-16\"\r\n    AND \"2023-12-31\"\r\n    AND indicador_viagem_dentro_limite = TRUE -- useless\r\n  GROUP BY\r\n    1,\r\n    2 ),\r\nkm_subsidiada_dia as (\r\n  SELECT\r\n  sd.* except(km_subsidiada),\r\n    ifnull(case when data >= \"2023-09-16\" then vr.km_subsidiada else sd.km_subsidiada end, 0) as km_subsidiada\r\n  FROM\r\n    sumario_dia sd\r\n  LEFT JOIN\r\n    viagem_remunerada as vr\r\n  using\r\n    (data, servico)\r\n),\r\n\r\n-- 2. Filtra km subsidiada apenas em dias t\u00edpicos (remove servicos e dias pagos por recurso)\r\nkm_subsidiada_filtrada as (\r\n  select\r\n    ksd.*\r\n  from km_subsidiada_dia ksd\r\n  left join servico_dia_atipico sda\r\n  using (data, servico)\r\n  where sda.data is null\r\n  -- Demais dias que n\u00e3o foi considerada a km apurada via GPS:\r\n  and ksd.data NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\r\n),\r\n\r\n\r\n-- 3. Calcula a receita tarifaria por servico e dia\r\nrdo AS (\r\n  SELECT\r\n    data,\r\n    consorcio,\r\n    CASE\r\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\r\n    ELSE\r\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\r\n  END\r\n    AS servico,\r\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\r\n  FROM\r\n    {{ ref(\"rdo40_registros\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\r\n  WHERE\r\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\r\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\r\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\r\n  group by 1,2,3\r\n),\r\nparametros as (\r\n  SELECT\r\n    DISTINCT data_inicio,\r\n    data_fim,\r\n    irk,\r\n    case\r\n      when data_fim <= \"2022-12-31\" then irk - subsidio_km  -- subsidio varia ao longo dos meses\r\n      else coalesce(irk_tarifa_publica, irk - (subsidio_km + desconto_subsidio_km)) end as irk_tarifa_publica,\r\n    (subsidio_km + desconto_subsidio_km) as subsidio_km\r\n  FROM\r\n    {{ source(\"projeto_subsidio_sppo_encontro_contas\", \"parametros_km\") }}\r\n  where data_inicio >= \"2022-06-01\" and data_fim <= \"2023-12-31\"\r\n)\r\n  select\r\n    *,\r\n    ifnull(receita_total_aferida, 0) - ifnull(receita_total_esperada - subsidio_glosado, 0) as saldo\r\n  from (\r\n    select\r\n      ks.* except(subsidio_pago),\r\n      ks.km_subsidiada * par.irk as receita_total_esperada,\r\n      ks.km_subsidiada * par.irk_tarifa_publica as receita_tarifaria_esperada,\r\n      ks.km_subsidiada * par.subsidio_km as subsidio_esperado,\r\n      case when data >= \"2023-01-01\" then (ks.km_subsidiada * par.subsidio_km - subsidio_pago) else 0 end as subsidio_glosado,\r\n      ifnull(rdo.receita_tarifaria_aferida, 0) + ifnull(ks.subsidio_pago, 0) as receita_total_aferida,\r\n      rdo.receita_tarifaria_aferida,\r\n      ks.subsidio_pago\r\n    from\r\n      km_subsidiada_filtrada ks\r\n    left join\r\n      rdo\r\n    using\r\n      (data, servico, consorcio)\r\n    left join\r\n      parametros par\r\n    on\r\n      ks.data between data_inicio and data_fim\r\n  )\r\n{% else %}\r\n{{ config(enabled=false) }}\r\n{% endif %}", "language": "sql", "refs": [{"name": "recursos_sppo_servico_dia_pago", "package": null, "version": null}, {"name": "sumario_servico_dia_historico", "package": null, "version": null}, {"name": "viagens_remuneradas", "package": null, "version": null}, {"name": "rdo40_registros", "package": null, "version": null}], "sources": [["projeto_subsidio_sppo_encontro_contas", "parametros_km"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km", "model.rj_smtr.recursos_sppo_servico_dia_pago", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.viagens_remuneradas", "model.rj_smtr.rdo40_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo_encontro_contas/balanco_servico_dia.sql", "compiled": true, "compiled_code": "\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\nWITH\n  recursos AS (\n  SELECT\n    data,\n    id_recurso,\n    tipo_recurso,\n    -- consorcio,\n    servico,\n    SUM(valor_pago) AS valor_pago\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\n  GROUP BY\n    1,\n    2,\n    3,\n    4),\nservico_dia_atipico as (\nSELECT\n  DISTINCT data, servico\nFROM\n  recursos\nWHERE\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\n  valor_pago != 0\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\n            AND tipo_recurso = \"Reprocessamento\")\n),\n\n-- 1. Calcula a km subsidiada por servico e dia\nsumario_dia AS (  -- Km apurada por servico e dia\n  SELECT\n    DATA,\n    consorcio,\n    servico,\n    SUM(km_apurada) AS km_subsidiada,\n    sum(valor_subsidio_pago) as subsidio_pago\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\n  WHERE\n    DATA BETWEEN \"2022-06-01\"\n    AND \"2023-12-31\"\n    and valor_subsidio_pago > 0\n  GROUP BY\n    1,\n    2,\n    3),\n  viagem_remunerada AS ( -- Km subsidiada pos regra do teto de 120% por servico e dia\n  SELECT\n    DATA,\n    servico,\n    SUM(distancia_planejada) AS km_subsidiada\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`viagens_remuneradas`\n    -- `rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas`\n  WHERE\n    DATA BETWEEN \"2023-09-16\"\n    AND \"2023-12-31\"\n    AND indicador_viagem_dentro_limite = TRUE -- useless\n  GROUP BY\n    1,\n    2 ),\nkm_subsidiada_dia as (\n  SELECT\n  sd.* except(km_subsidiada),\n    ifnull(case when data >= \"2023-09-16\" then vr.km_subsidiada else sd.km_subsidiada end, 0) as km_subsidiada\n  FROM\n    sumario_dia sd\n  LEFT JOIN\n    viagem_remunerada as vr\n  using\n    (data, servico)\n),\n\n-- 2. Filtra km subsidiada apenas em dias t\u00edpicos (remove servicos e dias pagos por recurso)\nkm_subsidiada_filtrada as (\n  select\n    ksd.*\n  from km_subsidiada_dia ksd\n  left join servico_dia_atipico sda\n  using (data, servico)\n  where sda.data is null\n  -- Demais dias que n\u00e3o foi considerada a km apurada via GPS:\n  and ksd.data NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\n),\n\n\n-- 3. Calcula a receita tarifaria por servico e dia\nrdo AS (\n  SELECT\n    data,\n    consorcio,\n    CASE\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\n    ELSE\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[B-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\n  END\n    AS servico,\n    round(SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie), 0) AS receita_tarifaria_aferida\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\n  WHERE\n    DATA BETWEEN \"2022-06-01\" AND \"2023-12-31\"\n    AND DATA NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\n  group by 1,2,3\n),\nparametros as (\n  SELECT\n    DISTINCT data_inicio,\n    data_fim,\n    irk,\n    case\n      when data_fim <= \"2022-12-31\" then irk - subsidio_km  -- subsidio varia ao longo dos meses\n      else coalesce(irk_tarifa_publica, irk - (subsidio_km + desconto_subsidio_km)) end as irk_tarifa_publica,\n    (subsidio_km + desconto_subsidio_km) as subsidio_km\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`parametros_km`\n  where data_inicio >= \"2022-06-01\" and data_fim <= \"2023-12-31\"\n)\n  select\n    *,\n    ifnull(receita_total_aferida, 0) - ifnull(receita_total_esperada - subsidio_glosado, 0) as saldo\n  from (\n    select\n      ks.* except(subsidio_pago),\n      ks.km_subsidiada * par.irk as receita_total_esperada,\n      ks.km_subsidiada * par.irk_tarifa_publica as receita_tarifaria_esperada,\n      ks.km_subsidiada * par.subsidio_km as subsidio_esperado,\n      case when data >= \"2023-01-01\" then (ks.km_subsidiada * par.subsidio_km - subsidio_pago) else 0 end as subsidio_glosado,\n      ifnull(rdo.receita_tarifaria_aferida, 0) + ifnull(ks.subsidio_pago, 0) as receita_total_aferida,\n      rdo.receita_tarifaria_aferida,\n      ks.subsidio_pago\n    from\n      km_subsidiada_filtrada ks\n    left join\n      rdo\n    using\n      (data, servico, consorcio)\n    left join\n      parametros par\n    on\n      ks.data between data_inicio and data_fim\n  )\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.passageiros_hora": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "passageiros_hora", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/passageiros_hora.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/passageiros_hora.sql", "unique_id": "model.rj_smtr.passageiros_hora", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "passageiros_hora"], "alias": "passageiros_hora", "checksum": {"name": "sha256", "checksum": "fce9066d985671d437d9562fe722424830c1c1a1f10b063ad9f8c3fc0e87d925"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela de contagem do n\u00famero de passageiros por hora. Agrega valores da tabela de transa\u00e7\u00f5es por: data, hora, modo, consorcio, operadora, servico, sentido e tipo_transacao", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_smtr": {"name": "tipo_transacao_smtr", "description": "Tipo de transa\u00e7\u00e3o realizada no padr\u00e3o usado pela SMTR (Tarifa Cheia, Integra\u00e7\u00e3o e Gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_detalhe_smtr": {"name": "tipo_transacao_detalhe_smtr", "description": "Detalhamento sobre a transa\u00e7\u00e3o, de acordo com o tipo (Tarifa Cheia = tipo do pagamento, Gratuidade = tipo da gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_gratuidade": {"name": "tipo_gratuidade", "description": "Tipo da gratuidade (Estudante, PCD, S\u00eanior)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_pagamento": {"name": "tipo_pagamento", "description": "Tipo de pagamento utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiros": {"name": "quantidade_passageiros", "description": "Quantidade de transa\u00e7\u00f5es que aconteceram em determinada data e hora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8536696, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`passageiros_hora`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\": \"date\",\n      \"granularity\":\"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n/*\nconsulta as parti\u00e7\u00f5es a serem atualizadas com base nas transa\u00e7\u00f5es capturadas entre date_range_start e date_range_end\ne as integra\u00e7\u00f5es capturadas entre date_range_start e date_range_end\n*/\n{% set transacao_table = ref('transacao') %}\n{% set transacao_riocard_table = ref('transacao_riocard') %}\n{% if execute %}\n  {% if is_incremental() %}\n    -- Transa\u00e7\u00f5es Ja\u00e9\n    {% set partitions_query %}\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        -- `{{ transacao_table.database }}.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n        `rj-smtr.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATETIME(last_modified_time, \"America/Sao_Paulo\") BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND (DATETIME(\"{{var('date_range_end')}}\"))\n\n      UNION DISTINCT\n\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        -- `{{ transacao_riocard_table.database }}.{{ transacao_riocard_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n        `rj-smtr.{{ transacao_riocard_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_riocard_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATETIME(last_modified_time, \"America/Sao_Paulo\") BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND DATETIME(\"{{var('date_range_end')}}\")\n\n    {% endset %}\n\n    {% set partitions = run_query(partitions_query) %}\n\n    {% set partition_list = partitions.columns[0].values() %}\n  {% endif %}\n{% endif %}\n\nSELECT\n  * EXCEPT(id_transacao, geo_point_transacao),\n  COUNT(id_transacao) AS quantidade_passageiros,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  {{ ref(\"aux_passageiros_hora\") }}\nWHERE\n{% if is_incremental() %}\n  {% if partition_list|length > 0 %}\n    data IN ({{ partition_list|join(', ') }})\n  {% else %}\n    data = \"2000-01-01\"\n  {% endif %}\n{% else %}\n  data >= \"2023-07-19\"\n{% endif %}\nGROUP BY\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  tipo_transacao_smtr,\n  tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}, {"name": "aux_passageiros_hora", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard", "model.rj_smtr.aux_passageiros_hora"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/passageiros_hora.sql", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__aux_passageiros_hora as (\n\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )\n) /*\nconsulta as parti\u00e7\u00f5es a serem atualizadas com base nas transa\u00e7\u00f5es capturadas entre date_range_start e date_range_end\ne as integra\u00e7\u00f5es capturadas entre date_range_start e date_range_end\n*/\n\n\n\n  \n    -- Transa\u00e7\u00f5es Ja\u00e9\n    \n\n    \n\n    \n  \n\n\nSELECT\n  * EXCEPT(id_transacao, geo_point_transacao),\n  COUNT(id_transacao) AS quantidade_passageiros,\n  '' AS versao\nFROM\n  __dbt__cte__aux_passageiros_hora\nWHERE\n\n  \n    data = \"2000-01-01\"\n  \n\nGROUP BY\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  tipo_transacao_smtr,\n  tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_passageiros_hora", "sql": " __dbt__cte__aux_passageiros_hora as (\n\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_consorcio_operador_dia": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "ordem_pagamento_consorcio_operador_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_operador_dia.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_operador_dia.sql", "unique_id": "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "ordem_pagamento_consorcio_operador_dia"], "alias": "ordem_pagamento_consorcio_operador_dia", "checksum": {"name": "sha256", "checksum": "cebfb21790cf32a58027849674f7b2c58b8b453e9db43619da3a0913b3bf3f6e"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com os valores totais de pagamento da Ja\u00e9 agregados por consorcio, operador e dia", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento_consorcio_operador_dia": {"name": "id_ordem_pagamento_consorcio_operador_dia", "description": "Identificador \u00fanico do registro no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador da ordem pagamento no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_debito": {"name": "quantidade_transacao_debito", "description": "Quantidade de transa\u00e7\u00f5es feitas na modalidade d\u00e9bito", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_debito": {"name": "valor_debito", "description": "Valor total das transa\u00e7\u00f5es feitas na modalidade d\u00e9bito (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_especie": {"name": "quantidade_transacao_especie", "description": "Quantidade de transa\u00e7\u00f5es feitas em esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_especie": {"name": "valor_especie", "description": "Valor total das transa\u00e7\u00f5es feitas em esp\u00e9cie (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de transa\u00e7\u00f5es feitas com gratuidade", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_gratuidade": {"name": "valor_gratuidade", "description": "Valor total das transa\u00e7\u00f5es feitas com gratuidade (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_integracao": {"name": "quantidade_transacao_integracao", "description": "Quantidade de transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_integracao": {"name": "valor_integracao", "description": "Valor total das transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_credito": {"name": "quantidade_transacao_rateio_credito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no cr\u00e9dito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_credito": {"name": "valor_rateio_credito", "description": "Valor total creditado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_debito": {"name": "quantidade_transacao_rateio_debito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no d\u00e9bito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_debito": {"name": "valor_rateio_debito", "description": "Valor total debitado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_total_transacao": {"name": "quantidade_total_transacao", "description": "Quantidade total de transa\u00e7\u00f5es realizadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_bruto": {"name": "valor_total_transacao_bruto", "description": "Valor total das transa\u00e7\u00f5es realizadas (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_desconto_taxa": {"name": "valor_desconto_taxa", "description": "Valor da taxa descontado do valor total (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_liquido_ordem": {"name": "valor_total_transacao_liquido_ordem", "description": "Valor total das transa\u00e7\u00f5es menos o valor_desconto_taxa (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_liquido": {"name": "valor_total_transacao_liquido", "description": "Valor corrigido total das transa\u00e7\u00f5es menos o valor_desconto_taxa (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data em que foi realizado o pagamento ao operador ou cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor pago ao operador ou cons\u00f3rcio (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8656392, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_operador_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data_ordem\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n-- depends_on: {{ ref(\"ordem_pagamento_servico_operador_dia\") }}\n\n{% set ordem_pagamento_consorcio_operadora_staging = ref('staging_ordem_pagamento_consorcio_operadora') %}\n\n{% if execute %}\n  {% if is_incremental() %}\n    -- Verifica as ordens de pagamento capturadas\n    {% set partitions_query %}\n      SELECT DISTINCT\n        CONCAT(\"'\", DATE(data_ordem), \"'\") AS data_ordem\n      FROM\n        {{ ordem_pagamento_consorcio_operadora_staging }}\n      WHERE\n        DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n    {% endset %}\n\n    {% set partitions = run_query(partitions_query).columns[0].values() %}\n  {% endif %}\n{% endif %}\n\nWITH pagamento AS (\n  SELECT\n    data_pagamento,\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    valor_pago\n  FROM\n    {{ ref(\"aux_retorno_ordem_pagamento\") }}\n    -- `rj-smtr.controle_financeiro_staging.aux_retorno_ordem_pagamento`\n  {% if is_incremental() %}\n    WHERE\n    {% if partitions|length > 0 %}\n      data_ordem IN ({{ partitions|join(', ') }})\n    {% else %}\n      data_ordem = '2000-01-01'\n    {% endif %}\n  {% endif %}\n),\nordem_pagamento AS (\n  SELECT\n  o.data_ordem,\n  o.id_ordem_pagamento_consorcio_operadora AS id_ordem_pagamento_consorcio_operador_dia,\n  dc.id_consorcio,\n  dc.consorcio,\n  do.id_operadora,\n  do.operadora,\n  op.id_ordem_pagamento AS id_ordem_pagamento,\n  o.qtd_debito AS quantidade_transacao_debito,\n  o.valor_debito,\n  o.qtd_vendaabordo AS quantidade_transacao_especie,\n  o.valor_vendaabordo AS valor_especie,\n  o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n  o.valor_gratuidade,\n  o.qtd_integracao AS quantidade_transacao_integracao,\n  o.valor_integracao,\n  o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n  o.valor_rateio_credito AS valor_rateio_credito,\n  o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n  o.valor_rateio_debito AS valor_rateio_debito,\n  (\n    o.qtd_debito\n    + o.qtd_vendaabordo\n    + o.qtd_gratuidade\n    + o.qtd_integracao\n  ) AS quantidade_total_transacao,\n  o.valor_bruto AS valor_total_transacao_bruto,\n  o.valor_taxa AS valor_desconto_taxa,\n  o.valor_liquido AS valor_total_transacao_liquido_ordem\n  FROM\n    {{ ordem_pagamento_consorcio_operadora_staging }} o\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora` o\n  JOIN\n    {{ ref(\"staging_ordem_pagamento\") }} op\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento` op\n  ON\n    o.data_ordem = op.data_ordem\n  LEFT JOIN\n    {{ ref(\"operadoras\") }} do\n    -- `rj-smtr.cadastro.operadoras` do\n  ON\n    o.id_operadora = do.id_operadora_jae\n  LEFT JOIN\n    {{ ref(\"consorcios\") }} dc\n    -- `rj-smtr.cadastro.consorcios` dc\n  ON\n    o.id_consorcio = dc.id_consorcio_jae\n  {% if is_incremental() %}\n    WHERE\n      DATE(o.data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n  {% endif %}\n),\nordem_pagamento_completa AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    ordem_pagamento\n\n  {% if is_incremental() and paid_orders|length > 0 %}\n    UNION ALL\n\n    SELECT\n      data_ordem,\n      id_ordem_pagamento_consorcio_operador_dia,\n      id_consorcio,\n      consorcio,\n      id_operadora,\n      operadora,\n      id_ordem_pagamento,\n      quantidade_transacao_debito,\n      valor_debito,\n      quantidade_transacao_especie,\n      valor_especie,\n      quantidade_transacao_gratuidade,\n      valor_gratuidade,\n      quantidade_transacao_integracao,\n      valor_integracao,\n      quantidade_transacao_rateio_credito,\n      valor_rateio_credito,\n      quantidade_transacao_rateio_debito,\n      valor_rateio_debito,\n      quantidade_total_transacao,\n      valor_total_transacao_bruto,\n      valor_desconto_taxa,\n      valor_total_transacao_liquido_ordem,\n      1 AS priority\n    FROM\n      {{ this }}\n    WHERE\n      data_ordem IN ({{ paid_orders|join(', ') }})\n  {% endif %}\n),\nordem_valor_pagamento AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento_consorcio_operador_dia,\n    id_consorcio,\n    o.consorcio,\n    id_operadora,\n    o.operadora,\n    o.id_ordem_pagamento,\n    o.quantidade_transacao_debito,\n    o.valor_debito,\n    o.quantidade_transacao_especie,\n    o.valor_especie,\n    o.quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito,\n    o.quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto,\n    o.valor_desconto_taxa,\n    o.valor_total_transacao_liquido_ordem,\n    p.data_pagamento,\n    p.valor_pago,\n    ROW_NUMBER() OVER (PARTITION BY data_ordem, id_consorcio, id_operadora ORDER BY priority) AS rn\n  FROM\n    ordem_pagamento_completa o\n  LEFT JOIN\n    pagamento p\n  USING(data_ordem, id_consorcio, id_operadora)\n)\nSELECT\n  data_ordem,\n  id_ordem_pagamento_consorcio_operador_dia,\n  id_consorcio,\n  consorcio,\n  id_operadora,\n  operadora,\n  id_ordem_pagamento,\n  quantidade_transacao_debito,\n  valor_debito,\n  quantidade_transacao_especie,\n  valor_especie,\n  quantidade_transacao_gratuidade,\n  valor_gratuidade,\n  quantidade_transacao_integracao,\n  valor_integracao,\n  quantidade_transacao_rateio_credito,\n  valor_rateio_credito,\n  quantidade_transacao_rateio_debito,\n  valor_rateio_debito,\n  quantidade_total_transacao,\n  valor_total_transacao_bruto,\n  valor_desconto_taxa,\n  valor_total_transacao_liquido_ordem,\n  CASE\n    WHEN\n      data_ordem = '2024-06-07'\n      AND id_consorcio = '2'\n      AND id_operadora = '8'\n    THEN\n      valor_total_transacao_liquido_ordem - 1403.4532 -- Corrigir valor pago incorretamente ao VLT na ordem do dia 2024-05-31\n    ELSE valor_total_transacao_liquido_ordem\n  END AS valor_total_transacao_liquido,\n  data_pagamento,\n  valor_pago,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  ordem_valor_pagamento\nWHERE\n  rn = 1", "language": "sql", "refs": [{"name": "ordem_pagamento_servico_operador_dia", "package": null, "version": null}, {"name": "staging_ordem_pagamento_consorcio_operadora", "package": null, "version": null}, {"name": "aux_retorno_ordem_pagamento", "package": null, "version": null}, {"name": "staging_ordem_pagamento", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora", "model.rj_smtr.aux_retorno_ordem_pagamento", "model.rj_smtr.staging_ordem_pagamento", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_operador_dia.sql", "compiled": true, "compiled_code": "\n-- depends_on: `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_servico_operador_dia`\n\n\n\n\n  \n    -- Verifica as ordens de pagamento capturadas\n    \n\n    \n  \n\n\nWITH pagamento AS (\n  SELECT\n    data_pagamento,\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    valor_pago\n  FROM\n    `rj-smtr`.`controle_financeiro_staging`.`aux_retorno_ordem_pagamento`\n    -- `rj-smtr.controle_financeiro_staging.aux_retorno_ordem_pagamento`\n  \n    WHERE\n    \n      data_ordem = '2000-01-01'\n    \n  \n),\nordem_pagamento AS (\n  SELECT\n  o.data_ordem,\n  o.id_ordem_pagamento_consorcio_operadora AS id_ordem_pagamento_consorcio_operador_dia,\n  dc.id_consorcio,\n  dc.consorcio,\n  do.id_operadora,\n  do.operadora,\n  op.id_ordem_pagamento AS id_ordem_pagamento,\n  o.qtd_debito AS quantidade_transacao_debito,\n  o.valor_debito,\n  o.qtd_vendaabordo AS quantidade_transacao_especie,\n  o.valor_vendaabordo AS valor_especie,\n  o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n  o.valor_gratuidade,\n  o.qtd_integracao AS quantidade_transacao_integracao,\n  o.valor_integracao,\n  o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n  o.valor_rateio_credito AS valor_rateio_credito,\n  o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n  o.valor_rateio_debito AS valor_rateio_debito,\n  (\n    o.qtd_debito\n    + o.qtd_vendaabordo\n    + o.qtd_gratuidade\n    + o.qtd_integracao\n  ) AS quantidade_total_transacao,\n  o.valor_bruto AS valor_total_transacao_bruto,\n  o.valor_taxa AS valor_desconto_taxa,\n  o.valor_liquido AS valor_total_transacao_liquido_ordem\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio_operadora` o\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora` o\n  JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento` op\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento` op\n  ON\n    o.data_ordem = op.data_ordem\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` do\n    -- `rj-smtr.cadastro.operadoras` do\n  ON\n    o.id_operadora = do.id_operadora_jae\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` dc\n    -- `rj-smtr.cadastro.consorcios` dc\n  ON\n    o.id_consorcio = dc.id_consorcio_jae\n  \n    WHERE\n      DATE(o.data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n  \n),\nordem_pagamento_completa AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    ordem_pagamento\n\n  \n),\nordem_valor_pagamento AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento_consorcio_operador_dia,\n    id_consorcio,\n    o.consorcio,\n    id_operadora,\n    o.operadora,\n    o.id_ordem_pagamento,\n    o.quantidade_transacao_debito,\n    o.valor_debito,\n    o.quantidade_transacao_especie,\n    o.valor_especie,\n    o.quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito,\n    o.quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto,\n    o.valor_desconto_taxa,\n    o.valor_total_transacao_liquido_ordem,\n    p.data_pagamento,\n    p.valor_pago,\n    ROW_NUMBER() OVER (PARTITION BY data_ordem, id_consorcio, id_operadora ORDER BY priority) AS rn\n  FROM\n    ordem_pagamento_completa o\n  LEFT JOIN\n    pagamento p\n  USING(data_ordem, id_consorcio, id_operadora)\n)\nSELECT\n  data_ordem,\n  id_ordem_pagamento_consorcio_operador_dia,\n  id_consorcio,\n  consorcio,\n  id_operadora,\n  operadora,\n  id_ordem_pagamento,\n  quantidade_transacao_debito,\n  valor_debito,\n  quantidade_transacao_especie,\n  valor_especie,\n  quantidade_transacao_gratuidade,\n  valor_gratuidade,\n  quantidade_transacao_integracao,\n  valor_integracao,\n  quantidade_transacao_rateio_credito,\n  valor_rateio_credito,\n  quantidade_transacao_rateio_debito,\n  valor_rateio_debito,\n  quantidade_total_transacao,\n  valor_total_transacao_bruto,\n  valor_desconto_taxa,\n  valor_total_transacao_liquido_ordem,\n  CASE\n    WHEN\n      data_ordem = '2024-06-07'\n      AND id_consorcio = '2'\n      AND id_operadora = '8'\n    THEN\n      valor_total_transacao_liquido_ordem - 1403.4532 -- Corrigir valor pago incorretamente ao VLT na ordem do dia 2024-05-31\n    ELSE valor_total_transacao_liquido_ordem\n  END AS valor_total_transacao_liquido,\n  data_pagamento,\n  valor_pago,\n  '' AS versao\nFROM\n  ordem_valor_pagamento\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_validador": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "gps_validador", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/gps_validador.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/gps_validador.sql", "unique_id": "model.rj_smtr.gps_validador", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "gps_validador"], "alias": "gps_validador", "checksum": {"name": "sha256", "checksum": "3195f470e5dc73c69da7f9b61bde0e71034973bd1b967df962d9dc1641efb16a"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela de posi\u00e7\u00f5es de GPS de todos os validadores da Ja\u00e9, incluindo estado do equipamento (Aberto/Fechado), servi\u00e7o, sentido e ve\u00edculo associado e temperatura do ve\u00edculo.", "columns": {"modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do recebimento da transmiss\u00e3o do GPS (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do recebimento da transmiss\u00e3o do GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_gps": {"name": "datetime_gps", "description": "Data e hora do recebimento da transmiss\u00e3o do GPS em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora da captura do dado de GPS em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transmissao_gps": {"name": "id_transmissao_gps", "description": "Identificador \u00fanico da tabela de GPS dos validadores", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude do validador no momento da transmiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Longitude do validador no momento da transmiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "[EM DESENVOLVIMENTO] C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Validador aberto ou fechado no momento da transmiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "temperatura": {"name": "temperatura", "description": "Temperatura do local, medida pelo sensor do validador (\u00baC)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_app": {"name": "versao_app", "description": "Vers\u00e3o do Software do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "tags": ["geolocalizacao"]}, "created_at": 1727709587.8513806, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    tags=['geolocalizacao']\n  )\n}}\n\nSELECT\n    modo,\n    EXTRACT(DATE FROM datetime_gps) AS data,\n    EXTRACT(HOUR FROM datetime_gps) AS hora,\n    datetime_gps,\n    datetime_captura,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    -- s.servico,\n    servico_jae,\n    descricao_servico_jae,\n    CASE\n      WHEN modo = \"VLT\" THEN SUBSTRING(id_veiculo, 1, 3)\n      WHEN modo = \"BRT\" THEN NULL\n      ELSE id_veiculo\n    END AS id_veiculo,\n    id_validador,\n    id_transmissao_gps,\n    latitude,\n    longitude,\n    sentido,\n    estado_equipamento,\n    temperatura,\n    versao_app,\n    '{{ var(\"version\") }}' as versao\nFROM\n(\n    SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n    FROM\n        {{ ref(\"gps_validador_aux\") }}\n\n    {% if is_incremental() %}\n      WHERE\n          DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n          AND datetime_captura > DATETIME(\"{{var('date_range_start')}}\") AND datetime_captura <= DATETIME(\"{{var('date_range_end')}}\")\n    {% endif %}\n)\nWHERE\n    rn = 1\n    AND modo != \"Van\"", "language": "sql", "refs": [{"name": "gps_validador_aux", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.gps_validador_aux"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/gps_validador.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    modo,\n    EXTRACT(DATE FROM datetime_gps) AS data,\n    EXTRACT(HOUR FROM datetime_gps) AS hora,\n    datetime_gps,\n    datetime_captura,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    -- s.servico,\n    servico_jae,\n    descricao_servico_jae,\n    CASE\n      WHEN modo = \"VLT\" THEN SUBSTRING(id_veiculo, 1, 3)\n      WHEN modo = \"BRT\" THEN NULL\n      ELSE id_veiculo\n    END AS id_veiculo,\n    id_validador,\n    id_transmissao_gps,\n    latitude,\n    longitude,\n    sentido,\n    estado_equipamento,\n    temperatura,\n    versao_app,\n    '' as versao\nFROM\n(\n    SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador_aux`\n\n    \n      WHERE\n          DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n          AND datetime_captura > DATETIME(\"2022-01-01T00:00:00\") AND datetime_captura <= DATETIME(\"2022-01-01T01:00:00\")\n    \n)\nWHERE\n    rn = 1\n    AND modo != \"Van\"", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.dicionario": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "dicionario", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/dicionario.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/dicionario.sql", "unique_id": "model.rj_smtr.dicionario", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "dicionario"], "alias": "dicionario", "checksum": {"name": "sha256", "checksum": "6c4c33c3ce759a068dc9c01740ae8a6ed68be8c28c0810bbf29132cf5a38d16c"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Dicion\u00e1rio de dados", "columns": {"chave": {"name": "chave", "description": "Chave", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cobertura_temporal": {"name": "cobertura_temporal", "description": "Cobertura temporal", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_tabela": {"name": "id_tabela", "description": "Nome da tabela", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "coluna": {"name": "coluna", "description": "Nome da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_bilhetagem"}, "created_at": 1727709587.8563788, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`dicionario`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\nSELECT\n  SAFE_CAST(chave AS STRING) AS chave,\n  SAFE_CAST(cobertura_temporal AS STRING) AS cobertura_temporal,\n  SAFE_CAST(id_tabela AS STRING) AS id_tabela,\n  SAFE_CAST(coluna AS STRING) AS coluna,\n  SAFE_CAST(valor AS STRING) AS valor\nFROM\n  {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"dicionario\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "dicionario"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/dicionario.sql", "compiled": true, "compiled_code": "\nSELECT\n  SAFE_CAST(chave AS STRING) AS chave,\n  SAFE_CAST(cobertura_temporal AS STRING) AS cobertura_temporal,\n  SAFE_CAST(id_tabela AS STRING) AS id_tabela,\n  SAFE_CAST(coluna AS STRING) AS coluna,\n  SAFE_CAST(valor AS STRING) AS valor\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`dicionario`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_dia": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "ordem_pagamento_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/ordem_pagamento_dia.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_dia.sql", "unique_id": "model.rj_smtr.ordem_pagamento_dia", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "ordem_pagamento_dia"], "alias": "ordem_pagamento_dia", "checksum": {"name": "sha256", "checksum": "b0b8bce58e2d2eb106c32c6822a6531c21d6e14e952524b2bcf56cd011af2c74"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com os valores totais de pagamento da Ja\u00e9 agregados por dia", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data de pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador da ordem pagamento no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_debito": {"name": "quantidade_transacao_debito", "description": "Quantidade de transa\u00e7\u00f5es feitas na modalidade d\u00e9bito", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_debito": {"name": "valor_debito", "description": "Valor total das transa\u00e7\u00f5es feitas na modalidade d\u00e9bito (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_especie": {"name": "quantidade_transacao_especie", "description": "Quantidade de transa\u00e7\u00f5es feitas em esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_especie": {"name": "valor_especie", "description": "Valor total das transa\u00e7\u00f5es feitas em esp\u00e9cie (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de transa\u00e7\u00f5es feitas com gratuidade", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_gratuidade": {"name": "valor_gratuidade", "description": "Valor total das transa\u00e7\u00f5es feitas com gratuidade (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_integracao": {"name": "quantidade_transacao_integracao", "description": "Quantidade de transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_integracao": {"name": "valor_integracao", "description": "Valor total das transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_credito": {"name": "quantidade_transacao_rateio_credito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no cr\u00e9dito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_credito": {"name": "valor_rateio_credito", "description": "Valor total creditado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_total_transacao": {"name": "quantidade_total_transacao", "description": "Quantidade total de transa\u00e7\u00f5es realizadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_debito": {"name": "quantidade_transacao_rateio_debito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no d\u00e9bito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_debito": {"name": "valor_rateio_debito", "description": "Valor total debitado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_bruto": {"name": "valor_total_transacao_bruto", "description": "Valor total das transa\u00e7\u00f5es realizadas (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_desconto_taxa": {"name": "valor_desconto_taxa", "description": "Valor da taxa descontado do valor total (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_liquido": {"name": "valor_total_transacao_liquido", "description": "Valor total das transa\u00e7\u00f5es menos o valor_desconto_taxa (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8667252, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data_ordem\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n-- depends_on: {{ ref(\"ordem_pagamento_consorcio_dia\") }}\nSELECT\n    o.data_ordem,\n    o.data_pagamento,\n    o.id_ordem_pagamento AS id_ordem_pagamento,\n    o.qtd_debito AS quantidade_transacao_debito,\n    o.valor_debito,\n    o.qtd_vendaabordo AS quantidade_transacao_especie,\n    o.valor_vendaabordo AS valor_especie,\n    o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.qtd_integracao AS quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito AS valor_rateio_credito,\n    o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito AS valor_rateio_debito,\n    (\n      o.qtd_debito\n      + o.qtd_vendaabordo\n      + o.qtd_gratuidade\n      + o.qtd_integracao\n    ) AS quantidade_total_transacao,\n    o.valor_bruto AS valor_total_transacao_bruto,\n    o.valor_taxa AS valor_desconto_taxa,\n    o.valor_liquido AS valor_total_transacao_liquido,\n    '{{ var(\"version\") }}' AS versao\nFROM\n    {{ ref('staging_ordem_pagamento') }} o\n{% if is_incremental() %}\n    WHERE\n        DATE(o.data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n{% endif %}", "language": "sql", "refs": [{"name": "ordem_pagamento_consorcio_dia", "package": null, "version": null}, {"name": "staging_ordem_pagamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.staging_ordem_pagamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_dia.sql", "compiled": true, "compiled_code": "\n\n-- depends_on: `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_dia`\nSELECT\n    o.data_ordem,\n    o.data_pagamento,\n    o.id_ordem_pagamento AS id_ordem_pagamento,\n    o.qtd_debito AS quantidade_transacao_debito,\n    o.valor_debito,\n    o.qtd_vendaabordo AS quantidade_transacao_especie,\n    o.valor_vendaabordo AS valor_especie,\n    o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.qtd_integracao AS quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito AS valor_rateio_credito,\n    o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito AS valor_rateio_debito,\n    (\n      o.qtd_debito\n      + o.qtd_vendaabordo\n      + o.qtd_gratuidade\n      + o.qtd_integracao\n    ) AS quantidade_total_transacao,\n    o.valor_bruto AS valor_total_transacao_bruto,\n    o.valor_taxa AS valor_desconto_taxa,\n    o.valor_liquido AS valor_total_transacao_liquido,\n    '' AS versao\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento` o\n\n    WHERE\n        DATE(o.data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.passageiros_tile_hora": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "passageiros_tile_hora", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/passageiros_tile_hora.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/passageiros_tile_hora.sql", "unique_id": "model.rj_smtr.passageiros_tile_hora", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "passageiros_tile_hora"], "alias": "passageiros_tile_hora", "checksum": {"name": "sha256", "checksum": "30c3e17ff3c75dc3cc2a4a3edcfac5d8e778883d192db5b5d9365e39169cf06b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela de contagem do n\u00famero de passageiros por hora. Agrega valores das tabelas transacao e transacao_riocard por: data, hora, modo, consorcio, operadora, servico, sentido, tipo_transacao e tile_id", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_smtr": {"name": "tipo_transacao_smtr", "description": "Tipo de transa\u00e7\u00e3o realizada no padr\u00e3o usado pela SMTR (Tarifa Cheia, Integra\u00e7\u00e3o e Gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_detalhe_smtr": {"name": "tipo_transacao_detalhe_smtr", "description": "Detalhamento sobre a transa\u00e7\u00e3o, de acordo com o tipo (Tarifa Cheia = tipo do pagamento, Gratuidade = tipo da gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tile_id": {"name": "tile_id", "description": "Identificador do hex\u00e1gono da geolocaliza\u00e7\u00e3o da transa\u00e7\u00e3o na tabela rj-smtr.br_rj_riodejaneiro_geo.h3_res9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_gratuidade": {"name": "tipo_gratuidade", "description": "Tipo da gratuidade (Estudante, PCD, S\u00eanior)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_pagamento": {"name": "tipo_pagamento", "description": "Tipo de pagamento utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiros": {"name": "quantidade_passageiros", "description": "Quantidade de transa\u00e7\u00f5es que aconteceram em determinada data e hora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8546245, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`passageiros_tile_hora`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\": \"date\",\n      \"granularity\":\"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n/*\nconsulta as parti\u00e7\u00f5es a serem atualizadas com base nas transa\u00e7\u00f5es capturadas entre date_range_start e date_range_end\ne as integra\u00e7\u00f5es capturadas entre date_range_start e date_range_end\n*/\n{% set transacao_table = ref('transacao') %}\n{% set transacao_riocard_table = ref('transacao_riocard') %}\n{% if execute %}\n  {% if is_incremental() %}\n    -- Transa\u00e7\u00f5es Ja\u00e9\n    {% set partitions_query %}\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        -- `{{ transacao_table.database }}.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n        `rj-smtr.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATETIME(last_modified_time, \"America/Sao_Paulo\") BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND (DATETIME(\"{{var('date_range_end')}}\"))\n\n      UNION DISTINCT\n\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        -- `{{ transacao_riocard_table.database }}.{{ transacao_riocard_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n        `rj-smtr.{{ transacao_riocard_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_riocard_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATETIME(last_modified_time, \"America/Sao_Paulo\") BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND DATETIME(\"{{var('date_range_end')}}\")\n\n    {% endset %}\n\n    {% set partitions = run_query(partitions_query) %}\n\n    {% set partition_list = partitions.columns[0].values() %}\n  {% endif %}\n{% endif %}\n\nSELECT\n  p.* EXCEPT(id_transacao, geo_point_transacao),\n  geo.tile_id,\n  COUNT(id_transacao) AS quantidade_passageiros,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  {{ ref(\"aux_passageiros_hora\") }} p\nJOIN\n  {{ ref(\"aux_h3_res9\") }} geo\nON\n  ST_CONTAINS(geo.geometry, geo_point_transacao)\nWHERE\n{% if is_incremental() %}\n  {% if partition_list|length > 0 %}\n    data IN ({{ partition_list|join(', ') }})\n  {% else %}\n    data = \"2000-01-01\"\n  {% endif %}\n{% else %}\n  data >= \"2023-07-19\"\n{% endif %}\nGROUP BY\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  tipo_transacao_smtr,\n  tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  tile_id", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}, {"name": "aux_passageiros_hora", "package": null, "version": null}, {"name": "aux_h3_res9", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard", "model.rj_smtr.aux_passageiros_hora", "model.rj_smtr.aux_h3_res9"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/passageiros_tile_hora.sql", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__aux_passageiros_hora as (\n\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )\n) /*\nconsulta as parti\u00e7\u00f5es a serem atualizadas com base nas transa\u00e7\u00f5es capturadas entre date_range_start e date_range_end\ne as integra\u00e7\u00f5es capturadas entre date_range_start e date_range_end\n*/\n\n\n\n  \n    -- Transa\u00e7\u00f5es Ja\u00e9\n    \n\n    \n\n    \n  \n\n\nSELECT\n  p.* EXCEPT(id_transacao, geo_point_transacao),\n  geo.tile_id,\n  COUNT(id_transacao) AS quantidade_passageiros,\n  '' AS versao\nFROM\n  __dbt__cte__aux_passageiros_hora p\nJOIN\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`aux_h3_res9` geo\nON\n  ST_CONTAINS(geo.geometry, geo_point_transacao)\nWHERE\n\n  \n    data = \"2000-01-01\"\n  \n\nGROUP BY\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  tipo_transacao_smtr,\n  tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  tile_id", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_passageiros_hora", "sql": " __dbt__cte__aux_passageiros_hora as (\n\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.matriz_integracao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "matriz_integracao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/matriz_integracao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/matriz_integracao.sql", "unique_id": "model.rj_smtr.matriz_integracao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "matriz_integracao"], "alias": "matriz_integracao", "checksum": {"name": "sha256", "checksum": "e5ac4fd97cd068e32dec1188cf2cbe97082bf9c210d74a7ad3f1a11f1d907142"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Matriz de reparti\u00e7\u00e3o tarif\u00e1ria de integra\u00e7\u00f5es v\u00e1lidas no sistema de transporte municipal", "columns": {"id_matriz_integracao": {"name": "id_matriz_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sequencia_integracao": {"name": "sequencia_integracao", "description": "Sequencia da transa\u00e7\u00e3o dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_rateio": {"name": "percentual_rateio", "description": "Percentual de rateio do valor total para a operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio_validade": {"name": "data_inicio_validade", "description": "Data de in\u00edcio da validade da matriz", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_fim_validade": {"name": "data_fim_validade", "description": "Data de fim da validade da matriz", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_bilhetagem"}, "created_at": 1727709587.8491051, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`matriz_integracao`", "raw_code": "{{\n    config(\n        materialized=\"table\",\n    )\n}}\n\nWITH matriz_melt AS (\n  SELECT\n    i.id,\n    im.sequencia_integracao,\n    im.id_tipo_modal,\n    im.perc_rateio,\n    i.dt_inicio_validade,\n    i.dt_fim_validade\n  FROM\n    {{ ref(\"staging_percentual_rateio_integracao\") }} i,\n    -- Transforma colunas com os dados de cada modo da integra\u00e7\u00e3o em linhas diferentes\n    UNNEST(\n      [\n        {% for n in range(var('quantidade_integracoes_max')) %}\n          STRUCT(\n            {% for column in ['id_tipo_modal' , 'perc_rateio'] %}\n              {{ column }}{{ '_integracao_t'~n if n > 0 else '_origem' }} AS {{ column }},\n            {% endfor %}\n            {{ n }} AS sequencia_integracao\n          ){% if not loop.last %},{% endif %}\n        {% endfor %}\n      ]\n    ) im\n)\nSELECT\n  i.id AS id_matriz_integracao,\n  i.sequencia_integracao,\n  m.modo,\n  i.perc_rateio AS percentual_rateio,\n  i.dt_inicio_validade AS data_inicio_validade,\n  i.dt_fim_validade AS data_fim_validade,\n  '{{ var(\"version\") }}' as versao\nFROM\n  matriz_melt i\nLEFT JOIN\n    {{ source(\"cadastro\", \"modos\") }} m\nON\n  i.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\nWHERE\n  i.id_tipo_modal IS NOT NULL", "language": "sql", "refs": [{"name": "staging_percentual_rateio_integracao", "package": null, "version": null}], "sources": [["cadastro", "modos"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.cadastro.modos", "model.rj_smtr.staging_percentual_rateio_integracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/matriz_integracao.sql", "compiled": true, "compiled_code": "\n\nWITH matriz_melt AS (\n  SELECT\n    i.id,\n    im.sequencia_integracao,\n    im.id_tipo_modal,\n    im.perc_rateio,\n    i.dt_inicio_validade,\n    i.dt_fim_validade\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`percentual_rateio_integracao` i,\n    -- Transforma colunas com os dados de cada modo da integra\u00e7\u00e3o em linhas diferentes\n    UNNEST(\n      [\n        \n          STRUCT(\n            \n              id_tipo_modal_origem AS id_tipo_modal,\n            \n              perc_rateio_origem AS perc_rateio,\n            \n            0 AS sequencia_integracao\n          ),\n        \n          STRUCT(\n            \n              id_tipo_modal_integracao_t1 AS id_tipo_modal,\n            \n              perc_rateio_integracao_t1 AS perc_rateio,\n            \n            1 AS sequencia_integracao\n          ),\n        \n          STRUCT(\n            \n              id_tipo_modal_integracao_t2 AS id_tipo_modal,\n            \n              perc_rateio_integracao_t2 AS perc_rateio,\n            \n            2 AS sequencia_integracao\n          ),\n        \n          STRUCT(\n            \n              id_tipo_modal_integracao_t3 AS id_tipo_modal,\n            \n              perc_rateio_integracao_t3 AS perc_rateio,\n            \n            3 AS sequencia_integracao\n          ),\n        \n          STRUCT(\n            \n              id_tipo_modal_integracao_t4 AS id_tipo_modal,\n            \n              perc_rateio_integracao_t4 AS perc_rateio,\n            \n            4 AS sequencia_integracao\n          )\n        \n      ]\n    ) im\n)\nSELECT\n  i.id AS id_matriz_integracao,\n  i.sequencia_integracao,\n  m.modo,\n  i.perc_rateio AS percentual_rateio,\n  i.dt_inicio_validade AS data_inicio_validade,\n  i.dt_fim_validade AS data_fim_validade,\n  '' as versao\nFROM\n  matriz_melt i\nLEFT JOIN\n    `rj-smtr`.`cadastro`.`modos` m\nON\n  i.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\nWHERE\n  i.id_tipo_modal IS NOT NULL", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_validador_van": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "gps_validador_van", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/gps_validador_van.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/gps_validador_van.sql", "unique_id": "model.rj_smtr.gps_validador_van", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "gps_validador_van"], "alias": "gps_validador_van", "checksum": {"name": "sha256", "checksum": "746fa46b90496f88ae6f78c4cdc89b7c32836b9b2220cf58ef80b83509d8acab"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela de posi\u00e7\u00f5es de GPS de todos os validadores da Ja\u00e9 instalados em vans, incluindo estado do equipamento (Aberto/Fechado), servi\u00e7o, sentido e ve\u00edculo associado e temperatura do ve\u00edculo.", "columns": {"modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do recebimento da transmiss\u00e3o do GPS (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do recebimento da transmiss\u00e3o do GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_gps": {"name": "datetime_gps", "description": "Data e hora do recebimento da transmiss\u00e3o do GPS em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora da captura do dado de GPS em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transmissao_gps": {"name": "id_transmissao_gps", "description": "Identificador \u00fanico da tabela de GPS dos validadores", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude do validador no momento da transmiss\u00e3o [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/5185403103447535390"]}, "longitude": {"name": "longitude", "description": "Longitude do validador no momento da transmiss\u00e3o [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/5185403103447535390"]}, "id_veiculo": {"name": "id_veiculo", "description": "[EM DESENVOLVIMENTO] C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Validador aberto ou fechado no momento da transmiss\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "temperatura": {"name": "temperatura", "description": "Temperatura do local, medida pelo sensor do validador (\u00baC)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_app": {"name": "versao_app", "description": "Vers\u00e3o do Software do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "tags": ["geolocalizacao"]}, "created_at": 1727709587.8527856, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador_van`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    tags=['geolocalizacao']\n  )\n}}\n\nSELECT\n    modo,\n    EXTRACT(DATE FROM datetime_gps) AS data,\n    EXTRACT(HOUR FROM datetime_gps) AS hora,\n    datetime_gps,\n    datetime_captura,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    -- s.servico,\n    servico_jae,\n    descricao_servico_jae,\n    id_veiculo,\n    id_validador,\n    id_transmissao_gps,\n    latitude,\n    longitude,\n    sentido,\n    estado_equipamento,\n    temperatura,\n    versao_app,\n    '{{ var(\"version\") }}' as versao\nFROM\n(\n    SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n    FROM\n        {{ ref(\"gps_validador_aux\") }}\n    {% if is_incremental() %}\n        WHERE\n            DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n            AND datetime_captura > DATETIME(\"{{var('date_range_start')}}\") AND datetime_captura <= DATETIME(\"{{var('date_range_end')}}\")\n    {% endif %}\n)\nWHERE\n    rn = 1\n    AND modo = \"Van\"", "language": "sql", "refs": [{"name": "gps_validador_aux", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.gps_validador_aux"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/gps_validador_van.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    modo,\n    EXTRACT(DATE FROM datetime_gps) AS data,\n    EXTRACT(HOUR FROM datetime_gps) AS hora,\n    datetime_gps,\n    datetime_captura,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    -- s.servico,\n    servico_jae,\n    descricao_servico_jae,\n    id_veiculo,\n    id_validador,\n    id_transmissao_gps,\n    latitude,\n    longitude,\n    sentido,\n    estado_equipamento,\n    temperatura,\n    versao_app,\n    '' as versao\nFROM\n(\n    SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador_aux`\n    \n        WHERE\n            DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n            AND datetime_captura > DATETIME(\"2022-01-01T00:00:00\") AND datetime_captura <= DATETIME(\"2022-01-01T01:00:00\")\n    \n)\nWHERE\n    rn = 1\n    AND modo = \"Van\"", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.integracao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "integracao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/integracao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/integracao.sql", "unique_id": "model.rj_smtr.integracao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "integracao"], "alias": "integracao", "checksum": {"name": "sha256", "checksum": "eeacb0cfd4d925894ebf3b4e166848a26a393e3e064eaf541b9e629853984f7b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_transacao", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela de integra\u00e7\u00f5es realizadas entre modos do sistema de transporte municipal, contendo os valores da reparti\u00e7\u00e3o tarif\u00e1ria (quando houver). [Dados em fase de teste]", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_processamento_integracao": {"name": "datetime_processamento_integracao", "description": "Data e hora de processamento da integra\u00e7\u00e3o em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora da captura da integra\u00e7\u00e3o em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_transacao": {"name": "datetime_transacao", "description": "Data e hora da transa\u00e7\u00e3o em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "intervalo_integracao": {"name": "intervalo_integracao", "description": "Tempo entre a perna atual da integra\u00e7\u00e3o e a anterior em minutos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao": {"name": "id_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sequencia_integracao": {"name": "sequencia_integracao", "description": "Sequ\u00eancia da transa\u00e7\u00e3o dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao_sequencia": {"name": "id_integracao_sequencia", "description": "Identificador \u00fanico da integra\u00e7\u00e3o + sequ\u00eancia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transacao": {"name": "id_transacao", "description": "Identificador \u00fanico da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_rateio": {"name": "percentual_rateio", "description": "Percentual de rateio do valor total para a operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_compensacao": {"name": "valor_rateio_compensacao", "description": "Valor a ser compensado pela ou \u00e0 operadora (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio": {"name": "valor_rateio", "description": "Valor real ganho pela operadora pela transa\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_transacao": {"name": "valor_transacao", "description": "Valor debitado do cart\u00e3o no momento da transa\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_transacao_total": {"name": "valor_transacao_total", "description": "Valor total das transa\u00e7\u00f5es da integra\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "texto_adicional": {"name": "texto_adicional", "description": "Observa\u00e7\u00e3o adicional", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_transacao"}, "created_at": 1727709587.7707043, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`integracao`", "raw_code": "-- depends_on: {{ ref('matriz_integracao') }}\n{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    unique_key='id_transacao',\n  )\n}}\n\nWITH integracao_transacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n    FROM\n      {{ ref(\"staging_integracao_transacao\") }}\n    {% if is_incremental() -%}\n      WHERE\n        DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n        AND timestamp_captura BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND DATETIME(\"{{var('date_range_end')}}\")\n    {%- endif %}\n  )\n  WHERE\n    rn = 1\n),\nintegracao_melt AS (\n    SELECT\n      EXTRACT(DATE FROM im.data_transacao) AS data,\n      EXTRACT(HOUR FROM im.data_transacao) AS hora,\n      i.data_inclusao AS datetime_inclusao,\n      i.data_processamento AS datetime_processamento_integracao,\n      i.timestamp_captura AS datetime_captura,\n      i.id AS id_integracao,\n      im.sequencia_integracao,\n      im.data_transacao AS datetime_transacao,\n      im.id_tipo_modal,\n      im.id_consorcio,\n      im.id_operadora,\n      im.id_linha,\n      im.id_transacao,\n      im.sentido,\n      im.perc_rateio,\n      im.valor_rateio_compensacao,\n      im.valor_rateio,\n      im.valor_transacao,\n      i.valor_transacao_total,\n      i.tx_adicional AS texto_adicional\n    FROM\n      integracao_transacao_deduplicada i,\n      -- Transforma colunas com os dados de cada transa\u00e7\u00e3o da integra\u00e7\u00e3o em linhas diferentes\n      UNNEST(\n        [\n          {% for n in range(var('quantidade_integracoes_max')) %}\n            STRUCT(\n              {% for column, column_config in var('colunas_integracao').items() %}\n                {% if column_config.select %}\n                  {{ column }}_t{{ n }} AS {{ column }},\n                {% endif %}\n              {% endfor %}\n              {{ n + 1 }} AS sequencia_integracao\n            ){% if not loop.last %},{% endif %}\n          {% endfor %}\n        ]\n      ) AS im\n),\nintegracao_rn AS (\n  SELECT\n    i.data,\n    i.hora,\n    i.datetime_processamento_integracao,\n    i.datetime_captura,\n    i.datetime_transacao,\n    TIMESTAMP_DIFF(\n      i.datetime_transacao,\n      LAG(i.datetime_transacao) OVER(PARTITION BY i.id_integracao ORDER BY sequencia_integracao),\n      MINUTE\n    ) AS intervalo_integracao,\n    i.id_integracao,\n    i.sequencia_integracao,\n    m.modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    i.id_linha AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    i.id_transacao,\n    i.sentido,\n    i.perc_rateio AS percentual_rateio,\n    i.valor_rateio_compensacao,\n    i.valor_rateio,\n    i.valor_transacao,\n    i.valor_transacao_total,\n    i.texto_adicional,\n    '{{ var(\"version\") }}' as versao,\n    ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_processamento_integracao DESC) AS rn\n  FROM\n    integracao_melt i\n  LEFT JOIN\n    {{ source(\"cadastro\", \"modos\") }} m\n  ON\n    i.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n  LEFT JOIN\n    {{ ref(\"operadoras\") }} AS do\n  ON\n    i.id_operadora = do.id_operadora_jae\n  LEFT JOIN\n    {{ ref(\"consorcios\") }} AS dc\n  ON\n    i.id_consorcio = dc.id_consorcio_jae\n  LEFT JOIN\n    {{ ref(\"staging_linha\") }} AS l\n  ON\n      i.id_linha = l.cd_linha\n  -- LEFT JOIN\n  --   {{ ref(\"servicos\") }} AS s\n  -- ON\n  --   i.id_linha = s.id_servico_jae\n  WHERE i.id_transacao IS NOT NULL\n),\nintegracoes_teste_invalidas AS (\n  SELECT DISTINCT\n    i.id_integracao\n  FROM\n    integracao_rn i\n  LEFT JOIN\n    {{ ref(\"staging_linha_sem_ressarcimento\") }} l\n  ON\n    i.id_servico_jae = l.id_linha\n  WHERE\n    l.id_linha IS NOT NULL\n    OR i.data < \"2023-07-17\"\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  integracao_rn\nWHERE rn = 1\nAND id_integracao NOT IN (SELECT id_integracao FROM integracoes_teste_invalidas)", "language": "sql", "refs": [{"name": "matriz_integracao", "package": null, "version": null}, {"name": "staging_integracao_transacao", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "staging_linha", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}, {"name": "staging_linha_sem_ressarcimento", "package": null, "version": null}], "sources": [["cadastro", "modos"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.cadastro.modos", "model.rj_smtr.matriz_integracao", "model.rj_smtr.staging_integracao_transacao", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios", "model.rj_smtr.staging_linha", "model.rj_smtr.servicos", "model.rj_smtr.staging_linha_sem_ressarcimento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/integracao.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`matriz_integracao`\n\n\nWITH integracao_transacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`integracao_transacao`\n    WHERE\n        DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n        AND timestamp_captura BETWEEN DATETIME(\"2022-01-01T00:00:00\") AND DATETIME(\"2022-01-01T01:00:00\")\n  )\n  WHERE\n    rn = 1\n),\nintegracao_melt AS (\n    SELECT\n      EXTRACT(DATE FROM im.data_transacao) AS data,\n      EXTRACT(HOUR FROM im.data_transacao) AS hora,\n      i.data_inclusao AS datetime_inclusao,\n      i.data_processamento AS datetime_processamento_integracao,\n      i.timestamp_captura AS datetime_captura,\n      i.id AS id_integracao,\n      im.sequencia_integracao,\n      im.data_transacao AS datetime_transacao,\n      im.id_tipo_modal,\n      im.id_consorcio,\n      im.id_operadora,\n      im.id_linha,\n      im.id_transacao,\n      im.sentido,\n      im.perc_rateio,\n      im.valor_rateio_compensacao,\n      im.valor_rateio,\n      im.valor_transacao,\n      i.valor_transacao_total,\n      i.tx_adicional AS texto_adicional\n    FROM\n      integracao_transacao_deduplicada i,\n      -- Transforma colunas com os dados de cada transa\u00e7\u00e3o da integra\u00e7\u00e3o em linhas diferentes\n      UNNEST(\n        [\n          \n            STRUCT(\n              \n                \n                  data_transacao_t0 AS data_transacao,\n                \n              \n                \n              \n                \n                  id_consorcio_t0 AS id_consorcio,\n                \n              \n                \n              \n                \n                  id_linha_t0 AS id_linha,\n                \n              \n                \n              \n                \n                  id_operadora_t0 AS id_operadora,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  id_tipo_modal_t0 AS id_tipo_modal,\n                \n              \n                \n                  id_transacao_t0 AS id_transacao,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  perc_rateio_t0 AS perc_rateio,\n                \n              \n                \n              \n                \n                  sentido_t0 AS sentido,\n                \n              \n                \n                  valor_rateio_compensacao_t0 AS valor_rateio_compensacao,\n                \n              \n                \n                  valor_rateio_t0 AS valor_rateio,\n                \n              \n                \n                  valor_tarifa_t0 AS valor_tarifa,\n                \n              \n                \n                  valor_transacao_t0 AS valor_transacao,\n                \n              \n                \n              \n              1 AS sequencia_integracao\n            ),\n          \n            STRUCT(\n              \n                \n                  data_transacao_t1 AS data_transacao,\n                \n              \n                \n              \n                \n                  id_consorcio_t1 AS id_consorcio,\n                \n              \n                \n              \n                \n                  id_linha_t1 AS id_linha,\n                \n              \n                \n              \n                \n                  id_operadora_t1 AS id_operadora,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  id_tipo_modal_t1 AS id_tipo_modal,\n                \n              \n                \n                  id_transacao_t1 AS id_transacao,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  perc_rateio_t1 AS perc_rateio,\n                \n              \n                \n              \n                \n                  sentido_t1 AS sentido,\n                \n              \n                \n                  valor_rateio_compensacao_t1 AS valor_rateio_compensacao,\n                \n              \n                \n                  valor_rateio_t1 AS valor_rateio,\n                \n              \n                \n                  valor_tarifa_t1 AS valor_tarifa,\n                \n              \n                \n                  valor_transacao_t1 AS valor_transacao,\n                \n              \n                \n              \n              2 AS sequencia_integracao\n            ),\n          \n            STRUCT(\n              \n                \n                  data_transacao_t2 AS data_transacao,\n                \n              \n                \n              \n                \n                  id_consorcio_t2 AS id_consorcio,\n                \n              \n                \n              \n                \n                  id_linha_t2 AS id_linha,\n                \n              \n                \n              \n                \n                  id_operadora_t2 AS id_operadora,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  id_tipo_modal_t2 AS id_tipo_modal,\n                \n              \n                \n                  id_transacao_t2 AS id_transacao,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  perc_rateio_t2 AS perc_rateio,\n                \n              \n                \n              \n                \n                  sentido_t2 AS sentido,\n                \n              \n                \n                  valor_rateio_compensacao_t2 AS valor_rateio_compensacao,\n                \n              \n                \n                  valor_rateio_t2 AS valor_rateio,\n                \n              \n                \n                  valor_tarifa_t2 AS valor_tarifa,\n                \n              \n                \n                  valor_transacao_t2 AS valor_transacao,\n                \n              \n                \n              \n              3 AS sequencia_integracao\n            ),\n          \n            STRUCT(\n              \n                \n                  data_transacao_t3 AS data_transacao,\n                \n              \n                \n              \n                \n                  id_consorcio_t3 AS id_consorcio,\n                \n              \n                \n              \n                \n                  id_linha_t3 AS id_linha,\n                \n              \n                \n              \n                \n                  id_operadora_t3 AS id_operadora,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  id_tipo_modal_t3 AS id_tipo_modal,\n                \n              \n                \n                  id_transacao_t3 AS id_transacao,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  perc_rateio_t3 AS perc_rateio,\n                \n              \n                \n              \n                \n                  sentido_t3 AS sentido,\n                \n              \n                \n                  valor_rateio_compensacao_t3 AS valor_rateio_compensacao,\n                \n              \n                \n                  valor_rateio_t3 AS valor_rateio,\n                \n              \n                \n                  valor_tarifa_t3 AS valor_tarifa,\n                \n              \n                \n                  valor_transacao_t3 AS valor_transacao,\n                \n              \n                \n              \n              4 AS sequencia_integracao\n            ),\n          \n            STRUCT(\n              \n                \n                  data_transacao_t4 AS data_transacao,\n                \n              \n                \n              \n                \n                  id_consorcio_t4 AS id_consorcio,\n                \n              \n                \n              \n                \n                  id_linha_t4 AS id_linha,\n                \n              \n                \n              \n                \n                  id_operadora_t4 AS id_operadora,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  id_tipo_modal_t4 AS id_tipo_modal,\n                \n              \n                \n                  id_transacao_t4 AS id_transacao,\n                \n              \n                \n              \n                \n              \n                \n              \n                \n                  perc_rateio_t4 AS perc_rateio,\n                \n              \n                \n              \n                \n                  sentido_t4 AS sentido,\n                \n              \n                \n                  valor_rateio_compensacao_t4 AS valor_rateio_compensacao,\n                \n              \n                \n                  valor_rateio_t4 AS valor_rateio,\n                \n              \n                \n                  valor_tarifa_t4 AS valor_tarifa,\n                \n              \n                \n                  valor_transacao_t4 AS valor_transacao,\n                \n              \n                \n              \n              5 AS sequencia_integracao\n            )\n          \n        ]\n      ) AS im\n),\nintegracao_rn AS (\n  SELECT\n    i.data,\n    i.hora,\n    i.datetime_processamento_integracao,\n    i.datetime_captura,\n    i.datetime_transacao,\n    TIMESTAMP_DIFF(\n      i.datetime_transacao,\n      LAG(i.datetime_transacao) OVER(PARTITION BY i.id_integracao ORDER BY sequencia_integracao),\n      MINUTE\n    ) AS intervalo_integracao,\n    i.id_integracao,\n    i.sequencia_integracao,\n    m.modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    i.id_linha AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    i.id_transacao,\n    i.sentido,\n    i.perc_rateio AS percentual_rateio,\n    i.valor_rateio_compensacao,\n    i.valor_rateio,\n    i.valor_transacao,\n    i.valor_transacao_total,\n    i.texto_adicional,\n    '' as versao,\n    ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_processamento_integracao DESC) AS rn\n  FROM\n    integracao_melt i\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`modos` m\n  ON\n    i.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` AS do\n  ON\n    i.id_operadora = do.id_operadora_jae\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` AS dc\n  ON\n    i.id_consorcio = dc.id_consorcio_jae\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` AS l\n  ON\n      i.id_linha = l.cd_linha\n  -- LEFT JOIN\n  --   `rj-smtr`.`cadastro`.`servicos` AS s\n  -- ON\n  --   i.id_linha = s.id_servico_jae\n  WHERE i.id_transacao IS NOT NULL\n),\nintegracoes_teste_invalidas AS (\n  SELECT DISTINCT\n    i.id_integracao\n  FROM\n    integracao_rn i\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento` l\n  ON\n    i.id_servico_jae = l.id_linha\n  WHERE\n    l.id_linha IS NOT NULL\n    OR i.data < \"2023-07-17\"\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  integracao_rn\nWHERE rn = 1\nAND id_integracao NOT IN (SELECT id_integracao FROM integracoes_teste_invalidas)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_consorcio_dia": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "ordem_pagamento_consorcio_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_dia.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_dia.sql", "unique_id": "model.rj_smtr.ordem_pagamento_consorcio_dia", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "ordem_pagamento_consorcio_dia"], "alias": "ordem_pagamento_consorcio_dia", "checksum": {"name": "sha256", "checksum": "95d9312baa95db4a39c48796a63b27baf424a1b4dbf912bdcda5a0975e576a20"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com os valores totais de pagamento da Ja\u00e9 agregados por consorcio e dia", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador da ordem pagamento no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_debito": {"name": "quantidade_transacao_debito", "description": "Quantidade de transa\u00e7\u00f5es feitas na modalidade d\u00e9bito", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_debito": {"name": "valor_debito", "description": "Valor total das transa\u00e7\u00f5es feitas na modalidade d\u00e9bito (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_especie": {"name": "quantidade_transacao_especie", "description": "Quantidade de transa\u00e7\u00f5es feitas em esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_especie": {"name": "valor_especie", "description": "Valor total das transa\u00e7\u00f5es feitas em esp\u00e9cie (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de transa\u00e7\u00f5es feitas com gratuidade", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_gratuidade": {"name": "valor_gratuidade", "description": "Valor total das transa\u00e7\u00f5es feitas com gratuidade (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_integracao": {"name": "quantidade_transacao_integracao", "description": "Quantidade de transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_integracao": {"name": "valor_integracao", "description": "Valor total das transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_credito": {"name": "quantidade_transacao_rateio_credito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no cr\u00e9dito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_credito": {"name": "valor_rateio_credito", "description": "Valor total creditado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_debito": {"name": "quantidade_transacao_rateio_debito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no d\u00e9bito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_debito": {"name": "valor_rateio_debito", "description": "Valor total debitado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_total_transacao": {"name": "quantidade_total_transacao", "description": "Quantidade total de transa\u00e7\u00f5es realizadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_bruto": {"name": "valor_total_transacao_bruto", "description": "Valor total das transa\u00e7\u00f5es realizadas (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_liquido": {"name": "valor_total_transacao_liquido", "description": "Valor total das transa\u00e7\u00f5es menos o valor_desconto_taxa (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_desconto_taxa": {"name": "valor_desconto_taxa", "description": "Valor da taxa descontado do valor total (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8627489, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data_ordem\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n-- depends_on: {{ ref(\"ordem_pagamento_consorcio_operador_dia\") }}\nSELECT\n    o.data_ordem,\n    dc.id_consorcio,\n    dc.consorcio,\n    o.id_ordem_pagamento AS id_ordem_pagamento,\n    o.qtd_debito AS quantidade_transacao_debito,\n    o.valor_debito,\n    o.qtd_vendaabordo AS quantidade_transacao_especie,\n    o.valor_vendaabordo AS valor_especie,\n    o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.qtd_integracao AS quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito AS valor_rateio_credito,\n    o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito AS valor_rateio_debito,\n    (\n      o.qtd_debito\n      + o.qtd_vendaabordo\n      + o.qtd_gratuidade\n      + o.qtd_integracao\n    ) AS quantidade_total_transacao,\n    o.valor_bruto AS valor_total_transacao_bruto,\n    o.valor_taxa AS valor_desconto_taxa,\n    o.valor_liquido AS valor_total_transacao_liquido,\n    '{{ var(\"version\") }}' AS versao\nFROM\n    {{ ref(\"staging_ordem_pagamento_consorcio\") }} o\nLEFT JOIN\n    {{ ref(\"consorcios\") }} dc\nON\n    o.id_consorcio = dc.id_consorcio_jae\n{% if is_incremental() %}\n    WHERE\n        DATE(o.data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n{% endif %}", "language": "sql", "refs": [{"name": "ordem_pagamento_consorcio_operador_dia", "package": null, "version": null}, {"name": "staging_ordem_pagamento_consorcio", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.staging_ordem_pagamento_consorcio", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_consorcio_dia.sql", "compiled": true, "compiled_code": "\n\n-- depends_on: `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_operador_dia`\nSELECT\n    o.data_ordem,\n    dc.id_consorcio,\n    dc.consorcio,\n    o.id_ordem_pagamento AS id_ordem_pagamento,\n    o.qtd_debito AS quantidade_transacao_debito,\n    o.valor_debito,\n    o.qtd_vendaabordo AS quantidade_transacao_especie,\n    o.valor_vendaabordo AS valor_especie,\n    o.qtd_gratuidade AS quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.qtd_integracao AS quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.qtd_rateio_credito AS quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito AS valor_rateio_credito,\n    o.qtd_rateio_debito AS quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito AS valor_rateio_debito,\n    (\n      o.qtd_debito\n      + o.qtd_vendaabordo\n      + o.qtd_gratuidade\n      + o.qtd_integracao\n    ) AS quantidade_total_transacao,\n    o.valor_bruto AS valor_total_transacao_bruto,\n    o.valor_taxa AS valor_desconto_taxa,\n    o.valor_liquido AS valor_total_transacao_liquido,\n    '' AS versao\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio` o\nLEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` dc\nON\n    o.id_consorcio = dc.id_consorcio_jae\n\n    WHERE\n        DATE(o.data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.transacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "transacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/transacao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/transacao.sql", "unique_id": "model.rj_smtr.transacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "transacao"], "alias": "transacao", "checksum": {"name": "sha256", "checksum": "a77fa671e4e002feaa93d6afec7960b249a9c0e756c25282140ba713a4fd1898"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com informa\u00e7\u00f5es da Ja\u00e9 sobre as transa\u00e7\u00f5es realizadas no sistema de transporte municipal", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_transacao": {"name": "datetime_transacao", "description": "Data e hora da transa\u00e7\u00e3o em GMT-3 (formato YYYY-MM-ddTHH:mm:ss.ssssss)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_processamento": {"name": "datetime_processamento", "description": "Data e hora de processamento da transa\u00e7\u00e3o em GMT-3 (formato YYYY-MM-ddTHH:mm:ss.ssssss)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Timestamp de captura em GMT-3 (formato YYYY-MM-dd HH:mm:ssTZD)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "Identificador \u00fanico do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_cliente": {"name": "id_cliente", "description": "Identificador \u00fanico do cliente [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/6071707853840412174/policyTags/1168584191451386864"]}, "hash_cliente": {"name": "hash_cliente", "description": "Hash identificador do cliente [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/6071707853840412174/policyTags/3266350367297582691"]}, "id_transacao": {"name": "id_transacao", "description": "Identificador \u00fanico da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_pagamento": {"name": "tipo_pagamento", "description": "Tipo de pagamento utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao": {"name": "tipo_transacao", "description": "Tipo de transa\u00e7\u00e3o realizada (a primeira perna de integra\u00e7\u00f5es s\u00e3o classificadas como tipo D\u00e9bito e n\u00e3o Integra\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_transacao_smtr": {"name": "tipo_transacao_smtr", "description": "Tipo de transa\u00e7\u00e3o realizada no padr\u00e3o usado pela SMTR (Integral, Integra\u00e7\u00e3o e Gratuidade)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_gratuidade": {"name": "tipo_gratuidade", "description": "Tipo da gratuidade (Estudante, PCD, S\u00eanior)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_tipo_integracao": {"name": "id_tipo_integracao", "description": "Tipo da integra\u00e7\u00e3o realizada (identificador relacionado \u00e0 matriz de integra\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao": {"name": "id_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Longitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "geo_point_transacao": {"name": "geo_point_transacao", "description": "Ponto geogr\u00e1fico do local da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tile_id": {"name": "tile_id", "description": "Identificador do hex\u00e1gono da geolocaliza\u00e7\u00e3o da transa\u00e7\u00e3o na tabela rj-smtr.br_rj_riodejaneiro_geo.h3_res9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_id": {"name": "stop_id", "description": "C\u00f3digo identificador do ponto de embarque (GTFS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_lat": {"name": "stop_lat", "description": "Latitude do ponto de embarque (GTFS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_lon": {"name": "stop_lon", "description": "Longitude do ponto de embarque (GTFS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_transacao": {"name": "valor_transacao", "description": "Valor debitado na transa\u00e7\u00e3o atual (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pagamento": {"name": "valor_pagamento", "description": "Valor valor a ser pago pela transa\u00e7\u00e3o (R$). Valores nulos indicam que o valor de pagamento para a transa\u00e7\u00e3o ainda n\u00e3o foi calculado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.7669406, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`", "raw_code": "-- depends_on: {{ ref('operadoras_contato') }}\n-- depends_on: {{ ref('servico_operadora') }}\n-- depends_on: {{ ref('transacao_riocard') }}\n{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n-- TODO: Usar vari\u00e1vel de run_date_hour para otimizar o numero de parti\u00e7\u00f5es lidas em staging\n{% set incremental_filter %}\n  DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n  AND timestamp_captura BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND DATETIME(\"{{var('date_range_end')}}\")\n{% endset %}\n\n{% set transacao_staging = ref('staging_transacao') %}\n{% set integracao_staging = ref('staging_integracao_transacao') %}\n{% if execute %}\n  {% if is_incremental() %}\n    {% set transacao_partitions_query %}\n      WITH particoes_integracao AS (\n        SELECT DISTINCT\n          CONCAT(\"'\", DATE(data_transacao), \"'\") AS data_transacao\n        FROM\n          {{ integracao_staging }},\n          UNNEST([\n            data_transacao_t0,\n            data_transacao_t1,\n            data_transacao_t2,\n            data_transacao_t3,\n            data_transacao_t4\n          ]) AS data_transacao\n        WHERE\n          {{ incremental_filter }}\n        ),\n        particoes_transacao AS (\n          SELECT DISTINCT\n            CONCAT(\"'\", DATE(data_transacao), \"'\") AS data_transacao\n          FROM\n            {{ transacao_staging }}\n          WHERE\n            {{ incremental_filter }}\n        )\n        SELECT\n          COALESCE(t.data_transacao, i.data_transacao) AS data_transacao\n        FROM\n          particoes_transacao t\n        FULL OUTER JOIN\n          particoes_integracao i\n        USING(data_transacao)\n        WHERE\n          COALESCE(t.data_transacao, i.data_transacao) IS NOT NULL\n    {% endset %}\n\n    {% set transacao_partitions = run_query(transacao_partitions_query) %}\n\n    {% set transacao_partition_list = transacao_partitions.columns[0].values() %}\n  {% endif %}\n{% endif %}\n\nWITH transacao AS (\n  SELECT\n    *\n  FROM\n    {{ transacao_staging }}\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao`\n  {% if is_incremental() %}\n      WHERE\n        {{ incremental_filter }}\n  {% endif %}\n),\ntipo_transacao AS (\n  SELECT\n    chave AS id_tipo_transacao,\n    valor AS tipo_transacao,\n  FROM\n    `rj-smtr.br_rj_riodejaneiro_bilhetagem.dicionario`\n  WHERE\n    id_tabela = \"transacao\"\n    AND coluna = \"id_tipo_transacao\"\n),\ngratuidade AS (\n  SELECT\n    CAST(id_cliente AS STRING) AS id_cliente,\n    tipo_gratuidade,\n    data_inicio_validade,\n    data_fim_validade\n  FROM\n    {{ ref(\"gratuidade_aux\") }}\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade_aux`\n  -- TODO: FILTRAR PARTI\u00c7\u00d5ES DE FORMA EFICIENTE\n),\ntipo_pagamento AS (\n  SELECT\n    chave AS id_tipo_pagamento,\n    valor AS tipo_pagamento\n  FROM\n    `rj-smtr.br_rj_riodejaneiro_bilhetagem.dicionario`\n  WHERE\n    id_tabela = \"transacao\"\n    AND coluna = \"id_tipo_pagamento\"\n),\nintegracao AS (\n  SELECT\n    id_transacao,\n    valor_rateio,\n    datetime_processamento_integracao\n  FROM\n    {{ ref(\"integracao\") }}\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.integracao`\n  {% if is_incremental() %}\n    WHERE\n    {% if transacao_partition_list|length > 0 %}\n      data IN ({{ transacao_partition_list|join(', ') }})\n    {% else %}\n      data = \"2000-01-01\"\n    {% endif %}\n  {% endif %}\n),\nnew_data AS (\n  SELECT\n    EXTRACT(DATE FROM data_transacao) AS data,\n    EXTRACT(HOUR FROM data_transacao) AS hora,\n    data_transacao AS datetime_transacao,\n    data_processamento AS datetime_processamento,\n    t.timestamp_captura AS datetime_captura,\n    m.modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    t.cd_linha AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    sentido,\n    CASE\n      WHEN m.modo = \"VLT\" THEN SUBSTRING(t.veiculo_id, 1, 3)\n      WHEN m.modo = \"BRT\" THEN NULL\n      ELSE t.veiculo_id\n    END AS id_veiculo,\n    t.numero_serie_validador AS id_validador,\n    COALESCE(t.id_cliente, t.pan_hash) AS id_cliente,\n    id AS id_transacao,\n    tp.tipo_pagamento,\n    tt.tipo_transacao,\n    g.tipo_gratuidade,\n    tipo_integracao AS id_tipo_integracao,\n    NULL AS id_integracao,\n    latitude_trx AS latitude,\n    longitude_trx AS longitude,\n    ST_GEOGPOINT(longitude_trx, latitude_trx) AS geo_point_transacao,\n    NULL AS stop_id,\n    NULL AS stop_lat,\n    NULL AS stop_lon,\n    valor_transacao\n  FROM\n    transacao AS t\n  LEFT JOIN\n    {{ source(\"cadastro\", \"modos\") }} m\n    -- `rj-smtr.cadastro.modos` m\n  ON\n    t.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n  LEFT JOIN\n    {{ ref(\"operadoras\") }} do\n    -- `rj-smtr.cadastro.operadoras` do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    {{ ref(\"consorcios\") }} dc\n    -- `rj-smtr.cadastro.consorcios` dc\n  ON\n    t.cd_consorcio = dc.id_consorcio_jae\n  LEFT JOIN\n    {{ ref(\"staging_linha\") }} l\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.linha` l\n  ON\n    t.cd_linha = l.cd_linha\n  -- LEFT JOIN\n  --     {{ ref(\"servicos\") }} AS s\n  -- ON\n  --     t.cd_linha = s.id_servico_jae\n  LEFT JOIN\n    tipo_transacao tt\n  ON\n    tt.id_tipo_transacao = t.tipo_transacao\n  LEFT JOIN\n    tipo_pagamento tp\n  ON\n    t.id_tipo_midia = tp.id_tipo_pagamento\n  LEFT JOIN\n    gratuidade g\n  ON\n    t.tipo_transacao = \"21\"\n    AND t.id_cliente = g.id_cliente\n    AND t.data_transacao >= g.data_inicio_validade\n    AND (t.data_transacao < g.data_fim_validade OR g.data_fim_validade IS NULL)\n  LEFT JOIN\n    {{ ref(\"staging_linha_sem_ressarcimento\") }} lsr\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento` lsr\n  ON\n    t.cd_linha = lsr.id_linha\n  WHERE\n    lsr.id_linha IS NULL\n    AND DATE(data_transacao) >= \"2023-07-17\"\n),\ncomplete_partitions AS (\n  SELECT\n    data,\n    hora,\n    datetime_transacao,\n    datetime_processamento,\n    datetime_captura,\n    modo,\n    id_consorcio,\n    consorcio,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    servico_jae,\n    descricao_servico_jae,\n    sentido,\n    id_veiculo,\n    id_validador,\n    id_cliente,\n    id_transacao,\n    tipo_pagamento,\n    tipo_transacao,\n    tipo_gratuidade,\n    id_tipo_integracao,\n    id_integracao,\n    latitude,\n    longitude,\n    geo_point_transacao,\n    stop_id,\n    stop_lat,\n    stop_lon,\n    valor_transacao,\n    0 AS priority\n  FROM\n    new_data\n\n  {% if is_incremental() %}\n    UNION ALL\n\n    SELECT\n      data,\n      hora,\n      datetime_transacao,\n      datetime_processamento,\n      datetime_captura,\n      modo,\n      id_consorcio,\n      consorcio,\n      id_operadora,\n      operadora,\n      id_servico_jae,\n      servico_jae,\n      descricao_servico_jae,\n      sentido,\n      id_veiculo,\n      id_validador,\n      id_cliente,\n      id_transacao,\n      tipo_pagamento,\n      tipo_transacao,\n      tipo_gratuidade,\n      id_tipo_integracao,\n      id_integracao,\n      latitude,\n      longitude,\n      geo_point_transacao,\n      stop_id,\n      stop_lat,\n      stop_lon,\n      valor_transacao,\n      1 AS priority\n    FROM\n      {{ this }}\n    WHERE\n      {% if transacao_partition_list|length > 0 %}\n        data IN ({{ transacao_partition_list|join(', ') }})\n      {% else %}\n        data = \"2000-01-01\"\n      {% endif %}\n  {% endif %}\n),\ntransacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_captura DESC, priority) AS rn\n    FROM\n      complete_partitions\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  t.data,\n  t.hora,\n  t.datetime_transacao,\n  t.datetime_processamento,\n  t.datetime_captura,\n  t.modo,\n  t.id_consorcio,\n  t.consorcio,\n  t.id_operadora,\n  t.operadora,\n  t.id_servico_jae,\n  t.servico_jae,\n  t.descricao_servico_jae,\n  t.sentido,\n  t.id_veiculo,\n  t.id_validador,\n  t.id_cliente,\n  SHA256(t.id_cliente) AS hash_cliente,\n  t.id_transacao,\n  t.tipo_pagamento,\n  t.tipo_transacao,\n  CASE\n    WHEN t.tipo_transacao = \"Integra\u00e7\u00e3o\" OR i.id_transacao IS NOT NULL THEN \"Integra\u00e7\u00e3o\"\n    WHEN t.tipo_transacao IN (\"D\u00e9bito\", \"Botoeira\") THEN \"Integral\"\n    ELSE t.tipo_transacao\n  END AS tipo_transacao_smtr,\n  CASE\n    WHEN t.tipo_transacao = \"Gratuidade\" AND t.tipo_gratuidade IS NULL THEN \"N\u00e3o Identificado\"\n    ELSE t.tipo_gratuidade\n  END AS tipo_gratuidade,\n  t.id_tipo_integracao,\n  t.id_integracao,\n  t.latitude,\n  t.longitude,\n  t.geo_point_transacao,\n  t.stop_id,\n  t.stop_lat,\n  t.stop_lon,\n  t.valor_transacao,\n  CASE\n    WHEN\n      i.id_transacao IS NOT NULL\n      OR DATE(t.datetime_processamento) < (SELECT MAX(data_ordem) FROM {{ ref(\"ordem_pagamento_dia\") }})\n      THEN COALESCE(i.valor_rateio, t.valor_transacao) * 0.96\n  END AS valor_pagamento,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  transacao_deduplicada t\nLEFT JOIN\n  integracao i\nUSING(id_transacao)", "language": "sql", "refs": [{"name": "operadoras_contato", "package": null, "version": null}, {"name": "servico_operadora", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}, {"name": "staging_transacao", "package": null, "version": null}, {"name": "staging_integracao_transacao", "package": null, "version": null}, {"name": "gratuidade_aux", "package": null, "version": null}, {"name": "integracao", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "staging_linha", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}, {"name": "staging_linha_sem_ressarcimento", "package": null, "version": null}, {"name": "ordem_pagamento_dia", "package": null, "version": null}], "sources": [["cadastro", "modos"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["source.rj_smtr.cadastro.modos", "model.rj_smtr.operadoras_contato", "model.rj_smtr.servico_operadora", "model.rj_smtr.transacao_riocard", "model.rj_smtr.staging_transacao", "model.rj_smtr.staging_integracao_transacao", "model.rj_smtr.gratuidade_aux", "model.rj_smtr.integracao", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios", "model.rj_smtr.staging_linha", "model.rj_smtr.servicos", "model.rj_smtr.staging_linha_sem_ressarcimento", "model.rj_smtr.ordem_pagamento_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/transacao.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`cadastro`.`operadoras_contato`\n-- depends_on: `rj-smtr`.`cadastro`.`servico_operadora`\n-- depends_on: `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\n\n\n-- TODO: Usar vari\u00e1vel de run_date_hour para otimizar o numero de parti\u00e7\u00f5es lidas em staging\n\n\n\n\n\n  \n    \n\n    \n\n    \n  \n\n\nWITH transacao AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao`\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao`\n  \n      WHERE\n        \n  DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n  AND timestamp_captura BETWEEN DATETIME(\"2022-01-01T00:00:00\") AND DATETIME(\"2022-01-01T01:00:00\")\n\n  \n),\ntipo_transacao AS (\n  SELECT\n    chave AS id_tipo_transacao,\n    valor AS tipo_transacao,\n  FROM\n    `rj-smtr.br_rj_riodejaneiro_bilhetagem.dicionario`\n  WHERE\n    id_tabela = \"transacao\"\n    AND coluna = \"id_tipo_transacao\"\n),\ngratuidade AS (\n  SELECT\n    CAST(id_cliente AS STRING) AS id_cliente,\n    tipo_gratuidade,\n    data_inicio_validade,\n    data_fim_validade\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade_aux`\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade_aux`\n  -- TODO: FILTRAR PARTI\u00c7\u00d5ES DE FORMA EFICIENTE\n),\ntipo_pagamento AS (\n  SELECT\n    chave AS id_tipo_pagamento,\n    valor AS tipo_pagamento\n  FROM\n    `rj-smtr.br_rj_riodejaneiro_bilhetagem.dicionario`\n  WHERE\n    id_tabela = \"transacao\"\n    AND coluna = \"id_tipo_pagamento\"\n),\nintegracao AS (\n  SELECT\n    id_transacao,\n    valor_rateio,\n    datetime_processamento_integracao\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`integracao`\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.integracao`\n  \n    WHERE\n    \n      data = \"2000-01-01\"\n    \n  \n),\nnew_data AS (\n  SELECT\n    EXTRACT(DATE FROM data_transacao) AS data,\n    EXTRACT(HOUR FROM data_transacao) AS hora,\n    data_transacao AS datetime_transacao,\n    data_processamento AS datetime_processamento,\n    t.timestamp_captura AS datetime_captura,\n    m.modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    t.cd_linha AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    sentido,\n    CASE\n      WHEN m.modo = \"VLT\" THEN SUBSTRING(t.veiculo_id, 1, 3)\n      WHEN m.modo = \"BRT\" THEN NULL\n      ELSE t.veiculo_id\n    END AS id_veiculo,\n    t.numero_serie_validador AS id_validador,\n    COALESCE(t.id_cliente, t.pan_hash) AS id_cliente,\n    id AS id_transacao,\n    tp.tipo_pagamento,\n    tt.tipo_transacao,\n    g.tipo_gratuidade,\n    tipo_integracao AS id_tipo_integracao,\n    NULL AS id_integracao,\n    latitude_trx AS latitude,\n    longitude_trx AS longitude,\n    ST_GEOGPOINT(longitude_trx, latitude_trx) AS geo_point_transacao,\n    NULL AS stop_id,\n    NULL AS stop_lat,\n    NULL AS stop_lon,\n    valor_transacao\n  FROM\n    transacao AS t\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`modos` m\n    -- `rj-smtr.cadastro.modos` m\n  ON\n    t.id_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` do\n    -- `rj-smtr.cadastro.operadoras` do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` dc\n    -- `rj-smtr.cadastro.consorcios` dc\n  ON\n    t.cd_consorcio = dc.id_consorcio_jae\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` l\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.linha` l\n  ON\n    t.cd_linha = l.cd_linha\n  -- LEFT JOIN\n  --     `rj-smtr`.`cadastro`.`servicos` AS s\n  -- ON\n  --     t.cd_linha = s.id_servico_jae\n  LEFT JOIN\n    tipo_transacao tt\n  ON\n    tt.id_tipo_transacao = t.tipo_transacao\n  LEFT JOIN\n    tipo_pagamento tp\n  ON\n    t.id_tipo_midia = tp.id_tipo_pagamento\n  LEFT JOIN\n    gratuidade g\n  ON\n    t.tipo_transacao = \"21\"\n    AND t.id_cliente = g.id_cliente\n    AND t.data_transacao >= g.data_inicio_validade\n    AND (t.data_transacao < g.data_fim_validade OR g.data_fim_validade IS NULL)\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento` lsr\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento` lsr\n  ON\n    t.cd_linha = lsr.id_linha\n  WHERE\n    lsr.id_linha IS NULL\n    AND DATE(data_transacao) >= \"2023-07-17\"\n),\ncomplete_partitions AS (\n  SELECT\n    data,\n    hora,\n    datetime_transacao,\n    datetime_processamento,\n    datetime_captura,\n    modo,\n    id_consorcio,\n    consorcio,\n    id_operadora,\n    operadora,\n    id_servico_jae,\n    servico_jae,\n    descricao_servico_jae,\n    sentido,\n    id_veiculo,\n    id_validador,\n    id_cliente,\n    id_transacao,\n    tipo_pagamento,\n    tipo_transacao,\n    tipo_gratuidade,\n    id_tipo_integracao,\n    id_integracao,\n    latitude,\n    longitude,\n    geo_point_transacao,\n    stop_id,\n    stop_lat,\n    stop_lon,\n    valor_transacao,\n    0 AS priority\n  FROM\n    new_data\n\n  \n    UNION ALL\n\n    SELECT\n      data,\n      hora,\n      datetime_transacao,\n      datetime_processamento,\n      datetime_captura,\n      modo,\n      id_consorcio,\n      consorcio,\n      id_operadora,\n      operadora,\n      id_servico_jae,\n      servico_jae,\n      descricao_servico_jae,\n      sentido,\n      id_veiculo,\n      id_validador,\n      id_cliente,\n      id_transacao,\n      tipo_pagamento,\n      tipo_transacao,\n      tipo_gratuidade,\n      id_tipo_integracao,\n      id_integracao,\n      latitude,\n      longitude,\n      geo_point_transacao,\n      stop_id,\n      stop_lat,\n      stop_lon,\n      valor_transacao,\n      1 AS priority\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\n    WHERE\n      \n        data = \"2000-01-01\"\n      \n  \n),\ntransacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_captura DESC, priority) AS rn\n    FROM\n      complete_partitions\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  t.data,\n  t.hora,\n  t.datetime_transacao,\n  t.datetime_processamento,\n  t.datetime_captura,\n  t.modo,\n  t.id_consorcio,\n  t.consorcio,\n  t.id_operadora,\n  t.operadora,\n  t.id_servico_jae,\n  t.servico_jae,\n  t.descricao_servico_jae,\n  t.sentido,\n  t.id_veiculo,\n  t.id_validador,\n  t.id_cliente,\n  SHA256(t.id_cliente) AS hash_cliente,\n  t.id_transacao,\n  t.tipo_pagamento,\n  t.tipo_transacao,\n  CASE\n    WHEN t.tipo_transacao = \"Integra\u00e7\u00e3o\" OR i.id_transacao IS NOT NULL THEN \"Integra\u00e7\u00e3o\"\n    WHEN t.tipo_transacao IN (\"D\u00e9bito\", \"Botoeira\") THEN \"Integral\"\n    ELSE t.tipo_transacao\n  END AS tipo_transacao_smtr,\n  CASE\n    WHEN t.tipo_transacao = \"Gratuidade\" AND t.tipo_gratuidade IS NULL THEN \"N\u00e3o Identificado\"\n    ELSE t.tipo_gratuidade\n  END AS tipo_gratuidade,\n  t.id_tipo_integracao,\n  t.id_integracao,\n  t.latitude,\n  t.longitude,\n  t.geo_point_transacao,\n  t.stop_id,\n  t.stop_lat,\n  t.stop_lon,\n  t.valor_transacao,\n  CASE\n    WHEN\n      i.id_transacao IS NOT NULL\n      OR DATE(t.datetime_processamento) < (SELECT MAX(data_ordem) FROM `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_dia`)\n      THEN COALESCE(i.valor_rateio, t.valor_transacao) * 0.96\n  END AS valor_pagamento,\n  '' AS versao\nFROM\n  transacao_deduplicada t\nLEFT JOIN\n  integracao i\nUSING(id_transacao)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_servico_operador_dia": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "ordem_pagamento_servico_operador_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/ordem_pagamento_servico_operador_dia.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_servico_operador_dia.sql", "unique_id": "model.rj_smtr.ordem_pagamento_servico_operador_dia", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "ordem_pagamento_servico_operador_dia"], "alias": "ordem_pagamento_servico_operador_dia", "checksum": {"name": "sha256", "checksum": "b61862087fe8fbcc51c646e6295ae4231b3f1cab4410dfcee060347ccf4f9a3d"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador da ordem pagamento no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_ressarcimento": {"name": "id_ordem_ressarcimento", "description": "Identificador da ordem ressarcimento no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_debito": {"name": "quantidade_transacao_debito", "description": "Quantidade de transa\u00e7\u00f5es feitas na modalidade d\u00e9bito", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_debito": {"name": "valor_debito", "description": "Valor total das transa\u00e7\u00f5es feitas na modalidade d\u00e9bito (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_especie": {"name": "quantidade_transacao_especie", "description": "Quantidade de transa\u00e7\u00f5es feitas em esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_especie": {"name": "valor_especie", "description": "Valor total das transa\u00e7\u00f5es feitas em esp\u00e9cie (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de transa\u00e7\u00f5es feitas com gratuidade", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_gratuidade": {"name": "valor_gratuidade", "description": "Valor total das transa\u00e7\u00f5es feitas com gratuidade (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_integracao": {"name": "quantidade_transacao_integracao", "description": "Quantidade de transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_integracao": {"name": "valor_integracao", "description": "Valor total das transa\u00e7\u00f5es feitas com integra\u00e7\u00e3o (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_credito": {"name": "quantidade_transacao_rateio_credito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no cr\u00e9dito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_credito": {"name": "valor_rateio_credito", "description": "Valor total creditado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_rateio_debito": {"name": "quantidade_transacao_rateio_debito", "description": "Quantidade total de transa\u00e7\u00f5es consideradas no d\u00e9bito da reparti\u00e7\u00e3o tarif\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_rateio_debito": {"name": "valor_rateio_debito", "description": "Valor total debitado em decorr\u00eancia da reparti\u00e7\u00e3o tarif\u00e1ria (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_total_transacao": {"name": "quantidade_total_transacao", "description": "Quantidade total de transa\u00e7\u00f5es realizadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_bruto": {"name": "valor_total_transacao_bruto", "description": "Valor total das transa\u00e7\u00f5es realizadas (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_desconto_taxa": {"name": "valor_desconto_taxa", "description": "Valor da taxa descontado do valor total (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_liquido": {"name": "valor_total_transacao_liquido", "description": "Valor total das transa\u00e7\u00f5es menos o valor_desconto_taxa (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_total_transacao_captura": {"name": "quantidade_total_transacao_captura", "description": "Quantidade total de transa\u00e7\u00f5es calculada pela captura de transa\u00e7\u00f5es", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_transacao_captura": {"name": "valor_total_transacao_captura", "description": "Valor total das transa\u00e7\u00f5es realizadas calculada pela captura de transa\u00e7\u00f5es (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8693187, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_servico_operador_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data_ordem\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\nWITH ordem_pagamento AS (\n    SELECT\n        r.data_ordem,\n        dc.id_consorcio,\n        dc.consorcio,\n        do.id_operadora,\n        do.operadora,\n        r.id_linha AS id_servico_jae,\n        -- s.servico,\n        l.nr_linha AS servico_jae,\n        l.nm_linha AS descricao_servico_jae,\n        r.id_ordem_pagamento AS id_ordem_pagamento,\n        r.id_ordem_ressarcimento AS id_ordem_ressarcimento,\n        r.qtd_debito AS quantidade_transacao_debito,\n        r.valor_debito,\n        r.qtd_vendaabordo AS quantidade_transacao_especie,\n        r.valor_vendaabordo AS valor_especie,\n        r.qtd_gratuidade AS quantidade_transacao_gratuidade,\n        r.valor_gratuidade,\n        r.qtd_integracao AS quantidade_transacao_integracao,\n        r.valor_integracao,\n        COALESCE(rat.qtd_rateio_compensacao_credito_total, r.qtd_rateio_credito) AS quantidade_transacao_rateio_credito,\n        COALESCE(rat.valor_rateio_compensacao_credito_total, r.valor_rateio_credito) AS valor_rateio_credito,\n        COALESCE(rat.qtd_rateio_compensacao_debito_total, r.qtd_rateio_debito) AS quantidade_transacao_rateio_debito,\n        COALESCE(rat.valor_rateio_compensacao_debito_total, r.valor_rateio_debito) AS valor_rateio_debito,\n        (\n            r.qtd_debito\n            + r.qtd_vendaabordo\n            + r.qtd_gratuidade\n            + r.qtd_integracao\n        ) AS quantidade_total_transacao,\n        r.valor_bruto AS valor_total_transacao_bruto,\n        r.valor_taxa AS valor_desconto_taxa,\n        r.valor_liquido AS valor_total_transacao_liquido\n    FROM\n        {{ ref(\"staging_ordem_ressarcimento\") }} r\n    LEFT JOIN\n        {{ ref(\"staging_ordem_rateio\") }} rat\n    USING(data_ordem, id_consorcio, id_operadora, id_linha)\n    LEFT JOIN\n        {{ ref(\"operadoras\") }} AS do\n    ON\n        r.id_operadora = do.id_operadora_jae\n    LEFT JOIN\n        {{ ref(\"consorcios\") }} AS dc\n    ON\n        r.id_consorcio = dc.id_consorcio_jae\n    LEFT JOIN\n        {{ ref(\"staging_linha\") }} AS l\n    ON\n        r.id_linha = l.cd_linha\n    -- LEFT JOIN\n    --     {{ ref(\"servicos\") }} AS s\n    -- ON\n    --     r.id_linha = s.id_servico_jae\n    {% if is_incremental() %}\n        WHERE\n            DATE(r.data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n    {% endif %}\n)\nSELECT\n    o.data_ordem,\n    o.id_consorcio,\n    o.consorcio,\n    o.id_operadora,\n    o.operadora,\n    o.id_servico_jae,\n    o.servico_jae,\n    o.descricao_servico_jae,\n    o.id_ordem_pagamento,\n    o.id_ordem_ressarcimento,\n    o.quantidade_transacao_debito,\n    o.valor_debito,\n    o.quantidade_transacao_especie,\n    o.valor_especie,\n    o.quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito,\n    o.quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto + o.valor_rateio_debito + o.valor_rateio_credito AS valor_total_transacao_bruto,\n    o.valor_desconto_taxa,\n    o.valor_total_transacao_liquido + o.valor_rateio_debito + o.valor_rateio_credito AS valor_total_transacao_liquido,\n    '{{ var(\"version\") }}' AS versao\nFROM\n    ordem_pagamento o", "language": "sql", "refs": [{"name": "staging_ordem_ressarcimento", "package": null, "version": null}, {"name": "staging_ordem_rateio", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "staging_linha", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_ordem_ressarcimento", "model.rj_smtr.staging_ordem_rateio", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios", "model.rj_smtr.staging_linha", "model.rj_smtr.servicos"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/ordem_pagamento_servico_operador_dia.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_pagamento AS (\n    SELECT\n        r.data_ordem,\n        dc.id_consorcio,\n        dc.consorcio,\n        do.id_operadora,\n        do.operadora,\n        r.id_linha AS id_servico_jae,\n        -- s.servico,\n        l.nr_linha AS servico_jae,\n        l.nm_linha AS descricao_servico_jae,\n        r.id_ordem_pagamento AS id_ordem_pagamento,\n        r.id_ordem_ressarcimento AS id_ordem_ressarcimento,\n        r.qtd_debito AS quantidade_transacao_debito,\n        r.valor_debito,\n        r.qtd_vendaabordo AS quantidade_transacao_especie,\n        r.valor_vendaabordo AS valor_especie,\n        r.qtd_gratuidade AS quantidade_transacao_gratuidade,\n        r.valor_gratuidade,\n        r.qtd_integracao AS quantidade_transacao_integracao,\n        r.valor_integracao,\n        COALESCE(rat.qtd_rateio_compensacao_credito_total, r.qtd_rateio_credito) AS quantidade_transacao_rateio_credito,\n        COALESCE(rat.valor_rateio_compensacao_credito_total, r.valor_rateio_credito) AS valor_rateio_credito,\n        COALESCE(rat.qtd_rateio_compensacao_debito_total, r.qtd_rateio_debito) AS quantidade_transacao_rateio_debito,\n        COALESCE(rat.valor_rateio_compensacao_debito_total, r.valor_rateio_debito) AS valor_rateio_debito,\n        (\n            r.qtd_debito\n            + r.qtd_vendaabordo\n            + r.qtd_gratuidade\n            + r.qtd_integracao\n        ) AS quantidade_total_transacao,\n        r.valor_bruto AS valor_total_transacao_bruto,\n        r.valor_taxa AS valor_desconto_taxa,\n        r.valor_liquido AS valor_total_transacao_liquido\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_ressarcimento` r\n    LEFT JOIN\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_rateio` rat\n    USING(data_ordem, id_consorcio, id_operadora, id_linha)\n    LEFT JOIN\n        `rj-smtr`.`cadastro`.`operadoras` AS do\n    ON\n        r.id_operadora = do.id_operadora_jae\n    LEFT JOIN\n        `rj-smtr`.`cadastro`.`consorcios` AS dc\n    ON\n        r.id_consorcio = dc.id_consorcio_jae\n    LEFT JOIN\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` AS l\n    ON\n        r.id_linha = l.cd_linha\n    -- LEFT JOIN\n    --     `rj-smtr`.`cadastro`.`servicos` AS s\n    -- ON\n    --     r.id_linha = s.id_servico_jae\n    \n        WHERE\n            DATE(r.data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n    \n)\nSELECT\n    o.data_ordem,\n    o.id_consorcio,\n    o.consorcio,\n    o.id_operadora,\n    o.operadora,\n    o.id_servico_jae,\n    o.servico_jae,\n    o.descricao_servico_jae,\n    o.id_ordem_pagamento,\n    o.id_ordem_ressarcimento,\n    o.quantidade_transacao_debito,\n    o.valor_debito,\n    o.quantidade_transacao_especie,\n    o.valor_especie,\n    o.quantidade_transacao_gratuidade,\n    o.valor_gratuidade,\n    o.quantidade_transacao_integracao,\n    o.valor_integracao,\n    o.quantidade_transacao_rateio_credito,\n    o.valor_rateio_credito,\n    o.quantidade_transacao_rateio_debito,\n    o.valor_rateio_debito,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto + o.valor_rateio_debito + o.valor_rateio_credito AS valor_total_transacao_bruto,\n    o.valor_desconto_taxa,\n    o.valor_total_transacao_liquido + o.valor_rateio_debito + o.valor_rateio_credito AS valor_total_transacao_liquido,\n    '' AS versao\nFROM\n    ordem_pagamento o", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.transacao_riocard": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem", "name": "transacao_riocard", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem/transacao_riocard.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem/transacao_riocard.sql", "unique_id": "model.rj_smtr.transacao_riocard", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem", "transacao_riocard"], "alias": "transacao_riocard", "checksum": {"name": "sha256", "checksum": "30f5f36150fb6cf1b7ca98128970f39a99a5d76d9946756d389e895afc884c5a"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com as transa\u00e7\u00f5es feitas com RioCard que foram registradas pelo validador da Ja\u00e9.", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_transacao": {"name": "datetime_transacao", "description": "Data e hora da transa\u00e7\u00e3o em GMT-3 (formato YYYY-MM-ddTHH:mm:ss.ssssss)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_processamento": {"name": "datetime_processamento", "description": "Data e hora de processamento da transa\u00e7\u00e3o em GMT-3 (formato YYYY-MM-ddTHH:mm:ss.ssssss)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Timestamp de captura em GMT-3 (formato YYYY-MM-dd HH:mm:ssTZD)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "Identificador \u00fanico do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transacao": {"name": "id_transacao", "description": "Identificador \u00fanico da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Longitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "geo_point_transacao": {"name": "geo_point_transacao", "description": "Ponto geogr\u00e1fico do local da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_transacao": {"name": "valor_transacao", "description": "Valor debitado na transa\u00e7\u00e3o atual (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_bilhetagem/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_bilhetagem", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8701537, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\n{% set incremental_filter %}\n  DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n  AND timestamp_captura BETWEEN DATETIME(\"{{var('date_range_start')}}\") AND DATETIME(\"{{var('date_range_end')}}\")\n{% endset %}\n\n{% set transacao_staging = ref('staging_transacao_riocard') %}\n{% if execute and is_incremental() %}\n  {% set transacao_partitions_query %}\n    SELECT DISTINCT\n      CONCAT(\"'\", DATE(data_transacao), \"'\") AS data_transacao\n    FROM\n      {{ transacao_staging }}\n    WHERE\n      {{ incremental_filter }}\n  {% endset %}\n\n  {% set transacao_partitions = run_query(transacao_partitions_query).columns[0].values() %}\n{% endif %}\n\nWITH staging_transacao AS (\n  SELECT\n    *\n  FROM\n    {{ transacao_staging }}\n  {% if is_incremental() %}\n    WHERE\n      {{ incremental_filter }}\n  {% endif %}\n),\nnovos_dados AS (\n  SELECT\n    EXTRACT(DATE FROM t.data_transacao) AS data,\n    EXTRACT(HOUR FROM t.data_transacao) AS hora,\n    t.data_transacao AS datetime_transacao,\n    t.data_processamento AS datetime_processamento,\n    t.timestamp_captura AS datetime_captura,\n    COALESCE(do.modo, dc.modo) AS modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    t.cd_linha AS id_servico_jae,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    t.sentido,\n    CASE\n      WHEN do.modo = \"VLT\" THEN SUBSTRING(t.veiculo_id, 1, 3)\n      WHEN do.modo = \"BRT\" THEN NULL\n      ELSE t.veiculo_id\n    END AS id_veiculo,\n    t.numero_serie_validador AS id_validador,\n    t.id AS id_transacao,\n    t.latitude_trx AS latitude,\n    t.longitude_trx AS longitude,\n    ST_GEOGPOINT(t.longitude_trx, t.latitude_trx) AS geo_point_transacao,\n    t.valor_transacao\n  FROM\n    staging_transacao t\n  LEFT JOIN\n    {{ ref(\"operadoras\") }} do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    {{ ref(\"staging_linha\") }} l\n  ON\n    t.cd_linha = l.cd_linha\n  LEFT JOIN\n    {{ ref(\"staging_linha_consorcio\") }} lc\n  ON\n    t.cd_linha = lc.cd_linha\n    AND (\n      t.data_transacao BETWEEN lc.dt_inicio_validade AND lc.dt_fim_validade\n      OR lc.dt_fim_validade IS NULL\n    )\n  LEFT JOIN\n    {{ ref(\"consorcios\") }} dc\n  ON\n    lc.cd_consorcio = dc.id_consorcio_jae\n),\n-- consorcios AS (\n--   SELECT\n--     t.data,\n--     t.hora,\n--     t.datetime_transacao,\n--     t.datetime_processamento,\n--     t.datetime_captura,\n--     COALESCE(t.modo, dc.modo) AS modo,\n--     dc.id_consorcio,\n--     dc.consorcio,\n--     t.id_operadora,\n--     t.operadora,\n--     t.id_servico_jae,\n--     t.servico_jae,\n--     t.descricao_servico_jae,\n--     t.sentido,\n--     t.id_veiculo,\n--     t.id_validador,\n--     t.id_transacao,\n--     t.latitude,\n--     t.longitude,\n--     t.valor_transacao\n--   FROM\n--     novos_dados t\n--   LEFT JOIN\n--     {{ ref(\"consorcios\") }} dc\n--   USING(id_consorcio_jae)\n-- ),\nparticoes_completas AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    novos_dados\n\n  {% if is_incremental() and transacao_partitions|length > 0 %}\n    UNION ALL\n\n    SELECT\n      * EXCEPT(versao),\n      1 AS priority\n    FROM\n      {{ this }}\n    WHERE\n      data IN ({{ transacao_partitions|join(', ') }})\n  {% endif %}\n),\ntransacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn, priority)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_captura DESC, priority) AS rn\n    FROM\n      particoes_completas\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  transacao_deduplicada", "language": "sql", "refs": [{"name": "staging_transacao_riocard", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "staging_linha", "package": null, "version": null}, {"name": "staging_linha_consorcio", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.staging_transacao_riocard", "model.rj_smtr.operadoras", "model.rj_smtr.staging_linha", "model.rj_smtr.staging_linha_consorcio", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem/transacao_riocard.sql", "compiled": true, "compiled_code": "\n\n\n\n\n\n  \n\n  \n\n\nWITH staging_transacao AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao_riocard`\n  \n    WHERE\n      \n  DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n  AND timestamp_captura BETWEEN DATETIME(\"2022-01-01T00:00:00\") AND DATETIME(\"2022-01-01T01:00:00\")\n\n  \n),\nnovos_dados AS (\n  SELECT\n    EXTRACT(DATE FROM t.data_transacao) AS data,\n    EXTRACT(HOUR FROM t.data_transacao) AS hora,\n    t.data_transacao AS datetime_transacao,\n    t.data_processamento AS datetime_processamento,\n    t.timestamp_captura AS datetime_captura,\n    COALESCE(do.modo, dc.modo) AS modo,\n    dc.id_consorcio,\n    dc.consorcio,\n    do.id_operadora,\n    do.operadora,\n    t.cd_linha AS id_servico_jae,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    t.sentido,\n    CASE\n      WHEN do.modo = \"VLT\" THEN SUBSTRING(t.veiculo_id, 1, 3)\n      WHEN do.modo = \"BRT\" THEN NULL\n      ELSE t.veiculo_id\n    END AS id_veiculo,\n    t.numero_serie_validador AS id_validador,\n    t.id AS id_transacao,\n    t.latitude_trx AS latitude,\n    t.longitude_trx AS longitude,\n    ST_GEOGPOINT(t.longitude_trx, t.latitude_trx) AS geo_point_transacao,\n    t.valor_transacao\n  FROM\n    staging_transacao t\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` l\n  ON\n    t.cd_linha = l.cd_linha\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio` lc\n  ON\n    t.cd_linha = lc.cd_linha\n    AND (\n      t.data_transacao BETWEEN lc.dt_inicio_validade AND lc.dt_fim_validade\n      OR lc.dt_fim_validade IS NULL\n    )\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` dc\n  ON\n    lc.cd_consorcio = dc.id_consorcio_jae\n),\n-- consorcios AS (\n--   SELECT\n--     t.data,\n--     t.hora,\n--     t.datetime_transacao,\n--     t.datetime_processamento,\n--     t.datetime_captura,\n--     COALESCE(t.modo, dc.modo) AS modo,\n--     dc.id_consorcio,\n--     dc.consorcio,\n--     t.id_operadora,\n--     t.operadora,\n--     t.id_servico_jae,\n--     t.servico_jae,\n--     t.descricao_servico_jae,\n--     t.sentido,\n--     t.id_veiculo,\n--     t.id_validador,\n--     t.id_transacao,\n--     t.latitude,\n--     t.longitude,\n--     t.valor_transacao\n--   FROM\n--     novos_dados t\n--   LEFT JOIN\n--     `rj-smtr`.`cadastro`.`consorcios` dc\n--   USING(id_consorcio_jae)\n-- ),\nparticoes_completas AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    novos_dados\n\n  \n),\ntransacao_deduplicada AS (\n  SELECT\n    * EXCEPT(rn, priority)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY datetime_captura DESC, priority) AS rn\n    FROM\n      particoes_completas\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  transacao_deduplicada", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ed_metadado_coluna": {"database": "rj-smtr", "schema": "catalogo", "name": "ed_metadado_coluna", "resource_type": "model", "package_name": "rj_smtr", "path": "catalogo/ed_metadado_coluna.sql", "original_file_path": "models/catalogo/ed_metadado_coluna.sql", "unique_id": "model.rj_smtr.ed_metadado_coluna", "fqn": ["rj_smtr", "catalogo", "ed_metadado_coluna"], "alias": "ed_metadado_coluna", "checksum": {"name": "sha256", "checksum": "11deff30b167fad867327288cc193e3b0d2591726d709115170d54bdd60ccc4d"}, "config": {"enabled": true, "alias": null, "schema": "catalogo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Cat\u00e1logo de dados de geolocaliza\u00e7\u00e3o e identifica\u00e7\u00e3o do data lake da SMTR destinados ao Escrit\u00f3rio de Dados (GP/ED)", "columns": {"project_id": {"name": "project_id", "description": "Nome do projeto (rj-smtr)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataset_id": {"name": "dataset_id", "description": "Nome do conjunto de dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "table_id": {"name": "table_id", "description": "Nome da tabela", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "column_name": {"name": "column_name", "description": "Nome da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_type": {"name": "data_type", "description": "Tipo de dado da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "description": {"name": "description", "description": "Descri\u00e7\u00e3o da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/catalogo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "catalogo"}, "created_at": 1727709587.8730364, "relation_name": "`rj-smtr`.`catalogo`.`ed_metadado_coluna`", "raw_code": "{% if execute %}\n  {% set models_with_tag = get_models_with_tags([\"geolocalizacao\", \"identificacao\"]) %}\n  {% do log(\"Models: \\n\", info=true) %}\n  {% for model in models_with_tag %}\n    {% do log(model.schema~\".\"~model.alias~\"\\n\", info=true) %}\n  {% endfor %}\n{% endif %}\n\nSELECT\n  *\nFROM\n  {{ ref(\"metadado_coluna\") }}\nWHERE\n  {% for model in models_with_tag %}\n    {% if not loop.first %}OR {% endif %}(dataset_id = \"{{ model.schema }}\"\n    AND table_id = \"{{ model.alias }}\")\n  {% endfor %}\n\n  OR (dataset_id = \"br_rj_riodejaneiro_stpl_gps\"\n    AND table_id = \"registros\")", "language": "sql", "refs": [{"name": "metadado_coluna", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.get_models_with_tags"], "nodes": ["model.rj_smtr.metadado_coluna"]}, "compiled_path": "target-base/compiled/rj_smtr/models/catalogo/ed_metadado_coluna.sql", "compiled": true, "compiled_code": "\n  \n  \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n    \n  \n\n\nSELECT\n  *\nFROM\n  `rj-smtr`.`catalogo`.`metadado_coluna`\nWHERE\n  \n    (dataset_id = \"br_rj_riodejaneiro_bilhetagem\"\n    AND table_id = \"gps_validador\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_bilhetagem\"\n    AND table_id = \"gps_validador_van\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_bilhetagem_staging\"\n    AND table_id = \"cliente\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_veiculos\"\n    AND table_id = \"gps_sppo_15_minutos\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_veiculos\"\n    AND table_id = \"gps_sppo\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_veiculos\"\n    AND table_id = \"gps_brt\")\n  \n    OR (dataset_id = \"br_rj_riodejaneiro_onibus_gps_zirix\"\n    AND table_id = \"gps_sppo\")\n  \n    OR (dataset_id = \"gtfs\"\n    AND table_id = \"shapes\")\n  \n    OR (dataset_id = \"gtfs\"\n    AND table_id = \"stops\")\n  \n    OR (dataset_id = \"gtfs\"\n    AND table_id = \"shapes_geom\")\n  \n    OR (dataset_id = \"cadastro\"\n    AND table_id = \"servicos\")\n  \n    OR (dataset_id = \"cadastro\"\n    AND table_id = \"operadoras\")\n  \n\n  OR (dataset_id = \"br_rj_riodejaneiro_stpl_gps\"\n    AND table_id = \"registros\")", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.metadado_coluna": {"database": "rj-smtr", "schema": "catalogo", "name": "metadado_coluna", "resource_type": "model", "package_name": "rj_smtr", "path": "catalogo/metadado_coluna.sql", "original_file_path": "models/catalogo/metadado_coluna.sql", "unique_id": "model.rj_smtr.metadado_coluna", "fqn": ["rj_smtr", "catalogo", "metadado_coluna"], "alias": "metadado_coluna", "checksum": {"name": "sha256", "checksum": "1cf8cbfdeac620199d8345852edde0440187aae10d8a3749270b8dca7a4f576e"}, "config": {"enabled": true, "alias": null, "schema": "catalogo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Cat\u00e1logo de dados do data lake da SMTR", "columns": {"project_id": {"name": "project_id", "description": "Nome do projeto (rj-smtr)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataset_id": {"name": "dataset_id", "description": "Nome do conjunto de dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "table_id": {"name": "table_id", "description": "Nome da tabela", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "column_name": {"name": "column_name", "description": "Nome da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_type": {"name": "data_type", "description": "Tipo de dado da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "description": {"name": "description", "description": "Descri\u00e7\u00e3o da coluna", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/catalogo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "catalogo"}, "created_at": 1727709587.8739, "relation_name": "`rj-smtr`.`catalogo`.`metadado_coluna`", "raw_code": "SELECT\n  table_catalog AS project_id,\n  table_schema AS dataset_id,\n  table_name AS table_id,\n  column_name,\n  data_type,\n  description\nFROM\n  rj-smtr.`region-US`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/catalogo/metadado_coluna.sql", "compiled": true, "compiled_code": "SELECT\n  table_catalog AS project_id,\n  table_schema AS dataset_id,\n  table_name AS table_id,\n  column_name,\n  data_type,\n  description\nFROM\n  rj-smtr.`region-US`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.receita_autuacao": {"database": "rj-smtr", "schema": "transito", "name": "receita_autuacao", "resource_type": "model", "package_name": "rj_smtr", "path": "transito/receita_autuacao.sql", "original_file_path": "models/transito/receita_autuacao.sql", "unique_id": "model.rj_smtr.receita_autuacao", "fqn": ["rj_smtr", "transito", "receita_autuacao"], "alias": "receita_autuacao", "checksum": {"name": "sha256", "checksum": "61e2ce0427beb98e3e7e51c201504ebf7e5203cb21dfad9c3f405e2ac9a045a9"}, "config": {"enabled": true, "alias": null, "schema": "transito", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {"data": {"name": "data", "description": "coluna de particao", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano da arrecada\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "Mes da arrecada\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_arrecadacao": {"name": "valor_arrecadacao", "description": "Valor arrecadado para o mes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/transito/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "transito", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.8931496, "relation_name": "`rj-smtr`.`transito`.`receita_autuacao`", "raw_code": "{{ config(\n    materialized='incremental',\n    partition_by={\n      \"field\": \"data\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy='insert_overwrite'\n) }}\n\nWITH receita_unpivot AS (\n  SELECT\n    ano,\n    CASE\n      WHEN mes = 'janeiro' THEN '01'\n      WHEN mes = 'fevereiro' THEN '02'\n      WHEN mes = 'marco' THEN '03'\n      WHEN mes = 'abril' THEN '04'\n      WHEN mes = 'maio' THEN '05'\n      WHEN mes = 'junho' THEN '06'\n      WHEN mes = 'julho' THEN '07'\n      WHEN mes = 'agosto' THEN '08'\n      WHEN mes = 'setembro' THEN '09'\n      WHEN mes = 'outubro' THEN '10'\n      WHEN mes = 'novembro' THEN '11'\n      WHEN mes = 'dezembro' THEN '12'\n    END AS mes,\n    SAFE_CAST(REPLACE(REPLACE(valor_arrecadacao, '.', ''), ',', '.') AS NUMERIC) AS valor_arrecadacao\n  FROM\n    {{ source('infracao_staging','receita_autuacao') }}\n  UNPIVOT (\n    valor_arrecadacao FOR mes IN (janeiro, fevereiro, marco, abril, maio, junho, julho, agosto, setembro, outubro, novembro, dezembro)\n  )\n\n),\n\nreceita_com_data AS (\n  SELECT\n    PARSE_DATE('%Y-%m-%d', CONCAT(ano, '-', mes, '-01')) AS data,\n    ano,\n    mes,\n    valor_arrecadacao\n  FROM receita_unpivot\n  WHERE valor_arrecadacao IS NOT NULL\n)\n\nSELECT\n  data,\n  ano,\n  mes,\n  valor_arrecadacao\nFROM receita_com_data\n{% if is_incremental() %}\n    WHERE\n      data BETWEEN DATE(\"{{ var('date_range_start') }}\") AND DATE(\"{{ var('date_range_end') }}\")\n{% endif %}", "language": "sql", "refs": [], "sources": [["infracao_staging", "receita_autuacao"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.infracao_staging.receita_autuacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/transito/receita_autuacao.sql", "compiled": true, "compiled_code": "\n\nWITH receita_unpivot AS (\n  SELECT\n    ano,\n    CASE\n      WHEN mes = 'janeiro' THEN '01'\n      WHEN mes = 'fevereiro' THEN '02'\n      WHEN mes = 'marco' THEN '03'\n      WHEN mes = 'abril' THEN '04'\n      WHEN mes = 'maio' THEN '05'\n      WHEN mes = 'junho' THEN '06'\n      WHEN mes = 'julho' THEN '07'\n      WHEN mes = 'agosto' THEN '08'\n      WHEN mes = 'setembro' THEN '09'\n      WHEN mes = 'outubro' THEN '10'\n      WHEN mes = 'novembro' THEN '11'\n      WHEN mes = 'dezembro' THEN '12'\n    END AS mes,\n    SAFE_CAST(REPLACE(REPLACE(valor_arrecadacao, '.', ''), ',', '.') AS NUMERIC) AS valor_arrecadacao\n  FROM\n    `rj-smtr-staging`.`infracao_staging`.`receita_autuacao`\n  UNPIVOT (\n    valor_arrecadacao FOR mes IN (janeiro, fevereiro, marco, abril, maio, junho, julho, agosto, setembro, outubro, novembro, dezembro)\n  )\n\n),\n\nreceita_com_data AS (\n  SELECT\n    PARSE_DATE('%Y-%m-%d', CONCAT(ano, '-', mes, '-01')) AS data,\n    ano,\n    mes,\n    valor_arrecadacao\n  FROM receita_unpivot\n  WHERE valor_arrecadacao IS NOT NULL\n)\n\nSELECT\n  data,\n  ano,\n  mes,\n  valor_arrecadacao\nFROM receita_com_data\n\n    WHERE\n      data BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.autuacao": {"database": "rj-smtr", "schema": "transito", "name": "autuacao", "resource_type": "model", "package_name": "rj_smtr", "path": "transito/autuacao.sql", "original_file_path": "models/transito/autuacao.sql", "unique_id": "model.rj_smtr.autuacao", "fqn": ["rj_smtr", "transito", "autuacao"], "alias": "autuacao", "checksum": {"name": "sha256", "checksum": "aa99f27d7717035d387ff24ca6122c77cb425a8d0d156e3b3d9a681af19405cd"}, "config": {"enabled": true, "alias": null, "schema": "transito", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_autuacao", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com dados de autua\u00e7\u00f5es (at\u00e9 abril/2023)", "columns": {"data": {"name": "data", "description": "Data da autua\u00e7\u00e3o (Coluna de particionamento)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_autuacao": {"name": "id_autuacao", "description": "Identificador \u00fanico da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_auto_infracao": {"name": "id_auto_infracao", "description": "C\u00f3digo do auto de infra\u00e7\u00e3o [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/7968932463054912793/policyTags/5243840798726507169"]}, "datetime_autuacao": {"name": "datetime_autuacao", "description": "Data e hora da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_limite_defesa_previa": {"name": "data_limite_defesa_previa", "description": "Data limite para defesa pr\u00e9via", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_limite_recurso": {"name": "data_limite_recurso", "description": "Data limite para recurso em primeira inst\u00e2ncia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_situacao_autuacao": {"name": "descricao_situacao_autuacao", "description": "Descri\u00e7\u00e3o da situa\u00e7\u00e3o da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_infracao": {"name": "status_infracao", "description": "Descri\u00e7\u00e3o do status da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "codigo_enquadramento": {"name": "codigo_enquadramento", "description": "C\u00f3digo da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipificacao_resumida": {"name": "tipificacao_resumida", "description": "Descri\u00e7\u00e3o da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "pontuacao": {"name": "pontuacao", "description": "Quantidade de pontos da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "gravidade": {"name": "gravidade", "description": "Descri\u00e7\u00e3o da gravidade da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "amparo_legal": {"name": "amparo_legal", "description": "Amparo legal da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo autuado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_veiculo": {"name": "descricao_veiculo", "description": "Marca/modelo do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa_veiculo": {"name": "placa_veiculo", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/7968932463054912793/policyTags/5243840798726507169"]}, "ano_fabricacao_veiculo": {"name": "ano_fabricacao_veiculo", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_modelo_veiculo": {"name": "ano_modelo_veiculo", "description": "Ano do modelo do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cor_veiculo": {"name": "cor_veiculo", "description": "Cor do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "especie_veiculo": {"name": "especie_veiculo", "description": "Esp\u00e9cie do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "uf_infrator": {"name": "uf_infrator", "description": "Estado do condutor infrator (em caso de indica\u00e7\u00e3o de real condutor infrator)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "uf_principal_condutor": {"name": "uf_principal_condutor", "description": "Estado do condutor principal do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "uf_proprietario": {"name": "uf_proprietario", "description": "Estado do propriet\u00e1rio do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cep_proprietario": {"name": "cep_proprietario", "description": "CEP do propriet\u00e1rio do ve\u00edculo [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/7968932463054912793/policyTags/5243840798726507169"]}, "valor_infracao": {"name": "valor_infracao", "description": "Valor monet\u00e1rio da autua\u00e7\u00e3o (100%) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor pago da autua\u00e7\u00e3o [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data de pagamento da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_autuador": {"name": "id_autuador", "description": "C\u00f3digo do \u00f3rg\u00e3o autuador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_autuador": {"name": "descricao_autuador", "description": "Descri\u00e7\u00e3o da unidade de autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_municipio_autuacao": {"name": "id_municipio_autuacao", "description": "C\u00f3digo TOM do munic\u00edpio da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_municipio": {"name": "descricao_municipio", "description": "Nome do munic\u00edpio da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "uf_autuacao": {"name": "uf_autuacao", "description": "Sigla do estado da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cep_autuacao": {"name": "cep_autuacao", "description": "Endere\u00e7o da autua\u00e7\u00e3o - CEP [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/7968932463054912793/policyTags/5243840798726507169"]}, "tile_autuacao": {"name": "tile_autuacao", "description": "Hex\u00e1gono da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo_defesa_autuacao": {"name": "processo_defesa_autuacao", "description": "N\u00famero do processo de defesa pr\u00e9via", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "recurso_penalidade_multa": {"name": "recurso_penalidade_multa", "description": "N\u00famero do processo de recurso contra aplica\u00e7\u00e3o de penalidade de multa em primeira inst\u00e2ncia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo_troca_real_infrator": {"name": "processo_troca_real_infrator", "description": "N\u00famero do processo de troca de real condutor infrator", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_sne": {"name": "status_sne", "description": "Indicador de ades\u00e3o do ve\u00edculo ao Sistema de Notifica\u00e7\u00e3o Eletr\u00f4nica (SNE)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fonte": {"name": "fonte", "description": "Origem dos dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/transito/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "transito", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_autuacao", "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.892281, "relation_name": "`rj-smtr`.`transito`.`autuacao`", "raw_code": "{{ config(\n    materialized='incremental',\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    unique_key='id_autuacao',\n    incremental_strategy='insert_overwrite'\n) }}\n\nWITH citran AS (\n    SELECT\n        data,\n        id_auto_infracao,\n        DATETIME(concat(data,' ',hora,':00')) AS datetime_autuacao,\n        data_limite_defesa_previa,\n        data_limite_recurso,\n        situacao_atual AS descricao_situacao_autuacao,\n        IF(status_infracao != \"\", status_infracao, NULL) AS status_infracao,\n        IF(codigo_enquadramento != \"\", codigo_enquadramento, NULL) AS codigo_enquadramento,\n        IF(tipificacao_resumida != \"\", tipificacao_resumida, NULL) AS tipificacao_resumida,\n        IF(pontuacao != \"\", pontuacao, NULL) AS pontuacao,\n        NULL AS gravidade,\n        NULL AS amparo_legal,\n        IF(tipo_veiculo != \"\", tipo_veiculo, NULL) AS tipo_veiculo,\n        IF(descricao_veiculo != \"\", descricao_veiculo, NULL) AS descricao_veiculo,\n        NULL AS placa_veiculo,\n        NULL AS ano_fabricacao_veiculo,\n        NULL AS ano_modelo_veiculo,\n        NULL AS cor_veiculo,\n        IF(especie_veiculo != \"\", especie_veiculo, NULL) AS especie_veiculo,\n        NULL AS uf_infrator,\n        NULL AS uf_principal_condutor,\n        IF(uf_proprietario != \"\", uf_proprietario, NULL) AS uf_proprietario,\n        IF(cep_proprietario != \"\", cep_proprietario, NULL) AS cep_proprietario,\n        valor_infracao / 100 AS valor_infracao,\n        valor_pago  / 100 AS valor_pago,\n        data_pagamento,\n        \"260010\" AS id_autuador,\n        IF(descricao_autuador != \"\", descricao_autuador, NULL) AS descricao_autuador,\n        \"6001\" AS id_municipio_autuacao,\n        \"RIO DE JANEIRO\" AS descricao_municipio,\n        \"RJ\" AS uf_autuacao,\n        NULL AS cep_autuacao, -- n\u00e3o padronizado na citran\n        NULL AS tile_autuacao,\n        IF(processo_defesa_autuacao != \"00000000\" AND processo_defesa_autuacao != \"\" , processo_defesa_autuacao, NULL) AS processo_defesa_autuacao,\n        IF(recurso_penalidade_multa != \"00000000\" AND recurso_penalidade_multa != \"\" , recurso_penalidade_multa, NULL) AS recurso_penalidade_multa,\n        IF(processo_troca_real_infrator != \"00000000\" AND processo_troca_real_infrator != \"\" , processo_troca_real_infrator, NULL) AS processo_troca_real_infrator,\n        FALSE AS status_sne,\n        \"CITRAN\" AS fonte\n    FROM {{ ref('autuacao_citran') }}\n    {% if is_incremental() %}\n        WHERE\n            data BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n    {% endif %}\n)\n\nSELECT\n    data,\n    TO_HEX(SHA256(CONCAT(GENERATE_UUID(), id_auto_infracao))) AS id_autuacao,\n    id_auto_infracao,\n    datetime_autuacao,\n    data_limite_defesa_previa,\n    data_limite_recurso,\n    descricao_situacao_autuacao,\n    status_infracao,\n    codigo_enquadramento,\n    tipificacao_resumida,\n    pontuacao,\n    gravidade,\n    amparo_legal,\n    tipo_veiculo,\n    descricao_veiculo,\n    placa_veiculo,\n    ano_fabricacao_veiculo,\n    ano_modelo_veiculo,\n    cor_veiculo,\n    especie_veiculo,\n    uf_infrator,\n    uf_principal_condutor,\n    uf_proprietario,\n    cep_proprietario,\n    valor_infracao,\n    valor_pago,\n    data_pagamento,\n    id_autuador,\n    descricao_autuador,\n    id_municipio_autuacao,\n    descricao_municipio,\n    uf_autuacao,\n    cep_autuacao,\n    tile_autuacao,\n    processo_defesa_autuacao,\n    recurso_penalidade_multa,\n    processo_troca_real_infrator,\n    status_sne,\n    fonte\nFROM\n    citran", "language": "sql", "refs": [{"name": "autuacao_citran", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.autuacao_citran"]}, "compiled_path": "target-base/compiled/rj_smtr/models/transito/autuacao.sql", "compiled": true, "compiled_code": "\n\nWITH citran AS (\n    SELECT\n        data,\n        id_auto_infracao,\n        DATETIME(concat(data,' ',hora,':00')) AS datetime_autuacao,\n        data_limite_defesa_previa,\n        data_limite_recurso,\n        situacao_atual AS descricao_situacao_autuacao,\n        IF(status_infracao != \"\", status_infracao, NULL) AS status_infracao,\n        IF(codigo_enquadramento != \"\", codigo_enquadramento, NULL) AS codigo_enquadramento,\n        IF(tipificacao_resumida != \"\", tipificacao_resumida, NULL) AS tipificacao_resumida,\n        IF(pontuacao != \"\", pontuacao, NULL) AS pontuacao,\n        NULL AS gravidade,\n        NULL AS amparo_legal,\n        IF(tipo_veiculo != \"\", tipo_veiculo, NULL) AS tipo_veiculo,\n        IF(descricao_veiculo != \"\", descricao_veiculo, NULL) AS descricao_veiculo,\n        NULL AS placa_veiculo,\n        NULL AS ano_fabricacao_veiculo,\n        NULL AS ano_modelo_veiculo,\n        NULL AS cor_veiculo,\n        IF(especie_veiculo != \"\", especie_veiculo, NULL) AS especie_veiculo,\n        NULL AS uf_infrator,\n        NULL AS uf_principal_condutor,\n        IF(uf_proprietario != \"\", uf_proprietario, NULL) AS uf_proprietario,\n        IF(cep_proprietario != \"\", cep_proprietario, NULL) AS cep_proprietario,\n        valor_infracao / 100 AS valor_infracao,\n        valor_pago  / 100 AS valor_pago,\n        data_pagamento,\n        \"260010\" AS id_autuador,\n        IF(descricao_autuador != \"\", descricao_autuador, NULL) AS descricao_autuador,\n        \"6001\" AS id_municipio_autuacao,\n        \"RIO DE JANEIRO\" AS descricao_municipio,\n        \"RJ\" AS uf_autuacao,\n        NULL AS cep_autuacao, -- n\u00e3o padronizado na citran\n        NULL AS tile_autuacao,\n        IF(processo_defesa_autuacao != \"00000000\" AND processo_defesa_autuacao != \"\" , processo_defesa_autuacao, NULL) AS processo_defesa_autuacao,\n        IF(recurso_penalidade_multa != \"00000000\" AND recurso_penalidade_multa != \"\" , recurso_penalidade_multa, NULL) AS recurso_penalidade_multa,\n        IF(processo_troca_real_infrator != \"00000000\" AND processo_troca_real_infrator != \"\" , processo_troca_real_infrator, NULL) AS processo_troca_real_infrator,\n        FALSE AS status_sne,\n        \"CITRAN\" AS fonte\n    FROM `rj-smtr`.`transito_staging`.`autuacao_citran`\n    \n        WHERE\n            data BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n    \n)\n\nSELECT\n    data,\n    TO_HEX(SHA256(CONCAT(GENERATE_UUID(), id_auto_infracao))) AS id_autuacao,\n    id_auto_infracao,\n    datetime_autuacao,\n    data_limite_defesa_previa,\n    data_limite_recurso,\n    descricao_situacao_autuacao,\n    status_infracao,\n    codigo_enquadramento,\n    tipificacao_resumida,\n    pontuacao,\n    gravidade,\n    amparo_legal,\n    tipo_veiculo,\n    descricao_veiculo,\n    placa_veiculo,\n    ano_fabricacao_veiculo,\n    ano_modelo_veiculo,\n    cor_veiculo,\n    especie_veiculo,\n    uf_infrator,\n    uf_principal_condutor,\n    uf_proprietario,\n    cep_proprietario,\n    valor_infracao,\n    valor_pago,\n    data_pagamento,\n    id_autuador,\n    descricao_autuador,\n    id_municipio_autuacao,\n    descricao_municipio,\n    uf_autuacao,\n    cep_autuacao,\n    tile_autuacao,\n    processo_defesa_autuacao,\n    recurso_penalidade_multa,\n    processo_troca_real_infrator,\n    status_sne,\n    fonte\nFROM\n    citran", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.autuacao_citran": {"database": "rj-smtr", "schema": "transito_staging", "name": "autuacao_citran", "resource_type": "model", "package_name": "rj_smtr", "path": "transito/staging/autuacao_citran.sql", "original_file_path": "models/transito/staging/autuacao_citran.sql", "unique_id": "model.rj_smtr.autuacao_citran", "fqn": ["rj_smtr", "transito", "staging", "autuacao_citran"], "alias": "autuacao_citran", "checksum": {"name": "sha256", "checksum": "4fec4f09b53db7c7be5492254cba5170394a0a8e9a549c997433194da898428f"}, "config": {"enabled": true, "alias": null, "schema": "transito_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com dados de autua\u00e7\u00f5es fornecidos pelo sistema CITRAN/IplanRio", "columns": {"data": {"name": "data", "description": "Data da autua\u00e7\u00e3o (Coluna de particionamento)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_auto_infracao": {"name": "id_auto_infracao", "description": "C\u00f3digo do auto de infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_limite_defesa_previa": {"name": "data_limite_defesa_previa", "description": "Data limite para defesa pr\u00e9via", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_limite_recurso": {"name": "data_limite_recurso", "description": "Data limite para recurso em primeira inst\u00e2ncia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "situacao_atual": {"name": "situacao_atual", "description": "Descri\u00e7\u00e3o da situa\u00e7\u00e3o da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_infracao": {"name": "status_infracao", "description": "Descri\u00e7\u00e3o do status da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "codigo_enquadramento": {"name": "codigo_enquadramento", "description": "C\u00f3digo da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipificacao_resumida": {"name": "tipificacao_resumida", "description": "Descri\u00e7\u00e3o da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "pontuacao": {"name": "pontuacao", "description": "Quantidade de pontos da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo autuado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_veiculo": {"name": "descricao_veiculo", "description": "Marca/modelo do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "especie_veiculo": {"name": "especie_veiculo", "description": "Esp\u00e9cie do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "uf_proprietario": {"name": "uf_proprietario", "description": "Estado do propriet\u00e1rio do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cep_proprietario": {"name": "cep_proprietario", "description": "CEP do propriet\u00e1rio do ve\u00edculo [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_infracao": {"name": "valor_infracao", "description": "Valor monet\u00e1rio da autua\u00e7\u00e3o (100%) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor pago da autua\u00e7\u00e3o [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data de pagamento da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_autuador": {"name": "id_autuador", "description": "C\u00f3digo do \u00f3rg\u00e3o autuador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_autuador": {"name": "descricao_autuador", "description": "Descri\u00e7\u00e3o da unidade de autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_municipio_autuacao": {"name": "id_municipio_autuacao", "description": "C\u00f3digo TOM do munic\u00edpio da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_municipio": {"name": "descricao_municipio", "description": "Nome do munic\u00edpio da autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "endereco_autuacao": {"name": "endereco_autuacao", "description": "Endere\u00e7o onde ocorreu a autua\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo_defesa_autuacao": {"name": "processo_defesa_autuacao", "description": "N\u00famero do processo de defesa pr\u00e9via", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "recurso_penalidade_multa": {"name": "recurso_penalidade_multa", "description": "N\u00famero do processo de recurso contra aplica\u00e7\u00e3o de penalidade de multa em primeira inst\u00e2ncia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "processo_troca_real_condutor_infrator": {"name": "processo_troca_real_condutor_infrator", "description": "N\u00famero do processo de troca de real condutor infrator", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_sne": {"name": "status_sne", "description": "Indicador de ades\u00e3o do ve\u00edculo ao SNE", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/transito/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "transito_staging"}, "created_at": 1727709587.8854916, "relation_name": "`rj-smtr`.`transito_staging`.`autuacao_citran`", "raw_code": "{{ config(\n        materialized='view'\n  )\n}}\n\n\nSELECT\n  DATE(data) AS data,\n  SAFE_CAST(JSON_VALUE(content,'$.Hora') AS STRING) hora,\n  Cod__Detran as id_auto_infracao,\n  IF(JSON_VALUE(content, '$.DtLimDP') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtLimDP')) AS STRING), NULL) data_limite_defesa_previa,\n  IF(JSON_VALUE(content, '$.DtLimR') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtLimR')) AS STRING), NULL) data_limite_recurso,\n  SAFE_CAST(JSON_VALUE(content,'$.Situacao Atual') AS STRING) situacao_atual,\n  SAFE_CAST(JSON_VALUE(content,'$.\"St. Infracao\"') AS STRING) status_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.Multa') AS STRING) codigo_enquadramento,\n  SAFE_CAST(JSON_VALUE(content,'$.DsInf') AS STRING) tipificacao_resumida,\n  SAFE_CAST(JSON_VALUE(content,'$.Po') AS STRING) pontuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.Tipo') AS STRING) tipo_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.Marca') AS STRING) descricao_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.Esp') AS STRING) especie_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.CDUF') AS STRING) uf_proprietario,\n  SAFE_CAST(JSON_VALUE(content,'$.Cep') AS STRING) cep_proprietario,\n  SAFE_CAST(JSON_VALUE(content,'$.Ufir') AS NUMERIC) valor_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.VlPagto') AS NUMERIC) valor_pago,\n  IF(JSON_VALUE(content, '$.DtPagto') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtPagto')) AS STRING), NULL) data_pagamento,\n  SAFE_CAST(JSON_VALUE(content,'$.Orgao') AS STRING) descricao_autuador,\n  SAFE_CAST(JSON_VALUE(content,'$.LocInf') AS STRING) endereco_autuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.ProAutu') AS STRING) processo_defesa_autuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.NotifPen') AS STRING) recurso_penalidade_multa,\n  SAFE_CAST(JSON_VALUE(content,'$.ProcRI') AS STRING) processo_troca_real_infrator,\n\nFROM\n  {{ source('infracao_staging','autuacoes_citran') }} as t", "language": "sql", "refs": [], "sources": [["infracao_staging", "autuacoes_citran"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.infracao_staging.autuacoes_citran"]}, "compiled_path": "target-base/compiled/rj_smtr/models/transito/staging/autuacao_citran.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n  DATE(data) AS data,\n  SAFE_CAST(JSON_VALUE(content,'$.Hora') AS STRING) hora,\n  Cod__Detran as id_auto_infracao,\n  IF(JSON_VALUE(content, '$.DtLimDP') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtLimDP')) AS STRING), NULL) data_limite_defesa_previa,\n  IF(JSON_VALUE(content, '$.DtLimR') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtLimR')) AS STRING), NULL) data_limite_recurso,\n  SAFE_CAST(JSON_VALUE(content,'$.Situacao Atual') AS STRING) situacao_atual,\n  SAFE_CAST(JSON_VALUE(content,'$.\"St. Infracao\"') AS STRING) status_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.Multa') AS STRING) codigo_enquadramento,\n  SAFE_CAST(JSON_VALUE(content,'$.DsInf') AS STRING) tipificacao_resumida,\n  SAFE_CAST(JSON_VALUE(content,'$.Po') AS STRING) pontuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.Tipo') AS STRING) tipo_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.Marca') AS STRING) descricao_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.Esp') AS STRING) especie_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.CDUF') AS STRING) uf_proprietario,\n  SAFE_CAST(JSON_VALUE(content,'$.Cep') AS STRING) cep_proprietario,\n  SAFE_CAST(JSON_VALUE(content,'$.Ufir') AS NUMERIC) valor_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.VlPagto') AS NUMERIC) valor_pago,\n  IF(JSON_VALUE(content, '$.DtPagto') != '', SAFE_CAST(PARSE_DATE('%d/%m/%Y', JSON_VALUE(content,'$.DtPagto')) AS STRING), NULL) data_pagamento,\n  SAFE_CAST(JSON_VALUE(content,'$.Orgao') AS STRING) descricao_autuador,\n  SAFE_CAST(JSON_VALUE(content,'$.LocInf') AS STRING) endereco_autuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.ProAutu') AS STRING) processo_defesa_autuacao,\n  SAFE_CAST(JSON_VALUE(content,'$.NotifPen') AS STRING) recurso_penalidade_multa,\n  SAFE_CAST(JSON_VALUE(content,'$.ProcRI') AS STRING) processo_troca_real_infrator,\n\nFROM\n  `rj-smtr-staging`.`infracao_staging`.`autuacoes_citran` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_rho_registros_stpl": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo_staging", "name": "staging_rho_registros_stpl", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo_staging/staging_rho_registros_stpl.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo_staging/staging_rho_registros_stpl.sql", "unique_id": "model.rj_smtr.staging_rho_registros_stpl", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo_staging", "staging_rho_registros_stpl"], "alias": "rho_registros_stpl", "checksum": {"name": "sha256", "checksum": "a3cf8b6941b3bbc2e72ef1d333bc047f8c086a1fabb74e6bcbfdd01107552427"}, "config": {"enabled": true, "alias": "rho_registros_stpl", "schema": "br_rj_riodejaneiro_rdo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_rdo_staging", "alias": "rho_registros_stpl"}, "created_at": 1727709586.1487596, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_stpl`", "raw_code": "{{\n  config(\n    alias='rho_registros_stpl',\n  )\n}}\n\nSELECT\n    SAFE_CAST(operadora AS STRING) operadora,\n    SAFE_CAST(linha AS STRING) linha,\n    SAFE_CAST(data_transacao AS DATE) data_transacao,\n    -- SAFE_CAST(PARSE_DATETIME(\"%Y-%m-%d\", data_transacao) AS DATETIME) data_transacao,\n    SAFE_CAST(hora_transacao AS INT64) hora_transacao,\n    SAFE_CAST(total_gratuidades AS INT64) total_gratuidades,\n    SAFE_CAST(total_pagantes AS INT64) total_pagantes,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(ano AS INT64) ano,\n    SAFE_CAST(mes AS INT64) mes,\n    SAFE_CAST(dia AS INT64) dia,\n    DATE(CONCAT(ano,'-', mes, '-', dia)) data_particao\nfrom\n    {{ source(\"br_rj_riodejaneiro_rdo_staging\", \"rho5_registros_stpl\") }} as t", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_rdo_staging", "rho5_registros_stpl"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo_staging/staging_rho_registros_stpl.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    SAFE_CAST(operadora AS STRING) operadora,\n    SAFE_CAST(linha AS STRING) linha,\n    SAFE_CAST(data_transacao AS DATE) data_transacao,\n    -- SAFE_CAST(PARSE_DATETIME(\"%Y-%m-%d\", data_transacao) AS DATETIME) data_transacao,\n    SAFE_CAST(hora_transacao AS INT64) hora_transacao,\n    SAFE_CAST(total_gratuidades AS INT64) total_gratuidades,\n    SAFE_CAST(total_pagantes AS INT64) total_pagantes,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(ano AS INT64) ano,\n    SAFE_CAST(mes AS INT64) mes,\n    SAFE_CAST(dia AS INT64) dia,\n    DATE(CONCAT(ano,'-', mes, '-', dia)) data_particao\nfrom\n    `rj-smtr-staging`.`br_rj_riodejaneiro_rdo_staging`.`rho5_registros_stpl` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.rho_registros_stpl_aux": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo_staging", "name": "rho_registros_stpl_aux", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo_staging/rho_registros_stpl_aux.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo_staging/rho_registros_stpl_aux.sql", "unique_id": "model.rj_smtr.rho_registros_stpl_aux", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo_staging", "rho_registros_stpl_aux"], "alias": "rho_registros_stpl_aux", "checksum": {"name": "sha256", "checksum": "128cfb08fa95c660b6cf4d0cb2afc7890eb5a9dffe3d9d753597a6dca03f1bed"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_rdo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_rdo_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}}, "created_at": 1727709586.1520667, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_stpl_aux`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n        \"field\":\"data_transacao\",\n        \"data_type\": \"date\",\n        \"granularity\":\"day\"\n    },\n  )\n}}\n\n-- Tabela auxiliar para manter os dados com os mesmos identificadores:\n-- data e hora de transacao, linha e operadora desagregados antes de somar na tabela final\n-- Foi criada para n\u00e3o ter o risco de somar os dados do mesmo arquivo mais de uma vez\n\n{% set incremental_filter %}\n    ano BETWEEN\n        EXTRACT(YEAR FROM DATE(\"{{ var('date_range_start') }}\"))\n        AND EXTRACT(YEAR FROM DATE(\"{{ var('date_range_end') }}\"))\n    AND mes BETWEEN\n        EXTRACT(MONTH FROM DATE(\"{{ var('date_range_start') }}\"))\n        AND EXTRACT(MONTH FROM DATE(\"{{ var('date_range_end') }}\"))\n    AND dia BETWEEN\n        EXTRACT(DAY FROM DATE(\"{{ var('date_range_start') }}\"))\n        AND EXTRACT(DAY FROM DATE(\"{{ var('date_range_end') }}\"))\n{% endset %}\n\n\n{% set staging_table = ref('staging_rho_registros_stpl') %}\n{% if execute %}\n    {% if is_incremental() %}\n        {% set partitions_query %}\n            SELECT DISTINCT\n                CONCAT(\"'\", data_transacao, \"'\")\n            FROM\n                {{ staging_table }}\n            WHERE\n                {{ incremental_filter }}\n        {% endset %}\n\n        {% set partitions = run_query(partitions_query) %}\n\n        {% set partition_list = partitions.columns[0].values() %}\n    {% endif %}\n{% endif %}\n\n\nWITH rho_new AS (\n    SELECT\n        data_transacao,\n        hora_transacao,\n        data_particao AS data_arquivo_rho,\n        linha AS servico_riocard,\n        operadora,\n        total_pagantes AS quantidade_transacao_pagante,\n        total_gratuidades AS quantidade_transacao_gratuidade,\n        timestamp_captura AS datetime_captura\n    FROM\n        {{ staging_table }}\n    {% if is_incremental() %}\n        WHERE\n            {{ incremental_filter }}\n    {% endif %}\n),\nrho_complete_partitions AS (\n    SELECT\n        *\n    FROM\n        rho_new\n\n    {% if is_incremental() and partition_list|length > 0 %}\n\n        UNION ALL\n\n        SELECT\n            *\n        FROM\n            {{ this }}\n        WHERE\n            data_transacao IN ({{ partition_list|join(', ') }})\n    {% endif %}\n)\nSELECT\n    data_transacao,\n    hora_transacao,\n    data_arquivo_rho,\n    servico_riocard,\n    operadora,\n    quantidade_transacao_pagante,\n    quantidade_transacao_gratuidade,\n    datetime_captura\nFROM\n    (\n        SELECT\n            *,\n            ROW_NUMBER() OVER(\n                PARTITION BY\n                    data_transacao,\n                    hora_transacao,\n                    data_arquivo_rho,\n                    servico_riocard,\n                    operadora\n                ORDER BY\n                    datetime_captura DESC\n                ) AS rn\n        FROM\n            rho_complete_partitions\n    )\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "staging_rho_registros_stpl", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.staging_rho_registros_stpl"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo_staging/rho_registros_stpl_aux.sql", "compiled": true, "compiled_code": "\n\n-- Tabela auxiliar para manter os dados com os mesmos identificadores:\n-- data e hora de transacao, linha e operadora desagregados antes de somar na tabela final\n-- Foi criada para n\u00e3o ter o risco de somar os dados do mesmo arquivo mais de uma vez\n\n\n\n\n\n\n    \n        \n\n        \n\n        \n    \n\n\n\nWITH rho_new AS (\n    SELECT\n        data_transacao,\n        hora_transacao,\n        data_particao AS data_arquivo_rho,\n        linha AS servico_riocard,\n        operadora,\n        total_pagantes AS quantidade_transacao_pagante,\n        total_gratuidades AS quantidade_transacao_gratuidade,\n        timestamp_captura AS datetime_captura\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_stpl`\n    \n        WHERE\n            \n    ano BETWEEN\n        EXTRACT(YEAR FROM DATE(\"2022-01-01T00:00:00\"))\n        AND EXTRACT(YEAR FROM DATE(\"2022-01-01T01:00:00\"))\n    AND mes BETWEEN\n        EXTRACT(MONTH FROM DATE(\"2022-01-01T00:00:00\"))\n        AND EXTRACT(MONTH FROM DATE(\"2022-01-01T01:00:00\"))\n    AND dia BETWEEN\n        EXTRACT(DAY FROM DATE(\"2022-01-01T00:00:00\"))\n        AND EXTRACT(DAY FROM DATE(\"2022-01-01T01:00:00\"))\n\n    \n),\nrho_complete_partitions AS (\n    SELECT\n        *\n    FROM\n        rho_new\n\n    \n\n        UNION ALL\n\n        SELECT\n            *\n        FROM\n            `rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_stpl_aux`\n        WHERE\n            data_transacao IN ('2021-12-31', '2022-01-01', '2021-12-29', '2021-12-30', '2021-12-28', '2021-12-22', '2021-12-23', '2021-12-24', '2021-12-26', '2021-12-27')\n    \n)\nSELECT\n    data_transacao,\n    hora_transacao,\n    data_arquivo_rho,\n    servico_riocard,\n    operadora,\n    quantidade_transacao_pagante,\n    quantidade_transacao_gratuidade,\n    datetime_captura\nFROM\n    (\n        SELECT\n            *,\n            ROW_NUMBER() OVER(\n                PARTITION BY\n                    data_transacao,\n                    hora_transacao,\n                    data_arquivo_rho,\n                    servico_riocard,\n                    operadora\n                ORDER BY\n                    datetime_captura DESC\n                ) AS rn\n        FROM\n            rho_complete_partitions\n    )\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_rho_registros_sppo": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo_staging", "name": "staging_rho_registros_sppo", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo_staging/staging_rho_registros_sppo.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo_staging/staging_rho_registros_sppo.sql", "unique_id": "model.rj_smtr.staging_rho_registros_sppo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo_staging", "staging_rho_registros_sppo"], "alias": "rho_registros_sppo", "checksum": {"name": "sha256", "checksum": "7dc3a84b563eec0f55e55d806eb760ee01bfc6d42d8410294ae74a457bb44b97"}, "config": {"enabled": true, "alias": "rho_registros_sppo", "schema": "br_rj_riodejaneiro_rdo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_rdo_staging", "alias": "rho_registros_sppo"}, "created_at": 1727709586.1611767, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_sppo`", "raw_code": "{{\n  config(\n    alias='rho_registros_sppo',\n  )\n}}\n\n\nSELECT\n    CONCAT(TRIM(linha_rcti), '_', data_transacao, '_', hora_transacao, ano,'_', mes, '_', dia) id_transacao,\n    TRIM(linha) linha,\n    SAFE_CAST(data_transacao AS DATE) data_transacao,\n    SAFE_CAST(hora_transacao AS INT64) hora_transacao,\n    SAFE_CAST(total_gratuidades AS INT64) total_gratuidades,\n    SAFE_CAST(total_pagantes_especie AS INT64) total_pagantes_especie,\n    SAFE_CAST(total_pagantes_cartao AS INT64) total_pagantes_cartao,\n    SAFE_CAST(registro_processado AS STRING) registro_processado,\n    SAFE_CAST(data_processamento AS DATE) data_processamento,\n    SAFE_CAST(operadora AS STRING) operadora,\n    SAFE_CAST(linha_rcti AS STRING) linha_rcti,\n    DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(ano AS INT64) ano,\n    SAFE_CAST(mes AS INT64) mes,\n    SAFE_CAST(dia AS INT64) dia,\n    DATE(CONCAT(ano,'-', mes, '-', dia)) data_particao\nFROM\n    {{ source(\"br_rj_riodejaneiro_rdo_staging\", \"rho_registros_sppo\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_rdo_staging", "rho_registros_sppo"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo_staging/staging_rho_registros_sppo.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n    CONCAT(TRIM(linha_rcti), '_', data_transacao, '_', hora_transacao, ano,'_', mes, '_', dia) id_transacao,\n    TRIM(linha) linha,\n    SAFE_CAST(data_transacao AS DATE) data_transacao,\n    SAFE_CAST(hora_transacao AS INT64) hora_transacao,\n    SAFE_CAST(total_gratuidades AS INT64) total_gratuidades,\n    SAFE_CAST(total_pagantes_especie AS INT64) total_pagantes_especie,\n    SAFE_CAST(total_pagantes_cartao AS INT64) total_pagantes_cartao,\n    SAFE_CAST(registro_processado AS STRING) registro_processado,\n    SAFE_CAST(data_processamento AS DATE) data_processamento,\n    SAFE_CAST(operadora AS STRING) operadora,\n    SAFE_CAST(linha_rcti AS STRING) linha_rcti,\n    DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(ano AS INT64) ano,\n    SAFE_CAST(mes AS INT64) mes,\n    SAFE_CAST(dia AS INT64) dia,\n    DATE(CONCAT(ano,'-', mes, '-', dia)) data_particao\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_sppo`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagem_conformidade": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "viagem_conformidade", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/viagem_conformidade.sql", "original_file_path": "models/projeto_subsidio_sppo/viagem_conformidade.sql", "unique_id": "model.rj_smtr.viagem_conformidade", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "viagem_conformidade"], "alias": "viagem_conformidade", "checksum": {"name": "sha256", "checksum": "6c1cc202fb04a031ab6d7e5b89dc7f320e23e743a3f5049387c471e8219e6c14"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["id_viagem"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela de c\u00e1lculo da conformidade de viagens identificadas por GPS.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Servi\u00e7o realizado pelo ve\u00edculo (com base na identifica\u00e7\u00e3o do trajeto)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_viagem": {"name": "tempo_viagem", "description": "Tempo da viagem (em minutos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_aferida": {"name": "distancia_aferida", "description": "Dist\u00e2ncia aferida da viagem (geod\u00e9sia entre posi\u00e7\u00f5es consecutivas do sinal de GPS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_middle": {"name": "n_registros_middle", "description": "Contagem de sinais de GPS emitidos no meio do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_start": {"name": "n_registros_start", "description": "Contagem de sinais de GPS emitidos no ponto de de in\u00edcio do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_end": {"name": "n_registros_end", "description": "Contagem de sinais de GPS emitidos no ponto final do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_out": {"name": "n_registros_out", "description": "Contagem de sinais de GPS emitidos fora do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_shape": {"name": "n_registros_shape", "description": "Contagem total de sinais de GPS emitidos dentro do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_total": {"name": "n_registros_total", "description": "Contagem de sinais de GPS emitidos no tempo da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_minuto": {"name": "n_registros_minuto", "description": "Contagem de minutos do trajeto com pelo menos 1 sinal de GPS emitido.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_shape": {"name": "perc_conformidade_shape", "description": "Percentual de sinais emitidos dentro do shape (trajeto) ao longo da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_distancia": {"name": "perc_conformidade_distancia", "description": "Raz\u00e3o da dist\u00e2ncia aferida pela dist\u00e2ncia te\u00f3rica x 100", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_registros": {"name": "perc_conformidade_registros", "description": "Percentual de minutos da viagem com registro de sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["id_viagem"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.919028, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`", "raw_code": "{{ config(\r\n       materialized='incremental',\r\n       partition_by={\r\n              \"field\":\"data\",\r\n              \"data_type\": \"date\",\r\n              \"granularity\":\"day\"\r\n       },\r\n       unique_key=['id_viagem'],\r\n       incremental_strategy='insert_overwrite'\r\n)\r\n}}\r\n\r\n-- 1. Agrega informa\u00e7\u00f5es de viagens circulares: ajusta\r\n--    datetime_chegada, calcula tempo total de\r\n--    viagem e distancia total planejada. Mantem o shape planejado (\"C\")\r\n--    como padr\u00e3o da viagem.\r\nwith viagem as (\r\n    select\r\n        *,\r\n        datetime_diff(datetime_chegada, datetime_partida, minute) + 1 as tempo_viagem\r\n    from (\r\n        select\r\n            *\r\n        from (\r\n            select\r\n                * except(sentido_shape, distancia_inicio_fim, shape_id, shape_id_planejado, trip_id, trip_id_planejado, datetime_chegada),\r\n                datetime_chegada,\r\n                trip_id_planejado as trip_id,\r\n                shape_id_planejado as shape_id\r\n            from\r\n                {{ ref(\"aux_viagem_circular\") }} v\r\n            where\r\n                sentido = \"I\" or sentido = \"V\"\r\n        )\r\n        union all (\r\n            select\r\n                * except(sentido_shape, distancia_inicio_fim, shape_id, shape_id_planejado, trip_id, trip_id_planejado),\r\n                trip_id_planejado as trip_id,\r\n                shape_id_planejado as shape_id,\r\n            from\r\n                (select\r\n                    v.* except(datetime_chegada),\r\n                    lead(datetime_chegada) over (\r\n                        partition by id_viagem order by sentido_shape)\r\n                    as datetime_chegada,\r\n                    -- TODO: mudar se tiver distancia planejada separada\r\n                    -- por shape (ida/volta)\r\n                    -- distancia_planejada,\r\n                    -- round(distancia_planejada + lead(distancia_planejada) over (\r\n                    --     partition by id_viagem order by sentido_shape), 3)\r\n                    -- as distancia_planejada,\r\n                from\r\n                    {{ ref(\"aux_viagem_circular\") }} v\r\n                where\r\n                    sentido = \"C\"\r\n                ) c\r\n            where sentido_shape = \"I\"\r\n        )\r\n    )\r\n)\r\n-- 2. Calcula os percentuais de conformidade da distancia, trajeto e GPS\r\nselect distinct\r\n    v.* except(versao_modelo),\r\n    d.* except(id_viagem, versao_modelo),\r\n    round(100 * n_registros_shape/n_registros_total, 2) as perc_conformidade_shape,\r\n    round(100 * d.distancia_aferida/v.distancia_planejada, 2) as perc_conformidade_distancia,\r\n    round(100 * n_registros_minuto/tempo_viagem, 2) as perc_conformidade_registros,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    viagem v\r\ninner join\r\n    {{ ref(\"aux_viagem_registros\") }} d\r\non\r\n    v.id_viagem = d.id_viagem", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}, {"name": "aux_viagem_circular", "package": null, "version": null}, {"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_viagem_circular", "model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/viagem_conformidade.sql", "compiled": true, "compiled_code": "\n\n-- 1. Agrega informa\u00e7\u00f5es de viagens circulares: ajusta\n--    datetime_chegada, calcula tempo total de\n--    viagem e distancia total planejada. Mantem o shape planejado (\"C\")\n--    como padr\u00e3o da viagem.\nwith viagem as (\n    select\n        *,\n        datetime_diff(datetime_chegada, datetime_partida, minute) + 1 as tempo_viagem\n    from (\n        select\n            *\n        from (\n            select\n                * except(sentido_shape, distancia_inicio_fim, shape_id, shape_id_planejado, trip_id, trip_id_planejado, datetime_chegada),\n                datetime_chegada,\n                trip_id_planejado as trip_id,\n                shape_id_planejado as shape_id\n            from\n                `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular` v\n            where\n                sentido = \"I\" or sentido = \"V\"\n        )\n        union all (\n            select\n                * except(sentido_shape, distancia_inicio_fim, shape_id, shape_id_planejado, trip_id, trip_id_planejado),\n                trip_id_planejado as trip_id,\n                shape_id_planejado as shape_id,\n            from\n                (select\n                    v.* except(datetime_chegada),\n                    lead(datetime_chegada) over (\n                        partition by id_viagem order by sentido_shape)\n                    as datetime_chegada,\n                    -- TODO: mudar se tiver distancia planejada separada\n                    -- por shape (ida/volta)\n                    -- distancia_planejada,\n                    -- round(distancia_planejada + lead(distancia_planejada) over (\n                    --     partition by id_viagem order by sentido_shape), 3)\n                    -- as distancia_planejada,\n                from\n                    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular` v\n                where\n                    sentido = \"C\"\n                ) c\n            where sentido_shape = \"I\"\n        )\n    )\n)\n-- 2. Calcula os percentuais de conformidade da distancia, trajeto e GPS\nselect distinct\n    v.* except(versao_modelo),\n    d.* except(id_viagem, versao_modelo),\n    round(100 * n_registros_shape/n_registros_total, 2) as perc_conformidade_shape,\n    round(100 * d.distancia_aferida/v.distancia_planejada, 2) as perc_conformidade_distancia,\n    round(100 * n_registros_minuto/tempo_viagem, 2) as perc_conformidade_registros,\n    '' as versao_modelo\nfrom\n    viagem v\ninner join\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros` d\non\n    v.id_viagem = d.id_viagem", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_registros_status_trajeto": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "aux_registros_status_trajeto", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/aux_registros_status_trajeto.sql", "original_file_path": "models/projeto_subsidio_sppo/aux_registros_status_trajeto.sql", "unique_id": "model.rj_smtr.aux_registros_status_trajeto", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "aux_registros_status_trajeto"], "alias": "aux_registros_status_trajeto", "checksum": {"name": "sha256", "checksum": "b92fa7bdae866fa3109e9f4485ac28686a463b789daa96a463167df9931f6628"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela auxiliar de classifica\u00e7\u00e3o dos registros de GPS no trajeto (shape), com base no servi\u00e7o informado pelo ve\u00edculo (atualizada diariamente, sem hist\u00f3rico).", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_minuto_gps": {"name": "timestamp_minuto_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS truncado em minutos (para fins de compara\u00e7\u00e3o com minutos da viagem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "posicao_veiculo_geo": {"name": "posicao_veiculo_geo", "description": "Geolocaliza\u00e7\u00e3o do ve\u00edculo segundo o sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Outro servi\u00e7o da empresa que o ve\u00edculo pode estar operando", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o realizado ", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia geod\u00e9sica da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o a posi\u00e7\u00e3o atual", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_viagem": {"name": "status_viagem", "description": "Indica se a posi\u00e7\u00e3o do GPS est\u00e1 no in\u00edcio (start), meio (middle), fim (end) ou fora (out) do shape do servi\u00e7o informado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9062636, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`", "raw_code": "-- depends_on: {{ ref('subsidio_data_versao_efetiva') }}\r\n{% if execute %}\r\n    {% set result = run_query(\"SELECT feed_start_date FROM \" ~ ref('subsidio_data_versao_efetiva') ~ \" WHERE data BETWEEN DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 2 DAY) AND DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 1 DAY)\") %}\r\n    {% set feed_start_dates =  result.columns[0].values() %}\r\n{% endif %}\r\n\r\n{% if var(\"run_date\") == \"2024-05-05\" %}\r\n-- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\n    {% set gps_interval = 7 %}\r\n{% else %}\r\n    {% set gps_interval = 3 %}\r\n{% endif %}\r\n\r\n{% if var(\"run_date\") < var(\"DATA_SUBSIDIO_V9_INICIO\") %}\r\n\r\n-- 1. Seleciona sinais de GPS registrados no per\u00edodo\r\nwith gps as (\r\n    select\r\n        g.* except(longitude, latitude, servico),\r\n        {% if var(\"run_date\") > \"2023-01-16\" and var(\"run_date\") < \"2023-12-02\" %}\r\n        -- Substitui servicos noturnos por regulares, salvo exce\u00e7\u00f5es\r\n        case\r\n            when servico like \"SN%\" and servico not in (\"SN006\", \"SN415\", \"SN474\", \"SN483\")\r\n            then REGEXP_EXTRACT(servico, r'[0-9]+')\r\n            else servico\r\n        end as servico,\r\n        {% else %}\r\n        servico,\r\n        {% endif %}\r\n        substr(id_veiculo, 2, 3) as id_empresa,\r\n        ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo,\r\n        {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n        date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) as data_operacao\r\n        {% endif %}\r\n    from\r\n        -- `rj-smtr.br_rj_riodejaneiro_veiculos.gps_sppo` g\r\n        {{ ref('gps_sppo') }} g\r\n    where (\r\n        data between date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n    )\r\n    -- Limita range de busca do gps de D-2 \u00e0s 00h at\u00e9 D-1 \u00e0s 3h\r\n    and (\r\n        timestamp_gps between datetime_sub(datetime_trunc(\"{{ var(\"run_date\") }}\", day), interval 1 day)\r\n        and datetime_add(datetime_trunc(\"{{ var(\"run_date\") }}\", day), interval {{ gps_interval }} hour)\r\n    )\r\n    and status != \"Parado garagem\"\r\n    {% if var(\"run_date\") == \"2024-05-05\" %}\r\n        -- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\n        and servico != \"SE001\"\r\n    {% endif %}\r\n),\r\n-- 2. Classifica a posi\u00e7\u00e3o do ve\u00edculo em todos os shapes poss\u00edveis de\r\n--    servi\u00e7os de uma mesma empresa\r\nstatus_viagem as (\r\n    select\r\n        {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n        data_operacao as data,\r\n        {% else %}\r\n        g.data,\r\n        {% endif %}\r\n        g.id_veiculo,\r\n        g.id_empresa,\r\n        g.timestamp_gps,\r\n        timestamp_trunc(g.timestamp_gps, minute) as timestamp_minuto_gps,\r\n        g.posicao_veiculo_geo,\r\n        TRIM(g.servico, \" \") as servico_informado,\r\n        s.servico as servico_realizado,\r\n        s.shape_id,\r\n        s.sentido_shape,\r\n        s.shape_id_planejado,\r\n        s.trip_id,\r\n        s.trip_id_planejado,\r\n        s.sentido,\r\n        s.start_pt,\r\n        s.end_pt,\r\n        s.distancia_planejada,\r\n        ifnull(g.distancia,0) as distancia,\r\n        case\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, start_pt, {{ var(\"buffer\") }})\r\n            then 'start'\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, end_pt, {{ var(\"buffer\") }})\r\n            then 'end'\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, shape, {{ var(\"buffer\") }})\r\n            then 'middle'\r\n        else 'out'\r\n        end status_viagem\r\n    from\r\n        gps g\r\n    inner join (\r\n        select\r\n            *\r\n        from\r\n            {{ ref(\"viagem_planejada\") }}\r\n        where\r\n            {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n            data = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n            {% else %}\r\n            data between date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n            {% endif %}\r\n    ) s\r\n    on\r\n        {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n        g.data_operacao = s.data\r\n        {% else %}\r\n        g.data = s.data\r\n        {% endif %}\r\n        and g.servico = s.servico\r\n)\r\nselect\r\n    *,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    status_viagem\r\n\r\n{% else %}\r\n\r\n-- 1. Seleciona sinais de GPS registrados no per\u00edodo\r\nwith gps as (\r\n    select\r\n        g.* except(longitude, latitude, servico),\r\n        servico,\r\n        substr(id_veiculo, 2, 3) as id_empresa,\r\n        ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo,\r\n        date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) as data_operacao\r\n    from\r\n        -- `rj-smtr.br_rj_riodejaneiro_veiculos.gps_sppo` g\r\n        {{ ref('gps_sppo') }} g\r\n    where (\r\n        data between date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n    )\r\n    -- Limita range de busca do gps de D-2 \u00e0s 00h at\u00e9 D-1 \u00e0s 3h\r\n    and (\r\n        timestamp_gps between datetime_sub(datetime_trunc(\"{{ var(\"run_date\") }}\", day), interval 1 day)\r\n        and datetime_add(datetime_trunc(\"{{ var(\"run_date\") }}\", day), interval {{ gps_interval }} hour)\r\n    )\r\n    and status != \"Parado garagem\"\r\n),\r\n-- 2. Busca os shapes em formato geogr\u00e1fico\r\nshapes AS (\r\n  SELECT\r\n    *\r\n  FROM\r\n    {{ ref(\"shapes_geom_gtfs\") }}\r\n    -- rj-smtr.gtfs.shapes_geom\r\n  WHERE\r\n    feed_start_date IN ('{{ feed_start_dates|join(\"', '\") }}')\r\n),\r\n-- 3. Deduplica viagens planejadas\r\nviagem_planejada AS (\r\n  SELECT\r\n    DISTINCT * EXCEPT(faixa_horaria_inicio, faixa_horaria_fim, partidas_total_planejada, distancia_total_planejada, shape, start_pt, end_pt)\r\n  FROM\r\n    {{ ref(\"viagem_planejada\") }}\r\n  WHERE\r\n    data = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n),\r\ndeduplica_viagem_planejada AS (\r\n  SELECT\r\n    v.*,\r\n    s.shape,\r\n    s.start_pt,\r\n    s.end_pt\r\n  FROM\r\n    viagem_planejada AS v\r\n  LEFT JOIN\r\n    shapes AS s\r\n  USING\r\n    (feed_version, feed_start_date, shape_id)\r\n),\r\n-- 4. Classifica a posi\u00e7\u00e3o do ve\u00edculo em todos os shapes poss\u00edveis de\r\n--    servi\u00e7os de uma mesma empresa\r\nstatus_viagem as (\r\n    select\r\n        data_operacao as data,\r\n        g.id_veiculo,\r\n        g.id_empresa,\r\n        g.timestamp_gps,\r\n        timestamp_trunc(g.timestamp_gps, minute) as timestamp_minuto_gps,\r\n        g.posicao_veiculo_geo,\r\n        TRIM(g.servico, \" \") as servico_informado,\r\n        s.servico as servico_realizado,\r\n        s.shape_id,\r\n        s.sentido_shape,\r\n        s.shape_id_planejado,\r\n        s.trip_id,\r\n        s.trip_id_planejado,\r\n        s.sentido,\r\n        s.start_pt,\r\n        s.end_pt,\r\n        s.distancia_planejada,\r\n        ifnull(g.distancia,0) as distancia,\r\n        case\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, start_pt, {{ var(\"buffer\") }})\r\n            then 'start'\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, end_pt, {{ var(\"buffer\") }})\r\n            then 'end'\r\n            when ST_DWITHIN(g.posicao_veiculo_geo, shape, {{ var(\"buffer\") }})\r\n            then 'middle'\r\n        else 'out'\r\n        end status_viagem\r\n    from\r\n        gps g\r\n    inner join (\r\n        SELECT\r\n          *\r\n        FROM\r\n          deduplica_viagem_planejada\r\n    ) s\r\n    on\r\n        g.data_operacao = s.data\r\n        and g.servico = s.servico\r\n)\r\nselect\r\n    *,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    status_viagem\r\n{% endif %}", "language": "sql", "refs": [{"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "gps_sppo", "package": null, "version": null}, {"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.run_query"], "nodes": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.gps_sppo", "model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/aux_registros_status_trajeto.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n\n    \n    \n\n\n\n    \n\n\n\n\n-- 1. Seleciona sinais de GPS registrados no per\u00edodo\nwith gps as (\n    select\n        g.* except(longitude, latitude, servico),\n        \n        servico,\n        \n        substr(id_veiculo, 2, 3) as id_empresa,\n        ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo,\n        \n    from\n        -- `rj-smtr.br_rj_riodejaneiro_veiculos.gps_sppo` g\n        `rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_sppo` g\n    where (\n        data between date_sub(date(\"2022-01-01T01:00:00\"), interval 1 day) and date(\"2022-01-01T01:00:00\")\n    )\n    -- Limita range de busca do gps de D-2 \u00e0s 00h at\u00e9 D-1 \u00e0s 3h\n    and (\n        timestamp_gps between datetime_sub(datetime_trunc(\"2022-01-01T01:00:00\", day), interval 1 day)\n        and datetime_add(datetime_trunc(\"2022-01-01T01:00:00\", day), interval 3 hour)\n    )\n    and status != \"Parado garagem\"\n    \n),\n-- 2. Classifica a posi\u00e7\u00e3o do ve\u00edculo em todos os shapes poss\u00edveis de\n--    servi\u00e7os de uma mesma empresa\nstatus_viagem as (\n    select\n        \n        g.data,\n        \n        g.id_veiculo,\n        g.id_empresa,\n        g.timestamp_gps,\n        timestamp_trunc(g.timestamp_gps, minute) as timestamp_minuto_gps,\n        g.posicao_veiculo_geo,\n        TRIM(g.servico, \" \") as servico_informado,\n        s.servico as servico_realizado,\n        s.shape_id,\n        s.sentido_shape,\n        s.shape_id_planejado,\n        s.trip_id,\n        s.trip_id_planejado,\n        s.sentido,\n        s.start_pt,\n        s.end_pt,\n        s.distancia_planejada,\n        ifnull(g.distancia,0) as distancia,\n        case\n            when ST_DWITHIN(g.posicao_veiculo_geo, start_pt, 500)\n            then 'start'\n            when ST_DWITHIN(g.posicao_veiculo_geo, end_pt, 500)\n            then 'end'\n            when ST_DWITHIN(g.posicao_veiculo_geo, shape, 500)\n            then 'middle'\n        else 'out'\n        end status_viagem\n    from\n        gps g\n    inner join (\n        select\n            *\n        from\n            `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n        where\n            \n            data between date_sub(date(\"2022-01-01T01:00:00\"), interval 1 day) and date(\"2022-01-01T01:00:00\")\n            \n    ) s\n    on\n        \n        g.data = s.data\n        \n        and g.servico = s.servico\n)\nselect\n    *,\n    '' as versao_modelo\nfrom\n    status_viagem\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagem_planejada": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "viagem_planejada", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/viagem_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/viagem_planejada.sql", "unique_id": "model.rj_smtr.viagem_planejada", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "viagem_planejada"], "alias": "viagem_planejada", "checksum": {"name": "sha256", "checksum": "c4a8d9ba62abe2f54fbdba04651368e63a28eb39f96a193e8e4156d9346b7325"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "trip_id"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela hist\u00f3rica com detalhes das viagens planejadas a cada dia", "columns": {"consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio ao qual o servi\u00e7o pertence.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_shape": {"name": "data_shape", "description": "Data do shape capturado no SIGMOB (00h) (V\u00e1lida at\u00e9 2024-03-30).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, S\u00e1bado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido planejado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "partidas": {"name": "partidas", "description": "Quantidade de partidas planejadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "In\u00edcio do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Fim do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "description": "Hor\u00e1rio inicial da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_fim": {"name": "faixa_horaria_fim", "description": "Hor\u00e1rio final da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "intervalo": {"name": "intervalo", "description": "Intervalo de sa\u00edda planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "variacao_itinerario": {"name": "variacao_itinerario", "description": "Varia\u00e7\u00e3o dee itiner\u00e1rio da viagem - categorias: DD, DU, SS, RT, RM, DA, SA", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape": {"name": "shape", "description": "Linestring dos pontos gelocalizados do trajeto", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado em KM", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia total planejada do servi\u00e7o em KM (junta ida+volta).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id_planejado": {"name": "trip_id_planejado", "description": "C\u00f3digo identificador de trip de refer\u00eancia no GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "C\u00f3digo identificador de trip de refer\u00eancia no GTFS com ajustes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador de shape no GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id_planejado": {"name": "shape_id_planejado", "description": "C\u00f3digo identificador de shape no GTFS com ajustes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_pt": {"name": "start_pt", "description": "Ponto inicial do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_pt": {"name": "end_pt", "description": "Ponto final do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_tipo_trajeto": {"name": "id_tipo_trajeto", "description": "Tipo de trajeto (0 - Regular, 1 - Alternativo, v\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS (V\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "trip_id"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.9020884, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`", "raw_code": "{{ config(\r\n    materialized='incremental',\r\n        partition_by={\r\n        \"field\":\"data\",\r\n        \"data_type\": \"date\",\r\n        \"granularity\":\"day\"\r\n    },\r\n    unique_key=['data', 'trip_id'],\r\n    incremental_strategy='insert_overwrite'\r\n)\r\n}}\r\n\r\n{% if var(\"run_date\") <= var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n\r\n-- 1. Define datas do per\u00edodo planejado\r\nwith data_efetiva as (\r\n    select\r\n        data,\r\n        tipo_dia,\r\n        data_versao_shapes,\r\n        data_versao_trips,\r\n        data_versao_frequencies\r\n    from {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n    where data between date_sub(\"{{ var(\"run_date\") }}\", interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n),\r\n-- 2. Puxa dados de distancia quadro no quadro hor\u00e1rio\r\nquadro as (\r\n    select\r\n        e.data,\r\n        e.tipo_dia,\r\n        p.* except(tipo_dia, data_versao, horario_inicio, horario_fim),\r\n        IF(horario_inicio IS NOT NULL AND ARRAY_LENGTH(SPLIT(horario_inicio, \":\")) = 3,\r\n            DATETIME_ADD(\r\n                DATETIME(\r\n                    e.data,\r\n                    PARSE_TIME(\"%T\",\r\n                        CONCAT(\r\n                        SAFE_CAST(MOD(SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                        \":\",\r\n                        SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(1)] AS INT64),\r\n                        \":\",\r\n                        SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(2)] AS INT64)\r\n                        )\r\n                    )\r\n                ),\r\n                INTERVAL DIV(SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n            ),\r\n            NULL\r\n        ) AS inicio_periodo,\r\n        IF(horario_fim IS NOT NULL AND ARRAY_LENGTH(SPLIT(horario_fim, \":\")) = 3,\r\n            DATETIME_ADD(\r\n                DATETIME(\r\n                    e.data,\r\n                    PARSE_TIME(\"%T\",\r\n                        CONCAT(\r\n                        SAFE_CAST(MOD(SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                        \":\",\r\n                        SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(1)] AS INT64),\r\n                        \":\",\r\n                        SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(2)] AS INT64)\r\n                        )\r\n                    )\r\n                ),\r\n                INTERVAL DIV(SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n            ),\r\n            NULL\r\n        ) AS fim_periodo\r\n    from\r\n        data_efetiva e\r\n    inner join (\r\n        select *\r\n        from {{ ref(\"subsidio_quadro_horario\") }}\r\n        {% if is_incremental() %}\r\n        where\r\n            data_versao in (select data_versao_frequencies from data_efetiva)\r\n        {% endif %}\r\n    ) p\r\n    on\r\n        e.data_versao_frequencies = p.data_versao\r\n    and\r\n        e.tipo_dia = p.tipo_dia\r\n),\r\n-- 3. Trata informa\u00e7\u00e3o de trips: adiciona ao sentido da trip o sentido\r\n--    planejado (os shapes/trips circulares s\u00e3o separados em\r\n--    ida/volta no sigmob)\r\ntrips as (\r\n    select\r\n        e.data,\r\n        t.*\r\n    from (\r\n        select *\r\n        from {{ ref('subsidio_trips_desaninhada') }}\r\n        {% if is_incremental() %}\r\n        where\r\n            data_versao in (select data_versao_trips from data_efetiva)\r\n        {% endif %}\r\n    ) t\r\n    inner join\r\n        data_efetiva e\r\n    on\r\n        t.data_versao = e.data_versao_trips\r\n),\r\nquadro_trips as (\r\n    select\r\n        *\r\n    from (\r\n        select distinct\r\n            * except(trip_id),\r\n            trip_id as trip_id_planejado,\r\n            trip_id\r\n        from\r\n            quadro\r\n        where sentido = \"I\" or sentido = \"V\"\r\n    )\r\n    union all (\r\n        select\r\n            * except(trip_id),\r\n            trip_id as trip_id_planejado,\r\n            concat(trip_id, \"_0\") as trip_id,\r\n        from\r\n            quadro\r\n        where sentido = \"C\"\r\n    )\r\n    union all (\r\n        select\r\n            * except(trip_id),\r\n            trip_id as trip_id_planejado,\r\n            concat(trip_id, \"_1\") as trip_id,\r\n        from\r\n            quadro\r\n        where sentido = \"C\"\r\n    )\r\n),\r\nquadro_tratada as (\r\n    select\r\n        q.*,\r\n        t.shape_id as shape_id_planejado,\r\n        case\r\n            when sentido = \"C\"\r\n            then shape_id || \"_\" || split(q.trip_id, \"_\")[offset(1)]\r\n            else shape_id\r\n        end as shape_id, -- TODO: adicionar no sigmob\r\n    from\r\n        quadro_trips q\r\n    left join\r\n        trips t\r\n    on\r\n        t.data = q.data\r\n    and\r\n        t.trip_id = q.trip_id_planejado\r\n),\r\n-- 4. Trata informa\u00e7\u00f5es de shapes: junta trips e shapes para resgatar o sentido\r\n--    planejado (os shapes/trips circulares s\u00e3o separados em\r\n--    ida/volta no sigmob)\r\nshapes as (\r\n    select\r\n        e.data,\r\n        data_versao as data_shape,\r\n        shape_id,\r\n        shape,\r\n        start_pt,\r\n        end_pt\r\n    from\r\n        data_efetiva e\r\n    inner join (\r\n        select *\r\n        from {{ ref('subsidio_shapes_geom') }}\r\n        {% if is_incremental() %}\r\n        where\r\n            data_versao in (select data_versao_shapes from data_efetiva)\r\n        {% endif %}\r\n    ) s\r\n    on\r\n        s.data_versao = e.data_versao_shapes\r\n)\r\n-- 5. Junta shapes e trips aos servicos planejados no quadro hor\u00e1rio\r\nselect\r\n    p.*,\r\n    s.data_shape,\r\n    s.shape,\r\n    case\r\n        when p.sentido = \"C\" and split(p.shape_id, \"_\")[offset(1)] = \"0\" then \"I\"\r\n        when p.sentido = \"C\" and split(p.shape_id, \"_\")[offset(1)] = \"1\" then \"V\"\r\n        when p.sentido = \"I\" or p.sentido = \"V\" then p.sentido\r\n    end as sentido_shape,\r\n    s.start_pt,\r\n    s.end_pt,\r\n    SAFE_CAST(NULL AS INT64) AS id_tipo_trajeto, -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V6\r\n    SAFE_CAST(NULL AS STRING) AS feed_version, -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V6\r\n    CURRENT_DATETIME(\"America/Sao_Paulo\") AS datetime_ultima_atualizacao -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V7\r\nfrom\r\n    quadro_tratada p\r\ninner join\r\n    shapes s\r\non\r\n    p.shape_id = s.shape_id\r\nand\r\n    p.data = s.data\r\n\r\n{% else %}\r\n{% if execute %}\r\n    {% set result = run_query(\"SELECT tipo_os, feed_version, feed_start_date, tipo_dia FROM \" ~ ref('subsidio_data_versao_efetiva') ~ \" WHERE data BETWEEN DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 2 DAY) AND DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 1 DAY) ORDER BY data\") %}\r\n    {% set tipo_oss =  result.columns[0].values() %}\r\n    {% set feed_versions =  result.columns[1].values() %}\r\n    {% set feed_start_dates =  result.columns[2].values() %}\r\n    {% set tipo_dias =  result.columns[3].values() %}\r\n{% endif %}\r\n\r\nWITH\r\n-- 1. Define datas do per\u00edodo planejado\r\n  data_versao_efetiva AS (\r\n  SELECT\r\n    DATA,\r\n    tipo_dia,\r\n    subtipo_dia,\r\n    feed_version,\r\n    feed_start_date,\r\n    tipo_os,\r\n  FROM\r\n    {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n    -- rj-smtr.projeto_subsidio_sppo.subsidio_data_versao_efetiva\r\n  WHERE\r\n    data BETWEEN DATE_SUB(\"{{ var('run_date') }}\", INTERVAL 2 DAY) AND DATE_SUB(\"{{ var('run_date') }}\", INTERVAL 1 DAY)\r\n  ),\r\n  -- 2. Busca partidas e quilometragem da faixa horaria (dia anterior)\r\n  dia_anterior AS (\r\n    SELECT\r\n    \"{{ feed_versions[1] }}\" AS feed_version,\r\n    DATE(\"{{ feed_start_dates[1] }}\") AS feed_start_date,\r\n    feed_end_date,\r\n    \"{{ tipo_oss[1] }}\" AS tipo_os,\r\n    \"{{ tipo_dias[1] }}\" AS tipo_dia,\r\n    servico,\r\n    vista,\r\n    consorcio,\r\n    sentido,\r\n    partidas_total_planejada,\r\n    distancia_planejada,\r\n    distancia_total_planejada,\r\n    inicio_periodo,\r\n    fim_periodo,\r\n    \"00:00:00\" AS faixa_horaria_inicio,\r\n    \"02:59:59\" AS faixa_horaria_fim,\r\n    trip_id_planejado,\r\n    trip_id,\r\n    shape_id,\r\n    shape_id_planejado,\r\n    shape,\r\n    sentido_shape,\r\n    start_pt,\r\n    end_pt,\r\n    id_tipo_trajeto,\r\n    FROM\r\n      {{ ref(\"ordem_servico_trips_shapes_gtfs\") }}\r\n      -- rj-smtr.gtfs.ordem_servico_trips_shapes\r\n    WHERE\r\n      faixa_horaria_inicio = \"24:00:00\"\r\n      AND tipo_os = \"{{ tipo_oss[0] }}\"\r\n      AND feed_version = \"{{ feed_versions[0] }}\"\r\n      AND feed_start_date = DATE(\"{{ feed_start_dates[0] }}\")\r\n      AND tipo_dia = \"{{ tipo_dias[0] }}\"\r\n  ),\r\n  trips AS (\r\n    SELECT DISTINCT\r\n        feed_version,\r\n        feed_start_date,\r\n        tipo_os,\r\n        tipo_dia,\r\n        servico,\r\n        sentido,\r\n        trip_id_planejado,\r\n        trip_id,\r\n    FROM\r\n      {{ ref(\"ordem_servico_trips_shapes_gtfs\") }}\r\n    --   rj-smtr.gtfs.ordem_servico_trips_shapes\r\n    WHERE\r\n      tipo_os = \"{{ tipo_oss[1] }}\"\r\n      AND feed_version = \"{{ feed_versions[1] }}\"\r\n      AND feed_start_date = DATE(\"{{ feed_start_dates[1] }}\")\r\n      AND tipo_dia = \"{{ tipo_dias[1] }}\"\r\n    ),\r\ncombina_trips_shapes AS (\r\n    SELECT\r\n        feed_version,\r\n        feed_start_date,\r\n        feed_end_date,\r\n        tipo_os,\r\n        tipo_dia,\r\n        servico,\r\n        vista,\r\n        consorcio,\r\n        sentido,\r\n        partidas_total_planejada,\r\n        distancia_planejada,\r\n        distancia_total_planejada,\r\n        inicio_periodo,\r\n        fim_periodo,\r\n        faixa_horaria_inicio,\r\n        faixa_horaria_fim,\r\n        shape_id,\r\n        shape_id_planejado,\r\n        sentido_shape,\r\n        id_tipo_trajeto,\r\n    FROM\r\n      {{ ref(\"ordem_servico_trips_shapes_gtfs\") }}\r\n    --   rj-smtr.gtfs.ordem_servico_trips_shapes\r\n    WHERE\r\n      tipo_os = \"{{ tipo_oss[1] }}\"\r\n      AND feed_version = \"{{ feed_versions[1] }}\"\r\n      AND feed_start_date = DATE(\"{{ feed_start_dates[1] }}\")\r\n      AND tipo_dia = \"{{ tipo_dias[1] }}\"\r\n    UNION ALL\r\n    SELECT\r\n        feed_version,\r\n        feed_start_date,\r\n        feed_end_date,\r\n        tipo_os,\r\n        tipo_dia,\r\n        servico,\r\n        vista,\r\n        consorcio,\r\n        sentido,\r\n        partidas_total_planejada,\r\n        distancia_planejada,\r\n        distancia_total_planejada,\r\n        inicio_periodo,\r\n        fim_periodo,\r\n        faixa_horaria_inicio,\r\n        faixa_horaria_fim,\r\n        shape_id,\r\n        shape_id_planejado,\r\n        sentido_shape,\r\n        id_tipo_trajeto,\r\n    FROM dia_anterior\r\n),\r\ndata_trips_shapes AS (SELECT\r\n  d.data,\r\n  CASE\r\n    WHEN subtipo_dia IS NOT NULL THEN CONCAT(o.tipo_dia, \" - \", subtipo_dia)\r\n    ELSE o.tipo_dia\r\n  END AS tipo_dia,\r\n  servico,\r\n  vista,\r\n  consorcio,\r\n  sentido,\r\n  partidas_total_planejada,\r\n  distancia_planejada,\r\n  distancia_total_planejada,\r\n  IF(inicio_periodo IS NOT NULL AND ARRAY_LENGTH(SPLIT(inicio_periodo, \":\")) = 3,\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(inicio_periodo, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(inicio_periodo, \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(inicio_periodo, \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(inicio_periodo, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    ),\r\n    NULL\r\n  ) AS inicio_periodo,\r\n  IF(fim_periodo IS NOT NULL AND ARRAY_LENGTH(SPLIT(fim_periodo, \":\")) = 3,\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(fim_periodo, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(fim_periodo, \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(fim_periodo, \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(fim_periodo, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    ),\r\n    NULL\r\n  ) AS fim_periodo,\r\n  IF(d.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}\"),\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(o.faixa_horaria_inicio, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(o.faixa_horaria_inicio, \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(o.faixa_horaria_inicio, \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(o.faixa_horaria_inicio, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    ),\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(\"00:00:00\", \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(\"00:00:00\", \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(\"00:00:00\", \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(\"00:00:00\", \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    )\r\n  ) AS faixa_horaria_inicio,\r\n  IF(d.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}\"),\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(o.faixa_horaria_fim, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(o.faixa_horaria_fim, \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(o.faixa_horaria_fim, \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(o.faixa_horaria_fim, \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    ),\r\n    DATETIME_ADD(\r\n        DATETIME(\r\n            d.data,\r\n            PARSE_TIME(\"%T\",\r\n                CONCAT(\r\n                SAFE_CAST(MOD(SAFE_CAST(SPLIT(\"23:59:59\", \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(\"23:59:59\", \":\")[OFFSET(1)] AS INT64),\r\n                \":\",\r\n                SAFE_CAST(SPLIT(\"23:59:59\", \":\")[OFFSET(2)] AS INT64)\r\n                )\r\n            )\r\n        ),\r\n        INTERVAL DIV(SAFE_CAST(SPLIT(\"23:59:59\", \":\")[OFFSET(0)] AS INT64), 24) DAY\r\n    )\r\n  ) AS faixa_horaria_fim,\r\n  t.trip_id_planejado,\r\n  t.trip_id,\r\n  shape_id,\r\n  shape_id_planejado,\r\n  SAFE_CAST(NULL AS DATE) AS data_shape,\r\n  sentido_shape,\r\n  id_tipo_trajeto,\r\n  feed_version,\r\n  feed_start_date\r\nFROM\r\n  data_versao_efetiva AS d\r\nLEFT JOIN\r\n  combina_trips_shapes AS o\r\nUSING (feed_start_date, feed_version, tipo_dia, tipo_os)\r\nLEFT JOIN\r\n  trips AS t\r\nUSING (feed_start_date, feed_version, tipo_dia, tipo_os, servico, sentido)\r\nWHERE\r\n  data = DATE_SUB(\"{{ var('run_date') }}\", INTERVAL 1 DAY)\r\n  AND faixa_horaria_inicio != \"24:00:00\"\r\n),\r\nshapes AS (\r\n  SELECT\r\n    *\r\n  FROM\r\n    {{ ref(\"shapes_geom_gtfs\") }}\r\n    -- rj-smtr.gtfs.shapes_geom\r\n  WHERE\r\n    feed_start_date IN (SELECT feed_start_date FROM data_versao_efetiva WHERE data BETWEEN DATE_SUB(\"{{ var('run_date') }}\", INTERVAL 2 DAY) AND DATE_SUB(\"{{ var('run_date') }}\", INTERVAL 1 DAY))\r\n),\r\ndados_agregados AS (\r\nSELECT\r\n  data,\r\n  tipo_dia,\r\n  servico,\r\n  vista,\r\n  consorcio,\r\n  sentido,\r\n  SUM(COALESCE(partidas_total_planejada, 0)) AS partidas_total_planejada,\r\n  distancia_planejada,\r\n  SUM(distancia_total_planejada) AS distancia_total_planejada,\r\n  inicio_periodo,\r\n  fim_periodo,\r\n  faixa_horaria_inicio,\r\n  faixa_horaria_fim,\r\n  trip_id_planejado,\r\n  trip_id,\r\n  shape_id,\r\n  shape_id_planejado,\r\n  data_shape,\r\n  sentido_shape,\r\n  id_tipo_trajeto,\r\n  feed_version,\r\n  feed_start_date\r\nFROM\r\n  data_trips_shapes\r\nGROUP BY\r\n  data, tipo_dia, servico, vista, consorcio, sentido, distancia_planejada, inicio_periodo, fim_periodo, faixa_horaria_inicio, faixa_horaria_fim, trip_id_planejado, trip_id, shape_id, shape_id_planejado, data_shape, sentido_shape, id_tipo_trajeto, feed_version, feed_start_date\r\n)\r\nSELECT\r\n  data,\r\n  tipo_dia,\r\n  servico,\r\n  vista,\r\n  consorcio,\r\n  sentido,\r\n  partidas_total_planejada,\r\n  distancia_planejada,\r\n  distancia_total_planejada,\r\n  inicio_periodo,\r\n  fim_periodo,\r\n  faixa_horaria_inicio,\r\n  faixa_horaria_fim,\r\n  trip_id_planejado,\r\n  trip_id,\r\n  shape_id,\r\n  shape_id_planejado,\r\n  data_shape,\r\n  s.shape,\r\n  sentido_shape,\r\n  s.start_pt,\r\n  s.end_pt,\r\n  id_tipo_trajeto,\r\n  feed_version,\r\n  feed_start_date,\r\n  CURRENT_DATETIME(\"America/Sao_Paulo\") AS datetime_ultima_atualizacao\r\nFROM\r\n  dados_agregados\r\nLEFT JOIN\r\n  shapes AS s\r\nUSING\r\n  (feed_version, feed_start_date, shape_id)\r\n{% if var(\"run_date\") == \"2024-05-05\" %}\r\n  -- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\nWHERE\r\n  AND servico != \"SE001\"\r\n  {% endif %}\r\n{% endif %}", "language": "sql", "refs": [{"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "subsidio_quadro_horario", "package": null, "version": null}, {"name": "subsidio_trips_desaninhada", "package": null, "version": null}, {"name": "subsidio_shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.subsidio_quadro_horario", "model.rj_smtr.subsidio_trips_desaninhada", "model.rj_smtr.subsidio_shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/viagem_planejada.sql", "compiled": true, "compiled_code": "\n\n\n\n-- 1. Define datas do per\u00edodo planejado\nwith data_efetiva as (\n    select\n        data,\n        tipo_dia,\n        data_versao_shapes,\n        data_versao_trips,\n        data_versao_frequencies\n    from `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n    where data between date_sub(\"2022-01-01T01:00:00\", interval 1 day) and date(\"2022-01-01T01:00:00\")\n),\n-- 2. Puxa dados de distancia quadro no quadro hor\u00e1rio\nquadro as (\n    select\n        e.data,\n        e.tipo_dia,\n        p.* except(tipo_dia, data_versao, horario_inicio, horario_fim),\n        IF(horario_inicio IS NOT NULL AND ARRAY_LENGTH(SPLIT(horario_inicio, \":\")) = 3,\n            DATETIME_ADD(\n                DATETIME(\n                    e.data,\n                    PARSE_TIME(\"%T\",\n                        CONCAT(\n                        SAFE_CAST(MOD(SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\n                        \":\",\n                        SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(1)] AS INT64),\n                        \":\",\n                        SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(2)] AS INT64)\n                        )\n                    )\n                ),\n                INTERVAL DIV(SAFE_CAST(SPLIT(horario_inicio, \":\")[OFFSET(0)] AS INT64), 24) DAY\n            ),\n            NULL\n        ) AS inicio_periodo,\n        IF(horario_fim IS NOT NULL AND ARRAY_LENGTH(SPLIT(horario_fim, \":\")) = 3,\n            DATETIME_ADD(\n                DATETIME(\n                    e.data,\n                    PARSE_TIME(\"%T\",\n                        CONCAT(\n                        SAFE_CAST(MOD(SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(0)] AS INT64), 24) AS INT64),\n                        \":\",\n                        SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(1)] AS INT64),\n                        \":\",\n                        SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(2)] AS INT64)\n                        )\n                    )\n                ),\n                INTERVAL DIV(SAFE_CAST(SPLIT(horario_fim, \":\")[OFFSET(0)] AS INT64), 24) DAY\n            ),\n            NULL\n        ) AS fim_periodo\n    from\n        data_efetiva e\n    inner join (\n        select *\n        from `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_quadro_horario`\n        \n        where\n            data_versao in (select data_versao_frequencies from data_efetiva)\n        \n    ) p\n    on\n        e.data_versao_frequencies = p.data_versao\n    and\n        e.tipo_dia = p.tipo_dia\n),\n-- 3. Trata informa\u00e7\u00e3o de trips: adiciona ao sentido da trip o sentido\n--    planejado (os shapes/trips circulares s\u00e3o separados em\n--    ida/volta no sigmob)\ntrips as (\n    select\n        e.data,\n        t.*\n    from (\n        select *\n        from `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_trips_desaninhada`\n        \n        where\n            data_versao in (select data_versao_trips from data_efetiva)\n        \n    ) t\n    inner join\n        data_efetiva e\n    on\n        t.data_versao = e.data_versao_trips\n),\nquadro_trips as (\n    select\n        *\n    from (\n        select distinct\n            * except(trip_id),\n            trip_id as trip_id_planejado,\n            trip_id\n        from\n            quadro\n        where sentido = \"I\" or sentido = \"V\"\n    )\n    union all (\n        select\n            * except(trip_id),\n            trip_id as trip_id_planejado,\n            concat(trip_id, \"_0\") as trip_id,\n        from\n            quadro\n        where sentido = \"C\"\n    )\n    union all (\n        select\n            * except(trip_id),\n            trip_id as trip_id_planejado,\n            concat(trip_id, \"_1\") as trip_id,\n        from\n            quadro\n        where sentido = \"C\"\n    )\n),\nquadro_tratada as (\n    select\n        q.*,\n        t.shape_id as shape_id_planejado,\n        case\n            when sentido = \"C\"\n            then shape_id || \"_\" || split(q.trip_id, \"_\")[offset(1)]\n            else shape_id\n        end as shape_id, -- TODO: adicionar no sigmob\n    from\n        quadro_trips q\n    left join\n        trips t\n    on\n        t.data = q.data\n    and\n        t.trip_id = q.trip_id_planejado\n),\n-- 4. Trata informa\u00e7\u00f5es de shapes: junta trips e shapes para resgatar o sentido\n--    planejado (os shapes/trips circulares s\u00e3o separados em\n--    ida/volta no sigmob)\nshapes as (\n    select\n        e.data,\n        data_versao as data_shape,\n        shape_id,\n        shape,\n        start_pt,\n        end_pt\n    from\n        data_efetiva e\n    inner join (\n        select *\n        from `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_shapes_geom`\n        \n        where\n            data_versao in (select data_versao_shapes from data_efetiva)\n        \n    ) s\n    on\n        s.data_versao = e.data_versao_shapes\n)\n-- 5. Junta shapes e trips aos servicos planejados no quadro hor\u00e1rio\nselect\n    p.*,\n    s.data_shape,\n    s.shape,\n    case\n        when p.sentido = \"C\" and split(p.shape_id, \"_\")[offset(1)] = \"0\" then \"I\"\n        when p.sentido = \"C\" and split(p.shape_id, \"_\")[offset(1)] = \"1\" then \"V\"\n        when p.sentido = \"I\" or p.sentido = \"V\" then p.sentido\n    end as sentido_shape,\n    s.start_pt,\n    s.end_pt,\n    SAFE_CAST(NULL AS INT64) AS id_tipo_trajeto, -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V6\n    SAFE_CAST(NULL AS STRING) AS feed_version, -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V6\n    CURRENT_DATETIME(\"America/Sao_Paulo\") AS datetime_ultima_atualizacao -- Adapta\u00e7\u00e3o para formato da SUBSIDIO_V7\nfrom\n    quadro_tratada p\ninner join\n    shapes s\non\n    p.shape_id = s.shape_id\nand\n    p.data = s.data\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.registros_status_viagem": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "registros_status_viagem", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/registros_status_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/registros_status_viagem.sql", "unique_id": "model.rj_smtr.registros_status_viagem", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "registros_status_viagem"], "alias": "registros_status_viagem", "checksum": {"name": "sha256", "checksum": "ed22773989975813fccb4493015e9011cf4bc8063f87d69c4f4517a41dd4d651"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["timestamp_gps", "id_veiculo"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Registros de GPS clasificados por viagem.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_minuto_gps": {"name": "timestamp_minuto_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS truncado em minutos (para fins de compara\u00e7\u00e3o com minutos da viagem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "posicao_veiculo_geo": {"name": "posicao_veiculo_geo", "description": "Geolocaliza\u00e7\u00e3o do ve\u00edculo segundo o sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Outro servi\u00e7o da empresa que o ve\u00edculo pode estar operando", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o realizado ", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia geod\u00e9sica da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o a posi\u00e7\u00e3o atual", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status_viagem": {"name": "status_viagem", "description": "Indica se a posi\u00e7\u00e3o do GPS est\u00e1 no in\u00edcio (start), meio (middle), fim (end) ou fora (out) do shape do servi\u00e7o informado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["timestamp_gps", "id_veiculo"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.9117227, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`", "raw_code": "{{ config(\r\n       materialized='incremental',\r\n       partition_by={\r\n              \"field\":\"data\",\r\n              \"data_type\": \"date\",\r\n              \"granularity\":\"day\"\r\n       },\r\n       unique_key=['timestamp_gps', 'id_veiculo'],\r\n       incremental_strategy='insert_overwrite'\r\n)\r\n}}\r\n\r\n-- 1. Identifica registros pertencentes a viagens\r\nwith registros_viagem as (\r\n    select\r\n    s.* except(versao_modelo),\r\n    datetime_partida,\r\n    datetime_chegada,\r\n    distancia_inicio_fim,\r\n    id_viagem\r\n    from\r\n        {{ ref(\"aux_registros_status_trajeto\") }} s\r\n    left join (\r\n    select\r\n        id_veiculo,\r\n        trip_id,\r\n        servico_realizado,\r\n        sentido_shape,\r\n        id_viagem,\r\n        datetime_partida,\r\n        datetime_chegada,\r\n        distancia_inicio_fim\r\n    from\r\n        {{ ref(\"aux_viagem_circular\") }}\r\n    ) v\r\n    on\r\n    s.id_veiculo = v.id_veiculo\r\n    and s.trip_id = v.trip_id\r\n    and s.timestamp_gps between v.datetime_partida and v.datetime_chegada\r\n)\r\n-- 2. Filtra apenas registros de viagens identificadas\r\nselect\r\n    *,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    registros_viagem\r\nwhere\r\n    id_viagem is not null", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}, {"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_registros_status_trajeto", "model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/registros_status_viagem.sql", "compiled": true, "compiled_code": "\n\n-- 1. Identifica registros pertencentes a viagens\nwith registros_viagem as (\n    select\n    s.* except(versao_modelo),\n    datetime_partida,\n    datetime_chegada,\n    distancia_inicio_fim,\n    id_viagem\n    from\n        `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto` s\n    left join (\n    select\n        id_veiculo,\n        trip_id,\n        servico_realizado,\n        sentido_shape,\n        id_viagem,\n        datetime_partida,\n        datetime_chegada,\n        distancia_inicio_fim\n    from\n        `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\n    ) v\n    on\n    s.id_veiculo = v.id_veiculo\n    and s.trip_id = v.trip_id\n    and s.timestamp_gps between v.datetime_partida and v.datetime_chegada\n)\n-- 2. Filtra apenas registros de viagens identificadas\nselect\n    *,\n    '' as versao_modelo\nfrom\n    registros_viagem\nwhere\n    id_viagem is not null", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_data_versao_efetiva": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "subsidio_data_versao_efetiva", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/subsidio_data_versao_efetiva.sql", "original_file_path": "models/projeto_subsidio_sppo/subsidio_data_versao_efetiva.sql", "unique_id": "model.rj_smtr.subsidio_data_versao_efetiva", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "subsidio_data_versao_efetiva"], "alias": "subsidio_data_versao_efetiva", "checksum": {"name": "sha256", "checksum": "9429a1ce90975e1493074c53348a8615f2d35b1e4d57fe8a80c2e9b7be10f3b5"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Relacionamento entre datas de opera\u00e7\u00e3o de planejamento dos servi\u00e7os.", "columns": {"data": {"name": "data", "description": "(Parti\u00e7\u00e3o) Data de Opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, Sabado, Domingo e Ponto Facultativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subtipo_dia": {"name": "subtipo_dia", "description": "Subtipo de dia (ex: 'Ver\u00e3o', v\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_trips": {"name": "data_versao_trips", "description": "Data da vers\u00e3o de planejamento de trips (Descontinuada a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_shapes": {"name": "data_versao_shapes", "description": "Data da vers\u00e3o de planejamento de shapes (Descontinuada a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_frequencies": {"name": "data_versao_frequencies", "description": "Data da vers\u00e3o de planejamento de frequencies (Descontinuada a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_subsidio_por_km": {"name": "valor_subsidio_por_km", "description": "Valor do subs\u00eddio (R$/km) (Descontinuada a partir de 2023-01-07).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "Data inicial do feed (vers\u00e3o, v\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS (V\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_os": {"name": "tipo_os", "description": "Tipo de Ordem de Servi\u00e7o (ex: 'Regular', 'Extraordin\u00e1ria - Ver\u00e3o', v\u00e1lida a partir de 2024-04-01).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.9298916, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`", "raw_code": "{{\r\n  config(\r\n    materialized=\"incremental\",\r\n    partition_by={\r\n      \"field\":\"data\",\r\n      \"data_type\": \"date\",\r\n      \"granularity\":\"day\"\r\n    },\r\n    incremental_strategy=\"insert_overwrite\"\r\n  )\r\n}}\r\n\r\n{% if var(\"run_date\") <= var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n{% if execute %}\r\n  {% set trips_date = run_query(\"SELECT MAX(data_versao) FROM \" ~ ref(\"subsidio_trips_desaninhada\") ~ \" WHERE data_versao >= DATE_TRUNC(DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 30 DAY), MONTH)\").columns[0].values()[0] %}\r\n  {% set shapes_date = run_query(\"SELECT MAX(data_versao) FROM \" ~ var(\"subsidio_shapes\") ~ \" WHERE data_versao >= DATE_TRUNC(DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 30 DAY), MONTH)\").columns[0].values()[0] %}\r\n  {% set frequencies_date = run_query(\"SELECT MAX(data_versao) FROM \" ~ ref(\"subsidio_quadro_horario\") ~ \" WHERE data_versao >= DATE_TRUNC(DATE_SUB(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 30 DAY), MONTH)\").columns[0].values()[0] %}\r\n{% endif %}\r\n\r\nWITH\r\n  dates AS (\r\n  SELECT\r\n    data,\r\n    CASE\r\n        WHEN data = \"2022-06-16\" THEN \"Domingo\"\r\n        WHEN data = \"2022-06-17\" THEN \"Sabado\"\r\n        WHEN data = \"2022-09-02\" THEN \"Sabado\"\r\n        WHEN data = \"2022-09-07\" THEN \"Domingo\"\r\n        WHEN data = \"2022-10-12\" THEN \"Domingo\"\r\n        WHEN data = \"2022-10-17\" THEN \"Sabado\"\r\n        WHEN data = \"2022-11-02\" THEN \"Domingo\"\r\n        WHEN data = \"2022-11-14\" THEN \"Sabado\"\r\n        WHEN data = \"2022-11-15\" THEN \"Domingo\"\r\n        WHEN data = \"2022-11-24\" THEN \"Sabado\"\r\n        WHEN data = \"2022-11-28\" THEN \"Sabado\"\r\n        WHEN data = \"2022-12-02\" THEN \"Sabado\"\r\n        WHEN data = \"2022-12-05\" THEN \"Sabado\"\r\n        WHEN data = \"2022-12-09\" THEN \"Sabado\"\r\n        WHEN data = \"2023-04-06\" THEN \"Sabado\" -- Ponto Facultativo - DECRETO RIO N\u00ba 52275/2023\r\n        WHEN data = \"2023-04-07\" THEN \"Domingo\" -- Paix\u00e3o de Cristo -- Art. 1\u00ba, V - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN data = \"2023-06-08\" THEN \"Domingo\" -- Corpus Christi - Lei n\u00ba 336/1949 - OF\u00cdCIO N\u00ba MTR-OFI-2023/03260 (MTROFI202303260A)\r\n        WHEN data = \"2023-06-09\" THEN \"Sabado\" -- Ponto Facultativo - DECRETO RIO N\u00ba 52584/2023\r\n        WHEN data = \"2023-09-08\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53137/2023\r\n        WHEN data = \"2023-10-13\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53296/2023\r\n        WHEN data = \"2023-10-16\" THEN \"Ponto Facultativo\" -- Dia do Com\u00e9rcio - OS Outubro/Q2\r\n        WHEN data = \"2023-11-03\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53417/2023\r\n        WHEN data = \"2023-11-05\" THEN \"Sabado\" -- Domingo At\u00edpico - ENEM - OS Novembro/Q1\r\n        WHEN data = \"2023-11-12\" THEN \"Sabado\" -- Domingo At\u00edpico - ENEM - OS Novembro/Q1\r\n        WHEN data = \"2023-12-02\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2023-12-03\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2023-12-16\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2023-12-17\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2024-01-06\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2024-01-07\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\r\n        WHEN data = \"2024-02-09\" THEN \"Ponto Facultativo\" -- Despacho MTR-DES-2024/07951\r\n        WHEN data = \"2024-02-12\" THEN \"Domingo\" -- Despacho MTR-DES-2024/07951\r\n        WHEN data = \"2024-02-13\" THEN \"Domingo\" -- Despacho MTR-DES-2024/07951\r\n        WHEN data = \"2024-02-14\" THEN \"Ponto Facultativo\" -- Despacho MTR-DES-2024/07951\r\n        WHEN data = \"2023-12-31\" THEN \"Domingo - R\u00e9veillon\"\r\n        WHEN data = \"2024-01-01\" THEN \"Domingo - R\u00e9veillon\"\r\n        WHEN data = \"2024-02-24\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/10516\r\n        WHEN data = \"2024-02-25\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/10516\r\n        WHEN data = \"2024-03-16\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/15504\r\n        WHEN data = \"2024-03-17\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/15504\r\n        WHEN data = \"2024-03-22\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 54114/2024\r\n        WHEN data = \"2024-03-28\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 54081/2024\r\n        WHEN data = \"2024-03-29\" THEN \"Domingo\" -- Feriado de Paix\u00e3o de Cristo (Sexta-feira Santa)\r\n        WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 1 THEN \"Domingo\" -- Dia de S\u00e3o Sebasti\u00e3o -- Art. 8\u00b0, I - Lei Municipal n\u00ba 5146/2010\r\n        WHEN EXTRACT(DAY FROM data) = 23 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Dia de S\u00e3o Jorge -- Art. 8\u00b0, II - Lei Municipal n\u00ba 5146/2010 / Lei Estadual N\u00ba 5198/2008 / Lei Estadual N\u00ba 5645/2010\r\n        WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Anivers\u00e1rio de morte de Zumbi dos Palmares / Dia da Consci\u00eancia Negra -- Art. 8\u00b0, IV - Lei Municipal n\u00ba 5146/2010 / Lei Estadual n\u00ba 526/1982 / Lei Estadual n\u00ba 1929/1991 / Lei Estadual n\u00ba 4007/2002 / Lei Estadual N\u00ba 5645/2010\r\n        WHEN EXTRACT(DAY FROM data) = 21 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Tiradentes -- Art. 1\u00ba, VI - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 1 AND EXTRACT(MONTH FROM data) = 5 THEN \"Domingo\" -- Dia Mundial do Trabalho -- Art. 1\u00ba, VII - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 7 AND EXTRACT(MONTH FROM data) = 9 THEN \"Domingo\" -- Independ\u00eancia do Brasil -- Art. 1\u00ba, IX - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 12 AND EXTRACT(MONTH FROM data) = 10 THEN \"Domingo\" -- Nossa Senhora Aparecida -- Art. 1\u00ba, X - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 2 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Finados -- Art. 1\u00ba, XII - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 15 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Proclama\u00e7\u00e3o da Rep\u00fablica -- Art. 1\u00ba, XIII - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAY FROM data) = 25 AND EXTRACT(MONTH FROM data) = 12 THEN \"Domingo\" -- Natal -- Art. 1\u00ba, XIV - PORTARIA ME N\u00ba 11.090/2022\r\n        WHEN EXTRACT(DAYOFWEEK FROM data) = 1 THEN \"Domingo\"\r\n        WHEN EXTRACT(DAYOFWEEK FROM data) = 7 THEN \"Sabado\"\r\n        ELSE \"Dia \u00datil\"\r\n    END AS tipo_dia,\r\n    CASE\r\n      -- Reveillon 2022:\r\n      WHEN data = DATE(2022,12,31) THEN data\r\n      WHEN data = DATE(2023,1,1) THEN data\r\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\r\n      -- Reprocessamento:\r\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\r\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\r\n      -- Altera\u00e7\u00e3o de Planejamento\r\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\r\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\r\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\r\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\r\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\r\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\r\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\r\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\r\n      -- Reveillon 2023:\r\n      WHEN data = DATE(2023,12,31) THEN data\r\n      WHEN data = DATE(2024,01,01) THEN data\r\n      -- 2024:\r\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\r\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\r\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\r\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\r\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\r\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\r\n      -- 2022:\r\n      WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,2) THEN DATE(2022,9,16)\r\n      WHEN data BETWEEN DATE(2022,6,1) AND LAST_DAY(DATE(2022,6,30), MONTH) THEN DATE(2022,6,1)\r\n      {% for i in range(7, 13) %}\r\n        WHEN data BETWEEN DATE(2022,{{ i }},1) AND DATE(2022,{{ i }},15) THEN DATE(2022,{{ i }},1)\r\n        WHEN data BETWEEN DATE(2022,{{ i }},16) AND LAST_DAY(DATE(2022,{{ i }},30), MONTH) THEN DATE(2022,{{ i }},16)\r\n      {% endfor %}\r\n      -- 2023 a 2024:\r\n      {% for j in range(2023, 2025) %}\r\n        {% for i in range(1, 13) %}\r\n          WHEN EXTRACT(MONTH FROM data) = {{ i }} AND EXTRACT(YEAR FROM data) = {{ j }} THEN DATE({{ j }},{{ i }},1)\r\n        {% endfor %}\r\n      {% endfor %}\r\n    END AS data_versao_trips,\r\n    CASE\r\n      -- Reveillon 2022:\r\n      WHEN data = DATE(2022,12,31) THEN data\r\n      WHEN data = DATE(2023,1,1) THEN data\r\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\r\n      -- Reprocessamento:\r\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\r\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\r\n      -- Altera\u00e7\u00e3o de Planejamento\r\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\r\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\r\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\r\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\r\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\r\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\r\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\r\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\r\n      -- Reveillon 2023:\r\n      WHEN data = DATE(2023,12,31) THEN data\r\n      WHEN data = DATE(2024,01,01) THEN data\r\n      -- 2024:\r\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\r\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\r\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\r\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\r\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\r\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\r\n      -- 2022:\r\n      WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,2) THEN DATE(2022,9,16)\r\n      WHEN data BETWEEN DATE(2022,6,1) AND LAST_DAY(DATE(2022,6,30), MONTH) THEN DATE(2022,6,1)\r\n      {% for i in range(7, 13) %}\r\n        WHEN data BETWEEN DATE(2022,{{ i }},1) AND DATE(2022,{{ i }},15) THEN DATE(2022,{{ i }},1)\r\n        WHEN data BETWEEN DATE(2022,{{ i }},16) AND LAST_DAY(DATE(2022,{{ i }},30), MONTH) THEN DATE(2022,{{ i }},16)\r\n      {% endfor %}\r\n      -- 2023 a 2024:\r\n      {% for j in range(2023, 2025) %}\r\n        {% for i in range(1, 13) %}\r\n          WHEN EXTRACT(MONTH FROM data) = {{ i }} AND EXTRACT(YEAR FROM data) = {{ j }} THEN DATE({{ j }},{{ i }},1)\r\n        {% endfor %}\r\n      {% endfor %}\r\n    END AS data_versao_shapes,\r\n    CASE\r\n      -- Reveillon 2022:\r\n      WHEN data = DATE(2022,12,31) THEN data\r\n      WHEN data = DATE(2023,1,1) THEN data\r\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\r\n      -- Reprocessamento:\r\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\r\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\r\n      -- Altera\u00e7\u00e3o de Planejamento\r\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\r\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\r\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\r\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\r\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\r\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\r\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\r\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\r\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\r\n      -- Reveillon 2023:\r\n      WHEN data = DATE(2023,12,31) THEN data\r\n      WHEN data = DATE(2024,01,01) THEN data\r\n      -- 2024:\r\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\r\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\r\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\r\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\r\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\r\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\r\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\r\n      -- 2022:\r\n      {% for i in range(6, 13) %}\r\n        WHEN data BETWEEN DATE(2022,{{ i }},1) AND DATE(2022,{{ i }},15) THEN DATE(2022,{{ i }},1)\r\n        WHEN data BETWEEN DATE(2022,{{ i }},16) AND LAST_DAY(DATE(2022,{{ i }},30), MONTH) THEN DATE(2022,{{ i }},16)\r\n      {% endfor %}\r\n      -- 2023 a 2024:\r\n      {% for j in range(2023, 2025) %}\r\n        {% for i in range(1, 13) %}\r\n          WHEN EXTRACT(MONTH FROM data) = {{ i }} AND EXTRACT(YEAR FROM data) = {{ j }} THEN DATE({{ j }},{{ i }},1)\r\n        {% endfor %}\r\n      {% endfor %}\r\n    END AS data_versao_frequencies,\r\n    CASE\r\n      WHEN EXTRACT(YEAR FROM data) = 2022 THEN (\r\n        CASE\r\n          WHEN EXTRACT(MONTH FROM data) = 6 THEN 2.13\r\n          WHEN EXTRACT(MONTH FROM data) = 7 THEN 1.84\r\n          WHEN EXTRACT(MONTH FROM data) = 8 THEN 1.80\r\n          WHEN EXTRACT(MONTH FROM data) = 9 THEN 1.75\r\n          WHEN EXTRACT(MONTH FROM data) = 10 THEN 1.62\r\n          WHEN EXTRACT(MONTH FROM data) = 11 THEN 1.53\r\n          WHEN EXTRACT(MONTH FROM data) = 12 THEN 1.78\r\n        END\r\n      )\r\n      WHEN EXTRACT(YEAR FROM data) = 2023 THEN (\r\n        CASE\r\n          WHEN data <= DATE(\"2023-01-06\") THEN 3.18\r\n          ELSE 2.81\r\n        END\r\n      )\r\n    END AS valor_subsidio_por_km\r\n  FROM UNNEST(GENERATE_DATE_ARRAY(\"2022-06-01\", DATE_SUB(\"{{var('DATA_SUBSIDIO_V6_INICIO')}}\", INTERVAL 1 DAY))) AS data),\r\n  trips AS (\r\n  SELECT\r\n    DISTINCT data_versao\r\n  FROM\r\n    {{ ref(\"subsidio_trips_desaninhada\") }}\r\n  {% if is_incremental() %}\r\n  WHERE\r\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"{{ var(\"run_date\") }}\"), INTERVAL 30 DAY), MONTH)\r\n  {% endif %}\r\n  ),\r\n  shapes AS (\r\n  SELECT\r\n    DISTINCT data_versao\r\n  FROM\r\n    {{ var(\"subsidio_shapes\") }}\r\n  {% if is_incremental() %}\r\n  WHERE\r\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"{{ var(\"run_date\") }}\"), INTERVAL 30 DAY), MONTH)\r\n  {% endif %}\r\n  ),\r\n  frequencies AS (\r\n  SELECT\r\n    DISTINCT data_versao\r\n  FROM\r\n    {{ ref(\"subsidio_quadro_horario\") }}\r\n  {% if is_incremental() %}\r\n  WHERE\r\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"{{ var(\"run_date\") }}\"), INTERVAL 30 DAY), MONTH)\r\n  {% endif %}\r\n  )\r\nSELECT\r\n  data,\r\n  tipo_dia,\r\n  SAFE_CAST(NULL AS STRING) AS subtipo_dia,\r\n  COALESCE(t.data_versao, DATE(\"{{ trips_date }}\")) AS data_versao_trips,\r\n  COALESCE(s.data_versao, DATE(\"{{ shapes_date }}\")) AS data_versao_shapes,\r\n  COALESCE(f.data_versao, DATE(\"{{ frequencies_date }}\")) AS data_versao_frequencies,\r\n  valor_subsidio_por_km,\r\n  SAFE_CAST(NULL AS STRING) AS feed_version,\r\n  SAFE_CAST(NULL AS DATE)AS feed_start_date,\r\n  SAFE_CAST(NULL AS STRING) AS tipo_os,\r\nFROM\r\n  dates AS d\r\nLEFT JOIN\r\n  trips AS t\r\nON\r\n  t.data_versao = d.data_versao_trips\r\nLEFT JOIN\r\n  shapes AS s\r\nON\r\n  s.data_versao = d.data_versao_shapes\r\nLEFT JOIN\r\n  frequencies AS f\r\nON\r\n  f.data_versao = d.data_versao_frequencies\r\nWHERE\r\n{% if is_incremental() %}\r\n  data BETWEEN DATE_SUB(DATE(\"{{ var(\"run_date\") }}\"), INTERVAL 1 DAY) AND DATE(\"{{ var(\"run_date\") }}\")\r\n{% else %}\r\n  data <= DATE(\"{{ var(\"run_date\") }}\")\r\n{% endif %}\r\n\r\n{% else %}\r\n\r\nWITH\r\n  dates AS (\r\n  SELECT\r\n    data,\r\n    CASE\r\n      WHEN data = \"2024-04-22\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 54267/2024\r\n      WHEN data = \"2024-05-30\" THEN \"Domingo\" -- Feriado de Corpus Christi - (Decreto Rio N\u00ba 54525/2024)\r\n      WHEN data = \"2024-05-31\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - (Decreto Rio N\u00ba 54525/2024)\r\n      WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 1 THEN \"Domingo\" -- Dia de S\u00e3o Sebasti\u00e3o -- Art. 8\u00b0, I - Lei Municipal n\u00ba 5146/2010\r\n      WHEN EXTRACT(DAY FROM data) = 23 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Dia de S\u00e3o Jorge -- Art. 8\u00b0, II - Lei Municipal n\u00ba 5146/2010 / Lei Estadual N\u00ba 5198/2008 / Lei Estadual N\u00ba 5645/2010\r\n      WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Anivers\u00e1rio de morte de Zumbi dos Palmares / Dia da Consci\u00eancia Negra -- Art. 8\u00b0, IV - Lei Municipal n\u00ba 5146/2010 / Lei Estadual n\u00ba 526/1982 / Lei Estadual n\u00ba 1929/1991 / Lei Estadual n\u00ba 4007/2002 / Lei Estadual N\u00ba 5645/2010\r\n      WHEN EXTRACT(DAY FROM data) = 21 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Tiradentes -- Art. 1\u00ba, VI - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 1 AND EXTRACT(MONTH FROM data) = 5 THEN \"Domingo\" -- Dia Mundial do Trabalho -- Art. 1\u00ba, VII - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 7 AND EXTRACT(MONTH FROM data) = 9 THEN \"Domingo\" -- Independ\u00eancia do Brasil -- Art. 1\u00ba, IX - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 12 AND EXTRACT(MONTH FROM data) = 10 THEN \"Domingo\" -- Nossa Senhora Aparecida -- Art. 1\u00ba, X - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 2 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Finados -- Art. 1\u00ba, XII - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 15 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Proclama\u00e7\u00e3o da Rep\u00fablica -- Art. 1\u00ba, XIII - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAY FROM data) = 25 AND EXTRACT(MONTH FROM data) = 12 THEN \"Domingo\" -- Natal -- Art. 1\u00ba, XIV - PORTARIA ME N\u00ba 11.090/2022\r\n      WHEN EXTRACT(DAYOFWEEK FROM data) = 1 THEN \"Domingo\"\r\n      WHEN EXTRACT(DAYOFWEEK FROM data) = 7 THEN \"Sabado\"\r\n      ELSE \"Dia \u00datil\"\r\n    END AS tipo_dia,\r\n    CASE\r\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,17) THEN \"2024-03-11\" -- OS mar/Q1\r\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN \"2024-03-18\" -- OS mar/Q2\r\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,14) THEN \"2024-03-30\"  -- OS abr/Q1\r\n      WHEN data BETWEEN DATE(2024,04,15) AND DATE(2024,05,02) THEN \"2024-04-15\"  -- OS abr/Q2\r\n      WHEN data BETWEEN DATE(2024,05,03) AND DATE(2024,05,14) THEN \"2024-05-03\"  -- OS maio/Q1\r\n    END AS feed_version,\r\n    CASE\r\n      WHEN data = DATE(2024,05,04) THEN \"Madonna 2024-05-04\"\r\n      WHEN data = DATE(2024,05,05) THEN \"Madonna 2024-05-05\"\r\n      WHEN data = DATE(2024,08,18) THEN \"CNU\" -- Processo.Rio MTR-PRO-2024/13252\r\n      WHEN data = DATE(2024,09,14) THEN \"Extraordin\u00e1ria - Ver\u00e3o\" -- Processo.Rio\r\n      WHEN data = DATE(2024,09,15) THEN \"Extraordin\u00e1ria - Ver\u00e3o\" -- Processo.Rio\r\n      ELSE \"Regular\"\r\n    END AS tipo_os,\r\n  FROM UNNEST(GENERATE_DATE_ARRAY(\"{{var('DATA_SUBSIDIO_V6_INICIO')}}\", \"2024-12-31\")) AS data),\r\n  data_versao_efetiva_manual AS (\r\n  SELECT\r\n    data,\r\n    tipo_dia,\r\n    CASE\r\n      WHEN tipo_os = \"Extraordin\u00e1ria - Ver\u00e3o\" THEN \"Ver\u00e3o\"\r\n      WHEN tipo_os LIKE \"%Madonna%\" THEN \"Madonna\"\r\n      WHEN tipo_os = \"Regular\" THEN NULL\r\n      ELSE tipo_os\r\n    END AS subtipo_dia,\r\n    i.feed_version,\r\n    i.feed_start_date,\r\n    tipo_os,\r\n  FROM\r\n    dates AS d\r\n  LEFT JOIN\r\n    {{ ref('feed_info_gtfs') }} AS i\r\n    -- rj-smtr.gtfs.feed_info AS i\r\n  USING\r\n    (feed_version)\r\n  WHERE\r\n  {% if is_incremental() %}\r\n    data = DATE_SUB(DATE(\"{{ var(\"run_date\") }}\"), INTERVAL 1 DAY)\r\n  {% else %}\r\n    data <= DATE(\"{{ var('run_date') }}\")\r\n  {% endif %}\r\n)\r\nSELECT\r\n  data,\r\n  tipo_dia,\r\n  subtipo_dia,\r\n  SAFE_CAST(NULL AS DATE) AS data_versao_trips,\r\n  SAFE_CAST(NULL AS DATE) AS data_versao_shapes,\r\n  SAFE_CAST(NULL AS DATE) AS data_versao_frequencies,\r\n  SAFE_CAST(NULL AS FLOAT64) AS valor_subsidio_por_km,\r\n  COALESCE(d.feed_version, i.feed_version) AS feed_version,\r\n  COALESCE(d.feed_start_date, i.feed_start_date) AS feed_start_date,\r\n  tipo_os,\r\nFROM\r\n  data_versao_efetiva_manual AS d\r\nLEFT JOIN\r\n  {{ ref('feed_info_gtfs') }} AS i\r\n  -- rj-smtr.gtfs.feed_info AS i\r\nON\r\n  (data BETWEEN i.feed_start_date AND i.feed_end_date\r\n  OR (data >= i.feed_start_date AND i.feed_end_date IS NULL))\r\n\r\n{% endif %}", "language": "sql", "refs": [{"name": "subsidio_trips_desaninhada", "package": null, "version": null}, {"name": "subsidio_quadro_horario", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.subsidio_trips_desaninhada", "model.rj_smtr.subsidio_quadro_horario"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/subsidio_data_versao_efetiva.sql", "compiled": true, "compiled_code": "\n\n\n\n  \n  \n  \n\n\nWITH\n  dates AS (\n  SELECT\n    data,\n    CASE\n        WHEN data = \"2022-06-16\" THEN \"Domingo\"\n        WHEN data = \"2022-06-17\" THEN \"Sabado\"\n        WHEN data = \"2022-09-02\" THEN \"Sabado\"\n        WHEN data = \"2022-09-07\" THEN \"Domingo\"\n        WHEN data = \"2022-10-12\" THEN \"Domingo\"\n        WHEN data = \"2022-10-17\" THEN \"Sabado\"\n        WHEN data = \"2022-11-02\" THEN \"Domingo\"\n        WHEN data = \"2022-11-14\" THEN \"Sabado\"\n        WHEN data = \"2022-11-15\" THEN \"Domingo\"\n        WHEN data = \"2022-11-24\" THEN \"Sabado\"\n        WHEN data = \"2022-11-28\" THEN \"Sabado\"\n        WHEN data = \"2022-12-02\" THEN \"Sabado\"\n        WHEN data = \"2022-12-05\" THEN \"Sabado\"\n        WHEN data = \"2022-12-09\" THEN \"Sabado\"\n        WHEN data = \"2023-04-06\" THEN \"Sabado\" -- Ponto Facultativo - DECRETO RIO N\u00ba 52275/2023\n        WHEN data = \"2023-04-07\" THEN \"Domingo\" -- Paix\u00e3o de Cristo -- Art. 1\u00ba, V - PORTARIA ME N\u00ba 11.090/2022\n        WHEN data = \"2023-06-08\" THEN \"Domingo\" -- Corpus Christi - Lei n\u00ba 336/1949 - OF\u00cdCIO N\u00ba MTR-OFI-2023/03260 (MTROFI202303260A)\n        WHEN data = \"2023-06-09\" THEN \"Sabado\" -- Ponto Facultativo - DECRETO RIO N\u00ba 52584/2023\n        WHEN data = \"2023-09-08\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53137/2023\n        WHEN data = \"2023-10-13\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53296/2023\n        WHEN data = \"2023-10-16\" THEN \"Ponto Facultativo\" -- Dia do Com\u00e9rcio - OS Outubro/Q2\n        WHEN data = \"2023-11-03\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 53417/2023\n        WHEN data = \"2023-11-05\" THEN \"Sabado\" -- Domingo At\u00edpico - ENEM - OS Novembro/Q1\n        WHEN data = \"2023-11-12\" THEN \"Sabado\" -- Domingo At\u00edpico - ENEM - OS Novembro/Q1\n        WHEN data = \"2023-12-02\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2023-12-03\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2023-12-16\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2023-12-17\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2024-01-06\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2024-01-07\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o\n        WHEN data = \"2024-02-09\" THEN \"Ponto Facultativo\" -- Despacho MTR-DES-2024/07951\n        WHEN data = \"2024-02-12\" THEN \"Domingo\" -- Despacho MTR-DES-2024/07951\n        WHEN data = \"2024-02-13\" THEN \"Domingo\" -- Despacho MTR-DES-2024/07951\n        WHEN data = \"2024-02-14\" THEN \"Ponto Facultativo\" -- Despacho MTR-DES-2024/07951\n        WHEN data = \"2023-12-31\" THEN \"Domingo - R\u00e9veillon\"\n        WHEN data = \"2024-01-01\" THEN \"Domingo - R\u00e9veillon\"\n        WHEN data = \"2024-02-24\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/10516\n        WHEN data = \"2024-02-25\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/10516\n        WHEN data = \"2024-03-16\" THEN \"Sabado - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/15504\n        WHEN data = \"2024-03-17\" THEN \"Domingo - Ver\u00e3o\" -- OS de Ver\u00e3o - Despacho MTR-DES-2024/15504\n        WHEN data = \"2024-03-22\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 54114/2024\n        WHEN data = \"2024-03-28\" THEN \"Ponto Facultativo\" -- Ponto Facultativo - DECRETO RIO N\u00ba 54081/2024\n        WHEN data = \"2024-03-29\" THEN \"Domingo\" -- Feriado de Paix\u00e3o de Cristo (Sexta-feira Santa)\n        WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 1 THEN \"Domingo\" -- Dia de S\u00e3o Sebasti\u00e3o -- Art. 8\u00b0, I - Lei Municipal n\u00ba 5146/2010\n        WHEN EXTRACT(DAY FROM data) = 23 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Dia de S\u00e3o Jorge -- Art. 8\u00b0, II - Lei Municipal n\u00ba 5146/2010 / Lei Estadual N\u00ba 5198/2008 / Lei Estadual N\u00ba 5645/2010\n        WHEN EXTRACT(DAY FROM data) = 20 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Anivers\u00e1rio de morte de Zumbi dos Palmares / Dia da Consci\u00eancia Negra -- Art. 8\u00b0, IV - Lei Municipal n\u00ba 5146/2010 / Lei Estadual n\u00ba 526/1982 / Lei Estadual n\u00ba 1929/1991 / Lei Estadual n\u00ba 4007/2002 / Lei Estadual N\u00ba 5645/2010\n        WHEN EXTRACT(DAY FROM data) = 21 AND EXTRACT(MONTH FROM data) = 4 THEN \"Domingo\" -- Tiradentes -- Art. 1\u00ba, VI - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 1 AND EXTRACT(MONTH FROM data) = 5 THEN \"Domingo\" -- Dia Mundial do Trabalho -- Art. 1\u00ba, VII - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 7 AND EXTRACT(MONTH FROM data) = 9 THEN \"Domingo\" -- Independ\u00eancia do Brasil -- Art. 1\u00ba, IX - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 12 AND EXTRACT(MONTH FROM data) = 10 THEN \"Domingo\" -- Nossa Senhora Aparecida -- Art. 1\u00ba, X - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 2 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Finados -- Art. 1\u00ba, XII - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 15 AND EXTRACT(MONTH FROM data) = 11 THEN \"Domingo\" -- Proclama\u00e7\u00e3o da Rep\u00fablica -- Art. 1\u00ba, XIII - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAY FROM data) = 25 AND EXTRACT(MONTH FROM data) = 12 THEN \"Domingo\" -- Natal -- Art. 1\u00ba, XIV - PORTARIA ME N\u00ba 11.090/2022\n        WHEN EXTRACT(DAYOFWEEK FROM data) = 1 THEN \"Domingo\"\n        WHEN EXTRACT(DAYOFWEEK FROM data) = 7 THEN \"Sabado\"\n        ELSE \"Dia \u00datil\"\n    END AS tipo_dia,\n    CASE\n      -- Reveillon 2022:\n      WHEN data = DATE(2022,12,31) THEN data\n      WHEN data = DATE(2023,1,1) THEN data\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\n      -- Reprocessamento:\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\n      -- Altera\u00e7\u00e3o de Planejamento\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\n      -- Reveillon 2023:\n      WHEN data = DATE(2023,12,31) THEN data\n      WHEN data = DATE(2024,01,01) THEN data\n      -- 2024:\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\n      -- 2022:\n      WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,2) THEN DATE(2022,9,16)\n      WHEN data BETWEEN DATE(2022,6,1) AND LAST_DAY(DATE(2022,6,30), MONTH) THEN DATE(2022,6,1)\n      \n        WHEN data BETWEEN DATE(2022,7,1) AND DATE(2022,7,15) THEN DATE(2022,7,1)\n        WHEN data BETWEEN DATE(2022,7,16) AND LAST_DAY(DATE(2022,7,30), MONTH) THEN DATE(2022,7,16)\n      \n        WHEN data BETWEEN DATE(2022,8,1) AND DATE(2022,8,15) THEN DATE(2022,8,1)\n        WHEN data BETWEEN DATE(2022,8,16) AND LAST_DAY(DATE(2022,8,30), MONTH) THEN DATE(2022,8,16)\n      \n        WHEN data BETWEEN DATE(2022,9,1) AND DATE(2022,9,15) THEN DATE(2022,9,1)\n        WHEN data BETWEEN DATE(2022,9,16) AND LAST_DAY(DATE(2022,9,30), MONTH) THEN DATE(2022,9,16)\n      \n        WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,15) THEN DATE(2022,10,1)\n        WHEN data BETWEEN DATE(2022,10,16) AND LAST_DAY(DATE(2022,10,30), MONTH) THEN DATE(2022,10,16)\n      \n        WHEN data BETWEEN DATE(2022,11,1) AND DATE(2022,11,15) THEN DATE(2022,11,1)\n        WHEN data BETWEEN DATE(2022,11,16) AND LAST_DAY(DATE(2022,11,30), MONTH) THEN DATE(2022,11,16)\n      \n        WHEN data BETWEEN DATE(2022,12,1) AND DATE(2022,12,15) THEN DATE(2022,12,1)\n        WHEN data BETWEEN DATE(2022,12,16) AND LAST_DAY(DATE(2022,12,30), MONTH) THEN DATE(2022,12,16)\n      \n      -- 2023 a 2024:\n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,12,1)\n        \n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,12,1)\n        \n      \n    END AS data_versao_trips,\n    CASE\n      -- Reveillon 2022:\n      WHEN data = DATE(2022,12,31) THEN data\n      WHEN data = DATE(2023,1,1) THEN data\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\n      -- Reprocessamento:\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\n      -- Altera\u00e7\u00e3o de Planejamento\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\n      -- Reveillon 2023:\n      WHEN data = DATE(2023,12,31) THEN data\n      WHEN data = DATE(2024,01,01) THEN data\n      -- 2024:\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\n      -- 2022:\n      WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,2) THEN DATE(2022,9,16)\n      WHEN data BETWEEN DATE(2022,6,1) AND LAST_DAY(DATE(2022,6,30), MONTH) THEN DATE(2022,6,1)\n      \n        WHEN data BETWEEN DATE(2022,7,1) AND DATE(2022,7,15) THEN DATE(2022,7,1)\n        WHEN data BETWEEN DATE(2022,7,16) AND LAST_DAY(DATE(2022,7,30), MONTH) THEN DATE(2022,7,16)\n      \n        WHEN data BETWEEN DATE(2022,8,1) AND DATE(2022,8,15) THEN DATE(2022,8,1)\n        WHEN data BETWEEN DATE(2022,8,16) AND LAST_DAY(DATE(2022,8,30), MONTH) THEN DATE(2022,8,16)\n      \n        WHEN data BETWEEN DATE(2022,9,1) AND DATE(2022,9,15) THEN DATE(2022,9,1)\n        WHEN data BETWEEN DATE(2022,9,16) AND LAST_DAY(DATE(2022,9,30), MONTH) THEN DATE(2022,9,16)\n      \n        WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,15) THEN DATE(2022,10,1)\n        WHEN data BETWEEN DATE(2022,10,16) AND LAST_DAY(DATE(2022,10,30), MONTH) THEN DATE(2022,10,16)\n      \n        WHEN data BETWEEN DATE(2022,11,1) AND DATE(2022,11,15) THEN DATE(2022,11,1)\n        WHEN data BETWEEN DATE(2022,11,16) AND LAST_DAY(DATE(2022,11,30), MONTH) THEN DATE(2022,11,16)\n      \n        WHEN data BETWEEN DATE(2022,12,1) AND DATE(2022,12,15) THEN DATE(2022,12,1)\n        WHEN data BETWEEN DATE(2022,12,16) AND LAST_DAY(DATE(2022,12,30), MONTH) THEN DATE(2022,12,16)\n      \n      -- 2023 a 2024:\n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,12,1)\n        \n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,12,1)\n        \n      \n    END AS data_versao_shapes,\n    CASE\n      -- Reveillon 2022:\n      WHEN data = DATE(2022,12,31) THEN data\n      WHEN data = DATE(2023,1,1) THEN data\n      WHEN data BETWEEN DATE(2023,1,2) AND DATE(2023,1,15) THEN DATE(2023,1,2)\n      -- Reprocessamento:\n      WHEN data BETWEEN DATE(2023,1,15) AND DATE(2023,1,31) THEN DATE(2023,1,16)\n      WHEN data BETWEEN DATE(2023,3,16) AND DATE(2023,3,31) THEN DATE(2023,3,16)\n      -- Altera\u00e7\u00e3o de Planejamento\n      WHEN data BETWEEN DATE(2023,6,16) AND DATE(2023,6,30) THEN DATE(2023,6,16)\n      WHEN data BETWEEN DATE(2023,7,16) AND DATE(2023,7,31) THEN DATE(2023,7,16)\n      WHEN data BETWEEN DATE(2023,8,16) AND DATE(2023,8,31) THEN DATE(2023,8,16)\n      WHEN data BETWEEN DATE(2023,9,16) AND DATE(2023,9,30) THEN DATE(2023,9,16)\n      WHEN data BETWEEN DATE(2023,10,16) AND DATE(2023,10,16) THEN DATE(2023,10,16)\n      WHEN data BETWEEN DATE(2023,10,17) AND DATE(2023,10,23) THEN DATE(2023,10,17)\n      WHEN data BETWEEN DATE(2023,10,24) AND DATE(2023,10,31) THEN DATE(2023,10,24)\n      WHEN data = DATE(2023,12,01) THEN data -- Desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,02) AND DATE(2023,12,03) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,16) AND DATE(2023,12,17) THEN DATE(2023,12,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2023,12,04) AND DATE(2023,12,20) THEN DATE(2023,12,02) -- Fim do desvio do TIG\n      WHEN data BETWEEN DATE(2023,12,21) AND DATE(2023,12,30) THEN DATE(2023,12,21)\n      -- Reveillon 2023:\n      WHEN data = DATE(2023,12,31) THEN data\n      WHEN data = DATE(2024,01,01) THEN data\n      -- 2024:\n      WHEN data BETWEEN DATE(2024,01,06) AND DATE(2024,01,07) THEN DATE(2024,01,03) -- OS de Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,01,02) AND DATE(2024,01,14) THEN DATE(2024,01,02)\n      WHEN data BETWEEN DATE(2024,01,15) AND DATE(2024,01,31) THEN DATE(2024,01,15)\n      WHEN data BETWEEN DATE(2024,02,01) AND DATE(2024,02,18) THEN DATE(2024,02,01) -- OS fev/Q1\n      WHEN data BETWEEN DATE(2024,02,19) AND DATE(2024,02,23) THEN DATE(2024,02,19) -- OS fev/Q2\n      WHEN data BETWEEN DATE(2024,02,24) AND DATE(2024,02,25) THEN DATE(2024,02,25) -- OS fev/Q2 - TIG - OS Ver\u00e3o\n      WHEN data BETWEEN DATE(2024,02,26) AND DATE(2024,03,01) THEN DATE(2024,02,24) -- OS fev/Q2 - TIG\n      WHEN data BETWEEN DATE(2024,03,02) AND DATE(2024,03,10) THEN DATE(2024,03,02) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,11) AND DATE(2024,03,15) THEN DATE(2024,03,11) -- OS mar/Q1\n      WHEN data BETWEEN DATE(2024,03,16) AND DATE(2024,03,17) THEN DATE(2024,03,12) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,18) AND DATE(2024,03,29) THEN DATE(2024,03,18) -- OS mar/Q2\n      WHEN data BETWEEN DATE(2024,03,30) AND DATE(2024,04,30) THEN DATE(2024,03,30) -- OS abr/Q1\n      -- 2022:\n      \n        WHEN data BETWEEN DATE(2022,6,1) AND DATE(2022,6,15) THEN DATE(2022,6,1)\n        WHEN data BETWEEN DATE(2022,6,16) AND LAST_DAY(DATE(2022,6,30), MONTH) THEN DATE(2022,6,16)\n      \n        WHEN data BETWEEN DATE(2022,7,1) AND DATE(2022,7,15) THEN DATE(2022,7,1)\n        WHEN data BETWEEN DATE(2022,7,16) AND LAST_DAY(DATE(2022,7,30), MONTH) THEN DATE(2022,7,16)\n      \n        WHEN data BETWEEN DATE(2022,8,1) AND DATE(2022,8,15) THEN DATE(2022,8,1)\n        WHEN data BETWEEN DATE(2022,8,16) AND LAST_DAY(DATE(2022,8,30), MONTH) THEN DATE(2022,8,16)\n      \n        WHEN data BETWEEN DATE(2022,9,1) AND DATE(2022,9,15) THEN DATE(2022,9,1)\n        WHEN data BETWEEN DATE(2022,9,16) AND LAST_DAY(DATE(2022,9,30), MONTH) THEN DATE(2022,9,16)\n      \n        WHEN data BETWEEN DATE(2022,10,1) AND DATE(2022,10,15) THEN DATE(2022,10,1)\n        WHEN data BETWEEN DATE(2022,10,16) AND LAST_DAY(DATE(2022,10,30), MONTH) THEN DATE(2022,10,16)\n      \n        WHEN data BETWEEN DATE(2022,11,1) AND DATE(2022,11,15) THEN DATE(2022,11,1)\n        WHEN data BETWEEN DATE(2022,11,16) AND LAST_DAY(DATE(2022,11,30), MONTH) THEN DATE(2022,11,16)\n      \n        WHEN data BETWEEN DATE(2022,12,1) AND DATE(2022,12,15) THEN DATE(2022,12,1)\n        WHEN data BETWEEN DATE(2022,12,16) AND LAST_DAY(DATE(2022,12,30), MONTH) THEN DATE(2022,12,16)\n      \n      -- 2023 a 2024:\n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2023 THEN DATE(2023,12,1)\n        \n      \n        \n          WHEN EXTRACT(MONTH FROM data) = 1 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,1,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 2 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,2,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 3 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,3,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 4 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,4,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 5 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,5,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 6 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,6,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 7 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,7,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 8 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,8,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 9 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,9,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 10 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,10,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 11 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,11,1)\n        \n          WHEN EXTRACT(MONTH FROM data) = 12 AND EXTRACT(YEAR FROM data) = 2024 THEN DATE(2024,12,1)\n        \n      \n    END AS data_versao_frequencies,\n    CASE\n      WHEN EXTRACT(YEAR FROM data) = 2022 THEN (\n        CASE\n          WHEN EXTRACT(MONTH FROM data) = 6 THEN 2.13\n          WHEN EXTRACT(MONTH FROM data) = 7 THEN 1.84\n          WHEN EXTRACT(MONTH FROM data) = 8 THEN 1.80\n          WHEN EXTRACT(MONTH FROM data) = 9 THEN 1.75\n          WHEN EXTRACT(MONTH FROM data) = 10 THEN 1.62\n          WHEN EXTRACT(MONTH FROM data) = 11 THEN 1.53\n          WHEN EXTRACT(MONTH FROM data) = 12 THEN 1.78\n        END\n      )\n      WHEN EXTRACT(YEAR FROM data) = 2023 THEN (\n        CASE\n          WHEN data <= DATE(\"2023-01-06\") THEN 3.18\n          ELSE 2.81\n        END\n      )\n    END AS valor_subsidio_por_km\n  FROM UNNEST(GENERATE_DATE_ARRAY(\"2022-06-01\", DATE_SUB(\"2024-04-01\", INTERVAL 1 DAY))) AS data),\n  trips AS (\n  SELECT\n    DISTINCT data_versao\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_trips_desaninhada`\n  \n  WHERE\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"2022-01-01T01:00:00\"), INTERVAL 30 DAY), MONTH)\n  \n  ),\n  shapes AS (\n  SELECT\n    DISTINCT data_versao\n  FROM\n    `rj-smtr-staging.projeto_subsidio_sppo_staging.shapes`\n  \n  WHERE\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"2022-01-01T01:00:00\"), INTERVAL 30 DAY), MONTH)\n  \n  ),\n  frequencies AS (\n  SELECT\n    DISTINCT data_versao\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_quadro_horario`\n  \n  WHERE\n    data_versao >= DATE_TRUNC(DATE_SUB(DATE(\"2022-01-01T01:00:00\"), INTERVAL 30 DAY), MONTH)\n  \n  )\nSELECT\n  data,\n  tipo_dia,\n  SAFE_CAST(NULL AS STRING) AS subtipo_dia,\n  COALESCE(t.data_versao, DATE(\"2024-03-30\")) AS data_versao_trips,\n  COALESCE(s.data_versao, DATE(\"2024-03-30\")) AS data_versao_shapes,\n  COALESCE(f.data_versao, DATE(\"2024-03-30\")) AS data_versao_frequencies,\n  valor_subsidio_por_km,\n  SAFE_CAST(NULL AS STRING) AS feed_version,\n  SAFE_CAST(NULL AS DATE)AS feed_start_date,\n  SAFE_CAST(NULL AS STRING) AS tipo_os,\nFROM\n  dates AS d\nLEFT JOIN\n  trips AS t\nON\n  t.data_versao = d.data_versao_trips\nLEFT JOIN\n  shapes AS s\nON\n  s.data_versao = d.data_versao_shapes\nLEFT JOIN\n  frequencies AS f\nON\n  f.data_versao = d.data_versao_frequencies\nWHERE\n\n  data BETWEEN DATE_SUB(DATE(\"2022-01-01T01:00:00\"), INTERVAL 1 DAY) AND DATE(\"2022-01-01T01:00:00\")\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_viagem_registros": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "aux_viagem_registros", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/aux_viagem_registros.sql", "original_file_path": "models/projeto_subsidio_sppo/aux_viagem_registros.sql", "unique_id": "model.rj_smtr.aux_viagem_registros", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "aux_viagem_registros"], "alias": "aux_viagem_registros", "checksum": {"name": "sha256", "checksum": "32d5d186239bc27b5ca359aeaf8fa864d227a77bbc5b092e0af69554bb1ba937"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela auxiliar de c\u00e1lculo da dist\u00e2ncia e total de registros de GPS das viagens identificadas (atualizada diariamente, sem hist\u00f3rico).", "columns": {"id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_aferida": {"name": "distancia_aferida", "description": "Dist\u00e2ncia aferida da viagem (geod\u00e9sia entre posi\u00e7\u00f5es consecutivas do sinal de GPS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_middle": {"name": "n_registros_middle", "description": "Contagem de sinais de GPS emitidos no meio do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_start": {"name": "n_registros_start", "description": "Contagem de sinais de GPS emitidos no ponto de de in\u00edcio do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_end": {"name": "n_registros_end", "description": "Contagem de sinais de GPS emitidos no ponto final do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_out": {"name": "n_registros_out", "description": "Contagem de sinais de GPS emitidos fora do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_total": {"name": "n_registros_total", "description": "Contagem de sinais de GPS emitidos no tempo da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_minuto": {"name": "n_registros_minuto", "description": "Contagem de minutos do trajeto com pelo menos 1 sinal de GPS emitido.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_shape": {"name": "n_registros_shape", "description": "Contagem total de sinais de GPS emitidos dentro do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9155157, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`", "raw_code": "-- 1. Calcula a dist\u00e2ncia total percorrida por viagem, separada por\r\n--    shape. Adiciona dist\u00e2ncia do 1o/\u00faltimo sinal de gps ao in\u00edcio/final do\r\n--    shape. Isso \u00e9 necess\u00e1rio pois o 1o/ultimo sinal \u00e9 contabilizado\r\n--    apenas quando o veiculo sai/chega dentro do raio de 500m ao redor\r\n--    do ponto inicial/final. Contabiliza tamb\u00e9m o n\u00famero de registros\r\n--    em cada tapa da viagem (inicio, meio, fim, fora), total de\r\n--    registros de gps e total de minutos da viagem com registros de gps.\r\nwith distancia as (\r\n    select\r\n        *,\r\n        n_registros_middle + n_registros_start + n_registros_end as n_registros_shape\r\n    from (\r\n        select distinct\r\n            id_viagem,\r\n            trip_id,\r\n            max(distancia_inicio_fim) as distancia_inicio_fim,\r\n            round(sum(distancia)/1000 + max(distancia_inicio_fim), 3) as distancia_aferida,\r\n            sum(case when status_viagem = \"middle\" then 1 else 0 end) as n_registros_middle,\r\n            sum(case when status_viagem = \"start\" then 1 else 0 end) as n_registros_start,\r\n            sum(case when status_viagem = \"end\" then 1 else 0 end) as n_registros_end,\r\n            sum(case when status_viagem = \"out\" then 1 else 0 end) as n_registros_out,\r\n            count(timestamp_gps) as n_registros_total,\r\n            count(distinct timestamp_minuto_gps) as n_registros_minuto\r\n        from (\r\n            select distinct * except(posicao_veiculo_geo, start_pt, end_pt)\r\n            from {{ ref(\"registros_status_viagem\") }}\r\n            where\r\n                {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n                data = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n                {% else %}\r\n                data between date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n                {% endif %}\r\n        )\r\n        group by 1,2\r\n    )\r\n)\r\n-- 2. Calcula distancia total por viagem - junta distancias corrigidas\r\n--    de ida e volta de viagens circulares.\r\nselect\r\n    id_viagem,\r\n    sum(distancia_aferida) as distancia_aferida,\r\n    sum(distancia_inicio_fim) as distancia_inicio_fim,\r\n    sum(n_registros_middle) as n_registros_middle,\r\n    sum(n_registros_start) as n_registros_start,\r\n    sum(n_registros_end) as n_registros_end,\r\n    sum(n_registros_out) as n_registros_out,\r\n    sum(n_registros_total) as n_registros_total,\r\n    sum(n_registros_minuto) as n_registros_minuto,\r\n    sum(n_registros_shape) as n_registros_shape,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    distancia\r\ngroup by 1", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/aux_viagem_registros.sql", "compiled": true, "compiled_code": "-- 1. Calcula a dist\u00e2ncia total percorrida por viagem, separada por\n--    shape. Adiciona dist\u00e2ncia do 1o/\u00faltimo sinal de gps ao in\u00edcio/final do\n--    shape. Isso \u00e9 necess\u00e1rio pois o 1o/ultimo sinal \u00e9 contabilizado\n--    apenas quando o veiculo sai/chega dentro do raio de 500m ao redor\n--    do ponto inicial/final. Contabiliza tamb\u00e9m o n\u00famero de registros\n--    em cada tapa da viagem (inicio, meio, fim, fora), total de\n--    registros de gps e total de minutos da viagem com registros de gps.\nwith distancia as (\n    select\n        *,\n        n_registros_middle + n_registros_start + n_registros_end as n_registros_shape\n    from (\n        select distinct\n            id_viagem,\n            trip_id,\n            max(distancia_inicio_fim) as distancia_inicio_fim,\n            round(sum(distancia)/1000 + max(distancia_inicio_fim), 3) as distancia_aferida,\n            sum(case when status_viagem = \"middle\" then 1 else 0 end) as n_registros_middle,\n            sum(case when status_viagem = \"start\" then 1 else 0 end) as n_registros_start,\n            sum(case when status_viagem = \"end\" then 1 else 0 end) as n_registros_end,\n            sum(case when status_viagem = \"out\" then 1 else 0 end) as n_registros_out,\n            count(timestamp_gps) as n_registros_total,\n            count(distinct timestamp_minuto_gps) as n_registros_minuto\n        from (\n            select distinct * except(posicao_veiculo_geo, start_pt, end_pt)\n            from `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\n            where\n                \n                data between date_sub(date(\"2022-01-01T01:00:00\"), interval 1 day) and date(\"2022-01-01T01:00:00\")\n                \n        )\n        group by 1,2\n    )\n)\n-- 2. Calcula distancia total por viagem - junta distancias corrigidas\n--    de ida e volta de viagens circulares.\nselect\n    id_viagem,\n    sum(distancia_aferida) as distancia_aferida,\n    sum(distancia_inicio_fim) as distancia_inicio_fim,\n    sum(n_registros_middle) as n_registros_middle,\n    sum(n_registros_start) as n_registros_start,\n    sum(n_registros_end) as n_registros_end,\n    sum(n_registros_out) as n_registros_out,\n    sum(n_registros_total) as n_registros_total,\n    sum(n_registros_minuto) as n_registros_minuto,\n    sum(n_registros_shape) as n_registros_shape,\n    '' as versao_modelo\nfrom\n    distancia\ngroup by 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_viagem_inicio_fim": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "aux_viagem_inicio_fim", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/aux_viagem_inicio_fim.sql", "original_file_path": "models/projeto_subsidio_sppo/aux_viagem_inicio_fim.sql", "unique_id": "model.rj_smtr.aux_viagem_inicio_fim", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "aux_viagem_inicio_fim"], "alias": "aux_viagem_inicio_fim", "checksum": {"name": "sha256", "checksum": "ba25752c0120405cf7dfd2f82f5edf34e943081a30768483674ecc2b7425ca0d"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela auxiliar de identifica\u00e7\u00e3o de in\u00edcio e fim de viagens (atualizada diariamente, sem hist\u00f3rico).", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Servi\u00e7o realizado pelo ve\u00edculo (com base na identifica\u00e7\u00e3o do trajeto)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9087603, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`", "raw_code": "-- 1. Cria colunas identificadoras de in\u00edcio (starts) e fim (ends) de viagens\r\nwith aux_status as (\r\n    select\r\n        *,\r\n        string_agg(status_viagem,\"\") over (\r\n            partition by id_veiculo, shape_id\r\n            order by id_veiculo, shape_id, timestamp_gps\r\n            rows between current row and 1 following) = 'startmiddle' starts,\r\n        string_agg(status_viagem,\"\") over (\r\n            partition by id_veiculo, shape_id\r\n            order by id_veiculo, shape_id, timestamp_gps\r\n            rows between 1 preceding and current row) = 'middleend' ends\r\n    from\r\n        {{ ref('aux_registros_status_trajeto') }}\r\n),\r\n-- 2. Classifica in\u00edcio-fim consecutivos como partida-chegada da viagem\r\naux_inicio_fim AS (\r\n    select\r\n        *,\r\n        case\r\n            when\r\n            string_agg(status_viagem,\"\") over (\r\n                partition by id_veiculo, shape_id\r\n                order by id_veiculo, shape_id, timestamp_gps\r\n                rows between CURRENT row and 1 following) = 'startend'\r\n            then timestamp_gps\r\n        end datetime_partida,\r\n        case\r\n            when string_agg(status_viagem,\"\") over (\r\n                partition by id_veiculo, shape_id\r\n                order by id_veiculo, shape_id, timestamp_gps\r\n                rows between 1 preceding and CURRENT row) = 'startend'\r\n            then timestamp_gps\r\n        end datetime_chegada\r\n    from\r\n        aux_status\r\n    where\r\n        starts = true OR ends = true\r\n),\r\n-- 3. Junta partida-chegada da viagem na mesma linha\r\ninicio_fim AS (\r\n    select\r\n        * except(datetime_chegada, posicao_veiculo_geo),\r\n        posicao_veiculo_geo as posicao_partida,\r\n        lead(datetime_chegada) over(\r\n            partition by id_veiculo, shape_id\r\n            order by id_veiculo, shape_id, timestamp_gps\r\n        ) as datetime_chegada,\r\n        lead(posicao_veiculo_geo) over(\r\n            partition by id_veiculo, shape_id\r\n            order by id_veiculo, shape_id, timestamp_gps\r\n        ) as posicao_chegada,\r\n    from aux_inicio_fim\r\n)\r\n-- 4. Filtra colunas e cria campo identificador da viagem (id_viagem)\r\nselect distinct\r\n    concat(id_veiculo, \"-\", servico_realizado ,\"-\", sentido, \"-\", shape_id_planejado, \"-\", FORMAT_DATETIME(\"%Y%m%d%H%M%S\", datetime_partida)) as id_viagem,\r\n    data,\r\n    id_empresa,\r\n    id_veiculo,\r\n    servico_informado, -- no momento da partida\r\n    servico_realizado,\r\n    trip_id,\r\n    shape_id,\r\n    sentido_shape,\r\n    round((st_distance(start_pt, posicao_partida) + st_distance(end_pt, posicao_chegada))/1000, 3) as distancia_inicio_fim,\r\n    distancia_planejada,\r\n    shape_id_planejado,\r\n    trip_id_planejado,\r\n    sentido,\r\n    datetime_partida,\r\n    datetime_chegada,\r\n    '{{ var(\"version\") }}' as versao_modelo\r\nfrom\r\n    inicio_fim\r\nwhere\r\n    datetime_partida is not null\r\n    {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n        {% if var(\"run_date\") != \"2024-05-05\" %}\r\n            -- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\n            and extract(date from datetime_partida) = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n        {% endif %}\r\n    {% endif %}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/aux_viagem_inicio_fim.sql", "compiled": true, "compiled_code": "-- 1. Cria colunas identificadoras de in\u00edcio (starts) e fim (ends) de viagens\nwith aux_status as (\n    select\n        *,\n        string_agg(status_viagem,\"\") over (\n            partition by id_veiculo, shape_id\n            order by id_veiculo, shape_id, timestamp_gps\n            rows between current row and 1 following) = 'startmiddle' starts,\n        string_agg(status_viagem,\"\") over (\n            partition by id_veiculo, shape_id\n            order by id_veiculo, shape_id, timestamp_gps\n            rows between 1 preceding and current row) = 'middleend' ends\n    from\n        `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\n),\n-- 2. Classifica in\u00edcio-fim consecutivos como partida-chegada da viagem\naux_inicio_fim AS (\n    select\n        *,\n        case\n            when\n            string_agg(status_viagem,\"\") over (\n                partition by id_veiculo, shape_id\n                order by id_veiculo, shape_id, timestamp_gps\n                rows between CURRENT row and 1 following) = 'startend'\n            then timestamp_gps\n        end datetime_partida,\n        case\n            when string_agg(status_viagem,\"\") over (\n                partition by id_veiculo, shape_id\n                order by id_veiculo, shape_id, timestamp_gps\n                rows between 1 preceding and CURRENT row) = 'startend'\n            then timestamp_gps\n        end datetime_chegada\n    from\n        aux_status\n    where\n        starts = true OR ends = true\n),\n-- 3. Junta partida-chegada da viagem na mesma linha\ninicio_fim AS (\n    select\n        * except(datetime_chegada, posicao_veiculo_geo),\n        posicao_veiculo_geo as posicao_partida,\n        lead(datetime_chegada) over(\n            partition by id_veiculo, shape_id\n            order by id_veiculo, shape_id, timestamp_gps\n        ) as datetime_chegada,\n        lead(posicao_veiculo_geo) over(\n            partition by id_veiculo, shape_id\n            order by id_veiculo, shape_id, timestamp_gps\n        ) as posicao_chegada,\n    from aux_inicio_fim\n)\n-- 4. Filtra colunas e cria campo identificador da viagem (id_viagem)\nselect distinct\n    concat(id_veiculo, \"-\", servico_realizado ,\"-\", sentido, \"-\", shape_id_planejado, \"-\", FORMAT_DATETIME(\"%Y%m%d%H%M%S\", datetime_partida)) as id_viagem,\n    data,\n    id_empresa,\n    id_veiculo,\n    servico_informado, -- no momento da partida\n    servico_realizado,\n    trip_id,\n    shape_id,\n    sentido_shape,\n    round((st_distance(start_pt, posicao_partida) + st_distance(end_pt, posicao_chegada))/1000, 3) as distancia_inicio_fim,\n    distancia_planejada,\n    shape_id_planejado,\n    trip_id_planejado,\n    sentido,\n    datetime_partida,\n    datetime_chegada,\n    '' as versao_modelo\nfrom\n    inicio_fim\nwhere\n    datetime_partida is not null\n    ", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagem_completa": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "viagem_completa", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/viagem_completa.sql", "original_file_path": "models/projeto_subsidio_sppo/viagem_completa.sql", "unique_id": "model.rj_smtr.viagem_completa", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "viagem_completa"], "alias": "viagem_completa", "checksum": {"name": "sha256", "checksum": "3c75f6160f38ae14d7a8996917f0c5dc5c9287cd83d56f5ea7d657b0d335714e"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["id_viagem"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Detalhes de todas as viagens completas identificadas.", "columns": {"consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio ao qual o servi\u00e7o pertence", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, S\u00e1bado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Servi\u00e7o realizado pelo ve\u00edculo (com base na identifica\u00e7\u00e3o do trajeto)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Texto que aparece na sinaliza\u00e7\u00e3o identificando o destino da viagem aos passageiros", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "C\u00f3digo identificador do itiner\u00e1rio operado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do trajeto (shape) operado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (ex: id_veiculo + servico + sentido + shape_id + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Tipo de viagem - categorias: Completa linha correta, Completa linha incorreta", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "In\u00edcio do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Fim do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_planejado": {"name": "tempo_planejado", "description": "Tempo planejado da viagem (em minutos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_viagem": {"name": "tempo_viagem", "description": "Tempo aferido da viagem (em minutos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_aferida": {"name": "distancia_aferida", "description": "Dist\u00e2ncia aferida da viagem (geod\u00e9sia entre posi\u00e7\u00f5es consecutivas do sinal de GPS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_shape": {"name": "n_registros_shape", "description": "Contagem de sinais de GPS emitidos dentro do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_total": {"name": "n_registros_total", "description": "Contagem de sinais de GPS emitidos no tempo da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_minuto": {"name": "n_registros_minuto", "description": "Contagem de minutos do trajeto com pelo menos 1 sinal de GPS emitido.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_shape": {"name": "perc_conformidade_shape", "description": "Percentual de sinais emitidos dentro do shape (trajeto) ao longo da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_distancia": {"name": "perc_conformidade_distancia", "description": "Raz\u00e3o da dist\u00e2ncia aferida pela dist\u00e2ncia te\u00f3rica x 100", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_registros": {"name": "perc_conformidade_registros", "description": "Percentual de minutos da viagem com registro de sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_tempo": {"name": "perc_conformidade_tempo", "description": "Raz\u00e3o do tempo aferido da viagem pelo planejado x 100", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["id_viagem"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.922318, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`", "raw_code": "{{\r\nconfig(\r\n    materialized='incremental',\r\n    partition_by={\r\n            \"field\":\"data\",\r\n            \"data_type\": \"date\",\r\n            \"granularity\":\"day\"\r\n    },\r\n    unique_key=['id_viagem'],\r\n    incremental_strategy='insert_overwrite'\r\n)\r\n}}\r\n-- 1. Identifica viagens que est\u00e3o dentro do quadro planejado (por\r\n--    enquanto, consideramos o dia todo).\r\nwith viagem_periodo as (\r\n    select distinct\r\n        p.consorcio,\r\n        p.vista,\r\n        p.tipo_dia,\r\n        v.*,\r\n        p.inicio_periodo,\r\n        p.fim_periodo,\r\n        p.id_tipo_trajeto,\r\n        0 as tempo_planejado,\r\n    from (\r\n        select distinct\r\n            consorcio,\r\n            vista,\r\n            data,\r\n            tipo_dia,\r\n            trip_id_planejado as trip_id,\r\n            servico,\r\n            inicio_periodo,\r\n            fim_periodo,\r\n            id_tipo_trajeto\r\n        from\r\n            {{ ref(\"viagem_planejada\") }}\r\n        {% if is_incremental() %}\r\n        WHERE\r\n            data = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n        {% endif %}\r\n    ) p\r\n    inner join (\r\n        select distinct * from {{ ref(\"viagem_conformidade\") }}\r\n        {% if is_incremental() %}\r\n        WHERE\r\n            data = date_sub(date(\"{{ var(\"run_date\") }}\"), interval 1 day)\r\n        {% endif %}\r\n    ) v\r\n    on\r\n        v.trip_id = p.trip_id\r\n        and v.data = p.data\r\n),\r\n-- 2. Seleciona viagens completas de acordo com a conformidade\r\nviagem_comp_conf as (\r\nselect distinct\r\n    consorcio,\r\n    data,\r\n    tipo_dia,\r\n    id_empresa,\r\n    id_veiculo,\r\n    id_viagem,\r\n    servico_informado,\r\n    servico_realizado,\r\n    vista,\r\n    trip_id,\r\n    shape_id,\r\n    sentido,\r\n    datetime_partida,\r\n    datetime_chegada,\r\n    inicio_periodo,\r\n    fim_periodo,\r\n    case\r\n        when servico_realizado = servico_informado\r\n        then \"Completa linha correta\"\r\n        else \"Completa linha incorreta\"\r\n        end as tipo_viagem,\r\n    tempo_viagem,\r\n    tempo_planejado,\r\n    distancia_planejada,\r\n    distancia_aferida,\r\n    n_registros_shape,\r\n    n_registros_total,\r\n    n_registros_minuto,\r\n    perc_conformidade_shape,\r\n    perc_conformidade_distancia,\r\n    perc_conformidade_registros,\r\n    0 as perc_conformidade_tempo,\r\n    -- round(100 * tempo_viagem/tempo_planejado, 2) as perc_conformidade_tempo,\r\n    id_tipo_trajeto,\r\n    '{{ var(\"version\") }}' as versao_modelo,\r\n    CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\r\nfrom\r\n    viagem_periodo v\r\nwhere (\r\n    perc_conformidade_shape >= {{ var(\"perc_conformidade_shape_min\") }}\r\n)\r\nand (\r\n    perc_conformidade_distancia >= {{ var(\"perc_conformidade_distancia_min\") }}\r\n)\r\nand (\r\n    perc_conformidade_registros >= {{ var(\"perc_conformidade_registros_min\") }}\r\n)\r\n{% if var(\"run_date\") == \"2023-01-01\" %}\r\n-- Reveillon (2022-12-31)\r\nand\r\n    (\r\n        -- 1. Viagens pre fechamento das vias\r\n        (fim_periodo = \"22:00:00\" and datetime_chegada <= \"2022-12-31 22:05:00\")\r\n        or\r\n        (fim_periodo = \"18:00:00\" and datetime_chegada <= \"2022-12-31 18:05:00\") -- 18h as 5h\r\n        or\r\n        -- 2. Viagens durante fechamento das vias\r\n        (inicio_periodo = \"22:00:00\" and datetime_partida >= \"2022-12-31 21:55:00\") -- 22h as 5h/10h\r\n        or\r\n        (inicio_periodo = \"18:00:00\" and datetime_partida >= \"2022-12-31 17:55:00\") -- 18h as 5h\r\n        or\r\n        -- 3. Viagens que nao sao afetadas pelo fechamento das vias\r\n        (inicio_periodo = \"00:00:00\" and fim_periodo = \"23:59:59\")\r\n    )\r\n-- Feriado do Dia da Fraternidade Universal (2023-01-01)\r\n{% elif var(\"run_date\") == \"2023-01-02\" %}\r\nand\r\n    (\r\n        -- 1. Viagens durante fechamento das vias\r\n        (fim_periodo = \"05:00:00\" and datetime_partida <= \"2023-01-01 05:05:00\")\r\n        or\r\n        (fim_periodo = \"10:00:00\" and datetime_partida <= \"2023-01-01 10:05:00\")\r\n        or\r\n        -- 2. Viagens pos abertura das vias\r\n        (inicio_periodo = \"05:00:00\" and datetime_partida >= \"2023-01-01 04:55:00\")\r\n        or\r\n        (inicio_periodo = \"10:00:00\" and datetime_partida >= \"2023-01-01 09:55:00\")\r\n        or\r\n        -- 3. Viagens que nao sao afetadas pelo fechamento das vias\r\n        (inicio_periodo = \"00:00:00\" and fim_periodo = \"23:59:59\")\r\n    )\r\n{% elif var(\"run_date\") in (\"2024-05-05\", \"2024-05-06\") %}\r\n-- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\nand\r\n    (datetime_partida between inicio_periodo and fim_periodo)\r\n{% endif %}\r\n),\r\n-- 3. Filtra viagens com mesma chegada e partida pelo maior % de conformidade do shape\r\nfiltro_desvio as (\r\n  SELECT\r\n    {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n    * EXCEPT(rn, id_tipo_trajeto)\r\n    {% else %}\r\n    * EXCEPT(rn)\r\n    {% endif %}\r\nFROM (\r\n  SELECT\r\n    *,\r\n    {% if var(\"run_date\") > var(\"DATA_SUBSIDIO_V7_INICIO\") %}\r\n    -- Apura\u00e7\u00e3o \"Madonna \u00b7 The Celebration Tour in Rio\"\r\n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida, datetime_chegada ORDER BY perc_conformidade_shape DESC, id_tipo_trajeto, distancia_planejada DESC) AS rn\r\n    {% elif var(\"run_date\") > var(\"DATA_SUBSIDIO_V6_INICIO\") %}\r\n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida, datetime_chegada ORDER BY perc_conformidade_shape DESC, id_tipo_trajeto) AS rn\r\n    {% else %}\r\n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida, datetime_chegada ORDER BY perc_conformidade_shape DESC) AS rn\r\n    {% endif %}\r\n  FROM\r\n    viagem_comp_conf )\r\nWHERE\r\n  rn = 1\r\n),\r\n-- 4. Filtra viagens com partida ou chegada diferentes pela maior distancia percorrida\r\nfiltro_partida AS (\r\n  SELECT\r\n    * EXCEPT(rn)\r\n  FROM (\r\n    SELECT\r\n      *,\r\n      ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida ORDER BY distancia_planejada DESC) AS rn\r\n    FROM\r\n      filtro_desvio )\r\n  WHERE\r\n    rn = 1 )\r\n-- filtro_chegada\r\nSELECT\r\n  * EXCEPT(rn)\r\nFROM (\r\n  SELECT\r\n    *,\r\n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_chegada ORDER BY distancia_planejada DESC) AS rn\r\n  FROM\r\n    filtro_partida )\r\nWHERE\r\n  rn = 1", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/viagem_completa.sql", "compiled": true, "compiled_code": "\n-- 1. Identifica viagens que est\u00e3o dentro do quadro planejado (por\n--    enquanto, consideramos o dia todo).\nwith viagem_periodo as (\n    select distinct\n        p.consorcio,\n        p.vista,\n        p.tipo_dia,\n        v.*,\n        p.inicio_periodo,\n        p.fim_periodo,\n        p.id_tipo_trajeto,\n        0 as tempo_planejado,\n    from (\n        select distinct\n            consorcio,\n            vista,\n            data,\n            tipo_dia,\n            trip_id_planejado as trip_id,\n            servico,\n            inicio_periodo,\n            fim_periodo,\n            id_tipo_trajeto\n        from\n            `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n        \n        WHERE\n            data = date_sub(date(\"2022-01-01T01:00:00\"), interval 1 day)\n        \n    ) p\n    inner join (\n        select distinct * from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n        \n        WHERE\n            data = date_sub(date(\"2022-01-01T01:00:00\"), interval 1 day)\n        \n    ) v\n    on\n        v.trip_id = p.trip_id\n        and v.data = p.data\n),\n-- 2. Seleciona viagens completas de acordo com a conformidade\nviagem_comp_conf as (\nselect distinct\n    consorcio,\n    data,\n    tipo_dia,\n    id_empresa,\n    id_veiculo,\n    id_viagem,\n    servico_informado,\n    servico_realizado,\n    vista,\n    trip_id,\n    shape_id,\n    sentido,\n    datetime_partida,\n    datetime_chegada,\n    inicio_periodo,\n    fim_periodo,\n    case\n        when servico_realizado = servico_informado\n        then \"Completa linha correta\"\n        else \"Completa linha incorreta\"\n        end as tipo_viagem,\n    tempo_viagem,\n    tempo_planejado,\n    distancia_planejada,\n    distancia_aferida,\n    n_registros_shape,\n    n_registros_total,\n    n_registros_minuto,\n    perc_conformidade_shape,\n    perc_conformidade_distancia,\n    perc_conformidade_registros,\n    0 as perc_conformidade_tempo,\n    -- round(100 * tempo_viagem/tempo_planejado, 2) as perc_conformidade_tempo,\n    id_tipo_trajeto,\n    '' as versao_modelo,\n    CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nfrom\n    viagem_periodo v\nwhere (\n    perc_conformidade_shape >= 80\n)\nand (\n    perc_conformidade_distancia >= 0\n)\nand (\n    perc_conformidade_registros >= 50\n)\n\n),\n-- 3. Filtra viagens com mesma chegada e partida pelo maior % de conformidade do shape\nfiltro_desvio as (\n  SELECT\n    \n    * EXCEPT(rn)\n    \nFROM (\n  SELECT\n    *,\n    \n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida, datetime_chegada ORDER BY perc_conformidade_shape DESC) AS rn\n    \n  FROM\n    viagem_comp_conf )\nWHERE\n  rn = 1\n),\n-- 4. Filtra viagens com partida ou chegada diferentes pela maior distancia percorrida\nfiltro_partida AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM (\n    SELECT\n      *,\n      ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_partida ORDER BY distancia_planejada DESC) AS rn\n    FROM\n      filtro_desvio )\n  WHERE\n    rn = 1 )\n-- filtro_chegada\nSELECT\n  * EXCEPT(rn)\nFROM (\n  SELECT\n    *,\n    ROW_NUMBER() OVER(PARTITION BY id_veiculo, datetime_chegada ORDER BY distancia_planejada DESC) AS rn\n  FROM\n    filtro_partida )\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_viagem_circular": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "aux_viagem_circular", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/aux_viagem_circular.sql", "original_file_path": "models/projeto_subsidio_sppo/aux_viagem_circular.sql", "unique_id": "model.rj_smtr.aux_viagem_circular", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "aux_viagem_circular"], "alias": "aux_viagem_circular", "checksum": {"name": "sha256", "checksum": "19bae4bb659e9d2f654cbfa6aa6b89e013928e0f1d2af822c1b4abc86a7f2275"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela auxiliar de tratamento de viagens circulares (atualizada diariamente, sem hist\u00f3rico).", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Servi\u00e7o realizado pelo ve\u00edculo (com base na identifica\u00e7\u00e3o do trajeto)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape (codificado no shape_id - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9100215, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`", "raw_code": "-- 1. Identifica viagens circulares de ida que possuem volta\r\n--    consecutiva. Junta numa \u00fanica linha a datetime_partida (ida) + datetime_chegada_volta\r\nwith ida_volta_circular as (\r\n    select\r\n        t.*\r\n    from (\r\n        select\r\n            *,\r\n            lead(datetime_partida) over (\r\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as datetime_partida_volta,\r\n            lead(datetime_chegada) over (\r\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as datetime_chegada_volta,\r\n            lead(shape_id) over (\r\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as shape_id_volta,\r\n            lead(sentido_shape) over (\r\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) = \"V\" as flag_proximo_volta -- possui volta\r\n        from\r\n            {{ ref(\"aux_viagem_inicio_fim\") }} v\r\n        where\r\n            sentido = \"C\"\r\n    ) t\r\n    where\r\n        flag_proximo_volta = TRUE\r\n        and sentido_shape = \"I\"\r\n        and datetime_chegada <= datetime_partida_volta\r\n),\r\n-- 2. Filtra apenas viagens circulares de ida e volta consecutivas\r\n--    (mantem ida e volta separadas, mas com o mesmo id)\r\nviagem_circular as (\r\n    select distinct\r\n        *\r\n    from (\r\n        select\r\n            case\r\n                when (\r\n                    v.sentido_shape = \"I\"\r\n                    and v.datetime_partida = c.datetime_partida\r\n                ) then c.id_viagem\r\n                when (\r\n                    v.sentido_shape = \"V\"\r\n                    and v.datetime_chegada = c.datetime_chegada_volta\r\n                ) then c.id_viagem\r\n            end as id_viagem,\r\n            v.* except(id_viagem)\r\n        from\r\n            {{ ref(\"aux_viagem_inicio_fim\") }} v\r\n        inner join\r\n            ida_volta_circular c\r\n        on\r\n            c.id_veiculo = v.id_veiculo\r\n            and c.servico_realizado = v.servico_realizado\r\n            and c.sentido = v.sentido\r\n    ) v\r\n    where\r\n        id_viagem is not null\r\n)\r\n-- 3. Junta viagens circulares tratadas \u00e0s viagens n\u00e3o circulares j\u00e1 identificadas\r\nselect\r\n    *\r\nfrom\r\n    viagem_circular v\r\nunion all (\r\n    select\r\n        *\r\n    from\r\n        {{ ref(\"aux_viagem_inicio_fim\") }} v\r\n    where\r\n        sentido = \"I\" or sentido = \"V\"\r\n)", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}, {"name": "aux_viagem_inicio_fim", "package": null, "version": null}, {"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/aux_viagem_circular.sql", "compiled": true, "compiled_code": "-- 1. Identifica viagens circulares de ida que possuem volta\n--    consecutiva. Junta numa \u00fanica linha a datetime_partida (ida) + datetime_chegada_volta\nwith ida_volta_circular as (\n    select\n        t.*\n    from (\n        select\n            *,\n            lead(datetime_partida) over (\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as datetime_partida_volta,\n            lead(datetime_chegada) over (\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as datetime_chegada_volta,\n            lead(shape_id) over (\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) as shape_id_volta,\n            lead(sentido_shape) over (\n                partition by id_veiculo, servico_realizado order by id_veiculo, servico_realizado, datetime_partida, sentido_shape) = \"V\" as flag_proximo_volta -- possui volta\n        from\n            `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim` v\n        where\n            sentido = \"C\"\n    ) t\n    where\n        flag_proximo_volta = TRUE\n        and sentido_shape = \"I\"\n        and datetime_chegada <= datetime_partida_volta\n),\n-- 2. Filtra apenas viagens circulares de ida e volta consecutivas\n--    (mantem ida e volta separadas, mas com o mesmo id)\nviagem_circular as (\n    select distinct\n        *\n    from (\n        select\n            case\n                when (\n                    v.sentido_shape = \"I\"\n                    and v.datetime_partida = c.datetime_partida\n                ) then c.id_viagem\n                when (\n                    v.sentido_shape = \"V\"\n                    and v.datetime_chegada = c.datetime_chegada_volta\n                ) then c.id_viagem\n            end as id_viagem,\n            v.* except(id_viagem)\n        from\n            `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim` v\n        inner join\n            ida_volta_circular c\n        on\n            c.id_veiculo = v.id_veiculo\n            and c.servico_realizado = v.servico_realizado\n            and c.sentido = v.sentido\n    ) v\n    where\n        id_viagem is not null\n)\n-- 3. Junta viagens circulares tratadas \u00e0s viagens n\u00e3o circulares j\u00e1 identificadas\nselect\n    *\nfrom\n    viagem_circular v\nunion all (\n    select\n        *\n    from\n        `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim` v\n    where\n        sentido = \"I\" or sentido = \"V\"\n)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_quadro_horario": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "subsidio_quadro_horario", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/deprecated/subsidio_quadro_horario.sql", "original_file_path": "models/projeto_subsidio_sppo/deprecated/subsidio_quadro_horario.sql", "unique_id": "model.rj_smtr.subsidio_quadro_horario", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "deprecated", "subsidio_quadro_horario"], "alias": "subsidio_quadro_horario", "checksum": {"name": "sha256", "checksum": "d04d4cd21dec62dc4622cdfe30557419f92c96bc20458fcff06699beb2186d47"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Dados de planejamento operacional dos servi\u00e7os (Descontinuada a partir de 2024-04-01 [SUBSIDIO_V6])", "columns": {"data_versao": {"name": "data_versao", "description": "Data de refer\u00eancia do planejamento (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto do servi\u00e7o operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 006, 010, ...).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio respons\u00e1vel pelo servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "horario_inicio": {"name": "horario_inicio", "description": "Hor\u00e1rio inicial de funcionamento do servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "horario_fim": {"name": "horario_fim", "description": "Hor\u00e1rio da final de funcionamento do servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia planejada de uma viagem do servi\u00e7o (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido planejado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "C\u00f3digo identificador de trip de refer\u00eancia no GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, Sabado, Domingo e Ponto Facultativo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia total planejada do servi\u00e7o em km (junta ida+volta multiplicado pela quantidade de viagens).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9270875, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`subsidio_quadro_horario`", "raw_code": "SELECT\r\n    SAFE_CAST(data_versao AS DATE) data_versao,\r\n    SAFE_CAST(servico AS STRING) servico,\r\n    SAFE_CAST(vista AS STRING) vista,\r\n    SAFE_CAST(consorcio AS STRING) consorcio,\r\n    SAFE_CAST(horario_inicio AS STRING) horario_inicio,\r\n    SAFE_CAST(horario_fim AS STRING) horario_fim,\r\n    SAFE_CAST(trip_id AS STRING) trip_id,\r\n    SAFE_CAST(sentido AS STRING) sentido,\r\n    SAFE_CAST(distancia_planejada AS FLOAT64) distancia_planejada,\r\n    SAFE_CAST(tipo_dia AS STRING) tipo_dia,\r\n    SAFE_CAST(distancia_total_planejada AS FLOAT64) distancia_total_planejada\r\nFROM {{ var(\"quadro_horario\") }} AS t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/deprecated/subsidio_quadro_horario.sql", "compiled": true, "compiled_code": "SELECT\n    SAFE_CAST(data_versao AS DATE) data_versao,\n    SAFE_CAST(servico AS STRING) servico,\n    SAFE_CAST(vista AS STRING) vista,\n    SAFE_CAST(consorcio AS STRING) consorcio,\n    SAFE_CAST(horario_inicio AS STRING) horario_inicio,\n    SAFE_CAST(horario_fim AS STRING) horario_fim,\n    SAFE_CAST(trip_id AS STRING) trip_id,\n    SAFE_CAST(sentido AS STRING) sentido,\n    SAFE_CAST(distancia_planejada AS FLOAT64) distancia_planejada,\n    SAFE_CAST(tipo_dia AS STRING) tipo_dia,\n    SAFE_CAST(distancia_total_planejada AS FLOAT64) distancia_total_planejada\nFROM `rj-smtr-staging.projeto_subsidio_sppo_staging.quadro_horario` AS t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_shapes_geom": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "subsidio_shapes_geom", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/deprecated/subsidio_shapes_geom.sql", "original_file_path": "models/projeto_subsidio_sppo/deprecated/subsidio_shapes_geom.sql", "unique_id": "model.rj_smtr.subsidio_shapes_geom", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "deprecated", "subsidio_shapes_geom"], "alias": "subsidio_shapes_geom", "checksum": {"name": "sha256", "checksum": "e884e5ccb5c0e1f934b89e84f26e1650d22b9297700c5c6886b93cc8b49913f3"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data_versao", "shape_id"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_versao", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Shapes em formatos geogr\u00e1ficos dos servi\u00e7os (Descontinuada a partir de 2024-04-01 [SUBSIDIO_V6])", "columns": {"shape_id": {"name": "shape_id", "description": "Identificador de shape.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape": {"name": "shape", "description": "Shape em formato geogr\u00e1fico (usualmente LineString).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_distance": {"name": "shape_distance", "description": "Extens\u00e3o do shape.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_pt": {"name": "start_pt", "description": "Ponto inicial do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_pt": {"name": "end_pt", "description": "Ponto final do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao": {"name": "data_versao", "description": "Data de refer\u00eancia do planejamento (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "projeto_subsidio_sppo", "partition_by": {"field": "data_versao", "data_type": "date", "granularity": "day"}, "unique_key": ["data_versao", "shape_id"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709587.9236295, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`subsidio_shapes_geom`", "raw_code": "{{ config(\r\n    materialized='incremental',\r\n        partition_by={\r\n        \"field\":\"data_versao\",\r\n        \"data_type\": \"date\",\r\n        \"granularity\":\"day\"\r\n    },\r\n    unique_key=['data_versao', 'shape_id'],\r\n    incremental_strategy='insert_overwrite'\r\n)\r\n}}\r\n\r\nwith data_versao as (\r\n    select data_versao_shapes\r\n    from {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n    where data between date_sub(\"{{ var(\"run_date\") }}\", interval 1 day) and date(\"{{ var(\"run_date\") }}\")\r\n),\r\ncontents as (\r\n    SELECT\r\n        shape_id,\r\n        ST_GEOGPOINT(\r\n            SAFE_CAST(shape_pt_lon AS FLOAT64),\r\n            SAFE_CAST(shape_pt_lat AS FLOAT64)\r\n        ) ponto_shape,\r\n        SAFE_CAST(shape_pt_sequence as INT64) shape_pt_sequence,\r\n        DATE(data_versao) AS data_versao\r\n    FROM\r\n        {{ var(\"subsidio_shapes\") }} s\r\n    {% if is_incremental() %}\r\n    WHERE\r\n        data_versao in (select data_versao_shapes from data_versao)\r\n    {% endif %}\r\n),\r\npts as (\r\n    select\r\n        *,\r\n        max(shape_pt_sequence) over(\r\n                partition by data_versao, shape_id\r\n        ) final_pt_sequence\r\n    from\r\n        contents c\r\n    order by\r\n        data_versao, shape_id, shape_pt_sequence\r\n),\r\nshapes as (\r\n-- BUILD LINESTRINGS OVER SHAPE POINTS\r\n    SELECT\r\n        shape_id,\r\n        data_versao,\r\n        st_makeline(ARRAY_AGG(ponto_shape)) as shape\r\n    FROM pts\r\n    GROUP BY 1,2\r\n),\r\nboundary as (\r\n-- EXTRACT START AND END POINTS FROM SHAPES\r\n    SELECT\r\n        c1.shape_id,\r\n        c1.ponto_shape start_pt,\r\n        c2.ponto_shape end_pt,\r\n        c1.data_versao\r\n    FROM\r\n        (select * from pts where shape_pt_sequence = 1) c1\r\n    JOIN\r\n        (select * from pts where shape_pt_sequence = final_pt_sequence) c2\r\n    ON\r\n        c1.shape_id = c2.shape_id and c1.data_versao = c2.data_versao\r\n),\r\nmerged as (\r\n-- JOIN SHAPES AND BOUNDARY POINTS\r\n    SELECT\r\n        s.*,\r\n        b.* except(data_versao, shape_id),\r\n        round(ST_LENGTH(shape),1) shape_distance,\r\n    FROM\r\n        shapes s\r\n    JOIN\r\n        boundary b\r\n    ON\r\n        s.shape_id = b.shape_id and s.data_versao = b.data_versao\r\n),\r\nids as (\r\n    SELECT\r\n        shape_id,\r\n        shape,\r\n        shape_distance,\r\n        start_pt,\r\n        end_pt,\r\n        data_versao,\r\n        row_number() over(\r\n                partition by data_versao, shape_id\r\n        ) rn\r\n    FROM merged m\r\n)\r\nSELECT\r\n       * except(rn),\r\n       \"{{ var(\"version\") }}\" as versao_modelo\r\nFROM ids\r\nWHERE rn = 1", "language": "sql", "refs": [{"name": "subsidio_data_versao_efetiva", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.subsidio_data_versao_efetiva"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/deprecated/subsidio_shapes_geom.sql", "compiled": true, "compiled_code": "\n\nwith data_versao as (\n    select data_versao_shapes\n    from `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n    where data between date_sub(\"2022-01-01T01:00:00\", interval 1 day) and date(\"2022-01-01T01:00:00\")\n),\ncontents as (\n    SELECT\n        shape_id,\n        ST_GEOGPOINT(\n            SAFE_CAST(shape_pt_lon AS FLOAT64),\n            SAFE_CAST(shape_pt_lat AS FLOAT64)\n        ) ponto_shape,\n        SAFE_CAST(shape_pt_sequence as INT64) shape_pt_sequence,\n        DATE(data_versao) AS data_versao\n    FROM\n        `rj-smtr-staging.projeto_subsidio_sppo_staging.shapes` s\n    \n    WHERE\n        data_versao in (select data_versao_shapes from data_versao)\n    \n),\npts as (\n    select\n        *,\n        max(shape_pt_sequence) over(\n                partition by data_versao, shape_id\n        ) final_pt_sequence\n    from\n        contents c\n    order by\n        data_versao, shape_id, shape_pt_sequence\n),\nshapes as (\n-- BUILD LINESTRINGS OVER SHAPE POINTS\n    SELECT\n        shape_id,\n        data_versao,\n        st_makeline(ARRAY_AGG(ponto_shape)) as shape\n    FROM pts\n    GROUP BY 1,2\n),\nboundary as (\n-- EXTRACT START AND END POINTS FROM SHAPES\n    SELECT\n        c1.shape_id,\n        c1.ponto_shape start_pt,\n        c2.ponto_shape end_pt,\n        c1.data_versao\n    FROM\n        (select * from pts where shape_pt_sequence = 1) c1\n    JOIN\n        (select * from pts where shape_pt_sequence = final_pt_sequence) c2\n    ON\n        c1.shape_id = c2.shape_id and c1.data_versao = c2.data_versao\n),\nmerged as (\n-- JOIN SHAPES AND BOUNDARY POINTS\n    SELECT\n        s.*,\n        b.* except(data_versao, shape_id),\n        round(ST_LENGTH(shape),1) shape_distance,\n    FROM\n        shapes s\n    JOIN\n        boundary b\n    ON\n        s.shape_id = b.shape_id and s.data_versao = b.data_versao\n),\nids as (\n    SELECT\n        shape_id,\n        shape,\n        shape_distance,\n        start_pt,\n        end_pt,\n        data_versao,\n        row_number() over(\n                partition by data_versao, shape_id\n        ) rn\n    FROM merged m\n)\nSELECT\n       * except(rn),\n       \"\" as versao_modelo\nFROM ids\nWHERE rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_trips_desaninhada": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo", "name": "subsidio_trips_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo/deprecated/subsidio_trips_desaninhada.sql", "original_file_path": "models/projeto_subsidio_sppo/deprecated/subsidio_trips_desaninhada.sql", "unique_id": "model.rj_smtr.subsidio_trips_desaninhada", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "deprecated", "subsidio_trips_desaninhada"], "alias": "subsidio_trips_desaninhada", "checksum": {"name": "sha256", "checksum": "9e25678a7ddbcebe30bf8937a5bad2162466795e31a8647507c5ce9e01d18f1c"}, "config": {"enabled": true, "alias": null, "schema": "projeto_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Viagens para cada servi\u00e7o (Descontinuada a partir de 2024-04-01 [SUBSIDIO_V6])", "columns": {"trip_id": {"name": "trip_id", "description": "Identifica uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "Identifica uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_headsign": {"name": "trip_headsign", "description": "Texto que aparece na sinaliza\u00e7\u00e3o identificando o destino da viagem aos passageiros.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_short_name": {"name": "trip_short_name", "description": "Texto voltado ao p\u00fablico usado para identificar a viagem aos passageiros, por exemplo, para identificar os n\u00fameros dos trens para viagens de trens suburbanos.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "Identifica uma forma geoespacial que descreve o caminho de deslocamento do ve\u00edculo para uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "wheelchair_accessible": {"name": "wheelchair_accessible", "description": "Indica acessibilidade para cadeiras de rodas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "variacao_itinerario": {"name": "variacao_itinerario", "description": "Apenas Dia \u00datil (DU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao": {"name": "data_versao", "description": "Data de refer\u00eancia do planejamento (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo"}, "created_at": 1727709587.9255002, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo`.`subsidio_trips_desaninhada`", "raw_code": "-- 1. Cria view das trips consideradas no subsidio\r\nselect\r\n    trip_id,\r\n    -- concat(substr(trip_id, 1, 10), substr(trip_id, 12, 4)) as trip_no_direction,\r\n    route_id,\r\n    trip_headsign,\r\n    case\r\n        when REGEXP_EXTRACT(trip_short_name, r'[A-Z]+') is null\r\n        then trip_short_name\r\n        else concat(REGEXP_EXTRACT(trip_short_name, r'[A-Z]+'),\r\n                REGEXP_EXTRACT(trip_short_name, r'[0-9]+'))\r\n    end as trip_short_name,\r\n    shape_id,\r\n    \"DU\" as variacao_itinerario,\r\n    DATE(data_versao) data_versao\r\nfrom\r\n    {{ var(\"subsidio_trips\") }} t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/deprecated/subsidio_trips_desaninhada.sql", "compiled": true, "compiled_code": "-- 1. Cria view das trips consideradas no subsidio\nselect\n    trip_id,\n    -- concat(substr(trip_id, 1, 10), substr(trip_id, 12, 4)) as trip_no_direction,\n    route_id,\n    trip_headsign,\n    case\n        when REGEXP_EXTRACT(trip_short_name, r'[A-Z]+') is null\n        then trip_short_name\n        else concat(REGEXP_EXTRACT(trip_short_name, r'[A-Z]+'),\n                REGEXP_EXTRACT(trip_short_name, r'[0-9]+'))\n    end as trip_short_name,\n    shape_id,\n    \"DU\" as variacao_itinerario,\n    DATE(data_versao) data_versao\nfrom\n    `rj-smtr-staging.projeto_subsidio_sppo_staging.trips` t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_ordem_pagamento_consorcio": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_ordem_pagamento_consorcio", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio.sql", "unique_id": "model.rj_smtr.staging_ordem_pagamento_consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_ordem_pagamento_consorcio"], "alias": "ordem_pagamento_consorcio", "checksum": {"name": "sha256", "checksum": "603f6b4ebf6066784d67cda191666483d2dd68055a06b8f0ceb667c4474a98eb"}, "config": {"enabled": true, "alias": "ordem_pagamento_consorcio", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "ordem_pagamento_consorcio"}, "created_at": 1727709586.2783775, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio`", "raw_code": "{{\n  config(\n    alias='ordem_pagamento_consorcio',\n  )\n}}\n\nWITH ordem_pagamento_consorcio AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento_consorcio,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n      {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"ordem_pagamento_consorcio\") }}\n),\nordem_pagamento_consorcio_rn AS (\n  SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento_consorcio ORDER BY timestamp_captura DESC) AS rn\n  FROM\n      ordem_pagamento_consorcio\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_consorcio_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento_consorcio"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_pagamento_consorcio AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento_consorcio,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n      `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio`\n),\nordem_pagamento_consorcio_rn AS (\n  SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento_consorcio ORDER BY timestamp_captura DESC) AS rn\n  FROM\n      ordem_pagamento_consorcio\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_consorcio_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_cliente": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_cliente", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_cliente.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_cliente.sql", "unique_id": "model.rj_smtr.staging_cliente", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_cliente"], "alias": "cliente", "checksum": {"name": "sha256", "checksum": "2a8bdfe2ba90dc808065e4f0a276dc9878093e542d127b03e85bac35f40e7f84"}, "config": {"enabled": true, "alias": "cliente", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": ["identificacao"], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": ["identificacao"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "cliente", "tags": ["identificacao"]}, "created_at": 1727709586.2806363, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`cliente`", "raw_code": "{{\n  config(\n    alias='cliente',\n    tags=['identificacao']\n  )\n}}\n\nWITH\n    cliente AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_DOCUMENTO') AS STRING) AS cd_tipo_documento,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CLIENTE') AS STRING) AS nm_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CLIENTE_SOCIAL') AS STRING) AS nm_cliente_social,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_TIPO_PESSOA_FISICA_JURIDICA') AS STRING) AS in_tipo_pessoa_fisica_juridica,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_DOCUMENTO') AS STRING) AS nr_documento,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_DOCUMENTO_ALTERNATIVO') AS STRING) AS nr_documento_alternativo,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_EMAIL') AS STRING) AS tx_email,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_TELEFONE') AS STRING) AS nr_telefone,\n            SAFE_CAST(JSON_VALUE(content, '$.DT_CADASTRO') AS STRING) AS dt_cadastro\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"cliente\") }}\n    ),\n    cliente_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            cliente\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  cliente_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "cliente"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_cliente.sql", "compiled": true, "compiled_code": "\n\nWITH\n    cliente AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_DOCUMENTO') AS STRING) AS cd_tipo_documento,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CLIENTE') AS STRING) AS nm_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CLIENTE_SOCIAL') AS STRING) AS nm_cliente_social,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_TIPO_PESSOA_FISICA_JURIDICA') AS STRING) AS in_tipo_pessoa_fisica_juridica,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_DOCUMENTO') AS STRING) AS nr_documento,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_DOCUMENTO_ALTERNATIVO') AS STRING) AS nr_documento_alternativo,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_EMAIL') AS STRING) AS tx_email,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_TELEFONE') AS STRING) AS nr_telefone,\n            SAFE_CAST(JSON_VALUE(content, '$.DT_CADASTRO') AS STRING) AS dt_cadastro\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`cliente`\n    ),\n    cliente_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            cliente\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  cliente_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_transacao_riocard": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_transacao_riocard", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_transacao_riocard.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_transacao_riocard.sql", "unique_id": "model.rj_smtr.staging_transacao_riocard", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_transacao_riocard"], "alias": "transacao_riocard", "checksum": {"name": "sha256", "checksum": "c17d91d7c52fba3e08f845cdfb92beef836125b35e519d259401deea85e00d4d"}, "config": {"enabled": true, "alias": "transacao_riocard", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "transacao_riocard"}, "created_at": 1727709586.2828155, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao_riocard`", "raw_code": "{{\n    config(\n        alias='transacao_riocard',\n    )\n}}\n\nSELECT\n    data,\n    hora,\n    id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.assinatura') AS STRING) AS assinatura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_aplicacao') AS STRING) AS cd_aplicacao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_emissor') AS STRING) AS cd_emissor,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_consorcio') AS STRING) AS cd_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_linha') AS STRING) AS cd_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_matriz_integracao') AS STRING) AS cd_matriz_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_operadora') AS STRING) AS cd_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_secao') AS STRING) AS cd_secao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_status_transacao') AS STRING) AS cd_status_transacao,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), \"America/Sao_Paulo\") AS data_processamento,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_transacao') AS STRING)), \"America/Sao_Paulo\") AS data_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_cliente') AS STRING) AS id_cliente,\n    SAFE_CAST(JSON_VALUE(content, '$.id_produto') AS STRING) AS id_produto,\n    SAFE_CAST(JSON_VALUE(content, '$.id_servico') AS STRING) AS id_servico,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_midia') AS STRING) AS id_tipo_midia,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_trx') AS FLOAT64) AS latitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_trx') AS FLOAT64) AS longitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador') AS STRING) AS nr_logico_midia_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_validador') AS STRING) AS numero_serie_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.pan_hash') AS STRING) AS pan_hash,\n    SAFE_CAST(JSON_VALUE(content, '$.posicao_validador') AS STRING) AS posicao_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_integracao') AS STRING) AS tipo_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_transacao') AS STRING) AS tipo_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.uid_origem') AS STRING) AS uid_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa') AS NUMERIC) AS valor_tarifa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_transacao') AS NUMERIC) AS valor_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.veiculo_id') AS STRING) AS veiculo_id,\n    SAFE_CAST(JSON_VALUE(content, '$.vl_saldo') AS NUMERIC) AS vl_saldo\nFROM\n    {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"transacao_riocard\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "transacao_riocard"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_transacao_riocard.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    data,\n    hora,\n    id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.assinatura') AS STRING) AS assinatura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_aplicacao') AS STRING) AS cd_aplicacao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_emissor') AS STRING) AS cd_emissor,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_consorcio') AS STRING) AS cd_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_linha') AS STRING) AS cd_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_matriz_integracao') AS STRING) AS cd_matriz_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_operadora') AS STRING) AS cd_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_secao') AS STRING) AS cd_secao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_status_transacao') AS STRING) AS cd_status_transacao,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), \"America/Sao_Paulo\") AS data_processamento,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_transacao') AS STRING)), \"America/Sao_Paulo\") AS data_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_cliente') AS STRING) AS id_cliente,\n    SAFE_CAST(JSON_VALUE(content, '$.id_produto') AS STRING) AS id_produto,\n    SAFE_CAST(JSON_VALUE(content, '$.id_servico') AS STRING) AS id_servico,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_midia') AS STRING) AS id_tipo_midia,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_trx') AS FLOAT64) AS latitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_trx') AS FLOAT64) AS longitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador') AS STRING) AS nr_logico_midia_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_validador') AS STRING) AS numero_serie_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.pan_hash') AS STRING) AS pan_hash,\n    SAFE_CAST(JSON_VALUE(content, '$.posicao_validador') AS STRING) AS posicao_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_integracao') AS STRING) AS tipo_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_transacao') AS STRING) AS tipo_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.uid_origem') AS STRING) AS uid_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa') AS NUMERIC) AS valor_tarifa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_transacao') AS NUMERIC) AS valor_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.veiculo_id') AS STRING) AS veiculo_id,\n    SAFE_CAST(JSON_VALUE(content, '$.vl_saldo') AS NUMERIC) AS vl_saldo\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao_riocard`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_consorcio": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_consorcio", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_consorcio.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_consorcio.sql", "unique_id": "model.rj_smtr.staging_consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_consorcio"], "alias": "consorcio", "checksum": {"name": "sha256", "checksum": "a2138ed90b258fdd896aa45b3ea99b0b90977bfdadc1711fae08040a7d0a1024"}, "config": {"enabled": true, "alias": "consorcio", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "consorcio"}, "created_at": 1727709586.2850275, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`consorcio`", "raw_code": "{{\n  config(\n    alias='consorcio',\n  )\n}}\n\nWITH\n    consorcio AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CONSORCIO') AS STRING) AS nm_consorcio\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"consorcio\") }}\n    ),\n    consorcio_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_consorcio ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            consorcio\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  consorcio_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "consorcio"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_consorcio.sql", "compiled": true, "compiled_code": "\n\nWITH\n    consorcio AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CONSORCIO') AS STRING) AS nm_consorcio\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`consorcio`\n    ),\n    consorcio_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_consorcio ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            consorcio\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  consorcio_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_passageiros_hora": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "aux_passageiros_hora", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/aux_passageiros_hora.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/aux_passageiros_hora.sql", "unique_id": "model.rj_smtr.aux_passageiros_hora", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "aux_passageiros_hora"], "alias": "aux_passageiros_hora", "checksum": {"name": "sha256", "checksum": "de22cec61e174e1eb4e868cb34953607407be78ed821e4011a0c8fb525050d39"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_bilhetagem_staging"}, "created_at": 1727709586.2871754, "relation_name": null, "raw_code": "{{\n  config(materialized=\"ephemeral\")\n}}\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  {{ ref('transacao') }}\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  {{ ref('transacao_riocard') }}\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/aux_passageiros_hora.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  tipo_transacao_smtr,\n  CASE\n    WHEN tipo_transacao_smtr = \"Gratuidade\" THEN tipo_gratuidade\n    WHEN tipo_transacao_smtr = \"Integra\u00e7\u00e3o\" THEN \"Integra\u00e7\u00e3o\"\n    WHEN tipo_transacao_smtr = \"Transfer\u00eancia\" THEN \"Transfer\u00eancia\"\n    ELSE tipo_pagamento\n  END AS tipo_transacao_detalhe_smtr,\n  tipo_gratuidade,\n  tipo_pagamento,\n  geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\nWHERE\n  id_servico_jae NOT IN (\"140\", \"142\")\n  AND id_operadora != \"2\"\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n  )\n  AND tipo_transacao IS NOT NULL\n\nUNION ALL\n\nSELECT\n  data,\n  hora,\n  modo,\n  consorcio,\n  id_servico_jae,\n  servico_jae,\n  descricao_servico_jae,\n  sentido,\n  id_transacao,\n  \"RioCard\" AS tipo_transacao_smtr,\n  \"RioCard\" AS tipo_transacao_detalhe_smtr,\n  NULL AS tipo_gratuidade,\n  \"RioCard\" AS tipo_pagamento,\n  ST_GEOGPOINT(longitude, latitude) AS geo_point_transacao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\nWHERE\n  (id_servico_jae NOT IN (\"140\", \"142\") OR id_servico_jae IS NULL)\n  AND (id_operadora != \"2\" OR id_operadora IS NULL)\n  AND (\n    modo = \"BRT\"\n    OR (modo = \"VLT\" AND data >= DATE(\"2024-02-24\"))\n    OR (modo = \"\u00d4nibus\" AND data >= DATE(\"2024-04-19\"))\n    OR (modo = \"Van\" AND consorcio = \"STPC\" AND data >= DATE(\"2024-07-01\"))\n    OR (modo = \"Van\" AND consorcio = \"STPL\" AND data >= DATE(\"2024-07-15\"))\n    OR modo IS NULL\n  )", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gratuidade_aux": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "gratuidade_aux", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/gratuidade_aux.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/gratuidade_aux.sql", "unique_id": "model.rj_smtr.gratuidade_aux", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "gratuidade_aux"], "alias": "gratuidade_aux", "checksum": {"name": "sha256", "checksum": "950fc34352cdfc33908be9dea3ceabc501303847becf0b43a1797fb116c5d779"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": "merge", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_gratuidade", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "id_cliente", "data_type": "int64", "range": {"start": 0, "end": 100000000, "interval": 10000}}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "incremental_strategy": "merge", "unique_key": "id_gratuidade", "partition_by": {"field": "id_cliente", "data_type": "int64", "range": {"start": 0, "end": 100000000, "interval": 10000}}}, "created_at": 1727709586.2894597, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade_aux`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n    incremental_strategy=\"merge\",\n    unique_key=\"id_gratuidade\",\n    partition_by={\n      \"field\": \"id_cliente\",\n      \"data_type\": \"int64\",\n      \"range\": {\n        \"start\": 0,\n        \"end\": 100000000,\n        \"interval\": 10000\n      }\n    },\n  )\n}}\n\n\n{% set staging_gratuidade = ref('staging_gratuidade') %}\n\n\nWITH gratuidade_complete_partitions AS (\n    SELECT\n        CAST(CAST(cd_cliente AS FLOAT64) AS INT64) AS id_cliente,\n        id AS id_gratuidade,\n        tipo_gratuidade,\n        data_inclusao AS data_inicio_validade,\n        timestamp_captura\n    FROM\n        {{ staging_gratuidade }}\n),\ngratuidade_deduplicada AS (\n    SELECT\n        * EXCEPT(rn)\n    FROM\n        (\n            SELECT\n                *,\n                ROW_NUMBER() OVER (PARTITION BY id_gratuidade ORDER BY timestamp_captura DESC) AS rn\n            FROM\n                gratuidade_complete_partitions\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    id_cliente,\n    id_gratuidade,\n    tipo_gratuidade,\n    data_inicio_validade,\n    LEAD(data_inicio_validade) OVER (PARTITION BY id_cliente ORDER BY data_inicio_validade) AS data_fim_validade,\n    timestamp_captura\nFROM\n    gratuidade_deduplicada", "language": "sql", "refs": [{"name": "staging_gratuidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_gratuidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/gratuidade_aux.sql", "compiled": true, "compiled_code": "\n\n\n\n\n\nWITH gratuidade_complete_partitions AS (\n    SELECT\n        CAST(CAST(cd_cliente AS FLOAT64) AS INT64) AS id_cliente,\n        id AS id_gratuidade,\n        tipo_gratuidade,\n        data_inclusao AS data_inicio_validade,\n        timestamp_captura\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade`\n),\ngratuidade_deduplicada AS (\n    SELECT\n        * EXCEPT(rn)\n    FROM\n        (\n            SELECT\n                *,\n                ROW_NUMBER() OVER (PARTITION BY id_gratuidade ORDER BY timestamp_captura DESC) AS rn\n            FROM\n                gratuidade_complete_partitions\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    id_cliente,\n    id_gratuidade,\n    tipo_gratuidade,\n    data_inicio_validade,\n    LEAD(data_inicio_validade) OVER (PARTITION BY id_cliente ORDER BY data_inicio_validade) AS data_fim_validade,\n    timestamp_captura\nFROM\n    gratuidade_deduplicada", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_linha_consorcio_operadora_transporte": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_linha_consorcio_operadora_transporte", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio_operadora_transporte.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio_operadora_transporte.sql", "unique_id": "model.rj_smtr.staging_linha_consorcio_operadora_transporte", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_linha_consorcio_operadora_transporte"], "alias": "linha_consorcio_operadora_transporte", "checksum": {"name": "sha256", "checksum": "24b3da8cc8ef7b55c541e47749e319b5f6992c093daf408082203a779f8e46e3"}, "config": {"enabled": true, "alias": "linha_consorcio_operadora_transporte", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "linha_consorcio_operadora_transporte"}, "created_at": 1727709586.2954698, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio_operadora_transporte`", "raw_code": "{{\n  config(\n    alias='linha_consorcio_operadora_transporte',\n  )\n}}\n\nWITH linha_consorcio_operadora_transporte AS (\n  SELECT\n    data,\n    SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n    SAFE_CAST(CD_OPERADORA_TRANSPORTE AS STRING) AS cd_operadora_transporte,\n    SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_INICIO_VALIDADE') AS STRING)) AS dt_inicio_validade,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_FIM_VALIDADE') AS STRING)) AS dt_fim_validade\n  FROM\n    {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"linha_consorcio_operadora_transporte\") }}\n),\nlinha_consorcio_operadora_transporte_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY cd_consorcio, cd_operadora_transporte, cd_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_consorcio_operadora_transporte\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_consorcio_operadora_transporte_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "linha_consorcio_operadora_transporte"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio_operadora_transporte.sql", "compiled": true, "compiled_code": "\n\nWITH linha_consorcio_operadora_transporte AS (\n  SELECT\n    data,\n    SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n    SAFE_CAST(CD_OPERADORA_TRANSPORTE AS STRING) AS cd_operadora_transporte,\n    SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_INICIO_VALIDADE') AS STRING)) AS dt_inicio_validade,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_FIM_VALIDADE') AS STRING)) AS dt_fim_validade\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio_operadora_transporte`\n),\nlinha_consorcio_operadora_transporte_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY cd_consorcio, cd_operadora_transporte, cd_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_consorcio_operadora_transporte\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_consorcio_operadora_transporte_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_servico_motorista": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_servico_motorista", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_servico_motorista.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_servico_motorista.sql", "unique_id": "model.rj_smtr.staging_servico_motorista", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_servico_motorista"], "alias": "servico_motorista", "checksum": {"name": "sha256", "checksum": "963977376a134761e3315a504371c6d031cf2e0b44443c63f916f6f40f6be552"}, "config": {"enabled": true, "alias": "servico_motorista", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "servico_motorista"}, "created_at": 1727709586.297638, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`servico_motorista`", "raw_code": "{{\n  config(\n    alias='servico_motorista',\n  )\n}}\n\nSELECT\n  data,\n  SAFE_CAST(NR_LOGICO_MIDIA AS STRING) AS nr_logico_midia,\n  SAFE_CAST(ID_SERVICO AS STRING) AS id_servico,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_LINHA') AS STRING) AS cd_linha,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_OPERADORA') AS STRING) AS cd_operadora,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_STATUS') AS STRING) AS cd_status,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_ABERTURA') AS STRING)), 'America/Sao_Paulo') AS dt_abertura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_FECHAMENTO') AS STRING)), 'America/Sao_Paulo') AS dt_fechamento,\n  SAFE_CAST(JSON_VALUE(content, '$.ID_VEICULO') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content, '$.NR_LOGICO_MIDIA_FECHAMENTO') AS STRING) AS nr_logico_midia_fechamento,\n  SAFE_CAST(JSON_VALUE(content, '$.SN_DEVICE') AS STRING) AS sn_device,\n  SAFE_CAST(JSON_VALUE(content, '$.TP_GERACAO') AS STRING) AS tp_geracao,\n  SAFE_CAST(JSON_VALUE(content, '$.VL_TARIFA_LINHA') AS FLOAT64) AS vl_tarifa_linha\nFROM\n  {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'servico_motorista') }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "servico_motorista"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_servico_motorista.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  data,\n  SAFE_CAST(NR_LOGICO_MIDIA AS STRING) AS nr_logico_midia,\n  SAFE_CAST(ID_SERVICO AS STRING) AS id_servico,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_LINHA') AS STRING) AS cd_linha,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_OPERADORA') AS STRING) AS cd_operadora,\n  SAFE_CAST(JSON_VALUE(content, '$.CD_STATUS') AS STRING) AS cd_status,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_ABERTURA') AS STRING)), 'America/Sao_Paulo') AS dt_abertura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_FECHAMENTO') AS STRING)), 'America/Sao_Paulo') AS dt_fechamento,\n  SAFE_CAST(JSON_VALUE(content, '$.ID_VEICULO') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content, '$.NR_LOGICO_MIDIA_FECHAMENTO') AS STRING) AS nr_logico_midia_fechamento,\n  SAFE_CAST(JSON_VALUE(content, '$.SN_DEVICE') AS STRING) AS sn_device,\n  SAFE_CAST(JSON_VALUE(content, '$.TP_GERACAO') AS STRING) AS tp_geracao,\n  SAFE_CAST(JSON_VALUE(content, '$.VL_TARIFA_LINHA') AS FLOAT64) AS vl_tarifa_linha\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`servico_motorista`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_ordem_pagamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_ordem_pagamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento.sql", "unique_id": "model.rj_smtr.staging_ordem_pagamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_ordem_pagamento"], "alias": "ordem_pagamento", "checksum": {"name": "sha256", "checksum": "94ccc6cda711f672e11e9e956d17575477c4a55a894af123d56f068aa8a35e85"}, "config": {"enabled": true, "alias": "ordem_pagamento", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "ordem_pagamento"}, "created_at": 1727709586.2997885, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento`", "raw_code": "{{\n  config(\n    alias='ordem_pagamento',\n  )\n}}\n\nWITH ordem_pagamento AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_pagamento') AS STRING)), \"America/Sao_Paulo\") AS data_pagamento,\n    SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n    {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"ordem_pagamento\") }}\n),\nordem_pagamento_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    ordem_pagamento\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_pagamento AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_pagamento') AS STRING)), \"America/Sao_Paulo\") AS data_pagamento,\n    SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento`\n),\nordem_pagamento_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    ordem_pagamento\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_percentual_rateio_integracao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_percentual_rateio_integracao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_percentual_rateio_integracao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_percentual_rateio_integracao.sql", "unique_id": "model.rj_smtr.staging_percentual_rateio_integracao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_percentual_rateio_integracao"], "alias": "percentual_rateio_integracao", "checksum": {"name": "sha256", "checksum": "7d4e797236701b03310d550473d1223947c75dc195df74daf41a732b84686f4c"}, "config": {"enabled": true, "alias": "percentual_rateio_integracao", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "percentual_rateio_integracao"}, "created_at": 1727709586.3019388, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`percentual_rateio_integracao`", "raw_code": "{{\n  config(\n    alias='percentual_rateio_integracao',\n  )\n}}\n\nWITH percentual_rateio_integracao AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.dt_fim_validade') AS STRING) AS dt_fim_validade,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dt_inclusao') AS STRING)), 'America/Sao_Paulo') AS dt_inclusao,\n    DATE(PARSE_TIMESTAMP('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.dt_inicio_validade') AS STRING)), 'America/Sao_Paulo') AS dt_inicio_validade,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t1') AS STRING), '.0', '') AS id_tipo_modal_integracao_t1,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t2') AS STRING), '.0', '') AS id_tipo_modal_integracao_t2,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t3') AS STRING), '.0', '') AS id_tipo_modal_integracao_t3,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t4') AS STRING), '.0', '') AS id_tipo_modal_integracao_t4,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_origem') AS STRING), '.0', '') AS id_tipo_modal_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t1') AS FLOAT64) AS perc_rateio_integracao_t1,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t2') AS FLOAT64) AS perc_rateio_integracao_t2,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t3') AS FLOAT64) AS perc_rateio_integracao_t3,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t4') AS FLOAT64) AS perc_rateio_integracao_t4,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_origem') AS FLOAT64) AS perc_rateio_origem\n  FROM\n    {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'percentual_rateio_integracao') }}\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    percentual_rateio_integracao\n)\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "percentual_rateio_integracao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_percentual_rateio_integracao.sql", "compiled": true, "compiled_code": "\n\nWITH percentual_rateio_integracao AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.dt_fim_validade') AS STRING) AS dt_fim_validade,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dt_inclusao') AS STRING)), 'America/Sao_Paulo') AS dt_inclusao,\n    DATE(PARSE_TIMESTAMP('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.dt_inicio_validade') AS STRING)), 'America/Sao_Paulo') AS dt_inicio_validade,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t1') AS STRING), '.0', '') AS id_tipo_modal_integracao_t1,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t2') AS STRING), '.0', '') AS id_tipo_modal_integracao_t2,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t3') AS STRING), '.0', '') AS id_tipo_modal_integracao_t3,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_integracao_t4') AS STRING), '.0', '') AS id_tipo_modal_integracao_t4,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_origem') AS STRING), '.0', '') AS id_tipo_modal_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t1') AS FLOAT64) AS perc_rateio_integracao_t1,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t2') AS FLOAT64) AS perc_rateio_integracao_t2,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t3') AS FLOAT64) AS perc_rateio_integracao_t3,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_integracao_t4') AS FLOAT64) AS perc_rateio_integracao_t4,\n    SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_origem') AS FLOAT64) AS perc_rateio_origem\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`percentual_rateio_integracao`\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    percentual_rateio_integracao\n)\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_transacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_transacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_transacao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_transacao.sql", "unique_id": "model.rj_smtr.staging_transacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_transacao"], "alias": "transacao", "checksum": {"name": "sha256", "checksum": "9f7ca7daeff11c386cd909ca64709e8bf185d6b40447dec8e0f2476c29e39694"}, "config": {"enabled": true, "alias": "transacao", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "transacao"}, "created_at": 1727709586.3054605, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao`", "raw_code": "{{\n    config(\n        alias='transacao',\n    )\n}}\n\nSELECT\n    data,\n    hora,\n    id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.assinatura') AS STRING) AS assinatura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_aplicacao') AS STRING) AS cd_aplicacao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_emissor') AS STRING) AS cd_emissor,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_consorcio') AS STRING) AS cd_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_linha') AS STRING) AS cd_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_matriz_integracao') AS STRING) AS cd_matriz_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_operadora') AS STRING) AS cd_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_secao') AS STRING) AS cd_secao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_status_transacao') AS STRING) AS cd_status_transacao,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), \"America/Sao_Paulo\") AS data_processamento,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_transacao') AS STRING)), \"America/Sao_Paulo\") AS data_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_cliente') AS STRING) AS id_cliente,\n    SAFE_CAST(JSON_VALUE(content, '$.id_produto') AS STRING) AS id_produto,\n    SAFE_CAST(JSON_VALUE(content, '$.id_servico') AS STRING) AS id_servico,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_midia') AS STRING) AS id_tipo_midia,\n    SAFE_CAST(JSON_VALUE(content, '$.is_abt') AS BOOL) AS is_abt,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_trx') AS FLOAT64) AS latitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_trx') AS FLOAT64) AS longitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador') AS STRING) AS nr_logico_midia_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_validador') AS STRING) AS numero_serie_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.pan_hash') AS STRING) AS pan_hash,\n    SAFE_CAST(JSON_VALUE(content, '$.posicao_validador') AS STRING) AS posicao_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_integracao') AS STRING) AS tipo_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_transacao') AS STRING) AS tipo_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.uid_origem') AS STRING) AS uid_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa') AS FLOAT64) AS valor_tarifa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_transacao') AS FLOAT64) AS valor_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.veiculo_id') AS STRING) AS veiculo_id,\n    SAFE_CAST(JSON_VALUE(content, '$.vl_saldo') AS FLOAT64) AS vl_saldo,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal') AS STRING) AS id_tipo_modal\nFROM\n    {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"transacao\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "transacao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_transacao.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    data,\n    hora,\n    id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.assinatura') AS STRING) AS assinatura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_aplicacao') AS STRING) AS cd_aplicacao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_emissor') AS STRING) AS cd_emissor,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_consorcio') AS STRING) AS cd_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_linha') AS STRING) AS cd_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_matriz_integracao') AS STRING) AS cd_matriz_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_operadora') AS STRING) AS cd_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_secao') AS STRING) AS cd_secao,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_status_transacao') AS STRING) AS cd_status_transacao,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), \"America/Sao_Paulo\") AS data_processamento,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E6S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_transacao') AS STRING)), \"America/Sao_Paulo\") AS data_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_cliente') AS STRING) AS id_cliente,\n    SAFE_CAST(JSON_VALUE(content, '$.id_produto') AS STRING) AS id_produto,\n    SAFE_CAST(JSON_VALUE(content, '$.id_servico') AS STRING) AS id_servico,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_midia') AS STRING) AS id_tipo_midia,\n    SAFE_CAST(JSON_VALUE(content, '$.is_abt') AS BOOL) AS is_abt,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_trx') AS FLOAT64) AS latitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_trx') AS FLOAT64) AS longitude_trx,\n    SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador') AS STRING) AS nr_logico_midia_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_validador') AS STRING) AS numero_serie_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.pan_hash') AS STRING) AS pan_hash,\n    SAFE_CAST(JSON_VALUE(content, '$.posicao_validador') AS STRING) AS posicao_validador,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_integracao') AS STRING) AS tipo_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_transacao') AS STRING) AS tipo_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.uid_origem') AS STRING) AS uid_origem,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa') AS FLOAT64) AS valor_tarifa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_transacao') AS FLOAT64) AS valor_transacao,\n    SAFE_CAST(JSON_VALUE(content, '$.veiculo_id') AS STRING) AS veiculo_id,\n    SAFE_CAST(JSON_VALUE(content, '$.vl_saldo') AS FLOAT64) AS vl_saldo,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal') AS STRING) AS id_tipo_modal\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_gps_validador": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_gps_validador", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_gps_validador.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_gps_validador.sql", "unique_id": "model.rj_smtr.staging_gps_validador", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_gps_validador"], "alias": "gps_validador", "checksum": {"name": "sha256", "checksum": "941548365a64d445ced37b34d5270eceffe92951429b93493492a7aa73ce9032"}, "config": {"enabled": true, "alias": "gps_validador", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "gps_validador"}, "created_at": 1727709586.3078067, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador`", "raw_code": "{{\n  config(\n    alias='gps_validador',\n  )\n}}\n\n\nSELECT\n    data,\n    hora,\n    REPLACE(SAFE_CAST(id AS STRING), \".0\", \"\") AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_recebidos_app') AS FLOAT64) AS bytes_recebidos_app,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_recebidos_geral') AS FLOAT64) AS bytes_recebidos_geral,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_transmitidos_app') AS FLOAT64) AS bytes_transmitidos_app,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_transmitidos_geral') AS FLOAT64) AS bytes_transmitidos_geral,\n    SAFE_CAST(JSON_VALUE(content, '$.codigo_linha_veiculo') AS STRING) AS codigo_linha_veiculo,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.codigo_operadora') AS STRING), \".0\", \"\") AS codigo_operadora,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_tracking') AS STRING)), 'America/Sao_Paulo') AS data_tracking,\n    SAFE_CAST(JSON_VALUE(content, '$.estado_equipamento') AS STRING) AS estado_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.fabricante_equipamento') AS STRING) AS fabricante_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_equipamento') AS FLOAT64) AS latitude_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_equipamento') AS FLOAT64) AS longitude_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.modelo_equipamento') AS STRING) AS modelo_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_cartao_operador') AS STRING) AS numero_cartao_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_chip_sam') AS STRING) AS numero_chip_sam,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_chip_telefonia') AS STRING) AS numero_chip_telefonia,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_equipamento') AS STRING) AS numero_serie_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.prefixo_veiculo') AS STRING) AS prefixo_veiculo,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_transacoes_enviadas') AS FLOAT64) AS qtd_transacoes_enviadas,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_transacoes_pendentes') AS FLOAT64) AS qtd_transacoes_pendentes,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_venda_botao') AS FLOAT64) AS qtd_venda_botao,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido_linha') AS STRING) AS sentido_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.tarifa_linha') AS FLOAT64) AS tarifa_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.versao_app') AS STRING) AS versao_app,\n    SAFE_CAST(JSON_VALUE(content, '$.temperatura') AS FLOAT64) AS temperatura\nFROM\n    {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'gps_validador') }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "gps_validador"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_gps_validador.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n    data,\n    hora,\n    REPLACE(SAFE_CAST(id AS STRING), \".0\", \"\") AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_recebidos_app') AS FLOAT64) AS bytes_recebidos_app,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_recebidos_geral') AS FLOAT64) AS bytes_recebidos_geral,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_transmitidos_app') AS FLOAT64) AS bytes_transmitidos_app,\n    SAFE_CAST(JSON_VALUE(content, '$.bytes_transmitidos_geral') AS FLOAT64) AS bytes_transmitidos_geral,\n    SAFE_CAST(JSON_VALUE(content, '$.codigo_linha_veiculo') AS STRING) AS codigo_linha_veiculo,\n    REPLACE(SAFE_CAST(JSON_VALUE(content, '$.codigo_operadora') AS STRING), \".0\", \"\") AS codigo_operadora,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_tracking') AS STRING)), 'America/Sao_Paulo') AS data_tracking,\n    SAFE_CAST(JSON_VALUE(content, '$.estado_equipamento') AS STRING) AS estado_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.fabricante_equipamento') AS STRING) AS fabricante_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.latitude_equipamento') AS FLOAT64) AS latitude_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.longitude_equipamento') AS FLOAT64) AS longitude_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.modelo_equipamento') AS STRING) AS modelo_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_cartao_operador') AS STRING) AS numero_cartao_operador,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_chip_sam') AS STRING) AS numero_chip_sam,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_chip_telefonia') AS STRING) AS numero_chip_telefonia,\n    SAFE_CAST(JSON_VALUE(content, '$.numero_serie_equipamento') AS STRING) AS numero_serie_equipamento,\n    SAFE_CAST(JSON_VALUE(content, '$.prefixo_veiculo') AS STRING) AS prefixo_veiculo,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_transacoes_enviadas') AS FLOAT64) AS qtd_transacoes_enviadas,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_transacoes_pendentes') AS FLOAT64) AS qtd_transacoes_pendentes,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_venda_botao') AS FLOAT64) AS qtd_venda_botao,\n    SAFE_CAST(JSON_VALUE(content, '$.sentido_linha') AS STRING) AS sentido_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.tarifa_linha') AS FLOAT64) AS tarifa_linha,\n    SAFE_CAST(JSON_VALUE(content, '$.versao_app') AS STRING) AS versao_app,\n    SAFE_CAST(JSON_VALUE(content, '$.temperatura') AS FLOAT64) AS temperatura\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_linha_sem_ressarcimento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_linha_sem_ressarcimento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_linha_sem_ressarcimento.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_sem_ressarcimento.sql", "unique_id": "model.rj_smtr.staging_linha_sem_ressarcimento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_linha_sem_ressarcimento"], "alias": "linha_sem_ressarcimento", "checksum": {"name": "sha256", "checksum": "da6b111e3b2cc3e56aa33ad1cc2f2430509f4b9bc8ba0daf55a6b52094ecf863"}, "config": {"enabled": true, "alias": "linha_sem_ressarcimento", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "linha_sem_ressarcimento"}, "created_at": 1727709586.3099513, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento`", "raw_code": "{{\n  config(\n    alias='linha_sem_ressarcimento',\n  )\n}}\n\nWITH linha_sem_ressarcimento AS (\n  SELECT\n    data,\n    SAFE_CAST(id_linha AS STRING) AS id_linha,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dt_inclusao') AS STRING)), 'America/Sao_Paulo') AS dt_inclusao\n  FROM\n    {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'linha_sem_ressarcimento') }}\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_sem_ressarcimento\n)\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "linha_sem_ressarcimento"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_sem_ressarcimento.sql", "compiled": true, "compiled_code": "\n\nWITH linha_sem_ressarcimento AS (\n  SELECT\n    data,\n    SAFE_CAST(id_linha AS STRING) AS id_linha,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dt_inclusao') AS STRING)), 'America/Sao_Paulo') AS dt_inclusao\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento`\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_sem_ressarcimento\n)\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_endereco": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_endereco", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_endereco.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_endereco.sql", "unique_id": "model.rj_smtr.staging_endereco", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_endereco"], "alias": "endereco", "checksum": {"name": "sha256", "checksum": "e64f1576359d87e2eafa03265f0affc5cfec6dce32eb94f53ab328fe7823c1a2"}, "config": {"enabled": true, "alias": "endereco", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "endereco"}, "created_at": 1727709586.312141, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`endereco`", "raw_code": "{{\n  config(\n    alias='endereco',\n  )\n}}\n\nWITH\n    endereco AS (\n        SELECT\n            data,\n            SAFE_CAST(NR_SEQ_ENDERECO AS STRING) AS nr_seq_endereco,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_CLIENTE') AS STRING) AS cd_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_ENDERECO') AS STRING) AS cd_tipo_endereco,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_LOGRADOURO') AS STRING) AS cd_tipo_logradouro,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_BAIRRO') AS STRING) AS nm_bairro,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CIDADE') AS STRING) AS nm_cidade,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_CEP') AS STRING) AS nr_cep,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_LOGRADOURO') AS STRING) AS nr_logradouro,\n            SAFE_CAST(JSON_VALUE(content, '$.SG_UF') AS STRING) AS sg_uf,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_COMPLEMENTO_LOGRADOURO') AS STRING) AS tx_complemento_logradouro,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_LOGRADOURO') AS STRING) AS tx_logradouro\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"endereco\") }}\n    ),\n    endereco_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY nr_seq_endereco ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            endereco\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  endereco_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "endereco"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_endereco.sql", "compiled": true, "compiled_code": "\n\nWITH\n    endereco AS (\n        SELECT\n            data,\n            SAFE_CAST(NR_SEQ_ENDERECO AS STRING) AS nr_seq_endereco,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_CLIENTE') AS STRING) AS cd_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_ENDERECO') AS STRING) AS cd_tipo_endereco,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_LOGRADOURO') AS STRING) AS cd_tipo_logradouro,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_BAIRRO') AS STRING) AS nm_bairro,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CIDADE') AS STRING) AS nm_cidade,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_CEP') AS STRING) AS nr_cep,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_LOGRADOURO') AS STRING) AS nr_logradouro,\n            SAFE_CAST(JSON_VALUE(content, '$.SG_UF') AS STRING) AS sg_uf,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_COMPLEMENTO_LOGRADOURO') AS STRING) AS tx_complemento_logradouro,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_LOGRADOURO') AS STRING) AS tx_logradouro\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`endereco`\n    ),\n    endereco_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY nr_seq_endereco ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            endereco\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  endereco_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_linha_consorcio": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_linha_consorcio", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio.sql", "unique_id": "model.rj_smtr.staging_linha_consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_linha_consorcio"], "alias": "linha_consorcio", "checksum": {"name": "sha256", "checksum": "28aa0219426480dbb412e833e068d8aa07a6a3058643e7b144076ac647eb0dbd"}, "config": {"enabled": true, "alias": "linha_consorcio", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "linha_consorcio"}, "created_at": 1727709586.3142767, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio`", "raw_code": "{{\n  config(\n    alias='linha_consorcio',\n  )\n}}\n\nWITH linha_consorcio AS (\n  SELECT\n    data,\n    SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n    SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_INICIO_VALIDADE') AS STRING)) AS dt_inicio_validade,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_FIM_VALIDADE') AS STRING)) AS dt_fim_validade\n  FROM\n    {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"linha_consorcio\") }}\n),\nlinha_consorcio_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY cd_consorcio, cd_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_consorcio\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_consorcio_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "linha_consorcio"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha_consorcio.sql", "compiled": true, "compiled_code": "\n\nWITH linha_consorcio AS (\n  SELECT\n    data,\n    SAFE_CAST(CD_CONSORCIO AS STRING) AS cd_consorcio,\n    SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS dt_inclusao,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_INICIO_VALIDADE') AS STRING)) AS dt_inicio_validade,\n    PARSE_DATE(\"%Y-%m-%d\", SAFE_CAST(JSON_VALUE(content, '$.DT_FIM_VALIDADE') AS STRING)) AS dt_fim_validade\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio`\n),\nlinha_consorcio_rn AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY cd_consorcio, cd_linha ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    linha_consorcio\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_consorcio_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_ordem_ressarcimento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_ordem_ressarcimento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_ressarcimento.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_ressarcimento.sql", "unique_id": "model.rj_smtr.staging_ordem_ressarcimento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_ordem_ressarcimento"], "alias": "ordem_ressarcimento", "checksum": {"name": "sha256", "checksum": "14a90c6764462d1ed3c4ceaac6a0b08897b367583b7f64ed7d259232975e9cd8"}, "config": {"enabled": true, "alias": "ordem_ressarcimento", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "ordem_ressarcimento"}, "created_at": 1727709586.316457, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_ressarcimento`", "raw_code": "{{\n  config(\n    alias='ordem_ressarcimento',\n  )\n}}\n\nWITH\n    ordem_ressarcimento AS (\n        SELECT\n            data,\n            SAFE_CAST(id AS STRING) AS id_ordem_ressarcimento,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n            SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n            SAFE_CAST(JSON_VALUE(content, '$.id_linha') AS STRING) AS id_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio_operadora') AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n            SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"ordem_ressarcimento\") }}\n    ),\n    ordem_ressarcimento_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY id_ordem_ressarcimento ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            ordem_ressarcimento\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_ressarcimento_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "ordem_ressarcimento"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_ressarcimento.sql", "compiled": true, "compiled_code": "\n\nWITH\n    ordem_ressarcimento AS (\n        SELECT\n            data,\n            SAFE_CAST(id AS STRING) AS id_ordem_ressarcimento,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n            SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n            SAFE_CAST(JSON_VALUE(content, '$.id_linha') AS STRING) AS id_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n            SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio_operadora') AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n            SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n            SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_ressarcimento`\n    ),\n    ordem_ressarcimento_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY id_ordem_ressarcimento ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            ordem_ressarcimento\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_ressarcimento_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_linha": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_linha", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_linha.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha.sql", "unique_id": "model.rj_smtr.staging_linha", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_linha"], "alias": "linha", "checksum": {"name": "sha256", "checksum": "9f58fa69fdd518bd78d2af78898b8a06d2068298e3a53f2cc98bce60144e3e14"}, "config": {"enabled": true, "alias": "linha", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "linha"}, "created_at": 1727709586.3838532, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha`", "raw_code": "{{\n  config(\n    alias='linha',\n  )\n}}\n\nWITH\n    linha AS (\n        SELECT\n            data,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n            SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_LINHA_OFICIAL') AS STRING) AS cd_linha_oficial,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_LOCAL_OPERACAO_LINHA') AS STRING) AS cd_local_operacao_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CATEGORIA_LINHA') AS STRING) AS cd_tipo_categoria_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_LINHA') AS STRING) AS cd_tipo_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_MATRIZ_CALCULO_SUBSIDIO') AS STRING) AS cd_tipo_matriz_calculo_subsidio,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_SITUACAO_ATIVIDADE') AS STRING) AS in_situacao_atividade,\n            SAFE_CAST(JSON_VALUE(content, '$.KM_LINHA') AS FLOAT64) AS km_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.LATITUDE_DESTINO') AS STRING) AS latitude_destino,\n            SAFE_CAST(JSON_VALUE(content, '$.LATITUDE_ORIGEM') AS STRING) AS latitude_origem,\n            SAFE_CAST(JSON_VALUE(content, '$.LONGITUDE_DESTINO') AS STRING) AS longitude_destino,\n            SAFE_CAST(JSON_VALUE(content, '$.LONGITUDE_ORIGEM') AS STRING) AS longitude_origem,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_LINHA') AS STRING) AS nm_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_LINHA') AS STRING) AS nr_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.QUANTIDADE_SECAO') AS STRING) AS quantidade_secao,\n            SAFE_CAST(JSON_VALUE(content, '$.GTFS_ROUTE_ID') AS STRING) AS gtfs_route_id,\n            SAFE_CAST(JSON_VALUE(content, '$.GTFS_STOP_ID') AS STRING) AS gtfs_stop_id\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"linha\") }}\n    ),\n    linha_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_linha ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            linha\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "linha"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_linha.sql", "compiled": true, "compiled_code": "\n\nWITH\n    linha AS (\n        SELECT\n            data,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n            SAFE_CAST(CD_LINHA AS STRING) AS cd_linha,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_LINHA_OFICIAL') AS STRING) AS cd_linha_oficial,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_LOCAL_OPERACAO_LINHA') AS STRING) AS cd_local_operacao_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CATEGORIA_LINHA') AS STRING) AS cd_tipo_categoria_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_LINHA') AS STRING) AS cd_tipo_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_MATRIZ_CALCULO_SUBSIDIO') AS STRING) AS cd_tipo_matriz_calculo_subsidio,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_SITUACAO_ATIVIDADE') AS STRING) AS in_situacao_atividade,\n            SAFE_CAST(JSON_VALUE(content, '$.KM_LINHA') AS FLOAT64) AS km_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.LATITUDE_DESTINO') AS STRING) AS latitude_destino,\n            SAFE_CAST(JSON_VALUE(content, '$.LATITUDE_ORIGEM') AS STRING) AS latitude_origem,\n            SAFE_CAST(JSON_VALUE(content, '$.LONGITUDE_DESTINO') AS STRING) AS longitude_destino,\n            SAFE_CAST(JSON_VALUE(content, '$.LONGITUDE_ORIGEM') AS STRING) AS longitude_origem,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_LINHA') AS STRING) AS nm_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_LINHA') AS STRING) AS nr_linha,\n            SAFE_CAST(JSON_VALUE(content, '$.QUANTIDADE_SECAO') AS STRING) AS quantidade_secao,\n            SAFE_CAST(JSON_VALUE(content, '$.GTFS_ROUTE_ID') AS STRING) AS gtfs_route_id,\n            SAFE_CAST(JSON_VALUE(content, '$.GTFS_STOP_ID') AS STRING) AS gtfs_stop_id\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha`\n    ),\n    linha_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_linha ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            linha\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  linha_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_conta_bancaria": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_conta_bancaria", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_conta_bancaria.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_conta_bancaria.sql", "unique_id": "model.rj_smtr.staging_conta_bancaria", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_conta_bancaria"], "alias": "conta_bancaria", "checksum": {"name": "sha256", "checksum": "5687f6e55b43561086f2a0f1e8703d1e1553fa4bbed0a03d6e1faa7089e6b79b"}, "config": {"enabled": true, "alias": "conta_bancaria", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "conta_bancaria"}, "created_at": 1727709586.3860655, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`conta_bancaria`", "raw_code": "{{\n  config(\n    alias='conta_bancaria',\n  )\n}}\n\nWITH\n    conta_bancaria AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_AGENCIA') AS STRING) AS cd_agencia,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CONTA') AS STRING) AS cd_tipo_conta,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_BANCO') AS STRING) AS nm_banco,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_BANCO') AS STRING) AS nr_banco,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_CONTA') AS STRING) AS nr_conta,\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"conta_bancaria\") }}\n    ),\n    conta_bancaria_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            conta_bancaria\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  conta_bancaria_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "conta_bancaria"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_conta_bancaria.sql", "compiled": true, "compiled_code": "\n\nWITH\n    conta_bancaria AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_AGENCIA') AS STRING) AS cd_agencia,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CONTA') AS STRING) AS cd_tipo_conta,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_BANCO') AS STRING) AS nm_banco,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_BANCO') AS STRING) AS nr_banco,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_CONTA') AS STRING) AS nr_conta,\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`conta_bancaria`\n    ),\n    conta_bancaria_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            conta_bancaria\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  conta_bancaria_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_validador_aux": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "gps_validador_aux", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/gps_validador_aux.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/gps_validador_aux.sql", "unique_id": "model.rj_smtr.gps_validador_aux", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "gps_validador_aux"], "alias": "gps_validador_aux", "checksum": {"name": "sha256", "checksum": "f13e563b94279438b99ddd79a84bc7cd0d25e1f4ffa7a1057f33bbfe70a50c52"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging"}, "created_at": 1727709586.3882782, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador_aux`", "raw_code": "{{\n    config(\n        materialized=\"view\"\n    )\n}}\n\nSELECT\n    do.modo,\n    g.data,\n    g.hora,\n    g.data_tracking AS datetime_gps,\n    g.timestamp_captura AS datetime_captura,\n    do.id_operadora,\n    do.operadora,\n    g.codigo_linha_veiculo AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    prefixo_veiculo AS id_veiculo,\n    g.numero_serie_equipamento AS id_validador,\n    g.id AS id_transmissao_gps,\n    g.latitude_equipamento AS latitude,\n    g.longitude_equipamento AS longitude,\n    INITCAP(g.sentido_linha) AS sentido,\n    g.estado_equipamento,\n    g.temperatura,\n    g.versao_app\nFROM\n    {{ ref(\"staging_gps_validador\") }} g\nLEFT JOIN\n    {{ ref(\"operadoras\") }} AS do\nON\n    g.codigo_operadora = do.id_operadora_jae\nLEFT JOIN\n    {{ ref(\"staging_linha\") }} AS l\nON\n    g.codigo_linha_veiculo = l.cd_linha\n-- LEFT JOIN\n--     {{ ref(\"servicos\") }} AS s\n-- ON\n--     g.codigo_linha_veiculo = s.id_servico_jae", "language": "sql", "refs": [{"name": "staging_gps_validador", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "staging_linha", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_gps_validador", "model.rj_smtr.operadoras", "model.rj_smtr.staging_linha", "model.rj_smtr.servicos"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/gps_validador_aux.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    do.modo,\n    g.data,\n    g.hora,\n    g.data_tracking AS datetime_gps,\n    g.timestamp_captura AS datetime_captura,\n    do.id_operadora,\n    do.operadora,\n    g.codigo_linha_veiculo AS id_servico_jae,\n    -- s.servico,\n    l.nr_linha AS servico_jae,\n    l.nm_linha AS descricao_servico_jae,\n    prefixo_veiculo AS id_veiculo,\n    g.numero_serie_equipamento AS id_validador,\n    g.id AS id_transmissao_gps,\n    g.latitude_equipamento AS latitude,\n    g.longitude_equipamento AS longitude,\n    INITCAP(g.sentido_linha) AS sentido,\n    g.estado_equipamento,\n    g.temperatura,\n    g.versao_app\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador` g\nLEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` AS do\nON\n    g.codigo_operadora = do.id_operadora_jae\nLEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` AS l\nON\n    g.codigo_linha_veiculo = l.cd_linha\n-- LEFT JOIN\n--     `rj-smtr`.`cadastro`.`servicos` AS s\n-- ON\n--     g.codigo_linha_veiculo = s.id_servico_jae", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_integracao_transacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_integracao_transacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_integracao_transacao.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_integracao_transacao.sql", "unique_id": "model.rj_smtr.staging_integracao_transacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_integracao_transacao"], "alias": "integracao_transacao", "checksum": {"name": "sha256", "checksum": "6d0b73037dc61ed285f0e536a85ea53d40ce88e97dd96b4a40e275e4e297b4ad"}, "config": {"enabled": true, "alias": "integracao_transacao", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "integracao_transacao"}, "created_at": 1727709586.3906622, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`integracao_transacao`", "raw_code": "{{\n  config(\n      alias='integracao_transacao',\n  )\n}}\n\nSELECT\n  data,\n  SAFE_CAST(id AS STRING) AS id,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), 'America/Sao_Paulo') AS data_processamento,\n  -- Seleciona colunas com os dados de cada transa\u00e7\u00e3o da integra\u00e7\u00e3o com os tipos adequados com base no dicionario de parametros\n  {% for column, column_config in var('colunas_integracao').items() %}\n    {% for i in range(var('quantidade_integracoes_max')) %}\n      {% if column_config.type == 'DATETIME' %}\n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.{{ column }}_t{% if i > 0 %}i{% endif %}{{ i }}') AS STRING)\n          ),\n          'America/Sao_Paulo') AS {{ column }}_t{{ i }},\n      {% elif column_config.type == 'ID' %}\n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.{{ column }}_t{% if i > 0 %}i{% endif %}{{ i }}') AS STRING), '.0', '') AS {{ column }}_t{{ i }},\n      {% else %}\n        SAFE_CAST(JSON_VALUE(content, '$.{{ column }}_t{% if i > 0 %}i{% endif %}{{ i }}') AS {{ column_config.type }}) AS {{ column }}_t{{ i }},\n      {% endif %}\n    {% endfor %}\n  {% endfor %}\n  SAFE_CAST(JSON_VALUE(content, '$.id_status_integracao') AS STRING) AS id_status_integracao,\n  SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_total') AS FLOAT64) AS valor_transacao_total,\n  SAFE_CAST(JSON_VALUE(content, '$.tx_adicional') AS STRING) AS tx_adicional\nFROM\n  {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'integracao_transacao') }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "integracao_transacao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_integracao_transacao.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  data,\n  SAFE_CAST(id AS STRING) AS id,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_processamento') AS STRING)), 'America/Sao_Paulo') AS data_processamento,\n  -- Seleciona colunas com os dados de cada transa\u00e7\u00e3o da integra\u00e7\u00e3o com os tipos adequados com base no dicionario de parametros\n  \n    \n      \n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.data_transacao_t0') AS STRING)\n          ),\n          'America/Sao_Paulo') AS data_transacao_t0,\n      \n    \n      \n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.data_transacao_ti1') AS STRING)\n          ),\n          'America/Sao_Paulo') AS data_transacao_t1,\n      \n    \n      \n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.data_transacao_ti2') AS STRING)\n          ),\n          'America/Sao_Paulo') AS data_transacao_t2,\n      \n    \n      \n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.data_transacao_ti3') AS STRING)\n          ),\n          'America/Sao_Paulo') AS data_transacao_t3,\n      \n    \n      \n        DATETIME(\n          PARSE_TIMESTAMP(\n            '%Y-%m-%dT%H:%M:%E*S%Ez',\n            SAFE_CAST(JSON_VALUE(content, '$.data_transacao_ti4') AS STRING)\n          ),\n          'America/Sao_Paulo') AS data_transacao_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_aplicacao_t0') AS STRING), '.0', '') AS id_aplicacao_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_aplicacao_ti1') AS STRING), '.0', '') AS id_aplicacao_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_aplicacao_ti2') AS STRING), '.0', '') AS id_aplicacao_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_aplicacao_ti3') AS STRING), '.0', '') AS id_aplicacao_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_aplicacao_ti4') AS STRING), '.0', '') AS id_aplicacao_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_consorcio_t0') AS STRING), '.0', '') AS id_consorcio_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_consorcio_ti1') AS STRING), '.0', '') AS id_consorcio_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_consorcio_ti2') AS STRING), '.0', '') AS id_consorcio_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_consorcio_ti3') AS STRING), '.0', '') AS id_consorcio_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_consorcio_ti4') AS STRING), '.0', '') AS id_consorcio_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_emissor_t0') AS STRING), '.0', '') AS id_emissor_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_emissor_ti1') AS STRING), '.0', '') AS id_emissor_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_emissor_ti2') AS STRING), '.0', '') AS id_emissor_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_emissor_ti3') AS STRING), '.0', '') AS id_emissor_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_emissor_ti4') AS STRING), '.0', '') AS id_emissor_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_linha_t0') AS STRING), '.0', '') AS id_linha_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_linha_ti1') AS STRING), '.0', '') AS id_linha_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_linha_ti2') AS STRING), '.0', '') AS id_linha_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_linha_ti3') AS STRING), '.0', '') AS id_linha_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_linha_ti4') AS STRING), '.0', '') AS id_linha_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_matriz_integracao_t0') AS STRING), '.0', '') AS id_matriz_integracao_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_matriz_integracao_ti1') AS STRING), '.0', '') AS id_matriz_integracao_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_matriz_integracao_ti2') AS STRING), '.0', '') AS id_matriz_integracao_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_matriz_integracao_ti3') AS STRING), '.0', '') AS id_matriz_integracao_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_matriz_integracao_ti4') AS STRING), '.0', '') AS id_matriz_integracao_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_operadora_t0') AS STRING), '.0', '') AS id_operadora_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_operadora_ti1') AS STRING), '.0', '') AS id_operadora_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_operadora_ti2') AS STRING), '.0', '') AS id_operadora_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_operadora_ti3') AS STRING), '.0', '') AS id_operadora_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_operadora_ti4') AS STRING), '.0', '') AS id_operadora_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_ordem_rateio_t0') AS STRING), '.0', '') AS id_ordem_rateio_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_ordem_rateio_ti1') AS STRING), '.0', '') AS id_ordem_rateio_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_ordem_rateio_ti2') AS STRING), '.0', '') AS id_ordem_rateio_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_ordem_rateio_ti3') AS STRING), '.0', '') AS id_ordem_rateio_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_ordem_rateio_ti4') AS STRING), '.0', '') AS id_ordem_rateio_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_secao_t0') AS STRING) AS id_secao_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_secao_ti1') AS STRING) AS id_secao_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_secao_ti2') AS STRING) AS id_secao_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_secao_ti3') AS STRING) AS id_secao_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_secao_ti4') AS STRING) AS id_secao_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_servico_t0') AS STRING), '.0', '') AS id_servico_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_servico_ti1') AS STRING), '.0', '') AS id_servico_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_servico_ti2') AS STRING), '.0', '') AS id_servico_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_servico_ti3') AS STRING), '.0', '') AS id_servico_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_servico_ti4') AS STRING), '.0', '') AS id_servico_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_t0') AS STRING), '.0', '') AS id_tipo_modal_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_ti1') AS STRING), '.0', '') AS id_tipo_modal_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_ti2') AS STRING), '.0', '') AS id_tipo_modal_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_ti3') AS STRING), '.0', '') AS id_tipo_modal_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.id_tipo_modal_ti4') AS STRING), '.0', '') AS id_tipo_modal_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_transacao_t0') AS STRING) AS id_transacao_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_transacao_ti1') AS STRING) AS id_transacao_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_transacao_ti2') AS STRING) AS id_transacao_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_transacao_ti3') AS STRING) AS id_transacao_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.id_transacao_ti4') AS STRING) AS id_transacao_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.latitude_trx_t0') AS FLOAT64) AS latitude_trx_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.latitude_trx_ti1') AS FLOAT64) AS latitude_trx_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.latitude_trx_ti2') AS FLOAT64) AS latitude_trx_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.latitude_trx_ti3') AS FLOAT64) AS latitude_trx_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.latitude_trx_ti4') AS FLOAT64) AS latitude_trx_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.longitude_trx_t0') AS FLOAT64) AS longitude_trx_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.longitude_trx_ti1') AS FLOAT64) AS longitude_trx_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.longitude_trx_ti2') AS FLOAT64) AS longitude_trx_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.longitude_trx_ti3') AS FLOAT64) AS longitude_trx_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.longitude_trx_ti4') AS FLOAT64) AS longitude_trx_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador_t0') AS STRING) AS nr_logico_midia_operador_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador_ti1') AS STRING) AS nr_logico_midia_operador_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador_ti2') AS STRING) AS nr_logico_midia_operador_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador_ti3') AS STRING) AS nr_logico_midia_operador_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.nr_logico_midia_operador_ti4') AS STRING) AS nr_logico_midia_operador_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_t0') AS FLOAT64) AS perc_rateio_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_ti1') AS FLOAT64) AS perc_rateio_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_ti2') AS FLOAT64) AS perc_rateio_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_ti3') AS FLOAT64) AS perc_rateio_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.perc_rateio_ti4') AS FLOAT64) AS perc_rateio_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.posicao_validador_t0') AS STRING) AS posicao_validador_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.posicao_validador_ti1') AS STRING) AS posicao_validador_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.posicao_validador_ti2') AS STRING) AS posicao_validador_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.posicao_validador_ti3') AS STRING) AS posicao_validador_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.posicao_validador_ti4') AS STRING) AS posicao_validador_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.sentido_t0') AS STRING), '.0', '') AS sentido_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.sentido_ti1') AS STRING), '.0', '') AS sentido_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.sentido_ti2') AS STRING), '.0', '') AS sentido_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.sentido_ti3') AS STRING), '.0', '') AS sentido_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.sentido_ti4') AS STRING), '.0', '') AS sentido_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_t0') AS FLOAT64) AS valor_rateio_compensacao_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_ti1') AS FLOAT64) AS valor_rateio_compensacao_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_ti2') AS FLOAT64) AS valor_rateio_compensacao_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_ti3') AS FLOAT64) AS valor_rateio_compensacao_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_ti4') AS FLOAT64) AS valor_rateio_compensacao_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_t0') AS FLOAT64) AS valor_rateio_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_ti1') AS FLOAT64) AS valor_rateio_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_ti2') AS FLOAT64) AS valor_rateio_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_ti3') AS FLOAT64) AS valor_rateio_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_ti4') AS FLOAT64) AS valor_rateio_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa_t0') AS FLOAT64) AS valor_tarifa_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa_ti1') AS FLOAT64) AS valor_tarifa_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa_ti2') AS FLOAT64) AS valor_tarifa_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa_ti3') AS FLOAT64) AS valor_tarifa_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_tarifa_ti4') AS FLOAT64) AS valor_tarifa_t4,\n      \n    \n  \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_t0') AS FLOAT64) AS valor_transacao_t0,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_ti1') AS FLOAT64) AS valor_transacao_t1,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_ti2') AS FLOAT64) AS valor_transacao_t2,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_ti3') AS FLOAT64) AS valor_transacao_t3,\n      \n    \n      \n        SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_ti4') AS FLOAT64) AS valor_transacao_t4,\n      \n    \n  \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.veiculo_id_t0') AS STRING), '.0', '') AS veiculo_id_t0,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.veiculo_id_ti1') AS STRING), '.0', '') AS veiculo_id_t1,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.veiculo_id_ti2') AS STRING), '.0', '') AS veiculo_id_t2,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.veiculo_id_ti3') AS STRING), '.0', '') AS veiculo_id_t3,\n      \n    \n      \n        REPLACE(SAFE_CAST(JSON_VALUE(content, '$.veiculo_id_ti4') AS STRING), '.0', '') AS veiculo_id_t4,\n      \n    \n  \n  SAFE_CAST(JSON_VALUE(content, '$.id_status_integracao') AS STRING) AS id_status_integracao,\n  SAFE_CAST(JSON_VALUE(content, '$.valor_transacao_total') AS FLOAT64) AS valor_transacao_total,\n  SAFE_CAST(JSON_VALUE(content, '$.tx_adicional') AS STRING) AS tx_adicional\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`integracao_transacao`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_h3_res9": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "aux_h3_res9", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/aux_h3_res9.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/aux_h3_res9.sql", "unique_id": "model.rj_smtr.aux_h3_res9", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "aux_h3_res9"], "alias": "aux_h3_res9", "checksum": {"name": "sha256", "checksum": "64b56c943fae52fe9578446e86e3bcb9eeccea8f7253e580bd5b1d396f419821"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_bilhetagem_staging"}, "created_at": 1727709586.4000297, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`aux_h3_res9`", "raw_code": "{{\n  config(materialized=\"table\")\n}}\n\nSELECT\n  tile_id,\n  ST_GEOGFROMTEXT(geometry) AS geometry\nFROM\n  {{ source(\"br_rj_riodejaneiro_geo\", \"h3_res9\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_geo", "h3_res9"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/aux_h3_res9.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  tile_id,\n  ST_GEOGFROMTEXT(geometry) AS geometry\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_geo`.`h3_res9`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_ordem_rateio": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_ordem_rateio", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_rateio.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_rateio.sql", "unique_id": "model.rj_smtr.staging_ordem_rateio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_ordem_rateio"], "alias": "ordem_rateio", "checksum": {"name": "sha256", "checksum": "89bf9147315edd47c7e669b6b5fb99b9efd0867d6241d63e07ca02b1f58fb978"}, "config": {"enabled": true, "alias": "ordem_rateio", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "ordem_rateio"}, "created_at": 1727709586.402181, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_rateio`", "raw_code": "{{\n  config(\n    alias='ordem_rateio',\n  )\n}}\n\nWITH ordem_rateio AS (\n  SELECT\n    data,\n        SAFE_CAST(id AS STRING) AS id,\n        timestamp_captura,\n        DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n        PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n        SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n        SAFE_CAST(JSON_VALUE(content, '$.id_linha') AS STRING) AS id_linha,\n        SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio_operadora') AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n        SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t0') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t0,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t1') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t1,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t2') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t2,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t3') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t3,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t4') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t4,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_total') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_total,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t0') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t0,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t1') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t1,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t2') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t2,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t3') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t3,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t4') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t4,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_total') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_total,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t0') AS NUMERIC) AS valor_rateio_compensacao_credito_t0,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t1') AS NUMERIC) AS valor_rateio_compensacao_credito_t1,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t2') AS NUMERIC) AS valor_rateio_compensacao_credito_t2,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t3') AS NUMERIC) AS valor_rateio_compensacao_credito_t3,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t4') AS NUMERIC) AS valor_rateio_compensacao_credito_t4,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_total') AS NUMERIC) AS valor_rateio_compensacao_credito_total,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t0') AS NUMERIC) AS valor_rateio_compensacao_debito_t0,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t1') AS NUMERIC) AS valor_rateio_compensacao_debito_t1,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t2') AS NUMERIC) AS valor_rateio_compensacao_debito_t2,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t3') AS NUMERIC) AS valor_rateio_compensacao_debito_t3,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t4') AS NUMERIC) AS valor_rateio_compensacao_debito_t4,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_total') AS NUMERIC) AS valor_rateio_compensacao_debito_total\n  FROM\n    {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'ordem_rateio') }}\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    ordem_rateio\n)\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "ordem_rateio"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_rateio.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_rateio AS (\n  SELECT\n    data,\n        SAFE_CAST(id AS STRING) AS id,\n        timestamp_captura,\n        DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n        PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n        SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n        SAFE_CAST(JSON_VALUE(content, '$.id_linha') AS STRING) AS id_linha,\n        SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento') AS STRING) AS id_ordem_pagamento,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n        SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio_operadora') AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n        SAFE_CAST(JSON_VALUE(content, '$.id_status_ordem') AS STRING) AS id_status_ordem,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t0') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t0,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t1') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t1,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t2') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t2,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t3') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t3,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_t4') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_t4,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_credito_total') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_credito_total,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t0') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t0,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t1') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t1,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t2') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t2,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t3') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t3,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_t4') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_t4,\n        SAFE_CAST(SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_compensacao_debito_total') AS FLOAT64) AS INTEGER) AS qtd_rateio_compensacao_debito_total,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t0') AS NUMERIC) AS valor_rateio_compensacao_credito_t0,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t1') AS NUMERIC) AS valor_rateio_compensacao_credito_t1,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t2') AS NUMERIC) AS valor_rateio_compensacao_credito_t2,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t3') AS NUMERIC) AS valor_rateio_compensacao_credito_t3,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_t4') AS NUMERIC) AS valor_rateio_compensacao_credito_t4,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_credito_total') AS NUMERIC) AS valor_rateio_compensacao_credito_total,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t0') AS NUMERIC) AS valor_rateio_compensacao_debito_t0,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t1') AS NUMERIC) AS valor_rateio_compensacao_debito_t1,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t2') AS NUMERIC) AS valor_rateio_compensacao_debito_t2,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t3') AS NUMERIC) AS valor_rateio_compensacao_debito_t3,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_t4') AS NUMERIC) AS valor_rateio_compensacao_debito_t4,\n        SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_compensacao_debito_total') AS NUMERIC) AS valor_rateio_compensacao_debito_total\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_rateio`\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n(\n  SELECT\n    *,\n    ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp_captura DESC) AS rn\n  FROM\n    ordem_rateio\n)\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_operadora_transporte": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_operadora_transporte", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_operadora_transporte.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_operadora_transporte.sql", "unique_id": "model.rj_smtr.staging_operadora_transporte", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_operadora_transporte"], "alias": "operadora_transporte", "checksum": {"name": "sha256", "checksum": "dbdb92a4c850f32d597b25cb12d6bb5a200dc1dfc2d7f0e6a72de9d38d9e704a"}, "config": {"enabled": true, "alias": "operadora_transporte", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "operadora_transporte"}, "created_at": 1727709586.4044218, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`operadora_transporte`", "raw_code": "{{\n  config(\n    alias='operadora_transporte',\n  )\n}}\n\nWITH\n    operadora_transporte AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_OPERADORA_TRANSPORTE AS STRING) AS cd_operadora_transporte,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_CLIENTE') AS STRING) AS cd_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CLIENTE') AS STRING) AS cd_tipo_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_MODAL') AS STRING) AS cd_tipo_modal,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_SITUACAO_ATIVIDADE') AS STRING) AS in_situacao_atividade,\n            SAFE_CAST(JSON_VALUE(content, '$.DS_TIPO_MODAL') AS STRING) AS ds_tipo_modal\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"operadora_transporte\") }}\n    ),\n    operadora_transporte_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_operadora_transporte ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            operadora_transporte\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_transporte_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "operadora_transporte"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_operadora_transporte.sql", "compiled": true, "compiled_code": "\n\nWITH\n    operadora_transporte AS (\n        SELECT\n            data,\n            SAFE_CAST(CD_OPERADORA_TRANSPORTE AS STRING) AS cd_operadora_transporte,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_CLIENTE') AS STRING) AS cd_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_CLIENTE') AS STRING) AS cd_tipo_cliente,\n            SAFE_CAST(JSON_VALUE(content, '$.CD_TIPO_MODAL') AS STRING) AS cd_tipo_modal,\n            SAFE_CAST(JSON_VALUE(content, '$.IN_SITUACAO_ATIVIDADE') AS STRING) AS in_situacao_atividade,\n            SAFE_CAST(JSON_VALUE(content, '$.DS_TIPO_MODAL') AS STRING) AS ds_tipo_modal\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`operadora_transporte`\n    ),\n    operadora_transporte_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY cd_operadora_transporte ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            operadora_transporte\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  operadora_transporte_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_gratuidade": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_gratuidade", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_gratuidade.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_gratuidade.sql", "unique_id": "model.rj_smtr.staging_gratuidade", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_gratuidade"], "alias": "gratuidade", "checksum": {"name": "sha256", "checksum": "fecbab0ac2badaacb19451993b183dcc68eb49f70521342cba2aaf395888521a"}, "config": {"enabled": true, "alias": "gratuidade", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "gratuidade"}, "created_at": 1727709586.4066308, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade`", "raw_code": "{{\n  config(\n    alias='gratuidade',\n  )\n}}\n\nSELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_cliente') AS STRING) AS cd_cliente,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_status_gratuidade') AS STRING) AS id_status_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_gratuidade') AS STRING) AS id_tipo_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_gratuidade') AS STRING) AS tipo_gratuidade\nFROM\n  {{ source('br_rj_riodejaneiro_bilhetagem_staging', 'gratuidade') }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "gratuidade"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_gratuidade.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n    SAFE_CAST(JSON_VALUE(content, '$.cd_cliente') AS STRING) AS cd_cliente,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), 'America/Sao_Paulo') AS data_inclusao,\n    SAFE_CAST(JSON_VALUE(content, '$.id_status_gratuidade') AS STRING) AS id_status_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.id_tipo_gratuidade') AS STRING) AS id_tipo_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.tipo_gratuidade') AS STRING) AS tipo_gratuidade\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_contato_pessoa_juridica": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_contato_pessoa_juridica", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_contato_pessoa_juridica.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_contato_pessoa_juridica.sql", "unique_id": "model.rj_smtr.staging_contato_pessoa_juridica", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_contato_pessoa_juridica"], "alias": "contato_pessoa_juridica", "checksum": {"name": "sha256", "checksum": "94543e38d9c3d3f06d3f4696691d91c89674dfc84eb74680e7a8cba43ab0203c"}, "config": {"enabled": true, "alias": "contato_pessoa_juridica", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "contato_pessoa_juridica"}, "created_at": 1727709586.409065, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`contato_pessoa_juridica`", "raw_code": "{{\n  config(\n    alias='contato_pessoa_juridica',\n  )\n}}\n\nWITH\n    contato_pessoa_juridica AS (\n        SELECT\n            data,\n            SAFE_CAST(NR_SEQ_CONTATO AS STRING) AS nr_seq_contato,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CONTATO') AS STRING) AS nm_contato,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_RAMAL') AS STRING) AS nr_ramal,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_TELEFONE') AS STRING) AS nr_telefone,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_EMAIL') AS STRING) AS tx_email,\n        FROM\n            {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"contato_pessoa_juridica\") }}\n    ),\n    contato_pessoa_juridica_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY nr_seq_contato, cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            contato_pessoa_juridica\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  contato_pessoa_juridica_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "contato_pessoa_juridica"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_contato_pessoa_juridica.sql", "compiled": true, "compiled_code": "\n\nWITH\n    contato_pessoa_juridica AS (\n        SELECT\n            data,\n            SAFE_CAST(NR_SEQ_CONTATO AS STRING) AS nr_seq_contato,\n            SAFE_CAST(CD_CLIENTE AS STRING) AS cd_cliente,\n            timestamp_captura,\n            DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', SAFE_CAST(JSON_VALUE(content, '$.DT_INCLUSAO') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n            SAFE_CAST(JSON_VALUE(content, '$.NM_CONTATO') AS STRING) AS nm_contato,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_RAMAL') AS STRING) AS nr_ramal,\n            SAFE_CAST(JSON_VALUE(content, '$.NR_TELEFONE') AS STRING) AS nr_telefone,\n            SAFE_CAST(JSON_VALUE(content, '$.TX_EMAIL') AS STRING) AS tx_email,\n        FROM\n            `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`contato_pessoa_juridica`\n    ),\n    contato_pessoa_juridica_rn AS (\n        SELECT\n            *,\n            ROW_NUMBER() OVER (PARTITION BY nr_seq_contato, cd_cliente ORDER BY timestamp_captura DESC) AS rn\n        FROM\n            contato_pessoa_juridica\n    )\nSELECT\n  * EXCEPT(rn)\nFROM\n  contato_pessoa_juridica_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "staging_ordem_pagamento_consorcio_operadora", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio_operadora.sql", "original_file_path": "models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio_operadora.sql", "unique_id": "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "staging_ordem_pagamento_consorcio_operadora"], "alias": "ordem_pagamento_consorcio_operadora", "checksum": {"name": "sha256", "checksum": "7b925c79c595eda01b4b48605ea70aad24742e8674f1a631cb1ff8bc03ede6e1"}, "config": {"enabled": true, "alias": "ordem_pagamento_consorcio_operadora", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "alias": "ordem_pagamento_consorcio_operadora"}, "created_at": 1727709586.4112246, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio_operadora`", "raw_code": "{{\n  config(\n    alias='ordem_pagamento_consorcio_operadora',\n  )\n}}\n\nWITH ordem_pagamento_consorcio_operadora AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n      {{ source(\"br_rj_riodejaneiro_bilhetagem_staging\", \"ordem_pagamento_consorcio_operadora\") }}\n),\nordem_pagamento_consorcio_operadora_rn AS (\n  SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento_consorcio_operadora ORDER BY timestamp_captura DESC) AS rn\n  FROM\n      ordem_pagamento_consorcio_operadora\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_consorcio_operadora_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento_consorcio_operadora"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_bilhetagem_staging/staging_ordem_pagamento_consorcio_operadora.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_pagamento_consorcio_operadora AS (\n  SELECT\n    data,\n    SAFE_CAST(id AS STRING) AS id_ordem_pagamento_consorcio_operadora,\n    timestamp_captura,\n    DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(JSON_VALUE(content, '$.data_inclusao') AS STRING)), \"America/Sao_Paulo\") AS datetime_inclusao,\n    PARSE_DATE('%Y-%m-%d', SAFE_CAST(JSON_VALUE(content, '$.data_ordem') AS STRING)) AS data_ordem,\n    SAFE_CAST(JSON_VALUE(content, '$.id_consorcio') AS STRING) AS id_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.id_operadora') AS STRING) AS id_operadora,\n    SAFE_CAST(JSON_VALUE(content, '$.id_ordem_pagamento_consorcio') AS STRING) AS id_ordem_pagamento_consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_debito') AS INTEGER) AS qtd_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_gratuidade') AS INTEGER) AS qtd_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_integracao') AS INTEGER) AS qtd_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_credito') AS INTEGER) AS qtd_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_rateio_debito') AS INTEGER) AS qtd_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.qtd_vendaabordo') AS INTEGER) AS qtd_vendaabordo,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_bruto') AS NUMERIC) AS valor_bruto,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_debito') AS NUMERIC) AS valor_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_gratuidade') AS NUMERIC) AS valor_gratuidade,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_integracao') AS NUMERIC) AS valor_integracao,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_liquido') AS NUMERIC) AS valor_liquido,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_credito') AS NUMERIC) AS valor_rateio_credito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_rateio_debito') AS NUMERIC) AS valor_rateio_debito,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_taxa') AS NUMERIC) AS valor_taxa,\n    SAFE_CAST(JSON_VALUE(content, '$.valor_vendaabordo') AS NUMERIC) AS valor_vendaabordo\n  FROM\n      `rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio_operadora`\n),\nordem_pagamento_consorcio_operadora_rn AS (\n  SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_ordem_pagamento_consorcio_operadora ORDER BY timestamp_captura DESC) AS rn\n  FROM\n      ordem_pagamento_consorcio_operadora\n)\nSELECT\n  * EXCEPT(rn)\nFROM\n  ordem_pagamento_consorcio_operadora_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_faixa_horaria": {"database": "rj-smtr", "schema": "planejamento", "name": "ordem_servico_faixa_horaria", "resource_type": "model", "package_name": "rj_smtr", "path": "planejamento/ordem_servico_faixa_horaria.sql", "original_file_path": "models/planejamento/ordem_servico_faixa_horaria.sql", "unique_id": "model.rj_smtr.ordem_servico_faixa_horaria", "fqn": ["rj_smtr", "planejamento", "ordem_servico_faixa_horaria"], "alias": "ordem_servico_faixa_horaria", "checksum": {"name": "sha256", "checksum": "0bb85bd12b7057d86cf19c8415d1eca12974f07536dcee6f66074c23a5057b6b"}, "config": {"enabled": true, "alias": null, "schema": "planejamento", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Quantidade de viagens planejadas por faixa hor\u00e1ria.", "columns": {"servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, S\u00e1bado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "description": "Hor\u00e1rio inicial da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_fim": {"name": "faixa_horaria_fim", "description": "Hor\u00e1rio final da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "partidas": {"name": "partidas", "description": "Quantidade de partidas planejadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quilometragem": {"name": "quilometragem", "description": "Quilometragem planejada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/planejamento/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "planejamento", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.573359, "relation_name": "`rj-smtr`.`planejamento`.`ordem_servico_faixa_horaria`", "raw_code": "{{\n  config(\n    partition_by = {\n      \"field\": \"feed_start_date\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH\n  dados AS (\n  SELECT\n    SAFE_CAST(data_versao AS DATE) AS data_versao,\n    SAFE_CAST(tipo_os AS STRING) AS tipo_os,\n    SAFE_CAST(servico AS STRING) AS servico,\n    SAFE_CAST(JSON_VALUE(content, \"$.consorcio\") AS STRING) AS consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_dias_uteis') AS STRING) AS partidas_entre_00h_e_03h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_dias_uteis') AS STRING) AS quilometragem_entre_00h_e_03h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_dias_uteis') AS STRING) AS partidas_entre_03h_e_12h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_dias_uteis') AS STRING) AS quilometragem_entre_03h_e_12h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_dias_uteis') AS STRING) AS partidas_entre_12h_e_21h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_dias_uteis') AS STRING) AS quilometragem_entre_12h_e_21h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_dias_uteis') AS STRING) AS partidas_entre_21h_e_24h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_dias_uteis') AS STRING) AS quilometragem_entre_21h_e_24h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_dias_uteis') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_sabado') AS STRING) AS partidas_entre_00h_e_03h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_sabado') AS STRING) AS quilometragem_entre_00h_e_03h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_sabado') AS STRING) AS partidas_entre_03h_e_12h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_sabado') AS STRING) AS quilometragem_entre_03h_e_12h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_sabado') AS STRING) AS partidas_entre_12h_e_21h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_sabado') AS STRING) AS quilometragem_entre_12h_e_21h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_sabado') AS STRING) AS partidas_entre_21h_e_24h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_sabado') AS STRING) AS quilometragem_entre_21h_e_24h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_sabado') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_sabado') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_domingo') AS STRING) AS partidas_entre_00h_e_03h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_domingo') AS STRING) AS quilometragem_entre_00h_e_03h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_domingo') AS STRING) AS partidas_entre_03h_e_12h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_domingo') AS STRING) AS quilometragem_entre_03h_e_12h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_domingo') AS STRING) AS partidas_entre_12h_e_21h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_domingo') AS STRING) AS quilometragem_entre_12h_e_21h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_domingo') AS STRING) AS partidas_entre_21h_e_24h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_domingo') AS STRING) AS quilometragem_entre_21h_e_24h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_domingo') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_domingo') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_ponto_facultativo') AS STRING) AS partidas_entre_00h_e_03h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_ponto_facultativo') AS STRING) AS quilometragem_entre_00h_e_03h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_ponto_facultativo') AS STRING) AS partidas_entre_03h_e_12h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_ponto_facultativo') AS STRING) AS quilometragem_entre_03h_e_12h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_ponto_facultativo') AS STRING) AS partidas_entre_12h_e_21h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_ponto_facultativo') AS STRING) AS quilometragem_entre_12h_e_21h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_ponto_facultativo') AS STRING) AS partidas_entre_21h_e_24h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_ponto_facultativo') AS STRING) AS quilometragem_entre_21h_e_24h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo\n  FROM\n    {{ source(\"br_rj_riodejaneiro_gtfs_staging\", \"ordem_servico_faixa_horaria\") }}\n  {% if is_incremental() -%}\n  WHERE\n    data_versao = '{{ var(\"data_versao_gtfs\") }}'\n  {%- endif %}\n  ),\n  dados_agrupados AS (\n  SELECT\n    data_versao,\n    tipo_os,\n    servico,\n    consorcio,\n    CASE\n      WHEN column_name LIKE '%dias_uteis%' THEN 'Dia \u00datil'\n      WHEN column_name LIKE '%sabado%' THEN 'Sabado'\n      WHEN column_name LIKE '%domingo%' THEN 'Domingo'\n      WHEN column_name LIKE '%ponto_facultativo%' THEN 'Ponto Facultativo'\n    END AS tipo_dia,\n    CASE\n      WHEN column_name LIKE '%00h_e_03h%' THEN\n          '00:00:00'\n      WHEN column_name LIKE '%03h_e_12h%' THEN\n          '03:00:00'\n      WHEN column_name LIKE '%12h_e_21h%' THEN\n          '12:00:00'\n      WHEN column_name LIKE '%21h_e_24h%' THEN\n          '21:00:00'\n      WHEN column_name LIKE '%24h_e_03h_diaseguinte%' THEN\n          '24:00:00'\n    END AS faixa_horaria_inicio,\n    CASE\n      WHEN column_name LIKE '%00h_e_03h%' THEN\n          '02:59:59'\n      WHEN column_name LIKE '%03h_e_12h%' THEN\n          '11:59:59'\n      WHEN column_name LIKE '%12h_e_21h%' THEN\n          '20:59:59'\n      WHEN column_name LIKE '%21h_e_24h%' THEN\n          '23:59:59'\n      WHEN column_name LIKE '%24h_e_03h_diaseguinte%' THEN\n          '26:59:59'\n    END AS faixa_horaria_fim,\n    SUM(CASE\n        WHEN column_name LIKE '%partidas%' THEN SAFE_CAST(value AS INT64)\n        ELSE 0\n    END) AS partidas,\n    SUM(CASE\n        WHEN column_name LIKE '%quilometragem%' THEN SAFE_CAST(value AS FLOAT64)\n        ELSE 0\n    END) AS quilometragem\n  FROM dados\n  UNPIVOT (\n    value FOR column_name IN (\n      partidas_entre_00h_e_03h_dias_uteis,\n      quilometragem_entre_00h_e_03h_dias_uteis,\n      partidas_entre_03h_e_12h_dias_uteis,\n      quilometragem_entre_03h_e_12h_dias_uteis,\n      partidas_entre_12h_e_21h_dias_uteis,\n      quilometragem_entre_12h_e_21h_dias_uteis,\n      partidas_entre_21h_e_24h_dias_uteis,\n      quilometragem_entre_21h_e_24h_dias_uteis,\n      partidas_entre_24h_e_03h_diaseguinte_dias_uteis,\n      quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis,\n      partidas_entre_00h_e_03h_sabado,\n      quilometragem_entre_00h_e_03h_sabado,\n      partidas_entre_03h_e_12h_sabado,\n      quilometragem_entre_03h_e_12h_sabado,\n      partidas_entre_12h_e_21h_sabado,\n      quilometragem_entre_12h_e_21h_sabado,\n      partidas_entre_21h_e_24h_sabado,\n      quilometragem_entre_21h_e_24h_sabado,\n      partidas_entre_24h_e_03h_diaseguinte_sabado,\n      quilometragem_entre_24h_e_03h_diaseguinte_sabado,\n      partidas_entre_00h_e_03h_domingo,\n      quilometragem_entre_00h_e_03h_domingo,\n      partidas_entre_03h_e_12h_domingo,\n      quilometragem_entre_03h_e_12h_domingo,\n      partidas_entre_12h_e_21h_domingo,\n      quilometragem_entre_12h_e_21h_domingo,\n      partidas_entre_21h_e_24h_domingo,\n      quilometragem_entre_21h_e_24h_domingo,\n      partidas_entre_24h_e_03h_diaseguinte_domingo,\n      quilometragem_entre_24h_e_03h_diaseguinte_domingo,\n      partidas_entre_00h_e_03h_ponto_facultativo,\n      quilometragem_entre_00h_e_03h_ponto_facultativo,\n      partidas_entre_03h_e_12h_ponto_facultativo,\n      quilometragem_entre_03h_e_12h_ponto_facultativo,\n      partidas_entre_12h_e_21h_ponto_facultativo,\n      quilometragem_entre_12h_e_21h_ponto_facultativo,\n      partidas_entre_21h_e_24h_ponto_facultativo,\n      quilometragem_entre_21h_e_24h_ponto_facultativo,\n      partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo,\n      quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo\n    )\n  )\n  GROUP BY 1, 2, 3, 4, 5, 6, 7\n)\nSELECT\n  fi.feed_version,\n  fi.feed_start_date,\n  fi.feed_end_date,\n  d.* EXCEPT(data_versao),\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  dados_agrupados AS d\nLEFT JOIN\n  {{ ref('feed_info_gtfs') }} AS fi\nON\n  d.data_versao = fi.feed_start_date\n{% if is_incremental() -%}\nWHERE\n  d.data_versao = '{{ var(\"data_versao_gtfs\") }}'\n  AND fi.feed_start_date = '{{ var(\"data_versao_gtfs\") }}'\n{% else %}\nWHERE\n  d.data_versao >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}'\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "ordem_servico_faixa_horaria"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/planejamento/ordem_servico_faixa_horaria.sql", "compiled": true, "compiled_code": "\n\nWITH\n  dados AS (\n  SELECT\n    SAFE_CAST(data_versao AS DATE) AS data_versao,\n    SAFE_CAST(tipo_os AS STRING) AS tipo_os,\n    SAFE_CAST(servico AS STRING) AS servico,\n    SAFE_CAST(JSON_VALUE(content, \"$.consorcio\") AS STRING) AS consorcio,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_dias_uteis') AS STRING) AS partidas_entre_00h_e_03h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_dias_uteis') AS STRING) AS quilometragem_entre_00h_e_03h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_dias_uteis') AS STRING) AS partidas_entre_03h_e_12h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_dias_uteis') AS STRING) AS quilometragem_entre_03h_e_12h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_dias_uteis') AS STRING) AS partidas_entre_12h_e_21h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_dias_uteis') AS STRING) AS quilometragem_entre_12h_e_21h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_dias_uteis') AS STRING) AS partidas_entre_21h_e_24h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_dias_uteis') AS STRING) AS quilometragem_entre_21h_e_24h_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_dias_uteis') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_sabado') AS STRING) AS partidas_entre_00h_e_03h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_sabado') AS STRING) AS quilometragem_entre_00h_e_03h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_sabado') AS STRING) AS partidas_entre_03h_e_12h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_sabado') AS STRING) AS quilometragem_entre_03h_e_12h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_sabado') AS STRING) AS partidas_entre_12h_e_21h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_sabado') AS STRING) AS quilometragem_entre_12h_e_21h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_sabado') AS STRING) AS partidas_entre_21h_e_24h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_sabado') AS STRING) AS quilometragem_entre_21h_e_24h_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_sabado') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_sabado') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_sabado,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_domingo') AS STRING) AS partidas_entre_00h_e_03h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_domingo') AS STRING) AS quilometragem_entre_00h_e_03h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_domingo') AS STRING) AS partidas_entre_03h_e_12h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_domingo') AS STRING) AS quilometragem_entre_03h_e_12h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_domingo') AS STRING) AS partidas_entre_12h_e_21h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_domingo') AS STRING) AS quilometragem_entre_12h_e_21h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_domingo') AS STRING) AS partidas_entre_21h_e_24h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_domingo') AS STRING) AS quilometragem_entre_21h_e_24h_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_domingo') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_domingo') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_domingo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_00h_e_03h_ponto_facultativo') AS STRING) AS partidas_entre_00h_e_03h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_00h_e_03h_ponto_facultativo') AS STRING) AS quilometragem_entre_00h_e_03h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_03h_e_12h_ponto_facultativo') AS STRING) AS partidas_entre_03h_e_12h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_03h_e_12h_ponto_facultativo') AS STRING) AS quilometragem_entre_03h_e_12h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_12h_e_21h_ponto_facultativo') AS STRING) AS partidas_entre_12h_e_21h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_12h_e_21h_ponto_facultativo') AS STRING) AS quilometragem_entre_12h_e_21h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_21h_e_24h_ponto_facultativo') AS STRING) AS partidas_entre_21h_e_24h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_21h_e_24h_ponto_facultativo') AS STRING) AS quilometragem_entre_21h_e_24h_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo') AS STRING) AS partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo,\n    SAFE_CAST(JSON_VALUE(content, '$.quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo') AS STRING) AS quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico_faixa_horaria`\n  WHERE\n    data_versao = '2024-05-03'\n  ),\n  dados_agrupados AS (\n  SELECT\n    data_versao,\n    tipo_os,\n    servico,\n    consorcio,\n    CASE\n      WHEN column_name LIKE '%dias_uteis%' THEN 'Dia \u00datil'\n      WHEN column_name LIKE '%sabado%' THEN 'Sabado'\n      WHEN column_name LIKE '%domingo%' THEN 'Domingo'\n      WHEN column_name LIKE '%ponto_facultativo%' THEN 'Ponto Facultativo'\n    END AS tipo_dia,\n    CASE\n      WHEN column_name LIKE '%00h_e_03h%' THEN\n          '00:00:00'\n      WHEN column_name LIKE '%03h_e_12h%' THEN\n          '03:00:00'\n      WHEN column_name LIKE '%12h_e_21h%' THEN\n          '12:00:00'\n      WHEN column_name LIKE '%21h_e_24h%' THEN\n          '21:00:00'\n      WHEN column_name LIKE '%24h_e_03h_diaseguinte%' THEN\n          '24:00:00'\n    END AS faixa_horaria_inicio,\n    CASE\n      WHEN column_name LIKE '%00h_e_03h%' THEN\n          '02:59:59'\n      WHEN column_name LIKE '%03h_e_12h%' THEN\n          '11:59:59'\n      WHEN column_name LIKE '%12h_e_21h%' THEN\n          '20:59:59'\n      WHEN column_name LIKE '%21h_e_24h%' THEN\n          '23:59:59'\n      WHEN column_name LIKE '%24h_e_03h_diaseguinte%' THEN\n          '26:59:59'\n    END AS faixa_horaria_fim,\n    SUM(CASE\n        WHEN column_name LIKE '%partidas%' THEN SAFE_CAST(value AS INT64)\n        ELSE 0\n    END) AS partidas,\n    SUM(CASE\n        WHEN column_name LIKE '%quilometragem%' THEN SAFE_CAST(value AS FLOAT64)\n        ELSE 0\n    END) AS quilometragem\n  FROM dados\n  UNPIVOT (\n    value FOR column_name IN (\n      partidas_entre_00h_e_03h_dias_uteis,\n      quilometragem_entre_00h_e_03h_dias_uteis,\n      partidas_entre_03h_e_12h_dias_uteis,\n      quilometragem_entre_03h_e_12h_dias_uteis,\n      partidas_entre_12h_e_21h_dias_uteis,\n      quilometragem_entre_12h_e_21h_dias_uteis,\n      partidas_entre_21h_e_24h_dias_uteis,\n      quilometragem_entre_21h_e_24h_dias_uteis,\n      partidas_entre_24h_e_03h_diaseguinte_dias_uteis,\n      quilometragem_entre_24h_e_03h_diaseguinte_dias_uteis,\n      partidas_entre_00h_e_03h_sabado,\n      quilometragem_entre_00h_e_03h_sabado,\n      partidas_entre_03h_e_12h_sabado,\n      quilometragem_entre_03h_e_12h_sabado,\n      partidas_entre_12h_e_21h_sabado,\n      quilometragem_entre_12h_e_21h_sabado,\n      partidas_entre_21h_e_24h_sabado,\n      quilometragem_entre_21h_e_24h_sabado,\n      partidas_entre_24h_e_03h_diaseguinte_sabado,\n      quilometragem_entre_24h_e_03h_diaseguinte_sabado,\n      partidas_entre_00h_e_03h_domingo,\n      quilometragem_entre_00h_e_03h_domingo,\n      partidas_entre_03h_e_12h_domingo,\n      quilometragem_entre_03h_e_12h_domingo,\n      partidas_entre_12h_e_21h_domingo,\n      quilometragem_entre_12h_e_21h_domingo,\n      partidas_entre_21h_e_24h_domingo,\n      quilometragem_entre_21h_e_24h_domingo,\n      partidas_entre_24h_e_03h_diaseguinte_domingo,\n      quilometragem_entre_24h_e_03h_diaseguinte_domingo,\n      partidas_entre_00h_e_03h_ponto_facultativo,\n      quilometragem_entre_00h_e_03h_ponto_facultativo,\n      partidas_entre_03h_e_12h_ponto_facultativo,\n      quilometragem_entre_03h_e_12h_ponto_facultativo,\n      partidas_entre_12h_e_21h_ponto_facultativo,\n      quilometragem_entre_12h_e_21h_ponto_facultativo,\n      partidas_entre_21h_e_24h_ponto_facultativo,\n      quilometragem_entre_21h_e_24h_ponto_facultativo,\n      partidas_entre_24h_e_03h_diaseguinte_ponto_facultativo,\n      quilometragem_entre_24h_e_03h_diaseguinte_ponto_facultativo\n    )\n  )\n  GROUP BY 1, 2, 3, 4, 5, 6, 7\n)\nSELECT\n  fi.feed_version,\n  fi.feed_start_date,\n  fi.feed_end_date,\n  d.* EXCEPT(data_versao),\n  '' AS versao_modelo\nFROM\n  dados_agrupados AS d\nLEFT JOIN\n  `rj-smtr`.`gtfs`.`feed_info` AS fi\nON\n  d.data_versao = fi.feed_start_date\nWHERE\n  d.data_versao = '2024-05-03'\n  AND fi.feed_start_date = '2024-05-03'\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_sppo_15_minutos": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_veiculos", "name": "gps_sppo_15_minutos", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_veiculos/gps_sppo_15_minutos.sql", "original_file_path": "models/br_rj_riodejaneiro_veiculos/gps_sppo_15_minutos.sql", "unique_id": "model.rj_smtr.gps_sppo_15_minutos", "fqn": ["rj_smtr", "br_rj_riodejaneiro_veiculos", "gps_sppo_15_minutos"], "alias": "gps_sppo_15_minutos", "checksum": {"name": "sha256", "checksum": "9f911abbbf2361298571217f66118d8e64b1f43df5c30b69cd2301ae8760c607"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_veiculos", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela com os dados tratados de registros de GPS do SPPO da \u00faltima hora e 15 minutos, incluindo velocidade estimada, estado de movimento, parada em terminal ou garagem e interse\u00e7\u00e3o com o tra\u00e7ado da linha informada.", "columns": {"modo": {"name": "modo", "description": "SPPO \u2013 nesse arquivo s\u00f3 consta esse modo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_operacao": {"name": "flag_em_operacao", "description": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "Identifica ve\u00edculos parados em terminais ou garagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_instantanea": {"name": "velocidade_instantanea", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_veiculos/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_veiculos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "tags": ["geolocalizacao"]}, "created_at": 1727709588.749445, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_sppo_15_minutos`", "raw_code": "{{\n  config(\n    materialized='table',\n    partition_by={\n      'field':\"data\",\n      'data_type':'date',\n      'granularity': 'day'\n    },\n    tags=['geolocalizacao']\n  )\n}}\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n  registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM {{ ref('sppo_aux_registros_filtrada') }}\n    WHERE\n      data = DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > DATETIME_SUB(\"{{var('date_range_end')}}\", INTERVAL 75 MINUTE)\n      AND timestamp_gps <= \"{{var('date_range_end')}}\"\n  ),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      {{ ref('sppo_aux_registros_velocidade') }}\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM {{ ref('sppo_aux_registros_parada') }}\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      {{ ref('sppo_aux_registros_flag_trajeto_correto') }}\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\nWHERE\n  DATE(r.timestamp_gps) = DATE(\"{{var('date_range_end')}}\")\n  AND r.timestamp_gps > DATETIME_SUB(\"{{var('date_range_end')}}\", INTERVAL 75 MINUTE)\n  AND r.timestamp_gps <= \"{{var('date_range_end')}}\"", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada", "package": null, "version": null}, {"name": "sppo_aux_registros_velocidade", "package": null, "version": null}, {"name": "sppo_aux_registros_parada", "package": null, "version": null}, {"name": "sppo_aux_registros_flag_trajeto_correto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.sppo_aux_registros_velocidade", "model.rj_smtr.sppo_aux_registros_parada", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_veiculos/gps_sppo_15_minutos.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n   __dbt__cte__sppo_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n),  __dbt__cte__sppo_aux_registros_parada as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n),  __dbt__cte__sppo_aux_registros_flag_trajeto_correto as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n), registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n      data = DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > DATETIME_SUB(\"2022-01-01T01:00:00\", INTERVAL 75 MINUTE)\n      AND timestamp_gps <= \"2022-01-01T01:00:00\"\n  ),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      __dbt__cte__sppo_aux_registros_velocidade\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM __dbt__cte__sppo_aux_registros_parada\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      __dbt__cte__sppo_aux_registros_flag_trajeto_correto\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\nWHERE\n  DATE(r.timestamp_gps) = DATE(\"2022-01-01T01:00:00\")\n  AND r.timestamp_gps > DATETIME_SUB(\"2022-01-01T01:00:00\", INTERVAL 75 MINUTE)\n  AND r.timestamp_gps <= \"2022-01-01T01:00:00\"", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.sppo_aux_registros_velocidade", "sql": " __dbt__cte__sppo_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_parada", "sql": " __dbt__cte__sppo_aux_registros_parada as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "sql": " __dbt__cte__sppo_aux_registros_flag_trajeto_correto as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_sppo": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_veiculos", "name": "gps_sppo", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_veiculos/gps_sppo.sql", "original_file_path": "models/br_rj_riodejaneiro_veiculos/gps_sppo.sql", "unique_id": "model.rj_smtr.gps_sppo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_veiculos", "gps_sppo"], "alias": "gps_sppo", "checksum": {"name": "sha256", "checksum": "57bde7243f03d95544a0aaeca0ef7780f81b31ea142d2ba016904e145990b10a"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_veiculos", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela com os dados tratados de registros de GPS do SPPO, incluindo velocidade estimada, estado de movimento, parada em terminal ou garagem e interse\u00e7\u00e3o com o tra\u00e7ado da linha informada.", "columns": {"modo": {"name": "modo", "description": "SPPO \u2013 nesse arquivo s\u00f3 consta esse modo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_operacao": {"name": "flag_em_operacao", "description": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "Identifica ve\u00edculos parados em terminais ou garagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_instantanea": {"name": "velocidade_instantanea", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_veiculos/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_veiculos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "tags": ["geolocalizacao"]}, "created_at": 1727709588.7473745, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_sppo`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    partition_by={\n      'field':\"data\",\n      'data_type':'date',\n      'granularity': 'day'\n    },\n    tags=['geolocalizacao']\n  )\n}}\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n  registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM {{ ref('sppo_aux_registros_filtrada') }}\n    {% if is_incremental() -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n  ),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      {{ ref('sppo_aux_registros_velocidade') }}\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM {{ ref('sppo_aux_registros_parada') }}\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      {{ ref('sppo_aux_registros_flag_trajeto_correto') }}\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\n{% if is_incremental() -%}\n  WHERE\n  date(r.timestamp_gps) between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n  AND r.timestamp_gps > \"{{var('date_range_start')}}\" and r.timestamp_gps <=\"{{var('date_range_end')}}\"\n{%- endif -%}", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada", "package": null, "version": null}, {"name": "sppo_aux_registros_velocidade", "package": null, "version": null}, {"name": "sppo_aux_registros_parada", "package": null, "version": null}, {"name": "sppo_aux_registros_flag_trajeto_correto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.sppo_aux_registros_velocidade", "model.rj_smtr.sppo_aux_registros_parada", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_veiculos/gps_sppo.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n   __dbt__cte__sppo_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n),  __dbt__cte__sppo_aux_registros_parada as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n),  __dbt__cte__sppo_aux_registros_flag_trajeto_correto as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n), registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      __dbt__cte__sppo_aux_registros_velocidade\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM __dbt__cte__sppo_aux_registros_parada\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      __dbt__cte__sppo_aux_registros_flag_trajeto_correto\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\nWHERE\n  date(r.timestamp_gps) between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n  AND r.timestamp_gps > \"2022-01-01T00:00:00\" and r.timestamp_gps <=\"2022-01-01T01:00:00\"", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.sppo_aux_registros_velocidade", "sql": " __dbt__cte__sppo_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_parada", "sql": " __dbt__cte__sppo_aux_registros_parada as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "sql": " __dbt__cte__sppo_aux_registros_flag_trajeto_correto as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_brt_15_minutos": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_veiculos", "name": "gps_brt_15_minutos", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_veiculos/gps_brt_15_minutos.sql", "original_file_path": "models/br_rj_riodejaneiro_veiculos/gps_brt_15_minutos.sql", "unique_id": "model.rj_smtr.gps_brt_15_minutos", "fqn": ["rj_smtr", "br_rj_riodejaneiro_veiculos", "gps_brt_15_minutos"], "alias": "gps_brt_15_minutos", "checksum": {"name": "sha256", "checksum": "8b33aee1a5d8d2245a35e7dd2b435bce114e1e5443a1796c8f76f0f68f913565"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_veiculos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com os dados tratados de registros de GPS do BRT, incluindo velocidade estimada, estado de movimento, parada em terminal ou garagem e interse\u00e7\u00e3o com o tra\u00e7ado da linha informada.", "columns": {"modo": {"name": "modo", "description": "BRT \u2013 nesse arquivo s\u00f3 consta esse modo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_operacao": {"name": "flag_em_operacao", "description": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "Identifica ve\u00edculos parados em terminais ou garagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_instantanea": {"name": "velocidade_instantanea", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_veiculos/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_veiculos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.7484121, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_brt_15_minutos`", "raw_code": "{{\n    config(\n        materialized='incremental',\n        partition_by={\n            'field': 'data',\n            'data_type': 'date',\n            'granularity': 'day'\n        }\n    )\n}}\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n    registros as (\n    -- 1. registros_filtrada\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        timestamp_captura,\n        velocidade,\n        servico,\n        latitude,\n        longitude,\n    FROM {{ ref('brt_aux_registros_filtrada') }}\n    {% if is_incremental() -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n      AND DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) BETWEEN 0 AND 1\n    {%- endif -%}\n    ),\n    velocidades AS (\n    -- 2. velocidades\n    SELECT\n        id_veiculo, timestamp_gps, servico, velocidade, distancia, flag_em_movimento\n    FROM {{ ref('brt_aux_registros_velocidade') }}\n    ),\n    paradas as (\n    -- 3. paradas\n    SELECT\n        id_veiculo, timestamp_gps, servico, tipo_parada,\n    FROM {{ ref('brt_aux_registros_parada') }}\n    ),\n    flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        route_id,\n        flag_linha_existe_sigmob,\n        flag_trajeto_correto,\n        flag_trajeto_correto_hist\n    FROM {{ ref('brt_aux_registros_flag_trajeto_correto') }}\n    )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n    \"BRT\" modo,\n    r.timestamp_gps,\n    date(r.timestamp_gps) data,\n    extract(time from r.timestamp_gps) hora,\n    r.id_veiculo,\n    replace(r.servico, \" \", \"\") as servico,\n    r.latitude,\n    r.longitude,\n    CASE\n        WHEN\n        flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN true\n    ELSE false\n    END flag_em_operacao,\n    v.flag_em_movimento,\n    p.tipo_parada,\n    flag_linha_existe_sigmob,\n    flag_trajeto_correto,\n    flag_trajeto_correto_hist,\n    CASE\n        WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN 'Em opera\u00e7\u00e3o'\n        WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n        THEN 'Operando fora trajeto'\n        WHEN flag_em_movimento is false\n        THEN\n            CASE\n                WHEN tipo_parada is not null\n                THEN concat(\"Parado \", tipo_parada)\n            ELSE\n                CASE\n                    WHEN flag_trajeto_correto_hist is true\n                    THEN 'Parado trajeto correto'\n                ELSE 'Parado fora trajeto'\n                END\n            END\n    END status,\n    r.velocidade velocidade_instantanea,\n    v.velocidade velocidade_estimada_10_min,\n    v.distancia,\n    \"{{ var(\"version\") }}\" as versao\nFROM\n    registros r\n\nJOIN\n    flags f\nON\n    r.id_veiculo = f.id_veiculo\n    AND r.timestamp_gps = f.timestamp_gps\n    AND r.servico = f.servico\n\nJOIN\n    velocidades v\nON\n    r.id_veiculo = v.id_veiculo\n    AND  r.timestamp_gps = v.timestamp_gps\n    AND  r.servico = v.servico\n\nJOIN\n    paradas p\nON\n    r.id_veiculo = p.id_veiculo\n    AND  r.timestamp_gps = p.timestamp_gps\n    AND r.servico = p.servico\n{% if is_incremental() -%}\n  WHERE\n  date(r.timestamp_gps) between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n  AND r.timestamp_gps > \"{{var('date_range_start')}}\" and r.timestamp_gps <=\"{{var('date_range_end')}}\"\n  AND DATETIME_DIFF(r.timestamp_captura, r.timestamp_gps, MINUTE) BETWEEN 0 AND 1\n{%- endif -%}", "language": "sql", "refs": [{"name": "brt_aux_registros_filtrada", "package": null, "version": null}, {"name": "brt_aux_registros_velocidade", "package": null, "version": null}, {"name": "brt_aux_registros_parada", "package": null, "version": null}, {"name": "brt_aux_registros_flag_trajeto_correto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.brt_aux_registros_velocidade", "model.rj_smtr.brt_aux_registros_parada", "model.rj_smtr.brt_aux_registros_flag_trajeto_correto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_veiculos/gps_brt_15_minutos.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n     __dbt__cte__brt_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n    \n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT( AS versao_maestro,  AS versao_maestro_bq) versao\nFROM medias\n),  __dbt__cte__brt_aux_registros_parada as (\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.estacoes_e_terminais_brt\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n      WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n),  __dbt__cte__brt_aux_registros_flag_trajeto_correto as (\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada` r\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('20', 'B')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT( AS versao_maestro,\n      --        AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n), registros as (\n    -- 1. registros_filtrada\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        timestamp_captura,\n        velocidade,\n        servico,\n        latitude,\n        longitude,\n    FROM `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    ),\n    velocidades AS (\n    -- 2. velocidades\n    SELECT\n        id_veiculo, timestamp_gps, servico, velocidade, distancia, flag_em_movimento\n    FROM __dbt__cte__brt_aux_registros_velocidade\n    ),\n    paradas as (\n    -- 3. paradas\n    SELECT\n        id_veiculo, timestamp_gps, servico, tipo_parada,\n    FROM __dbt__cte__brt_aux_registros_parada\n    ),\n    flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        route_id,\n        flag_linha_existe_sigmob,\n        flag_trajeto_correto,\n        flag_trajeto_correto_hist\n    FROM __dbt__cte__brt_aux_registros_flag_trajeto_correto\n    )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n    \"BRT\" modo,\n    r.timestamp_gps,\n    date(r.timestamp_gps) data,\n    extract(time from r.timestamp_gps) hora,\n    r.id_veiculo,\n    replace(r.servico, \" \", \"\") as servico,\n    r.latitude,\n    r.longitude,\n    CASE\n        WHEN\n        flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN true\n    ELSE false\n    END flag_em_operacao,\n    v.flag_em_movimento,\n    p.tipo_parada,\n    flag_linha_existe_sigmob,\n    flag_trajeto_correto,\n    flag_trajeto_correto_hist,\n    CASE\n        WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN 'Em opera\u00e7\u00e3o'\n        WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n        THEN 'Operando fora trajeto'\n        WHEN flag_em_movimento is false\n        THEN\n            CASE\n                WHEN tipo_parada is not null\n                THEN concat(\"Parado \", tipo_parada)\n            ELSE\n                CASE\n                    WHEN flag_trajeto_correto_hist is true\n                    THEN 'Parado trajeto correto'\n                ELSE 'Parado fora trajeto'\n                END\n            END\n    END status,\n    r.velocidade velocidade_instantanea,\n    v.velocidade velocidade_estimada_10_min,\n    v.distancia,\n    \"\" as versao\nFROM\n    registros r\n\nJOIN\n    flags f\nON\n    r.id_veiculo = f.id_veiculo\n    AND r.timestamp_gps = f.timestamp_gps\n    AND r.servico = f.servico\n\nJOIN\n    velocidades v\nON\n    r.id_veiculo = v.id_veiculo\n    AND  r.timestamp_gps = v.timestamp_gps\n    AND  r.servico = v.servico\n\nJOIN\n    paradas p\nON\n    r.id_veiculo = p.id_veiculo\n    AND  r.timestamp_gps = p.timestamp_gps\n    AND r.servico = p.servico\n", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.brt_aux_registros_velocidade", "sql": " __dbt__cte__brt_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n    \n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT( AS versao_maestro,  AS versao_maestro_bq) versao\nFROM medias\n)"}, {"id": "model.rj_smtr.brt_aux_registros_parada", "sql": " __dbt__cte__brt_aux_registros_parada as (\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.estacoes_e_terminais_brt\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n      WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n)"}, {"id": "model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "sql": " __dbt__cte__brt_aux_registros_flag_trajeto_correto as (\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada` r\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('20', 'B')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT( AS versao_maestro,\n      --        AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_brt": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_veiculos", "name": "gps_brt", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_veiculos/gps_brt.sql", "original_file_path": "models/br_rj_riodejaneiro_veiculos/gps_brt.sql", "unique_id": "model.rj_smtr.gps_brt", "fqn": ["rj_smtr", "br_rj_riodejaneiro_veiculos", "gps_brt"], "alias": "gps_brt", "checksum": {"name": "sha256", "checksum": "ce6f9b7832f9851b86d2b858cc1bedcf1c028752e3016f67cff555ac793c8fd7"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_veiculos", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela com os dados tratados de registros de GPS do BRT, incluindo velocidade estimada, estado de movimento, parada em terminal ou garagem e interse\u00e7\u00e3o com o tra\u00e7ado da linha informada.", "columns": {"modo": {"name": "modo", "description": "BRT \u2013 nesse arquivo s\u00f3 consta esse modo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_operacao": {"name": "flag_em_operacao", "description": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "Identifica ve\u00edculos parados em terminais ou garagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_instantanea": {"name": "velocidade_instantanea", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_veiculos/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_veiculos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "tags": ["geolocalizacao"]}, "created_at": 1727709588.7462196, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_brt`", "raw_code": "{{\n    config(\n        materialized='incremental',\n        partition_by={\n            'field': 'data',\n            'data_type': 'date',\n            'granularity': 'day'\n        },\n        tags=['geolocalizacao']\n    )\n}}\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n    registros as (\n    -- 1. registros_filtrada\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        timestamp_captura,\n        velocidade,\n        servico,\n        latitude,\n        longitude,\n    FROM {{ ref('brt_aux_registros_filtrada') }}\n    {% if is_incremental() -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n      AND DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) BETWEEN 0 AND 1\n    {%- endif -%}\n    ),\n    velocidades AS (\n    -- 2. velocidades\n    SELECT\n        id_veiculo, timestamp_gps, servico, velocidade, distancia, flag_em_movimento\n    FROM {{ ref('brt_aux_registros_velocidade') }}\n    ),\n    paradas as (\n    -- 3. paradas\n    SELECT\n        id_veiculo, timestamp_gps, servico, tipo_parada,\n    FROM {{ ref('brt_aux_registros_parada') }}\n    ),\n    flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        route_id,\n        flag_linha_existe_sigmob,\n        flag_trajeto_correto,\n        flag_trajeto_correto_hist\n    FROM {{ ref('brt_aux_registros_flag_trajeto_correto') }}\n    )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n    \"BRT\" modo,\n    r.timestamp_gps,\n    date(r.timestamp_gps) data,\n    extract(time from r.timestamp_gps) hora,\n    r.id_veiculo,\n    replace(r.servico, \" \", \"\") as servico,\n    r.latitude,\n    r.longitude,\n    CASE\n        WHEN\n        flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN true\n    ELSE false\n    END flag_em_operacao,\n    v.flag_em_movimento,\n    p.tipo_parada,\n    flag_linha_existe_sigmob,\n    flag_trajeto_correto,\n    flag_trajeto_correto_hist,\n    CASE\n        WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN 'Em opera\u00e7\u00e3o'\n        WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n        THEN 'Operando fora trajeto'\n        WHEN flag_em_movimento is false\n        THEN\n            CASE\n                WHEN tipo_parada is not null\n                THEN concat(\"Parado \", tipo_parada)\n            ELSE\n                CASE\n                    WHEN flag_trajeto_correto_hist is true\n                    THEN 'Parado trajeto correto'\n                ELSE 'Parado fora trajeto'\n                END\n            END\n    END status,\n    r.velocidade velocidade_instantanea,\n    v.velocidade velocidade_estimada_10_min,\n    v.distancia,\n    \"{{ var(\"version\") }}\" as versao\nFROM\n    registros r\n\nJOIN\n    flags f\nON\n    r.id_veiculo = f.id_veiculo\n    AND r.timestamp_gps = f.timestamp_gps\n    AND r.servico = f.servico\n\nJOIN\n    velocidades v\nON\n    r.id_veiculo = v.id_veiculo\n    AND  r.timestamp_gps = v.timestamp_gps\n    AND  r.servico = v.servico\n\nJOIN\n    paradas p\nON\n    r.id_veiculo = p.id_veiculo\n    AND  r.timestamp_gps = p.timestamp_gps\n    AND r.servico = p.servico\n{% if is_incremental() -%}\n  WHERE\n  date(r.timestamp_gps) between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n  AND r.timestamp_gps > \"{{var('date_range_start')}}\" and r.timestamp_gps <=\"{{var('date_range_end')}}\"\n  AND DATETIME_DIFF(r.timestamp_captura, r.timestamp_gps, MINUTE) BETWEEN 0 AND 1\n{%- endif -%}", "language": "sql", "refs": [{"name": "brt_aux_registros_filtrada", "package": null, "version": null}, {"name": "brt_aux_registros_velocidade", "package": null, "version": null}, {"name": "brt_aux_registros_parada", "package": null, "version": null}, {"name": "brt_aux_registros_flag_trajeto_correto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.brt_aux_registros_velocidade", "model.rj_smtr.brt_aux_registros_parada", "model.rj_smtr.brt_aux_registros_flag_trajeto_correto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_veiculos/gps_brt.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n     __dbt__cte__brt_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n    \n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT( AS versao_maestro,  AS versao_maestro_bq) versao\nFROM medias\n),  __dbt__cte__brt_aux_registros_parada as (\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.estacoes_e_terminais_brt\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n      WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n),  __dbt__cte__brt_aux_registros_flag_trajeto_correto as (\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada` r\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('20', 'B')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT( AS versao_maestro,\n      --        AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n), registros as (\n    -- 1. registros_filtrada\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        timestamp_captura,\n        velocidade,\n        servico,\n        latitude,\n        longitude,\n    FROM `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      AND DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) BETWEEN 0 AND 1),\n    velocidades AS (\n    -- 2. velocidades\n    SELECT\n        id_veiculo, timestamp_gps, servico, velocidade, distancia, flag_em_movimento\n    FROM __dbt__cte__brt_aux_registros_velocidade\n    ),\n    paradas as (\n    -- 3. paradas\n    SELECT\n        id_veiculo, timestamp_gps, servico, tipo_parada,\n    FROM __dbt__cte__brt_aux_registros_parada\n    ),\n    flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        route_id,\n        flag_linha_existe_sigmob,\n        flag_trajeto_correto,\n        flag_trajeto_correto_hist\n    FROM __dbt__cte__brt_aux_registros_flag_trajeto_correto\n    )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n    \"BRT\" modo,\n    r.timestamp_gps,\n    date(r.timestamp_gps) data,\n    extract(time from r.timestamp_gps) hora,\n    r.id_veiculo,\n    replace(r.servico, \" \", \"\") as servico,\n    r.latitude,\n    r.longitude,\n    CASE\n        WHEN\n        flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN true\n    ELSE false\n    END flag_em_operacao,\n    v.flag_em_movimento,\n    p.tipo_parada,\n    flag_linha_existe_sigmob,\n    flag_trajeto_correto,\n    flag_trajeto_correto_hist,\n    CASE\n        WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n        THEN 'Em opera\u00e7\u00e3o'\n        WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n        THEN 'Operando fora trajeto'\n        WHEN flag_em_movimento is false\n        THEN\n            CASE\n                WHEN tipo_parada is not null\n                THEN concat(\"Parado \", tipo_parada)\n            ELSE\n                CASE\n                    WHEN flag_trajeto_correto_hist is true\n                    THEN 'Parado trajeto correto'\n                ELSE 'Parado fora trajeto'\n                END\n            END\n    END status,\n    r.velocidade velocidade_instantanea,\n    v.velocidade velocidade_estimada_10_min,\n    v.distancia,\n    \"\" as versao\nFROM\n    registros r\n\nJOIN\n    flags f\nON\n    r.id_veiculo = f.id_veiculo\n    AND r.timestamp_gps = f.timestamp_gps\n    AND r.servico = f.servico\n\nJOIN\n    velocidades v\nON\n    r.id_veiculo = v.id_veiculo\n    AND  r.timestamp_gps = v.timestamp_gps\n    AND  r.servico = v.servico\n\nJOIN\n    paradas p\nON\n    r.id_veiculo = p.id_veiculo\n    AND  r.timestamp_gps = p.timestamp_gps\n    AND r.servico = p.servico\nWHERE\n  date(r.timestamp_gps) between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n  AND r.timestamp_gps > \"2022-01-01T00:00:00\" and r.timestamp_gps <=\"2022-01-01T01:00:00\"\n  AND DATETIME_DIFF(r.timestamp_captura, r.timestamp_gps, MINUTE) BETWEEN 0 AND 1", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.brt_aux_registros_velocidade", "sql": " __dbt__cte__brt_aux_registros_velocidade as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n    \n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT( AS versao_maestro,  AS versao_maestro_bq) versao\nFROM medias\n)"}, {"id": "model.rj_smtr.brt_aux_registros_parada", "sql": " __dbt__cte__brt_aux_registros_parada as (\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.estacoes_e_terminais_brt\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n      WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n)"}, {"id": "model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "sql": " __dbt__cte__brt_aux_registros_flag_trajeto_correto as (\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada` r\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('20', 'B')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT( AS versao_maestro,\n      --        AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_dia_pagamento": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo_v2", "name": "sumario_servico_dia_pagamento", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo_v2/sumario_servico_dia_pagamento.sql", "original_file_path": "models/dashboard_subsidio_sppo_v2/sumario_servico_dia_pagamento.sql", "unique_id": "model.rj_smtr.sumario_servico_dia_pagamento", "fqn": ["rj_smtr", "dashboard_subsidio_sppo_v2", "sumario_servico_dia_pagamento"], "alias": "sumario_servico_dia_pagamento", "checksum": {"name": "sha256", "checksum": "23fa4379d01d4d4a81ccea61f3a57ba5c73c01239b4b19a9ef6bb4bd21d4658f"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo_v2", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_dia": {"name": "viagens_dia", "description": "Quantidade de viagens apuradas por dia.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_dia": {"name": "km_apurada_dia", "description": "Dist\u00e2ncia apurada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada_dia": {"name": "km_subsidiada_dia", "description": "Dist\u00e2ncia subsidiada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada_dia": {"name": "km_planejada_dia", "description": "Dist\u00e2ncia planejada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "media_pof": {"name": "media_pof", "description": "M\u00e9dia do indicador percentual de opera\u00e7\u00e3o por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "desvp_pof": {"name": "desvp_pof", "description": "Desvio padr\u00e3o do indicador percentual de opera\u00e7\u00e3o por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_registrado_com_ar_inoperante": {"name": "km_apurada_registrado_com_ar_inoperante", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_licenciado": {"name": "km_apurada_n_licenciado", "description": "Quilometragem apurada de viagens de ve\u00edculos n\u00e3o licenciados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_ar_inoperante": {"name": "km_apurada_autuado_ar_inoperante", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por ar inoperante.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_seguranca": {"name": "km_apurada_autuado_seguranca", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por seguran\u00e7a.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_limpezaequipamento": {"name": "km_apurada_autuado_limpezaequipamento", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por limpeza ou equipamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_sem_ar_n_autuado": {"name": "km_apurada_licenciado_sem_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos sem ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_com_ar_n_autuado": {"name": "km_apurada_licenciado_com_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos com ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_vistoriado": {"name": "km_apurada_n_vistoriado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_sem_transacao": {"name": "km_apurada_sem_transacao", "description": "Dist\u00e2ncia apurada de viagens realizadas sem passageiro registrado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_a_pagar": {"name": "valor_a_pagar", "description": "Valor efetivo de pagamento (valor_total_apurado - valor_acima_limite - valor_glosado).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_glosado": {"name": "valor_glosado", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km, subtra\u00eddo pelo valor efetivo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_acima_limite": {"name": "valor_acima_limite", "description": "Valor apurado das viagens que n\u00e3o foram remuneradas (por estar acima do teto de 120% / 200%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_sem_glosa": {"name": "valor_total_sem_glosa", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_apurado": {"name": "valor_total_apurado", "description": "Valor total das viagens apuradas, subtra\u00eddas as penalidades (POF =< 60%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_judicial": {"name": "valor_judicial", "description": "Valor de glosa depositada em ju\u00edzo (Autua\u00e7\u00e3o por ar inoperante, Ve\u00edculo licenciado sem ar, Penalidade abaixo de 60% e Notifica\u00e7\u00e3o dos Agentes de Ver\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_penalidade": {"name": "valor_penalidade", "description": "Valor penalidade [negativa] (POF =< 60%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo_v2/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo_v2", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.584546, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo_v2`.`sumario_servico_dia_pagamento`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    SAFE_CAST(AVG(pof) AS NUMERIC) AS media_pof,\n    SAFE_CAST(COALESCE(STDDEV(pof), 0) AS NUMERIC) AS desvp_pof\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia\") }}\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  valores_subsidio AS (\n  SELECT\n    *\n  FROM\n    {{ ref(\"subsidio_sumario_servico_dia_pagamento\") }}\n    -- rj-smtr.financeiro.subsidio_sumario_servico_dia_pagamento\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  pivot_data AS (\n  SELECT\n    *\n  FROM (\n    SELECT\n      data,\n      tipo_dia,\n      consorcio,\n      servico,\n      tipo_viagem,\n      km_apurada_faixa\n    FROM\n      {{ ref(\"subsidio_faixa_servico_dia_tipo_viagem\") }}\n      -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n    WHERE\n      data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n      AND DATE(\"{{ var(\"end_date\") }}\")\n    )\n    PIVOT(SUM(km_apurada_faixa) AS km_apurada FOR tipo_viagem IN (\n      \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\n      \"N\u00e3o licenciado\" AS n_licenciado,\n      \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\n      \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\n      \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\n      \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\n      \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\n      \"N\u00e3o vistoriado\" AS n_vistoriado,\n      \"Sem transa\u00e7\u00e3o\" AS sem_transacao))\n  )\nSELECT\n  vs.data,\n  vs.tipo_dia,\n  vs.consorcio,\n  vs.servico,\n  vs.viagens_dia,\n  vs.km_apurada_dia,\n  vs.km_subsidiada_dia,\n  vs.km_planejada_dia,\n  sd.media_pof,\n  sd.desvp_pof,\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao,\n  vs.valor_a_pagar,\n  vs.valor_glosado,\n  vs.valor_acima_limite,\n  vs.valor_total_sem_glosa,\n  vs.valor_total_apurado,\n  vs.valor_judicial,\n  vs.valor_penalidade,\n  '{{ var(\"version\") }}' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  valores_subsidio AS vs\nLEFT JOIN\n  subsidio_dia AS sd\nUSING(data, tipo_dia, consorcio, servico)\nLEFT JOIN\n  pivot_data AS pd\nUSING(data, tipo_dia, consorcio, servico)", "language": "sql", "refs": [{"name": "subsidio_faixa_servico_dia", "package": null, "version": null}, {"name": "subsidio_sumario_servico_dia_pagamento", "package": null, "version": null}, {"name": "subsidio_faixa_servico_dia_tipo_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_sumario_servico_dia_pagamento", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo_v2/sumario_servico_dia_pagamento.sql", "compiled": true, "compiled_code": "\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    SAFE_CAST(AVG(pof) AS NUMERIC) AS media_pof,\n    SAFE_CAST(COALESCE(STDDEV(pof), 0) AS NUMERIC) AS desvp_pof\n  FROM\n    `rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  valores_subsidio AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`financeiro`.`subsidio_sumario_servico_dia_pagamento`\n    -- rj-smtr.financeiro.subsidio_sumario_servico_dia_pagamento\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  pivot_data AS (\n  SELECT\n    *\n  FROM (\n    SELECT\n      data,\n      tipo_dia,\n      consorcio,\n      servico,\n      tipo_viagem,\n      km_apurada_faixa\n    FROM\n      `rj-smtr`.`financeiro`.`subsidio_faixa_servico_dia_tipo_viagem`\n      -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n    WHERE\n      data BETWEEN DATE(\"2022-01-01T01:00:00\")\n      AND DATE(\"2022-01-01T01:00:00\")\n    )\n    PIVOT(SUM(km_apurada_faixa) AS km_apurada FOR tipo_viagem IN (\n      \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\n      \"N\u00e3o licenciado\" AS n_licenciado,\n      \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\n      \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\n      \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\n      \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\n      \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\n      \"N\u00e3o vistoriado\" AS n_vistoriado,\n      \"Sem transa\u00e7\u00e3o\" AS sem_transacao))\n  )\nSELECT\n  vs.data,\n  vs.tipo_dia,\n  vs.consorcio,\n  vs.servico,\n  vs.viagens_dia,\n  vs.km_apurada_dia,\n  vs.km_subsidiada_dia,\n  vs.km_planejada_dia,\n  sd.media_pof,\n  sd.desvp_pof,\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao,\n  vs.valor_a_pagar,\n  vs.valor_glosado,\n  vs.valor_acima_limite,\n  vs.valor_total_sem_glosa,\n  vs.valor_total_apurado,\n  vs.valor_judicial,\n  vs.valor_penalidade,\n  '' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  valores_subsidio AS vs\nLEFT JOIN\n  subsidio_dia AS sd\nUSING(data, tipo_dia, consorcio, servico)\nLEFT JOIN\n  pivot_data AS pd\nUSING(data, tipo_dia, consorcio, servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_faixa_servico_dia": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo_v2", "name": "sumario_faixa_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo_v2/sumario_faixa_servico_dia.sql", "original_file_path": "models/dashboard_subsidio_sppo_v2/sumario_faixa_servico_dia.sql", "unique_id": "model.rj_smtr.sumario_faixa_servico_dia", "fqn": ["rj_smtr", "dashboard_subsidio_sppo_v2", "sumario_faixa_servico_dia"], "alias": "sumario_faixa_servico_dia", "checksum": {"name": "sha256", "checksum": "19bcafa1a6008945e1dc4ad8ba4cfcb766872b18448052c09b7f5ed6e259f36b"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo_v2", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia e faixa hor\u00e1ria.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "description": "Hor\u00e1rio inicial da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_fim": {"name": "faixa_horaria_fim", "description": "Hor\u00e1rio final da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_faixa": {"name": "viagens_faixa", "description": "Quantidade de viagens apuradas por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_faixa": {"name": "km_apurada_faixa", "description": "Dist\u00e2ncia apurada para o servi\u00e7o por faixa hor\u00e1ria(km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada_faixa": {"name": "km_subsidiada_faixa", "description": "Dist\u00e2ncia subsidiada para o servi\u00e7o por faixa hor\u00e1ria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada_faixa": {"name": "km_planejada_faixa", "description": "Dist\u00e2ncia planejada para o servi\u00e7o por faixa hor\u00e1ria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "pof": {"name": "pof", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_registrado_com_ar_inoperante": {"name": "km_apurada_registrado_com_ar_inoperante", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_licenciado": {"name": "km_apurada_n_licenciado", "description": "Quilometragem apurada de viagens de ve\u00edculos n\u00e3o licenciados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_ar_inoperante": {"name": "km_apurada_autuado_ar_inoperante", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por ar inoperante.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_seguranca": {"name": "km_apurada_autuado_seguranca", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por seguran\u00e7a.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_limpezaequipamento": {"name": "km_apurada_autuado_limpezaequipamento", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por limpeza ou equipamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_sem_ar_n_autuado": {"name": "km_apurada_licenciado_sem_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos sem ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_com_ar_n_autuado": {"name": "km_apurada_licenciado_com_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos com ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_vistoriado": {"name": "km_apurada_n_vistoriado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_sem_transacao": {"name": "km_apurada_sem_transacao", "description": "Dist\u00e2ncia apurada de viagens realizadas sem passageiro registrado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_apurado": {"name": "valor_apurado", "description": "Valor da dist\u00e2ncia apurada multiplicada pelo subs\u00eddio por quil\u00f4metro (sem glosa). \u00c9 zerado quando POF < 80%.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_acima_limite": {"name": "valor_acima_limite", "description": "Valor apurado das viagens que n\u00e3o foram remuneradas (por estar acima do teto de 120% / 200%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_sem_glosa": {"name": "valor_total_sem_glosa", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_judicial": {"name": "valor_judicial", "description": "Valor de glosa depositada em ju\u00edzo (Autua\u00e7\u00e3o por ar inoperante, Ve\u00edculo licenciado sem ar, Penalidade abaixo de 60% e Notifica\u00e7\u00e3o dos Agentes de Ver\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo_v2/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo_v2", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.580253, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo_v2`.`sumario_faixa_servico_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\nWITH\n  subsidio_faixa AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    viagens_faixa,\n    km_planejada_faixa,\n    pof\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia\") }}\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  subsidio_faixa_agg AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    SUM(km_apurada_faixa) AS km_apurada_faixa,\n    SUM(km_subsidiada_faixa) AS km_subsidiada_faixa,\n    SUM(valor_apurado) AS valor_apurado,\n    SUM(valor_acima_limite) AS valor_acima_limite,\n    SUM(valor_total_sem_glosa) AS valor_total_sem_glosa\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia_tipo_viagem\") }}\n    -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  GROUP BY\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico\n  ),\n  pivot_data AS (\n  SELECT\n    *\n  FROM (\n    SELECT\n      data,\n      tipo_dia,\n      faixa_horaria_inicio,\n      faixa_horaria_fim,\n      consorcio,\n      servico,\n      tipo_viagem,\n      km_apurada_faixa\n    FROM\n      {{ ref(\"subsidio_faixa_servico_dia_tipo_viagem\") }}\n      -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n    WHERE\n      data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n      AND DATE(\"{{ var(\"end_date\") }}\")\n    )\n    PIVOT(SUM(km_apurada_faixa) AS km_apurada FOR tipo_viagem IN (\n      \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\n      \"N\u00e3o licenciado\" AS n_licenciado,\n      \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\n      \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\n      \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\n      \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\n      \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\n      \"N\u00e3o vistoriado\" AS n_vistoriado,\n      \"Sem transa\u00e7\u00e3o\" AS sem_transacao))\n  )\nSELECT\n  s.data,\n  s.tipo_dia,\n  s.faixa_horaria_inicio,\n  s.faixa_horaria_fim,\n  s.consorcio,\n  s.servico,\n  s.viagens_faixa,\n  agg.km_apurada_faixa,\n  agg.km_subsidiada_faixa,\n  s.km_planejada_faixa,\n  s.pof,\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao,\n  agg.valor_apurado,\n  agg.valor_acima_limite,\n  agg.valor_total_sem_glosa,\n  '{{ var(\"version\") }}' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_faixa AS s\nLEFT JOIN\n  subsidio_faixa_agg AS agg\nUSING(data, tipo_dia, faixa_horaria_inicio, faixa_horaria_fim, consorcio, servico)\nLEFT JOIN\n  pivot_data AS pd\nUSING(data, tipo_dia, faixa_horaria_inicio, faixa_horaria_fim, consorcio, servico)", "language": "sql", "refs": [{"name": "subsidio_faixa_servico_dia", "package": null, "version": null}, {"name": "subsidio_faixa_servico_dia_tipo_viagem", "package": null, "version": null}, {"name": "subsidio_faixa_servico_dia_tipo_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo_v2/sumario_faixa_servico_dia.sql", "compiled": true, "compiled_code": "\n\nWITH\n  subsidio_faixa AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    viagens_faixa,\n    km_planejada_faixa,\n    pof\n  FROM\n    `rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  subsidio_faixa_agg AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    SUM(km_apurada_faixa) AS km_apurada_faixa,\n    SUM(km_subsidiada_faixa) AS km_subsidiada_faixa,\n    SUM(valor_apurado) AS valor_apurado,\n    SUM(valor_acima_limite) AS valor_acima_limite,\n    SUM(valor_total_sem_glosa) AS valor_total_sem_glosa\n  FROM\n    `rj-smtr`.`financeiro`.`subsidio_faixa_servico_dia_tipo_viagem`\n    -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  GROUP BY\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico\n  ),\n  pivot_data AS (\n  SELECT\n    *\n  FROM (\n    SELECT\n      data,\n      tipo_dia,\n      faixa_horaria_inicio,\n      faixa_horaria_fim,\n      consorcio,\n      servico,\n      tipo_viagem,\n      km_apurada_faixa\n    FROM\n      `rj-smtr`.`financeiro`.`subsidio_faixa_servico_dia_tipo_viagem`\n      -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n    WHERE\n      data BETWEEN DATE(\"2022-01-01T01:00:00\")\n      AND DATE(\"2022-01-01T01:00:00\")\n    )\n    PIVOT(SUM(km_apurada_faixa) AS km_apurada FOR tipo_viagem IN (\n      \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\n      \"N\u00e3o licenciado\" AS n_licenciado,\n      \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\n      \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\n      \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\n      \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\n      \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\n      \"N\u00e3o vistoriado\" AS n_vistoriado,\n      \"Sem transa\u00e7\u00e3o\" AS sem_transacao))\n  )\nSELECT\n  s.data,\n  s.tipo_dia,\n  s.faixa_horaria_inicio,\n  s.faixa_horaria_fim,\n  s.consorcio,\n  s.servico,\n  s.viagens_faixa,\n  agg.km_apurada_faixa,\n  agg.km_subsidiada_faixa,\n  s.km_planejada_faixa,\n  s.pof,\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao,\n  agg.valor_apurado,\n  agg.valor_acima_limite,\n  agg.valor_total_sem_glosa,\n  '' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_faixa AS s\nLEFT JOIN\n  subsidio_faixa_agg AS agg\nUSING(data, tipo_dia, faixa_horaria_inicio, faixa_horaria_fim, consorcio, servico)\nLEFT JOIN\n  pivot_data AS pd\nUSING(data, tipo_dia, faixa_horaria_inicio, faixa_horaria_fim, consorcio, servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_aux_registros_flag_trajeto_correto": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_aux_registros_flag_trajeto_correto", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_aux_registros_flag_trajeto_correto.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_flag_trajeto_correto.sql", "unique_id": "model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_aux_registros_flag_trajeto_correto"], "alias": "brt_aux_registros_flag_trajeto_correto", "checksum": {"name": "sha256", "checksum": "9e1f8c3bd3d4bdbd438b441ea5661a110efe8a665172cc4f4f1eb3b5fc4db384"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_brt_gps"}, "created_at": 1727709586.4864466, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      {{ ref('brt_aux_registros_filtrada') }} r\n    {% if not flags.FULL_REFRESH -%}\n    WHERE\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif %}\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN {{ var('intervalo_max_desvio_segundos') }} PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM {{ ref('shapes_geom') }}\n      WHERE id_modal_smtr in ({{ var('brt_id_modal_smtr')|join(', ') }})\n      AND data_versao = \"{{var('versao_fixa_sigmob')}}\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT({{ maestro_sha }} AS versao_maestro,\n      --       {{ maestro_bq_sha }} AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "language": "sql", "refs": [{"name": "brt_aux_registros_filtrada", "package": null, "version": null}, {"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_flag_trajeto_correto.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT id_veiculo, servico as linha, latitude, longitude, data, posicao_veiculo_geo, timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada` r\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('20', 'B')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha as servico,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n      -- STRUCT( AS versao_maestro,\n      --        AS versao_maestro_bq,\n      --       data_versao AS data_versao_sigmob\n      --       ) versao\n    FROM\n      intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_registros_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_registros_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_registros_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_registros_desaninhada.sql", "unique_id": "model.rj_smtr.brt_registros_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_registros_desaninhada"], "alias": "brt_registros_desaninhada", "checksum": {"name": "sha256", "checksum": "fdfa40e6535d9a8db5abe26e883325fa0363e5186012ab803683fab33634ea5b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados.", "columns": {"data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura pela SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_brt_gps/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_brt_gps"}, "created_at": 1727709588.5877376, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_registros_desaninhada`", "raw_code": "SELECT\ndata,\nhora,\nid_veiculo,\ntimestamp_gps,\ntimestamp_captura,\nSAFE_CAST(json_value(content,\"$.latitude\") AS FLOAT64) latitude,\nSAFE_CAST(json_value(content,\"$.longitude\") AS FLOAT64) longitude,\njson_value(content,\"$.servico\") servico,\njson_value(content,\"$.sentido\") sentido,\nSAFE_CAST(json_value(content,\"$.velocidade\") AS INT64) velocidade,\nfrom {{ ref('brt_registros') }} as t", "language": "sql", "refs": [{"name": "brt_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.brt_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_registros_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\ndata,\nhora,\nid_veiculo,\ntimestamp_gps,\ntimestamp_captura,\nSAFE_CAST(json_value(content,\"$.latitude\") AS FLOAT64) latitude,\nSAFE_CAST(json_value(content,\"$.longitude\") AS FLOAT64) longitude,\njson_value(content,\"$.servico\") servico,\njson_value(content,\"$.sentido\") sentido,\nSAFE_CAST(json_value(content,\"$.velocidade\") AS INT64) velocidade,\nfrom `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_registros` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_aux_registros_parada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_aux_registros_parada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_aux_registros_parada.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_parada.sql", "unique_id": "model.rj_smtr.brt_aux_registros_parada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_aux_registros_parada"], "alias": "brt_aux_registros_parada", "checksum": {"name": "sha256", "checksum": "3489915b8e765d802af4cbda1d5796c42ac6e51286ebd47dbc24ab26e34781e4"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_brt_gps"}, "created_at": 1727709586.4972484, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from {{ var('brt_terminais') }}\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM {{ var('polygon_garagem') }}\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        {{ ref('brt_aux_registros_filtrada') }}\n      {% if not flags.FULL_REFRESH -%}\n      WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n      {% endif %}\n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < {{ var('distancia_limiar_parada') }} then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "language": "sql", "refs": [{"name": "brt_aux_registros_filtrada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.brt_aux_registros_filtrada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_parada.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_estacao nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.estacoes_e_terminais_brt\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      servico,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, servico ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT *\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n      WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n    ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  servico,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  'nao_identificado' (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_registros": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_registros", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_registros.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_registros.sql", "unique_id": "model.rj_smtr.brt_registros", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_registros"], "alias": "brt_registros", "checksum": {"name": "sha256", "checksum": "d100761753b61ea9b4e17adc45e175a74374955114e33e890d1934f40e57521f"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com tratamento b\u00e1sico e convers\u00e3o de valores", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura pela SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "content": {"name": "content", "description": "Dados brutos capturados aninhados em formato JSON", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_brt_gps/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_brt_gps"}, "created_at": 1727709588.5869815, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_registros`", "raw_code": "SELECT\n    SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_gps), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_gps,\n    SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n    REPLACE(content,\"None\",\"\") content,\n    data,\n    hora\nfrom\n    {{var('brt_registros_staging')}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_registros.sql", "compiled": true, "compiled_code": "SELECT\n    SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_gps), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_gps,\n    SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n    REPLACE(content,\"None\",\"\") content,\n    data,\n    hora\nfrom\n    rj-smtr-staging.br_rj_riodejaneiro_brt_gps_staging.registros as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_aux_registros_velocidade": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_aux_registros_velocidade", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_aux_registros_velocidade.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_velocidade.sql", "unique_id": "model.rj_smtr.brt_aux_registros_velocidade", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_aux_registros_velocidade"], "alias": "brt_aux_registros_velocidade", "checksum": {"name": "sha256", "checksum": "d33f717c88610f80f70642edfc7c51b9ab0e9207e7a91777e7114a45028c1f59"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_brt_gps"}, "created_at": 1727709586.5082672, "relation_name": null, "raw_code": "{{\n    config(\n        materialized='ephemeral'\n    )\n}}\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  {{ ref('brt_aux_registros_filtrada') }}\n    {% if not flags.FULL_REFRESH -%}\n    WHERE\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {% endif %}\n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN {{ var('janela_movel_velocidade') }} PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > {{ var('velocidade_maxima') }}\n            THEN {{ var('velocidade_maxima') }}\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < {{ var('velocidade_limiar_parado') }} then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT({{ maestro_sha }} AS versao_maestro, {{ maestro_bq_sha }} AS versao_maestro_bq) versao\nFROM medias", "language": "sql", "refs": [{"name": "brt_aux_registros_filtrada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.brt_aux_registros_filtrada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_velocidade.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, servico\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`\n    WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n    \n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        servico,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, servico\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    servico,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\n    -- STRUCT( AS versao_maestro,  AS versao_maestro_bq) versao\nFROM medias", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.brt_aux_registros_filtrada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_brt_gps", "name": "brt_aux_registros_filtrada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_brt_gps/brt_aux_registros_filtrada.sql", "original_file_path": "models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_filtrada.sql", "unique_id": "model.rj_smtr.brt_aux_registros_filtrada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_brt_gps", "brt_aux_registros_filtrada"], "alias": "brt_aux_registros_filtrada", "checksum": {"name": "sha256", "checksum": "f2216c72b0108607d5e9655e86afd84ae74be5cc975de6278fd2f7142ebe90e4"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_brt_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela auxiliar no tratamento do GPS do BRT. Remove registros fora do munic\u00edpio do Rio de Janeiro e registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "posicao_veiculo_geo": {"name": "posicao_veiculo_geo", "description": "Coordenada geogr\u00e1fica (POINT) com a posi\u00e7\u00e3o que o ve\u00edculo se encontra, conforme 'longitude' e 'latitude' informadas pelo GPS (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura pela SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_brt_gps/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_brt_gps", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.5860548, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_aux_registros_filtrada`", "raw_code": "{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      }\n  )\n}}\n/*\n- Descri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior\n   que 1 minuto entre o timestamp_captura e timestamp_gps.\n2. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do\n   munic\u00edpio de Rio de Janeiro.\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\t{{ var('limites_caixa') }}),\ngps AS (\n  /* 1. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior\n   que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    {{ ref('brt_registros_desaninhada') }}\n  {% if is_incremental() -%}\n  WHERE\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <= \"{{var('date_range_end')}}\"\n    AND DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) BETWEEN 0 AND 1\n  {%- endif %}\n    ),\nfiltrada AS (\n  /* 2. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do\n   munic\u00edpio de Rio de Janeiro.*/\n  SELECT\n    id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    servico,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by id_veiculo, timestamp_gps, servico) rn\n  FROM\n    gps\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "language": "sql", "refs": [{"name": "brt_registros_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.brt_registros_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_brt_gps/brt_aux_registros_filtrada.sql", "compiled": true, "compiled_code": "\n/*\n- Descri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior\n   que 1 minuto entre o timestamp_captura e timestamp_gps.\n2. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do\n   munic\u00edpio de Rio de Janeiro.\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\trj-smtr.br_rj_riodejaneiro_geo.limites_geograficos_caixa),\ngps AS (\n  /* 1. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior\n   que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_brt_gps`.`brt_registros_desaninhada`\n  WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <= \"2022-01-01T01:00:00\"\n    AND DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) BETWEEN 0 AND 1\n    ),\nfiltrada AS (\n  /* 2. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do\n   munic\u00edpio de Rio de Janeiro.*/\n  SELECT\n    id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    servico,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by id_veiculo, timestamp_gps, servico) rn\n  FROM\n    gps\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagem_transacao": {"database": "rj-smtr", "schema": "subsidio", "name": "viagem_transacao", "resource_type": "model", "package_name": "rj_smtr", "path": "subsidio/viagem_transacao.sql", "original_file_path": "models/subsidio/viagem_transacao.sql", "unique_id": "model.rj_smtr.viagem_transacao", "fqn": ["rj_smtr", "subsidio", "viagem_transacao"], "alias": "viagem_transacao", "checksum": {"name": "sha256", "checksum": "f97c246e87c5ac88a137cc3a97d0d1f8d40ef513571870dd9cf730c6590086e6"}, "config": {"enabled": true, "alias": null, "schema": "subsidio", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com quantidade de transa\u00e7\u00f5es por viagem.", "columns": {"data": {"name": "data", "description": "Data da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo \u00fanico identificador da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Classifica\u00e7\u00e3o do tipo de viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao": {"name": "quantidade_transacao", "description": "Quantidade de transa\u00e7\u00f5es da Ja\u00e9 registradas entre datetime_partida_bilhetagem e datetime_chegada.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_riocard": {"name": "quantidade_transacao_riocard", "description": "Quantidade de transa\u00e7\u00f5es da RioCard registradas entre datetime_partida_bilhetagem e datetime_chegada.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_estado_equipamento_aberto": {"name": "indicador_estado_equipamento_aberto", "description": "Indicador se todos os registros de GPS foram transmitidos com o estado ABERTO entre datetime_partida e datetime_chegada.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida_bilhetagem": {"name": "datetime_partida_bilhetagem", "description": "Hor\u00e1rio de in\u00edcio da viagem para contagem das transa\u00e7\u00f5es, considerando uma toler\u00e2ncia de at\u00e9 30 minutos do \u00ednicio da viagem, limitada pelo encerramento da viagem anterior realizada pelo mesmo ve\u00edculo, com adi\u00e7\u00e3o de 1 segundo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/subsidio/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "subsidio", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.5924199, "relation_name": "`rj-smtr`.`subsidio`.`viagem_transacao`", "raw_code": "{{\n    config(\n        materialized=\"incremental\",\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n        incremental_strategy=\"insert_overwrite\",\n    )\n}}\n\nWITH\n  -- 1. Transa\u00e7\u00f5es Ja\u00e9\n  transacao AS (\n    SELECT\n      id_veiculo,\n      datetime_transacao\n    FROM\n      {{ ref(\"transacao\") }}\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao\n    WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE_ADD(DATE(\"{{ var(\"end_date\") }}\"), INTERVAL 1 DAY)\n  ),\n  -- 2. Transa\u00e7\u00f5es RioCard\n  transacao_riocard AS (\n    SELECT\n      id_veiculo,\n      datetime_transacao\n    FROM\n      {{ ref(\"transacao_riocard\") }}\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao_riocard\n    WHERE\n      data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n      AND DATE_ADD(DATE(\"{{ var(\"end_date\") }}\"), INTERVAL 1 DAY)\n  ),\n  -- 3. GPS Validador\n  gps_validador AS (\n    SELECT\n      data,\n      datetime_gps,\n      id_veiculo,\n      id_validador,\n      estado_equipamento,\n      latitude,\n      longitude\n    FROM\n      {{ ref(\"gps_validador\") }}\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.gps_validador\n    WHERE\n      data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n      AND DATE_ADD(DATE(\"{{ var(\"end_date\") }}\"), INTERVAL 1 DAY)\n      AND (latitude != 0 OR longitude != 0)\n  ),\n  -- 4. Viagens realizadas\n  viagem AS (\n  SELECT\n    data,\n    servico_realizado AS servico,\n    datetime_partida,\n    datetime_chegada,\n    id_veiculo,\n    id_viagem,\n    distancia_planejada\n FROM\n    {{ ref(\"viagem_completa\") }}\n    -- rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE( \"{{ var(\"end_date\") }}\" ) ),\n  -- 5. Status dos ve\u00edculos\n  veiculos AS (\n  SELECT\n    data,\n    id_veiculo,\n    status\n  FROM\n    {{ ref(\"sppo_veiculo_dia\") }}\n    -- rj-smtr.veiculo.sppo_veiculo_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\") ),\n  -- 6. Viagem, para fins de contagem de passageiros, com toler\u00e2ncia de 30 minutos, limitada pela viagem anterior\n  viagem_com_tolerancia AS (\n    SELECT\n      v.*,\n      LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida) AS viagem_anterior_chegada,\n      CASE\n        WHEN LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida) IS NULL THEN\n          DATETIME(TIMESTAMP_SUB(datetime_partida, INTERVAL 30 MINUTE))\n        ELSE\n          DATETIME(TIMESTAMP_ADD(GREATEST(\n            TIMESTAMP_SUB(datetime_partida, INTERVAL 30 MINUTE),\n            LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida)\n          ), INTERVAL 1 SECOND))\n      END AS datetime_partida_com_tolerancia\n    FROM\n      viagem AS v\n  ),\n  -- 7. Contagem de transa\u00e7\u00f5es Ja\u00e9\n  transacao_contagem AS (\n    SELECT\n      v.data,\n      v.id_viagem,\n      COUNT(t.datetime_transacao) AS quantidade_transacao\n    FROM\n      transacao AS t\n    JOIN\n      viagem_com_tolerancia AS v\n    ON\n      t.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND t.datetime_transacao BETWEEN v.datetime_partida_com_tolerancia AND v.datetime_chegada\n    GROUP BY\n      v.data, v.id_viagem\n  ),\n  -- 5. Contagem de transa\u00e7\u00f5es RioCard\n  transacao_riocard_contagem AS (\n    SELECT\n      v.data,\n      v.id_viagem,\n      COUNT(tr.datetime_transacao) AS quantidade_transacao_riocard\n    FROM\n      transacao_riocard AS tr\n    JOIN\n      viagem_com_tolerancia AS v\n    ON\n      tr.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND tr.datetime_transacao BETWEEN v.datetime_partida_com_tolerancia AND v.datetime_chegada\n    GROUP BY\n      v.data, v.id_viagem\n  ),\n  -- 6. Ajusta estado do equipamento\n  -- Agrupa mesma posi\u00e7\u00e3o para mesmo validador e ve\u00edculo, mantendo preferencialmente o estado do equipamento \"ABERTO\"\n  estado_equipamento_aux AS (\n    SELECT\n      data,\n      id_validador,\n      id_veiculo,\n      latitude,\n      longitude,\n      IF(COUNT(CASE WHEN estado_equipamento = \"ABERTO\" THEN 1 END) >= 1, \"ABERTO\", \"FECHADO\") AS estado_equipamento,\n      MIN(datetime_gps) AS datetime_gps,\n    FROM\n      gps_validador\n    GROUP BY\n      1,\n      2,\n      3,\n      4,\n      5\n  ),\n  -- 7. Relacionamento entre estado do equipamento e viagem\n  gps_validador_viagem AS (\n    SELECT\n      v.data,\n      e.datetime_gps,\n      v.id_viagem,\n      e.id_validador,\n      e.estado_equipamento,\n      e.latitude,\n      e.longitude\n    FROM\n      estado_equipamento_aux AS e\n    JOIN\n      viagem AS v\n    ON\n      e.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND e.datetime_gps BETWEEN v.datetime_partida AND v.datetime_chegada\n  ),\n  -- 8. Calcula a porcentagem de estado do equipamento \"ABERTO\" por validador e viagem\n  estado_equipamento_perc AS (\n    SELECT\n      data,\n      id_viagem,\n      id_validador,\n      COUNTIF(estado_equipamento = \"ABERTO\") / COUNT(*) AS percentual_estado_equipamento_aberto\n    FROM\n      gps_validador_viagem\n    GROUP BY\n      1,\n      2,\n      3\n  ),\n  -- 9. Considera o validador com maior porcentagem de estado do equipamento \"ABERTO\" por viagem\n  estado_equipamento_max_perc AS (\n    SELECT\n      data,\n      id_viagem,\n      MAX_BY(id_validador, percentual_estado_equipamento_aberto) AS id_validador,\n      MAX(percentual_estado_equipamento_aberto) AS percentual_estado_equipamento_aberto\n    FROM\n      estado_equipamento_perc\n    GROUP BY\n      1,\n      2\n  ),\n  -- 10. Verifica se a viagem possui estado do equipamento \"ABERTO\" em pelo menos 80% dos registros\n  estado_equipamento_verificacao AS (\n    SELECT\n      data,\n      id_viagem,\n      id_validador,\n      percentual_estado_equipamento_aberto,\n      IF(percentual_estado_equipamento_aberto >= 0.8 OR percentual_estado_equipamento_aberto IS NULL, TRUE, FALSE) AS indicador_estado_equipamento_aberto\n    FROM\n      viagem\n    LEFT JOIN\n      estado_equipamento_max_perc\n    USING\n      (data, id_viagem)\n  )\nSELECT\n  v.data,\n  v.id_viagem,\n  v.id_veiculo,\n  v.servico,\n  eev.id_validador,\n  CASE\n    WHEN v.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V8_INICIO\") }}\")\n      AND (COALESCE(tr.quantidade_transacao_riocard, 0) = 0\n        OR COALESCE(eev.indicador_estado_equipamento_aberto, FALSE) = FALSE)\n      AND ve.status IN (\"Licenciado com ar e n\u00e3o autuado\", \"Licenciado sem ar e n\u00e3o autuado\")\n      THEN \"Sem transa\u00e7\u00e3o\"\n    ELSE ve.status\n  END AS tipo_viagem,\n  v.distancia_planejada,\n  COALESCE(t.quantidade_transacao, 0) AS quantidade_transacao,\n  COALESCE(tr.quantidade_transacao_riocard, 0) AS quantidade_transacao_riocard,\n  eev.percentual_estado_equipamento_aberto,\n  eev.indicador_estado_equipamento_aberto,\n  v.datetime_partida_com_tolerancia AS datetime_partida_bilhetagem,\n  v.datetime_partida,\n  v.datetime_chegada,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") AS datetime_ultima_atualizacao\nFROM\n  viagem_com_tolerancia AS v\nLEFT JOIN\n  veiculos AS ve\nUSING\n  (data, id_veiculo)\nLEFT JOIN\n  transacao_contagem AS t\nUSING\n  (data, id_viagem)\nLEFT JOIN\n  transacao_riocard_contagem AS tr\nUSING\n  (data, id_viagem)\nLEFT JOIN\n  estado_equipamento_verificacao AS eev\nUSING\n  (data, id_viagem)", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "transacao_riocard", "package": null, "version": null}, {"name": "gps_validador", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}, {"name": "sppo_veiculo_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard", "model.rj_smtr.gps_validador", "model.rj_smtr.viagem_completa", "model.rj_smtr.sppo_veiculo_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/subsidio/viagem_transacao.sql", "compiled": true, "compiled_code": "\n\nWITH\n  -- 1. Transa\u00e7\u00f5es Ja\u00e9\n  transacao AS (\n    SELECT\n      id_veiculo,\n      datetime_transacao\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao\n    WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE_ADD(DATE(\"2022-01-01T01:00:00\"), INTERVAL 1 DAY)\n  ),\n  -- 2. Transa\u00e7\u00f5es RioCard\n  transacao_riocard AS (\n    SELECT\n      id_veiculo,\n      datetime_transacao\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao_riocard`\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao_riocard\n    WHERE\n      data BETWEEN DATE(\"2022-01-01T01:00:00\")\n      AND DATE_ADD(DATE(\"2022-01-01T01:00:00\"), INTERVAL 1 DAY)\n  ),\n  -- 3. GPS Validador\n  gps_validador AS (\n    SELECT\n      data,\n      datetime_gps,\n      id_veiculo,\n      id_validador,\n      estado_equipamento,\n      latitude,\n      longitude\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`\n      -- rj-smtr.br_rj_riodejaneiro_bilhetagem.gps_validador\n    WHERE\n      data BETWEEN DATE(\"2022-01-01T01:00:00\")\n      AND DATE_ADD(DATE(\"2022-01-01T01:00:00\"), INTERVAL 1 DAY)\n      AND (latitude != 0 OR longitude != 0)\n  ),\n  -- 4. Viagens realizadas\n  viagem AS (\n  SELECT\n    data,\n    servico_realizado AS servico,\n    datetime_partida,\n    datetime_chegada,\n    id_veiculo,\n    id_viagem,\n    distancia_planejada\n FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    -- rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" ) ),\n  -- 5. Status dos ve\u00edculos\n  veiculos AS (\n  SELECT\n    data,\n    id_veiculo,\n    status\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_veiculo_dia`\n    -- rj-smtr.veiculo.sppo_veiculo_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\") ),\n  -- 6. Viagem, para fins de contagem de passageiros, com toler\u00e2ncia de 30 minutos, limitada pela viagem anterior\n  viagem_com_tolerancia AS (\n    SELECT\n      v.*,\n      LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida) AS viagem_anterior_chegada,\n      CASE\n        WHEN LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida) IS NULL THEN\n          DATETIME(TIMESTAMP_SUB(datetime_partida, INTERVAL 30 MINUTE))\n        ELSE\n          DATETIME(TIMESTAMP_ADD(GREATEST(\n            TIMESTAMP_SUB(datetime_partida, INTERVAL 30 MINUTE),\n            LAG(v.datetime_chegada) OVER (PARTITION BY v.id_veiculo ORDER BY v.datetime_partida)\n          ), INTERVAL 1 SECOND))\n      END AS datetime_partida_com_tolerancia\n    FROM\n      viagem AS v\n  ),\n  -- 7. Contagem de transa\u00e7\u00f5es Ja\u00e9\n  transacao_contagem AS (\n    SELECT\n      v.data,\n      v.id_viagem,\n      COUNT(t.datetime_transacao) AS quantidade_transacao\n    FROM\n      transacao AS t\n    JOIN\n      viagem_com_tolerancia AS v\n    ON\n      t.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND t.datetime_transacao BETWEEN v.datetime_partida_com_tolerancia AND v.datetime_chegada\n    GROUP BY\n      v.data, v.id_viagem\n  ),\n  -- 5. Contagem de transa\u00e7\u00f5es RioCard\n  transacao_riocard_contagem AS (\n    SELECT\n      v.data,\n      v.id_viagem,\n      COUNT(tr.datetime_transacao) AS quantidade_transacao_riocard\n    FROM\n      transacao_riocard AS tr\n    JOIN\n      viagem_com_tolerancia AS v\n    ON\n      tr.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND tr.datetime_transacao BETWEEN v.datetime_partida_com_tolerancia AND v.datetime_chegada\n    GROUP BY\n      v.data, v.id_viagem\n  ),\n  -- 6. Ajusta estado do equipamento\n  -- Agrupa mesma posi\u00e7\u00e3o para mesmo validador e ve\u00edculo, mantendo preferencialmente o estado do equipamento \"ABERTO\"\n  estado_equipamento_aux AS (\n    SELECT\n      data,\n      id_validador,\n      id_veiculo,\n      latitude,\n      longitude,\n      IF(COUNT(CASE WHEN estado_equipamento = \"ABERTO\" THEN 1 END) >= 1, \"ABERTO\", \"FECHADO\") AS estado_equipamento,\n      MIN(datetime_gps) AS datetime_gps,\n    FROM\n      gps_validador\n    GROUP BY\n      1,\n      2,\n      3,\n      4,\n      5\n  ),\n  -- 7. Relacionamento entre estado do equipamento e viagem\n  gps_validador_viagem AS (\n    SELECT\n      v.data,\n      e.datetime_gps,\n      v.id_viagem,\n      e.id_validador,\n      e.estado_equipamento,\n      e.latitude,\n      e.longitude\n    FROM\n      estado_equipamento_aux AS e\n    JOIN\n      viagem AS v\n    ON\n      e.id_veiculo = SUBSTR(v.id_veiculo, 2)\n      AND e.datetime_gps BETWEEN v.datetime_partida AND v.datetime_chegada\n  ),\n  -- 8. Calcula a porcentagem de estado do equipamento \"ABERTO\" por validador e viagem\n  estado_equipamento_perc AS (\n    SELECT\n      data,\n      id_viagem,\n      id_validador,\n      COUNTIF(estado_equipamento = \"ABERTO\") / COUNT(*) AS percentual_estado_equipamento_aberto\n    FROM\n      gps_validador_viagem\n    GROUP BY\n      1,\n      2,\n      3\n  ),\n  -- 9. Considera o validador com maior porcentagem de estado do equipamento \"ABERTO\" por viagem\n  estado_equipamento_max_perc AS (\n    SELECT\n      data,\n      id_viagem,\n      MAX_BY(id_validador, percentual_estado_equipamento_aberto) AS id_validador,\n      MAX(percentual_estado_equipamento_aberto) AS percentual_estado_equipamento_aberto\n    FROM\n      estado_equipamento_perc\n    GROUP BY\n      1,\n      2\n  ),\n  -- 10. Verifica se a viagem possui estado do equipamento \"ABERTO\" em pelo menos 80% dos registros\n  estado_equipamento_verificacao AS (\n    SELECT\n      data,\n      id_viagem,\n      id_validador,\n      percentual_estado_equipamento_aberto,\n      IF(percentual_estado_equipamento_aberto >= 0.8 OR percentual_estado_equipamento_aberto IS NULL, TRUE, FALSE) AS indicador_estado_equipamento_aberto\n    FROM\n      viagem\n    LEFT JOIN\n      estado_equipamento_max_perc\n    USING\n      (data, id_viagem)\n  )\nSELECT\n  v.data,\n  v.id_viagem,\n  v.id_veiculo,\n  v.servico,\n  eev.id_validador,\n  CASE\n    WHEN v.data >= DATE(\"2024-07-19\")\n      AND (COALESCE(tr.quantidade_transacao_riocard, 0) = 0\n        OR COALESCE(eev.indicador_estado_equipamento_aberto, FALSE) = FALSE)\n      AND ve.status IN (\"Licenciado com ar e n\u00e3o autuado\", \"Licenciado sem ar e n\u00e3o autuado\")\n      THEN \"Sem transa\u00e7\u00e3o\"\n    ELSE ve.status\n  END AS tipo_viagem,\n  v.distancia_planejada,\n  COALESCE(t.quantidade_transacao, 0) AS quantidade_transacao,\n  COALESCE(tr.quantidade_transacao_riocard, 0) AS quantidade_transacao_riocard,\n  eev.percentual_estado_equipamento_aberto,\n  eev.indicador_estado_equipamento_aberto,\n  v.datetime_partida_com_tolerancia AS datetime_partida_bilhetagem,\n  v.datetime_partida,\n  v.datetime_chegada,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") AS datetime_ultima_atualizacao\nFROM\n  viagem_com_tolerancia AS v\nLEFT JOIN\n  veiculos AS ve\nUSING\n  (data, id_veiculo)\nLEFT JOIN\n  transacao_contagem AS t\nUSING\n  (data, id_viagem)\nLEFT JOIN\n  transacao_riocard_contagem AS tr\nUSING\n  (data, id_viagem)\nLEFT JOIN\n  estado_equipamento_verificacao AS eev\nUSING\n  (data, id_viagem)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_agregado_vlt": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_implantacao_jae", "name": "gps_agregado_vlt", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_implantacao_jae/gps_agregado_vlt.sql", "original_file_path": "models/dashboard_bilhetagem_implantacao_jae/gps_agregado_vlt.sql", "unique_id": "model.rj_smtr.gps_agregado_vlt", "fqn": ["rj_smtr", "dashboard_bilhetagem_implantacao_jae", "gps_agregado_vlt"], "alias": "gps_agregado_vlt", "checksum": {"name": "sha256", "checksum": "0cce7e66ccd38a2444f3eec6d03997f38c80a34df822b42a57819760f8661a3a"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_implantacao_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com registros agregados de GPS das VLTs utilizada no dashboard de acompanhamento da implanta\u00e7\u00e3o dos validadores da Ja\u00e9 (Contem apenas dados do dia atual)", "columns": {"servico": {"name": "servico", "description": "Nome curto da linha operada com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Estado do validador da Ja\u00e9 (ABERTO ou FECHADO)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "primeiro_datetime_gps": {"name": "primeiro_datetime_gps", "description": "Data e hora do primeiro sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ultimo_datetime_gps": {"name": "ultimo_datetime_gps", "description": "Data e hora do \u00faltimo sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_entre_a_prim_e_ultima_transmissao": {"name": "qtde_min_entre_a_prim_e_ultima_transmissao", "description": "Quantidade em minutos entre a primeira e a ultima transmiss\u00e3o do GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_distintos_houve_transmissao": {"name": "qtde_min_distintos_houve_transmissao", "description": "Quantidade de minutos distintos em que foram recebidas transmiss\u00f5es de GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps": {"name": "qtde_registros_gps", "description": "Quantidade de sinais transmitidos pelo GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps_georreferenciados": {"name": "qtde_registros_gps_georreferenciados", "description": "Quantidade de sinais transmitidos pelo validador da Ja\u00e9 com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_registros_gps_georreferenciados": {"name": "percentual_registros_gps_georreferenciados", "description": "Percentual de sinais transmitidos pelo validador da Ja\u00e9  com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_transmissao_a_cada_min": {"name": "percentual_transmissao_a_cada_min", "description": "Percentual de minutos em que houve sinal de GPS recebido durante o tempo em que o validador da Ja\u00e9 ficou ativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_implantacao_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "dashboard_bilhetagem_implantacao_jae"}, "created_at": 1727709588.5986803, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_implantacao_jae`.`gps_agregado_vlt`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        servico_jae AS servico,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY servico_jae, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY servico_jae, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                {{ ref(\"gps_validador\") }}\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"VLT\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    servico,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "gps_validador", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.gps_validador"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_implantacao_jae/gps_agregado_vlt.sql", "compiled": true, "compiled_code": "\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        servico_jae AS servico,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY servico_jae, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY servico_jae, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"VLT\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    servico,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_agregado_brt": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_implantacao_jae", "name": "gps_agregado_brt", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_implantacao_jae/gps_agregado_brt.sql", "original_file_path": "models/dashboard_bilhetagem_implantacao_jae/gps_agregado_brt.sql", "unique_id": "model.rj_smtr.gps_agregado_brt", "fqn": ["rj_smtr", "dashboard_bilhetagem_implantacao_jae", "gps_agregado_brt"], "alias": "gps_agregado_brt", "checksum": {"name": "sha256", "checksum": "7dd13db4b84957300c4b0009d56e4c03b3cc4356da9ff2fadd4a7f85bfcc923d"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_implantacao_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com registros de GPS do BRT utilizada no dashboard de acompanhamento da implanta\u00e7\u00e3o dos validadores da Ja\u00e9 (Contem apenas dados do dia atual)", "columns": {"servico": {"name": "servico", "description": "Nome curto da linha operada com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Estado do validador da Ja\u00e9 (ABERTO ou FECHADO)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "primeiro_datetime_gps": {"name": "primeiro_datetime_gps", "description": "Data e hora do primeiro sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ultimo_datetime_gps": {"name": "ultimo_datetime_gps", "description": "Data e hora do \u00faltimo sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_entre_a_prim_e_ultima_transmissao": {"name": "qtde_min_entre_a_prim_e_ultima_transmissao", "description": "Quantidade em minutos entre a primeira e a ultima transmiss\u00e3o do GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_distintos_houve_transmissao": {"name": "qtde_min_distintos_houve_transmissao", "description": "Quantidade de minutos distintos em que foram recebidas transmiss\u00f5es de GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps": {"name": "qtde_registros_gps", "description": "Quantidade de sinais transmitidos pelo GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps_georreferenciados": {"name": "qtde_registros_gps_georreferenciados", "description": "Quantidade de sinais transmitidos pelo validador da Ja\u00e9 com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_registros_gps_georreferenciados": {"name": "percentual_registros_gps_georreferenciados", "description": "Percentual de sinais transmitidos pelo validador da Ja\u00e9  com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_transmissao_a_cada_min": {"name": "percentual_transmissao_a_cada_min", "description": "Percentual de minutos em que houve sinal de GPS recebido durante o tempo em que o validador da Ja\u00e9 ficou ativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_implantacao_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "dashboard_bilhetagem_implantacao_jae"}, "created_at": 1727709588.5958152, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_implantacao_jae`.`gps_agregado_brt`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        servico_jae AS servico,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY servico_jae, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY servico_jae, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                {{ ref(\"gps_validador\") }}\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"BRT\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    servico,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "gps_validador", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.gps_validador"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_implantacao_jae/gps_agregado_brt.sql", "compiled": true, "compiled_code": "\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        servico_jae AS servico,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY servico_jae, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY servico_jae, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY servico_jae, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY servico_jae, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"BRT\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    servico,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_agregado_onibus": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_implantacao_jae", "name": "gps_agregado_onibus", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_implantacao_jae/gps_agregado_onibus.sql", "original_file_path": "models/dashboard_bilhetagem_implantacao_jae/gps_agregado_onibus.sql", "unique_id": "model.rj_smtr.gps_agregado_onibus", "fqn": ["rj_smtr", "dashboard_bilhetagem_implantacao_jae", "gps_agregado_onibus"], "alias": "gps_agregado_onibus", "checksum": {"name": "sha256", "checksum": "0209cbd7bd39ec61c341a7cdaaaeaf9634df43a8cea4746b1310f98f5c8fa162"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_implantacao_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com registros de GPS dos \u00f4nibus utilizada no dashboard de acompanhamento da implanta\u00e7\u00e3o dos validadores da Ja\u00e9 (Contem apenas dados do dia atual)", "columns": {"operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Estado do validador da Ja\u00e9 (ABERTO ou FECHADO)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "primeiro_datetime_gps": {"name": "primeiro_datetime_gps", "description": "Data e hora do primeiro sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ultimo_datetime_gps": {"name": "ultimo_datetime_gps", "description": "Data e hora do \u00faltimo sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_entre_a_prim_e_ultima_transmissao": {"name": "qtde_min_entre_a_prim_e_ultima_transmissao", "description": "Quantidade em minutos entre a primeira e a ultima transmiss\u00e3o do GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_distintos_houve_transmissao": {"name": "qtde_min_distintos_houve_transmissao", "description": "Quantidade de minutos distintos em que foram recebidas transmiss\u00f5es de GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps": {"name": "qtde_registros_gps", "description": "Quantidade de sinais transmitidos pelo GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps_georreferenciados": {"name": "qtde_registros_gps_georreferenciados", "description": "Quantidade de sinais transmitidos pelo validador da Ja\u00e9 com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_registros_gps_georreferenciados": {"name": "percentual_registros_gps_georreferenciados", "description": "Percentual de sinais transmitidos pelo validador da Ja\u00e9  com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_transmissao_a_cada_min": {"name": "percentual_transmissao_a_cada_min", "description": "Percentual de minutos em que houve sinal de GPS recebido durante o tempo em que o validador da Ja\u00e9 ficou ativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_implantacao_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "dashboard_bilhetagem_implantacao_jae"}, "created_at": 1727709588.596983, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_implantacao_jae`.`gps_agregado_onibus`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        operadora,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY operadora, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY operadora, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY operadora, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY operadora, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY operadora, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY operadora, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                {{ ref(\"gps_validador\") }}\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"\u00d4nibus\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    operadora,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "gps_validador", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.gps_validador"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_implantacao_jae/gps_agregado_onibus.sql", "compiled": true, "compiled_code": "\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        operadora,\n        id_validador,\n        latitude,\n        longitude,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY operadora, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY operadora, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY operadora, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY operadora, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY operadora, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY operadora, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador`\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n                AND modo = \"\u00d4nibus\"\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    operadora,\n    id_validador,\n    latitude,\n    longitude,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_agregado_van": {"database": "rj-smtr", "schema": "dashboard_bilhetagem_implantacao_jae", "name": "gps_agregado_van", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_bilhetagem_implantacao_jae/gps_agregado_van.sql", "original_file_path": "models/dashboard_bilhetagem_implantacao_jae/gps_agregado_van.sql", "unique_id": "model.rj_smtr.gps_agregado_van", "fqn": ["rj_smtr", "dashboard_bilhetagem_implantacao_jae", "gps_agregado_van"], "alias": "gps_agregado_van", "checksum": {"name": "sha256", "checksum": "b781703d3d32028a782d3aa389afcf5751863842a91b0227ef0fef3060bf0d0f"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_bilhetagem_implantacao_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com registros de GPS das Vans utilizada no dashboard de acompanhamento da implanta\u00e7\u00e3o dos validadores da Ja\u00e9 (Contem apenas dados do dia atual)", "columns": {"id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_validador": {"name": "id_validador", "description": "N\u00famero de s\u00e9rie do validador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "estado_equipamento": {"name": "estado_equipamento", "description": "Estado do validador da Ja\u00e9 (ABERTO ou FECHADO)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "primeiro_datetime_gps": {"name": "primeiro_datetime_gps", "description": "Data e hora do primeiro sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ultimo_datetime_gps": {"name": "ultimo_datetime_gps", "description": "Data e hora do \u00faltimo sinal de GPS transmitido pelo validador da Ja\u00e9 em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_entre_a_prim_e_ultima_transmissao": {"name": "qtde_min_entre_a_prim_e_ultima_transmissao", "description": "Quantidade em minutos entre a primeira e a ultima transmiss\u00e3o do GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_min_distintos_houve_transmissao": {"name": "qtde_min_distintos_houve_transmissao", "description": "Quantidade de minutos distintos em que foram recebidas transmiss\u00f5es de GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps": {"name": "qtde_registros_gps", "description": "Quantidade de sinais transmitidos pelo GPS do validador da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtde_registros_gps_georreferenciados": {"name": "qtde_registros_gps_georreferenciados", "description": "Quantidade de sinais transmitidos pelo validador da Ja\u00e9 com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_registros_gps_georreferenciados": {"name": "percentual_registros_gps_georreferenciados", "description": "Percentual de sinais transmitidos pelo validador da Ja\u00e9  com latitude e longitude n\u00e3o nulos ou diferentes de zero", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "percentual_transmissao_a_cada_min": {"name": "percentual_transmissao_a_cada_min", "description": "Percentual de minutos em que houve sinal de GPS recebido durante o tempo em que o validador da Ja\u00e9 ficou ativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_bilhetagem_implantacao_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "dashboard_bilhetagem_implantacao_jae"}, "created_at": 1727709588.597806, "relation_name": "`rj-smtr`.`dashboard_bilhetagem_implantacao_jae`.`gps_agregado_van`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        id_operadora,\n        id_validador,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY id_operadora, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY id_operadora, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY id_operadora, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY id_operadora, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY id_operadora, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY id_operadora, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                {{ ref(\"gps_validador_van\") }}\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    id_operadora,\n    id_validador,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "gps_validador_van", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.gps_validador_van"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_bilhetagem_implantacao_jae/gps_agregado_van.sql", "compiled": true, "compiled_code": "\n\nWITH gps_agregado AS (\n    SELECT\n        data,\n        id_operadora,\n        id_validador,\n        estado_equipamento,\n        primeiro_datetime_gps,\n        ultimo_datetime_gps,\n        TIMESTAMP_DIFF(\n            ultimo_datetime_gps,\n            primeiro_datetime_gps,\n            MINUTE\n        ) + 1 AS qtde_min_entre_a_prim_e_ultima_transmissao,\n        COUNT(*) OVER (PARTITION BY id_operadora, id_validador) AS qtde_registros_gps,\n        COUNT(DISTINCT FORMAT_TIMESTAMP(\"%F %H:%M\", datetime_gps)) OVER (PARTITION BY id_operadora, id_validador) AS qtde_min_distintos_houve_transmissao,\n        SUM(\n            CASE\n                WHEN latitude != 0 AND longitude != 0 AND latitude IS NOT NULL AND longitude IS NOT NULL THEN 1\n                ELSE 0 END\n        ) OVER (PARTITION BY id_operadora, id_validador) AS qtde_registros_gps_georreferenciados,\n        ROW_NUMBER() OVER (PARTITION BY id_operadora, id_validador ORDER BY datetime_gps) AS rn\n    FROM\n        (\n            SELECT\n                *,\n                MIN(datetime_gps) OVER (PARTITION BY id_operadora, id_validador) AS primeiro_datetime_gps,\n                MAX(datetime_gps) OVER (PARTITION BY id_operadora, id_validador) AS ultimo_datetime_gps,\n                ROW_NUMBER() OVER (PARTITION BY id_transmissao_gps ORDER BY datetime_captura DESC) AS rn\n            FROM\n                `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`gps_validador_van`\n            WHERE\n                data = current_date(\"America/Sao_Paulo\")\n        )\n    WHERE\n        rn = 1\n)\nSELECT\n    id_operadora,\n    id_validador,\n    data,\n    estado_equipamento,\n    primeiro_datetime_gps,\n    ultimo_datetime_gps,\n    qtde_min_entre_a_prim_e_ultima_transmissao,\n    qtde_min_distintos_houve_transmissao,\n    qtde_registros_gps,\n    qtde_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_registros_gps_georreferenciados, qtde_registros_gps), 0) AS percentual_registros_gps_georreferenciados,\n    IFNULL(SAFE_DIVIDE(qtde_min_distintos_houve_transmissao, qtde_min_entre_a_prim_e_ultima_transmissao), 0) AS percentual_transmissao_a_cada_min\nFROM\n    gps_agregado\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_parada_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_aux_registros_parada_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_parada_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_parada_zirix.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_parada_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_aux_registros_parada_zirix"], "alias": "sppo_aux_registros_parada_zirix", "checksum": {"name": "sha256", "checksum": "3318560baa4dce2df7441ef723f72139e6336f2d71a9ad6e504bc56fda00de0f"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela para identifica\u00e7\u00e3o de ve\u00edculos parados em terminais ou garagens conhecidas.", "columns": {"data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps_zirix"}, "created_at": 1727709588.7521045, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from {{ var('sppo_terminais') }}\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM {{ var('polygon_garagem') }}\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        {{ ref('sppo_aux_registros_filtrada_zirix') }}\n      {%if not flags.FULL_REFRESH %}\n      WHERE\n        data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n      {% endif %}\n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < {{ var('distancia_limiar_parada') }} then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada_zirix", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_parada_zirix.sql", "compiled": true, "compiled_code": "\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_realocacao_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_aux_registros_realocacao_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_realocacao_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_realocacao_zirix.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_realocacao_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_aux_registros_realocacao_zirix"], "alias": "sppo_aux_registros_realocacao", "checksum": {"name": "sha256", "checksum": "a6496def33689a21f3f4e2fffe4b0b68db27420fbbb6e1d9f6113e7d3ba7a174"}, "config": {"enabled": true, "alias": "sppo_aux_registros_realocacao", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com realoca\u00e7\u00f5es de linha v\u00e1lidas.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_gps": {"name": "servico_gps", "description": "Linha de \u00f4nibus (servi\u00e7o) informado pelo GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realocado": {"name": "servico_realocado", "description": "Linha de \u00f4nibus (servi\u00e7o) realocada informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_realocacao": {"name": "datetime_realocacao", "description": "Datetime_realocacao que o registro da realoca\u00e7\u00e3o foi informado pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "alias": "sppo_aux_registros_realocacao"}, "created_at": 1727709588.7539723, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registros_realocacao`", "raw_code": "{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      },\n      alias='sppo_aux_registros_realocacao'\n  )\n}}\n\n-- 1. Filtra realoca\u00e7\u00f5es v\u00e1lidas dentro do intervalo de GPS avaliado\nwith realocacao as (\n  select\n    * except(datetime_saida),\n    case\n      when datetime_saida is null then datetime_operacao\n      else datetime_saida\n    end as datetime_saida,\n  from\n    {{ ref('sppo_realocacao_zirix') }}\n  where\n    -- Realoca\u00e7\u00e3o deve acontecer ap\u00f3s o registro de GPS e at\u00e9 1 hora depois\n        datetime_diff(datetime_operacao, datetime_entrada, minute) between 0 and 60\n    {% if is_incremental() -%}\n    and\n        data between DATE(\"{{var('date_range_start')}}\")\n        and DATE(datetime_add(\"{{var('date_range_end')}}\", interval 1\n        hour))\n    and\n        datetime_operacao between datetime(\"{{var('date_range_start')}}\")\n            and datetime_add(\"{{var('date_range_end')}}\", interval 1 hour)\n    {%- endif -%}\n),\n-- 2. Altera registros de GPS com servicos realocados\ngps as (\n  select\n    ordem,\n    timestamp_gps,\n    linha,\n    data,\n    hora\n  from {{ ref('sppo_registros_zirix') }}\n  where\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    and timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <= \"{{var('date_range_end')}}\"\n),\ncombinacao as (\n  select\n    r.id_veiculo,\n    g.timestamp_gps,\n    g.linha as servico_gps,\n    r.servico as servico_realocado,\n    r.datetime_operacao as datetime_realocacao,\n    g.data,\n    g.hora\n  from gps g\n  inner join realocacao r\n  on\n    g.ordem = r.id_veiculo\n    and g.linha != r.servico\n    and g.timestamp_gps between r.datetime_entrada and r.datetime_saida\n)\n-- Filtra realocacao mais recente para cada timestamp\nselect\n  * except(rn)\nfrom (\n  select\n    *,\n    row_number() over (partition by id_veiculo, timestamp_gps order by datetime_realocacao desc) as rn\n  from combinacao\n)\nwhere rn = 1", "language": "sql", "refs": [{"name": "sppo_realocacao_zirix", "package": null, "version": null}, {"name": "sppo_registros_zirix", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_realocacao_zirix", "model.rj_smtr.sppo_registros_zirix"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_realocacao_zirix.sql", "compiled": true, "compiled_code": "\n\n-- 1. Filtra realoca\u00e7\u00f5es v\u00e1lidas dentro do intervalo de GPS avaliado\nwith realocacao as (\n  select\n    * except(datetime_saida),\n    case\n      when datetime_saida is null then datetime_operacao\n      else datetime_saida\n    end as datetime_saida,\n  from\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_realocacao`\n  where\n    -- Realoca\u00e7\u00e3o deve acontecer ap\u00f3s o registro de GPS e at\u00e9 1 hora depois\n        datetime_diff(datetime_operacao, datetime_entrada, minute) between 0 and 60\n    and\n        data between DATE(\"2022-01-01T00:00:00\")\n        and DATE(datetime_add(\"2022-01-01T01:00:00\", interval 1\n        hour))\n    and\n        datetime_operacao between datetime(\"2022-01-01T00:00:00\")\n            and datetime_add(\"2022-01-01T01:00:00\", interval 1 hour)),\n-- 2. Altera registros de GPS com servicos realocados\ngps as (\n  select\n    ordem,\n    timestamp_gps,\n    linha,\n    data,\n    hora\n  from `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_registros`\n  where\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    and timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <= \"2022-01-01T01:00:00\"\n),\ncombinacao as (\n  select\n    r.id_veiculo,\n    g.timestamp_gps,\n    g.linha as servico_gps,\n    r.servico as servico_realocado,\n    r.datetime_operacao as datetime_realocacao,\n    g.data,\n    g.hora\n  from gps g\n  inner join realocacao r\n  on\n    g.ordem = r.id_veiculo\n    and g.linha != r.servico\n    and g.timestamp_gps between r.datetime_entrada and r.datetime_saida\n)\n-- Filtra realocacao mais recente para cada timestamp\nselect\n  * except(rn)\nfrom (\n  select\n    *,\n    row_number() over (partition by id_veiculo, timestamp_gps order by datetime_realocacao desc) as rn\n  from combinacao\n)\nwhere rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_registros_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_registros_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_registros_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_registros_zirix.sql", "unique_id": "model.rj_smtr.sppo_registros_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_registros_zirix"], "alias": "sppo_registros", "checksum": {"name": "sha256", "checksum": "a2a9fec657b9cc8fcbcfa7081d9bdc017ac33333144e9053dc92a5a5d5dd425e"}, "config": {"enabled": true, "alias": "sppo_registros", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com todos os registros de GPS.", "columns": {"ordem": {"name": "ordem", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "alias": "sppo_registros"}, "created_at": 1727709588.7574124, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_registros`", "raw_code": "{{\n  config(\n    materialized='view',\n    alias='sppo_registros'\n  )\n}}\n\nSELECT\n    SAFE_CAST(ordem AS STRING) ordem,\n    SAFE_CAST(REPLACE(latitude, ',', '.') AS FLOAT64) latitude,\n    SAFE_CAST(REPLACE(longitude, ',', '.') AS FLOAT64) longitude,\n    SAFE_CAST(DATETIME(TIMESTAMP(datahora), \"America/Sao_Paulo\") AS DATETIME) timestamp_gps,\n    SAFE_CAST(velocidade AS INT64) velocidade,\n    concat(\n        ifnull(REGEXP_EXTRACT(linha, r'[A-Z]+'), \"\"),\n        ifnull(REGEXP_EXTRACT(linha, r'[0-9]+'), \"\")\n    ) as linha,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(data AS DATE) data,\n    SAFE_CAST(hora AS INT64) hora\nfrom\n    {{ source('br_rj_riodejaneiro_onibus_gps_zirix_staging', \"registros\")}}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_onibus_gps_zirix_staging", "registros"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_registros_zirix.sql", "compiled": true, "compiled_code": "\n\nSELECT\n    SAFE_CAST(ordem AS STRING) ordem,\n    SAFE_CAST(REPLACE(latitude, ',', '.') AS FLOAT64) latitude,\n    SAFE_CAST(REPLACE(longitude, ',', '.') AS FLOAT64) longitude,\n    SAFE_CAST(DATETIME(TIMESTAMP(datahora), \"America/Sao_Paulo\") AS DATETIME) timestamp_gps,\n    SAFE_CAST(velocidade AS INT64) velocidade,\n    concat(\n        ifnull(REGEXP_EXTRACT(linha, r'[A-Z]+'), \"\"),\n        ifnull(REGEXP_EXTRACT(linha, r'[0-9]+'), \"\")\n    ) as linha,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(data AS DATE) data,\n    SAFE_CAST(hora AS INT64) hora\nfrom\n    `rj-smtr-staging`.`br_rj_riodejaneiro_onibus_gps_zirix_staging`.`registros`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_realocacao_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_realocacao_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_realocacao_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_realocacao_zirix.sql", "unique_id": "model.rj_smtr.sppo_realocacao_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_realocacao_zirix"], "alias": "sppo_realocacao", "checksum": {"name": "sha256", "checksum": "47a7c6cfc3a7e57de418f7d56f35c68fbb30b874635fc2e3ac7e04604624d445"}, "config": {"enabled": true, "alias": "sppo_realocacao", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com todas as realoca\u00e7\u00f5es de linha informadas.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_operacao": {"name": "datetime_operacao", "description": "Datetime que o registro da realoca\u00e7\u00e3o foi informado pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Linha de \u00f4nibus (servi\u00e7o) realocada informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_entrada": {"name": "datetime_entrada", "description": "Datetime de entrada do ve\u00edculo na linha realocada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_saida": {"name": "datetime_saida", "description": "Datetime de sa\u00edda do ve\u00edculo na linha realocada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_processamento": {"name": "timestamp_processamento", "description": "Timestamp de processamento da realoca\u00e7\u00e3o pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do registro de realoca\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "alias": "sppo_realocacao"}, "created_at": 1727709588.7565973, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_realocacao`", "raw_code": "{{\n  config(\n    materialized='view',\n    alias='sppo_realocacao'\n  )\n}}\n\nSELECT\n  SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_operacao), \"America/Sao_Paulo\") AS DATETIME) datetime_operacao,\n  concat(\n    ifnull(REGEXP_EXTRACT(servico, r'[A-Z]+'), \"\"),\n    ifnull(REGEXP_EXTRACT(servico, r'[0-9]+'), \"\")\n  ) as servico,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_entrada), \"America/Sao_Paulo\") AS DATETIME) as datetime_entrada,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_saida), \"America/Sao_Paulo\") AS DATETIME) as datetime_saida,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_processamento), \"America/Sao_Paulo\") AS DATETIME) as timestamp_processamento,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) as timestamp_captura,\n  SAFE_CAST(data AS DATE) as data,\n  SAFE_CAST(hora AS INT64) as hora\nFROM\n  {{ source('br_rj_riodejaneiro_onibus_gps_zirix_staging', \"realocacao\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_onibus_gps_zirix_staging", "realocacao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_realocacao_zirix.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_operacao), \"America/Sao_Paulo\") AS DATETIME) datetime_operacao,\n  concat(\n    ifnull(REGEXP_EXTRACT(servico, r'[A-Z]+'), \"\"),\n    ifnull(REGEXP_EXTRACT(servico, r'[0-9]+'), \"\")\n  ) as servico,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_entrada), \"America/Sao_Paulo\") AS DATETIME) as datetime_entrada,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_saida), \"America/Sao_Paulo\") AS DATETIME) as datetime_saida,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_processamento), \"America/Sao_Paulo\") AS DATETIME) as timestamp_processamento,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) as timestamp_captura,\n  SAFE_CAST(data AS DATE) as data,\n  SAFE_CAST(hora AS INT64) as hora\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_onibus_gps_zirix_staging`.`realocacao`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_filtrada_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_aux_registros_filtrada_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_filtrada_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_filtrada_zirix.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_filtrada_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_aux_registros_filtrada_zirix"], "alias": "sppo_aux_registro_filtrada", "checksum": {"name": "sha256", "checksum": "f20c3443fcf3d3b94917c01a97ce31f0074ddfbd0fab989ca9bbdf48cfb6fa7c"}, "config": {"enabled": true, "alias": "sppo_aux_registro_filtrada", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com filtragem e tratamento b\u00e1sico de registros de GPS.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "posicao_veiculo_geo": {"name": "posicao_veiculo_geo", "description": "Coordenada geogr\u00e1fica (POINT) com a posi\u00e7\u00e3o que o ve\u00edculo se encontra, conforme 'longitude' e 'latitude' informadas pelo GPS (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o) ou, se realocada, informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "SHA da branch no Github", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "alias": "sppo_aux_registro_filtrada"}, "created_at": 1727709588.750398, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`", "raw_code": "{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      },\n      alias='sppo_aux_registro_filtrada'\n  )\n}}\n  /*\nDescri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.\n2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.\n3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.\n\t- id_veiculo --> ordem\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\t{{ var('limites_caixa') }}\n),\ngps AS (\n  /*2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    {{ ref('sppo_registros_zirix') }}\n  {% if is_incremental() -%}\n  WHERE\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n  {%- endif -%}\n),\nrealocacao as (\n  SELECT\n    g.* except(linha),\n    coalesce(r.servico_realocado, g.linha) as linha\n  FROM\n    gps g\n  LEFT JOIN\n    {{ ref('sppo_aux_registros_realocacao_zirix') }} r\n  ON\n    g.ordem = r.id_veiculo\n    and g.timestamp_gps = r.timestamp_gps\n),\nfiltrada AS (\n  /*1,2, e 3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.*/\n  SELECT\n    ordem AS id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    linha,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by ordem, timestamp_gps, linha) rn\n  FROM\n    realocacao\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "language": "sql", "refs": [{"name": "sppo_registros_zirix", "package": null, "version": null}, {"name": "sppo_aux_registros_realocacao_zirix", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_registros_zirix", "model.rj_smtr.sppo_aux_registros_realocacao_zirix"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_filtrada_zirix.sql", "compiled": true, "compiled_code": "\n  /*\nDescri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.\n2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.\n3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.\n\t- id_veiculo --> ordem\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\trj-smtr.br_rj_riodejaneiro_geo.limites_geograficos_caixa\n),\ngps AS (\n  /*2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_registros`\n  WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\nrealocacao as (\n  SELECT\n    g.* except(linha),\n    coalesce(r.servico_realocado, g.linha) as linha\n  FROM\n    gps g\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registros_realocacao` r\n  ON\n    g.ordem = r.id_veiculo\n    and g.timestamp_gps = r.timestamp_gps\n),\nfiltrada AS (\n  /*1,2, e 3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.*/\n  SELECT\n    ordem AS id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    linha,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by ordem, timestamp_gps, linha) rn\n  FROM\n    realocacao\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_velocidade_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_aux_registros_velocidade_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_velocidade_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_velocidade_zirix.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_velocidade_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_aux_registros_velocidade_zirix"], "alias": "sppo_aux_registros_velocidade_zirix", "checksum": {"name": "sha256", "checksum": "6eed654b129f262ba3ab56e713c2503291d0a17cfd7dd35316bb59d7e4039059"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com estimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos", "columns": {"timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps_zirix"}, "created_at": 1727709588.7546573, "relation_name": null, "raw_code": "{{\n    config(\n        materialized='ephemeral'\n    )\n}}\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  {{ ref(\"sppo_aux_registros_filtrada_zirix\") }}\n    {%if not flags.FULL_REFRESH -%}\n    WHERE\n        data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN {{ var('janela_movel_velocidade') }} PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > {{ var('velocidade_maxima') }}\n            THEN {{ var('velocidade_maxima') }}\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < {{ var('velocidade_limiar_parado') }} then false\n        else true\n    end flag_em_movimento,\nFROM medias", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada_zirix", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_velocidade_zirix.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.gps_sppo_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "gps_sppo_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/gps_sppo_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/gps_sppo_zirix.sql", "unique_id": "model.rj_smtr.gps_sppo_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "gps_sppo_zirix"], "alias": "gps_sppo", "checksum": {"name": "sha256", "checksum": "379abf66d2b4d50be312b3b1a2170afa48e7a378fd59b8298b7e2ff1a62cae6c"}, "config": {"enabled": true, "alias": "gps_sppo", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Tabela com os dados tratados de registros de GPS dos \u00f4nibus capturados utilizando a API da Zirix.", "columns": {"modo": {"name": "modo", "description": "SPPO \u2013 nesse arquivo s\u00f3 consta esse modo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_operacao": {"name": "flag_em_operacao", "description": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "Identifica ve\u00edculos parados em terminais ou garagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_instantanea": {"name": "velocidade_instantanea", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "alias": "gps_sppo", "tags": ["geolocalizacao"]}, "created_at": 1727709588.7584198, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`gps_sppo`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    partition_by={\n      'field':\"data\",\n      'data_type':'date',\n      'granularity': 'day'\n    },\n    alias='gps_sppo',\n    tags=['geolocalizacao']\n  )\n}}\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n  registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM {{ ref('sppo_aux_registros_filtrada_zirix') }}\n    {% if is_incremental() -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n  ),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      {{ ref('sppo_aux_registros_velocidade_zirix') }}\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM {{ ref('sppo_aux_registros_parada_zirix') }}\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      {{ ref('sppo_aux_registros_flag_trajeto_correto_zirix') }}\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\n{% if is_incremental() -%}\n  WHERE\n  date(r.timestamp_gps) between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n  AND r.timestamp_gps > \"{{var('date_range_start')}}\" and r.timestamp_gps <=\"{{var('date_range_end')}}\"\n{%- endif -%}", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada_zirix", "package": null, "version": null}, {"name": "sppo_aux_registros_velocidade_zirix", "package": null, "version": null}, {"name": "sppo_aux_registros_parada_zirix", "package": null, "version": null}, {"name": "sppo_aux_registros_flag_trajeto_correto_zirix", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix", "model.rj_smtr.sppo_aux_registros_velocidade_zirix", "model.rj_smtr.sppo_aux_registros_parada_zirix", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/gps_sppo_zirix.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nJun\u00e7\u00e3o dos passos de tratamento, junta as informa\u00e7\u00f5es extras que definimos a partir dos registros\ncapturados.\nPara descri\u00e7\u00e3o detalhada de como cada coluna \u00e9 calculada, consulte a documenta\u00e7\u00e3o de cada uma das tabelas\nutilizadas abaixo.\n1. registros_filtrada: filtragem e tratamento b\u00e1sico dos dados brutos capturados.\n2. aux_registros_velocidade: estimativa da velocidade de ve\u00edculo a cada ponto registrado e identifica\u00e7\u00e3o\ndo estado de movimento ('parado', 'andando')\n3. aux_registros_parada: identifica ve\u00edculos parados em terminais ou garagens conhecidas\n4. aux_registros_flag_trajeto_correto: calcula intersec\u00e7\u00f5es das posi\u00e7\u00f5es registradas para cada ve\u00edculo\ncom o tra\u00e7ado da linha informada.\n5. As jun\u00e7\u00f5es (joins) s\u00e3o feitas sobre o id_ve\u00edculo e a timestamp_gps.\n*/\nWITH\n   __dbt__cte__sppo_aux_registros_velocidade_zirix as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n),  __dbt__cte__sppo_aux_registros_parada_zirix as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n),  __dbt__cte__sppo_aux_registros_flag_trajeto_correto_zirix as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n), registros as (\n  -- 1. registros_filtrada\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      timestamp_captura,\n      velocidade,\n      linha,\n      latitude,\n      longitude,\n    FROM `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  velocidades AS (\n    -- 2. velocidades\n    SELECT\n      id_veiculo, timestamp_gps, linha, velocidade, distancia, flag_em_movimento\n    FROM\n      __dbt__cte__sppo_aux_registros_velocidade_zirix\n  ),\n  paradas as (\n    -- 3. paradas\n    SELECT\n      id_veiculo, timestamp_gps, linha, tipo_parada,\n    FROM __dbt__cte__sppo_aux_registros_parada_zirix\n  ),\n  flags AS (\n    -- 4. flag_trajeto_correto\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      linha,\n      route_id,\n      flag_linha_existe_sigmob,\n      flag_trajeto_correto,\n      flag_trajeto_correto_hist\n    FROM\n      __dbt__cte__sppo_aux_registros_flag_trajeto_correto_zirix\n  )\n-- 5. Jun\u00e7\u00e3o final\nSELECT\n  \"SPPO\" modo,\n  r.timestamp_gps,\n  date(r.timestamp_gps) data,\n  extract(time from r.timestamp_gps) hora,\n  r.id_veiculo,\n  r.linha as servico,\n  r.latitude,\n  r.longitude,\n  CASE\n    WHEN\n      flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n      THEN true\n  ELSE false\n  END flag_em_operacao,\n  v.flag_em_movimento,\n  p.tipo_parada,\n  flag_linha_existe_sigmob,\n  flag_trajeto_correto,\n  flag_trajeto_correto_hist,\n  CASE\n    WHEN flag_em_movimento IS true AND flag_trajeto_correto_hist is true\n    THEN 'Em opera\u00e7\u00e3o'\n    WHEN flag_em_movimento is true and flag_trajeto_correto_hist is false\n    THEN 'Operando fora trajeto'\n    WHEN flag_em_movimento is false\n    THEN\n        CASE\n            WHEN tipo_parada is not null\n            THEN concat(\"Parado \", tipo_parada)\n        ELSE\n            CASE\n                WHEN flag_trajeto_correto_hist is true\n                THEN 'Parado trajeto correto'\n            ELSE 'Parado fora trajeto'\n            END\n        END\n    END status,\n  r.velocidade velocidade_instantanea,\n  v.velocidade velocidade_estimada_10_min,\n  v.distancia,\n  \"\" as versao\nFROM\n  registros r\n\nJOIN\n  flags f\nON\n  r.id_veiculo = f.id_veiculo\n  AND r.timestamp_gps = f.timestamp_gps\n  AND r.linha = f.linha\n\nJOIN\n  velocidades v\nON\n  r.id_veiculo = v.id_veiculo\n  AND  r.timestamp_gps = v.timestamp_gps\n  AND  r.linha = v.linha\n\nJOIN\n  paradas p\nON\n  r.id_veiculo = p.id_veiculo\n  AND  r.timestamp_gps = p.timestamp_gps\n  AND r.linha = p.linha\nWHERE\n  date(r.timestamp_gps) between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n  AND r.timestamp_gps > \"2022-01-01T00:00:00\" and r.timestamp_gps <=\"2022-01-01T01:00:00\"", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.sppo_aux_registros_velocidade_zirix", "sql": " __dbt__cte__sppo_aux_registros_velocidade_zirix as (\n\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_parada_zirix", "sql": " __dbt__cte__sppo_aux_registros_parada_zirix as (\n\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1\n)"}, {"id": "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix", "sql": " __dbt__cte__sppo_aux_registros_flag_trajeto_correto_zirix as (\n\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "name": "sppo_aux_registros_flag_trajeto_correto_zirix", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_flag_trajeto_correto_zirix.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_flag_trajeto_correto_zirix.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix", "sppo_aux_registros_flag_trajeto_correto_zirix"], "alias": "sppo_aux_registros_flag_trajeto_correto_zirix", "checksum": {"name": "sha256", "checksum": "c3bb980338a181fc0f29005b64ef958b5de27c802630d302ccd9cbe8aa62bfe7"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela para verifica\u00e7\u00e3o se o ve\u00edculo est\u00e1 dentro do trajeto correto", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha_gtfs": {"name": "linha_gtfs", "description": "Linha de \u00f4nibus (servi\u00e7o) da tabela 'shapes_geom'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "C\u00f3digo identificador na rota da tabela 'shapes_geom'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps_zirix/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps_zirix"}, "created_at": 1727709588.7514472, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      {{ ref('sppo_aux_registros_filtrada_zirix') }} r\n    {% if not flags.FULL_REFRESH -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN {{ var('intervalo_max_desvio_segundos') }} PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM {{ ref('shapes_geom') }}\n      WHERE id_modal_smtr in ({{ var('sppo_id_modal_smtr')|join(', ') }})\n      AND data_versao = \"{{ var('versao_fixa_sigmob')}}\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada_zirix", "package": null, "version": null}, {"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix", "model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps_zirix/sppo_aux_registros_flag_trajeto_correto_zirix.sql", "compiled": true, "compiled_code": "\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps_zirix`.`sppo_aux_registro_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagem_informada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_viagem_zirix", "name": "viagem_informada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_viagem_zirix/viagem_informada.sql", "original_file_path": "models/br_rj_riodejaneiro_viagem_zirix/viagem_informada.sql", "unique_id": "model.rj_smtr.viagem_informada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_viagem_zirix", "viagem_informada"], "alias": "viagem_informada", "checksum": {"name": "sha256", "checksum": "7f7f2fabf799d1484b9e14036196fa96975edb7cc93f062fc834b99368cc9409"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_viagem_zirix", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Detalhes das viagens informadas pelas operadoras de \u00f4nibus", "columns": {"data": {"name": "data", "description": "Data da viagem (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Data e hora da partida da viagem em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Data e hora da chegada da viagem em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_processamento": {"name": "datetime_processamento", "description": "Data e hora do processamento da viagem em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora da captura da integra\u00e7\u00e3o em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "Identificador de uma viagem da tabela trips do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "Identificador de uma rota da tabela routes do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "Identificador de um shape da tabela shapes do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Ida ou Volta", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "Identificador de um shape da tabela shapes do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_viagem_zirix/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_viagem_zirix", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.599412, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_viagem_zirix`.`viagem_informada`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n{% set incremental_filter %}\n  DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n{% endset %}\n\n{% set staging_viagem_informada = ref('staging_viagem_informada') %}\n{% if execute %}\n  {% if is_incremental() %}\n    {% set partitions_query %}\n      SELECT DISTINCT\n        CONCAT(\"'\", DATE(data_viagem), \"'\") AS data_viagem\n      FROM\n        {{ staging_viagem_informada }}\n      WHERE\n        {{ incremental_filter }}\n    {% endset %}\n\n    {% set partitions = run_query(partitions_query).columns[0].values() %}\n  {% endif %}\n{% endif %}\n\nWITH staging_data AS (\n  SELECT\n    data_viagem AS data,\n    datetime_partida,\n    datetime_chegada,\n    datetime_processamento,\n    timestamp_captura AS datetime_captura,\n    id_veiculo,\n    trip_id,\n    route_id,\n    shape_id,\n    servico,\n    CASE\n      WHEN sentido = 'I' THEN 'Ida'\n      WHEN sentido = 'V' THEN 'Volta'\n      ELSE sentido\n    END AS sentido,\n    id_viagem\n  FROM\n    {{ staging_viagem_informada }}\n  {% if is_incremental() %}\n    WHERE\n      {{ incremental_filter }}\n  {% endif %}\n),\ncomplete_partitions AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    staging_data\n\n  {% if is_incremental() and partitions|length > 0 %}\n    UNION ALL\n\n    SELECT\n      * EXCEPT(versao, datetime_ultima_atualizacao),\n      1 AS priority\n    FROM\n      {{ this }}\n    WHERE\n      data IN ({{ partitions|join(', ') }})\n  {% endif %}\n),\ndeduplicado AS (\n  SELECT\n    * EXCEPT(rn, priority)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_viagem ORDER BY datetime_captura DESC, priority) AS rn\n      FROM\n        complete_partitions\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  deduplicado", "language": "sql", "refs": [{"name": "staging_viagem_informada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.staging_viagem_informada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_viagem_zirix/viagem_informada.sql", "compiled": true, "compiled_code": "\n\n\n\n\n\n  \n    \n\n    \n  \n\n\nWITH staging_data AS (\n  SELECT\n    data_viagem AS data,\n    datetime_partida,\n    datetime_chegada,\n    datetime_processamento,\n    timestamp_captura AS datetime_captura,\n    id_veiculo,\n    trip_id,\n    route_id,\n    shape_id,\n    servico,\n    CASE\n      WHEN sentido = 'I' THEN 'Ida'\n      WHEN sentido = 'V' THEN 'Volta'\n      ELSE sentido\n    END AS sentido,\n    id_viagem\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_viagem_zirix_staging`.`viagem_informada`\n  \n    WHERE\n      \n  DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n\n  \n),\ncomplete_partitions AS (\n  SELECT\n    *,\n    0 AS priority\n  FROM\n    staging_data\n\n  \n),\ndeduplicado AS (\n  SELECT\n    * EXCEPT(rn, priority)\n  FROM\n    (\n      SELECT\n        *,\n        ROW_NUMBER() OVER(PARTITION BY id_viagem ORDER BY datetime_captura DESC, priority) AS rn\n      FROM\n        complete_partitions\n    )\n  WHERE\n    rn = 1\n)\nSELECT\n  *,\n  '' AS versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  deduplicado", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_viagem_informada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_viagem_zirix_staging", "name": "staging_viagem_informada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_viagem_zirix/staging/staging_viagem_informada.sql", "original_file_path": "models/br_rj_riodejaneiro_viagem_zirix/staging/staging_viagem_informada.sql", "unique_id": "model.rj_smtr.staging_viagem_informada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_viagem_zirix", "staging", "staging_viagem_informada"], "alias": "viagem_informada", "checksum": {"name": "sha256", "checksum": "84f741f72e80a20eb2436cbc4a5bbd0706367b977bb79a94b95b1fe8786e6135"}, "config": {"enabled": true, "alias": "viagem_informada", "schema": "br_rj_riodejaneiro_viagem_zirix_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_viagem_zirix_staging", "alias": "viagem_informada"}, "created_at": 1727709586.598272, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_viagem_zirix_staging`.`viagem_informada`", "raw_code": "{{\n  config(\n    alias=\"viagem_informada\"\n  )\n}}\n\nSELECT\n  id_viagem,\n  data,\n  hora,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  DATE(\n    PARSE_DATETIME(\n      '%Y-%m-%d',\n      SUBSTRING(\n        SAFE_CAST(JSON_VALUE(content, '$.data_viagem') AS STRING),\n        0,\n        10\n      )\n    )\n  ) AS data_viagem,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_chegada') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_chegada,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_partida') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_partida,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%E*S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_processamento') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_processamento,\n  SAFE_CAST(JSON_VALUE(content, '$.id_veiculo') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content, '$.route_id') AS STRING) AS route_id,\n  SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n  SAFE_CAST(JSON_VALUE(content, '$.servico') AS STRING) AS servico,\n  SAFE_CAST(JSON_VALUE(content, '$.shape_id') AS STRING) AS shape_id,\n  SAFE_CAST(JSON_VALUE(content, '$.trip_id') AS STRING) AS trip_id\nFROM\n  {{ source(\"br_rj_riodejaneiro_viagem_zirix_staging\", \"viagem_informada\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_viagem_zirix_staging", "viagem_informada"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_viagem_zirix/staging/staging_viagem_informada.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  id_viagem,\n  data,\n  hora,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  DATE(\n    PARSE_DATETIME(\n      '%Y-%m-%d',\n      SUBSTRING(\n        SAFE_CAST(JSON_VALUE(content, '$.data_viagem') AS STRING),\n        0,\n        10\n      )\n    )\n  ) AS data_viagem,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_chegada') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_chegada,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_partida') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_partida,\n  DATETIME(\n    PARSE_TIMESTAMP(\n      '%Y-%m-%dT%H:%M:%E*S',\n      REPLACE(\n        SAFE_CAST(JSON_VALUE(content, '$.datetime_processamento') AS STRING),\n        \"Z\",\n        \"\"\n      )\n    )\n  ) AS datetime_processamento,\n  SAFE_CAST(JSON_VALUE(content, '$.id_veiculo') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content, '$.route_id') AS STRING) AS route_id,\n  SAFE_CAST(JSON_VALUE(content, '$.sentido') AS STRING) AS sentido,\n  SAFE_CAST(JSON_VALUE(content, '$.servico') AS STRING) AS servico,\n  SAFE_CAST(JSON_VALUE(content, '$.shape_id') AS STRING) AS shape_id,\n  SAFE_CAST(JSON_VALUE(content, '$.trip_id') AS STRING) AS trip_id\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_viagem_zirix_staging`.`viagem_informada`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_bloqueio_via": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos", "name": "recursos_sppo_bloqueio_via", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos/recursos_sppo_bloqueio_via.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos/recursos_sppo_bloqueio_via.sql", "unique_id": "model.rj_smtr.recursos_sppo_bloqueio_via", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos", "recursos_sppo_bloqueio_via"], "alias": "recursos_sppo_bloqueio_via", "checksum": {"name": "sha256", "checksum": "2d8258fa425477e612a2c6cfec0ecc23ed24e95b9cf4a36a8a31b492439bd82c"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_recurso", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Recursos abertos na plataforma Movidesk para pagamento de subs\u00eddio de bloqueio de via", "columns": {"id_recurso": {"name": "id_recurso", "description": "N\u00famero de id do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Tipo do servi\u00e7o de \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "numero_relatorio_cimu": {"name": "numero_relatorio_cimu", "description": "N\u00famero do relat\u00f3rio CIMU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_viagem": {"name": "data_viagem", "description": "Data da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data/hora de captura dos dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_recurso": {"name": "datetime_recurso", "description": "Data/hora de cria\u00e7\u00e3o do ticket para pedido de recurso no Movidesk", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_update": {"name": "datetime_update", "description": "Datetime de atualiza\u00e7\u00e3o do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "julgamento": {"name": "julgamento", "description": "Julgamento do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "motivo_julgamento": {"name": "motivo_julgamento", "description": "Motivos para julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "observacao_julgamento": {"name": "observacao_julgamento", "description": "Observa\u00e7\u00f5es acerca do julgamentodo recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do recurso (parti\u00e7\u00e3o da tabela)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_julgamento": {"name": "data_julgamento", "description": "Data do julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_recursos/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_recurso"}, "created_at": 1727709588.6040993, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_bloqueio_via`", "raw_code": "{{ config(\n  materialized = 'incremental',\n  partition_by = { 'field' :'data',\n    'data_type' :'date',\n    'granularity': 'day' },\n      unique_key = 'id_recurso',\n) }}\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_bloqueio_via') }},\n    UNNEST(items) items\n  {% if is_incremental() -%}\n    WHERE\n      DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '111870', '111871', '111872',\n        '111901', '111865', '111867', '111868',\n        '111869', '111866', '111904', '125615',\n        '111900', '111874'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    SAFE_CAST(p.111870 AS STRING) AS consorcio,\n    CASE\n      WHEN SAFE_CAST(p.111872 AS STRING) = \"SR - Regular\" THEN SAFE_CAST(p.111871 AS STRING)\n      ELSE CONCAT(REPLACE(SPLIT(SAFE_CAST(p.111872 AS STRING), \"-\")[OFFSET(0)], \" \", \"\"), SAFE_CAST(p.111871 AS STRING))\n    END AS servico,\n     CASE\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Ida\" THEN \"I\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Volta\" THEN \"V\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Circular\" THEN \"C\"\n    END\n      AS sentido,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez',SAFE_CAST(p.111867 AS STRING), 'America/Sao_Paulo') AS data_viagem,\n    SAFE_CAST(p.111874 AS STRING) AS numero_relatorio_cimu,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn=1\n)\n\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      t.consorcio,\n      t.servico,\n      t.sentido,\n      DATE(EXTRACT(date FROM TIMESTAMP(data_viagem))) AS data_viagem,\n      t.numero_relatorio_cimu,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\n\nLEFT JOIN\n\n    {{ ref('recursos_sppo_bloqueio_via_ultimo_julgamento') }} AS j\n\n  ON t.id_recurso = j.id_recurso", "language": "sql", "refs": [{"name": "staging_recursos_sppo_bloqueio_via", "package": null, "version": null}, {"name": "recursos_sppo_bloqueio_via_ultimo_julgamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_bloqueio_via", "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos/recursos_sppo_bloqueio_via.sql", "compiled": true, "compiled_code": "\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_bloqueio_via`,\n    UNNEST(items) items\n  WHERE\n      DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '111870', '111871', '111872',\n        '111901', '111865', '111867', '111868',\n        '111869', '111866', '111904', '125615',\n        '111900', '111874'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    SAFE_CAST(p.111870 AS STRING) AS consorcio,\n    CASE\n      WHEN SAFE_CAST(p.111872 AS STRING) = \"SR - Regular\" THEN SAFE_CAST(p.111871 AS STRING)\n      ELSE CONCAT(REPLACE(SPLIT(SAFE_CAST(p.111872 AS STRING), \"-\")[OFFSET(0)], \" \", \"\"), SAFE_CAST(p.111871 AS STRING))\n    END AS servico,\n     CASE\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Ida\" THEN \"I\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Volta\" THEN \"V\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Circular\" THEN \"C\"\n    END\n      AS sentido,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez',SAFE_CAST(p.111867 AS STRING), 'America/Sao_Paulo') AS data_viagem,\n    SAFE_CAST(p.111874 AS STRING) AS numero_relatorio_cimu,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn=1\n)\n\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      t.consorcio,\n      t.servico,\n      t.sentido,\n      DATE(EXTRACT(date FROM TIMESTAMP(data_viagem))) AS data_viagem,\n      t.numero_relatorio_cimu,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\n\nLEFT JOIN\n\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_bloqueio_via_ultimo_julgamento` AS j\n\n  ON t.id_recurso = j.id_recurso", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_servico_dia_avaliacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos", "name": "recursos_sppo_servico_dia_avaliacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_avaliacao.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_avaliacao.sql", "unique_id": "model.rj_smtr.recursos_sppo_servico_dia_avaliacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos", "recursos_sppo_servico_dia_avaliacao"], "alias": "recursos_sppo_servico_dia_avaliacao", "checksum": {"name": "sha256", "checksum": "9822bfeda3f847ba313c6a1f929e6d8d45c07e2f6e1e8c93c932fad90294e3ba"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Recursos em avalia\u00e7\u00e3o pela Coordenadoria de Monitoramento (TR/SUBTT/CMO)", "columns": {"data": {"name": "data", "description": "Data da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_recurso": {"name": "id_recurso", "description": "N\u00famero de ID do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_recurso": {"name": "tipo_recurso", "description": "Tipo de recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 006, 010, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_recursos/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_recursos"}, "created_at": 1727709588.6057928, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_avaliacao`", "raw_code": "{{ config(\n  materialized = \"table\",\n) }}\n\nSELECT\n  PARSE_DATE(\"%d/%m/%Y\", DATA) AS data,\n  id_recurso,\n  tipo_recurso,\n  servico,\nFROM\n  {{ source(\"br_rj_riodejaneiro_recursos_staging\", \"recursos_sppo_servico_dia_avaliacao\") }}", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_recursos_staging", "recursos_sppo_servico_dia_avaliacao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_avaliacao.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  PARSE_DATE(\"%d/%m/%Y\", DATA) AS data,\n  id_recurso,\n  tipo_recurso,\n  servico,\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_servico_dia_avaliacao`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_servico_dia_pago": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos", "name": "recursos_sppo_servico_dia_pago", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_pago.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_pago.sql", "unique_id": "model.rj_smtr.recursos_sppo_servico_dia_pago", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos", "recursos_sppo_servico_dia_pago"], "alias": "recursos_sppo_servico_dia_pago", "checksum": {"name": "sha256", "checksum": "25376cce1816d66dbc2848009d045d14573ff7fd8e84f2d17d30743c9d85e954"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Recursos julgados e pagos (desconsideram-se os recursos que afetam a quinzena, sem data em espec\u00edfico)", "columns": {"data": {"name": "data", "description": "Data da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Tipo de dia (ex.: dia \u00fatil, s\u00e1bado, domingo ou ponto facultativo)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_recurso": {"name": "id_recurso", "description": "N\u00famero de ID do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_recurso": {"name": "tipo_recurso", "description": "Tipo de recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quinzena_ocorrencia": {"name": "quinzena_ocorrencia", "description": "Quinzena de ocorr\u00eancia do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quinzena_pagamento": {"name": "quinzena_pagamento", "description": "Quinzena de pagamento do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 006, 010, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor pago devido ao recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_recursos/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "br_rj_riodejaneiro_recursos"}, "created_at": 1727709588.6069002, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`", "raw_code": "{{ config(\n  materialized = \"table\",\n) }}\n\nWITH\n  -- 1. Trata os IDs de recurso de forma que, caso tenha mais que um, sempre estejam separados por v\u00edrgula, ordenados do menor para o maior e sem espa\u00e7os adicionais\n  treated_id_recurso AS (\n  SELECT\n    DISTINCT *\n  FROM (\n    SELECT\n      id_recurso_old,\n      ARRAY_TO_STRING(ARRAY(\n        SELECT\n          TRIM(id)\n        FROM\n          UNNEST(id_array) AS id\n        ORDER BY\n          id), \", \") AS id_recurso\n    FROM (\n      SELECT\n        id_recurso AS id_recurso_old,\n        SPLIT(REPLACE(id_recurso, \" e \", \", \"), \", \") AS id_array\n      FROM\n        {{ source(\"br_rj_riodejaneiro_recursos_staging\", \"recursos_sppo_servico_dia_pago\") }}\n  ))),\n  -- 2. Trata a tabela em staging\n  treated_recurso AS (\n  SELECT\n    * EXCEPT(DATA,\n      valor_pago,\n      tipo_dia),\n    PARSE_DATE(\"%d/%m/%Y\", DATA) AS DATA,\n    SAFE_CAST(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(valor_pago, r\"\\.\", \"\"), r\",\", \".\"), r\"[^\\d\\.-]\", \"\") AS FLOAT64) AS valor_pago,\n    CASE\n      WHEN tipo_dia LIKE \"R$%\" OR tipo_dia = \"\" THEN NULL\n    ELSE\n    tipo_dia\n  END\n    AS tipo_dia\n  FROM\n    {{ source(\"br_rj_riodejaneiro_recursos_staging\", \"recursos_sppo_servico_dia_pago\") }}\n  WHERE\n    DATA NOT LIKE \"%-%\" )\nSELECT\n  data,\n  tipo_dia,\n  i.id_recurso,\n  tipo_recurso,\n  quinzena_ocorrencia,\n  quinzena_pagamento,\n  consorcio,\n  servico,\n  valor_pago\nFROM\n  treated_recurso AS t\nLEFT JOIN\n  treated_id_recurso AS i\nON\n  t.id_recurso = i.id_recurso_old", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_recursos_staging", "recursos_sppo_servico_dia_pago"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos/recursos_sppo_servico_dia_pago.sql", "compiled": true, "compiled_code": "\n\nWITH\n  -- 1. Trata os IDs de recurso de forma que, caso tenha mais que um, sempre estejam separados por v\u00edrgula, ordenados do menor para o maior e sem espa\u00e7os adicionais\n  treated_id_recurso AS (\n  SELECT\n    DISTINCT *\n  FROM (\n    SELECT\n      id_recurso_old,\n      ARRAY_TO_STRING(ARRAY(\n        SELECT\n          TRIM(id)\n        FROM\n          UNNEST(id_array) AS id\n        ORDER BY\n          id), \", \") AS id_recurso\n    FROM (\n      SELECT\n        id_recurso AS id_recurso_old,\n        SPLIT(REPLACE(id_recurso, \" e \", \", \"), \", \") AS id_array\n      FROM\n        `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_servico_dia_pago`\n  ))),\n  -- 2. Trata a tabela em staging\n  treated_recurso AS (\n  SELECT\n    * EXCEPT(DATA,\n      valor_pago,\n      tipo_dia),\n    PARSE_DATE(\"%d/%m/%Y\", DATA) AS DATA,\n    SAFE_CAST(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(valor_pago, r\"\\.\", \"\"), r\",\", \".\"), r\"[^\\d\\.-]\", \"\") AS FLOAT64) AS valor_pago,\n    CASE\n      WHEN tipo_dia LIKE \"R$%\" OR tipo_dia = \"\" THEN NULL\n    ELSE\n    tipo_dia\n  END\n    AS tipo_dia\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_servico_dia_pago`\n  WHERE\n    DATA NOT LIKE \"%-%\" )\nSELECT\n  data,\n  tipo_dia,\n  i.id_recurso,\n  tipo_recurso,\n  quinzena_ocorrencia,\n  quinzena_pagamento,\n  consorcio,\n  servico,\n  valor_pago\nFROM\n  treated_recurso AS t\nLEFT JOIN\n  treated_id_recurso AS i\nON\n  t.id_recurso = i.id_recurso_old", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_viagens_individuais": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos", "name": "recursos_sppo_viagens_individuais", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos/recursos_sppo_viagens_individuais.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos/recursos_sppo_viagens_individuais.sql", "unique_id": "model.rj_smtr.recursos_sppo_viagens_individuais", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos", "recursos_sppo_viagens_individuais"], "alias": "recursos_sppo_viagens_individuais", "checksum": {"name": "sha256", "checksum": "0386d2d81433c82c235bb623ca9838cc0e6f4e68b526429d198c6f56ba60ecfd"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_recurso", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Recursos abertos na plataforma Movidesk para pagamento de subs\u00eddio de viagens individuais de \u00f4nibus", "columns": {"id_recurso": {"name": "id_recurso", "description": "N\u00famero de id do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo_numeral": {"name": "id_veiculo_numeral", "description": "N\u00famero de identifica\u00e7\u00e3o do ve\u00edculo (Somente n\u00fameros)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Tipo do servi\u00e7o de \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Datetime da partida da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Datetime da chegada da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data/hora de captura dos dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_recurso": {"name": "datetime_recurso", "description": "Data/hora de cria\u00e7\u00e3o do ticket para pedido de recurso no Movidesk", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "motivo_recurso": {"name": "motivo_recurso", "description": "Motivo para cria\u00e7\u00e3o do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "julgamento": {"name": "julgamento", "description": "Julgamento do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "motivo_julgamento": {"name": "motivo_julgamento", "description": "Motivos para julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "observacao_julgamento": {"name": "observacao_julgamento", "description": "Observa\u00e7\u00f5es acerca do julgamentodo recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do recurso (parti\u00e7\u00e3o da tabela)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_julgamento": {"name": "data_julgamento", "description": "Data do julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_update": {"name": "datetime_update", "description": "Datetime de atualiza\u00e7\u00e3o do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_recursos/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_recurso"}, "created_at": 1727709588.6029236, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_viagens_individuais`", "raw_code": "{{ config(\n  materialized = 'incremental',\n  partition_by = { 'field' :'data',\n    'data_type' :'date',\n    'granularity': 'day' },\n      unique_key = 'id_recurso',\n) }}\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_viagens_individuais') }},\n    UNNEST(items) items\n\n  {% if is_incremental() -%}\n    WHERE\n      DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '111870', '111871', '111872', '111873',\n        '111901', '111865', '111867', '111868',\n        '111869', '111866', '111904', '125615',\n        '111900'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    SAFE_CAST(p.111870 AS STRING) AS consorcio,\n    CASE\n      WHEN SAFE_CAST(p.111872 AS STRING) = \"SR - Regular\" THEN SAFE_CAST(p.111871 AS STRING)\n      ELSE CONCAT(REPLACE(SPLIT(SAFE_CAST(p.111872 AS STRING), \"-\")[OFFSET(0)], \" \", \"\"), SAFE_CAST(p.111871 AS STRING))\n    END AS servico,\n    SAFE_CAST(p.111873 AS STRING) AS id_veiculo,\n    CASE\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Ida\" THEN \"I\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Volta\" THEN \"V\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Circular\" THEN \"C\"\n    END\n      AS sentido,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez',SAFE_CAST(p.111867 AS STRING), 'America/Sao_Paulo') AS data_viagem,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(p.111868 AS STRING), 'America/Sao_Paulo') AS hora_inicio_viagem,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(p.111869 AS STRING), 'America/Sao_Paulo') AS hora_fim_viagem,\n    SAFE_CAST(p.111866 AS STRING) AS motivo,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn=1\n)\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      t.consorcio,\n      t.servico,\n      t.sentido,\n      t.id_veiculo AS id_veiculo_numeral,\n      DATETIME(EXTRACT(date FROM TIMESTAMP(data_viagem)), EXTRACT(time FROM TIMESTAMP_SUB(hora_inicio_viagem, INTERVAL 2 HOUR)) ) AS datetime_partida,\n      CASE\n        WHEN\n          EXTRACT(time FROM TIMESTAMP_SUB(hora_inicio_viagem, INTERVAL 2 HOUR)) > EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR))\n\n        THEN\n          DATETIME(EXTRACT(date FROM TIMESTAMP_ADD(data_viagem, INTERVAL 1 DAY)), EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR)))\n        ELSE\n          DATETIME(EXTRACT(date FROM TIMESTAMP(data_viagem)),\n            EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR))\n          )\n      END AS datetime_chegada,\n      t.motivo AS motivo_recurso,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\nLEFT JOIN\n    {{ ref('recursos_sppo_viagens_individuais_ultimo_julgamento') }} AS j\n\n  ON t.id_recurso = j.id_recurso", "language": "sql", "refs": [{"name": "staging_recursos_sppo_viagens_individuais", "package": null, "version": null}, {"name": "recursos_sppo_viagens_individuais_ultimo_julgamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_viagens_individuais", "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos/recursos_sppo_viagens_individuais.sql", "compiled": true, "compiled_code": "\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_viagens_individuais`,\n    UNNEST(items) items\n\n  WHERE\n      DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '111870', '111871', '111872', '111873',\n        '111901', '111865', '111867', '111868',\n        '111869', '111866', '111904', '125615',\n        '111900'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    SAFE_CAST(p.111870 AS STRING) AS consorcio,\n    CASE\n      WHEN SAFE_CAST(p.111872 AS STRING) = \"SR - Regular\" THEN SAFE_CAST(p.111871 AS STRING)\n      ELSE CONCAT(REPLACE(SPLIT(SAFE_CAST(p.111872 AS STRING), \"-\")[OFFSET(0)], \" \", \"\"), SAFE_CAST(p.111871 AS STRING))\n    END AS servico,\n    SAFE_CAST(p.111873 AS STRING) AS id_veiculo,\n    CASE\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Ida\" THEN \"I\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Volta\" THEN \"V\"\n        WHEN SAFE_CAST(p.111901 AS STRING) = \"Circular\" THEN \"C\"\n    END\n      AS sentido,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez',SAFE_CAST(p.111867 AS STRING), 'America/Sao_Paulo') AS data_viagem,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(p.111868 AS STRING), 'America/Sao_Paulo') AS hora_inicio_viagem,\n    PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E*S%Ez', SAFE_CAST(p.111869 AS STRING), 'America/Sao_Paulo') AS hora_fim_viagem,\n    SAFE_CAST(p.111866 AS STRING) AS motivo,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn=1\n)\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      t.consorcio,\n      t.servico,\n      t.sentido,\n      t.id_veiculo AS id_veiculo_numeral,\n      DATETIME(EXTRACT(date FROM TIMESTAMP(data_viagem)), EXTRACT(time FROM TIMESTAMP_SUB(hora_inicio_viagem, INTERVAL 2 HOUR)) ) AS datetime_partida,\n      CASE\n        WHEN\n          EXTRACT(time FROM TIMESTAMP_SUB(hora_inicio_viagem, INTERVAL 2 HOUR)) > EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR))\n\n        THEN\n          DATETIME(EXTRACT(date FROM TIMESTAMP_ADD(data_viagem, INTERVAL 1 DAY)), EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR)))\n        ELSE\n          DATETIME(EXTRACT(date FROM TIMESTAMP(data_viagem)),\n            EXTRACT(time FROM TIMESTAMP_SUB(hora_fim_viagem, INTERVAL 2 HOUR))\n          )\n      END AS datetime_chegada,\n      t.motivo AS motivo_recurso,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\nLEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_viagens_individuais_ultimo_julgamento` AS j\n\n  ON t.id_recurso = j.id_recurso", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.recursos_sppo_reprocessamento": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_recursos", "name": "recursos_sppo_reprocessamento", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_recursos/recursos_sppo_reprocessamento.sql", "original_file_path": "models/br_rj_riodejaneiro_recursos/recursos_sppo_reprocessamento.sql", "unique_id": "model.rj_smtr.recursos_sppo_reprocessamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos", "recursos_sppo_reprocessamento"], "alias": "recursos_sppo_reprocessamento", "checksum": {"name": "sha256", "checksum": "f8adcf21c2d058733322622bd35ba6f651c04b89dc4cb1c91e616f78ae754267"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_recursos", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_recurso", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Recursos abertos na plataforma Movidesk para pagamento de subs\u00eddio de reprocessamento", "columns": {"id_recurso": {"name": "id_recurso", "description": "N\u00famero de id do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "julgamento": {"name": "julgamento", "description": "Julgamento do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "motivo_julgamento": {"name": "motivo_julgamento", "description": "Motivos para julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "observacao_julgamento": {"name": "observacao_julgamento", "description": "Observa\u00e7\u00f5es acerca do julgamentodo recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data/hora de captura dos dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_recurso": {"name": "datetime_recurso", "description": "Data/hora de cria\u00e7\u00e3o do ticket para pedido de recurso no Movidesk", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_update": {"name": "datetime_update", "description": "Datetime de atualiza\u00e7\u00e3o do recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do recurso (parti\u00e7\u00e3o da tabela)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_hora_inicio_viagem": {"name": "data_hora_inicio_viagem", "description": "Data e hora de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_hora_fim_viagem": {"name": "data_hora_fim_viagem", "description": "Data e hora de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_julgamento": {"name": "data_julgamento", "description": "Data do julgamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_recursos/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_recursos", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_recurso"}, "created_at": 1727709588.6052034, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_reprocessamento`", "raw_code": "{{ config(\n  materialized = 'incremental',\n  partition_by = { 'field' :'data',\n    'data_type' :'date',\n    'granularity': 'day' },\n      unique_key = 'id_recurso',\n) }}\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    {{ ref('staging_recursos_sppo_reprocessamento') }},\n    UNNEST(items) items\n\n  {% if is_incremental() -%}\n  WHERE\n    DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\")\n        AND DATE(\"{{var('date_range_end')}}\")\n  {%- endif %}\n\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '113816', '113817', '111865','111866','111904',\n        '111900', '125615'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', SAFE_CAST(p.113816 AS STRING), 'America/Sao_Paulo') AS data_hora_inicio,\n    PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', SAFE_CAST(p.113817 AS STRING), 'America/Sao_Paulo') AS data_hora_fim,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn = 1\n)\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      DATETIME(TIMESTAMP_SUB(data_hora_inicio, INTERVAL 3 HOUR)) AS data_hora_inicio_viagem,\n      DATETIME(TIMESTAMP_SUB(data_hora_fim, INTERVAL 3 HOUR)) AS data_hora_fim_viagem,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\n\nLEFT JOIN\n\n    {{ ref('recursos_sppo_reprocessamento_ultimo_julgamento') }} AS j\n\n  ON t.id_recurso = j.id_recurso", "language": "sql", "refs": [{"name": "staging_recursos_sppo_reprocessamento", "package": null, "version": null}, {"name": "recursos_sppo_reprocessamento_ultimo_julgamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_recursos_sppo_reprocessamento", "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_recursos/recursos_sppo_reprocessamento.sql", "compiled": true, "compiled_code": "\n\nWITH exploded AS (\n  SELECT\n    id_recurso,\n    datetime_recurso,\n    datetime_captura,\n    datetime_update,\n    SAFE_CAST(COALESCE(JSON_VALUE(items, '$.value'), JSON_VALUE(items, '$.items[0].customFieldItem')) AS STRING\n    ) AS value,\n    SAFE_CAST(JSON_EXTRACT(items, '$.customFieldId') AS STRING ) AS field_id\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`staging_recursos_sppo_reprocessamento`,\n    UNNEST(items) items\n\n  WHERE\n    DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\")\n        AND DATE(\"2022-01-01T01:00:00\")\n\n),\npivotado AS (\n  SELECT *,\n  ROW_NUMBER() OVER(PARTITION BY id_recurso ORDER BY datetime_captura DESC) AS rn,\n  FROM\n    exploded PIVOT(\n      ANY_VALUE(value) FOR field_id IN (\n        '113816', '113817', '111865','111866','111904',\n        '111900', '125615'\n      )\n    )\n),\ntratado AS (\n  SELECT\n    id_recurso,\n    datetime_captura,\n    datetime_recurso,\n    datetime_update,\n    SAFE_CAST(p.111865 AS STRING) AS julgamento,\n    PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', SAFE_CAST(p.113816 AS STRING), 'America/Sao_Paulo') AS data_hora_inicio,\n    PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S', SAFE_CAST(p.113817 AS STRING), 'America/Sao_Paulo') AS data_hora_fim,\n    COALESCE(SAFE_CAST(p.111904 AS STRING), SAFE_CAST(p.111900 AS STRING)) AS motivo_julgamento,\n    SAFE_CAST(p.125615 AS STRING) AS observacao,\n\n  FROM\n    pivotado p\n  WHERE rn = 1\n)\nSELECT\n      t.id_recurso,\n      DATE(datetime_recurso) AS data,\n      t.datetime_captura,\n      t.datetime_recurso,\n      t.datetime_update,\n      DATETIME(TIMESTAMP_SUB(data_hora_inicio, INTERVAL 3 HOUR)) AS data_hora_inicio_viagem,\n      DATETIME(TIMESTAMP_SUB(data_hora_fim, INTERVAL 3 HOUR)) AS data_hora_fim_viagem,\n      t.julgamento,\n      t.motivo_julgamento,\n      t.observacao AS observacao_julgamento,\n      j.data_julgamento\n\nFROM\n      tratado t\n\nLEFT JOIN\n\n    `rj-smtr`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_reprocessamento_ultimo_julgamento` AS j\n\n  ON t.id_recurso = j.id_recurso", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.integracao_nao_realizada": {"database": "rj-smtr", "schema": "validacao_dados_jae", "name": "integracao_nao_realizada", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/integracao_nao_realizada.sql", "original_file_path": "models/validacao_dados_jae/integracao_nao_realizada.sql", "unique_id": "model.rj_smtr.integracao_nao_realizada", "fqn": ["rj_smtr", "validacao_dados_jae", "integracao_nao_realizada"], "alias": "integracao_nao_realizada", "checksum": {"name": "sha256", "checksum": "f10dff2d9aca68205314113662a6960039f4c662ed30636449644f535da04f3e"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "materilized": "incremental"}, "tags": [], "description": "Tabela contendo integra\u00e7\u00f5es que deveriam ter ocorrido mas n\u00e3o est\u00e3o listadas na base da Ja\u00e9", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao": {"name": "id_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o (\u00e9 igual ao id_transacao da primeira transa\u00e7\u00e3o da integra\u00e7\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sequencia_integracao": {"name": "sequencia_integracao", "description": "Sequ\u00eancia da transa\u00e7\u00e3o dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_transacao": {"name": "datetime_transacao", "description": "Data e hora da transa\u00e7\u00e3o em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transacao": {"name": "id_transacao", "description": "Identificador \u00fanico da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido de opera\u00e7\u00e3o do servi\u00e7o (0 = ida, 1 = volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/validacao_dados_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae", "materilized": "incremental", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.6177173, "relation_name": "`rj-smtr`.`validacao_dados_jae`.`integracao_nao_realizada`", "raw_code": "{{\n  config(\n    materilized=\"incremental\",\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\n{% set transacao_table = ref('transacao') %}\n{% if execute %}\n  {% if is_incremental() %}\n\n    {% set partitions_query %}\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        `{{ transacao_table.database }}.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n        -- `rj-smtr.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATE(last_modified_time, \"America/Sao_Paulo\") BETWEEN DATE_SUB(DATE(\"{{var('run_date')}}\"), INTERVAL 1 DAY) AND DATE(\"{{var('run_date')}}\")\n    {% endset %}\n\n    {{ log(\"Running query: \\n\"~partitions_query, info=True) }}\n    {% set partitions = run_query(partitions_query) %}\n\n    {% set partition_list = partitions.columns[0].values() %}\n    {{ log(\"transacao partitions: \\n\"~partition_list, info=True) }}\n  {% endif %}\n{% endif %}\n\n{% set max_transactions = var('quantidade_integracoes_max') %} -- N\u00famero m\u00e1ximo de pernas em uma integra\u00e7\u00e3o\n{% set pivot_columns = [\"datetime_transacao\", \"id_transacao\", \"modo\", \"servico_sentido\"] %}\n{% set transaction_date_filter %}\n  {% if partition_list|length > 0 %}\n    {% for p in partition_list %}\n      (\n        data BETWEEN DATE_SUB(DATE({{ p }}), INTERVAL 1 DAY) AND DATE_ADD(DATE({{ p }}), INTERVAL 1 DAY)\n        AND\n          (\n            DATE(datetime_transacao) = DATE({{ p }})\n            OR DATE(DATETIME_SUB(datetime_transacao, INTERVAL 180 MINUTE)) = DATE({{ p }})\n            OR DATE(DATETIME_ADD(datetime_transacao, INTERVAL 180 MINUTE)) = DATE({{ p }})\n          )\n      )\n      {% if not loop.last %}OR{% endif %}\n    {% endfor %}\n  {% else %}\n    data = \"2000-01-01\"\n  {% endif %}\n{% endset %}\n\nWITH matriz AS (\n  SELECT\n    STRING_AGG(modo order by sequencia_integracao) AS sequencia_valida\n  FROM\n    {{ ref(\"matriz_integracao\") }}\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.matriz_integracao`\n  group by id_matriz_integracao\n),\ntransacao AS (\n  SELECT\n    id_cliente,\n    {% for column in pivot_columns %}\n      {% if column == \"servico_sentido\" %}\n        CONCAT(id_servico_jae, '_', sentido) AS servico_sentido,\n      {% else %}\n        {{ column }},\n      {% endif %}\n    {% endfor %}\n  FROM\n    {{ ref(\"transacao\") }}\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao`\n  WHERE\n    data < CURRENT_DATE(\"America/Sao_Paulo\")\n    AND tipo_transacao != \"Gratuidade\"\n    {% if is_incremental() %}\n      AND\n      {{ transaction_date_filter }}\n    {% endif %}\n),\ntransacao_agrupada AS (\n  SELECT\n    id_cliente,\n    -- Cria o conjunto de colunas para a transa\u00e7\u00e3o atual e as 4 pr\u00f3ximas transa\u00e7\u00f5es do cliente\n    {% for column in pivot_columns %}\n      {% for transaction_number in range(max_transactions) %}\n        {% if loop.first %}\n          {{ column }} AS {{ column }}_{{ transaction_number }},\n        {% else %}\n          LEAD({{ column }}, {{ loop.index0 }}) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS {{ column }}_{{ transaction_number }},\n        {% endif %}\n      {% endfor %}\n    {% endfor %}\n  FROM\n    transacao\n),\nintegracao_possivel AS (\n  SELECT\n    *,\n    {% set modos = [\"modo_0\"] %}\n    {% set servicos = [\"servico_sentido_0\"] %}\n    {% for transaction_number in range(1, max_transactions) %}\n      {% do modos.append(\"modo_\"~transaction_number) %}\n      (\n        DATETIME_DIFF(datetime_transacao_{{ transaction_number }}, datetime_transacao_0, MINUTE) <= 180\n        AND CONCAT({{ modos|join(\", ',', \") }}) IN (SELECT sequencia_valida FROM matriz)\n        {% if loop.first %}\n          AND servico_sentido_{{ transaction_number }} != servico_sentido_0\n        {% else %}\n          AND servico_sentido_{{ transaction_number }} NOT IN ({{ servicos|join(\", ',', \") }})\n        {% endif %}\n      ) AS indicador_integracao_{{ transaction_number }},\n      {% do servicos.append(\"servico_sentido_\"~transaction_number) %}\n\n    {% endfor %}\n  FROM\n    transacao_agrupada\n  WHERE\n    id_transacao_1 IS NOT NULL\n),\ntransacao_filtrada AS (\n  SELECT\n    id_cliente,\n    {% for column in pivot_columns %}\n      {% for transaction_number in range(max_transactions) %}\n        {% if transaction_number < 2 %}\n          {{ column }}_{{ transaction_number }},\n        {% else %}\n          CASE\n            WHEN\n              indicador_integracao_{{ transaction_number }} THEN {{ column }}_{{ transaction_number }}\n            END AS {{ column }}_{{ transaction_number }},\n        {% endif %}\n      {% endfor %}\n    {% endfor %}\n    indicador_integracao_1,\n    indicador_integracao_2,\n    indicador_integracao_3,\n    indicador_integracao_4\n  FROM\n    integracao_possivel\n  WHERE\n    indicador_integracao_1\n),\ntransacao_listada AS (\n  SELECT\n    *,\n    ARRAY_TO_STRING(\n      [\n        {% for i in range(1, max_transactions) %}\n          id_transacao_{{ i }} {% if not loop.last %},{% endif %}\n        {% endfor %}\n      ],\n      \", \"\n    ) AS transacoes\n  FROM\n    transacao_filtrada\n),\n{% for i in range(max_transactions - 1) %}\n  validacao_integracao_{{ max_transactions - i }}_pernas AS (\n    SELECT\n      (\n        id_transacao_{{ max_transactions - i - 1 }} IS NOT NULL\n        {% if not loop.first %}\n          AND id_transacao_{{ max_transactions - i }} IS NULL\n        {% endif %}\n        AND id_transacao_0 IN UNNEST(\n          SPLIT(\n            STRING_AGG(transacoes, \", \") OVER (PARTITION BY id_cliente ORDER BY datetime_transacao_0 ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING),\n            ', ')\n        )\n      ) AS remover_{{ max_transactions - i }},\n      *\n    FROM\n      {% if loop.first %}\n        transacao_listada\n      {% else %}\n        validacao_integracao_{{ max_transactions - i + 1 }}_pernas\n        WHERE\n          NOT remover_{{ max_transactions - i + 1 }}\n      {% endif %}\n  ),\n{% endfor %}\nintegracoes_validas AS (\n  SELECT\n    DATE(datetime_transacao_0) AS data,\n    id_transacao_0 AS id_integracao,\n    *\n  FROM\n    validacao_integracao_2_pernas\n  WHERE\n    NOT remover_2\n),\nmelted AS (\n  SELECT\n    data,\n    id_integracao,\n    sequencia_integracao,\n    datetime_transacao,\n    id_transacao,\n    modo,\n    SPLIT(servico_sentido, '_')[0] AS id_servico_jae,\n    SPLIT(servico_sentido, '_')[1] AS sentido,\n    COUNTIF(modo = \"BRT\") OVER(PARTITION BY id_integracao) > 1 AS indicador_transferencia\n  FROM\n    integracoes_validas,\n    UNNEST(\n      [\n        {% for transaction_number in range(max_transactions) %}\n          STRUCT(\n            {% for column in pivot_columns %}\n              {{ column }}_{{ transaction_number }} AS {{ column }},\n            {% endfor %}\n            {{ transaction_number + 1}} AS sequencia_integracao\n          ){%if not loop.last %},{% endif %}\n      {% endfor %}\n      ]\n    )\n),\nintegracao_nao_realizada AS (\n  SELECT DISTINCT\n    id_integracao\n  FROM\n    melted\n  WHERE\n    NOT indicador_transferencia\n    AND id_transacao NOT IN (\n      SELECT\n        id_transacao\n      FROM\n        {{ ref(\"integracao\") }}\n        -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.integracao`\n      {% if is_incremental() %}\n        WHERE\n          {{ transaction_date_filter }}\n      {% endif %}\n    )\n)\nSELECT\n  * EXCEPT(indicador_transferencia),\n  '{{ var(\"version\") }}' as versao\nFROM\n  melted\nWHERE\n  id_integracao IN (SELECT id_integracao FROM integracao_nao_realizada)\n  AND id_transacao IS NOT NULL", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "matriz_integracao", "package": null, "version": null}, {"name": "transacao", "package": null, "version": null}, {"name": "integracao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.matriz_integracao", "model.rj_smtr.integracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/integracao_nao_realizada.sql", "compiled": true, "compiled_code": "\n\n\n\n  \n\n    \n\n    \n    \n\n    \n    \n  \n\n\n -- N\u00famero m\u00e1ximo de pernas em uma integra\u00e7\u00e3o\n\n\n\nWITH matriz AS (\n  SELECT\n    STRING_AGG(modo order by sequencia_integracao) AS sequencia_valida\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`matriz_integracao`\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.matriz_integracao`\n  group by id_matriz_integracao\n),\ntransacao AS (\n  SELECT\n    id_cliente,\n    \n      \n        datetime_transacao,\n      \n    \n      \n        id_transacao,\n      \n    \n      \n        modo,\n      \n    \n      \n        CONCAT(id_servico_jae, '_', sentido) AS servico_sentido,\n      \n    \n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao`\n    -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.transacao`\n  WHERE\n    data < CURRENT_DATE(\"America/Sao_Paulo\")\n    AND tipo_transacao != \"Gratuidade\"\n    \n      AND\n      \n  \n    data = \"2000-01-01\"\n  \n\n    \n),\ntransacao_agrupada AS (\n  SELECT\n    id_cliente,\n    -- Cria o conjunto de colunas para a transa\u00e7\u00e3o atual e as 4 pr\u00f3ximas transa\u00e7\u00f5es do cliente\n    \n      \n        \n          datetime_transacao AS datetime_transacao_0,\n        \n      \n        \n          LEAD(datetime_transacao, 1) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS datetime_transacao_1,\n        \n      \n        \n          LEAD(datetime_transacao, 2) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS datetime_transacao_2,\n        \n      \n        \n          LEAD(datetime_transacao, 3) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS datetime_transacao_3,\n        \n      \n        \n          LEAD(datetime_transacao, 4) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS datetime_transacao_4,\n        \n      \n    \n      \n        \n          id_transacao AS id_transacao_0,\n        \n      \n        \n          LEAD(id_transacao, 1) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS id_transacao_1,\n        \n      \n        \n          LEAD(id_transacao, 2) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS id_transacao_2,\n        \n      \n        \n          LEAD(id_transacao, 3) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS id_transacao_3,\n        \n      \n        \n          LEAD(id_transacao, 4) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS id_transacao_4,\n        \n      \n    \n      \n        \n          modo AS modo_0,\n        \n      \n        \n          LEAD(modo, 1) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS modo_1,\n        \n      \n        \n          LEAD(modo, 2) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS modo_2,\n        \n      \n        \n          LEAD(modo, 3) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS modo_3,\n        \n      \n        \n          LEAD(modo, 4) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS modo_4,\n        \n      \n    \n      \n        \n          servico_sentido AS servico_sentido_0,\n        \n      \n        \n          LEAD(servico_sentido, 1) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS servico_sentido_1,\n        \n      \n        \n          LEAD(servico_sentido, 2) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS servico_sentido_2,\n        \n      \n        \n          LEAD(servico_sentido, 3) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS servico_sentido_3,\n        \n      \n        \n          LEAD(servico_sentido, 4) OVER (PARTITION BY id_cliente ORDER BY datetime_transacao) AS servico_sentido_4,\n        \n      \n    \n  FROM\n    transacao\n),\nintegracao_possivel AS (\n  SELECT\n    *,\n    \n    \n    \n      \n      (\n        DATETIME_DIFF(datetime_transacao_1, datetime_transacao_0, MINUTE) <= 180\n        AND CONCAT(modo_0, ',', modo_1) IN (SELECT sequencia_valida FROM matriz)\n        \n          AND servico_sentido_1 != servico_sentido_0\n        \n      ) AS indicador_integracao_1,\n      \n\n    \n      \n      (\n        DATETIME_DIFF(datetime_transacao_2, datetime_transacao_0, MINUTE) <= 180\n        AND CONCAT(modo_0, ',', modo_1, ',', modo_2) IN (SELECT sequencia_valida FROM matriz)\n        \n          AND servico_sentido_2 NOT IN (servico_sentido_0, ',', servico_sentido_1)\n        \n      ) AS indicador_integracao_2,\n      \n\n    \n      \n      (\n        DATETIME_DIFF(datetime_transacao_3, datetime_transacao_0, MINUTE) <= 180\n        AND CONCAT(modo_0, ',', modo_1, ',', modo_2, ',', modo_3) IN (SELECT sequencia_valida FROM matriz)\n        \n          AND servico_sentido_3 NOT IN (servico_sentido_0, ',', servico_sentido_1, ',', servico_sentido_2)\n        \n      ) AS indicador_integracao_3,\n      \n\n    \n      \n      (\n        DATETIME_DIFF(datetime_transacao_4, datetime_transacao_0, MINUTE) <= 180\n        AND CONCAT(modo_0, ',', modo_1, ',', modo_2, ',', modo_3, ',', modo_4) IN (SELECT sequencia_valida FROM matriz)\n        \n          AND servico_sentido_4 NOT IN (servico_sentido_0, ',', servico_sentido_1, ',', servico_sentido_2, ',', servico_sentido_3)\n        \n      ) AS indicador_integracao_4,\n      \n\n    \n  FROM\n    transacao_agrupada\n  WHERE\n    id_transacao_1 IS NOT NULL\n),\ntransacao_filtrada AS (\n  SELECT\n    id_cliente,\n    \n      \n        \n          datetime_transacao_0,\n        \n      \n        \n          datetime_transacao_1,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_2 THEN datetime_transacao_2\n            END AS datetime_transacao_2,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_3 THEN datetime_transacao_3\n            END AS datetime_transacao_3,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_4 THEN datetime_transacao_4\n            END AS datetime_transacao_4,\n        \n      \n    \n      \n        \n          id_transacao_0,\n        \n      \n        \n          id_transacao_1,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_2 THEN id_transacao_2\n            END AS id_transacao_2,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_3 THEN id_transacao_3\n            END AS id_transacao_3,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_4 THEN id_transacao_4\n            END AS id_transacao_4,\n        \n      \n    \n      \n        \n          modo_0,\n        \n      \n        \n          modo_1,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_2 THEN modo_2\n            END AS modo_2,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_3 THEN modo_3\n            END AS modo_3,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_4 THEN modo_4\n            END AS modo_4,\n        \n      \n    \n      \n        \n          servico_sentido_0,\n        \n      \n        \n          servico_sentido_1,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_2 THEN servico_sentido_2\n            END AS servico_sentido_2,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_3 THEN servico_sentido_3\n            END AS servico_sentido_3,\n        \n      \n        \n          CASE\n            WHEN\n              indicador_integracao_4 THEN servico_sentido_4\n            END AS servico_sentido_4,\n        \n      \n    \n    indicador_integracao_1,\n    indicador_integracao_2,\n    indicador_integracao_3,\n    indicador_integracao_4\n  FROM\n    integracao_possivel\n  WHERE\n    indicador_integracao_1\n),\ntransacao_listada AS (\n  SELECT\n    *,\n    ARRAY_TO_STRING(\n      [\n        \n          id_transacao_1 ,\n        \n          id_transacao_2 ,\n        \n          id_transacao_3 ,\n        \n          id_transacao_4 \n        \n      ],\n      \", \"\n    ) AS transacoes\n  FROM\n    transacao_filtrada\n),\n\n  validacao_integracao_5_pernas AS (\n    SELECT\n      (\n        id_transacao_4 IS NOT NULL\n        \n        AND id_transacao_0 IN UNNEST(\n          SPLIT(\n            STRING_AGG(transacoes, \", \") OVER (PARTITION BY id_cliente ORDER BY datetime_transacao_0 ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING),\n            ', ')\n        )\n      ) AS remover_5,\n      *\n    FROM\n      \n        transacao_listada\n      \n  ),\n\n  validacao_integracao_4_pernas AS (\n    SELECT\n      (\n        id_transacao_3 IS NOT NULL\n        \n          AND id_transacao_4 IS NULL\n        \n        AND id_transacao_0 IN UNNEST(\n          SPLIT(\n            STRING_AGG(transacoes, \", \") OVER (PARTITION BY id_cliente ORDER BY datetime_transacao_0 ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING),\n            ', ')\n        )\n      ) AS remover_4,\n      *\n    FROM\n      \n        validacao_integracao_5_pernas\n        WHERE\n          NOT remover_5\n      \n  ),\n\n  validacao_integracao_3_pernas AS (\n    SELECT\n      (\n        id_transacao_2 IS NOT NULL\n        \n          AND id_transacao_3 IS NULL\n        \n        AND id_transacao_0 IN UNNEST(\n          SPLIT(\n            STRING_AGG(transacoes, \", \") OVER (PARTITION BY id_cliente ORDER BY datetime_transacao_0 ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING),\n            ', ')\n        )\n      ) AS remover_3,\n      *\n    FROM\n      \n        validacao_integracao_4_pernas\n        WHERE\n          NOT remover_4\n      \n  ),\n\n  validacao_integracao_2_pernas AS (\n    SELECT\n      (\n        id_transacao_1 IS NOT NULL\n        \n          AND id_transacao_2 IS NULL\n        \n        AND id_transacao_0 IN UNNEST(\n          SPLIT(\n            STRING_AGG(transacoes, \", \") OVER (PARTITION BY id_cliente ORDER BY datetime_transacao_0 ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING),\n            ', ')\n        )\n      ) AS remover_2,\n      *\n    FROM\n      \n        validacao_integracao_3_pernas\n        WHERE\n          NOT remover_3\n      \n  ),\n\nintegracoes_validas AS (\n  SELECT\n    DATE(datetime_transacao_0) AS data,\n    id_transacao_0 AS id_integracao,\n    *\n  FROM\n    validacao_integracao_2_pernas\n  WHERE\n    NOT remover_2\n),\nmelted AS (\n  SELECT\n    data,\n    id_integracao,\n    sequencia_integracao,\n    datetime_transacao,\n    id_transacao,\n    modo,\n    SPLIT(servico_sentido, '_')[0] AS id_servico_jae,\n    SPLIT(servico_sentido, '_')[1] AS sentido,\n    COUNTIF(modo = \"BRT\") OVER(PARTITION BY id_integracao) > 1 AS indicador_transferencia\n  FROM\n    integracoes_validas,\n    UNNEST(\n      [\n        \n          STRUCT(\n            \n              datetime_transacao_0 AS datetime_transacao,\n            \n              id_transacao_0 AS id_transacao,\n            \n              modo_0 AS modo,\n            \n              servico_sentido_0 AS servico_sentido,\n            \n            1 AS sequencia_integracao\n          ),\n      \n          STRUCT(\n            \n              datetime_transacao_1 AS datetime_transacao,\n            \n              id_transacao_1 AS id_transacao,\n            \n              modo_1 AS modo,\n            \n              servico_sentido_1 AS servico_sentido,\n            \n            2 AS sequencia_integracao\n          ),\n      \n          STRUCT(\n            \n              datetime_transacao_2 AS datetime_transacao,\n            \n              id_transacao_2 AS id_transacao,\n            \n              modo_2 AS modo,\n            \n              servico_sentido_2 AS servico_sentido,\n            \n            3 AS sequencia_integracao\n          ),\n      \n          STRUCT(\n            \n              datetime_transacao_3 AS datetime_transacao,\n            \n              id_transacao_3 AS id_transacao,\n            \n              modo_3 AS modo,\n            \n              servico_sentido_3 AS servico_sentido,\n            \n            4 AS sequencia_integracao\n          ),\n      \n          STRUCT(\n            \n              datetime_transacao_4 AS datetime_transacao,\n            \n              id_transacao_4 AS id_transacao,\n            \n              modo_4 AS modo,\n            \n              servico_sentido_4 AS servico_sentido,\n            \n            5 AS sequencia_integracao\n          )\n      \n      ]\n    )\n),\nintegracao_nao_realizada AS (\n  SELECT DISTINCT\n    id_integracao\n  FROM\n    melted\n  WHERE\n    NOT indicador_transferencia\n    AND id_transacao NOT IN (\n      SELECT\n        id_transacao\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`integracao`\n        -- `rj-smtr.br_rj_riodejaneiro_bilhetagem.integracao`\n      \n        WHERE\n          \n  \n    data = \"2000-01-01\"\n  \n\n      \n    )\n)\nSELECT\n  * EXCEPT(indicador_transferencia),\n  '' as versao\nFROM\n  melted\nWHERE\n  id_integracao IN (SELECT id_integracao FROM integracao_nao_realizada)\n  AND id_transacao IS NOT NULL", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.integracao_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae", "name": "integracao_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/integracao_invalida.sql", "original_file_path": "models/validacao_dados_jae/integracao_invalida.sql", "unique_id": "model.rj_smtr.integracao_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "integracao_invalida"], "alias": "integracao_invalida", "checksum": {"name": "sha256", "checksum": "4ec3d41488c2808bb0854f08b4b3089053e64fb4538e93bcaf7afc348c49acc4"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela para valida\u00e7\u00e3o dos dados de integra\u00e7\u00e3o da Ja\u00e9", "columns": {"data": {"name": "data", "description": "Data de processamento da integra\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_integracao": {"name": "id_integracao", "description": "Identificador \u00fanico da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modos": {"name": "modos", "description": "Sequ\u00eancia modos das transa\u00e7\u00f5es presentes na integra\u00e7\u00e3o (separado por ', ')", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_fora_matriz": {"name": "indicador_fora_matriz", "description": "Indica se a sequ\u00eancia de modos n\u00e3o aparece na tabela br_rj_riodejaneiro_bilhetagem.matriz_integracao", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_tempo_integracao_invalido": {"name": "indicador_tempo_integracao_invalido", "description": "Indica se o tempo entre a primeira e a \u00faltima transa\u00e7\u00e3o da integra\u00e7\u00e3o \u00e9 maior que 3 horas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_intervalo_transacao_suspeito": {"name": "indicador_intervalo_transacao_suspeito", "description": "Indica se existe algum intervalo entre transa\u00e7\u00f5es menor que 5 minutos dentro da integra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/validacao_dados_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.608865, "relation_name": "`rj-smtr`.`validacao_dados_jae`.`integracao_invalida`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\n{% set integracao_table = ref('integracao') %}\n{% if execute %}\n  {% if is_incremental() %}\n\n    {% set partitions_query %}\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        `{{ integracao_table.database }}.{{ integracao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ integracao_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATE(last_modified_time, \"America/Sao_Paulo\") = DATE_SUB(DATE(\"{{var('run_date')}}\"), INTERVAL 1 DAY)\n    {% endset %}\n\n    {{ log(\"Running query: \\n\"~partitions_query, info=True) }}\n    {% set partitions = run_query(partitions_query) %}\n\n    {% set partition_list = partitions.columns[0].values() %}\n    {{ log(\"integracao partitions: \\n\"~partition_list, info=True) }}\n  {% endif %}\n{% endif %}\n\nWITH sequencias_validas AS (\n  SELECT\n    id_matriz_integracao,\n    STRING_AGG(modo, ', ' ORDER BY sequencia_integracao) AS modos\n  FROM\n    {{ ref(\"matriz_integracao\") }}\n  GROUP BY\n    id_matriz_integracao\n),\nintegracao_agg AS (\n  SELECT\n    DATE(datetime_processamento_integracao) AS data,\n    id_integracao,\n    STRING_AGG(modo, ', ' ORDER BY sequencia_integracao) AS modos,\n    MIN(datetime_transacao) AS datetime_primeira_transacao,\n    MAX(datetime_transacao) AS datetime_ultima_transacao,\n    MIN(intervalo_integracao) AS menor_intervalo\n  FROM\n    {{ ref(\"integracao\") }}\n    {% if is_incremental() %}\n      WHERE\n      {% if partition_list|length > 0 %}\n        data IN ({{ partition_list|join(', ') }})\n      {% else %}\n        data = \"2000-01-01\"\n      {% endif %}\n    {% endif %}\n  GROUP BY\n    1,\n    2\n),\nindicadores AS (\n  SELECT\n    data,\n    id_integracao,\n    modos,\n    modos NOT IN (SELECT DISTINCT modos FROM sequencias_validas) AS indicador_fora_matriz,\n    TIMESTAMP_DIFF(datetime_ultima_transacao, datetime_primeira_transacao, MINUTE) > 180 AS indicador_tempo_integracao_invalido,\n    menor_intervalo < 5 AS indicador_intervalo_transacao_suspeito\n  FROM\n    integracao_agg\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' as versao\nFROM\n  indicadores\nWHERE\n  indicador_fora_matriz = TRUE\n  OR indicador_tempo_integracao_invalido = TRUE\n  OR indicador_intervalo_transacao_suspeito = TRUE", "language": "sql", "refs": [{"name": "integracao", "package": null, "version": null}, {"name": "matriz_integracao", "package": null, "version": null}, {"name": "integracao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.integracao", "model.rj_smtr.matriz_integracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/integracao_invalida.sql", "compiled": true, "compiled_code": "\n\n\n\n  \n\n    \n\n    \n    \n\n    \n    \n  \n\n\nWITH sequencias_validas AS (\n  SELECT\n    id_matriz_integracao,\n    STRING_AGG(modo, ', ' ORDER BY sequencia_integracao) AS modos\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`matriz_integracao`\n  GROUP BY\n    id_matriz_integracao\n),\nintegracao_agg AS (\n  SELECT\n    DATE(datetime_processamento_integracao) AS data,\n    id_integracao,\n    STRING_AGG(modo, ', ' ORDER BY sequencia_integracao) AS modos,\n    MIN(datetime_transacao) AS datetime_primeira_transacao,\n    MAX(datetime_transacao) AS datetime_ultima_transacao,\n    MIN(intervalo_integracao) AS menor_intervalo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`integracao`\n    \n      WHERE\n      \n        data = \"2000-01-01\"\n      \n    \n  GROUP BY\n    1,\n    2\n),\nindicadores AS (\n  SELECT\n    data,\n    id_integracao,\n    modos,\n    modos NOT IN (SELECT DISTINCT modos FROM sequencias_validas) AS indicador_fora_matriz,\n    TIMESTAMP_DIFF(datetime_ultima_transacao, datetime_primeira_transacao, MINUTE) > 180 AS indicador_tempo_integracao_invalido,\n    menor_intervalo < 5 AS indicador_intervalo_transacao_suspeito\n  FROM\n    integracao_agg\n)\nSELECT\n  *,\n  '' as versao\nFROM\n  indicadores\nWHERE\n  indicador_fora_matriz = TRUE\n  OR indicador_tempo_integracao_invalido = TRUE\n  OR indicador_intervalo_transacao_suspeito = TRUE", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae", "name": "ordem_pagamento_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/ordem_pagamento_invalida.sql", "original_file_path": "models/validacao_dados_jae/ordem_pagamento_invalida.sql", "unique_id": "model.rj_smtr.ordem_pagamento_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "ordem_pagamento_invalida"], "alias": "ordem_pagamento_invalida", "checksum": {"name": "sha256", "checksum": "b27b4020ee1fd073662aad7ee6e6b3f062cb089f221c74ba9ae9c1a1b3846299"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela para valida\u00e7\u00e3o dos dados da ordem de pagamento da Ja\u00e9", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador \u00fanico da ordem de pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_captura_invalida": {"name": "indicador_captura_invalida", "description": "Indica se o n\u00famero e valor das transa\u00e7\u00f5es capturadas \u00e9 diferente das informa\u00e7\u00f5es encontradas na ordem de pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_servico_fora_vigencia": {"name": "indicador_servico_fora_vigencia", "description": "Indica se houve alguma transa\u00e7\u00e3o feita em um servi\u00e7o fora de vig\u00eancia. Quando nulo informa que n\u00e3o foi poss\u00edvel encontrar a vig\u00eancia do servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_agregacao_consorcio_operador_dia_invalida": {"name": "indicador_agregacao_consorcio_operador_dia_invalida", "description": "Indica se os valores e quantidades da tabela ordem_pagamento_servico_operador_dia agregada por cons\u00f3rcio, operador e dia est\u00e1 diferente das informa\u00e7\u00f5es da tabela ordem_pagamento_consorcio_operador_dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_agregacao_consorcio_dia_invalida": {"name": "indicador_agregacao_consorcio_dia_invalida", "description": "Indica se os valores e quantidades da tabela ordem_pagamento_consorcio_operador_dia agregada por cons\u00f3rcio e dia est\u00e1 diferente das informa\u00e7\u00f5es da tabela ordem_pagamento_consorcio_dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_agregacao_dia_invalida": {"name": "indicador_agregacao_dia_invalida", "description": "Indica se os valores e quantidades da tabela ordem_pagamento_consorcio_dia agregada por dia est\u00e1 diferente das informa\u00e7\u00f5es da tabela ordem_pagamento_dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/validacao_dados_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.616877, "relation_name": "`rj-smtr`.`validacao_dados_jae`.`ordem_pagamento_invalida`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data_ordem\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH servico_operador_dia_invalida AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    MAX(indicador_captura_invalida) AS indicador_captura_invalida,\n    MAX(indicador_servico_fora_vigencia) AS indicador_servico_fora_vigencia\n  FROM\n    {{ ref(\"ordem_pagamento_servico_operador_dia_invalida\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n  GROUP BY\n    1,\n    2\n),\nconsorcio_operador_dia_invalida AS (\n  SELECT DISTINCT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_operador_dia_invalida\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nconsorcio_dia_invalida AS (\n  SELECT DISTINCT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_dia_invalida\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\ndia_invalida AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    {{ ref(\"ordem_pagamento_dia_invalida\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nindicadores AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    CASE\n      WHEN sod.id_ordem_pagamento IS NOT NULL THEN sod.indicador_captura_invalida\n      ELSE FALSE\n    END AS indicador_captura_invalida,\n    CASE\n      WHEN sod.id_ordem_pagamento IS NOT NULL THEN sod.indicador_servico_fora_vigencia\n      ELSE FALSE\n    END AS indicador_servico_fora_vigencia,\n    cod.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_consorcio_operador_dia_invalida,\n    cd.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_consorcio_dia_invalida,\n    d.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_dia_invalida,\n  FROM\n    dia_invalida d\n  FULL OUTER JOIN\n    servico_operador_dia_invalida sod\n  USING(data_ordem, id_ordem_pagamento)\n  FULL OUTER JOIN\n    consorcio_operador_dia_invalida cod\n  USING(data_ordem, id_ordem_pagamento)\n  FULL OUTER JOIN\n    consorcio_dia_invalida cd\n  USING(data_ordem, id_ordem_pagamento)\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_captura_invalida\n  OR indicador_servico_fora_vigencia\n  OR indicador_agregacao_consorcio_operador_dia_invalida\n  OR indicador_agregacao_consorcio_dia_invalida\n  OR indicador_agregacao_dia_invalida", "language": "sql", "refs": [{"name": "ordem_pagamento_servico_operador_dia_invalida", "package": null, "version": null}, {"name": "ordem_pagamento_consorcio_operador_dia_invalida", "package": null, "version": null}, {"name": "ordem_pagamento_consorcio_dia_invalida", "package": null, "version": null}, {"name": "ordem_pagamento_dia_invalida", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "model.rj_smtr.ordem_pagamento_dia_invalida"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/ordem_pagamento_invalida.sql", "compiled": true, "compiled_code": "\n\nWITH servico_operador_dia_invalida AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    MAX(indicador_captura_invalida) AS indicador_captura_invalida,\n    MAX(indicador_servico_fora_vigencia) AS indicador_servico_fora_vigencia\n  FROM\n    `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_servico_operador_dia_invalida`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n  GROUP BY\n    1,\n    2\n),\nconsorcio_operador_dia_invalida AS (\n  SELECT DISTINCT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_consorcio_operador_dia_invalida`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nconsorcio_dia_invalida AS (\n  SELECT DISTINCT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_consorcio_dia_invalida`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\ndia_invalida AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_dia_invalida`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nindicadores AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    CASE\n      WHEN sod.id_ordem_pagamento IS NOT NULL THEN sod.indicador_captura_invalida\n      ELSE FALSE\n    END AS indicador_captura_invalida,\n    CASE\n      WHEN sod.id_ordem_pagamento IS NOT NULL THEN sod.indicador_servico_fora_vigencia\n      ELSE FALSE\n    END AS indicador_servico_fora_vigencia,\n    cod.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_consorcio_operador_dia_invalida,\n    cd.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_consorcio_dia_invalida,\n    d.id_ordem_pagamento IS NOT NULL AS indicador_agregacao_dia_invalida,\n  FROM\n    dia_invalida d\n  FULL OUTER JOIN\n    servico_operador_dia_invalida sod\n  USING(data_ordem, id_ordem_pagamento)\n  FULL OUTER JOIN\n    consorcio_operador_dia_invalida cod\n  USING(data_ordem, id_ordem_pagamento)\n  FULL OUTER JOIN\n    consorcio_dia_invalida cd\n  USING(data_ordem, id_ordem_pagamento)\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_captura_invalida\n  OR indicador_servico_fora_vigencia\n  OR indicador_agregacao_consorcio_operador_dia_invalida\n  OR indicador_agregacao_consorcio_dia_invalida\n  OR indicador_agregacao_dia_invalida", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.transacao_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae", "name": "transacao_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/transacao_invalida.sql", "original_file_path": "models/validacao_dados_jae/transacao_invalida.sql", "unique_id": "model.rj_smtr.transacao_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "transacao_invalida"], "alias": "transacao_invalida", "checksum": {"name": "sha256", "checksum": "b780885a9e2d197c9cdf16ea3d233aebb6c92191babf303d12650c29d4bf2891"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela para valida\u00e7\u00e3o dos dados de transa\u00e7\u00e3o da Ja\u00e9", "columns": {"data": {"name": "data", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_transacao": {"name": "datetime_transacao", "description": "Data e hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_processamento": {"name": "datetime_processamento", "description": "Data e hora de processamento da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora de captura dos dados da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome da operadora de transporte (mascarado se for pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador da linha no banco de dados da ja\u00e9 (\u00c9 poss\u00edvel cruzar os dados com a tabela rj-smtr.cadastro.servicos usando a coluna id_servico_jae)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou c\u00f3digo da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome longo da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, 011SN, ...) ou nome da esta\u00e7\u00e3o de BRT na Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_transacao": {"name": "id_transacao", "description": "Identificador \u00fanico da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Longitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude da transa\u00e7\u00e3o (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude_servico": {"name": "longitude_servico", "description": "Longitude do stop no GTFS (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude_servico": {"name": "latitude_servico", "description": "Latitude do stop no GTFS (WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_geolocalizacao_zerada": {"name": "indicador_geolocalizacao_zerada", "description": "Indica se a transa\u00e7\u00e3o est\u00e1 com geolocaliza\u00e7\u00e3o zerada ou nula", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_geolocalizacao_fora_rio": {"name": "indicador_geolocalizacao_fora_rio", "description": "Indica se a transa\u00e7\u00e3o est\u00e1 com geolocaliza\u00e7\u00e3o fora do munic\u00edpio (transa\u00e7\u00f5es com geolocaliza\u00e7\u00e3o zeradas n\u00e3o se enquadram)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_geolocalizacao_fora_stop": {"name": "indicador_geolocalizacao_fora_stop", "description": "Indica se a transa\u00e7\u00e3o do modo BRT est\u00e1 com geolocaliza\u00e7\u00e3o a mais de 100m da esta\u00e7\u00e3o (transa\u00e7\u00f5es com geolocaliza\u00e7\u00e3o zeradas n\u00e3o se enquadram)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_geolocalizacao_invalida": {"name": "descricao_geolocalizacao_invalida", "description": "Resumo do tipo de geolocaliza\u00e7\u00e3o inv\u00e1lida de acordo com as colunas indicadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_servico_fora_gtfs": {"name": "indicador_servico_fora_gtfs", "description": "Indica se o servi\u00e7o n\u00e3o tem correspond\u00eancia com as tabela 'trips' ou 'stops' do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_servico_fora_vigencia": {"name": "indicador_servico_fora_vigencia", "description": "Indica se a transa\u00e7\u00e3o foi feita em um servi\u00e7o fora de vig\u00eancia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/validacao_dados_jae/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.614123, "relation_name": "`rj-smtr`.`validacao_dados_jae`.`transacao_invalida`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n{% set transacao_table = ref('transacao') %}\n{% if execute %}\n  {% if is_incremental() %}\n\n    {% set partitions_query %}\n      SELECT\n        CONCAT(\"'\", PARSE_DATE(\"%Y%m%d\", partition_id), \"'\") AS data\n      FROM\n        `{{ transacao_table.database }}.{{ transacao_table.schema }}.INFORMATION_SCHEMA.PARTITIONS`\n      WHERE\n        table_name = \"{{ transacao_table.identifier }}\"\n        AND partition_id != \"__NULL__\"\n        AND DATE(last_modified_time, \"America/Sao_Paulo\") = DATE_SUB(DATE(\"{{var('run_date')}}\"), INTERVAL 1 DAY)\n    {% endset %}\n\n    {{ log(\"Running query: \\n\"~partitions_query, info=True) }}\n    {% set partitions = run_query(partitions_query) %}\n\n    {% set partition_list = partitions.columns[0].values() %}\n    {{ log(\"trasacao partitions: \\n\"~partition_list, info=True) }}\n  {% endif %}\n{% endif %}\n\nWITH transacao AS (\n  SELECT\n    t.data,\n    t.hora,\n    t.datetime_transacao,\n    t.datetime_processamento,\n    t.datetime_captura,\n    t.modo,\n    t.id_consorcio,\n    t.consorcio,\n    t.id_operadora,\n    t.operadora,\n    t.id_servico_jae,\n    t.servico_jae,\n    t.descricao_servico_jae,\n    t.id_transacao,\n    t.longitude,\n    t.latitude,\n    IFNULL(t.longitude, 0) AS longitude_tratada,\n    IFNULL(t.latitude, 0) AS latitude_tratada,\n    s.longitude AS longitude_servico,\n    s.latitude AS latitude_servico,\n    s.id_servico_gtfs,\n    s.id_servico_jae AS id_servico_jae_cadastro\n  FROM\n    {{ ref(\"transacao\") }} t\n  LEFT JOIN\n    {{ ref(\"servicos\") }} s\n  ON\n    t.id_servico_jae = s.id_servico_jae\n    AND t.data >= s.data_inicio_vigencia AND (t.data <= s.data_fim_vigencia OR s.data_fim_vigencia IS NULL)\n    {% if is_incremental() %}\n      WHERE\n      {% if partition_list|length > 0 %}\n        data IN ({{ partition_list|join(', ') }})\n      {% else %}\n        data = \"2000-01-01\"\n      {% endif %}\n    {% endif %}\n),\nindicadores AS (\n  SELECT\n    * EXCEPT(id_servico_gtfs, latitude_tratada, longitude_tratada, id_servico_jae_cadastro),\n    latitude_tratada = 0 OR longitude_tratada = 0 AS indicador_geolocalizacao_zerada,\n    (\n      (latitude_tratada != 0 OR longitude_tratada != 0)\n      AND NOT ST_INTERSECTSBOX(ST_GEOGPOINT(longitude_tratada, latitude_tratada), -43.87, -23.13, -43.0, -22.59)\n    ) AS indicador_geolocalizacao_fora_rio,\n    (\n      latitude_tratada != 0\n      AND longitude_tratada != 0\n      AND latitude_servico IS NOT NULL\n      AND longitude_servico IS NOT NULL\n      AND modo = \"BRT\"\n      AND ST_DISTANCE(ST_GEOGPOINT(longitude_tratada, latitude_tratada), ST_GEOGPOINT(longitude_servico, latitude_servico)) > 100\n    ) AS indicador_geolocalizacao_fora_stop,\n    id_servico_gtfs IS NULL AND id_servico_jae_cadastro IS NOT NULL AND modo IN (\"\u00d4nibus\", \"BRT\") AS indicador_servico_fora_gtfs,\n    id_servico_jae_cadastro IS NULL AS indicador_servico_fora_vigencia\n  FROM\n    transacao\n)\nSELECT\n  * EXCEPT(indicador_servico_fora_gtfs, indicador_servico_fora_vigencia),\n  CASE\n    WHEN indicador_geolocalizacao_zerada = TRUE THEN \"Geolocaliza\u00e7\u00e3o zerada\"\n    WHEN indicador_geolocalizacao_fora_rio = TRUE THEN \"Geolocaliza\u00e7\u00e3o fora do munic\u00edpio\"\n    WHEN indicador_geolocalizacao_fora_stop = TRUE THEN \"Geolocaliza\u00e7\u00e3o fora do stop\"\n  END AS descricao_geolocalizacao_invalida,\n  indicador_servico_fora_gtfs,\n  indicador_servico_fora_vigencia,\n  '{{ var(\"version\") }}' as versao\nFROM\n  indicadores\nWHERE\n  indicador_geolocalizacao_zerada = TRUE\n  OR indicador_geolocalizacao_fora_rio = TRUE\n  OR indicador_geolocalizacao_fora_stop = TRUE\n  OR indicador_servico_fora_gtfs = TRUE\n  OR indicador_servico_fora_vigencia = TRUE", "language": "sql", "refs": [{"name": "transacao", "package": null, "version": null}, {"name": "transacao", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.transacao", "model.rj_smtr.servicos"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/transacao_invalida.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n    \n\n    \n    \n\n    \n    \n  \n\n\nWITH transacao AS (\n  SELECT\n    t.data,\n    t.hora,\n    t.datetime_transacao,\n    t.datetime_processamento,\n    t.datetime_captura,\n    t.modo,\n    t.id_consorcio,\n    t.consorcio,\n    t.id_operadora,\n    t.operadora,\n    t.id_servico_jae,\n    t.servico_jae,\n    t.descricao_servico_jae,\n    t.id_transacao,\n    t.longitude,\n    t.latitude,\n    IFNULL(t.longitude, 0) AS longitude_tratada,\n    IFNULL(t.latitude, 0) AS latitude_tratada,\n    s.longitude AS longitude_servico,\n    s.latitude AS latitude_servico,\n    s.id_servico_gtfs,\n    s.id_servico_jae AS id_servico_jae_cadastro\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`transacao` t\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`servicos` s\n  ON\n    t.id_servico_jae = s.id_servico_jae\n    AND t.data >= s.data_inicio_vigencia AND (t.data <= s.data_fim_vigencia OR s.data_fim_vigencia IS NULL)\n    \n      WHERE\n      \n        data = \"2000-01-01\"\n      \n    \n),\nindicadores AS (\n  SELECT\n    * EXCEPT(id_servico_gtfs, latitude_tratada, longitude_tratada, id_servico_jae_cadastro),\n    latitude_tratada = 0 OR longitude_tratada = 0 AS indicador_geolocalizacao_zerada,\n    (\n      (latitude_tratada != 0 OR longitude_tratada != 0)\n      AND NOT ST_INTERSECTSBOX(ST_GEOGPOINT(longitude_tratada, latitude_tratada), -43.87, -23.13, -43.0, -22.59)\n    ) AS indicador_geolocalizacao_fora_rio,\n    (\n      latitude_tratada != 0\n      AND longitude_tratada != 0\n      AND latitude_servico IS NOT NULL\n      AND longitude_servico IS NOT NULL\n      AND modo = \"BRT\"\n      AND ST_DISTANCE(ST_GEOGPOINT(longitude_tratada, latitude_tratada), ST_GEOGPOINT(longitude_servico, latitude_servico)) > 100\n    ) AS indicador_geolocalizacao_fora_stop,\n    id_servico_gtfs IS NULL AND id_servico_jae_cadastro IS NOT NULL AND modo IN (\"\u00d4nibus\", \"BRT\") AS indicador_servico_fora_gtfs,\n    id_servico_jae_cadastro IS NULL AS indicador_servico_fora_vigencia\n  FROM\n    transacao\n)\nSELECT\n  * EXCEPT(indicador_servico_fora_gtfs, indicador_servico_fora_vigencia),\n  CASE\n    WHEN indicador_geolocalizacao_zerada = TRUE THEN \"Geolocaliza\u00e7\u00e3o zerada\"\n    WHEN indicador_geolocalizacao_fora_rio = TRUE THEN \"Geolocaliza\u00e7\u00e3o fora do munic\u00edpio\"\n    WHEN indicador_geolocalizacao_fora_stop = TRUE THEN \"Geolocaliza\u00e7\u00e3o fora do stop\"\n  END AS descricao_geolocalizacao_invalida,\n  indicador_servico_fora_gtfs,\n  indicador_servico_fora_vigencia,\n  '' as versao\nFROM\n  indicadores\nWHERE\n  indicador_geolocalizacao_zerada = TRUE\n  OR indicador_geolocalizacao_fora_rio = TRUE\n  OR indicador_geolocalizacao_fora_stop = TRUE\n  OR indicador_servico_fora_gtfs = TRUE\n  OR indicador_servico_fora_vigencia = TRUE", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae_staging", "name": "ordem_pagamento_servico_operador_dia_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/staging/ordem_pagamento_servico_operador_dia_invalida.sql", "original_file_path": "models/validacao_dados_jae/staging/ordem_pagamento_servico_operador_dia_invalida.sql", "unique_id": "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "staging", "ordem_pagamento_servico_operador_dia_invalida"], "alias": "ordem_pagamento_servico_operador_dia_invalida", "checksum": {"name": "sha256", "checksum": "7fec1f34c8e712fc75d50b1858a1b3e177f116b402eb927876ad4f15b02d92d1"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "created_at": 1727709586.6750424, "relation_name": "`rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_servico_operador_dia_invalida`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data_ordem\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\n{% set transacao_ordem =  ref(\"aux_transacao_ordem\") %}\n{% if execute and is_incremental() %}\n  {% set transacao_validacao_partition_query %}\n    SELECT DISTINCT\n      CONCAT(\"'\", DATE(data_transacao), \"'\") AS data_transacao\n    FROM\n      {{ transacao_ordem }}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endset %}\n  {% set transacao_validacao_partitions = run_query(transacao_validacao_partition_query).columns[0].values() %}\n{% endif %}\n\nWITH transacao_invalida AS (\n  SELECT\n    id_transacao,\n    indicador_servico_fora_vigencia\n  FROM\n    {{ ref(\"transacao_invalida\") }}\n  WHERE\n    indicador_servico_fora_vigencia = TRUE\n  {% if is_incremental() %}\n    AND\n    {% if transacao_validacao_partitions|length > 0 %}\n      data IN ({{ transacao_validacao_partitions|join(', ') }})\n    {% else %}\n      data = \"2000-01-01\"\n    {% endif %}\n  {% endif %}\n),\ntransacao_agg AS (\n  SELECT\n    t.data_ordem,\n    ANY_VALUE(t.id_consorcio) AS id_consorcio,\n    t.id_servico_jae,\n    t.id_operadora,\n    COUNT(*) AS quantidade_total_transacao_captura,\n    SUM(t.valor_transacao) AS valor_total_transacao_captura,\n    MAX(ti.indicador_servico_fora_vigencia) IS NOT NULL AS indicador_servico_fora_vigencia\n  FROM\n    {{ ref(\"aux_transacao_ordem\") }} t\n  LEFT JOIN\n    transacao_invalida ti\n  USING(id_transacao)\n  GROUP BY\n    data_ordem,\n    id_servico_jae,\n    id_operadora\n),\nordem_pagamento AS (\n  SELECT\n    *\n  FROM\n    {{ ref(\"ordem_pagamento_servico_operador_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nid_ordem_pagamento AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    {{ ref(\"ordem_pagamento_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\ntransacao_ordem AS (\n  SELECT\n    COALESCE(op.data_ordem, t.data_ordem) AS data_ordem,\n    COALESCE(op.id_consorcio, t.id_consorcio) AS id_consorcio,\n    COALESCE(op.id_operadora, t.id_operadora) AS id_operadora,\n    COALESCE(op.id_servico_jae, t.id_servico_jae) AS id_servico_jae,\n    op.quantidade_total_transacao,\n    op.valor_total_transacao_bruto,\n    op.valor_total_transacao_liquido,\n    t.quantidade_total_transacao_captura,\n    SAFE_CAST(t.valor_total_transacao_captura + op.valor_rateio_credito + op.valor_rateio_debito AS NUMERIC) AS valor_total_transacao_captura,\n    t.indicador_servico_fora_vigencia\n  FROM\n    ordem_pagamento op\n  FULL OUTER JOIN\n    transacao_agg t\n  USING(data_ordem, id_servico_jae, id_operadora)\n),\nindicadores AS (\n  SELECT\n    o.data_ordem,\n    id.id_ordem_pagamento,\n    o.id_consorcio,\n    o.id_operadora,\n    o.id_servico_jae,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto,\n    o.valor_total_transacao_liquido,\n    o.quantidade_total_transacao_captura,\n    o.valor_total_transacao_captura,\n    COALESCE(\n      (\n        quantidade_total_transacao_captura != quantidade_total_transacao\n        OR ROUND(valor_total_transacao_captura, 2) != ROUND(valor_total_transacao_bruto, 2)\n      ),\n      TRUE\n    ) AS indicador_captura_invalida,\n    o.indicador_servico_fora_vigencia\n  FROM\n    transacao_ordem o\n  JOIN\n    id_ordem_pagamento id\n  USING(data_ordem)\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_servico_fora_vigencia = TRUE\n  OR indicador_captura_invalida = TRUE\n  AND id_servico_jae NOT IN (SELECT id_linha FROM {{ ref(\"staging_linha_sem_ressarcimento\") }})", "language": "sql", "refs": [{"name": "aux_transacao_ordem", "package": null, "version": null}, {"name": "transacao_invalida", "package": null, "version": null}, {"name": "aux_transacao_ordem", "package": null, "version": null}, {"name": "ordem_pagamento_servico_operador_dia", "package": null, "version": null}, {"name": "ordem_pagamento_dia", "package": null, "version": null}, {"name": "staging_linha_sem_ressarcimento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.transacao_invalida", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.ordem_pagamento_dia", "model.rj_smtr.staging_linha_sem_ressarcimento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/staging/ordem_pagamento_servico_operador_dia_invalida.sql", "compiled": true, "compiled_code": "\n\n\n\n  \n  \n\n\nWITH transacao_invalida AS (\n  SELECT\n    id_transacao,\n    indicador_servico_fora_vigencia\n  FROM\n    `rj-smtr`.`validacao_dados_jae`.`transacao_invalida`\n  WHERE\n    indicador_servico_fora_vigencia = TRUE\n  \n    AND\n    \n      data = \"2000-01-01\"\n    \n  \n),\ntransacao_agg AS (\n  SELECT\n    t.data_ordem,\n    ANY_VALUE(t.id_consorcio) AS id_consorcio,\n    t.id_servico_jae,\n    t.id_operadora,\n    COUNT(*) AS quantidade_total_transacao_captura,\n    SUM(t.valor_transacao) AS valor_total_transacao_captura,\n    MAX(ti.indicador_servico_fora_vigencia) IS NOT NULL AS indicador_servico_fora_vigencia\n  FROM\n    `rj-smtr`.`validacao_dados_jae_staging`.`aux_transacao_ordem` t\n  LEFT JOIN\n    transacao_invalida ti\n  USING(id_transacao)\n  GROUP BY\n    data_ordem,\n    id_servico_jae,\n    id_operadora\n),\nordem_pagamento AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_servico_operador_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nid_ordem_pagamento AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\ntransacao_ordem AS (\n  SELECT\n    COALESCE(op.data_ordem, t.data_ordem) AS data_ordem,\n    COALESCE(op.id_consorcio, t.id_consorcio) AS id_consorcio,\n    COALESCE(op.id_operadora, t.id_operadora) AS id_operadora,\n    COALESCE(op.id_servico_jae, t.id_servico_jae) AS id_servico_jae,\n    op.quantidade_total_transacao,\n    op.valor_total_transacao_bruto,\n    op.valor_total_transacao_liquido,\n    t.quantidade_total_transacao_captura,\n    SAFE_CAST(t.valor_total_transacao_captura + op.valor_rateio_credito + op.valor_rateio_debito AS NUMERIC) AS valor_total_transacao_captura,\n    t.indicador_servico_fora_vigencia\n  FROM\n    ordem_pagamento op\n  FULL OUTER JOIN\n    transacao_agg t\n  USING(data_ordem, id_servico_jae, id_operadora)\n),\nindicadores AS (\n  SELECT\n    o.data_ordem,\n    id.id_ordem_pagamento,\n    o.id_consorcio,\n    o.id_operadora,\n    o.id_servico_jae,\n    o.quantidade_total_transacao,\n    o.valor_total_transacao_bruto,\n    o.valor_total_transacao_liquido,\n    o.quantidade_total_transacao_captura,\n    o.valor_total_transacao_captura,\n    COALESCE(\n      (\n        quantidade_total_transacao_captura != quantidade_total_transacao\n        OR ROUND(valor_total_transacao_captura, 2) != ROUND(valor_total_transacao_bruto, 2)\n      ),\n      TRUE\n    ) AS indicador_captura_invalida,\n    o.indicador_servico_fora_vigencia\n  FROM\n    transacao_ordem o\n  JOIN\n    id_ordem_pagamento id\n  USING(data_ordem)\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_servico_fora_vigencia = TRUE\n  OR indicador_captura_invalida = TRUE\n  AND id_servico_jae NOT IN (SELECT id_linha FROM `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento`)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_transacao_ordem": {"database": "rj-smtr", "schema": "validacao_dados_jae_staging", "name": "aux_transacao_ordem", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/staging/aux_transacao_ordem.sql", "original_file_path": "models/validacao_dados_jae/staging/aux_transacao_ordem.sql", "unique_id": "model.rj_smtr.aux_transacao_ordem", "fqn": ["rj_smtr", "validacao_dados_jae", "staging", "aux_transacao_ordem"], "alias": "aux_transacao_ordem", "checksum": {"name": "sha256", "checksum": "68a0cc24a7bda4a5669c7ae71632efea6ad2f4dcb0cb93921aba95fda941012a"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "validacao_dados_jae_staging"}, "created_at": 1727709586.6846097, "relation_name": "`rj-smtr`.`validacao_dados_jae_staging`.`aux_transacao_ordem`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\n-- WITH servico_motorista AS (\n--     SELECT\n--         * EXCEPT(rn)\n--     FROM\n--     (\n--         SELECT\n--             id_servico,\n--             dt_fechamento,\n--             nr_logico_midia,\n--             cd_linha,\n--             cd_operadora,\n--             ROW_NUMBER() OVER (PARTITION BY id_servico, nr_logico_midia ORDER BY timestamp_captura DESC) AS rn\n--         FROM\n--             {{ ref(\"staging_servico_motorista\") }}\n--         {% if is_incremental() %}\n--             WHERE\n--                 DATE(data) BETWEEN DATE_SUB(DATE(\"{{var('date_range_start')}}\"), INTERVAL 1 DAY) AND DATE(\"{{var('date_range_end')}}\")\n--         {% endif %}\n--     )\n-- ),\nWITH transacao AS (\n  SELECT\n    t.id AS id_transacao,\n    t.timestamp_captura,\n    DATE(t.data_transacao) AS data_transacao,\n    DATE(t.data_processamento) AS data_processamento,\n    t.data_processamento AS datetime_processamento,\n    t.cd_linha AS id_servico_jae,\n    do.id_operadora,\n    t.valor_transacao,\n    t.tipo_transacao,\n    t.id_tipo_modal,\n    dc.id_consorcio,\n    -- sm.dt_fechamento AS datetime_fechamento_servico,\n    -- sm.cd_linha AS cd_linha_servico,\n    -- sm.cd_operadora AS cd_operadora_servico,\n    t.id_servico\n  FROM\n    {{ ref(\"staging_transacao\") }} t\n  -- LEFT JOIN\n  --     servico_motorista sm\n  -- ON\n  --     sm.id_servico = t.id_servico\n  --     AND sm.nr_logico_midia = t.nr_logico_midia_operador\n  LEFT JOIN\n    {{ ref(\"operadoras\") }} AS do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    {{ ref(\"consorcios\") }} AS dc\n  ON\n    t.cd_consorcio = dc.id_consorcio_jae\n  WHERE\n    {% if is_incremental() %}\n      DATE(t.data) BETWEEN DATE_SUB(DATE(\"{{var('run_date')}}\"), INTERVAL 2 DAY) AND DATE(\"{{var('run_date')}}\")\n      AND t.data_processamento BETWEEN DATE_SUB(DATE(\"{{var('run_date')}}\"), INTERVAL 2 DAY) AND DATE(\"{{var('run_date')}}\")\n    {% else %}\n      DATE(t.data) <= CURRENT_DATE(\"America/Sao_Paulo\")\n      AND DATE(t.data_processamento) <= CURRENT_DATE(\"America/Sao_Paulo\")\n    {% endif %}\n),\ntransacao_deduplicada AS (\n  SELECT\n    t.* EXCEPT(rn),\n    DATE_ADD(data_processamento, INTERVAL 1 DAY) AS data_ordem -- TODO: Regra da data por servi\u00e7os fechados no modo \u00d4nibus quando come\u00e7ar a opera\u00e7\u00e3o\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY timestamp_captura DESC) AS rn\n    FROM\n      transacao\n  ) t\n  WHERE\n    rn = 1\n)\nSELECT\n  t.*\nFROM\n  transacao_deduplicada t\nLEFT JOIN\n  {{ ref(\"staging_linha_sem_ressarcimento\") }} l\nON\n  t.id_servico_jae = l.id_linha\nWHERE\n  -- Remove dados com data de ordem de pagamento maiores que a execu\u00e7\u00e3o do modelo\n  {% if is_incremental() %}\n    t.data_ordem <= DATE(\"{{var('run_date')}}\")\n  {% else %}\n    t.data_ordem <= CURRENT_DATE(\"America/Sao_Paulo\")\n  {% endif %}\n  -- Remove linhas de teste que n\u00e3o entram no ressarcimento\n  AND l.id_linha IS NULL\n  -- Remove gratuidades e transfer\u00eancias da contagem de transa\u00e7\u00f5es\n  AND tipo_transacao NOT IN ('5', '21', '40')", "language": "sql", "refs": [{"name": "staging_servico_motorista", "package": null, "version": null}, {"name": "staging_transacao", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "staging_linha_sem_ressarcimento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_servico_motorista", "model.rj_smtr.staging_transacao", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios", "model.rj_smtr.staging_linha_sem_ressarcimento"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/staging/aux_transacao_ordem.sql", "compiled": true, "compiled_code": "\n\n-- WITH servico_motorista AS (\n--     SELECT\n--         * EXCEPT(rn)\n--     FROM\n--     (\n--         SELECT\n--             id_servico,\n--             dt_fechamento,\n--             nr_logico_midia,\n--             cd_linha,\n--             cd_operadora,\n--             ROW_NUMBER() OVER (PARTITION BY id_servico, nr_logico_midia ORDER BY timestamp_captura DESC) AS rn\n--         FROM\n--             `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`servico_motorista`\n--         \n--     )\n-- ),\nWITH transacao AS (\n  SELECT\n    t.id AS id_transacao,\n    t.timestamp_captura,\n    DATE(t.data_transacao) AS data_transacao,\n    DATE(t.data_processamento) AS data_processamento,\n    t.data_processamento AS datetime_processamento,\n    t.cd_linha AS id_servico_jae,\n    do.id_operadora,\n    t.valor_transacao,\n    t.tipo_transacao,\n    t.id_tipo_modal,\n    dc.id_consorcio,\n    -- sm.dt_fechamento AS datetime_fechamento_servico,\n    -- sm.cd_linha AS cd_linha_servico,\n    -- sm.cd_operadora AS cd_operadora_servico,\n    t.id_servico\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao` t\n  -- LEFT JOIN\n  --     servico_motorista sm\n  -- ON\n  --     sm.id_servico = t.id_servico\n  --     AND sm.nr_logico_midia = t.nr_logico_midia_operador\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`operadoras` AS do\n  ON\n    t.cd_operadora = do.id_operadora_jae\n  LEFT JOIN\n    `rj-smtr`.`cadastro`.`consorcios` AS dc\n  ON\n    t.cd_consorcio = dc.id_consorcio_jae\n  WHERE\n    \n      DATE(t.data) <= CURRENT_DATE(\"America/Sao_Paulo\")\n      AND DATE(t.data_processamento) <= CURRENT_DATE(\"America/Sao_Paulo\")\n    \n),\ntransacao_deduplicada AS (\n  SELECT\n    t.* EXCEPT(rn),\n    DATE_ADD(data_processamento, INTERVAL 1 DAY) AS data_ordem -- TODO: Regra da data por servi\u00e7os fechados no modo \u00d4nibus quando come\u00e7ar a opera\u00e7\u00e3o\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_transacao ORDER BY timestamp_captura DESC) AS rn\n    FROM\n      transacao\n  ) t\n  WHERE\n    rn = 1\n)\nSELECT\n  t.*\nFROM\n  transacao_deduplicada t\nLEFT JOIN\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento` l\nON\n  t.id_servico_jae = l.id_linha\nWHERE\n  -- Remove dados com data de ordem de pagamento maiores que a execu\u00e7\u00e3o do modelo\n  \n    t.data_ordem <= CURRENT_DATE(\"America/Sao_Paulo\")\n  \n  -- Remove linhas de teste que n\u00e3o entram no ressarcimento\n  AND l.id_linha IS NULL\n  -- Remove gratuidades e transfer\u00eancias da contagem de transa\u00e7\u00f5es\n  AND tipo_transacao NOT IN ('5', '21', '40')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_dia_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae_staging", "name": "ordem_pagamento_dia_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/staging/ordem_pagamento_dia_invalida.sql", "original_file_path": "models/validacao_dados_jae/staging/ordem_pagamento_dia_invalida.sql", "unique_id": "model.rj_smtr.ordem_pagamento_dia_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "staging", "ordem_pagamento_dia_invalida"], "alias": "ordem_pagamento_dia_invalida", "checksum": {"name": "sha256", "checksum": "b98ac568d1e54dd9a377df054dd346da125253c476d9203f99c97949e12277e3"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "created_at": 1727709586.6923316, "relation_name": "`rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_dia_invalida`", "raw_code": "{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data_ordem\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH ordem_pagamento_consorcio_dia AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido) AS valor_total_transacao_liquido\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n  GROUP BY\n    1,\n    2\n),\nordem_pagamento_dia AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido\n  FROM\n    {{ ref(\"ordem_pagamento_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nindicadores AS (\nSELECT\n  d.data_ordem,\n  d.id_ordem_pagamento,\n  d.quantidade_total_transacao,\n  cd.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n  d.valor_total_transacao_liquido,\n  cd.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n  ROUND(cd.valor_total_transacao_liquido, 2) != ROUND(d.valor_total_transacao_liquido, 2) OR cd.quantidade_total_transacao != d.quantidade_total_transacao AS indicador_agregacao_invalida\nFROM\n  ordem_pagamento_dia d\nLEFT JOIN\n  ordem_pagamento_consorcio_dia cd\nUSING(data_ordem, id_ordem_pagamento)\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "language": "sql", "refs": [{"name": "ordem_pagamento_consorcio_dia", "package": null, "version": null}, {"name": "ordem_pagamento_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.ordem_pagamento_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/staging/ordem_pagamento_dia_invalida.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_pagamento_consorcio_dia AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido) AS valor_total_transacao_liquido\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n  GROUP BY\n    1,\n    2\n),\nordem_pagamento_dia AS (\n  SELECT\n    data_ordem,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nindicadores AS (\nSELECT\n  d.data_ordem,\n  d.id_ordem_pagamento,\n  d.quantidade_total_transacao,\n  cd.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n  d.valor_total_transacao_liquido,\n  cd.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n  ROUND(cd.valor_total_transacao_liquido, 2) != ROUND(d.valor_total_transacao_liquido, 2) OR cd.quantidade_total_transacao != d.quantidade_total_transacao AS indicador_agregacao_invalida\nFROM\n  ordem_pagamento_dia d\nLEFT JOIN\n  ordem_pagamento_consorcio_dia cd\nUSING(data_ordem, id_ordem_pagamento)\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae_staging", "name": "ordem_pagamento_consorcio_operador_dia_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/staging/ordem_pagamento_consorcio_operador_dia_invalida.sql", "original_file_path": "models/validacao_dados_jae/staging/ordem_pagamento_consorcio_operador_dia_invalida.sql", "unique_id": "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "staging", "ordem_pagamento_consorcio_operador_dia_invalida"], "alias": "ordem_pagamento_consorcio_operador_dia_invalida", "checksum": {"name": "sha256", "checksum": "c2eb926759c0f83be263580ac9c3d5ae97adc3f7821cfe09e29efb53a5c62db5"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "created_at": 1727709586.698816, "relation_name": "`rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_consorcio_operador_dia_invalida`", "raw_code": "-- depends_on: {{ ref(\"ordem_pagamento_servico_operador_dia_invalida\") }}\n{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data_ordem\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH ordem_pagamento_servico_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido) AS valor_total_transacao_liquido,\n  FROM\n    {{ ref(\"ordem_pagamento_servico_operador_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n  GROUP BY\n    1,\n    2,\n    3,\n    4\n),\nordem_pagamento_consorcio_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido_ordem AS valor_total_transacao_liquido\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_operador_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nindicadores AS (\n  SELECT\n    cod.data_ordem,\n    cod.id_consorcio,\n    cod.id_operadora,\n    cod.id_ordem_pagamento,\n    cod.quantidade_total_transacao,\n    sod.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n    cod.valor_total_transacao_liquido,\n    sod.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n    ROUND(cod.valor_total_transacao_liquido, 2) != ROUND(sod.valor_total_transacao_liquido, 2) OR cod.quantidade_total_transacao != sod.quantidade_total_transacao AS indicador_agregacao_invalida\n  FROM\n    ordem_pagamento_consorcio_operador_dia cod\n  LEFT JOIN\n    ordem_pagamento_servico_operador_dia sod\n  USING(\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento\n  )\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "language": "sql", "refs": [{"name": "ordem_pagamento_servico_operador_dia_invalida", "package": null, "version": null}, {"name": "ordem_pagamento_servico_operador_dia", "package": null, "version": null}, {"name": "ordem_pagamento_consorcio_operador_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/staging/ordem_pagamento_consorcio_operador_dia_invalida.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_servico_operador_dia_invalida`\n\n\nWITH ordem_pagamento_servico_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido) AS valor_total_transacao_liquido,\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_servico_operador_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n  GROUP BY\n    1,\n    2,\n    3,\n    4\n),\nordem_pagamento_consorcio_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido_ordem AS valor_total_transacao_liquido\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_operador_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nindicadores AS (\n  SELECT\n    cod.data_ordem,\n    cod.id_consorcio,\n    cod.id_operadora,\n    cod.id_ordem_pagamento,\n    cod.quantidade_total_transacao,\n    sod.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n    cod.valor_total_transacao_liquido,\n    sod.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n    ROUND(cod.valor_total_transacao_liquido, 2) != ROUND(sod.valor_total_transacao_liquido, 2) OR cod.quantidade_total_transacao != sod.quantidade_total_transacao AS indicador_agregacao_invalida\n  FROM\n    ordem_pagamento_consorcio_operador_dia cod\n  LEFT JOIN\n    ordem_pagamento_servico_operador_dia sod\n  USING(\n    data_ordem,\n    id_consorcio,\n    id_operadora,\n    id_ordem_pagamento\n  )\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida": {"database": "rj-smtr", "schema": "validacao_dados_jae_staging", "name": "ordem_pagamento_consorcio_dia_invalida", "resource_type": "model", "package_name": "rj_smtr", "path": "validacao_dados_jae/staging/ordem_pagamento_consorcio_dia_invalida.sql", "original_file_path": "models/validacao_dados_jae/staging/ordem_pagamento_consorcio_dia_invalida.sql", "unique_id": "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "fqn": ["rj_smtr", "validacao_dados_jae", "staging", "ordem_pagamento_consorcio_dia_invalida"], "alias": "ordem_pagamento_consorcio_dia_invalida", "checksum": {"name": "sha256", "checksum": "bde5602590fe57b5414474defcbab5fd9d6cbe5366b01025de045d4253ab82c1"}, "config": {"enabled": true, "alias": null, "schema": "validacao_dados_jae_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "validacao_dados_jae_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "created_at": 1727709586.7064602, "relation_name": "`rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_consorcio_dia_invalida`", "raw_code": "-- depends_on: {{ ref(\"ordem_pagamento_consorcio_operador_dia_invalida\") }}\n{{\n  config(\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n      \"field\": \"data_ordem\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\nWITH ordem_pagamento_consorcio_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido_ordem) AS valor_total_transacao_liquido,\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_operador_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n  GROUP BY\n    1,\n    2,\n    3\n),\nordem_pagamento_consorcio_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido\n  FROM\n    {{ ref(\"ordem_pagamento_consorcio_dia\") }}\n  {% if is_incremental() %}\n    WHERE\n      data_ordem = DATE(\"{{var('run_date')}}\")\n  {% endif %}\n),\nindicadores AS (\n  SELECT\n    cd.data_ordem,\n    cd.id_consorcio,\n    cd.id_ordem_pagamento,\n    cd.quantidade_total_transacao,\n    cod.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n    cd.valor_total_transacao_liquido,\n    cod.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n    ROUND(cd.valor_total_transacao_liquido, 2) != ROUND(cod.valor_total_transacao_liquido, 2) OR cd.quantidade_total_transacao != cod.quantidade_total_transacao AS indicador_agregacao_invalida\n  FROM\n    ordem_pagamento_consorcio_dia cd\n  LEFT JOIN\n    ordem_pagamento_consorcio_operador_dia cod\n  USING(\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento\n  )\n)\nSELECT\n  *,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "language": "sql", "refs": [{"name": "ordem_pagamento_consorcio_operador_dia_invalida", "package": null, "version": null}, {"name": "ordem_pagamento_consorcio_operador_dia", "package": null, "version": null}, {"name": "ordem_pagamento_consorcio_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_consorcio_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/validacao_dados_jae/staging/ordem_pagamento_consorcio_dia_invalida.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`validacao_dados_jae_staging`.`ordem_pagamento_consorcio_operador_dia_invalida`\n\n\nWITH ordem_pagamento_consorcio_operador_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento,\n    SUM(quantidade_total_transacao) AS quantidade_total_transacao,\n    SUM(valor_total_transacao_liquido_ordem) AS valor_total_transacao_liquido,\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_operador_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n  GROUP BY\n    1,\n    2,\n    3\n),\nordem_pagamento_consorcio_dia AS (\n  SELECT\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento,\n    quantidade_total_transacao,\n    valor_total_transacao_liquido\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem`.`ordem_pagamento_consorcio_dia`\n  \n    WHERE\n      data_ordem = DATE(\"2022-01-01T01:00:00\")\n  \n),\nindicadores AS (\n  SELECT\n    cd.data_ordem,\n    cd.id_consorcio,\n    cd.id_ordem_pagamento,\n    cd.quantidade_total_transacao,\n    cod.quantidade_total_transacao AS quantidade_total_transacao_agregacao,\n    cd.valor_total_transacao_liquido,\n    cod.valor_total_transacao_liquido AS valor_total_transacao_liquido_agregacao,\n    ROUND(cd.valor_total_transacao_liquido, 2) != ROUND(cod.valor_total_transacao_liquido, 2) OR cd.quantidade_total_transacao != cod.quantidade_total_transacao AS indicador_agregacao_invalida\n  FROM\n    ordem_pagamento_consorcio_dia cd\n  LEFT JOIN\n    ordem_pagamento_consorcio_operador_dia cod\n  USING(\n    data_ordem,\n    id_consorcio,\n    id_ordem_pagamento\n  )\n)\nSELECT\n  *,\n  '' AS versao\nFROM\n  indicadores\nWHERE\n  indicador_agregacao_invalida = TRUE", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_registro_agente_verao": {"database": "rj-smtr", "schema": "veiculo", "name": "sppo_registro_agente_verao", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/sppo_registro_agente_verao.sql", "original_file_path": "models/veiculo/sppo_registro_agente_verao.sql", "unique_id": "model.rj_smtr.sppo_registro_agente_verao", "fqn": ["rj_smtr", "veiculo", "sppo_registro_agente_verao"], "alias": "sppo_registro_agente_verao", "checksum": {"name": "sha256", "checksum": "9b9f521537f9e93becbcb455776a74c8d7b42634c23350bc9050b4984227b549"}, "config": {"enabled": true, "alias": "sppo_registro_agente_verao", "schema": "veiculo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "merge", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "id_registro", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "merge_update_columns": ["data", "datetime_registro", "id_registro", "id_veiculo", "servico", "link_foto", "validacao"]}, "tags": [], "description": "Tabela com registros de Agentes de Ver\u00e3o para fins de c\u00e1lculo de subs\u00eddio nos termos da RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024", "columns": {"data": {"name": "data", "description": "Data de registro pelo agente p\u00fablico", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_registro": {"name": "datetime_registro", "description": "Datetime de registro pelo agente p\u00fablico", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_registro": {"name": "id_registro", "description": "ID do registro (HASH SHA256)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, SN011, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "link_foto": {"name": "link_foto", "description": "Link com a imagem interna do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "validacao": {"name": "validacao", "description": "Coluna de valida\u00e7\u00e3o do registro enviado pelo agente p\u00fablico (apenas TRUE nesta tabela)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Datetime de captura do registro pela pipeline", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "SHA do reposit\u00f3rio no Github", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "veiculo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": "id_registro", "incremental_strategy": "merge", "merge_update_columns": ["data", "datetime_registro", "id_registro", "id_veiculo", "servico", "link_foto", "validacao"], "alias": "sppo_registro_agente_verao"}, "created_at": 1727709588.6347573, "relation_name": "`rj-smtr`.`veiculo`.`sppo_registro_agente_verao`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\": \"date\",\n      \"granularity\":\"day\"\n    },\n    unique_key=\"id_registro\",\n    incremental_strategy=\"merge\",\n    merge_update_columns=[\"data\", \"datetime_registro\", \"id_registro\", \"id_veiculo\", \"servico\", \"link_foto\", \"validacao\"],\n    alias='sppo_registro_agente_verao'\n  )\n}}\n\n{% if execute %}\n  {% set ultima_data_agente_verao = run_query(\"SELECT MAX(data) FROM \" ~ ref('sppo_registro_agente_verao_staging'))[0][0] %}\n{% endif %}\n\n\nSELECT\n  * EXCEPT(rn)\nFROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER(PARTITION BY id_registro ORDER BY datetime_captura DESC) AS rn\n    FROM\n      {{ ref('sppo_registro_agente_verao_staging') }}\n    WHERE\n      data = DATE('{{ ultima_data_agente_verao }}')\n      AND validacao = TRUE\n  )\nWHERE rn = 1", "language": "sql", "refs": [{"name": "sppo_registro_agente_verao_staging", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.run_query"], "nodes": ["model.rj_smtr.sppo_registro_agente_verao_staging"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/sppo_registro_agente_verao.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\n\nSELECT\n  * EXCEPT(rn)\nFROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER(PARTITION BY id_registro ORDER BY datetime_captura DESC) AS rn\n    FROM\n      `rj-smtr`.`veiculo_staging`.`sppo_registro_agente_verao`\n    WHERE\n      data = DATE('2024-09-22')\n      AND validacao = TRUE\n  )\nWHERE rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_infracao": {"database": "rj-smtr", "schema": "veiculo", "name": "sppo_infracao", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/sppo_infracao.sql", "original_file_path": "models/veiculo/sppo_infracao.sql", "unique_id": "model.rj_smtr.sppo_infracao", "fqn": ["rj_smtr", "veiculo", "sppo_infracao"], "alias": "sppo_infracao", "checksum": {"name": "sha256", "checksum": "23842ad0d1e0dc3103b6c5b01ac29856a73e83df71a38156d9ce28af61773447"}, "config": {"enabled": true, "alias": null, "schema": "veiculo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "id_auto_infracao"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela hist\u00f3rica de todas as multas aplicadas aos modos de transporte no munic\u00edpio do Rio de Janeiro, com qualquer situa\u00e7\u00e3o. Dados capturados diariamente de: https://www.data.rio/documents/multas-aplicadas-aos-modos-de-transporte-nos-%C3%BAltimos-cinco-anos", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura dos dados de infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_auto_infracao": {"name": "id_auto_infracao", "description": "Identificador do auto de infra\u00e7\u00e3o da multa aplicada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_infracao": {"name": "data_infracao", "description": "Data da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor devido (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_infracao": {"name": "id_infracao", "description": "C\u00f3digo da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "infracao": {"name": "infracao", "description": "Descri\u00e7\u00e3o da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "CADASTRADA - Registrada no sistema sem guia de pagamento\n EM ABERTO - Com guia de pagamento e dentro do prazo de vencimento\n VENCIDA - Com guia de pagamento e fora do prazo de vencimento\n EM RECURSO - Possui Processo de Recurso aguardando julgamento\n PAGA - Com guia de pagamento efetivamente paga\n CANCELADA - Multa foi cancelada atrav\u00e9s de um Processo de Recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data de pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "veiculo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "id_auto_infracao"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6213534, "relation_name": "`rj-smtr`.`veiculo`.`sppo_infracao`", "raw_code": "{{ config(\n       materialized='incremental',\n       partition_by={\n              \"field\":\"data\",\n              \"data_type\": \"date\",\n              \"granularity\":\"day\"\n       },\n       unique_key=['data', 'id_auto_infracao'],\n       incremental_strategy='insert_overwrite'\n)\n}}\n\n{%- if execute %}\n  {% set infracao_date = run_query(\"SELECT MIN(SAFE_CAST(data AS DATE)) FROM \" ~ ref('sppo_infracao_staging') ~ \" WHERE SAFE_CAST(data AS DATE) >= DATE_ADD(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 7 DAY)\").columns[0].values()[0] %}\n{% endif -%}\n\nWITH\n  infracao AS (\n    SELECT\n      * EXCEPT(data),\n      SAFE_CAST(data AS DATE) AS data\n    FROM\n      {{ ref(\"sppo_infracao_staging\") }} as t\n    WHERE\n      DATE(data) = DATE(\"{{ infracao_date }}\")\n  ),\n  infracao_rn AS (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY data, id_auto_infracao) rn\n    FROM\n      infracao\n  )\nSELECT\n  * EXCEPT(rn)\nFROM\n  infracao_rn\nWHERE\n  rn = 1", "language": "sql", "refs": [{"name": "sppo_infracao_staging", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.run_query"], "nodes": ["model.rj_smtr.sppo_infracao_staging"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/sppo_infracao.sql", "compiled": true, "compiled_code": "\n  \nWITH\n  infracao AS (\n    SELECT\n      * EXCEPT(data),\n      SAFE_CAST(data AS DATE) AS data\n    FROM\n      `rj-smtr`.`veiculo_staging`.`sppo_infracao` as t\n    WHERE\n      DATE(data) = DATE(\"2023-03-10\")\n  ),\n  infracao_rn AS (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY data, id_auto_infracao) rn\n    FROM\n      infracao\n  )\nSELECT\n  * EXCEPT(rn)\nFROM\n  infracao_rn\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_licenciamento": {"database": "rj-smtr", "schema": "veiculo", "name": "sppo_licenciamento", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/sppo_licenciamento.sql", "original_file_path": "models/veiculo/sppo_licenciamento.sql", "unique_id": "model.rj_smtr.sppo_licenciamento", "fqn": ["rj_smtr", "veiculo", "sppo_licenciamento"], "alias": "sppo_licenciamento", "checksum": {"name": "sha256", "checksum": "c154b0123f4bf993d56f172eabdb72ad0b9e5bca968fe94997bc3538279e6322"}, "config": {"enabled": true, "alias": null, "schema": "veiculo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "id_veiculo"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela hist\u00f3rica de dados cadastrais dos ve\u00edculos que operam o sistema de \u00f4nibus (BRT e SPPO), considerando tanto os licenciados no Sistema de Transporte Urbano (STU) quanto as solicita\u00e7\u00f5es v\u00e1lidas em andamento para ingresso no sistema", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "carroceria": {"name": "carroceria", "description": "Descri\u00e7\u00e3o do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_vistoria": {"name": "data_ultima_vistoria", "description": "Data da \u00faltima vistoria do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_carroceria": {"name": "id_carroceria", "description": "C\u00f3digo do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_chassi": {"name": "id_chassi", "description": "C\u00f3digo do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_fabricante_chassi": {"name": "id_fabricante_chassi", "description": "Identificador do fabricante do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_interno_carroceria": {"name": "id_interno_carroceria", "description": "C\u00f3digo interno do modelo de carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_planta": {"name": "id_planta", "description": "C\u00f3digo da planta do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se possui ar condicionado (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_elevador": {"name": "indicador_elevador", "description": "Indicador se possui elevador (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_usb": {"name": "indicador_usb", "description": "Indicador se tem USB (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_wifi": {"name": "indicador_wifi", "description": "Indicador se tem Wi-fi (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_chassi": {"name": "nome_chassi", "description": "Descri\u00e7\u00e3o do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_pe": {"name": "quantidade_lotacao_pe", "description": "Quantidade de passageiros em p\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_sentado": {"name": "quantidade_lotacao_sentado", "description": "Quantidade de passageiros sentados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_combustivel": {"name": "tipo_combustivel", "description": "Combust\u00edvel utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Licenciado - Ve\u00edculo licenciado no Sistema de Transporte Urbano (STU)\n V\u00e1lido - Ve\u00edculo com solicita\u00e7\u00e3o v\u00e1lida para ingresso no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_ultima_vistoria_atualizado": {"name": "ano_ultima_vistoria_atualizado", "description": "Ano atualizado da \u00faltima vistoria realizada pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio_vinculo": {"name": "data_inicio_vinculo", "description": "Data de in\u00edcio do v\u00ednculo do ve\u00edculo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "veiculo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "id_veiculo"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6278813, "relation_name": "`rj-smtr`.`veiculo`.`sppo_licenciamento`", "raw_code": "-- depends_on: {{ ref('aux_sppo_licenciamento_vistoria_atualizada') }}\n{{\n    config(\n        materialized=\"incremental\",\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n        unique_key=[\"data\", \"id_veiculo\"],\n        incremental_strategy=\"insert_overwrite\",\n    )\n}}\n\n{% if execute %}\n  {% set licenciamento_date = run_query(get_license_date()).columns[0].values()[0] %}\n{% endif %}\n\nwith\n    -- Tabela de licenciamento\n    stu as (\n        select\n            * except(data),\n            date(data) AS data\n        from\n            {{ ref(\"sppo_licenciamento_stu_staging\") }} as t\n        where\n            date(data) = date(\"{{ licenciamento_date }}\")\n            and tipo_veiculo not like \"%ROD%\"\n    ),\n    stu_rn AS (\n        select\n            * except (timestamp_captura),\n            EXTRACT(YEAR FROM data_ultima_vistoria) AS ano_ultima_vistoria,\n            ROW_NUMBER() OVER (PARTITION BY data, id_veiculo) rn\n        from\n            stu\n    ),\n    stu_ano_ultima_vistoria AS (\n        -- Temporariamente considerando os dados de vistoria enviados pela TR/SUBTT/CGLF\n        {% if var(\"run_date\") >= \"2024-03-01\" %}\n        SELECT\n            s.* EXCEPT(ano_ultima_vistoria),\n            CASE\n                WHEN c.ano_ultima_vistoria > s.ano_ultima_vistoria THEN c.ano_ultima_vistoria\n                ELSE COALESCE(s.ano_ultima_vistoria, c.ano_ultima_vistoria)\n            END AS ano_ultima_vistoria_atualizado,\n        FROM\n            stu_rn AS s\n        LEFT JOIN\n            (\n                SELECT\n                    id_veiculo,\n                    placa,\n                    ano_ultima_vistoria\n                FROM\n                    {{ ref(\"aux_sppo_licenciamento_vistoria_atualizada\") }}\n            ) AS c\n        USING\n            (id_veiculo, placa)\n        {% else %}\n        SELECT\n            s.* EXCEPT(ano_ultima_vistoria),\n            s.ano_ultima_vistoria AS ano_ultima_vistoria_atualizado,\n        FROM\n            stu_rn AS s\n        {% endif %}\n    )\nselect\n  * except(rn),\nfrom\n  stu_ano_ultima_vistoria\nwhere\n  rn = 1", "language": "sql", "refs": [{"name": "aux_sppo_licenciamento_vistoria_atualizada", "package": null, "version": null}, {"name": "sppo_licenciamento_stu_staging", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.get_license_date", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada", "model.rj_smtr.sppo_licenciamento_stu_staging"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/sppo_licenciamento.sql", "compiled": true, "compiled_code": "-- depends_on: __dbt__cte__aux_sppo_licenciamento_vistoria_atualizada\n\n\n\n  \n\n\nwith\n     __dbt__cte__aux_sppo_licenciamento_vistoria_atualizada as (\n\n\n/* Dados auxiliares de vistoria de \u00f4nibus levantados pela Coordenadoria Geral de Licenciamento e Fiscaliza\u00e7\u00e3o (TR/SUBTT/CGLF),\npara atualiza\u00e7\u00e3o da data de \u00faltima vistoria informada no sistema (STU). */\n\nSELECT\n  data,\n  id_veiculo,\n  placa,\n  MAX(ano_ultima_vistoria) AS ano_ultima_vistoria,\nFROM\n    (\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`\n    )\nGROUP BY\n  1,\n  2,\n  3\n), -- Tabela de licenciamento\n    stu as (\n        select\n            * except(data),\n            date(data) AS data\n        from\n            `rj-smtr`.`veiculo_staging`.`sppo_licenciamento_stu` as t\n        where\n            date(data) = date(\"2023-02-01\")\n            and tipo_veiculo not like \"%ROD%\"\n    ),\n    stu_rn AS (\n        select\n            * except (timestamp_captura),\n            EXTRACT(YEAR FROM data_ultima_vistoria) AS ano_ultima_vistoria,\n            ROW_NUMBER() OVER (PARTITION BY data, id_veiculo) rn\n        from\n            stu\n    ),\n    stu_ano_ultima_vistoria AS (\n        -- Temporariamente considerando os dados de vistoria enviados pela TR/SUBTT/CGLF\n        \n        SELECT\n            s.* EXCEPT(ano_ultima_vistoria),\n            s.ano_ultima_vistoria AS ano_ultima_vistoria_atualizado,\n        FROM\n            stu_rn AS s\n        \n    )\nselect\n  * except(rn),\nfrom\n  stu_ano_ultima_vistoria\nwhere\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada", "sql": " __dbt__cte__aux_sppo_licenciamento_vistoria_atualizada as (\n\n\n/* Dados auxiliares de vistoria de \u00f4nibus levantados pela Coordenadoria Geral de Licenciamento e Fiscaliza\u00e7\u00e3o (TR/SUBTT/CGLF),\npara atualiza\u00e7\u00e3o da data de \u00faltima vistoria informada no sistema (STU). */\n\nSELECT\n  data,\n  id_veiculo,\n  placa,\n  MAX(ano_ultima_vistoria) AS ano_ultima_vistoria,\nFROM\n    (\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`\n    )\nGROUP BY\n  1,\n  2,\n  3\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_veiculo_dia": {"database": "rj-smtr", "schema": "veiculo", "name": "sppo_veiculo_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/sppo_veiculo_dia.sql", "original_file_path": "models/veiculo/sppo_veiculo_dia.sql", "unique_id": "model.rj_smtr.sppo_veiculo_dia", "fqn": ["rj_smtr", "veiculo", "sppo_veiculo_dia"], "alias": "sppo_veiculo_dia", "checksum": {"name": "sha256", "checksum": "4dadcf81b706fbdc5dc5d2ff0ed29becf6c5b908e8439da55b3bda5172b3e5ed"}, "config": {"enabled": true, "alias": null, "schema": "veiculo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "id_veiculo"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela resumo dos ve\u00edculos que operaram no SPPO e seus respectivos indicadores", "columns": {"data": {"name": "data", "description": "Data de opera\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores": {"name": "indicadores", "description": "Indicadores para carateriza\u00e7\u00e3o do status do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_licenciado": {"name": "indicadores.indicador_licenciado", "description": "Indicador se o ve\u00edculo encontra-se licenciado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_ar_condicionado": {"name": "indicadores.indicador_ar_condicionado", "description": "Indicador se o ve\u00edculo foi licenciado com ar condicionado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_autuacao_ar_condicionado": {"name": "indicadores.indicador_autuacao_ar_condicionado", "description": "Indicador se o ve\u00edculo foi autuado por inoper\u00e2ncia ou mau funcionamento do sistema de ar condicionado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_autuacao_seguranca": {"name": "indicadores.indicador_autuacao_seguranca", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 seguran\u00e7a do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_autuacao_limpeza": {"name": "indicadores.indicador_autuacao_limpeza", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 limpeza do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_autuacao_equipamento": {"name": "indicadores.indicador_autuacao_equipamento", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 inoper\u00e2ncia ou mau funcionamento de equipamentos do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_sensor_temperatura": {"name": "indicadores.indicador_sensor_temperatura", "description": "Indicador se o sensor de temperatura do ve\u00edculo n\u00e3o estava em funcionamento conforme especifica\u00e7\u00e3o da SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicadores.indicador_validador_sbd": {"name": "indicadores.indicador_validador_sbd", "description": "Indicador se o ve\u00edculo se encontra com o novo validador do Sistema de Bilhetagem Digital (SBD) instalado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Classifica\u00e7\u00e3o, observados os demais par\u00e2metros - Categorias:\n - N\u00e3o licenciado - Ve\u00edculo que operou, mas n\u00e3o \u00e9 licenciado\n - Autuado por ar inoperante - Ve\u00edculo que operou, foi licenciado com ar condicionado e foi autuado por inoper\u00e2ncia ou mau funcionamento do sistema de ar condicionado (023.II)\n - Autuado por seguran\u00e7a - Ve\u00edculo que operou, foi licenciado, mas foi autuado por infra\u00e7\u00e3o relacionada \u00e0 seguran\u00e7a do ve\u00edculo\n - Autuado por limpeza/equipamento - Ve\u00edculo que operou, foi licenciado, mas foi autuado cumulativamente por infra\u00e7\u00f5es relacionadas \u00e0 limpeza e equipamentos do ve\u00edculo\n - Sem ar e n\u00e3o autuado - Ve\u00edculo que operou, foi licenciado sem ar condicionado e n\u00e3o foi autuado\n - Com ar e n\u00e3o autuado - Ve\u00edculo que operou, foi licenciado com ar condicionado e n\u00e3o foi autuado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "SHA do reposit\u00f3rio no Github", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "veiculo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "id_veiculo"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6331627, "relation_name": "`rj-smtr`.`veiculo`.`sppo_veiculo_dia`", "raw_code": "-- depends_on: {{ ref('sppo_licenciamento_stu_staging') }}\n{{\n    config(\n        materialized=\"incremental\",\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n        unique_key=[\"data\", \"id_veiculo\"],\n        incremental_strategy=\"insert_overwrite\",\n    )\n}}\n\n{% if execute %}\n  {% set licenciamento_date = run_query(get_license_date()).columns[0].values()[0] %}\n{% endif %}\n\nWITH\n  licenciamento AS (\n  SELECT\n    DATE(\"{{ var('run_date') }}\") AS data,\n    id_veiculo,\n    placa,\n    tipo_veiculo,\n    indicador_ar_condicionado,\n    TRUE AS indicador_licenciado,\n    CASE\n    WHEN ano_ultima_vistoria_atualizado >= CAST(EXTRACT(YEAR FROM DATE_SUB(DATE(\"{{ var('run_date') }}\"), INTERVAL {{ var('sppo_licenciamento_validade_vistoria_ano') }} YEAR)) AS INT64) THEN TRUE -- \u00daltima vistoria realizada dentro do per\u00edodo v\u00e1lido\n    WHEN data_ultima_vistoria IS NULL AND DATE_DIFF(DATE(\"{{ var('run_date') }}\"), data_inicio_vinculo, DAY) <=  {{ var('sppo_licenciamento_tolerancia_primeira_vistoria_dia') }} THEN TRUE -- Caso o ve\u00edculo seja novo, existe a toler\u00e2ncia de 15 dias para a primeira vistoria\n    WHEN ano_fabricacao IN (2023, 2024) AND CAST(EXTRACT(YEAR FROM DATE(\"{{ var('run_date') }}\")) AS INT64) = 2024 THEN TRUE -- Caso o ve\u00edculo tiver ano de fabrica\u00e7\u00e3o 2023 ou 2024, ser\u00e1 considerado como vistoriado apenas em 2024 (regra de transi\u00e7\u00e3o)\n  ELSE FALSE\n  END AS indicador_vistoriado,\n  FROM\n    {{ ref(\"sppo_licenciamento\") }} --`rj-smtr`.`veiculo`.`sppo_licenciamento`\n  WHERE\n    data = DATE(\"{{ licenciamento_date }}\")\n  ),\n  gps AS (\n  SELECT\n    DISTINCT data,\n    id_veiculo\n  FROM\n    {{ ref(\"gps_sppo\") }}\n    -- rj-smtr.br_rj_riodejaneiro_veiculos.gps_sppo\n  WHERE\n    data = DATE(\"{{ var('run_date') }}\") ),\n  autuacoes AS (\n  SELECT\n    DISTINCT data_infracao AS data,\n    placa,\n    id_infracao\n  FROM\n    {{ ref(\"sppo_infracao\") }}\n  WHERE\n  {%- if execute %}\n    {% set infracao_date = run_query(\"SELECT MIN(data) FROM \" ~ ref(\"sppo_infracao\") ~ \" WHERE data >= DATE_ADD(DATE('\" ~ var(\"run_date\") ~ \"'), INTERVAL 7 DAY)\").columns[0].values()[0] %}\n  {% endif -%}\n    data = DATE(\"{{ infracao_date }}\")\n    AND data_infracao = DATE(\"{{ var('run_date') }}\")\n    AND modo = \"ONIBUS\"),\n  registros_agente_verao AS (\n    SELECT\n      DISTINCT data,\n      id_veiculo,\n      TRUE AS indicador_registro_agente_verao_ar_condicionado\n    FROM\n      {{ ref(\"sppo_registro_agente_verao\") }}\n      -- rj-smtr.veiculo.sppo_registro_agente_verao\n    WHERE\n      data = DATE(\"{{ var('run_date') }}\") ),\n  autuacao_ar_condicionado AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_ar_condicionado\n  FROM\n    autuacoes\n  WHERE\n    id_infracao = \"023.II\" ),\n  autuacao_seguranca AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_seguranca\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"016.VI\",\n      \"023.VII\",\n      \"024.II\",\n      \"024.III\",\n      \"024.IV\",\n      \"024.V\",\n      \"024.VI\",\n      \"024.VII\",\n      \"024.VIII\",\n      \"024.IX\",\n      \"024.XII\",\n      \"024.XIV\",\n      \"024.XV\",\n      \"025.II\",\n      \"025.XII\",\n      \"025.XIII\",\n      \"025.XIV\",\n      \"026.X\") ),\n  autuacao_equipamento AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_equipamento\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"023.IV\",\n      \"023.V\",\n      \"023.VI\",\n      \"023.VIII\",\n      \"024.XIII\",\n      \"024.XI\",\n      \"024.XVIII\",\n      \"024.XXI\",\n      \"025.III\",\n      \"025.IV\",\n      \"025.V\",\n      \"025.VI\",\n      \"025.VII\",\n      \"025.VIII\",\n      \"025.IX\",\n      \"025.X\",\n      \"025.XI\") ),\n  autuacao_limpeza AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_limpeza\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"023.IX\",\n      \"024.X\") ),\n  autuacoes_agg AS (\n  SELECT\n    DISTINCT *\n  FROM\n    autuacao_ar_condicionado\n  FULL JOIN\n    autuacao_seguranca\n  USING\n    (data,\n      placa)\n  FULL JOIN\n    autuacao_equipamento\n  USING\n    (data,\n      placa)\n  FULL JOIN\n    autuacao_limpeza\n  USING\n    (data,\n      placa) ),\n  gps_licenciamento_autuacao AS (\n  SELECT\n    data,\n    id_veiculo,\n    {% if var(\"run_date\") >= var(\"DATA_SUBSIDIO_V5_INICIO\") %}\n      STRUCT( COALESCE(l.indicador_licenciado, FALSE)                               AS indicador_licenciado,\n              COALESCE(l.indicador_vistoriado, FALSE)                               AS indicador_vistoriado,\n              COALESCE(l.indicador_ar_condicionado, FALSE)                          AS indicador_ar_condicionado,\n              COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)                 AS indicador_autuacao_ar_condicionado,\n              COALESCE(a.indicador_autuacao_seguranca, FALSE)                       AS indicador_autuacao_seguranca,\n              COALESCE(a.indicador_autuacao_limpeza, FALSE)                         AS indicador_autuacao_limpeza,\n              COALESCE(a.indicador_autuacao_equipamento, FALSE)                     AS indicador_autuacao_equipamento,\n              COALESCE(r.indicador_registro_agente_verao_ar_condicionado, FALSE)    AS indicador_registro_agente_verao_ar_condicionado)\n      -- WHEN data >= DATE(\"DATA_SUBSIDIO_V4_INICIO\") THEN\n      -- STRUCT( COALESCE(l.indicador_licenciado, FALSE)                     AS indicador_licenciado,\n      --         COALESCE(l.indicador_ar_condicionado, FALSE)                AS indicador_ar_condicionado,\n      --         COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)       AS indicador_autuacao_ar_condicionado,\n      --         COALESCE(a.indicador_autuacao_seguranca, FALSE)             AS indicador_autuacao_seguranca,\n      --         COALESCE(a.indicador_autuacao_limpeza, FALSE)               AS indicador_autuacao_limpeza,\n      --         COALESCE(a.indicador_autuacao_equipamento, FALSE)           AS indicador_autuacao_equipamento,\n      --         COALESCE(r.indicador_registro_agente_verao_ar_condicionado, FALSE)   AS indicador_registro_agente_verao_ar_condicionado)\n      -- WHEN data >= DATE(\"DATA_SUBSIDIO_V3_INICIO\") THEN\n      -- STRUCT( COALESCE(l.indicador_licenciado, FALSE)                     AS indicador_licenciado,\n      --         COALESCE(l.indicador_ar_condicionado, FALSE)                AS indicador_ar_condicionado,\n      --         COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)       AS indicador_autuacao_ar_condicionado,\n      --         COALESCE(a.indicador_autuacao_seguranca, FALSE)             AS indicador_autuacao_seguranca,\n      --         COALESCE(a.indicador_autuacao_limpeza, FALSE)               AS indicador_autuacao_limpeza,\n      --         COALESCE(a.indicador_autuacao_equipamento, FALSE)           AS indicador_autuacao_equipamento)\n      -- WHEN data >= DATE(\"DATA_SUBSIDIO_V2_INICIO\") THEN\n      -- STRUCT( COALESCE(l.indicador_licenciado, FALSE)                     AS indicador_licenciado,\n      --         COALESCE(l.indicador_ar_condicionado, FALSE)                AS indicador_ar_condicionado,\n      --         COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)       AS indicador_autuacao_ar_condicionado)\n      -- ELSE\n      -- NULL\n    {% else %}\n      STRUCT( COALESCE(l.indicador_licenciado, FALSE)                     AS indicador_licenciado,\n              COALESCE(l.indicador_ar_condicionado, FALSE)                AS indicador_ar_condicionado,\n              COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)       AS indicador_autuacao_ar_condicionado,\n              COALESCE(a.indicador_autuacao_seguranca, FALSE)             AS indicador_autuacao_seguranca,\n              COALESCE(a.indicador_autuacao_limpeza, FALSE)               AS indicador_autuacao_limpeza,\n              COALESCE(a.indicador_autuacao_equipamento, FALSE)           AS indicador_autuacao_equipamento,\n              COALESCE(r.indicador_registro_agente_verao_ar_condicionado, FALSE)   AS indicador_registro_agente_verao_ar_condicionado)\n    {% endif %}\n    AS indicadores\n  FROM\n    gps g\n  LEFT JOIN\n    licenciamento AS l\n  USING\n    (data,\n      id_veiculo)\n  LEFT JOIN\n    autuacoes_agg AS a\n  USING\n    (data,\n      placa)\n  LEFT JOIN\n    registros_agente_verao AS r\n  USING\n    (data,\n      id_veiculo))\n{% if var(\"run_date\") < var(\"DATA_SUBSIDIO_V5_INICIO\") %}\nSELECT\n  gla.* EXCEPT(indicadores),\n  TO_JSON(indicadores) AS indicadores,\n  status,\n  \"{{ var(\"version\") }}\" AS versao\nFROM\n  gps_licenciamento_autuacao AS gla\nLEFT JOIN\n  {{ ref(\"subsidio_parametros\") }} AS p --`rj-smtr.dashboard_subsidio_sppo.subsidio_parametros`\nON\n  gla.indicadores.indicador_licenciado = p.indicador_licenciado\n  AND gla.indicadores.indicador_ar_condicionado = p.indicador_ar_condicionado\n  AND gla.indicadores.indicador_autuacao_ar_condicionado = p.indicador_autuacao_ar_condicionado\n  AND gla.indicadores.indicador_autuacao_seguranca = p.indicador_autuacao_seguranca\n  AND gla.indicadores.indicador_autuacao_limpeza = p.indicador_autuacao_limpeza\n  AND gla.indicadores.indicador_autuacao_equipamento = p.indicador_autuacao_equipamento\n  AND gla.indicadores.indicador_registro_agente_verao_ar_condicionado = p.indicador_registro_agente_verao_ar_condicionado\n  AND (data BETWEEN p.data_inicio AND p.data_fim)\n{% else %}\nSELECT\n  * EXCEPT(indicadores),\n  TO_JSON(indicadores) AS indicadores,\n  CASE\n    WHEN indicadores.indicador_licenciado IS FALSE THEN \"N\u00e3o licenciado\"\n    WHEN indicadores.indicador_vistoriado IS FALSE THEN \"N\u00e3o vistoriado\"\n    WHEN indicadores.indicador_ar_condicionado IS TRUE AND indicadores.indicador_autuacao_ar_condicionado IS TRUE THEN \"Autuado por ar inoperante\"\n    WHEN indicadores.indicador_ar_condicionado IS TRUE AND indicadores.indicador_registro_agente_verao_ar_condicionado IS TRUE THEN \"Registrado com ar inoperante\"\n    WHEN indicadores.indicador_autuacao_seguranca IS TRUE THEN \"Autuado por seguran\u00e7a\"\n    WHEN indicadores.indicador_autuacao_limpeza IS TRUE AND indicadores.indicador_autuacao_equipamento IS TRUE THEN \"Autuado por limpeza/equipamento\"\n    WHEN indicadores.indicador_ar_condicionado IS FALSE THEN \"Licenciado sem ar e n\u00e3o autuado\"\n    WHEN indicadores.indicador_ar_condicionado IS TRUE THEN \"Licenciado com ar e n\u00e3o autuado\"\n    ELSE NULL\n  END AS status,\n  \"{{ var(\"version\") }}\" AS versao\nFROM\n  gps_licenciamento_autuacao\n{% endif %}", "language": "sql", "refs": [{"name": "sppo_licenciamento_stu_staging", "package": null, "version": null}, {"name": "sppo_licenciamento", "package": null, "version": null}, {"name": "gps_sppo", "package": null, "version": null}, {"name": "sppo_infracao", "package": null, "version": null}, {"name": "sppo_registro_agente_verao", "package": null, "version": null}, {"name": "subsidio_parametros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.get_license_date", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.sppo_licenciamento_stu_staging", "model.rj_smtr.sppo_licenciamento", "model.rj_smtr.gps_sppo", "model.rj_smtr.sppo_infracao", "model.rj_smtr.sppo_registro_agente_verao", "model.rj_smtr.subsidio_parametros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/sppo_veiculo_dia.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`veiculo_staging`.`sppo_licenciamento_stu`\n\n\n\n  \n\n\nWITH\n  licenciamento AS (\n  SELECT\n    DATE(\"2022-01-01T01:00:00\") AS data,\n    id_veiculo,\n    placa,\n    tipo_veiculo,\n    indicador_ar_condicionado,\n    TRUE AS indicador_licenciado,\n    CASE\n    WHEN ano_ultima_vistoria_atualizado >= CAST(EXTRACT(YEAR FROM DATE_SUB(DATE(\"2022-01-01T01:00:00\"), INTERVAL 1 YEAR)) AS INT64) THEN TRUE -- \u00daltima vistoria realizada dentro do per\u00edodo v\u00e1lido\n    WHEN data_ultima_vistoria IS NULL AND DATE_DIFF(DATE(\"2022-01-01T01:00:00\"), data_inicio_vinculo, DAY) <=  15 THEN TRUE -- Caso o ve\u00edculo seja novo, existe a toler\u00e2ncia de 15 dias para a primeira vistoria\n    WHEN ano_fabricacao IN (2023, 2024) AND CAST(EXTRACT(YEAR FROM DATE(\"2022-01-01T01:00:00\")) AS INT64) = 2024 THEN TRUE -- Caso o ve\u00edculo tiver ano de fabrica\u00e7\u00e3o 2023 ou 2024, ser\u00e1 considerado como vistoriado apenas em 2024 (regra de transi\u00e7\u00e3o)\n  ELSE FALSE\n  END AS indicador_vistoriado,\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_licenciamento` --`rj-smtr`.`veiculo`.`sppo_licenciamento`\n  WHERE\n    data = DATE(\"2023-02-01\")\n  ),\n  gps AS (\n  SELECT\n    DISTINCT data,\n    id_veiculo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_veiculos`.`gps_sppo`\n    -- rj-smtr.br_rj_riodejaneiro_veiculos.gps_sppo\n  WHERE\n    data = DATE(\"2022-01-01T01:00:00\") ),\n  autuacoes AS (\n  SELECT\n    DISTINCT data_infracao AS data,\n    placa,\n    id_infracao\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_infracao`\n  WHERE\n    \n  data = DATE(\"2023-02-10\")\n    AND data_infracao = DATE(\"2022-01-01T01:00:00\")\n    AND modo = \"ONIBUS\"),\n  registros_agente_verao AS (\n    SELECT\n      DISTINCT data,\n      id_veiculo,\n      TRUE AS indicador_registro_agente_verao_ar_condicionado\n    FROM\n      `rj-smtr`.`veiculo`.`sppo_registro_agente_verao`\n      -- rj-smtr.veiculo.sppo_registro_agente_verao\n    WHERE\n      data = DATE(\"2022-01-01T01:00:00\") ),\n  autuacao_ar_condicionado AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_ar_condicionado\n  FROM\n    autuacoes\n  WHERE\n    id_infracao = \"023.II\" ),\n  autuacao_seguranca AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_seguranca\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"016.VI\",\n      \"023.VII\",\n      \"024.II\",\n      \"024.III\",\n      \"024.IV\",\n      \"024.V\",\n      \"024.VI\",\n      \"024.VII\",\n      \"024.VIII\",\n      \"024.IX\",\n      \"024.XII\",\n      \"024.XIV\",\n      \"024.XV\",\n      \"025.II\",\n      \"025.XII\",\n      \"025.XIII\",\n      \"025.XIV\",\n      \"026.X\") ),\n  autuacao_equipamento AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_equipamento\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"023.IV\",\n      \"023.V\",\n      \"023.VI\",\n      \"023.VIII\",\n      \"024.XIII\",\n      \"024.XI\",\n      \"024.XVIII\",\n      \"024.XXI\",\n      \"025.III\",\n      \"025.IV\",\n      \"025.V\",\n      \"025.VI\",\n      \"025.VII\",\n      \"025.VIII\",\n      \"025.IX\",\n      \"025.X\",\n      \"025.XI\") ),\n  autuacao_limpeza AS (\n  SELECT\n    data,\n    placa,\n    TRUE AS indicador_autuacao_limpeza\n  FROM\n    autuacoes\n  WHERE\n    id_infracao IN (\n      \"023.IX\",\n      \"024.X\") ),\n  autuacoes_agg AS (\n  SELECT\n    DISTINCT *\n  FROM\n    autuacao_ar_condicionado\n  FULL JOIN\n    autuacao_seguranca\n  USING\n    (data,\n      placa)\n  FULL JOIN\n    autuacao_equipamento\n  USING\n    (data,\n      placa)\n  FULL JOIN\n    autuacao_limpeza\n  USING\n    (data,\n      placa) ),\n  gps_licenciamento_autuacao AS (\n  SELECT\n    data,\n    id_veiculo,\n    \n      STRUCT( COALESCE(l.indicador_licenciado, FALSE)                     AS indicador_licenciado,\n              COALESCE(l.indicador_ar_condicionado, FALSE)                AS indicador_ar_condicionado,\n              COALESCE(a.indicador_autuacao_ar_condicionado, FALSE)       AS indicador_autuacao_ar_condicionado,\n              COALESCE(a.indicador_autuacao_seguranca, FALSE)             AS indicador_autuacao_seguranca,\n              COALESCE(a.indicador_autuacao_limpeza, FALSE)               AS indicador_autuacao_limpeza,\n              COALESCE(a.indicador_autuacao_equipamento, FALSE)           AS indicador_autuacao_equipamento,\n              COALESCE(r.indicador_registro_agente_verao_ar_condicionado, FALSE)   AS indicador_registro_agente_verao_ar_condicionado)\n    \n    AS indicadores\n  FROM\n    gps g\n  LEFT JOIN\n    licenciamento AS l\n  USING\n    (data,\n      id_veiculo)\n  LEFT JOIN\n    autuacoes_agg AS a\n  USING\n    (data,\n      placa)\n  LEFT JOIN\n    registros_agente_verao AS r\n  USING\n    (data,\n      id_veiculo))\n\nSELECT\n  gla.* EXCEPT(indicadores),\n  TO_JSON(indicadores) AS indicadores,\n  status,\n  \"\" AS versao\nFROM\n  gps_licenciamento_autuacao AS gla\nLEFT JOIN\n  `rj-smtr`.`dashboard_subsidio_sppo`.`subsidio_parametros` AS p --`rj-smtr.dashboard_subsidio_sppo.subsidio_parametros`\nON\n  gla.indicadores.indicador_licenciado = p.indicador_licenciado\n  AND gla.indicadores.indicador_ar_condicionado = p.indicador_ar_condicionado\n  AND gla.indicadores.indicador_autuacao_ar_condicionado = p.indicador_autuacao_ar_condicionado\n  AND gla.indicadores.indicador_autuacao_seguranca = p.indicador_autuacao_seguranca\n  AND gla.indicadores.indicador_autuacao_limpeza = p.indicador_autuacao_limpeza\n  AND gla.indicadores.indicador_autuacao_equipamento = p.indicador_autuacao_equipamento\n  AND gla.indicadores.indicador_registro_agente_verao_ar_condicionado = p.indicador_registro_agente_verao_ar_condicionado\n  AND (data BETWEEN p.data_inicio AND p.data_fim)\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_licenciamento_solicitacao": {"database": "rj-smtr", "schema": "veiculo", "name": "sppo_licenciamento_solicitacao", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/sppo_licenciamento_solicitacao.sql", "original_file_path": "models/veiculo/sppo_licenciamento_solicitacao.sql", "unique_id": "model.rj_smtr.sppo_licenciamento_solicitacao", "fqn": ["rj_smtr", "veiculo", "sppo_licenciamento_solicitacao"], "alias": "sppo_licenciamento_solicitacao", "checksum": {"name": "sha256", "checksum": "5e71416268499a3df0edc462993dbb980e4e2956ff77153576018730b5ce9aff"}, "config": {"enabled": true, "alias": null, "schema": "veiculo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "id_veiculo"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"granularity": "day", "data_type": "date", "field": "data"}}, "tags": [], "description": "Tabela hist\u00f3rica de dados cadastrais das solicita\u00e7\u00f5es em andamento para ingresso no Sistema de Transporte Urbano (STU)", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura dos dados de licenciamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "carroceria": {"name": "carroceria", "description": "Descri\u00e7\u00e3o do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_vistoria": {"name": "data_ultima_vistoria", "description": "Data da \u00faltima vistoria do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_carroceria": {"name": "id_carroceria", "description": "C\u00f3digo do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_chassi": {"name": "id_chassi", "description": "C\u00f3digo do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_fabricante_chassi": {"name": "id_fabricante_chassi", "description": "Identificador do fabricante do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_interno_carroceria": {"name": "id_interno_carroceria", "description": "C\u00f3digo interno do modelo de carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_planta": {"name": "id_planta", "description": "C\u00f3digo da planta do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se possui ar condicionado (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_elevador": {"name": "indicador_elevador", "description": "Indicador se possui elevador (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_usb": {"name": "indicador_usb", "description": "Indicador se tem USB (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_wifi": {"name": "indicador_wifi", "description": "Indicador se tem Wi-fi (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_chassi": {"name": "nome_chassi", "description": "Descri\u00e7\u00e3o do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_pe": {"name": "quantidade_lotacao_pe", "description": "Quantidade de passageiros em p\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_sentado": {"name": "quantidade_lotacao_sentado", "description": "Quantidade de passageiros sentados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_combustivel": {"name": "tipo_combustivel", "description": "Combust\u00edvel utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Inv\u00e1lido - Ve\u00edculo com solicita\u00e7\u00e3o inv\u00e1lida para ingresso no Sistema de Transporte Urbano (STU)\n V\u00e1lido - Ve\u00edculo com solicita\u00e7\u00e3o v\u00e1lida para ingresso no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "solicitacao": {"name": "solicitacao", "description": "Inclus\u00e3o - Solicita\u00e7\u00e3o de ingresso de ve\u00edculo no Sistema de Transporte Urbano (STU)\n Baixa - Solicita\u00e7\u00e3o de baixa de ve\u00edculo j\u00e1 inclu\u00eddo no Sistema de Transporte Urbano (STU)\n Renumera\u00e7\u00e3o - Solicita\u00e7\u00e3o de altera\u00e7\u00e3o de n\u00famero de ordem de ve\u00edculo j\u00e1 inclu\u00eddo no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "veiculo", "partition_by": {"granularity": "day", "data_type": "date", "field": "data"}, "unique_key": ["data", "id_veiculo"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6291916, "relation_name": "`rj-smtr`.`veiculo`.`sppo_licenciamento_solicitacao`", "raw_code": "{{ config(\n       materialized='incremental',\n       partition_by={\n              \"field\":\"data\",\n              \"data_type\": \"date\",\n              \"granularity\":\"day\"\n       },\n       unique_key=['data', 'id_veiculo'],\n       incremental_strategy='insert_overwrite'\n)\n}}\n\nSELECT\n   *\n FROM\n     {{ ref('sppo_licenciamento_solicitacao_staging') }} as t", "language": "sql", "refs": [{"name": "sppo_licenciamento_solicitacao_staging", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_licenciamento_solicitacao_staging"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/sppo_licenciamento_solicitacao.sql", "compiled": true, "compiled_code": "\n\nSELECT\n   *\n FROM\n     `rj-smtr`.`veiculo_staging`.`sppo_licenciamento_solicitacao` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_registro_agente_verao_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_registro_agente_verao_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_registro_agente_verao_staging.sql", "original_file_path": "models/veiculo/staging/sppo_registro_agente_verao_staging.sql", "unique_id": "model.rj_smtr.sppo_registro_agente_verao_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_registro_agente_verao_staging"], "alias": "sppo_registro_agente_verao", "checksum": {"name": "sha256", "checksum": "ab823b1b2e531fcb687a34c0709494db731deb167e67d26b69027a03bd96d569"}, "config": {"enabled": true, "alias": "sppo_registro_agente_verao", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View com registros de Agentes de Ver\u00e3o para fins de c\u00e1lculo de subs\u00eddio nos termos da RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024", "columns": {"data": {"name": "data", "description": "Data de registro pelo agente p\u00fablico", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_registro": {"name": "datetime_registro", "description": "Datetime de registro pelo agente p\u00fablico", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_registro": {"name": "id_registro", "description": "ID do registro (HASH SHA256)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto da linha operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 010, SN011, ...)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "link_foto": {"name": "link_foto", "description": "Link com a imagem interna do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "validacao": {"name": "validacao", "description": "Coluna de valida\u00e7\u00e3o do registro enviado pelo agente p\u00fablico (apenas TRUE nesta tabela)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Datetime de captura do registro pela pipeline", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "SHA do reposit\u00f3rio no Github", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_registro_agente_verao"}, "created_at": 1727709588.6423445, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_registro_agente_verao`", "raw_code": "{{ config(\n        materialized=\"view\",\n        alias='sppo_registro_agente_verao'\n)\n}}\n\nSELECT\n  SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) AS DATE) AS data,\n  SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) AS DATETIME) AS datetime_registro,\n  SHA256(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) || \"_\" || SAFE_CAST(email AS STRING)) AS id_registro,\n  SAFE_CAST(JSON_VALUE(content,'$.id_veiculo') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.servico') AS STRING) AS servico,\n  SAFE_CAST(JSON_VALUE(content,'$.link_foto') AS STRING) AS link_foto,\n  SAFE_CAST(JSON_VALUE(content,'$.validacao') AS BOOL) AS validacao,\n  SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) AS datetime_captura,\n  \"{{ var(\"version\") }}\" AS versao\nFROM\n  {{ source('veiculo_staging','sppo_registro_agente_verao') }}", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_registro_agente_verao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_registro_agente_verao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_registro_agente_verao_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) AS DATE) AS data,\n  SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) AS DATETIME) AS datetime_registro,\n  SHA256(PARSE_DATETIME(\"%d/%m/%Y %H:%M:%S\", datetime_registro) || \"_\" || SAFE_CAST(email AS STRING)) AS id_registro,\n  SAFE_CAST(JSON_VALUE(content,'$.id_veiculo') AS STRING) AS id_veiculo,\n  SAFE_CAST(JSON_VALUE(content,'$.servico') AS STRING) AS servico,\n  SAFE_CAST(JSON_VALUE(content,'$.link_foto') AS STRING) AS link_foto,\n  SAFE_CAST(JSON_VALUE(content,'$.validacao') AS BOOL) AS validacao,\n  SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) AS datetime_captura,\n  \"\" AS versao\nFROM\n  `rj-smtr-staging`.`veiculo_staging`.`sppo_registro_agente_verao`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_licenciamento_stu_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_licenciamento_stu_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_licenciamento_stu_staging.sql", "original_file_path": "models/veiculo/staging/sppo_licenciamento_stu_staging.sql", "unique_id": "model.rj_smtr.sppo_licenciamento_stu_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_licenciamento_stu_staging"], "alias": "sppo_licenciamento_stu", "checksum": {"name": "sha256", "checksum": "9b8d426592fe7244e0615f5a25c75dccc3a3708e43cc3d4ba112117bd011284b"}, "config": {"enabled": true, "alias": "sppo_licenciamento_stu", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View de Dados cadastrais dos ve\u00edculos que operam o sistema de \u00f4nibus (BRT e SPPO) no munic\u00edpio do Rio de Janeiro.\n Dados capturados diariamente de: https://www.data.rio/documents/c6c97d3c15434b5088965e25f85e27c3", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura dos dados de licenciamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "carroceria": {"name": "carroceria", "description": "Descri\u00e7\u00e3o do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_vistoria": {"name": "data_ultima_vistoria", "description": "Data da \u00faltima vistoria do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_carroceria": {"name": "id_carroceria", "description": "C\u00f3digo do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_chassi": {"name": "id_chassi", "description": "C\u00f3digo do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_fabricante_chassi": {"name": "id_fabricante_chassi", "description": "Identificador do fabricante do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_interno_carroceria": {"name": "id_interno_carroceria", "description": "C\u00f3digo interno do modelo de carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_planta": {"name": "id_planta", "description": "C\u00f3digo da planta do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se possui ar condicionado (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_elevador": {"name": "indicador_elevador", "description": "Indicador se possui elevador (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_usb": {"name": "indicador_usb", "description": "Indicador se tem USB (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_wifi": {"name": "indicador_wifi", "description": "Indicador se tem Wi-fi (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_chassi": {"name": "nome_chassi", "description": "Descri\u00e7\u00e3o do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_pe": {"name": "quantidade_lotacao_pe", "description": "Quantidade de passageiros em p\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_sentado": {"name": "quantidade_lotacao_sentado", "description": "Quantidade de passageiros sentados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_combustivel": {"name": "tipo_combustivel", "description": "Combust\u00edvel utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Licenciado - Ve\u00edculo licenciado no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio_vinculo": {"name": "data_inicio_vinculo", "description": "Data de in\u00edcio do v\u00ednculo do ve\u00edculo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_licenciamento_stu"}, "created_at": 1727709588.639586, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_licenciamento_stu`", "raw_code": "{{ config(\n       materialized='view',\n       alias='sppo_licenciamento_stu'\n)\n}}\n\nSELECT\n   data,\n   SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n   SAFE_CAST(JSON_VALUE(content,\"$.modo\") AS STRING) modo,\n   SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.ano_fabricacao\") AS INT64) ano_fabricacao,\n   SAFE_CAST(JSON_VALUE(content,\"$.carroceria\") AS STRING) carroceria,\n   CASE\n    WHEN JSON_VALUE(content,\"$.data_ultima_vistoria\") = \"\" THEN NULL\n   ELSE\n    SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y\", JSON_VALUE(content,\"$.data_ultima_vistoria\")) AS DATE)\n   END\n   AS data_ultima_vistoria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_carroceria\") AS INT64) id_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_chassi\") AS INT64) id_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_fabricante_chassi\") AS INT64) id_fabricante_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_interno_carroceria\") AS INT64) id_interno_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_planta\") AS INT64) id_planta,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_ar_condicionado\") AS BOOL) indicador_ar_condicionado,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_elevador\") AS BOOL) indicador_elevador,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_usb\") AS BOOL) indicador_usb,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_wifi\") AS BOOL) indicador_wifi,\n   SAFE_CAST(JSON_VALUE(content,\"$.nome_chassi\") AS STRING) nome_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.permissao\") AS STRING) permissao,\n   SAFE_CAST(JSON_VALUE(content,\"$.placa\") AS STRING) placa,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_pe\") AS INT64) quantidade_lotacao_pe,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_sentado\") AS INT64) quantidade_lotacao_sentado,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_combustivel\") AS STRING) tipo_combustivel,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_veiculo\") AS STRING) tipo_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.status\") AS STRING) status,\n   CASE\n    WHEN JSON_VALUE(content,\"$.data_inicio_vinculo\") = \"\" THEN NULL\n    ELSE\n    SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y\", JSON_VALUE(content,\"$.data_inicio_vinculo\")) AS DATE)\n  END\n    AS data_inicio_vinculo,\n FROM\n    {{ source('veiculo_staging','sppo_licenciamento_stu') }} as t", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_licenciamento_stu"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_licenciamento_stu"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_licenciamento_stu_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n   data,\n   SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n   SAFE_CAST(JSON_VALUE(content,\"$.modo\") AS STRING) modo,\n   SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.ano_fabricacao\") AS INT64) ano_fabricacao,\n   SAFE_CAST(JSON_VALUE(content,\"$.carroceria\") AS STRING) carroceria,\n   CASE\n    WHEN JSON_VALUE(content,\"$.data_ultima_vistoria\") = \"\" THEN NULL\n   ELSE\n    SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y\", JSON_VALUE(content,\"$.data_ultima_vistoria\")) AS DATE)\n   END\n   AS data_ultima_vistoria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_carroceria\") AS INT64) id_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_chassi\") AS INT64) id_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_fabricante_chassi\") AS INT64) id_fabricante_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_interno_carroceria\") AS INT64) id_interno_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_planta\") AS INT64) id_planta,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_ar_condicionado\") AS BOOL) indicador_ar_condicionado,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_elevador\") AS BOOL) indicador_elevador,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_usb\") AS BOOL) indicador_usb,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_wifi\") AS BOOL) indicador_wifi,\n   SAFE_CAST(JSON_VALUE(content,\"$.nome_chassi\") AS STRING) nome_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.permissao\") AS STRING) permissao,\n   SAFE_CAST(JSON_VALUE(content,\"$.placa\") AS STRING) placa,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_pe\") AS INT64) quantidade_lotacao_pe,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_sentado\") AS INT64) quantidade_lotacao_sentado,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_combustivel\") AS STRING) tipo_combustivel,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_veiculo\") AS STRING) tipo_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.status\") AS STRING) status,\n   CASE\n    WHEN JSON_VALUE(content,\"$.data_inicio_vinculo\") = \"\" THEN NULL\n    ELSE\n    SAFE_CAST(PARSE_DATETIME(\"%d/%m/%Y\", JSON_VALUE(content,\"$.data_inicio_vinculo\")) AS DATE)\n  END\n    AS data_inicio_vinculo,\n FROM\n    `rj-smtr-staging`.`veiculo_staging`.`sppo_licenciamento_stu` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_infracao_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_infracao_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_infracao_staging.sql", "original_file_path": "models/veiculo/staging/sppo_infracao_staging.sql", "unique_id": "model.rj_smtr.sppo_infracao_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_infracao_staging"], "alias": "sppo_infracao", "checksum": {"name": "sha256", "checksum": "4c88d0d81c577b7c174cdacb0041193a7a95282b4302ea4e94123921dd4932ca"}, "config": {"enabled": true, "alias": "sppo_infracao", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View de todas as multas aplicadas aos modos de transporte no munic\u00edpio do Rio de Janeiro, com qualquer situa\u00e7\u00e3o. Dados capturados diariamente de: https://www.data.rio/documents/multas-aplicadas-aos-modos-de-transporte-nos-%C3%BAltimos-cinco-anos", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura dos dados de infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_auto_infracao": {"name": "id_auto_infracao", "description": "Identificador do auto de infra\u00e7\u00e3o da multa aplicada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_infracao": {"name": "data_infracao", "description": "Data da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor devido (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_infracao": {"name": "id_infracao", "description": "C\u00f3digo da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "infracao": {"name": "infracao", "description": "Descri\u00e7\u00e3o da infra\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "CADASTRADA - Registrada no sistema sem guia de pagamento\n EM ABERTO - Com guia de pagamento e dentro do prazo de vencimento\n VENCIDA - Com guia de pagamento e fora do prazo de vencimento\n EM RECURSO - Possui Processo de Recurso aguardando julgamento\n PAGA - Com guia de pagamento efetivamente paga\n CANCELADA - Multa foi cancelada atrav\u00e9s de um Processo de Recurso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data de pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_infracao"}, "created_at": 1727709588.6403947, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_infracao`", "raw_code": "{{ config(\n        materialized='view',\n        alias='sppo_infracao'\n  )\n}}\n\n\nSELECT\n  data,\n  SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n  SAFE_CAST(JSON_VALUE(content,'$.modo') AS STRING) modo,\n  SAFE_CAST(JSON_VALUE(content,'$.permissao') AS STRING) permissao,\n  SAFE_CAST(placa AS STRING) placa,\n  SAFE_CAST(id_auto_infracao AS STRING) id_auto_infracao,\n  PARSE_DATE(\"%d/%m/%Y\", SAFE_CAST(JSON_VALUE(content,'$.data_infracao') AS STRING)) data_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.valor') AS FLOAT64) valor,\n  SAFE_CAST(JSON_VALUE(content,'$.id_infracao') AS STRING) id_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.infracao') AS STRING) infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.status') AS STRING) status,\n  IF(JSON_VALUE(content,'$.data_pagamento') = \"\", NULL, PARSE_DATE(\"%d/%m/%Y\", JSON_VALUE(content,'$.data_pagamento'))) data_pagamento\nFROM\n  {{ source('veiculo_staging','sppo_infracao') }} as t", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_infracao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_infracao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_infracao_staging.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n  data,\n  SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n  SAFE_CAST(JSON_VALUE(content,'$.modo') AS STRING) modo,\n  SAFE_CAST(JSON_VALUE(content,'$.permissao') AS STRING) permissao,\n  SAFE_CAST(placa AS STRING) placa,\n  SAFE_CAST(id_auto_infracao AS STRING) id_auto_infracao,\n  PARSE_DATE(\"%d/%m/%Y\", SAFE_CAST(JSON_VALUE(content,'$.data_infracao') AS STRING)) data_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.valor') AS FLOAT64) valor,\n  SAFE_CAST(JSON_VALUE(content,'$.id_infracao') AS STRING) id_infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.infracao') AS STRING) infracao,\n  SAFE_CAST(JSON_VALUE(content,'$.status') AS STRING) status,\n  IF(JSON_VALUE(content,'$.data_pagamento') = \"\", NULL, PARSE_DATE(\"%d/%m/%Y\", JSON_VALUE(content,'$.data_pagamento'))) data_pagamento\nFROM\n  `rj-smtr-staging`.`veiculo_staging`.`sppo_infracao` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "aux_sppo_licenciamento_vistoria_atualizada", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/aux_sppo_licenciamento_vistoria_atualizada.sql", "original_file_path": "models/veiculo/staging/aux_sppo_licenciamento_vistoria_atualizada.sql", "unique_id": "model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada", "fqn": ["rj_smtr", "veiculo", "staging", "aux_sppo_licenciamento_vistoria_atualizada"], "alias": "aux_sppo_licenciamento_vistoria_atualizada", "checksum": {"name": "sha256", "checksum": "19b8548e79facb3437a3c239d9289204661e8a645fd33e64bdad9f390a8add08"}, "config": {"enabled": true, "alias": null, "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "veiculo_staging"}, "created_at": 1727709586.7591138, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n/* Dados auxiliares de vistoria de \u00f4nibus levantados pela Coordenadoria Geral de Licenciamento e Fiscaliza\u00e7\u00e3o (TR/SUBTT/CGLF),\npara atualiza\u00e7\u00e3o da data de \u00faltima vistoria informada no sistema (STU). */\n\nSELECT\n  data,\n  id_veiculo,\n  placa,\n  MAX(ano_ultima_vistoria) AS ano_ultima_vistoria,\nFROM\n    (\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            {{ ref(\"sppo_vistoria_tr_subtt_cglf_2023_staging\") }}\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            {{ ref(\"sppo_vistoria_tr_subtt_cglf_2024_staging\") }}\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            {{ ref(\"sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging\") }}\n    )\nGROUP BY\n  1,\n  2,\n  3", "language": "sql", "refs": [{"name": "sppo_vistoria_tr_subtt_cglf_2023_staging", "package": null, "version": null}, {"name": "sppo_vistoria_tr_subtt_cglf_2024_staging", "package": null, "version": null}, {"name": "sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging", "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging", "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/aux_sppo_licenciamento_vistoria_atualizada.sql", "compiled": true, "compiled_code": "\n\n/* Dados auxiliares de vistoria de \u00f4nibus levantados pela Coordenadoria Geral de Licenciamento e Fiscaliza\u00e7\u00e3o (TR/SUBTT/CGLF),\npara atualiza\u00e7\u00e3o da data de \u00faltima vistoria informada no sistema (STU). */\n\nSELECT\n  data,\n  id_veiculo,\n  placa,\n  MAX(ano_ultima_vistoria) AS ano_ultima_vistoria,\nFROM\n    (\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`\n        UNION ALL\n        SELECT\n            data,\n            id_veiculo,\n            placa,\n            ano_ultima_vistoria,\n        FROM\n            `rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`\n    )\nGROUP BY\n  1,\n  2,\n  3", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_2023_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_vistoria_tr_subtt_cglf_2023_staging.sql", "original_file_path": "models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_2023_staging.sql", "unique_id": "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_vistoria_tr_subtt_cglf_2023_staging"], "alias": "sppo_vistoria_tr_subtt_cglf_2023", "checksum": {"name": "sha256", "checksum": "ab0511bcc0c8feb211f2c6e56de45172b794999966318806b73a9c526c8ef0d1"}, "config": {"enabled": true, "alias": "sppo_vistoria_tr_subtt_cglf_2023", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "sppo_vistoria_tr_subtt_cglf_2023", "columns": {"data": {"name": "data", "description": "Data da captura", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "chassi": {"name": "chassi", "description": "Chassi do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "selo": {"name": "selo", "description": "Selo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "darm": {"name": "darm", "description": "C\u00f3digo do Documento de Arrecada\u00e7\u00e3o de Receitas Municipais", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_ultima_vistoria": {"name": "ano_ultima_vistoria", "description": "Ano da \u00faltima vistoria realizada pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_vistoria_tr_subtt_cglf_2023"}, "created_at": 1727709588.6368845, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`", "raw_code": "{{\n  config(\n    alias=\"sppo_vistoria_tr_subtt_cglf_2023\"\n  )\n}}\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(permissao AS STRING) AS permissao,\n  SAFE_CAST(chassi AS STRING) AS chassi,\n  SAFE_CAST(ano_fabricacao AS INT64) AS ano_fabricacao,\n  SAFE_CAST(selo AS STRING) AS selo,\n  SAFE_CAST(darm AS STRING) AS darm,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  {{ source(\"veiculo_staging\", \"sppo_vistoria_tr_subtt_cglf_2023\") }}", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_vistoria_tr_subtt_cglf_2023"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_2023_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(permissao AS STRING) AS permissao,\n  SAFE_CAST(chassi AS STRING) AS chassi,\n  SAFE_CAST(ano_fabricacao AS INT64) AS ano_fabricacao,\n  SAFE_CAST(selo AS STRING) AS selo,\n  SAFE_CAST(darm AS STRING) AS darm,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  `rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_2024_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_vistoria_tr_subtt_cglf_2024_staging.sql", "original_file_path": "models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_2024_staging.sql", "unique_id": "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_vistoria_tr_subtt_cglf_2024_staging"], "alias": "sppo_vistoria_tr_subtt_cglf_2024", "checksum": {"name": "sha256", "checksum": "5a25bd9cf13aa0beb6a141da03eff868737d64cfa54fea025fbef0846f005d03"}, "config": {"enabled": true, "alias": "sppo_vistoria_tr_subtt_cglf_2024", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "sppo_vistoria_tr_subtt_cglf_2024", "columns": {"data": {"name": "data", "description": "Data da captura", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "chassi": {"name": "chassi", "description": "Chassi do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "selo": {"name": "selo", "description": "Selo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "darm": {"name": "darm", "description": "C\u00f3digo do Documento de Arrecada\u00e7\u00e3o de Receitas Municipais", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_ultima_vistoria": {"name": "ano_ultima_vistoria", "description": "Ano da \u00faltima vistoria realizada pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_vistoria_tr_subtt_cglf_2024"}, "created_at": 1727709588.637604, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`", "raw_code": "{{\n  config(\n    alias=\"sppo_vistoria_tr_subtt_cglf_2024\"\n  )\n}}\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(permissao AS STRING) AS permissao,\n  SAFE_CAST(chassi AS STRING) AS chassi,\n  SAFE_CAST(ano_fabricacao AS INT64) AS ano_fabricacao,\n  SAFE_CAST(selo AS STRING) AS selo,\n  SAFE_CAST(darm AS STRING) AS darm,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  {{ source(\"veiculo_staging\", \"sppo_vistoria_tr_subtt_cglf_2024\") }}", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_vistoria_tr_subtt_cglf_2024"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_2024_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(permissao AS STRING) AS permissao,\n  SAFE_CAST(chassi AS STRING) AS chassi,\n  SAFE_CAST(ano_fabricacao AS INT64) AS ano_fabricacao,\n  SAFE_CAST(selo AS STRING) AS selo,\n  SAFE_CAST(darm AS STRING) AS darm,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  `rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging.sql", "original_file_path": "models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging.sql", "unique_id": "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging"], "alias": "sppo_vistoria_tr_subtt_cglf_pendentes_2024", "checksum": {"name": "sha256", "checksum": "543b985886190fa84fec279870e0237544fdee5239d0fbc6cc6a95a24fb51ad3"}, "config": {"enabled": true, "alias": "sppo_vistoria_tr_subtt_cglf_pendentes_2024", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "sppo_vistoria_tr_subtt_cglf_pendentes_2024", "columns": {"data": {"name": "data", "description": "Data da captura", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "empresa": {"name": "empresa", "description": "Empresa ao qual o ve\u00edculo est\u00e1 vinculado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_ultima_vistoria": {"name": "ano_ultima_vistoria", "description": "Ano da \u00faltima vistoria realizada pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_vistoria_tr_subtt_cglf_pendentes_2024"}, "created_at": 1727709588.6382413, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`", "raw_code": "{{\n  config(\n    alias=\"sppo_vistoria_tr_subtt_cglf_pendentes_2024\"\n  )\n}}\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(empresa AS STRING) AS empresa,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  {{ source(\"veiculo_staging\", \"sppo_vistoria_tr_subtt_cglf_pendentes_2024\") }}", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_vistoria_tr_subtt_cglf_pendentes_2024"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(data AS DATE) AS data,\n  SAFE_CAST(id_veiculo AS STRING) AS id_veiculo,\n  SAFE_CAST(placa AS STRING) AS placa,\n  SAFE_CAST(empresa AS STRING) AS empresa,\n  SAFE_CAST(ano_ultima_vistoria AS INT64) AS ano_ultima_vistoria,\nFROM\n  `rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_licenciamento_solicitacao_staging": {"database": "rj-smtr", "schema": "veiculo_staging", "name": "sppo_licenciamento_solicitacao_staging", "resource_type": "model", "package_name": "rj_smtr", "path": "veiculo/staging/sppo_licenciamento_solicitacao_staging.sql", "original_file_path": "models/veiculo/staging/sppo_licenciamento_solicitacao_staging.sql", "unique_id": "model.rj_smtr.sppo_licenciamento_solicitacao_staging", "fqn": ["rj_smtr", "veiculo", "staging", "sppo_licenciamento_solicitacao_staging"], "alias": "sppo_licenciamento_solicitacao", "checksum": {"name": "sha256", "checksum": "3120e6b4f20503158b5f0cacd7837da938aa22bd65991cfa828f15248140b7a3"}, "config": {"enabled": true, "alias": "sppo_licenciamento_solicitacao", "schema": "veiculo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View de dados cadastrais das solicita\u00e7\u00f5es em andamento para ingresso no Sistema de Transporte Urbano (STU)", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura dos dados de licenciamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "\u00d4NIBUS \u2013 nesse arquivo s\u00f3 constam os \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "N\u00famero de ordem do ve\u00edculo, identifica\u00e7\u00e3o que \u00e9 exibida na lateral do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano_fabricacao": {"name": "ano_fabricacao", "description": "Ano de fabrica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "carroceria": {"name": "carroceria", "description": "Descri\u00e7\u00e3o do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_vistoria": {"name": "data_ultima_vistoria", "description": "Data da \u00faltima vistoria do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_carroceria": {"name": "id_carroceria", "description": "C\u00f3digo do modelo da carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_chassi": {"name": "id_chassi", "description": "C\u00f3digo do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_fabricante_chassi": {"name": "id_fabricante_chassi", "description": "Identificador do fabricante do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_interno_carroceria": {"name": "id_interno_carroceria", "description": "C\u00f3digo interno do modelo de carroceria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_planta": {"name": "id_planta", "description": "C\u00f3digo da planta do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se possui ar condicionado (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_elevador": {"name": "indicador_elevador", "description": "Indicador se possui elevador (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_usb": {"name": "indicador_usb", "description": "Indicador se tem USB (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_wifi": {"name": "indicador_wifi", "description": "Indicador se tem Wi-fi (Verdadeiro/Falso)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_chassi": {"name": "nome_chassi", "description": "Descri\u00e7\u00e3o do modelo do chassi", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "permissao": {"name": "permissao", "description": "N\u00famero da permiss\u00e3o do \u00f4nibus", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "placa": {"name": "placa", "description": "Placa do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_pe": {"name": "quantidade_lotacao_pe", "description": "Quantidade de passageiros em p\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_lotacao_sentado": {"name": "quantidade_lotacao_sentado", "description": "Quantidade de passageiros sentados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_combustivel": {"name": "tipo_combustivel", "description": "Combust\u00edvel utilizado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_veiculo": {"name": "tipo_veiculo", "description": "Tipo de ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Inv\u00e1lido - Ve\u00edculo com solicita\u00e7\u00e3o inv\u00e1lida para ingresso no Sistema de Transporte Urbano (STU)\n V\u00e1lido - Ve\u00edculo com solicita\u00e7\u00e3o v\u00e1lida para ingresso no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "solicitacao": {"name": "solicitacao", "description": "Inclus\u00e3o - Solicita\u00e7\u00e3o de ingresso de ve\u00edculo no Sistema de Transporte Urbano (STU)\n Baixa - Solicita\u00e7\u00e3o de baixa de ve\u00edculo j\u00e1 inclu\u00eddo no Sistema de Transporte Urbano (STU)\n Renumera\u00e7\u00e3o - Solicita\u00e7\u00e3o de altera\u00e7\u00e3o de n\u00famero de ordem de ve\u00edculo j\u00e1 inclu\u00eddo no Sistema de Transporte Urbano (STU)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/veiculo/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "veiculo_staging", "alias": "sppo_licenciamento_solicitacao"}, "created_at": 1727709588.6415663, "relation_name": "`rj-smtr`.`veiculo_staging`.`sppo_licenciamento_solicitacao`", "raw_code": "{{ config(\n       materialized='view',\n       alias='sppo_licenciamento_solicitacao'\n)\n}}\n\nSELECT\n   SAFE_CAST(data AS DATE) data,\n   SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n   SAFE_CAST(JSON_VALUE(content,\"$.modo\") AS STRING) modo,\n   SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.ano_fabricacao\") AS STRING) ano_fabricacao,\n   SAFE_CAST(JSON_VALUE(content,\"$.carroceria\") AS STRING) carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.data_ultima_vistoria\") AS STRING) data_ultima_vistoria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_carroceria\") AS INT64) id_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_chassi\") AS INT64) id_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_fabricante_chassi\") AS INT64) id_fabricante_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_interno_carroceria\") AS INT64) id_interno_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_planta\") AS INT64) id_planta,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_ar_condicionado\") AS BOOL) indicador_ar_condicionado,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_elevador\") AS BOOL) indicador_elevador,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_usb\") AS BOOL) indicador_usb,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_wifi\") AS BOOL) indicador_wifi,\n   SAFE_CAST(JSON_VALUE(content,\"$.nome_chassi\") AS STRING) nome_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.permissao\") AS STRING) permissao,\n   SAFE_CAST(JSON_VALUE(content,\"$.placa\") AS STRING) placa,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_pe\") AS INT64) quantidade_lotacao_pe,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_sentado\") AS INT64) quantidade_lotacao_sentado,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_combustivel\") AS STRING) tipo_combustivel,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_veiculo\") AS STRING) tipo_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.status\") AS STRING) status,\n   SAFE_CAST(JSON_VALUE(content,\"$.solicitacao\") AS STRING) solicitacao\n FROM\n     {{ source('veiculo_staging','sppo_licenciamento_solicitacao') }} as t", "language": "sql", "refs": [], "sources": [["veiculo_staging", "sppo_licenciamento_solicitacao"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/veiculo/staging/sppo_licenciamento_solicitacao_staging.sql", "compiled": true, "compiled_code": "\n\nSELECT\n   SAFE_CAST(data AS DATE) data,\n   SAFE_CAST(DATETIME(TIMESTAMP_TRUNC(TIMESTAMP(timestamp_captura), SECOND), \"America/Sao_Paulo\" ) AS DATETIME) timestamp_captura,\n   SAFE_CAST(JSON_VALUE(content,\"$.modo\") AS STRING) modo,\n   SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.ano_fabricacao\") AS STRING) ano_fabricacao,\n   SAFE_CAST(JSON_VALUE(content,\"$.carroceria\") AS STRING) carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.data_ultima_vistoria\") AS STRING) data_ultima_vistoria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_carroceria\") AS INT64) id_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_chassi\") AS INT64) id_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_fabricante_chassi\") AS INT64) id_fabricante_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_interno_carroceria\") AS INT64) id_interno_carroceria,\n   SAFE_CAST(JSON_VALUE(content,\"$.id_planta\") AS INT64) id_planta,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_ar_condicionado\") AS BOOL) indicador_ar_condicionado,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_elevador\") AS BOOL) indicador_elevador,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_usb\") AS BOOL) indicador_usb,\n   SAFE_CAST(JSON_VALUE(content,\"$.indicador_wifi\") AS BOOL) indicador_wifi,\n   SAFE_CAST(JSON_VALUE(content,\"$.nome_chassi\") AS STRING) nome_chassi,\n   SAFE_CAST(JSON_VALUE(content,\"$.permissao\") AS STRING) permissao,\n   SAFE_CAST(JSON_VALUE(content,\"$.placa\") AS STRING) placa,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_pe\") AS INT64) quantidade_lotacao_pe,\n   SAFE_CAST(JSON_VALUE(content,\"$.quantidade_lotacao_sentado\") AS INT64) quantidade_lotacao_sentado,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_combustivel\") AS STRING) tipo_combustivel,\n   SAFE_CAST(JSON_VALUE(content,\"$.tipo_veiculo\") AS STRING) tipo_veiculo,\n   SAFE_CAST(JSON_VALUE(content,\"$.status\") AS STRING) status,\n   SAFE_CAST(JSON_VALUE(content,\"$.solicitacao\") AS STRING) solicitacao\n FROM\n     `rj-smtr-staging`.`veiculo_staging`.`sppo_licenciamento_solicitacao` as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_valor_km_tipo_viagem": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo_staging", "name": "subsidio_valor_km_tipo_viagem", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo_staging/subsidio_valor_km_tipo_viagem.sql", "original_file_path": "models/dashboard_subsidio_sppo_staging/subsidio_valor_km_tipo_viagem.sql", "unique_id": "model.rj_smtr.subsidio_valor_km_tipo_viagem", "fqn": ["rj_smtr", "dashboard_subsidio_sppo_staging", "subsidio_valor_km_tipo_viagem"], "alias": "subsidio_valor_km_tipo_viagem", "checksum": {"name": "sha256", "checksum": "ed4b1b726cffc03110bdc88608f3e0f4d21d5bfdb1dd3782dd5e8d1b65fe6c82"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_subsidio_sppo_staging"}, "created_at": 1727709586.773149, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`", "raw_code": "{{\r\n    config(\r\n        materialized=\"view\",\r\n    )\r\n}}\r\n\r\nSELECT\r\n  SAFE_CAST(status AS STRING) status,\r\n  SAFE_CAST(subsidio_km AS FLOAT64) subsidio_km,\r\n  SAFE_CAST(irk AS FLOAT64) irk,\r\n  SAFE_CAST(data_inicio AS DATE) data_inicio,\r\n  SAFE_CAST(data_fim AS DATE) data_fim,\r\n  SAFE_CAST(indicador_penalidade_judicial AS BOOL) indicador_penalidade_judicial,\r\n  SAFE_CAST(legislacao AS STRING) legislacao\r\nFROM\r\n  {{ source(\"dashboard_subsidio_sppo_staging\", \"subsidio_valor_km_tipo_viagem\") }}", "language": "sql", "refs": [], "sources": [["dashboard_subsidio_sppo_staging", "subsidio_valor_km_tipo_viagem"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo_staging/subsidio_valor_km_tipo_viagem.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  SAFE_CAST(status AS STRING) status,\n  SAFE_CAST(subsidio_km AS FLOAT64) subsidio_km,\n  SAFE_CAST(irk AS FLOAT64) irk,\n  SAFE_CAST(data_inicio AS DATE) data_inicio,\n  SAFE_CAST(data_fim AS DATE) data_fim,\n  SAFE_CAST(indicador_penalidade_judicial AS BOOL) indicador_penalidade_judicial,\n  SAFE_CAST(legislacao AS STRING) legislacao\nFROM\n  `rj-smtr-staging`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_servico_dia_tipo_sem_glosa", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_servico_dia_tipo_sem_glosa.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_servico_dia_tipo_sem_glosa.sql", "unique_id": "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_servico_dia_tipo_sem_glosa"], "alias": "sumario_servico_dia_tipo_sem_glosa", "checksum": {"name": "sha256", "checksum": "343f9262edc15f08dd216d16a7bdeebc85ee09cd3cfcc9cc8639c9e5054eadb7"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela tempor\u00e1ria sem as glosas e com os detalhes de viagens subsidiadas por servi\u00e7o-dia.", "columns": {"consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_subsidio": {"name": "viagens_subsidio", "description": "Quantidade de viagens apuradas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia planejada para o servi\u00e7o (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_subsidio": {"name": "distancia_total_subsidio", "description": "Dist\u00e2ncia apurada para o servi\u00e7o (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_aferido": {"name": "valor_total_aferido", "description": ".", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_distancia_total_subsidio": {"name": "perc_distancia_total_subsidio", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_subsidio": {"name": "valor_total_subsidio", "description": "Valor da dist\u00e2ncia apurada multiplicada pelo subs\u00eddio por quil\u00f4metro (sem glosa). \u00c9 zerado quando POD < 80%.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_n_licenciado": {"name": "viagens_n_licenciado", "description": "Quantidade de viagens de ve\u00edculos n\u00e3o licenciados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_licenciado": {"name": "km_apurada_n_licenciado", "description": "Quilometragem apurada de viagens de ve\u00edculos n\u00e3o licenciados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_ar_inoperante": {"name": "viagens_autuado_ar_inoperante", "description": "Quantidade de viagens de ve\u00edculos autuados por ar inoperante.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_ar_inoperante": {"name": "km_apurada_autuado_ar_inoperante", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por ar inoperante.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_seguranca": {"name": "viagens_autuado_seguranca", "description": "Quantidade de viagens de ve\u00edculos autuados por seguran\u00e7a.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_seguranca": {"name": "km_apurada_autuado_seguranca", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por seguran\u00e7a.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_limpezaequipamento": {"name": "viagens_autuado_limpezaequipamento", "description": "Quantidade de viagens de ve\u00edculos autuados por limpeza ou equipamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_limpezaequipamento": {"name": "km_apurada_autuado_limpezaequipamento", "description": "Quilometragem apurada de viagens de ve\u00edculos autuados por limpeza ou equipamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_licenciado_sem_ar_n_autuado": {"name": "viagens_licenciado_sem_ar_n_autuado", "description": "Quantidade de viagens de ve\u00edculos sem ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_sem_ar_n_autuado": {"name": "km_apurada_licenciado_sem_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos sem ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_licenciado_com_ar_n_autuado": {"name": "viagens_licenciado_com_ar_n_autuado", "description": "Quantidade de viagens de ve\u00edculos com ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_com_ar_n_autuado": {"name": "km_apurada_licenciado_com_ar_n_autuado", "description": "Quilometragem apurada de viagens de ve\u00edculos com ar e n\u00e3o autuados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_n_vistoriado": {"name": "viagens_n_vistoriado", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_vistoriado": {"name": "km_apurada_n_vistoriado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_registrado_com_ar_inoperante": {"name": "viagens_registrado_com_ar_inoperante", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_registrado_com_ar_inoperante": {"name": "km_apurada_registrado_com_ar_inoperante", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_subsidio_sppo"}, "created_at": 1727709588.6621854, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo_sem_glosa`", "raw_code": "WITH\r\n  parametros AS (\r\n  SELECT\r\n    data_inicio,\r\n    data_fim,\r\n    MAX(IF(status = \"Licenciado sem ar e n\u00e3o autuado\", subsidio_km, NULL)) AS subsidio_km_sem_ar_n_autuado,\r\n    MAX(IF(status = \"Licenciado com ar e n\u00e3o autuado\", subsidio_km, NULL)) AS subsidio_km_sem_glosa\r\n  FROM\r\n    {{ ref(\"subsidio_valor_km_tipo_viagem\") }}\r\n  WHERE\r\n    data_inicio >= \"2023-07-04\"\r\n    AND status IN (\"Licenciado sem ar e n\u00e3o autuado\", \"Licenciado com ar e n\u00e3o autuado\")\r\n  GROUP BY\r\n    1,\r\n    2 )\r\nSELECT\r\n  consorcio,\r\n  data,\r\n  tipo_dia,\r\n  servico,\r\n  viagens AS viagens_subsidio,\r\n  km_planejada AS distancia_total_planejada,\r\n  km_apurada AS distancia_total_subsidio,\r\n  NULL AS valor_total_aferido, -- TODO: Excluir essa coluna? \u00e9 utilizada?\r\n  perc_km_planejada AS perc_distancia_total_subsidio,\r\n  -- Valor total sem glosas: quando existe subsidio (POD>80%),  adiciona o valor glosado por tipo de viagem ao total\r\n  CASE\r\n    WHEN perc_km_planejada >= 80 THEN ROUND(COALESCE(valor_subsidio_pago, 0) + COALESCE(km_apurada_registrado_com_ar_inoperante * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_ar_inoperante * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_seguranca * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_limpezaequipamento * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_licenciado_sem_ar_n_autuado * (subsidio_km_sem_glosa - subsidio_km_sem_ar_n_autuado), 0) + COALESCE(km_apurada_n_vistoriado * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_sem_transacao * subsidio_km_sem_glosa, 0), 2)\r\n  ELSE\r\n  0\r\nEND\r\n  AS valor_total_subsidio,\r\n  COALESCE(viagens_n_licenciado, 0) AS viagens_n_licenciado,\r\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\r\n  COALESCE(viagens_autuado_ar_inoperante, 0) AS viagens_autuado_ar_inoperante,\r\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\r\n  COALESCE(viagens_autuado_seguranca, 0) AS viagens_autuado_seguranca,\r\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\r\n  COALESCE(viagens_autuado_limpezaequipamento, 0) AS viagens_autuado_limpezaequipamento,\r\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\r\n  COALESCE(viagens_licenciado_sem_ar_n_autuado, 0) AS viagens_licenciado_sem_ar_n_autuado,\r\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\r\n  COALESCE(viagens_licenciado_com_ar_n_autuado, 0) AS viagens_licenciado_com_ar_n_autuado,\r\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\r\n  COALESCE(viagens_registrado_com_ar_inoperante, 0) AS viagens_registrado_com_ar_inoperante,\r\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\r\n  COALESCE(viagens_n_vistoriado, 0) AS viagens_n_vistoriado,\r\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\r\n  COALESCE(viagens_sem_transacao, 0) AS viagens_sem_transacao,\r\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao\r\nFROM\r\n  {{ ref(\"sumario_servico_dia_tipo\") }} -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`\r\nLEFT JOIN\r\n  parametros\r\nON\r\n  DATA BETWEEN data_inicio\r\n  AND data_fim", "language": "sql", "refs": [{"name": "subsidio_valor_km_tipo_viagem", "package": null, "version": null}, {"name": "sumario_servico_dia_tipo", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_valor_km_tipo_viagem", "model.rj_smtr.sumario_servico_dia_tipo"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_servico_dia_tipo_sem_glosa.sql", "compiled": true, "compiled_code": "WITH\n  parametros AS (\n  SELECT\n    data_inicio,\n    data_fim,\n    MAX(IF(status = \"Licenciado sem ar e n\u00e3o autuado\", subsidio_km, NULL)) AS subsidio_km_sem_ar_n_autuado,\n    MAX(IF(status = \"Licenciado com ar e n\u00e3o autuado\", subsidio_km, NULL)) AS subsidio_km_sem_glosa\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`\n  WHERE\n    data_inicio >= \"2023-07-04\"\n    AND status IN (\"Licenciado sem ar e n\u00e3o autuado\", \"Licenciado com ar e n\u00e3o autuado\")\n  GROUP BY\n    1,\n    2 )\nSELECT\n  consorcio,\n  data,\n  tipo_dia,\n  servico,\n  viagens AS viagens_subsidio,\n  km_planejada AS distancia_total_planejada,\n  km_apurada AS distancia_total_subsidio,\n  NULL AS valor_total_aferido, -- TODO: Excluir essa coluna? \u00e9 utilizada?\n  perc_km_planejada AS perc_distancia_total_subsidio,\n  -- Valor total sem glosas: quando existe subsidio (POD>80%),  adiciona o valor glosado por tipo de viagem ao total\n  CASE\n    WHEN perc_km_planejada >= 80 THEN ROUND(COALESCE(valor_subsidio_pago, 0) + COALESCE(km_apurada_registrado_com_ar_inoperante * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_ar_inoperante * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_seguranca * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_autuado_limpezaequipamento * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_licenciado_sem_ar_n_autuado * (subsidio_km_sem_glosa - subsidio_km_sem_ar_n_autuado), 0) + COALESCE(km_apurada_n_vistoriado * subsidio_km_sem_glosa, 0) + COALESCE(km_apurada_sem_transacao * subsidio_km_sem_glosa, 0), 2)\n  ELSE\n  0\nEND\n  AS valor_total_subsidio,\n  COALESCE(viagens_n_licenciado, 0) AS viagens_n_licenciado,\n  COALESCE(km_apurada_n_licenciado, 0) AS km_apurada_n_licenciado,\n  COALESCE(viagens_autuado_ar_inoperante, 0) AS viagens_autuado_ar_inoperante,\n  COALESCE(km_apurada_autuado_ar_inoperante, 0) AS km_apurada_autuado_ar_inoperante,\n  COALESCE(viagens_autuado_seguranca, 0) AS viagens_autuado_seguranca,\n  COALESCE(km_apurada_autuado_seguranca, 0) AS km_apurada_autuado_seguranca,\n  COALESCE(viagens_autuado_limpezaequipamento, 0) AS viagens_autuado_limpezaequipamento,\n  COALESCE(km_apurada_autuado_limpezaequipamento, 0) AS km_apurada_autuado_limpezaequipamento,\n  COALESCE(viagens_licenciado_sem_ar_n_autuado, 0) AS viagens_licenciado_sem_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) AS km_apurada_licenciado_sem_ar_n_autuado,\n  COALESCE(viagens_licenciado_com_ar_n_autuado, 0) AS viagens_licenciado_com_ar_n_autuado,\n  COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0) AS km_apurada_licenciado_com_ar_n_autuado,\n  COALESCE(viagens_registrado_com_ar_inoperante, 0) AS viagens_registrado_com_ar_inoperante,\n  COALESCE(km_apurada_registrado_com_ar_inoperante, 0) AS km_apurada_registrado_com_ar_inoperante,\n  COALESCE(viagens_n_vistoriado, 0) AS viagens_n_vistoriado,\n  COALESCE(km_apurada_n_vistoriado, 0) AS km_apurada_n_vistoriado,\n  COALESCE(viagens_sem_transacao, 0) AS viagens_sem_transacao,\n  COALESCE(km_apurada_sem_transacao, 0) AS km_apurada_sem_transacao\nFROM\n  `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo` -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`\nLEFT JOIN\n  parametros\nON\n  DATA BETWEEN data_inicio\n  AND data_fim", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_dia": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_servico_dia.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_servico_dia.sql", "unique_id": "model.rj_smtr.sumario_servico_dia", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_servico_dia"], "alias": "sumario_servico_dia", "checksum": {"name": "sha256", "checksum": "4aa9900dd6054f01a96509cfcb584d96c835cc966196015f7f384d576686f1fb"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "servico"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens": {"name": "viagens", "description": "Quantidade de viagens apuradas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada": {"name": "km_apurada", "description": "Dist\u00e2ncia apurada do servi\u00e7o (km)\n Dist\u00e2ncia planejada da viagem multiplicada pela quantidade de viagens", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada": {"name": "km_planejada", "description": "Dist\u00e2ncia planejada para o servi\u00e7o (km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_km_planejada": {"name": "perc_km_planejada", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_subsidio_pago": {"name": "valor_subsidio_pago", "description": "Valor de subs\u00eddio apurado (R$)\n Dist\u00e2ncia apurada do servi\u00e7o multiplicada pelos respectivos valores pela classifica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_penalidade": {"name": "valor_penalidade", "description": "Valor de penalidade apurado (R$)\n Linha com opera\u00e7\u00e3o entre 40% e 60% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o m\u00e9dia prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO.\n Linha com opera\u00e7\u00e3o inferior a 40% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o grave prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "servico"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6447804, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia`", "raw_code": "{{\r\n    config(\r\n        materialized=\"incremental\",\r\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\r\n        unique_key=[\"data\", \"servico\"],\r\n        incremental_strategy=\"insert_overwrite\",\r\n    )\r\n}}\r\n\r\n\r\nWITH\r\n-- 1. Viagens planejadas (agrupadas por data e servi\u00e7o)\r\n  planejado AS (\r\n  SELECT\r\n    DISTINCT DATA,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico,\r\n    distancia_total_planejada AS km_planejada,\r\n  FROM\r\n    -- {{ ref(\"viagem_planejada\") }}\r\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\r\n  WHERE\r\n    DATA BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n    AND ( distancia_total_planejada > 0\r\n      OR distancia_total_planejada IS NULL )\r\n  ),\r\n-- 2. Viagens realizadas\r\n  viagem AS (\r\n  SELECT\r\n    DATA,\r\n    servico_realizado AS servico,\r\n    id_veiculo,\r\n    id_viagem,\r\n    distancia_planejada\r\n FROM\r\n    -- {{ ref(\"viagem_completa\") }}\r\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\r\n  WHERE\r\n    DATA BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n    AND DATE( \"{{ var(\"end_date\") }}\" ) ),\r\n-- 3. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o Di\u00e1rio (POD)\r\n  servico_km_apuracao AS (\r\n  SELECT\r\n    p.data,\r\n    p.tipo_dia,\r\n    p.consorcio,\r\n    p.servico,\r\n    p.km_planejada AS km_planejada,\r\n    COALESCE(COUNT(v.id_viagem), 0) AS viagens,\r\n    COALESCE(SUM(v.distancia_planejada), 0) AS km_apurada,\r\n    COALESCE(ROUND(100 * SUM(v.distancia_planejada) / p.km_planejada,2), 0) AS perc_km_planejada\r\n  FROM\r\n    planejado AS p\r\n  LEFT JOIN\r\n    viagem AS v\r\n  USING\r\n    (DATA,\r\n      servico)\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5 ),\r\n-- 4. Apura\u00e7\u00e3o de valor de subs\u00eddio por data e servi\u00e7o\r\n  viagens_remuneradas AS (\r\n    SELECT\r\n      DATA,\r\n      servico,\r\n      distancia_planejada,\r\n      subsidio_km\r\n    FROM\r\n      {{ ref(\"viagens_remuneradas\") }}\r\n      -- `rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas`\r\n    WHERE\r\n      DATA BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n      AND DATE( \"{{ var(\"end_date\") }}\" )\r\n      AND indicador_viagem_dentro_limite IS TRUE),\r\n  servico_subsidio_apuracao AS (\r\n  SELECT\r\n    DATA,\r\n    servico,\r\n    SUM(distancia_planejada*subsidio_km) AS valor_subsidio_apurado\r\n  FROM\r\n    viagens_remuneradas\r\n  GROUP BY\r\n    1,\r\n    2)\r\nSELECT\r\n  s.*,\r\n  IF(p.valor IS NULL, COALESCE(st.valor_subsidio_apurado, 0), 0) AS valor_subsidio_pago,\r\n  IFNULL(-p.valor, 0) AS valor_penalidade\r\nFROM\r\n  servico_km_apuracao AS s\r\nLEFT JOIN\r\n  {{ ref(\"valor_tipo_penalidade\") }} AS p\r\n  -- `rj-smtr`.`dashboard_subsidio_sppo`.`valor_tipo_penalidade` AS p\r\nON\r\n  s.data BETWEEN p.data_inicio\r\n  AND p.data_fim\r\n  AND s.perc_km_planejada >= p.perc_km_inferior\r\n  AND s.perc_km_planejada < p.perc_km_superior\r\nLEFT JOIN\r\n  servico_subsidio_apuracao AS st\r\nUSING\r\n  (DATA,\r\n    servico)", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}, {"name": "viagens_remuneradas", "package": null, "version": null}, {"name": "valor_tipo_penalidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_completa", "model.rj_smtr.viagens_remuneradas", "model.rj_smtr.valor_tipo_penalidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_servico_dia.sql", "compiled": true, "compiled_code": "\n\n\nWITH\n-- 1. Viagens planejadas (agrupadas por data e servi\u00e7o)\n  planejado AS (\n  SELECT\n    DISTINCT DATA,\n    tipo_dia,\n    consorcio,\n    servico,\n    distancia_total_planejada AS km_planejada,\n  FROM\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n  WHERE\n    DATA BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" )\n    AND ( distancia_total_planejada > 0\n      OR distancia_total_planejada IS NULL )\n  ),\n-- 2. Viagens realizadas\n  viagem AS (\n  SELECT\n    DATA,\n    servico_realizado AS servico,\n    id_veiculo,\n    id_viagem,\n    distancia_planejada\n FROM\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n  WHERE\n    DATA BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" ) ),\n-- 3. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o Di\u00e1rio (POD)\n  servico_km_apuracao AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.consorcio,\n    p.servico,\n    p.km_planejada AS km_planejada,\n    COALESCE(COUNT(v.id_viagem), 0) AS viagens,\n    COALESCE(SUM(v.distancia_planejada), 0) AS km_apurada,\n    COALESCE(ROUND(100 * SUM(v.distancia_planejada) / p.km_planejada,2), 0) AS perc_km_planejada\n  FROM\n    planejado AS p\n  LEFT JOIN\n    viagem AS v\n  USING\n    (DATA,\n      servico)\n  GROUP BY\n    1,\n    2,\n    3,\n    4,\n    5 ),\n-- 4. Apura\u00e7\u00e3o de valor de subs\u00eddio por data e servi\u00e7o\n  viagens_remuneradas AS (\n    SELECT\n      DATA,\n      servico,\n      distancia_planejada,\n      subsidio_km\n    FROM\n      `rj-smtr`.`dashboard_subsidio_sppo`.`viagens_remuneradas`\n      -- `rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas`\n    WHERE\n      DATA BETWEEN DATE(\"2022-01-01T01:00:00\")\n      AND DATE( \"2022-01-01T01:00:00\" )\n      AND indicador_viagem_dentro_limite IS TRUE),\n  servico_subsidio_apuracao AS (\n  SELECT\n    DATA,\n    servico,\n    SUM(distancia_planejada*subsidio_km) AS valor_subsidio_apurado\n  FROM\n    viagens_remuneradas\n  GROUP BY\n    1,\n    2)\nSELECT\n  s.*,\n  IF(p.valor IS NULL, COALESCE(st.valor_subsidio_apurado, 0), 0) AS valor_subsidio_pago,\n  IFNULL(-p.valor, 0) AS valor_penalidade\nFROM\n  servico_km_apuracao AS s\nLEFT JOIN\n  `rj-smtr`.`dashboard_subsidio_sppo`.`valor_tipo_penalidade` AS p\n  -- `rj-smtr`.`dashboard_subsidio_sppo`.`valor_tipo_penalidade` AS p\nON\n  s.data BETWEEN p.data_inicio\n  AND p.data_fim\n  AND s.perc_km_planejada >= p.perc_km_inferior\n  AND s.perc_km_planejada < p.perc_km_superior\nLEFT JOIN\n  servico_subsidio_apuracao AS st\nUSING\n  (DATA,\n    servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.valor_tipo_penalidade": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "valor_tipo_penalidade", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/valor_tipo_penalidade.sql", "original_file_path": "models/dashboard_subsidio_sppo/valor_tipo_penalidade.sql", "unique_id": "model.rj_smtr.valor_tipo_penalidade", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "valor_tipo_penalidade"], "alias": "valor_tipo_penalidade", "checksum": {"name": "sha256", "checksum": "2f0eae69e6b176e9961044b63e1cd4a4326f1b20b28235fb65d23a3cbbff2149"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["tipo_penalidade", "data_inicio"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"granularity": "day", "data_type": "date", "field": "data_inicio"}}, "tags": [], "description": "Valores de penalidades de subs\u00eddio", "columns": {"perc_km_inferior": {"name": "perc_km_inferior", "description": "Extremidade inferior de intervalo do indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_km_superior": {"name": "perc_km_superior", "description": "Extremidade superior de intervalo do indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_penalidade": {"name": "tipo_penalidade", "description": "Classifica\u00e7\u00e3o da penalidade equivalente no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro (SPPO) imposta - Categorias:\n - M\u00e9dia\n - Grave", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor da penalidade imposta (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio": {"name": "data_inicio", "description": "Data inicial do per\u00edodo de vig\u00eancia dos demais atributos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_fim": {"name": "data_fim", "description": "Data final do per\u00edodo de vig\u00eancia dos demais atributos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo", "partition_by": {"granularity": "day", "data_type": "date", "field": "data_inicio"}, "unique_key": ["tipo_penalidade", "data_inicio"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.654809, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`valor_tipo_penalidade`", "raw_code": "{{\r\n    config(\r\n        materialized=\"incremental\",\r\n        partition_by={\"field\": \"data_inicio\", \"data_type\": \"date\", \"granularity\": \"day\"},\r\n        unique_key=[\"tipo_penalidade\", \"data_inicio\"],\r\n        incremental_strategy=\"insert_overwrite\",\r\n    )\r\n}}\r\n\r\n-- DEC RIO N. 51940/2023 e 53856/2023\r\nwith penalidade as (\r\n    select 0 as perc_km_inferior, 40 as perc_km_superior, \"Grave\" as tipo_penalidade, 1126.55 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\r\n    union all\r\n    select 40 as perc_km_inferior, 60 as perc_km_superior, \"M\u00e9dia\" as tipo_penalidade, 563.28 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\r\n    union all\r\n    select 60 as perc_km_inferior, 80 as perc_km_superior, \"Nula\" as tipo_penalidade, 0 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\r\n    union all\r\n    select 80 as perc_km_inferior, 100 as perc_km_superior, null as tipo_penalidade, null as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\r\n\r\n)\r\nselect * from penalidade", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/valor_tipo_penalidade.sql", "compiled": true, "compiled_code": "\n\n-- DEC RIO N. 51940/2023 e 53856/2023\nwith penalidade as (\n    select 0 as perc_km_inferior, 40 as perc_km_superior, \"Grave\" as tipo_penalidade, 1126.55 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\n    union all\n    select 40 as perc_km_inferior, 60 as perc_km_superior, \"M\u00e9dia\" as tipo_penalidade, 563.28 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\n    union all\n    select 60 as perc_km_inferior, 80 as perc_km_superior, \"Nula\" as tipo_penalidade, 0 as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\n    union all\n    select 80 as perc_km_inferior, 100 as perc_km_superior, null as tipo_penalidade, null as valor, date(\"2023-01-16\") as data_inicio, date(\"2024-12-31\") as data_fim\n\n)\nselect * from penalidade", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_dia_tipo": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_servico_dia_tipo", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_servico_dia_tipo.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_servico_dia_tipo.sql", "unique_id": "model.rj_smtr.sumario_servico_dia_tipo", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_servico_dia_tipo"], "alias": "sumario_servico_dia_tipo", "checksum": {"name": "sha256", "checksum": "a976bbf0c3763350556d60b65c3d0fa2aa246872027c6ee2f391246c9e374da9"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia e tipo de viagem", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens": {"name": "viagens", "description": "Quantidade de viagens apuradas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada": {"name": "km_apurada", "description": "Dist\u00e2ncia apurada do servi\u00e7o (km) Dist\u00e2ncia planejada da viagem multiplicada pela quantidade de viagens.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada": {"name": "km_planejada", "description": "Dist\u00e2ncia planejada para o servi\u00e7o (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_km_planejada": {"name": "perc_km_planejada", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_subsidio_pago": {"name": "valor_subsidio_pago", "description": "Valor de subs\u00eddio apurado (R$) Dist\u00e2ncia apurada do servi\u00e7o multiplicada pelos respectivos valores pela classifica\u00e7\u00e3o do ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_penalidade": {"name": "valor_penalidade", "description": "Valor de penalidade apurado (R$) Linha com opera\u00e7\u00e3o entre 40% e 60% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o m\u00e9dia prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO. Linha com opera\u00e7\u00e3o inferior a 40% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o grave prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_n_licenciado": {"name": "viagens_n_licenciado", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo n\u00e3o licenciado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_licenciado": {"name": "km_apurada_n_licenciado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo n\u00e3o licenciado (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_ar_inoperante": {"name": "viagens_autuado_ar_inoperante", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado com ar condicionado e autuado em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_ar_inoperante": {"name": "km_apurada_autuado_ar_inoperante", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e autuado em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_seguranca": {"name": "viagens_autuado_seguranca", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado e autuado em raz\u00e3o de seguran\u00e7a.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_seguranca": {"name": "km_apurada_autuado_seguranca", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado e autuado em raz\u00e3o de seguran\u00e7a (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_autuado_limpezaequipamento": {"name": "viagens_autuado_limpezaequipamento", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado e autuado em raz\u00e3o de limpeza e equipamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_autuado_limpezaequipamento": {"name": "km_apurada_autuado_limpezaequipamento", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado e autuado em raz\u00e3o de limpeza e equipamento (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_licenciado_sem_ar_n_autuado": {"name": "viagens_licenciado_sem_ar_n_autuado", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado sem ar condicionado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_sem_ar_n_autuado": {"name": "km_apurada_licenciado_sem_ar_n_autuado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado sem ar condicionado (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_licenciado_com_ar_n_autuado": {"name": "viagens_licenciado_com_ar_n_autuado", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado com ar condicionado e n\u00e3o autuado em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_licenciado_com_ar_n_autuado": {"name": "km_apurada_licenciado_com_ar_n_autuado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e n\u00e3o autuado em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_n_vistoriado": {"name": "viagens_n_vistoriado", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_n_vistoriado": {"name": "km_apurada_n_vistoriado", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo n\u00e3o vistoriado tempestivamente conforme calend\u00e1rio de vistoria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_registrado_com_ar_inoperante": {"name": "viagens_registrado_com_ar_inoperante", "description": "Quantidade de viagens apuradas realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_registrado_com_ar_inoperante": {"name": "km_apurada_registrado_com_ar_inoperante", "description": "Dist\u00e2ncia apurada de viagens realizadas por ve\u00edculo licenciado com ar condicionado e registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) em raz\u00e3o de inoper\u00e2ncia ou mau funcionamento deste (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6527524, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`", "raw_code": "{{\r\n  config(\r\n    materialized=\"incremental\",\r\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\r\n    incremental_strategy=\"insert_overwrite\",\r\n  )\r\n}}\r\n\r\nWITH\r\n  planejado AS (\r\n  SELECT\r\n    DISTINCT DATA,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico,\r\n    sentido,\r\n    distancia_total_planejada AS km_planejada\r\n  FROM\r\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\r\n    {{ ref(\"viagem_planejada\") }}\r\n  WHERE\r\n    DATA >= DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n    {% if is_incremental() %}\r\n      AND DATA BETWEEN DATE(\"{{ var(\"start_date\") }}\" )\r\n      AND DATE( \"{{ var(\"end_date\") }}\" )\r\n    {% endif %}\r\n    AND (distancia_total_planejada > 0\r\n    OR distancia_total_planejada IS NOT NULL)\r\n  ),\r\n  viagem AS (\r\n  SELECT\r\n    data,\r\n    servico,\r\n    id_veiculo,\r\n    id_viagem,\r\n    tipo_viagem,\r\n    distancia_planejada\r\n  FROM\r\n    -- rj-smtr.subsidio.viagem_transacao\r\n    {{ ref(\"viagem_transacao\") }}\r\n  WHERE\r\n    DATA >= DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n    {% if is_incremental() %}\r\n      AND DATA BETWEEN DATE(\"{{ var(\"start_date\") }}\" )\r\n      AND DATE( \"{{ var(\"end_date\") }}\" )\r\n    {% endif %}\r\n  ),\r\n  servico_km_tipo AS (\r\n  SELECT\r\n    data,\r\n    servico,\r\n    tipo_viagem,\r\n    COUNT(id_viagem) AS viagens,\r\n    ROUND(SUM(distancia_planejada), 2) AS km_apurada\r\n  FROM\r\n    viagem v\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3 ),\r\n  servico_km_tipo_atualizado AS (\r\n  SELECT\r\n    * EXCEPT(tipo_viagem),\r\n    CASE\r\n      WHEN tipo_viagem = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\r\n      WHEN tipo_viagem = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\r\n      WHEN tipo_viagem = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\r\n      WHEN tipo_viagem = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\r\n    ELSE tipo_viagem\r\n    END AS tipo_viagem\r\n  FROM\r\n    servico_km_tipo\r\n  ),\r\n  servico_km AS (\r\n  SELECT\r\n    p.data,\r\n    p.tipo_dia,\r\n    p.consorcio,\r\n    p.servico,\r\n    v.tipo_viagem,\r\n    IFNULL(v.viagens, 0) AS viagens,\r\n    IFNULL(v.km_apurada, 0) AS km_apurada,\r\n  FROM\r\n    planejado AS p\r\n  LEFT JOIN\r\n    servico_km_tipo_atualizado v\r\n  ON\r\n    p.data = v.data\r\n    AND p.servico = v.servico ),\r\n  pivot_data AS (\r\n  SELECT\r\n    *\r\n  FROM (\r\n    SELECT\r\n      data,\r\n      tipo_dia,\r\n      consorcio,\r\n      servico,\r\n      tipo_viagem,\r\n      viagens,\r\n      km_apurada,\r\n    FROM\r\n      servico_km ) PIVOT(SUM(viagens) AS viagens,\r\n      SUM(km_apurada) AS km_apurada FOR tipo_viagem IN (\r\n          \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\r\n          \"N\u00e3o licenciado\" AS n_licenciado,\r\n          \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\r\n          \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\r\n          \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\r\n          \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\r\n          \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\r\n          \"N\u00e3o vistoriado\" AS n_vistoriado,\r\n          \"Sem transa\u00e7\u00e3o\" AS sem_transacao\r\n        )))\r\nSELECT\r\n  sd.*,\r\n  pd.* EXCEPT(data,\r\n    tipo_dia,\r\n    servico,\r\n    consorcio)\r\nFROM\r\n  {{ ref(\"sumario_servico_dia\") }} AS sd\r\n  -- rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia AS sd\r\nLEFT JOIN\r\n  pivot_data AS pd\r\nON\r\n  sd.data = pd.data\r\n  AND sd.servico = pd.servico\r\n{% if is_incremental() %}\r\n  WHERE\r\n    sd.data BETWEEN DATE(\"{{ var(\"start_date\") }}\" )\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n{% endif %}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "viagem_transacao", "package": null, "version": null}, {"name": "sumario_servico_dia", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_transacao", "model.rj_smtr.sumario_servico_dia"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_servico_dia_tipo.sql", "compiled": true, "compiled_code": "\n\nWITH\n  planejado AS (\n  SELECT\n    DISTINCT DATA,\n    tipo_dia,\n    consorcio,\n    servico,\n    sentido,\n    distancia_total_planejada AS km_planejada\n  FROM\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n  WHERE\n    DATA >= DATE( \"2023-01-16\" )\n    \n      AND DATA BETWEEN DATE(\"2022-01-01T01:00:00\" )\n      AND DATE( \"2022-01-01T01:00:00\" )\n    \n    AND (distancia_total_planejada > 0\n    OR distancia_total_planejada IS NOT NULL)\n  ),\n  viagem AS (\n  SELECT\n    data,\n    servico,\n    id_veiculo,\n    id_viagem,\n    tipo_viagem,\n    distancia_planejada\n  FROM\n    -- rj-smtr.subsidio.viagem_transacao\n    `rj-smtr`.`subsidio`.`viagem_transacao`\n  WHERE\n    DATA >= DATE( \"2023-01-16\" )\n    \n      AND DATA BETWEEN DATE(\"2022-01-01T01:00:00\" )\n      AND DATE( \"2022-01-01T01:00:00\" )\n    \n  ),\n  servico_km_tipo AS (\n  SELECT\n    data,\n    servico,\n    tipo_viagem,\n    COUNT(id_viagem) AS viagens,\n    ROUND(SUM(distancia_planejada), 2) AS km_apurada\n  FROM\n    viagem v\n  GROUP BY\n    1,\n    2,\n    3 ),\n  servico_km_tipo_atualizado AS (\n  SELECT\n    * EXCEPT(tipo_viagem),\n    CASE\n      WHEN tipo_viagem = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\n      WHEN tipo_viagem = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\n      WHEN tipo_viagem = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\n      WHEN tipo_viagem = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\n    ELSE tipo_viagem\n    END AS tipo_viagem\n  FROM\n    servico_km_tipo\n  ),\n  servico_km AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.consorcio,\n    p.servico,\n    v.tipo_viagem,\n    IFNULL(v.viagens, 0) AS viagens,\n    IFNULL(v.km_apurada, 0) AS km_apurada,\n  FROM\n    planejado AS p\n  LEFT JOIN\n    servico_km_tipo_atualizado v\n  ON\n    p.data = v.data\n    AND p.servico = v.servico ),\n  pivot_data AS (\n  SELECT\n    *\n  FROM (\n    SELECT\n      data,\n      tipo_dia,\n      consorcio,\n      servico,\n      tipo_viagem,\n      viagens,\n      km_apurada,\n    FROM\n      servico_km ) PIVOT(SUM(viagens) AS viagens,\n      SUM(km_apurada) AS km_apurada FOR tipo_viagem IN (\n          \"Registrado com ar inoperante\" AS registrado_com_ar_inoperante,\n          \"N\u00e3o licenciado\" AS n_licenciado,\n          \"Autuado por ar inoperante\" AS autuado_ar_inoperante,\n          \"Autuado por seguran\u00e7a\" AS autuado_seguranca,\n          \"Autuado por limpeza/equipamento\" AS autuado_limpezaequipamento,\n          \"Licenciado sem ar e n\u00e3o autuado\" AS licenciado_sem_ar_n_autuado,\n          \"Licenciado com ar e n\u00e3o autuado\" AS licenciado_com_ar_n_autuado,\n          \"N\u00e3o vistoriado\" AS n_vistoriado,\n          \"Sem transa\u00e7\u00e3o\" AS sem_transacao\n        )))\nSELECT\n  sd.*,\n  pd.* EXCEPT(data,\n    tipo_dia,\n    servico,\n    consorcio)\nFROM\n  `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia` AS sd\n  -- rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia AS sd\nLEFT JOIN\n  pivot_data AS pd\nON\n  sd.data = pd.data\n  AND sd.servico = pd.servico\n\n  WHERE\n    sd.data BETWEEN DATE(\"2022-01-01T01:00:00\" )\n    AND DATE( \"2022-01-01T01:00:00\" )\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_parametros": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "subsidio_parametros", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/subsidio_parametros.sql", "original_file_path": "models/dashboard_subsidio_sppo/subsidio_parametros.sql", "unique_id": "model.rj_smtr.subsidio_parametros", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "subsidio_parametros"], "alias": "subsidio_parametros", "checksum": {"name": "sha256", "checksum": "25f0f18408ffab8f5c489f22fe6ba47025edf14d52bb47f9aa6587f74506ffc5"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Par\u00e2metros de remunera\u00e7\u00e3o do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por tipo de viagem", "columns": {"indicador_licenciado": {"name": "indicador_licenciado", "description": "Indicador se o ve\u00edculo encontra-se licenciado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se o ve\u00edculo foi licenciado com ar condicionado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_autuacao_ar_condicionado": {"name": "indicador_autuacao_ar_condicionado", "description": "Indicador se o ve\u00edculo foi autuado por inoper\u00e2ncia ou mau funcionamento do sistema de ar condicionado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_autuacao_seguranca": {"name": "indicador_autuacao_seguranca", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 seguran\u00e7a do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_autuacao_limpeza": {"name": "indicador_autuacao_limpeza", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 limpeza do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_autuacao_equipamento": {"name": "indicador_autuacao_equipamento", "description": "Indicador se o ve\u00edculo foi autuado por infra\u00e7\u00e3o relacionada \u00e0 inoper\u00e2ncia ou mau funcionamento de equipamentos do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_sensor_temperatura": {"name": "indicador_sensor_temperatura", "description": "Indicador se o sensor de temperatura do ve\u00edculo n\u00e3o estava em funcionamento conforme especifica\u00e7\u00e3o da SMTR", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_validador_sbd": {"name": "indicador_validador_sbd", "description": "Indicador se o ve\u00edculo se encontra com o novo validador do Sistema de Bilhetagem Digital (SBD) instalado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "status": {"name": "status", "description": "Classifica\u00e7\u00e3o, observados os demais par\u00e2metros", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_km": {"name": "subsidio_km", "description": "Valor de subs\u00eddio de remunera\u00e7\u00e3o (R$/km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "irk": {"name": "irk", "description": "\u00cdndice de Remunera\u00e7\u00e3o por km (R$/km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio": {"name": "data_inicio", "description": "Data inicial do per\u00edodo de vig\u00eancia dos demais atributos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_fim": {"name": "data_fim", "description": "Data final do per\u00edodo de vig\u00eancia dos demais atributos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "legislacao": {"name": "legislacao", "description": "Legisla\u00e7\u00e3o que estabelece o valor e regras de remunera\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ordem": {"name": "ordem", "description": "Ordem de prioridade de aplica\u00e7\u00e3o dos valores de remunera\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_registro_agente_verao_ar_condicionado": {"name": "indicador_registro_agente_verao_ar_condicionado", "description": "Indicador se o ve\u00edculo foi registrado por agente de ver\u00e3o (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.682/2024) com ar condicionado inoperante ou em mau funcionamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "dashboard_subsidio_sppo"}, "created_at": 1727709588.6594326, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`subsidio_parametros`", "raw_code": "{{\r\n    config(\r\n        materialized=\"table\",\r\n    )\r\n}}\r\n\r\nSELECT\r\n  COALESCE(SAFE_CAST(indicador_licenciado AS BOOL), FALSE) indicador_licenciado,\r\n  COALESCE(SAFE_CAST(indicador_ar_condicionado AS BOOL), FALSE) indicador_ar_condicionado,\r\n  COALESCE(SAFE_CAST(indicador_autuacao_ar_condicionado AS BOOL), FALSE) indicador_autuacao_ar_condicionado,\r\n  COALESCE(SAFE_CAST(indicador_autuacao_seguranca AS BOOL), FALSE) indicador_autuacao_seguranca,\r\n  COALESCE(SAFE_CAST(indicador_autuacao_limpeza AS BOOL), FALSE) indicador_autuacao_limpeza,\r\n  COALESCE(SAFE_CAST(indicador_autuacao_equipamento AS BOOL), FALSE) indicador_autuacao_equipamento,\r\n  COALESCE(SAFE_CAST(indicador_sensor_temperatura AS BOOL), FALSE) indicador_sensor_temperatura,\r\n  COALESCE(SAFE_CAST(indicador_validador_sbd AS BOOL), FALSE) indicador_validador_sbd,\r\n  COALESCE(SAFE_CAST(indicador_registro_agente_verao_ar_condicionado AS BOOL), FALSE) indicador_registro_agente_verao_ar_condicionado,\r\n  SAFE_CAST(status AS STRING) status,\r\n  SAFE_CAST(subsidio_km AS FLOAT64) subsidio_km,\r\n  SAFE_CAST(irk AS FLOAT64) irk,\r\n  SAFE_CAST(data_inicio AS DATE) data_inicio,\r\n  SAFE_CAST(data_fim AS DATE) data_fim,\r\n  SAFE_CAST(legislacao AS STRING) legislacao,\r\n  SAFE_CAST(ordem AS INT64) ordem\r\nFROM\r\n  {{ var(\"subsidio_parametros\") }}", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/subsidio_parametros.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  COALESCE(SAFE_CAST(indicador_licenciado AS BOOL), FALSE) indicador_licenciado,\n  COALESCE(SAFE_CAST(indicador_ar_condicionado AS BOOL), FALSE) indicador_ar_condicionado,\n  COALESCE(SAFE_CAST(indicador_autuacao_ar_condicionado AS BOOL), FALSE) indicador_autuacao_ar_condicionado,\n  COALESCE(SAFE_CAST(indicador_autuacao_seguranca AS BOOL), FALSE) indicador_autuacao_seguranca,\n  COALESCE(SAFE_CAST(indicador_autuacao_limpeza AS BOOL), FALSE) indicador_autuacao_limpeza,\n  COALESCE(SAFE_CAST(indicador_autuacao_equipamento AS BOOL), FALSE) indicador_autuacao_equipamento,\n  COALESCE(SAFE_CAST(indicador_sensor_temperatura AS BOOL), FALSE) indicador_sensor_temperatura,\n  COALESCE(SAFE_CAST(indicador_validador_sbd AS BOOL), FALSE) indicador_validador_sbd,\n  COALESCE(SAFE_CAST(indicador_registro_agente_verao_ar_condicionado AS BOOL), FALSE) indicador_registro_agente_verao_ar_condicionado,\n  SAFE_CAST(status AS STRING) status,\n  SAFE_CAST(subsidio_km AS FLOAT64) subsidio_km,\n  SAFE_CAST(irk AS FLOAT64) irk,\n  SAFE_CAST(data_inicio AS DATE) data_inicio,\n  SAFE_CAST(data_fim AS DATE) data_fim,\n  SAFE_CAST(legislacao AS STRING) legislacao,\n  SAFE_CAST(ordem AS INT64) ordem\nFROM\n  `rj-smtr-staging.dashboard_subsidio_sppo_staging.subsidio_parametros`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_tipo_viagem_dia": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_servico_tipo_viagem_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_servico_tipo_viagem_dia.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_servico_tipo_viagem_dia.sql", "unique_id": "model.rj_smtr.sumario_servico_tipo_viagem_dia", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_servico_tipo_viagem_dia"], "alias": "sumario_servico_tipo_viagem_dia", "checksum": {"name": "sha256", "checksum": "e3e20c3b301e265a331fb66a15efafc72b30a3228f5f3e6220d280f00c106bdb"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia e tipo de viagem", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Tipo de viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens": {"name": "viagens", "description": "Quantidade de viagens apuradas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada": {"name": "km_apurada", "description": "Dist\u00e2ncia apurada do servi\u00e7o (km)\n Dist\u00e2ncia planejada da viagem multiplicada pela quantidade de viagens", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se o ve\u00edculo foi licenciado com ar condicionado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_subsidio_sppo"}, "created_at": 1727709588.6462886, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_tipo_viagem_dia`", "raw_code": "WITH\r\n  planejado AS (\r\n  SELECT\r\n    DISTINCT `data`,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_historico\") }}\r\n  WHERE\r\n    `data` <= DATE( \"{{ var(\"end_date\") }}\" )),\r\n  sumario_v1 AS ( -- Viagens v1\r\n  SELECT\r\n    `data`,\r\n    servico,\r\n    \"N\u00e3o classificado\" AS tipo_viagem,\r\n    NULL AS indicador_ar_condicionado,\r\n    viagens,\r\n    km_apurada\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_historico\") }}\r\n  WHERE\r\n    `data` < DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" ) ),\r\n  tipo_viagem_v2 AS ( -- Classifica os tipos de viagem (v2)\r\n  SELECT\r\n    `data`,\r\n    id_veiculo,\r\n    status,\r\n    SAFE_CAST(JSON_VALUE(indicadores,\"$.indicador_ar_condicionado\") AS BOOL) AS indicador_ar_condicionado\r\n  FROM\r\n    {{ ref(\"sppo_veiculo_dia\") }} -- `rj-smtr`.`veiculo`.`sppo_veiculo_dia`\r\n  WHERE\r\n    `data` BETWEEN DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n    AND DATE( \"{{ var(\"end_date\") }}\" ) ),\r\n  viagem_v2 AS (\r\n  SELECT\r\n    `data`,\r\n    servico_realizado AS servico,\r\n    id_veiculo,\r\n    id_viagem,\r\n    distancia_planejada\r\n  FROM\r\n    {{ ref(\"viagem_completa\") }} --`rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\r\n  WHERE\r\n    `data` BETWEEN DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n    AND DATE( \"{{ var(\"end_date\") }}\" ) ),\r\n  tipo_viagem_v2_atualizado AS (\r\n  SELECT\r\n    * EXCEPT(status),\r\n    CASE\r\n      WHEN status = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\r\n      WHEN status = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\r\n      WHEN status = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\r\n      WHEN status = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\r\n    ELSE status\r\n    END AS status\r\n  FROM\r\n    tipo_viagem_v2),\r\n  sumario_v2 AS (\r\n  SELECT\r\n    v.`data`,\r\n    v.servico,\r\n    ve.status AS tipo_viagem,\r\n    ve.indicador_ar_condicionado,\r\n    COUNT(id_viagem) AS viagens,\r\n    ROUND(SUM(distancia_planejada), 2) AS km_apurada\r\n  FROM\r\n    viagem_v2 v\r\n  LEFT JOIN\r\n    tipo_viagem_v2_atualizado ve\r\n  ON\r\n    ve.`data` = v.`data`\r\n    AND ve.id_veiculo = v.id_veiculo\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4 )\r\n(\r\nSELECT\r\n  v1.`data`,\r\n  p.tipo_dia,\r\n  p.consorcio,\r\n  v1.servico,\r\n  COALESCE(v1.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\r\n  SAFE_CAST(indicador_ar_condicionado AS BOOL) AS indicador_ar_condicionado,\r\n  COALESCE(v1.viagens, 0) AS viagens,\r\n  COALESCE(v1.km_apurada, 0) AS km_apurada\r\nFROM\r\n  sumario_v1 v1\r\nINNER JOIN\r\n  planejado p\r\nON\r\n  p.`data` = v1.`data`\r\n  AND p.servico = v1.servico\r\nWHERE\r\n  p.`data` < DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" ))\r\nUNION ALL (\r\nSELECT\r\n  v2.`data`,\r\n  p.tipo_dia,\r\n  p.consorcio,\r\n  v2.servico,\r\n  COALESCE(v2.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\r\n  v2.indicador_ar_condicionado,\r\n  COALESCE(v2.viagens, 0) AS viagens,\r\n  COALESCE(v2.km_apurada, 0) AS km_apurada\r\nFROM\r\n  sumario_v2 v2\r\nINNER JOIN\r\n  planejado p\r\nON\r\n  p.`data` = v2.`data`\r\n  AND p.servico = v2.servico\r\nWHERE\r\n  p.`data` >= DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" ))", "language": "sql", "refs": [{"name": "sumario_servico_dia_historico", "package": null, "version": null}, {"name": "sumario_servico_dia_historico", "package": null, "version": null}, {"name": "sppo_veiculo_dia", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_servico_tipo_viagem_dia.sql", "compiled": true, "compiled_code": "WITH\n  planejado AS (\n  SELECT\n    DISTINCT `data`,\n    tipo_dia,\n    consorcio,\n    servico\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n  WHERE\n    `data` <= DATE( \"2022-01-01T01:00:00\" )),\n  sumario_v1 AS ( -- Viagens v1\n  SELECT\n    `data`,\n    servico,\n    \"N\u00e3o classificado\" AS tipo_viagem,\n    NULL AS indicador_ar_condicionado,\n    viagens,\n    km_apurada\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`\n  WHERE\n    `data` < DATE( \"2023-01-16\" ) ),\n  tipo_viagem_v2 AS ( -- Classifica os tipos de viagem (v2)\n  SELECT\n    `data`,\n    id_veiculo,\n    status,\n    SAFE_CAST(JSON_VALUE(indicadores,\"$.indicador_ar_condicionado\") AS BOOL) AS indicador_ar_condicionado\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_veiculo_dia` -- `rj-smtr`.`veiculo`.`sppo_veiculo_dia`\n  WHERE\n    `data` BETWEEN DATE( \"2023-01-16\" )\n    AND DATE( \"2022-01-01T01:00:00\" ) ),\n  viagem_v2 AS (\n  SELECT\n    `data`,\n    servico_realizado AS servico,\n    id_veiculo,\n    id_viagem,\n    distancia_planejada\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa` --`rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n  WHERE\n    `data` BETWEEN DATE( \"2023-01-16\" )\n    AND DATE( \"2022-01-01T01:00:00\" ) ),\n  tipo_viagem_v2_atualizado AS (\n  SELECT\n    * EXCEPT(status),\n    CASE\n      WHEN status = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\n      WHEN status = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\n      WHEN status = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\n      WHEN status = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\n    ELSE status\n    END AS status\n  FROM\n    tipo_viagem_v2),\n  sumario_v2 AS (\n  SELECT\n    v.`data`,\n    v.servico,\n    ve.status AS tipo_viagem,\n    ve.indicador_ar_condicionado,\n    COUNT(id_viagem) AS viagens,\n    ROUND(SUM(distancia_planejada), 2) AS km_apurada\n  FROM\n    viagem_v2 v\n  LEFT JOIN\n    tipo_viagem_v2_atualizado ve\n  ON\n    ve.`data` = v.`data`\n    AND ve.id_veiculo = v.id_veiculo\n  GROUP BY\n    1,\n    2,\n    3,\n    4 )\n(\nSELECT\n  v1.`data`,\n  p.tipo_dia,\n  p.consorcio,\n  v1.servico,\n  COALESCE(v1.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\n  SAFE_CAST(indicador_ar_condicionado AS BOOL) AS indicador_ar_condicionado,\n  COALESCE(v1.viagens, 0) AS viagens,\n  COALESCE(v1.km_apurada, 0) AS km_apurada\nFROM\n  sumario_v1 v1\nINNER JOIN\n  planejado p\nON\n  p.`data` = v1.`data`\n  AND p.servico = v1.servico\nWHERE\n  p.`data` < DATE( \"2023-01-16\" ))\nUNION ALL (\nSELECT\n  v2.`data`,\n  p.tipo_dia,\n  p.consorcio,\n  v2.servico,\n  COALESCE(v2.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\n  v2.indicador_ar_condicionado,\n  COALESCE(v2.viagens, 0) AS viagens,\n  COALESCE(v2.km_apurada, 0) AS km_apurada\nFROM\n  sumario_v2 v2\nINNER JOIN\n  planejado p\nON\n  p.`data` = v2.`data`\n  AND p.servico = v2.servico\nWHERE\n  p.`data` >= DATE( \"2023-01-16\" ))", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_servico_dia_historico": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_servico_dia_historico", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_servico_dia_historico.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_servico_dia_historico.sql", "unique_id": "model.rj_smtr.sumario_servico_dia_historico", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_servico_dia_historico"], "alias": "sumario_servico_dia_historico", "checksum": {"name": "sha256", "checksum": "c3a1c6dda6724fca4a5864cafdb004a302ab67f80b555b04f17a15da0c3197f5"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio hist\u00f3rico do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio da linha (ex: Bananal \u2194 Saens Pe\u00f1a)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens": {"name": "viagens", "description": "Quantidade de viagens apuradas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada": {"name": "km_apurada", "description": "Dist\u00e2ncia apurada do servi\u00e7o (km)\n Dist\u00e2ncia planejada da viagem multiplicada pela quantidade de viagens", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada": {"name": "km_planejada", "description": "Dist\u00e2ncia planejada para o servi\u00e7o (km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_km_planejada": {"name": "perc_km_planejada", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_subsidio_pago": {"name": "valor_subsidio_pago", "description": "Valor de subs\u00eddio apurado (R$)\n Dist\u00e2ncia apurada do servi\u00e7o multiplicada pelos respectivos valores pela classifica\u00e7\u00e3o do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_penalidade": {"name": "valor_penalidade", "description": "Valor de penalidade apurado (R$)\n Linha com opera\u00e7\u00e3o entre 40% e 60% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o m\u00e9dia prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO.\n Linha com opera\u00e7\u00e3o inferior a 40% da quilometragem estipulada - penalidade equivalente a uma infra\u00e7\u00e3o grave prevista no C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por Meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro - SPPO.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.645592, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_historico`", "raw_code": "{{\r\n  config(\r\n    materialized=\"incremental\",\r\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\r\n    incremental_strategy=\"insert_overwrite\",\r\n  )\r\n}}\r\n\r\nWITH\r\n  viagem_planejada AS (\r\n    (\r\n      SELECT\r\n        DISTINCT v.data,\r\n        v.servico,\r\n        o.vista\r\n      FROM\r\n        {{ ref(\"viagem_planejada\") }} AS v\r\n        -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada` AS v\r\n      LEFT JOIN\r\n        {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n        -- rj-smtr.projeto_subsidio_sppo.subsidio_data_versao_efetiva\r\n      USING\r\n        (data)\r\n      LEFT JOIN\r\n        {{ ref(\"ordem_servico_gtfs\") }} AS o\r\n        -- rj-smtr.gtfs.ordem_servico AS o\r\n      USING\r\n        (feed_start_date, servico, tipo_os)\r\n      WHERE\r\n        data >= \"{{ var('DATA_SUBSIDIO_V7_INICIO') }}\"\r\n    )\r\n  UNION ALL\r\n    (\r\n      SELECT\r\n        DISTINCT `data`,\r\n        servico,\r\n        vista\r\n      FROM\r\n        {{ ref(\"viagem_planejada\") }}\r\n        -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\r\n      WHERE\r\n        (id_tipo_trajeto = 0\r\n        OR id_tipo_trajeto IS NULL)\r\n        AND data < \"{{ var('DATA_SUBSIDIO_V7_INICIO') }}\"\r\n    )\r\n  ),\r\n  -- v1: Valor do subs\u00eddio pr\u00e9 glosa por tipos de viagem (Antes de 2023-01-16)\r\n  sumario_sem_glosa AS (\r\n  SELECT\r\n    `data`,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico,\r\n    vista,\r\n    viagens_subsidio AS viagens,\r\n    distancia_total_subsidio AS km_apurada,\r\n    distancia_total_planejada AS km_planejada,\r\n    perc_distancia_total_subsidio AS perc_km_planejada,\r\n    valor_total_subsidio AS valor_subsidio_pago,\r\n    NULL AS valor_penalidade\r\n  FROM\r\n    {{ ref(\"sumario_dia\") }}\r\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_dia`\r\n  LEFT JOIN\r\n    viagem_planejada\r\n  USING\r\n    ( `data`,\r\n      servico ) ),\r\n  -- v2: Valor do subs\u00eddio p\u00f3s glosa por tipos de viagem (2023-01-16 a 2023-07-15 e ap\u00f3s de 2023-09-01)\r\n  sumario_com_glosa AS (\r\n  SELECT\r\n    `data`,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico,\r\n    vista,\r\n    viagens,\r\n    km_apurada,\r\n    km_planejada,\r\n    perc_km_planejada,\r\n    valor_subsidio_pago,\r\n    valor_penalidade\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia\") }}\r\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia`\r\n  LEFT JOIN\r\n    viagem_planejada\r\n  USING\r\n    ( `data`,\r\n      servico )),\r\n  -- Valor do subs\u00eddio sem glosas - Suspenso por Decis\u00e3o Judicial (Entre 2023-07-16 e 2023-08-31) (R$ 2.81/km em 2023)\r\n  subsidio_total_glosa_suspensa AS (\r\n  SELECT\r\n    DATA,\r\n    servico,\r\n    CASE\r\n      WHEN perc_km_planejada >= 80 THEN ROUND((COALESCE(km_apurada_autuado_ar_inoperante, 0) + COALESCE(km_apurada_autuado_seguranca, 0) + COALESCE(km_apurada_autuado_limpezaequipamento, 0) + COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) + COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0)) * 2.81, 2)\r\n    ELSE\r\n    0\r\n  END\r\n    AS valor_subsidio_pago,\r\n    0 AS valor_penalidade\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_tipo\") }}\r\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`\r\n  WHERE\r\n    DATA BETWEEN \"2023-07-16\"\r\n    AND \"2023-08-31\"),\r\n  -- v3: Sum\u00e1rio subs\u00eddio sem glosas - Suspenso por Decis\u00e3o Judicial (Entre 2023-07-16 e 2023-08-31)\r\n  sumario_glosa_suspensa AS (\r\n  SELECT\r\n    s.* EXCEPT (valor_subsidio_pago,\r\n      valor_penalidade),\r\n    g.valor_subsidio_pago,\r\n    g.valor_penalidade\r\n  FROM\r\n    subsidio_total_glosa_suspensa AS g\r\n  LEFT JOIN\r\n    sumario_com_glosa AS s\r\n  USING\r\n    ( `data`,\r\n      servico )),\r\ndados_completos AS (\r\n  SELECT\r\n  *\r\n  FROM\r\n    sumario_sem_glosa\r\n  UNION ALL (\r\n    SELECT\r\n      *\r\n    FROM\r\n      sumario_com_glosa\r\n    WHERE\r\n      `data` < \"2023-07-16\"\r\n      OR `data` > \"2023-08-31\" )\r\n  UNION ALL (\r\n    SELECT\r\n      *\r\n    FROM\r\n      sumario_glosa_suspensa )\r\n)\r\nSELECT\r\n  *,\r\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\r\nFROM\r\n  dados_completos\r\n{% if is_incremental() %}\r\n  WHERE\r\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\" )\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n{% endif %}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "viagem_planejada", "package": null, "version": null}, {"name": "sumario_dia", "package": null, "version": null}, {"name": "sumario_servico_dia", "package": null, "version": null}, {"name": "sumario_servico_dia_tipo", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.sumario_dia", "model.rj_smtr.sumario_servico_dia", "model.rj_smtr.sumario_servico_dia_tipo"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_servico_dia_historico.sql", "compiled": true, "compiled_code": "\n\nWITH\n  viagem_planejada AS (\n    (\n      SELECT\n        DISTINCT v.data,\n        v.servico,\n        o.vista\n      FROM\n        `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada` AS v\n        -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada` AS v\n      LEFT JOIN\n        `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n        -- rj-smtr.projeto_subsidio_sppo.subsidio_data_versao_efetiva\n      USING\n        (data)\n      LEFT JOIN\n        `rj-smtr`.`gtfs`.`ordem_servico` AS o\n        -- rj-smtr.gtfs.ordem_servico AS o\n      USING\n        (feed_start_date, servico, tipo_os)\n      WHERE\n        data >= \"2024-05-01\"\n    )\n  UNION ALL\n    (\n      SELECT\n        DISTINCT `data`,\n        servico,\n        vista\n      FROM\n        `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n        -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n      WHERE\n        (id_tipo_trajeto = 0\n        OR id_tipo_trajeto IS NULL)\n        AND data < \"2024-05-01\"\n    )\n  ),\n  -- v1: Valor do subs\u00eddio pr\u00e9 glosa por tipos de viagem (Antes de 2023-01-16)\n  sumario_sem_glosa AS (\n  SELECT\n    `data`,\n    tipo_dia,\n    consorcio,\n    servico,\n    vista,\n    viagens_subsidio AS viagens,\n    distancia_total_subsidio AS km_apurada,\n    distancia_total_planejada AS km_planejada,\n    perc_distancia_total_subsidio AS perc_km_planejada,\n    valor_total_subsidio AS valor_subsidio_pago,\n    NULL AS valor_penalidade\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_dia`\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_dia`\n  LEFT JOIN\n    viagem_planejada\n  USING\n    ( `data`,\n      servico ) ),\n  -- v2: Valor do subs\u00eddio p\u00f3s glosa por tipos de viagem (2023-01-16 a 2023-07-15 e ap\u00f3s de 2023-09-01)\n  sumario_com_glosa AS (\n  SELECT\n    `data`,\n    tipo_dia,\n    consorcio,\n    servico,\n    vista,\n    viagens,\n    km_apurada,\n    km_planejada,\n    perc_km_planejada,\n    valor_subsidio_pago,\n    valor_penalidade\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia`\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia`\n  LEFT JOIN\n    viagem_planejada\n  USING\n    ( `data`,\n      servico )),\n  -- Valor do subs\u00eddio sem glosas - Suspenso por Decis\u00e3o Judicial (Entre 2023-07-16 e 2023-08-31) (R$ 2.81/km em 2023)\n  subsidio_total_glosa_suspensa AS (\n  SELECT\n    DATA,\n    servico,\n    CASE\n      WHEN perc_km_planejada >= 80 THEN ROUND((COALESCE(km_apurada_autuado_ar_inoperante, 0) + COALESCE(km_apurada_autuado_seguranca, 0) + COALESCE(km_apurada_autuado_limpezaequipamento, 0) + COALESCE(km_apurada_licenciado_sem_ar_n_autuado, 0) + COALESCE(km_apurada_licenciado_com_ar_n_autuado, 0)) * 2.81, 2)\n    ELSE\n    0\n  END\n    AS valor_subsidio_pago,\n    0 AS valor_penalidade\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`\n    -- `rj-smtr`.`dashboard_subsidio_sppo`.`sumario_servico_dia_tipo`\n  WHERE\n    DATA BETWEEN \"2023-07-16\"\n    AND \"2023-08-31\"),\n  -- v3: Sum\u00e1rio subs\u00eddio sem glosas - Suspenso por Decis\u00e3o Judicial (Entre 2023-07-16 e 2023-08-31)\n  sumario_glosa_suspensa AS (\n  SELECT\n    s.* EXCEPT (valor_subsidio_pago,\n      valor_penalidade),\n    g.valor_subsidio_pago,\n    g.valor_penalidade\n  FROM\n    subsidio_total_glosa_suspensa AS g\n  LEFT JOIN\n    sumario_com_glosa AS s\n  USING\n    ( `data`,\n      servico )),\ndados_completos AS (\n  SELECT\n  *\n  FROM\n    sumario_sem_glosa\n  UNION ALL (\n    SELECT\n      *\n    FROM\n      sumario_com_glosa\n    WHERE\n      `data` < \"2023-07-16\"\n      OR `data` > \"2023-08-31\" )\n  UNION ALL (\n    SELECT\n      *\n    FROM\n      sumario_glosa_suspensa )\n)\nSELECT\n  *,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  dados_completos\n\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\" )\n    AND DATE( \"2022-01-01T01:00:00\" )\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagens_remuneradas": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "viagens_remuneradas", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/viagens_remuneradas.sql", "original_file_path": "models/dashboard_subsidio_sppo/viagens_remuneradas.sql", "unique_id": "model.rj_smtr.viagens_remuneradas", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "viagens_remuneradas"], "alias": "viagens_remuneradas", "checksum": {"name": "sha256", "checksum": "6c4451ad1a995b3eb9ec48e377599965431e9a4608b3abcc08771bed9ed45476"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["data", "id_viagem"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com indica\u00e7\u00e3o de remunera\u00e7\u00e3o de viagens para fins de verifica\u00e7\u00e3o de teto de pagamento conforme regra de 120%/200% (RESOLU\u00c7\u00c3O SMTR N\u00ba 3.645/2023)", "columns": {"data": {"name": "data", "description": "Data da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Classifica\u00e7\u00e3o do tipo de viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo \u00fanico identificador da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia planejada da viagem (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_km": {"name": "subsidio_km", "description": "Valor de subs\u00eddio, conforme tipo de viagem (R$/km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_km_teto": {"name": "subsidio_km_teto", "description": "Valor m\u00e1ximo de subs\u00eddio, conforme tipo de viagem (R$/km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_viagem_dentro_limite": {"name": "indicador_viagem_dentro_limite", "description": "Indica se a viagem foi remunerada por estar abaixo do teto de 120%/200%.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "dashboard_subsidio_sppo", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}, "unique_key": ["data", "id_viagem"], "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.6632552, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`viagens_remuneradas`", "raw_code": "{{\r\n    config(\r\n        materialized=\"incremental\",\r\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\r\n        unique_key=[\"data\", \"id_viagem\"],\r\n        incremental_strategy=\"insert_overwrite\",\r\n    )\r\n}}\r\n\r\n{%- if execute %}\r\n  {% set query = \"SELECT DISTINCT COALESCE(feed_start_date, data_versao_trips, data_versao_shapes, data_versao_frequencies) FROM \" ~ ref('subsidio_data_versao_efetiva') ~ \" WHERE data BETWEEN DATE('\" ~ var('start_date') ~ \"') AND DATE('\" ~ var(\"end_date\") ~ \"')\"%}\r\n  {{- log(query, info=True) -}}\r\n  {% set feed_start_dates = run_query(query).columns[0].values() %}\r\n  {{- log(feed_start_dates, info=True) -}}\r\n{% endif -%}\r\n\r\nWITH\r\n-- 1. Viagens planejadas (agrupadas por data e servi\u00e7o)\r\n  planejado AS (\r\n  SELECT\r\n    DISTINCT data,\r\n    tipo_dia,\r\n    consorcio,\r\n    servico,\r\n    faixa_horaria_inicio,\r\n    faixa_horaria_fim,\r\n    partidas_total_planejada,\r\n    distancia_total_planejada AS km_planejada,\r\n  FROM\r\n    {{ ref(\"viagem_planejada\") }}\r\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\r\n  WHERE\r\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n    AND ( distancia_total_planejada > 0\r\n      OR distancia_total_planejada IS NULL )\r\n    AND (id_tipo_trajeto = 0\r\n      OR id_tipo_trajeto IS NULL)\r\n  ),\r\n  viagens_planejadas AS (\r\n  SELECT\r\n    feed_start_date,\r\n    servico,\r\n    tipo_dia,\r\n    viagens_planejadas,\r\n    partidas_ida,\r\n    partidas_volta,\r\n    tipo_os,\r\n  FROM\r\n      {{ ref(\"ordem_servico_gtfs\") }}\r\n      -- rj-smtr.gtfs.ordem_servico\r\n  WHERE\r\n    feed_start_date IN ('{{ feed_start_dates|join(\"', '\") }}')\r\n  ),\r\n  data_versao_efetiva AS (\r\n  SELECT\r\n    data,\r\n    tipo_dia,\r\n    tipo_os,\r\n    COALESCE(feed_start_date, data_versao_trips, data_versao_shapes, data_versao_frequencies) AS feed_start_date\r\n  FROM\r\n      {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n      -- rj-smtr.projeto_subsidio_sppo.subsidio_data_versao_efetiva -- (alterar tamb\u00e9m query no bloco execute)\r\n  WHERE\r\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n  ),\r\n  viagem_planejada AS (\r\n  SELECT\r\n    p.data,\r\n    p.tipo_dia,\r\n    p.consorcio,\r\n    p.servico,\r\n    p.faixa_horaria_inicio,\r\n    p.faixa_horaria_fim,\r\n    v.viagens_planejadas,\r\n    p.km_planejada,\r\n    IF(p.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}\"), p.partidas_total_planejada, v.partidas_ida + v.partidas_volta) AS viagens_planejadas_ida_volta\r\n  FROM\r\n    planejado AS p\r\n  LEFT JOIN\r\n    data_versao_efetiva AS d\r\n  USING\r\n    (data, tipo_dia)\r\n  LEFT JOIN\r\n    viagens_planejadas AS v\r\n  ON\r\n    d.feed_start_date = v.feed_start_date\r\n    AND p.tipo_dia = v.tipo_dia\r\n    AND p.servico = v.servico\r\n    AND (d.tipo_os = v.tipo_os\r\n      OR (d.tipo_os IS NULL AND v.tipo_os = \"Regular\"))\r\n  ),\r\n-- 2. Par\u00e2metros de subs\u00eddio\r\n  subsidio_parametros AS (\r\n  SELECT\r\n    DISTINCT data_inicio,\r\n    data_fim,\r\n    status,\r\n    subsidio_km,\r\n    MAX(subsidio_km) OVER (PARTITION BY DATE_TRUNC(data_inicio, YEAR), data_fim) AS subsidio_km_teto,\r\n    indicador_penalidade_judicial\r\n  FROM\r\n    {{ ref(\"subsidio_valor_km_tipo_viagem\") }}\r\n    -- rj-smtr-staging.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem\r\n),\r\n-- 3. Viagens com quantidades de transa\u00e7\u00f5es\r\n  viagem_transacao AS (\r\n  SELECT\r\n    *\r\n FROM\r\n    {{ ref(\"viagem_transacao\") }}\r\n    -- rj-smtr.subsidio.viagem_transacao\r\n  WHERE\r\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\r\n    AND DATE( \"{{ var(\"end_date\") }}\" )\r\n  ),\r\n-- 4. Viagens com tipo e valor de subs\u00eddio por km\r\n  viagem_km_tipo AS (\r\n  SELECT\r\n    vt.data,\r\n    vt.servico,\r\n    vt.tipo_viagem,\r\n    vt.id_viagem,\r\n    vt.datetime_partida,\r\n    vt.distancia_planejada,\r\n    t.subsidio_km,\r\n    t.subsidio_km_teto,\r\n    t.indicador_penalidade_judicial\r\n  FROM\r\n    viagem_transacao AS vt\r\n  LEFT JOIN\r\n    subsidio_parametros AS t\r\n  ON\r\n    vt.data BETWEEN t.data_inicio\r\n    AND t.data_fim\r\n    AND vt.tipo_viagem = t.status ),\r\n-- 5. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o Di\u00e1rio (POD)\r\n  servico_faixa_km_apuracao AS (\r\n  SELECT\r\n    p.data,\r\n    p.tipo_dia,\r\n    p.faixa_horaria_inicio,\r\n    p.faixa_horaria_fim,\r\n    p.consorcio,\r\n    p.servico,\r\n    p.km_planejada AS km_planejada,\r\n    COALESCE(ROUND(100 * SUM(IF(v.tipo_viagem NOT IN (\"N\u00e3o licenciado\",\"N\u00e3o vistoriado\"),v.distancia_planejada, 0)) / p.km_planejada,2), 0) AS pof\r\n  FROM\r\n    viagem_planejada AS p\r\n  LEFT JOIN\r\n    viagem_km_tipo AS v\r\n  ON\r\n    p.data = v.data\r\n    AND p.servico = v.servico\r\n    AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\r\n    AND p.faixa_horaria_fim\r\n  GROUP BY\r\n    1, 2, 3, 4, 5, 6, 7\r\n  )\r\n-- 6. Flag de viagens que ser\u00e3o consideradas ou n\u00e3o para fins de remunera\u00e7\u00e3o (apura\u00e7\u00e3o de valor de subs\u00eddio) - RESOLU\u00c7\u00c3O SMTR N\u00ba 3645/2023\r\nSELECT\r\n  v.* EXCEPT(rn, datetime_partida, viagens_planejadas, viagens_planejadas_ida_volta, km_planejada, tipo_dia, consorcio, faixa_horaria_inicio, faixa_horaria_fim),\r\n  CASE\r\n    WHEN v.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V3A_INICIO\") }}\")\r\n        AND v.tipo_dia = \"Dia \u00datil\"\r\n        AND viagens_planejadas > 10\r\n        AND pof > 120\r\n        AND rn > viagens_planejadas_ida_volta*1.2\r\n        THEN FALSE\r\n    WHEN v.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V3A_INICIO\") }}\")\r\n        AND v.tipo_dia = \"Dia \u00datil\"\r\n        AND viagens_planejadas <= 10\r\n        AND pof > 200\r\n        AND rn > viagens_planejadas_ida_volta*2\r\n        THEN FALSE\r\n    WHEN v.data >= DATE(\"{{ var(\"DATA_SUBSIDIO_V3A_INICIO\") }}\")\r\n        AND (v.tipo_dia = \"Dia \u00datil\"\r\n          AND (viagens_planejadas IS NULL\r\n            OR pof IS NULL\r\n            OR rn IS NULL\r\n          )\r\n        )\r\n      THEN NULL\r\n    ELSE\r\n        TRUE\r\n    END AS indicador_viagem_dentro_limite\r\nFROM (\r\nSELECT\r\n  v.*,\r\n  p.* EXCEPT(data, servico),\r\n  ROW_NUMBER() OVER(PARTITION BY v.data, v.servico, faixa_horaria_inicio, faixa_horaria_fim ORDER BY subsidio_km*distancia_planejada DESC) AS rn\r\nFROM\r\n  viagem_km_tipo AS v\r\nLEFT JOIN\r\n  viagem_planejada AS p\r\nON\r\n  p.data = v.data\r\n  AND p.servico = v.servico\r\n  AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\r\n  AND p.faixa_horaria_fim\r\n) AS v\r\nLEFT JOIN\r\n  servico_faixa_km_apuracao AS s\r\nON\r\n  s.data = v.data\r\n  AND s.servico = v.servico\r\n  AND v.datetime_partida BETWEEN s.faixa_horaria_inicio\r\n  AND s.faixa_horaria_fim", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "subsidio_valor_km_tipo_viagem", "package": null, "version": null}, {"name": "viagem_transacao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.run_query"], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.subsidio_valor_km_tipo_viagem", "model.rj_smtr.viagem_transacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/viagens_remuneradas.sql", "compiled": true, "compiled_code": "\n  WITH\n-- 1. Viagens planejadas (agrupadas por data e servi\u00e7o)\n  planejado AS (\n  SELECT\n    DISTINCT data,\n    tipo_dia,\n    consorcio,\n    servico,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    partidas_total_planejada,\n    distancia_total_planejada AS km_planejada,\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" )\n    AND ( distancia_total_planejada > 0\n      OR distancia_total_planejada IS NULL )\n    AND (id_tipo_trajeto = 0\n      OR id_tipo_trajeto IS NULL)\n  ),\n  viagens_planejadas AS (\n  SELECT\n    feed_start_date,\n    servico,\n    tipo_dia,\n    viagens_planejadas,\n    partidas_ida,\n    partidas_volta,\n    tipo_os,\n  FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n      -- rj-smtr.gtfs.ordem_servico\n  WHERE\n    feed_start_date IN ('')\n  ),\n  data_versao_efetiva AS (\n  SELECT\n    data,\n    tipo_dia,\n    tipo_os,\n    COALESCE(feed_start_date, data_versao_trips, data_versao_shapes, data_versao_frequencies) AS feed_start_date\n  FROM\n      `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n      -- rj-smtr.projeto_subsidio_sppo.subsidio_data_versao_efetiva -- (alterar tamb\u00e9m query no bloco execute)\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" )\n  ),\n  viagem_planejada AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.consorcio,\n    p.servico,\n    p.faixa_horaria_inicio,\n    p.faixa_horaria_fim,\n    v.viagens_planejadas,\n    p.km_planejada,\n    IF(p.data >= DATE(\"2024-08-16\"), p.partidas_total_planejada, v.partidas_ida + v.partidas_volta) AS viagens_planejadas_ida_volta\n  FROM\n    planejado AS p\n  LEFT JOIN\n    data_versao_efetiva AS d\n  USING\n    (data, tipo_dia)\n  LEFT JOIN\n    viagens_planejadas AS v\n  ON\n    d.feed_start_date = v.feed_start_date\n    AND p.tipo_dia = v.tipo_dia\n    AND p.servico = v.servico\n    AND (d.tipo_os = v.tipo_os\n      OR (d.tipo_os IS NULL AND v.tipo_os = \"Regular\"))\n  ),\n-- 2. Par\u00e2metros de subs\u00eddio\n  subsidio_parametros AS (\n  SELECT\n    DISTINCT data_inicio,\n    data_fim,\n    status,\n    subsidio_km,\n    MAX(subsidio_km) OVER (PARTITION BY DATE_TRUNC(data_inicio, YEAR), data_fim) AS subsidio_km_teto,\n    indicador_penalidade_judicial\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`\n    -- rj-smtr-staging.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem\n),\n-- 3. Viagens com quantidades de transa\u00e7\u00f5es\n  viagem_transacao AS (\n  SELECT\n    *\n FROM\n    `rj-smtr`.`subsidio`.`viagem_transacao`\n    -- rj-smtr.subsidio.viagem_transacao\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE( \"2022-01-01T01:00:00\" )\n  ),\n-- 4. Viagens com tipo e valor de subs\u00eddio por km\n  viagem_km_tipo AS (\n  SELECT\n    vt.data,\n    vt.servico,\n    vt.tipo_viagem,\n    vt.id_viagem,\n    vt.datetime_partida,\n    vt.distancia_planejada,\n    t.subsidio_km,\n    t.subsidio_km_teto,\n    t.indicador_penalidade_judicial\n  FROM\n    viagem_transacao AS vt\n  LEFT JOIN\n    subsidio_parametros AS t\n  ON\n    vt.data BETWEEN t.data_inicio\n    AND t.data_fim\n    AND vt.tipo_viagem = t.status ),\n-- 5. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o Di\u00e1rio (POD)\n  servico_faixa_km_apuracao AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.faixa_horaria_inicio,\n    p.faixa_horaria_fim,\n    p.consorcio,\n    p.servico,\n    p.km_planejada AS km_planejada,\n    COALESCE(ROUND(100 * SUM(IF(v.tipo_viagem NOT IN (\"N\u00e3o licenciado\",\"N\u00e3o vistoriado\"),v.distancia_planejada, 0)) / p.km_planejada,2), 0) AS pof\n  FROM\n    viagem_planejada AS p\n  LEFT JOIN\n    viagem_km_tipo AS v\n  ON\n    p.data = v.data\n    AND p.servico = v.servico\n    AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\n    AND p.faixa_horaria_fim\n  GROUP BY\n    1, 2, 3, 4, 5, 6, 7\n  )\n-- 6. Flag de viagens que ser\u00e3o consideradas ou n\u00e3o para fins de remunera\u00e7\u00e3o (apura\u00e7\u00e3o de valor de subs\u00eddio) - RESOLU\u00c7\u00c3O SMTR N\u00ba 3645/2023\nSELECT\n  v.* EXCEPT(rn, datetime_partida, viagens_planejadas, viagens_planejadas_ida_volta, km_planejada, tipo_dia, consorcio, faixa_horaria_inicio, faixa_horaria_fim),\n  CASE\n    WHEN v.data >= DATE(\"2023-09-16\")\n        AND v.tipo_dia = \"Dia \u00datil\"\n        AND viagens_planejadas > 10\n        AND pof > 120\n        AND rn > viagens_planejadas_ida_volta*1.2\n        THEN FALSE\n    WHEN v.data >= DATE(\"2023-09-16\")\n        AND v.tipo_dia = \"Dia \u00datil\"\n        AND viagens_planejadas <= 10\n        AND pof > 200\n        AND rn > viagens_planejadas_ida_volta*2\n        THEN FALSE\n    WHEN v.data >= DATE(\"2023-09-16\")\n        AND (v.tipo_dia = \"Dia \u00datil\"\n          AND (viagens_planejadas IS NULL\n            OR pof IS NULL\n            OR rn IS NULL\n          )\n        )\n      THEN NULL\n    ELSE\n        TRUE\n    END AS indicador_viagem_dentro_limite\nFROM (\nSELECT\n  v.*,\n  p.* EXCEPT(data, servico),\n  ROW_NUMBER() OVER(PARTITION BY v.data, v.servico, faixa_horaria_inicio, faixa_horaria_fim ORDER BY subsidio_km*distancia_planejada DESC) AS rn\nFROM\n  viagem_km_tipo AS v\nLEFT JOIN\n  viagem_planejada AS p\nON\n  p.data = v.data\n  AND p.servico = v.servico\n  AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\n  AND p.faixa_horaria_fim\n) AS v\nLEFT JOIN\n  servico_faixa_km_apuracao AS s\nON\n  s.data = v.data\n  AND s.servico = v.servico\n  AND v.datetime_partida BETWEEN s.faixa_horaria_inicio\n  AND s.faixa_horaria_fim", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.viagens_realizadas": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "viagens_realizadas", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/viagens_realizadas.sql", "original_file_path": "models/dashboard_subsidio_sppo/viagens_realizadas.sql", "unique_id": "model.rj_smtr.viagens_realizadas", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "viagens_realizadas"], "alias": "viagens_realizadas", "checksum": {"name": "sha256", "checksum": "41cb9ac273f75095dc82c73e9d2306e36f648a4dbb820fcebd87a2718a4f816a"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Detalhes de todas as viagens completas identificadas.", "columns": {"consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_empresa": {"name": "id_empresa", "description": "C\u00f3digo identificador da empresa que opera o ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_informado": {"name": "servico_informado", "description": "Servi\u00e7o informado pelo GPS do ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realizado": {"name": "servico_realizado", "description": "Servi\u00e7o realizado pelo ve\u00edculo (com base na identifica\u00e7\u00e3o do trajeto)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio da linha (ex: Bananal \u2194 Saens Pe\u00f1a)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "C\u00f3digo identificador do itiner\u00e1rio (trip)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador do shape (trajeto) do servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido do trajeto identificado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_viagem": {"name": "id_viagem", "description": "C\u00f3digo identificador da viagem (id_veiculo + servico_realizado + sentido + shape_id_planejado + datetime_partida)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_partida": {"name": "datetime_partida", "description": "Hor\u00e1rio de in\u00edcio da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_chegada": {"name": "datetime_chegada", "description": "Hor\u00e1rio de fim da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Tipo de viagem - categorias:\n - Completa linha correta\n - Completa linha incorreta", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "In\u00edcio do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Fim do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_planejadas": {"name": "viagens_planejadas", "description": "Viagens planejadas no per\u00edodo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_planejado": {"name": "tempo_planejado", "description": "Tempo planejado da viagem (minutos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tempo_viagem": {"name": "tempo_viagem", "description": "Tempo aferido da viagem (minutos)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia do shape (trajeto) planejado (km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_aferida": {"name": "distancia_aferida", "description": "Dist\u00e2ncia aferida da viagem (dist\u00e2ncia euclidiana entre posi\u00e7\u00f5es consecutivas do sinal de GPS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_start": {"name": "n_registros_start", "description": "Contagem de sinais de GPS emitidos no meio do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_shape": {"name": "n_registros_shape", "description": "Contagem de sinais de GPS emitidos dentro do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_total": {"name": "n_registros_total", "description": "Contagem de sinais de GPS emitidos no tempo da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "n_registros_minuto": {"name": "n_registros_minuto", "description": "Contagem de minutos do trajeto com pelo menos 1 sinal de GPS emitido.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_shape": {"name": "perc_conformidade_shape", "description": "Percentual de sinais emitidos dentro do shape (trajeto) ao longo da viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_distancia": {"name": "perc_conformidade_distancia", "description": "Raz\u00e3o da dist\u00e2ncia aferida pela dist\u00e2ncia te\u00f3rica x 100", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_registros": {"name": "perc_conformidade_registros", "description": "Percentual de minutos da viagem com registro de sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_conformidade_tempo": {"name": "perc_conformidade_tempo", "description": "Raz\u00e3o do tempo aferido da viagem pelo planejado x 100", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "Vers\u00e3o da metodologia de c\u00e1lculo da respectiva linha na tabela.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_subsidio_sppo"}, "created_at": 1727709588.6609335, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`viagens_realizadas`", "raw_code": "SELECT\r\n  *\r\nFROM\r\n  {{ ref(\"viagem_completa\") }}\r\nWHERE\r\n  data BETWEEN \"2022-06-01\" AND DATE(\"{{ var(\"end_date\") }}\")", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/viagens_realizadas.sql", "compiled": true, "compiled_code": "SELECT\n  *\nFROM\n  `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n  data BETWEEN \"2022-06-01\" AND DATE(\"2022-01-01T01:00:00\")", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sumario_dia": {"database": "rj-smtr", "schema": "dashboard_subsidio_sppo", "name": "sumario_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "dashboard_subsidio_sppo/sumario_dia.sql", "original_file_path": "models/dashboard_subsidio_sppo/sumario_dia.sql", "unique_id": "model.rj_smtr.sumario_dia", "fqn": ["rj_smtr", "dashboard_subsidio_sppo", "sumario_dia"], "alias": "sumario_dia", "checksum": {"name": "sha256", "checksum": "a19bd23f4e50c5e7d4babd4c2cf40b0a273e126833b88fe36e1645f92575b52f"}, "config": {"enabled": true, "alias": null, "schema": "dashboard_subsidio_sppo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "sumario_dia", "columns": {"consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_planejadas": {"name": "viagens_planejadas", "description": "Quantidade de viagens planejadas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_subsidio": {"name": "viagens_subsidio", "description": "Quantidade de viagens apuradas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia planejada para o servi\u00e7o (km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_subsidio": {"name": "distancia_total_subsidio", "description": "Dist\u00e2ncia apurada do servi\u00e7o (km)\n Dist\u00e2ncia planejada da viagem multiplicada pela quantidade de viagens", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_subsidio_por_km": {"name": "valor_subsidio_por_km", "description": "Valor de subs\u00eddio (R$/km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_aferido": {"name": "valor_total_aferido", "description": "Valor de subs\u00eddio aferido (R$)\n Dist\u00e2ncia apurada do servi\u00e7o multiplicada pelo valor de subs\u00eddio (R$/km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "perc_distancia_total_subsidio": {"name": "perc_distancia_total_subsidio", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_subsidio": {"name": "valor_total_subsidio", "description": "Valor de subs\u00eddio apurado (R$), observado o indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/dashboard_subsidio_sppo/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "dashboard_subsidio_sppo"}, "created_at": 1727709588.6490335, "relation_name": "`rj-smtr`.`dashboard_subsidio_sppo`.`sumario_dia`", "raw_code": "WITH\r\n  planejado AS (\r\n  SELECT\r\n    consorcio,\r\n    data,\r\n    tipo_dia,\r\n    trip_id_planejado AS trip_id,\r\n    servico,\r\n    sentido,\r\n    CASE\r\n      WHEN sentido = \"C\" THEN MAX(distancia_planejada)\r\n    ELSE\r\n      SUM(distancia_planejada)\r\n    END\r\n    AS distancia_planejada,\r\n    CASE\r\n      WHEN sentido = \"C\" THEN MAX(distancia_total_planejada)\r\n    ELSE\r\n      SUM(distancia_total_planejada)\r\n    END AS distancia_total_planejada,\r\n    NULL AS viagens_planejadas\r\n  FROM\r\n    {{ ref(\"viagem_planejada\") }}\r\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\r\n  WHERE\r\n    data >= \"2022-06-01\"\r\n    AND data < DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n    AND distancia_total_planejada > 0\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    6),\r\n  viagem AS (\r\n  SELECT\r\n    data,\r\n    trip_id,\r\n    COUNT(id_viagem) AS viagens_realizadas\r\n  FROM\r\n    {{ ref(\"viagem_completa\") }}\r\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\r\n  WHERE\r\n    data >= \"2022-06-01\"\r\n    AND data < DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )\r\n  GROUP BY\r\n    1,\r\n    2),\r\n  sumario AS (\r\n  SELECT\r\n    consorcio,\r\n    data,\r\n    tipo_dia,\r\n    servico,\r\n    distancia_planejada,\r\n    NULL AS viagens_planejadas,\r\n    IFNULL(SUM(v.viagens_realizadas), 0) AS viagens_subsidio,\r\n    distancia_total_planejada,\r\n    (IFNULL(SUM(v.viagens_realizadas), 0) * distancia_planejada) AS distancia_total_subsidio\r\n  FROM\r\n    planejado AS p\r\n  LEFT JOIN\r\n    viagem AS v\r\n  USING\r\n    (trip_id,\r\n      data)\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    8 ),\r\n  sumario_agg AS (\r\n  SELECT\r\n    consorcio,\r\n    data,\r\n    tipo_dia,\r\n    servico,\r\n    NULL AS viagens_planejadas,\r\n    IFNULL(SUM(viagens_subsidio), 0) AS viagens_subsidio,\r\n    distancia_total_planejada,\r\n    ROUND(SUM(distancia_total_subsidio), 3) AS distancia_total_subsidio\r\n  FROM\r\n    sumario\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    7 ),\r\n  valor AS (\r\n  SELECT\r\n    s.*,\r\n    v.valor_subsidio_por_km,\r\n    ROUND(distancia_total_subsidio * v.valor_subsidio_por_km, 2) AS valor_total_aferido,\r\n  IF\r\n    (distancia_total_planejada = 0, NULL, ROUND(100*distancia_total_subsidio/distancia_total_planejada, 2)) AS perc_distancia_total_subsidio\r\n  FROM\r\n    sumario_agg s\r\n  LEFT JOIN (\r\n    SELECT\r\n      *\r\n    FROM\r\n      {{ ref(\"subsidio_data_versao_efetiva\") }}\r\n      -- `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\r\n    WHERE\r\n      data >= \"2022-06-01\"\r\n      AND data < DATE( \"{{ var(\"DATA_SUBSIDIO_V2_INICIO\") }}\" )) AS v\r\n  ON\r\n    v.data = s.data )\r\nSELECT\r\n  *,\r\n  CASE\r\n    WHEN (perc_distancia_total_subsidio < 80) OR (perc_distancia_total_subsidio IS NULL) THEN 0\r\n  ELSE\r\n  valor_total_aferido\r\nEND\r\n  AS valor_total_subsidio\r\nFROM\r\n  valor", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}, {"name": "subsidio_data_versao_efetiva", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_completa", "model.rj_smtr.subsidio_data_versao_efetiva"]}, "compiled_path": "target-base/compiled/rj_smtr/models/dashboard_subsidio_sppo/sumario_dia.sql", "compiled": true, "compiled_code": "WITH\n  planejado AS (\n  SELECT\n    consorcio,\n    data,\n    tipo_dia,\n    trip_id_planejado AS trip_id,\n    servico,\n    sentido,\n    CASE\n      WHEN sentido = \"C\" THEN MAX(distancia_planejada)\n    ELSE\n      SUM(distancia_planejada)\n    END\n    AS distancia_planejada,\n    CASE\n      WHEN sentido = \"C\" THEN MAX(distancia_total_planejada)\n    ELSE\n      SUM(distancia_total_planejada)\n    END AS distancia_total_planejada,\n    NULL AS viagens_planejadas\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n  WHERE\n    data >= \"2022-06-01\"\n    AND data < DATE( \"2023-01-16\" )\n    AND distancia_total_planejada > 0\n  GROUP BY\n    1,\n    2,\n    3,\n    4,\n    5,\n    6),\n  viagem AS (\n  SELECT\n    data,\n    trip_id,\n    COUNT(id_viagem) AS viagens_realizadas\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    -- `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n  WHERE\n    data >= \"2022-06-01\"\n    AND data < DATE( \"2023-01-16\" )\n  GROUP BY\n    1,\n    2),\n  sumario AS (\n  SELECT\n    consorcio,\n    data,\n    tipo_dia,\n    servico,\n    distancia_planejada,\n    NULL AS viagens_planejadas,\n    IFNULL(SUM(v.viagens_realizadas), 0) AS viagens_subsidio,\n    distancia_total_planejada,\n    (IFNULL(SUM(v.viagens_realizadas), 0) * distancia_planejada) AS distancia_total_subsidio\n  FROM\n    planejado AS p\n  LEFT JOIN\n    viagem AS v\n  USING\n    (trip_id,\n      data)\n  GROUP BY\n    1,\n    2,\n    3,\n    4,\n    5,\n    8 ),\n  sumario_agg AS (\n  SELECT\n    consorcio,\n    data,\n    tipo_dia,\n    servico,\n    NULL AS viagens_planejadas,\n    IFNULL(SUM(viagens_subsidio), 0) AS viagens_subsidio,\n    distancia_total_planejada,\n    ROUND(SUM(distancia_total_subsidio), 3) AS distancia_total_subsidio\n  FROM\n    sumario\n  GROUP BY\n    1,\n    2,\n    3,\n    4,\n    5,\n    7 ),\n  valor AS (\n  SELECT\n    s.*,\n    v.valor_subsidio_por_km,\n    ROUND(distancia_total_subsidio * v.valor_subsidio_por_km, 2) AS valor_total_aferido,\n  IF\n    (distancia_total_planejada = 0, NULL, ROUND(100*distancia_total_subsidio/distancia_total_planejada, 2)) AS perc_distancia_total_subsidio\n  FROM\n    sumario_agg s\n  LEFT JOIN (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n      -- `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva`\n    WHERE\n      data >= \"2022-06-01\"\n      AND data < DATE( \"2023-01-16\" )) AS v\n  ON\n    v.data = s.data )\nSELECT\n  *,\n  CASE\n    WHEN (perc_distancia_total_subsidio < 80) OR (perc_distancia_total_subsidio IS NULL) THEN 0\n  ELSE\n  valor_total_aferido\nEND\n  AS valor_total_subsidio\nFROM\n  valor", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.pagamento_bilhetagem_jae": {"database": "rj-smtr", "schema": "controle_financeiro", "name": "pagamento_bilhetagem_jae", "resource_type": "model", "package_name": "rj_smtr", "path": "controle_financeiro/pagamento_bilhetagem_jae.sql", "original_file_path": "models/controle_financeiro/pagamento_bilhetagem_jae.sql", "unique_id": "model.rj_smtr.pagamento_bilhetagem_jae", "fqn": ["rj_smtr", "controle_financeiro", "pagamento_bilhetagem_jae"], "alias": "pagamento_bilhetagem_jae", "checksum": {"name": "sha256", "checksum": "6059c3964deac03faa785d9b4748d0b0d307cceac3eafc24d0964cf70c2ea423"}, "config": {"enabled": true, "alias": null, "schema": "controle_financeiro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela contendo os pagamentos realizados pela CCT aos cons\u00f3rcios e operadores", "columns": {"data": {"name": "data", "description": "Data do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_pagamento": {"name": "datetime_pagamento", "description": "Data e hora do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora de captura em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Tipo de transporte (\u00d4nibus, Van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "favorecido": {"name": "favorecido", "description": "Nome do favorecido do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_ordem_pagamento": {"name": "id_ordem_pagamento", "description": "Identificador \u00fanico da ordem de pagamento da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_ordem": {"name": "valor_ordem", "description": "Valor l\u00edquido da ordem de pagamento da Ja\u00e9 (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor pago (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_pagamento_realizado": {"name": "indicador_pagamento_realizado", "description": "Indica se o pagamento foi realizado ou n\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/controle_financeiro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "controle_financeiro", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.665548, "relation_name": "`rj-smtr`.`controle_financeiro`.`pagamento_bilhetagem_jae`", "raw_code": "{{\n  config(\n    partition_by={\n      \"field\":\"data\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n  )\n}}\n\n\nWITH arquivo_retorno AS (\n  SELECT\n    id,\n    DATE(dataVencimento) AS data,\n    dataVencimento AS datetime_pagamento,\n    timestamp_captura AS datetime_captura,\n    idConsorcio AS id_consorcio,\n    idOperadora AS id_operadora,\n    dataOrdem AS data_ordem,\n    idOrdemPagamento AS id_ordem_pagamento,\n    favorecido,\n    valor AS valor_ordem,\n    valorRealEfetivado AS valor_pago,\n    isPago AS indicador_pagamento_realizado\n  FROM\n    {{ ref(\"staging_arquivo_retorno\") }}\n),\narquivo_retorno_deduplicado AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_consorcio, id_operadora, data_ordem ORDER BY indicador_pagamento_realizado DESC, datetime_captura DESC) AS rn\n    FROM\n      arquivo_retorno\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  a.data,\n  a.datetime_pagamento,\n  a.datetime_captura,\n  a.id_consorcio,\n  a.id_operadora,\n  c.modo,\n  CASE\n    WHEN c.modo = \"Van\" THEN c.consorcio\n    ELSE a.favorecido\n  END AS favorecido,\n  a.data_ordem,\n  a.id_ordem_pagamento,\n  a.valor_ordem,\n  a.valor_pago,\n  a.indicador_pagamento_realizado,\n  '{{ var(\"version\") }}' AS versao\nFROM\n  arquivo_retorno_deduplicado a\nLEFT JOIN\n  {{ ref(\"consorcios\") }} c\nUSING(id_consorcio)", "language": "sql", "refs": [{"name": "staging_arquivo_retorno", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_arquivo_retorno", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/controle_financeiro/pagamento_bilhetagem_jae.sql", "compiled": true, "compiled_code": "\n\n\nWITH arquivo_retorno AS (\n  SELECT\n    id,\n    DATE(dataVencimento) AS data,\n    dataVencimento AS datetime_pagamento,\n    timestamp_captura AS datetime_captura,\n    idConsorcio AS id_consorcio,\n    idOperadora AS id_operadora,\n    dataOrdem AS data_ordem,\n    idOrdemPagamento AS id_ordem_pagamento,\n    favorecido,\n    valor AS valor_ordem,\n    valorRealEfetivado AS valor_pago,\n    isPago AS indicador_pagamento_realizado\n  FROM\n    `rj-smtr`.`controle_financeiro_staging`.`arquivo_retorno`\n),\narquivo_retorno_deduplicado AS (\n  SELECT\n    * EXCEPT(rn)\n  FROM\n  (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY id_consorcio, id_operadora, data_ordem ORDER BY indicador_pagamento_realizado DESC, datetime_captura DESC) AS rn\n    FROM\n      arquivo_retorno\n  )\n  WHERE\n    rn = 1\n)\nSELECT\n  a.data,\n  a.datetime_pagamento,\n  a.datetime_captura,\n  a.id_consorcio,\n  a.id_operadora,\n  c.modo,\n  CASE\n    WHEN c.modo = \"Van\" THEN c.consorcio\n    ELSE a.favorecido\n  END AS favorecido,\n  a.data_ordem,\n  a.id_ordem_pagamento,\n  a.valor_ordem,\n  a.valor_pago,\n  a.indicador_pagamento_realizado,\n  '' AS versao\nFROM\n  arquivo_retorno_deduplicado a\nLEFT JOIN\n  `rj-smtr`.`cadastro`.`consorcios` c\nUSING(id_consorcio)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_retorno_ordem_pagamento": {"database": "rj-smtr", "schema": "controle_financeiro_staging", "name": "aux_retorno_ordem_pagamento", "resource_type": "model", "package_name": "rj_smtr", "path": "controle_financeiro/staging/aux_retorno_ordem_pagamento.sql", "original_file_path": "models/controle_financeiro/staging/aux_retorno_ordem_pagamento.sql", "unique_id": "model.rj_smtr.aux_retorno_ordem_pagamento", "fqn": ["rj_smtr", "controle_financeiro", "staging", "aux_retorno_ordem_pagamento"], "alias": "aux_retorno_ordem_pagamento", "checksum": {"name": "sha256", "checksum": "612a85a88da9e8e0bf17b62bcb2a2ddedf3043cbe0b43b077b80a69d46cd5c42"}, "config": {"enabled": true, "alias": null, "schema": "controle_financeiro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_id", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela auxiliar utilizada no tratamento da ordem de pagamento. \u00c9 utilizada por ser particionada pela data da ordem.", "columns": {"data_ordem": {"name": "data_ordem", "description": "Data da ordem de pagamento da Ja\u00e9 (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_pagamento": {"name": "data_pagamento", "description": "Data e hora do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador \u00fanico do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador \u00fanico da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "unique_id": {"name": "unique_id", "description": "Identificador \u00fanico do registro, composto pelas colunas data_ordem, id_consorcio e id_operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_pago": {"name": "valor_pago", "description": "Valor real pago (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/controle_financeiro/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "controle_financeiro_staging", "partition_by": {"field": "data_ordem", "data_type": "date", "granularity": "day"}, "unique_key": "unique_id"}, "created_at": 1727709588.6717374, "relation_name": "`rj-smtr`.`controle_financeiro_staging`.`aux_retorno_ordem_pagamento`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\n      \"field\":\"data_ordem\",\n      \"data_type\":\"date\",\n      \"granularity\": \"day\"\n    },\n    unique_key=\"unique_id\"\n  )\n}}\n\nSELECT DISTINCT\n  dataOrdem AS data_ordem,\n  DATE(dataVencimento) AS data_pagamento,\n  idConsorcio AS id_consorcio,\n  idOperadora AS id_operadora,\n  CONCAT(dataOrdem, idConsorcio, idOperadora) AS unique_id,\n  valorRealEfetivado AS valor_pago\nFROM\n  {{ ref(\"staging_arquivo_retorno\") }}\nWHERE\n  isPago = TRUE\n{% if is_incremental() %}\n  AND DATE(data) BETWEEN DATE(\"{{var('date_range_start')}}\") AND DATE(\"{{var('date_range_end')}}\")\n{% endif %}", "language": "sql", "refs": [{"name": "staging_arquivo_retorno", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.staging_arquivo_retorno"]}, "compiled_path": "target-base/compiled/rj_smtr/models/controle_financeiro/staging/aux_retorno_ordem_pagamento.sql", "compiled": true, "compiled_code": "\n\nSELECT DISTINCT\n  dataOrdem AS data_ordem,\n  DATE(dataVencimento) AS data_pagamento,\n  idConsorcio AS id_consorcio,\n  idOperadora AS id_operadora,\n  CONCAT(dataOrdem, idConsorcio, idOperadora) AS unique_id,\n  valorRealEfetivado AS valor_pago\nFROM\n  `rj-smtr`.`controle_financeiro_staging`.`arquivo_retorno`\nWHERE\n  isPago = TRUE\n\n  AND DATE(data) BETWEEN DATE(\"2022-01-01T00:00:00\") AND DATE(\"2022-01-01T01:00:00\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.staging_arquivo_retorno": {"database": "rj-smtr", "schema": "controle_financeiro_staging", "name": "staging_arquivo_retorno", "resource_type": "model", "package_name": "rj_smtr", "path": "controle_financeiro/staging/staging_arquivo_retorno.sql", "original_file_path": "models/controle_financeiro/staging/staging_arquivo_retorno.sql", "unique_id": "model.rj_smtr.staging_arquivo_retorno", "fqn": ["rj_smtr", "controle_financeiro", "staging", "staging_arquivo_retorno"], "alias": "arquivo_retorno", "checksum": {"name": "sha256", "checksum": "ced5f96e6ec48a07f394c4ed80ac749ea0393cd33cd42380b79275ab077c292d"}, "config": {"enabled": true, "alias": "arquivo_retorno", "schema": "controle_financeiro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View desaninhada para os dados capturados em rj-smtr-staging.controle_financeiro.arquivo_retorno", "columns": {"data": {"name": "data", "description": "Data da captura (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Data e hora da captura em GMT-3", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id": {"name": "id", "description": "Identificador \u00fanico do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataCaptura": {"name": "dataCaptura", "description": "Data da captura do sistema da CCT", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataHoraGeracaoRetorno": {"name": "dataHoraGeracaoRetorno", "description": "Data e hora da gera\u00e7\u00e3o do arquivo de retorno", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataOrdem": {"name": "dataOrdem", "description": "Data da ordem de pagamento da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataProcessamento": {"name": "dataProcessamento", "description": "Data de processamento do sistema da CCT", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dataVencimento": {"name": "dataVencimento", "description": "Data e hora do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "favorecido": {"name": "favorecido", "description": "Nome do favorecido do pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "idConsorcio": {"name": "idConsorcio", "description": "Identificador \u00fanico do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "idOperadora": {"name": "idOperadora", "description": "Identificador \u00fanico da operadora na tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "idOrdemPagamento": {"name": "idOrdemPagamento", "description": "Identificador \u00fanico da ordem de pagamento da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "isPago": {"name": "isPago", "description": "Indica se foi pago com sucesso", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nomeConsorcio": {"name": "nomeConsorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nomeOperadora": {"name": "nomeOperadora", "description": "Nome da operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ocorrencias": {"name": "ocorrencias", "description": "Lista de status retornado pelo pagamento", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor requisitado ao pagamento (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valorRealEfetivado": {"name": "valorRealEfetivado", "description": "Valor real pago (R$)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/controle_financeiro/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "controle_financeiro_staging", "alias": "arquivo_retorno"}, "created_at": 1727709588.6707635, "relation_name": "`rj-smtr`.`controle_financeiro_staging`.`arquivo_retorno`", "raw_code": "{{\n  config(\n    alias=\"arquivo_retorno\"\n  )\n}}\n\nSELECT\n  data,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  id,\n  DATE(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataCaptura') AS STRING))) AS dataCaptura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataHoraGeracaoRetorno') AS STRING)), \"America/Sao_Paulo\") AS dataHoraGeracaoRetorno,\n  DATE(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataOrdem') AS STRING))) AS dataOrdem,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataProcessamento') AS STRING)), \"America/Sao_Paulo\") AS dataProcessamento,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dataVencimento') AS STRING))) AS dataVencimento,\n  SAFE_CAST(JSON_VALUE(content, '$.favorecido') AS STRING) AS favorecido,\n  SAFE_CAST(JSON_VALUE(content, '$.idConsorcio') AS STRING) AS idConsorcio,\n  SAFE_CAST(JSON_VALUE(content, '$.idOperadora') AS STRING) AS idOperadora,\n  SAFE_CAST(JSON_VALUE(content, '$.idOrdemPagamento') AS STRING) AS idOrdemPagamento,\n  SAFE_CAST(JSON_VALUE(content, '$.isPago') AS BOOL) AS isPago,\n  SAFE_CAST(JSON_VALUE(content, '$.nomeConsorcio') AS STRING) AS nomeConsorcio,\n  SAFE_CAST(JSON_VALUE(content, '$.nomeOperadora') AS STRING) AS nomeOperadora,\n  JSON_VALUE(content, '$.ocorrencias') AS ocorrencias,\n  SAFE_CAST(JSON_VALUE(content, '$.valor') AS NUMERIC) AS valor,\n  SAFE_CAST(JSON_VALUE(content, '$.valorRealEfetivado') AS NUMERIC) AS valorRealEfetivado\nFROM\n  {{ source(\"controle_financeiro_staging\", \"arquivo_retorno\") }}", "language": "sql", "refs": [], "sources": [["controle_financeiro_staging", "arquivo_retorno"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.controle_financeiro_staging.arquivo_retorno"]}, "compiled_path": "target-base/compiled/rj_smtr/models/controle_financeiro/staging/staging_arquivo_retorno.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  data,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%d %H:%M:%S%Ez', timestamp_captura), \"America/Sao_Paulo\") AS timestamp_captura,\n  id,\n  DATE(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataCaptura') AS STRING))) AS dataCaptura,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataHoraGeracaoRetorno') AS STRING)), \"America/Sao_Paulo\") AS dataHoraGeracaoRetorno,\n  DATE(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataOrdem') AS STRING))) AS dataOrdem,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3SZ', SAFE_CAST(JSON_VALUE(content, '$.dataProcessamento') AS STRING)), \"America/Sao_Paulo\") AS dataProcessamento,\n  DATETIME(PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%E3S%Ez', SAFE_CAST(JSON_VALUE(content, '$.dataVencimento') AS STRING))) AS dataVencimento,\n  SAFE_CAST(JSON_VALUE(content, '$.favorecido') AS STRING) AS favorecido,\n  SAFE_CAST(JSON_VALUE(content, '$.idConsorcio') AS STRING) AS idConsorcio,\n  SAFE_CAST(JSON_VALUE(content, '$.idOperadora') AS STRING) AS idOperadora,\n  SAFE_CAST(JSON_VALUE(content, '$.idOrdemPagamento') AS STRING) AS idOrdemPagamento,\n  SAFE_CAST(JSON_VALUE(content, '$.isPago') AS BOOL) AS isPago,\n  SAFE_CAST(JSON_VALUE(content, '$.nomeConsorcio') AS STRING) AS nomeConsorcio,\n  SAFE_CAST(JSON_VALUE(content, '$.nomeOperadora') AS STRING) AS nomeOperadora,\n  JSON_VALUE(content, '$.ocorrencias') AS ocorrencias,\n  SAFE_CAST(JSON_VALUE(content, '$.valor') AS NUMERIC) AS valor,\n  SAFE_CAST(JSON_VALUE(content, '$.valorRealEfetivado') AS NUMERIC) AS valorRealEfetivado\nFROM\n  `rj-smtr-staging`.`controle_financeiro_staging`.`arquivo_retorno`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.rdo40_registros": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo", "name": "rdo40_registros", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo/rdo40_registros.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo/rdo40_registros.sql", "unique_id": "model.rj_smtr.rdo40_registros", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo", "rdo40_registros"], "alias": "rdo40_registros", "checksum": {"name": "sha256", "checksum": "a7ca2e09be36962f9bb25697e2c5bb1130330c0f8f758f4d60623fc160a8e064"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_rdo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados do Resumo Di\u00e1rio de Opera\u00e7\u00e3o com a quantidade total de passageiros.", "columns": {"data": {"name": "data", "description": "Data das transa\u00e7\u00f5es", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano das transa\u00e7\u00f5es", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas das transa\u00e7\u00f5es", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "dia": {"name": "dia", "description": "Dia das transa\u00e7\u00f5es", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio": {"name": "id_consorcio", "description": "Identificador do cons\u00f3rcio na tabela cadastro.consorcios", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio ao qual o servi\u00e7o pertence.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "N\u00famero da Linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_servico": {"name": "tipo_servico", "description": "Tipo de Servi\u00e7o da Linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ordem_servico": {"name": "ordem_servico", "description": "Ordem de Servi\u00e7o da Linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "codigo_veiculo": {"name": "codigo_veiculo", "description": "C\u00f3digo do Tipo de Ve\u00edculo do Servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tarifa_codigo": {"name": "tarifa_codigo", "description": "Tarifa determinada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tarifa_valor": {"name": "tarifa_valor", "description": "Tarifa Praticada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "frota_determinada": {"name": "frota_determinada", "description": "Frota Determinada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "frota_licenciada": {"name": "frota_licenciada", "description": "Frota Licenciada para a linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "frota_operante": {"name": "frota_operante", "description": "Frota Operacional do dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_viagens": {"name": "qtd_viagens", "description": "N\u00famero de Viagens da Linha no dia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_km_cobertos": {"name": "qtd_km_cobertos", "description": "Quilometragem Coberta", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_idoso": {"name": "qtd_grt_idoso", "description": "Gratuidades Transportadas - Idosos", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_especial": {"name": "qtd_grt_especial", "description": "Gratuidades Transportadas - Portadores de Necessidades Especiais", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_estud_federal": {"name": "qtd_grt_estud_federal", "description": "Gratuidades Transportadas - Estudantes da Uni\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_estud_estadual": {"name": "qtd_grt_estud_estadual", "description": "Gratuidades Transportadas - Estudantes do Estado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_estud_municipal": {"name": "qtd_grt_estud_municipal", "description": "Gratuidades Transportadas - Estudantes do Munic\u00edpio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_rodoviario": {"name": "qtd_grt_rodoviario", "description": "Gratuidades Transportadas - Funcion\u00e1rios das Empresas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_buc_1_perna": {"name": "qtd_buc_1_perna", "description": "Bilhete \u00fanico Carioca (1\u00aa Perna)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_buc_2_perna_integracao": {"name": "qtd_buc_2_perna_integracao", "description": "Bilhete \u00danico Carioca (2\u00aa Perna)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_buc": {"name": "receita_buc", "description": "Receita de Bilhete \u00danico Carioca", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_buc_supervia_1_perna": {"name": "qtd_buc_supervia_1_perna", "description": "Bilhete \u00fanico Carioca - Supervia (1\u00aa Perna)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_buc_supervia_2_perna_integracao": {"name": "qtd_buc_supervia_2_perna_integracao", "description": "Bilhete \u00danico Carioca - Supervia (2\u00aa Perna)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_buc_supervia": {"name": "receita_buc_supervia", "description": "Receita de Bilhete \u00danico Carioca - Supervia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_cartoes_perna_unica_e_demais": {"name": "qtd_cartoes_perna_unica_e_demais", "description": "Cart\u00f5es Perna \u00danica e demais transa\u00e7\u00f5es valoradas n\u00e3o contempladas nos campos deste RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_cartoes_perna_unica_e_demais": {"name": "receita_cartoes_perna_unica_e_demais", "description": "Receita Cart\u00f5es Perna \u00danica e Receita das demais transa\u00e7\u00f5es valoradas n\u00e3o contempladas nos campos deste RDO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_pagamentos_especie": {"name": "qtd_pagamentos_especie", "description": "Passageiros Pagantes em Esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_especie": {"name": "receita_especie", "description": "Receita Passageiros Pagantes em Esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_grt_passe_livre_universitario": {"name": "qtd_grt_passe_livre_universitario", "description": "Gratuidades Transportadas - Passe Livre Universit\u00e1rio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "class_servico": {"name": "class_servico", "description": "Classifica\u00e7\u00e3o do Servi\u00e7o: Diret\u00e3o, Esta\u00e7\u00e3o do BRT, Rodovi\u00e1rio, Troncal do BRT, Urbano.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "qtd_passageiros_total": {"name": "qtd_passageiros_total", "description": "Quantidade total de passageiros", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_rdo/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_rdo"}, "created_at": 1727709588.7726274, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`", "raw_code": "WITH\n  consorcios AS (\n  SELECT\n    id_consorcio,\n    case when id_consorcio = \"221000050\" then \"Cons\u00f3rcio BRT\" else consorcio end as consorcio\n  FROM\n    -- rj-smtr.cadastro.consorcios\n    {{ ref(\"consorcios\") }} )\nSELECT\n  data,\n  ano,\n  mes,\n  dia,\n  id_consorcio,\n  consorcio,\n  linha AS servico,\n  r.* EXCEPT(data,\n    ano,\n    mes,\n    dia,\n    termo),\n  (qtd_grt_idoso + qtd_grt_especial + qtd_grt_estud_federal + qtd_grt_estud_estadual + qtd_grt_estud_municipal + qtd_grt_rodoviario + qtd_buc_1_perna + qtd_buc_2_perna_integracao + qtd_buc_supervia_1_perna + qtd_buc_supervia_2_perna_integracao + qtd_cartoes_perna_unica_e_demais + qtd_pagamentos_especie + qtd_grt_passe_livre_universitario) AS qtd_passageiros_total\nFROM\n  {{ source(\"br_rj_riodejaneiro_rdo\", \"rdo40_tratado\") }} r\nLEFT JOIN\n  consorcios c\nON\n  r.termo = c.id_consorcio", "language": "sql", "refs": [{"name": "consorcios", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_rdo", "rdo40_tratado"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo/rdo40_registros.sql", "compiled": true, "compiled_code": "WITH\n  consorcios AS (\n  SELECT\n    id_consorcio,\n    case when id_consorcio = \"221000050\" then \"Cons\u00f3rcio BRT\" else consorcio end as consorcio\n  FROM\n    -- rj-smtr.cadastro.consorcios\n    `rj-smtr`.`cadastro`.`consorcios` )\nSELECT\n  data,\n  ano,\n  mes,\n  dia,\n  id_consorcio,\n  consorcio,\n  linha AS servico,\n  r.* EXCEPT(data,\n    ano,\n    mes,\n    dia,\n    termo),\n  (qtd_grt_idoso + qtd_grt_especial + qtd_grt_estud_federal + qtd_grt_estud_estadual + qtd_grt_estud_municipal + qtd_grt_rodoviario + qtd_buc_1_perna + qtd_buc_2_perna_integracao + qtd_buc_supervia_1_perna + qtd_buc_supervia_2_perna_integracao + qtd_cartoes_perna_unica_e_demais + qtd_pagamentos_especie + qtd_grt_passe_livre_universitario) AS qtd_passageiros_total\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_tratado` r\nLEFT JOIN\n  consorcios c\nON\n  r.termo = c.id_consorcio", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.rho_registros_sppo": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo", "name": "rho_registros_sppo", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo/rho_registros_sppo.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo/rho_registros_sppo.sql", "unique_id": "model.rj_smtr.rho_registros_sppo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo", "rho_registros_sppo"], "alias": "rho_registros_sppo", "checksum": {"name": "sha256", "checksum": "708f0065ae008fb2bee79ff0707cd739eb0b736cf2e95348384af97b15973264"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_rdo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela materializada para acesso geral aos dados do RHO SPPO", "columns": {"data_transacao": {"name": "data_transacao", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora_transacao": {"name": "hora_transacao", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_processamento": {"name": "data_processamento", "description": "Data de processamento da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_arquivo_rho": {"name": "data_arquivo_rho", "description": "Data do arquivo fonte do RHO", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_riocard": {"name": "servico_riocard", "description": "Nome curto da linha de acordo com o padr\u00e3o do RioCard", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha_riocard": {"name": "linha_riocard", "description": "Identificador interno da linha no RioCard", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Identificador da operadora de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_cartao": {"name": "quantidade_transacao_cartao", "description": "Quantidade de transa\u00e7\u00f5es feitas com o cart\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_especie": {"name": "quantidade_transacao_especie", "description": "Quantidade de transa\u00e7\u00f5es feitas em esp\u00e9cie", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de gratuidades", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "registro_processado": {"name": "registro_processado", "description": "Identificador se o registro foi recalculado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_captura": {"name": "datetime_captura", "description": "Data e hora da captura dos dados", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_rdo/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_rdo", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}, "incremental_strategy": "insert_overwrite"}, "created_at": 1727709588.761431, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo`.`rho_registros_sppo`", "raw_code": "{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data_transacao\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      },\n      incremental_strategy=\"insert_overwrite\"\n  )\n}}\n\n{% set staging_table = ref('staging_rho_registros_sppo') %}\n{% if execute %}\n    {% if is_incremental() %}\n        {% set partitions_query %}\n            SELECT DISTINCT\n                CONCAT(\"'\", data_transacao, \"'\")\n            FROM\n                {{ staging_table }}\n            WHERE\n                ano BETWEEN\n                    EXTRACT(YEAR FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(YEAR FROM DATE(\"{{ var('date_range_end') }}\"))\n                AND mes BETWEEN\n                    EXTRACT(MONTH FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(MONTH FROM DATE(\"{{ var('date_range_end') }}\"))\n                AND dia BETWEEN\n                    EXTRACT(DAY FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(DAY FROM DATE(\"{{ var('date_range_end') }}\"))\n        {% endset %}\n\n        {% set partitions = run_query(partitions_query) %}\n\n        {% set partition_list = partitions.columns[0].values() %}\n    {% endif %}\n{% endif %}\n\nWITH rho_new AS (\n    SELECT\n        data_transacao,\n        hora_transacao,\n        data_processamento,\n        data_particao AS data_arquivo_rho,\n        linha AS servico_riocard,\n        linha_rcti AS linha_riocard,\n        operadora,\n        total_pagantes_cartao AS quantidade_transacao_cartao,\n        total_pagantes_especie AS quantidade_transacao_especie,\n        total_gratuidades AS quantidade_transacao_gratuidade,\n        registro_processado,\n        timestamp_captura AS datetime_captura\n    FROM\n        {{ staging_table }}\n    {% if is_incremental() %}\n        WHERE\n            ano BETWEEN\n                EXTRACT(YEAR FROM DATE(\"{{ var('date_range_start') }}\"))\n                AND EXTRACT(YEAR FROM DATE(\"{{ var('date_range_end') }}\"))\n            AND mes BETWEEN\n                EXTRACT(MONTH FROM DATE(\"{{ var('date_range_start') }}\"))\n                AND EXTRACT(MONTH FROM DATE(\"{{ var('date_range_end') }}\"))\n            AND dia BETWEEN\n                EXTRACT(DAY FROM DATE(\"{{ var('date_range_start') }}\"))\n                AND EXTRACT(DAY FROM DATE(\"{{ var('date_range_end') }}\"))\n    {% endif %}\n),\nrho_complete_partitions AS (\n    SELECT\n        *\n    FROM\n        rho_new\n\n    {% if is_incremental() and partition_list|length > 0 %}\n\n        UNION ALL\n\n        SELECT\n            *\n        FROM\n            {{ this }}\n        WHERE\n            data_transacao IN ({{ partition_list|join(', ') }})\n\n    {% endif %}\n),\n-- Deduplica os dados com base na data e hora da transacao, linha, linha_rcti e operadora\nrho_rn AS (\n    SELECT\n        *,\n        ROW_NUMBER() OVER(\n            PARTITION BY\n                data_transacao,\n                hora_transacao,\n                data_arquivo_rho,\n                servico_riocard,\n                linha_riocard,\n                operadora\n            ORDER BY\n                datetime_captura DESC\n        ) AS rn\n    FROM\n        rho_complete_partitions\n)\nSELECT\n    * EXCEPT(rn)\nFROM\n    rho_rn\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "staging_rho_registros_sppo", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.staging_rho_registros_sppo"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo/rho_registros_sppo.sql", "compiled": true, "compiled_code": "\n\n\n\n    \n        \n\n        \n\n        \n    \n\n\nWITH rho_new AS (\n    SELECT\n        data_transacao,\n        hora_transacao,\n        data_processamento,\n        data_particao AS data_arquivo_rho,\n        linha AS servico_riocard,\n        linha_rcti AS linha_riocard,\n        operadora,\n        total_pagantes_cartao AS quantidade_transacao_cartao,\n        total_pagantes_especie AS quantidade_transacao_especie,\n        total_gratuidades AS quantidade_transacao_gratuidade,\n        registro_processado,\n        timestamp_captura AS datetime_captura\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_sppo`\n    \n        WHERE\n            ano BETWEEN\n                EXTRACT(YEAR FROM DATE(\"2022-01-01T00:00:00\"))\n                AND EXTRACT(YEAR FROM DATE(\"2022-01-01T01:00:00\"))\n            AND mes BETWEEN\n                EXTRACT(MONTH FROM DATE(\"2022-01-01T00:00:00\"))\n                AND EXTRACT(MONTH FROM DATE(\"2022-01-01T01:00:00\"))\n            AND dia BETWEEN\n                EXTRACT(DAY FROM DATE(\"2022-01-01T00:00:00\"))\n                AND EXTRACT(DAY FROM DATE(\"2022-01-01T01:00:00\"))\n    \n),\nrho_complete_partitions AS (\n    SELECT\n        *\n    FROM\n        rho_new\n\n    \n),\n-- Deduplica os dados com base na data e hora da transacao, linha, linha_rcti e operadora\nrho_rn AS (\n    SELECT\n        *,\n        ROW_NUMBER() OVER(\n            PARTITION BY\n                data_transacao,\n                hora_transacao,\n                data_arquivo_rho,\n                servico_riocard,\n                linha_riocard,\n                operadora\n            ORDER BY\n                datetime_captura DESC\n        ) AS rn\n    FROM\n        rho_complete_partitions\n)\nSELECT\n    * EXCEPT(rn)\nFROM\n    rho_rn\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.rho_registros_stpl": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo", "name": "rho_registros_stpl", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_rdo/rho_registros_stpl.sql", "original_file_path": "models/br_rj_riodejaneiro_rdo/rho_registros_stpl.sql", "unique_id": "model.rj_smtr.rho_registros_stpl", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo", "rho_registros_stpl"], "alias": "rho_registros_stpl", "checksum": {"name": "sha256", "checksum": "20894d327ce17e34c14cc039d511b11df3427a442e6a9e303747d3c46c3b9480"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_rdo", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela materializada para acesso geral aos dados do RHO STPL", "columns": {"data_transacao": {"name": "data_transacao", "description": "Data da transa\u00e7\u00e3o (parti\u00e7\u00e3o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora_transacao": {"name": "hora_transacao", "description": "Hora da transa\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_riocard": {"name": "servico_riocard", "description": "Nome curto da linha de acordo com o padr\u00e3o do RioCard", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Identificador da operadora de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_pagante": {"name": "quantidade_transacao_pagante", "description": "Quantidade de transa\u00e7\u00f5es pagantes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_transacao_gratuidade": {"name": "quantidade_transacao_gratuidade", "description": "Quantidade de gratuidades", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "arquivos_somados": {"name": "arquivos_somados", "description": "Coluna de controle com array das datas dos arquivos que foram somados para obter os valores finais", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_rdo/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_rdo", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data_transacao", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.7626722, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo`.`rho_registros_stpl`", "raw_code": "{{\n  config(\n    materialized='incremental',\n    incremental_strategy=\"insert_overwrite\",\n    partition_by={\n        \"field\":\"data_transacao\",\n        \"data_type\": \"date\",\n        \"granularity\":\"day\"\n    },\n  )\n}}\n\n{% set staging_table = ref('staging_rho_registros_stpl') %}\n{% if execute %}\n    {% if is_incremental() %}\n        {% set partitions_query %}\n            SELECT DISTINCT\n                CONCAT(\"'\", data_transacao, \"'\")\n            FROM\n                {{ staging_table }}\n            WHERE\n                ano BETWEEN\n                    EXTRACT(YEAR FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(YEAR FROM DATE(\"{{ var('date_range_end') }}\"))\n                AND mes BETWEEN\n                    EXTRACT(MONTH FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(MONTH FROM DATE(\"{{ var('date_range_end') }}\"))\n                AND dia BETWEEN\n                    EXTRACT(DAY FROM DATE(\"{{ var('date_range_start') }}\"))\n                    AND EXTRACT(DAY FROM DATE(\"{{ var('date_range_end') }}\"))\n        {% endset %}\n\n        {% set partitions = run_query(partitions_query) %}\n\n        {% set partition_list = partitions.columns[0].values() %}\n    {% endif %}\n{% endif %}\n\nSELECT\n    data_transacao,\n    hora_transacao,\n    servico_riocard,\n    operadora,\n    SUM(quantidade_transacao_pagante) AS quantidade_transacao_pagante,\n    SUM(quantidade_transacao_gratuidade) AS quantidade_transacao_gratuidade\nFROM\n    {{ ref('rho_registros_stpl_aux') }}\n{% if is_incremental() %}\n    WHERE\n        data_transacao\n        {% if partition_list|length > 0 %}\n            IN ({{ partition_list|join(', ') }})\n        {% else %}\n            = \"2000-01-01\"\n        {% endif %}\n{% endif %}\nGROUP BY\n    1,\n    2,\n    3,\n    4", "language": "sql", "refs": [{"name": "staging_rho_registros_stpl", "package": null, "version": null}, {"name": "rho_registros_stpl_aux", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.staging_rho_registros_stpl", "model.rj_smtr.rho_registros_stpl_aux"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_rdo/rho_registros_stpl.sql", "compiled": true, "compiled_code": "\n\n\n\n    \n        \n\n        \n\n        \n    \n\n\nSELECT\n    data_transacao,\n    hora_transacao,\n    servico_riocard,\n    operadora,\n    SUM(quantidade_transacao_pagante) AS quantidade_transacao_pagante,\n    SUM(quantidade_transacao_gratuidade) AS quantidade_transacao_gratuidade\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_stpl_aux`\n\n    WHERE\n        data_transacao\n        \n            IN ('2021-12-31', '2022-01-01', '2021-12-29', '2021-12-30', '2021-12-28', '2021-12-22', '2021-12-23', '2021-12-24', '2021-12-26', '2021-12-27')\n        \n\nGROUP BY\n    1,\n    2,\n    3,\n    4", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_aux_registros_flag_trajeto_correto", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_flag_trajeto_correto.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_flag_trajeto_correto.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_aux_registros_flag_trajeto_correto"], "alias": "sppo_aux_registros_flag_trajeto_correto", "checksum": {"name": "sha256", "checksum": "78720e7d07e480c994fb272e74c914c86aca4de4c1078c8e2617301f87f7cf0b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela para verifica\u00e7\u00e3o se o ve\u00edculo est\u00e1 dentro do trajeto correto", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha_gtfs": {"name": "linha_gtfs", "description": "Linha de \u00f4nibus (servi\u00e7o) da tabela 'shapes_geom'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "C\u00f3digo identificador na rota da tabela 'shapes_geom'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto": {"name": "flag_trajeto_correto", "description": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "description": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "description": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps"}, "created_at": 1727709588.774279, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      {{ ref('sppo_aux_registros_filtrada') }} r\n    {% if not flags.FULL_REFRESH -%}\n    WHERE\n      data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n  ),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, {{ var('tamanho_buffer_metros') }}) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN {{ var('intervalo_max_desvio_segundos') }} PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM {{ ref('shapes_geom') }}\n      WHERE id_modal_smtr in ({{ var('sppo_id_modal_smtr')|join(', ') }})\n      AND data_versao = \"{{ var('versao_fixa_sigmob')}}\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada", "package": null, "version": null}, {"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_flag_trajeto_correto.sql", "compiled": true, "compiled_code": "\n\n/*\nDescri\u00e7\u00e3o:\nCalcula se o ve\u00edculo est\u00e1 dentro do trajeto correto dado o tra\u00e7ado (shape) cadastrado no SIGMOB em rela\u00e7\u00e3o \u00e0 linha que est\u00e1 sendo\ntransmitida.\n1. Calcula as intersec\u00e7\u00f5es definindo um 'buffer', utilizado por st_dwithin para identificar se o ponto est\u00e1 \u00e0 uma\ndist\u00e2ncia menor ou igual ao tamanho do buffer em rela\u00e7\u00e3o ao tra\u00e7ado definido no SIGMOB.\n2. Calcula um hist\u00f3rico de intersec\u00e7\u00f5es nos ultimos 10 minutos de registros de cada carro. Definimos que o carro \u00e9\nconsiderado fora do trajeto definido se a cada 10 minutos, ele n\u00e3o esteve dentro do tra\u00e7ado planejado pelo menos uma\nvez.\n3. Identifica se a linha informada no registro capturado existe nas defini\u00e7\u00f5es presentes no SIGMOB.\n4. Definimos em outra tabela uma 'data_versao_efetiva', esse passo serve tanto para definir qual vers\u00e3o do SIGMOB utilizaremos em\ncaso de falha na captura, quanto para definir qual vers\u00e3o ser\u00e1 utilizada para o c\u00e1lculo retroativo do hist\u00f3rico de registros que temos.\n5. Como n\u00e3o conseguimos identificar o itiner\u00e1rio que o carro est\u00e1 realizando, no passo counts, os resultados de\nintersec\u00e7\u00f5es s\u00e3o dobrados, devido ao fato de cada linha apresentar dois itiner\u00e1rios poss\u00edveis (ida/volta). Portanto,\nao final, realizamos uma agrega\u00e7\u00e3o LOGICAL_OR que \u00e9 true caso o carro esteja dentro do tra\u00e7ado de algum dos itiner\u00e1rios\nposs\u00edveis para a linha informada.\n*/\nWITH\n  registros AS (\n    SELECT\n      id_veiculo,\n      linha,\n      latitude,\n      longitude,\n      data,\n      posicao_veiculo_geo,\n      timestamp_gps\n    FROM\n      `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada` r\n    WHERE\n      data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n  intersec AS (\n    SELECT\n      r.*,\n      s.data_versao,\n      s.linha_gtfs,\n      s.route_id,\n      -- 1. Buffer e intersec\u00e7\u00f5es\n      CASE\n        WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN TRUE\n        ELSE FALSE\n      END AS flag_trajeto_correto,\n      -- 2. Hist\u00f3rico de intersec\u00e7\u00f5es nos \u00faltimos 10 minutos a partir da timestamp_gps atual\n      CASE\n        WHEN\n          COUNT(CASE WHEN st_dwithin(shape, posicao_veiculo_geo, 500) THEN 1 END)\n          OVER (PARTITION BY id_veiculo\n                ORDER BY UNIX_SECONDS(TIMESTAMP(timestamp_gps))\n                RANGE BETWEEN 600 PRECEDING AND CURRENT ROW) >= 1\n          THEN True\n        ELSE False\n      END AS flag_trajeto_correto_hist,\n      -- 3. Identifica\u00e7\u00e3o de cadastro da linha no SIGMOB\n      CASE WHEN s.linha_gtfs IS NULL THEN False ELSE True END AS flag_linha_existe_sigmob,\n    -- 4. Join com data_versao_efetiva para defini\u00e7\u00e3o de quais shapes ser\u00e3o considerados no c\u00e1lculo das flags\n    FROM registros r\n    LEFT JOIN (\n      SELECT *\n      FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n      WHERE id_modal_smtr in ('22', '23', 'O')\n      AND data_versao = \"2022-06-10\"\n    ) s\n    ON\n      r.linha = s.linha_gtfs\n  )\n    -- 5. Agrega\u00e7\u00e3o com LOGICAL_OR para evitar duplica\u00e7\u00e3o de registros\n    SELECT\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      timestamp_gps,\n      LOGICAL_OR(flag_trajeto_correto) AS flag_trajeto_correto,\n      LOGICAL_OR(flag_trajeto_correto_hist) AS flag_trajeto_correto_hist,\n      LOGICAL_OR(flag_linha_existe_sigmob) AS flag_linha_existe_sigmob,\n    FROM intersec i\n    GROUP BY\n      id_veiculo,\n      linha,\n      linha_gtfs,\n      route_id,\n      data,\n      data_versao,\n      timestamp_gps", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_realocacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_aux_registros_realocacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_realocacao.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_realocacao.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_realocacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_aux_registros_realocacao"], "alias": "sppo_aux_registros_realocacao", "checksum": {"name": "sha256", "checksum": "30d47df88c3b8a2d1ba988033ab3728125c8a4a4cb4aea5abc230dfcf3d8ebc1"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com realoca\u00e7\u00f5es de linha v\u00e1lidas.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_gps": {"name": "servico_gps", "description": "Linha de \u00f4nibus (servi\u00e7o) informado pelo GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_realocado": {"name": "servico_realocado", "description": "Linha de \u00f4nibus (servi\u00e7o) realocada informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_realocacao": {"name": "datetime_realocacao", "description": "Datetime_realocacao que o registro da realoca\u00e7\u00e3o foi informado pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_onibus_gps", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.7755797, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_realocacao`", "raw_code": "{% if var(\"fifteen_minutes\") == \"_15_minutos\" %}\n{{\n  config(\n      materialized='ephemeral',\n  )\n}}\n{% else %}\n{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      }\n  )\n}}\n{% endif %}\n\n-- 1. Filtra realoca\u00e7\u00f5es v\u00e1lidas dentro do intervalo de GPS avaliado\nwith realocacao as (\n  select\n    * except(datetime_saida),\n    case\n      when datetime_saida is null then datetime_operacao\n      else datetime_saida\n    end as datetime_saida,\n  from\n    {{ ref('sppo_realocacao') }}\n  where\n    -- Realoca\u00e7\u00e3o deve acontecer ap\u00f3s o registro de GPS e at\u00e9 1 hora depois\n    datetime_diff(datetime_operacao, datetime_entrada, minute) between 0 and 60\n    and data between DATE(\"{{var('date_range_start')}}\")\n    and DATE(datetime_add(\"{{var('date_range_end')}}\", interval 1 hour))\n    {% if is_incremental() -%}\n    and datetime_operacao between datetime(\"{{var('date_range_start')}}\")\n    and datetime_add(\"{{var('date_range_end')}}\", interval 1 hour)\n    {%- endif -%}\n),\n-- 2. Altera registros de GPS com servicos realocados\ngps as (\n  select\n    ordem,\n    timestamp_gps,\n    linha,\n    data,\n    hora\n  from {{ ref('sppo_registros') }}\n  where\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    and timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <= \"{{var('date_range_end')}}\"\n),\ncombinacao as (\n  select\n    r.id_veiculo,\n    g.timestamp_gps,\n    g.linha as servico_gps,\n    r.servico as servico_realocado,\n    r.datetime_operacao as datetime_realocacao,\n    g.data,\n    g.hora\n  from gps g\n  inner join realocacao r\n  on\n    g.ordem = r.id_veiculo\n    and g.linha != r.servico\n    and g.timestamp_gps between r.datetime_entrada and r.datetime_saida\n)\n-- Filtra realocacao mais recente para cada timestamp\nselect\n  * except(rn)\nfrom (\n  select\n    *,\n    row_number() over (partition by id_veiculo, timestamp_gps order by datetime_realocacao desc) as rn\n  from combinacao\n)\nwhere rn = 1", "language": "sql", "refs": [{"name": "sppo_realocacao", "package": null, "version": null}, {"name": "sppo_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_realocacao", "model.rj_smtr.sppo_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_realocacao.sql", "compiled": true, "compiled_code": "\n\n\n\n-- 1. Filtra realoca\u00e7\u00f5es v\u00e1lidas dentro do intervalo de GPS avaliado\nwith realocacao as (\n  select\n    * except(datetime_saida),\n    case\n      when datetime_saida is null then datetime_operacao\n      else datetime_saida\n    end as datetime_saida,\n  from\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_realocacao`\n  where\n    -- Realoca\u00e7\u00e3o deve acontecer ap\u00f3s o registro de GPS e at\u00e9 1 hora depois\n    datetime_diff(datetime_operacao, datetime_entrada, minute) between 0 and 60\n    and data between DATE(\"2022-01-01T00:00:00\")\n    and DATE(datetime_add(\"2022-01-01T01:00:00\", interval 1 hour))\n    and datetime_operacao between datetime(\"2022-01-01T00:00:00\")\n    and datetime_add(\"2022-01-01T01:00:00\", interval 1 hour)),\n-- 2. Altera registros de GPS com servicos realocados\ngps as (\n  select\n    ordem,\n    timestamp_gps,\n    linha,\n    data,\n    hora\n  from `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_registros`\n  where\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    and timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <= \"2022-01-01T01:00:00\"\n),\ncombinacao as (\n  select\n    r.id_veiculo,\n    g.timestamp_gps,\n    g.linha as servico_gps,\n    r.servico as servico_realocado,\n    r.datetime_operacao as datetime_realocacao,\n    g.data,\n    g.hora\n  from gps g\n  inner join realocacao r\n  on\n    g.ordem = r.id_veiculo\n    and g.linha != r.servico\n    and g.timestamp_gps between r.datetime_entrada and r.datetime_saida\n)\n-- Filtra realocacao mais recente para cada timestamp\nselect\n  * except(rn)\nfrom (\n  select\n    *,\n    row_number() over (partition by id_veiculo, timestamp_gps order by datetime_realocacao desc) as rn\n  from combinacao\n)\nwhere rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_velocidade": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_aux_registros_velocidade", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_velocidade.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_velocidade.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_velocidade", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_aux_registros_velocidade"], "alias": "sppo_aux_registros_velocidade", "checksum": {"name": "sha256", "checksum": "c5fcabafdd5a83755ecd3114131b274981aeb0b88da8c3c0f8bac868484e2ca0"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com estimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos", "columns": {"timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia": {"name": "distancia", "description": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "flag_em_movimento": {"name": "flag_em_movimento", "description": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps"}, "created_at": 1727709588.7762463, "relation_name": null, "raw_code": "{{\n    config(\n        materialized='ephemeral'\n    )\n}}\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  {{ ref(\"sppo_aux_registros_filtrada\") }}\n    {%if not flags.FULL_REFRESH -%}\n    WHERE\n        data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n    {%- endif -%}\n    ),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN {{ var('janela_movel_velocidade') }} PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > {{ var('velocidade_maxima') }}\n            THEN {{ var('velocidade_maxima') }}\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < {{ var('velocidade_limiar_parado') }} then false\n        else true\n    end flag_em_movimento,\nFROM medias", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_velocidade.sql", "compiled": true, "compiled_code": "\n/*\nDescri\u00e7\u00e3o:\nEstimativa das velocidades dos ve\u00edculos nos \u00faltimos 10 minutos contados a partir da timestamp_gps atual.\nEssa metodologia serve para determinar quais carros est\u00e3o em movimento e quais est\u00e3o parados.\n1. Calculamos a velocidade do ve\u00edculo no \u00faltimo trecho de 10 minutos de opera\u00e7\u00e3o.\nA implementa\u00e7\u00e3o utiliza a fun\u00e7\u00e3o 'first_value' com uma janela (cl\u00e1usula 'over') de at\u00e9 10 minutos anteriores \u00e0\ntimestamp_gps atual e calcula a dist\u00e2ncia do ponto mais antigo (o first_value na janela) ao ponto atual (posicao_veiculo_geo).\nDividimos essa dist\u00e2ncia pela diferen\u00e7a de tempo entre a timestamp_gps atual e a timestamp_gps do ponto mais\nantigo da janela (o qual recuperamos novamente com o uso de first_value).\nEsta diferen\u00e7a de tempo (datetime_diff) \u00e9 calculada em segundos, portanto multiplicamos o resultado da divis\u00e3o por um fator\n3.6 para que a velocidade esteja em quil\u00f4metros por hora. O resultado final \u00e9 arrendondado sem casas decimais.\nPor fim, cobrimos esse c\u00e1lculo com a fun\u00e7\u00e3o 'if_null' e retornamos zero para a velocidade em casos onde a divis\u00e3o retornaria\num valor nulo.\n2. Ap\u00f3s o calculo da velocidade, definimos a coluna 'status_movimento'. Ve\u00edculos abaixo da 'velocidade_limiar_parado', s\u00e3o\nconsiderados como 'parado'. Caso contr\u00e1rio, s\u00e3o considerados 'andando'\n*/\nwith\n    t_velocidade as (\n    select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n        ) distancia,\n        IFNULL(\n            SAFE_DIVIDE(\n                ST_DISTANCE(\n                posicao_veiculo_geo,\n                lag(posicao_veiculo_geo) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps)\n                ),\n                DATETIME_DIFF(\n                timestamp_gps,\n                lag(timestamp_gps) over (\n                partition by id_veiculo, linha\n                order by timestamp_gps),\n                SECOND\n                )),\n            0\n        ) * 3.6 velocidade\n    FROM  `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n    WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n    AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\n    medias as (\n        select\n        data,\n        id_veiculo,\n        timestamp_gps,\n        linha,\n        distancia,\n        velocidade, # velocidade do pontual\n        AVG(velocidade) OVER (\n            PARTITION BY id_veiculo, linha\n            ORDER BY unix_seconds(timestamp(timestamp_gps))\n            RANGE BETWEEN 600 PRECEDING AND CURRENT ROW\n        ) velocidade_media # velocidade com m\u00e9dia m\u00f3vel\n    from t_velocidade\n    )\nSELECT\n    timestamp_gps,\n    data,\n    id_veiculo,\n    linha,\n    distancia,\n    ROUND(\n        CASE WHEN velocidade_media > 60\n            THEN 60\n            ELSE velocidade_media\n        END,\n        1) as velocidade,\n    -- 2. Determina\u00e7\u00e3o do estado de movimento do ve\u00edculo.\n    case\n        when velocidade_media < 3 then false\n        else true\n    end flag_em_movimento,\nFROM medias", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_parada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_aux_registros_parada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_parada.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_parada.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_parada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_aux_registros_parada"], "alias": "sppo_aux_registros_parada", "checksum": {"name": "sha256", "checksum": "993221d409ff4653a3148a7c1ac0ee4e08c2aa606bf6a172307302e6c01dece4"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela para identifica\u00e7\u00e3o de ve\u00edculos parados em terminais ou garagens conhecidas.", "columns": {"data": {"name": "data", "description": "Data de parti\u00e7\u00e3o, conforme 'timestamp_captura' da tabela 'sppo_registros'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_parada": {"name": "tipo_parada", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "schema": "br_rj_riodejaneiro_onibus_gps"}, "created_at": 1727709588.7749124, "relation_name": null, "raw_code": "{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from {{ var('sppo_terminais') }}\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM {{ var('polygon_garagem') }}\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        {{ ref('sppo_aux_registros_filtrada') }}\n      {%if not flags.FULL_REFRESH %}\n      WHERE\n        data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n      AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n      {% endif %}\n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < {{ var('distancia_limiar_parada') }} then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "language": "sql", "refs": [{"name": "sppo_aux_registros_filtrada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.sppo_aux_registros_filtrada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_parada.sql", "compiled": true, "compiled_code": "\n\n/*\nDescri\u00e7\u00e3o:\nIdentifica ve\u00edculos parados em terminais ou garagens conhecidas.\n1. Selecionamos os terminais conhecidos e uma geometria do tipo pol\u00edgono (Polygon) que cont\u00e9m buracos nas\nlocaliza\u00e7\u00f5es das garagens.\n2. Calculamos as dist\u00e2ncias do ve\u00edculos em rela\u00e7\u00e3o aos terminais conhecidos. Definimos aqui a coluna 'nrow',\nque identifica qual o terminal que est\u00e1 mais pr\u00f3ximo do ponto informado. No passo final, recuperamos apenas\nos dados com nrow = 1 (menor dist\u00e2ncia em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o do ve\u00edculo)\n3. Definimos uma distancia_limiar_parada. Caso o ve\u00edculo esteja a uma dist\u00e2ncia menor que este valor de uma\nparada, ser\u00e1 considerado como parado no terminal com menor distancia.\n4. Caso o veiculo n\u00e3o esteja intersectando o pol\u00edgono das garagens, ele ser\u00e1 considerado como parado dentro\nde uma garagem (o pol\u00edgono \u00e9 vazado nas garagens, a n\u00e3o intersec\u00e7\u00e3o implica em estar dentro de um dos 'buracos').\n*/\nWITH\n  terminais as (\n    -- 1. Selecionamos terminais, criando uma geometria de ponto para cada.\n    select\n      ST_GEOGPOINT(longitude, latitude) ponto_parada, nome_terminal nome_parada, 'terminal' tipo_parada\n    from rj-smtr.br_rj_riodejaneiro_transporte.terminais_onibus_coordenadas\n  ),\n  garagem_polygon AS (\n    -- 1. Selecionamos o pol\u00edgono das garagens.\n    SELECT  ST_GEOGFROMTEXT(WKT,make_valid => true) AS poly\n    FROM rj-smtr.br_rj_riodejaneiro_geo.garagens_polygon\n  ),\n  distancia AS (\n    --2. Calculamos as dist\u00e2ncias e definimos nrow\n    SELECT\n      id_veiculo,\n      timestamp_gps,\n      data,\n      linha,\n      posicao_veiculo_geo,\n      nome_parada,\n      tipo_parada,\n      ROUND(ST_DISTANCE(posicao_veiculo_geo, ponto_parada), 1) distancia_parada,\n      ROW_NUMBER() OVER (PARTITION BY timestamp_gps, id_veiculo, linha ORDER BY ST_DISTANCE(posicao_veiculo_geo, ponto_parada)) nrow\n    FROM terminais p\n    JOIN (\n      SELECT\n        id_veiculo,\n        timestamp_gps,\n        data,\n        linha,\n        posicao_veiculo_geo\n      FROM\n        `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`\n      \n      WHERE\n        data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n      AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"\n      \n  ) r\n    on 1=1\n  )\nSELECT\n  data,\n  id_veiculo,\n  timestamp_gps,\n  linha,\n  /*\n  3. e 4. Identificamos o status do ve\u00edculo como 'terminal', 'garagem' (para os ve\u00edculos parados) ou\n  null (para os ve\u00edculos mais distantes de uma parada que o limiar definido)\n  */\n  case\n    when distancia_parada < 250 then tipo_parada\n    when not ST_INTERSECTS(posicao_veiculo_geo, (SELECT  poly FROM garagem_polygon)) then 'garagem'\n    else null\n  end tipo_parada,\nFROM distancia\nWHERE nrow = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_realocacao": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_realocacao", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_realocacao.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_realocacao.sql", "unique_id": "model.rj_smtr.sppo_realocacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_realocacao"], "alias": "sppo_realocacao", "checksum": {"name": "sha256", "checksum": "aa06608369775b719008ce45576248a4bc537a825bf4e66693bca0fa84bb57a8"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com todas as realoca\u00e7\u00f5es de linha informadas.", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_operacao": {"name": "datetime_operacao", "description": "Datetime que o registro da realoca\u00e7\u00e3o foi informado pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Linha de \u00f4nibus (servi\u00e7o) realocada informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_entrada": {"name": "datetime_entrada", "description": "Datetime de entrada do ve\u00edculo na linha realocada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_saida": {"name": "datetime_saida", "description": "Datetime de sa\u00edda do ve\u00edculo na linha realocada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_processamento": {"name": "timestamp_processamento", "description": "Timestamp de processamento da realoca\u00e7\u00e3o pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do registro de realoca\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_onibus_gps"}, "created_at": 1727709588.777105, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_realocacao`", "raw_code": "SELECT\n  SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_operacao), \"America/Sao_Paulo\") AS DATETIME) datetime_operacao,\n  concat(\n    ifnull(REGEXP_EXTRACT(servico, r'[A-Z]+'), \"\"),\n    ifnull(REGEXP_EXTRACT(servico, r'[0-9]+'), \"\")\n  ) as servico,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_entrada), \"America/Sao_Paulo\") AS DATETIME) as datetime_entrada,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_saida), \"America/Sao_Paulo\") AS DATETIME) as datetime_saida,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_processamento), \"America/Sao_Paulo\") AS DATETIME) as timestamp_processamento,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) as timestamp_captura,\n  data,\n  hora\nFROM\n  {{var('sppo_realocacao_staging')}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_realocacao.sql", "compiled": true, "compiled_code": "SELECT\n  SAFE_CAST(id_veiculo AS STRING) id_veiculo,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_operacao), \"America/Sao_Paulo\") AS DATETIME) datetime_operacao,\n  concat(\n    ifnull(REGEXP_EXTRACT(servico, r'[A-Z]+'), \"\"),\n    ifnull(REGEXP_EXTRACT(servico, r'[0-9]+'), \"\")\n  ) as servico,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_entrada), \"America/Sao_Paulo\") AS DATETIME) as datetime_entrada,\n  SAFE_CAST(DATETIME(TIMESTAMP(datetime_saida), \"America/Sao_Paulo\") AS DATETIME) as datetime_saida,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_processamento), \"America/Sao_Paulo\") AS DATETIME) as timestamp_processamento,\n  SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) as timestamp_captura,\n  data,\n  hora\nFROM\n  rj-smtr-staging.br_rj_riodejaneiro_onibus_gps_staging.realocacao as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_registros": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_registros", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_registros.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_registros.sql", "unique_id": "model.rj_smtr.sppo_registros", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_registros"], "alias": "sppo_registros", "checksum": {"name": "sha256", "checksum": "c0521c36c7b68fd5334aef9b2f45570d02d4739cf445a9f6a0b035036e8a1ddb"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com todos os registros de GPS.", "columns": {"ordem": {"name": "ordem", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_onibus_gps"}, "created_at": 1727709588.7778459, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_registros`", "raw_code": "SELECT\n    SAFE_CAST(ordem AS STRING) ordem,\n    SAFE_CAST(REPLACE(latitude, ',', '.') AS FLOAT64) latitude,\n    SAFE_CAST(REPLACE(longitude, ',', '.') AS FLOAT64) longitude,\n    SAFE_CAST(DATETIME(TIMESTAMP(datahora), \"America/Sao_Paulo\") AS DATETIME) timestamp_gps,\n    SAFE_CAST(velocidade AS INT64) velocidade,\n    concat(\n        ifnull(REGEXP_EXTRACT(linha, r'[A-Z]+'), \"\"),\n        ifnull(REGEXP_EXTRACT(linha, r'[0-9]+'), \"\")\n    ) as linha,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(data AS DATE) data,\n    SAFE_CAST(hora AS INT64) hora\nfrom\n    {{var('sppo_registros_staging')}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_registros.sql", "compiled": true, "compiled_code": "SELECT\n    SAFE_CAST(ordem AS STRING) ordem,\n    SAFE_CAST(REPLACE(latitude, ',', '.') AS FLOAT64) latitude,\n    SAFE_CAST(REPLACE(longitude, ',', '.') AS FLOAT64) longitude,\n    SAFE_CAST(DATETIME(TIMESTAMP(datahora), \"America/Sao_Paulo\") AS DATETIME) timestamp_gps,\n    SAFE_CAST(velocidade AS INT64) velocidade,\n    concat(\n        ifnull(REGEXP_EXTRACT(linha, r'[A-Z]+'), \"\"),\n        ifnull(REGEXP_EXTRACT(linha, r'[0-9]+'), \"\")\n    ) as linha,\n    SAFE_CAST(DATETIME(TIMESTAMP(timestamp_captura), \"America/Sao_Paulo\") AS DATETIME) timestamp_captura,\n    SAFE_CAST(data AS DATE) data,\n    SAFE_CAST(hora AS INT64) hora\nfrom\n    rj-smtr-staging.br_rj_riodejaneiro_onibus_gps_staging.registros as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.sppo_aux_registros_filtrada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_onibus_gps", "name": "sppo_aux_registros_filtrada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_filtrada.sql", "original_file_path": "models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_filtrada.sql", "unique_id": "model.rj_smtr.sppo_aux_registros_filtrada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps", "sppo_aux_registros_filtrada"], "alias": "sppo_aux_registros_filtrada", "checksum": {"name": "sha256", "checksum": "35c97fca74ebe4abc30e29af94e759268160a2c411fee742234d69c68efc8493"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_onibus_gps", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com filtragem e tratamento b\u00e1sico de registros de GPS", "columns": {"id_veiculo": {"name": "id_veiculo", "description": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "posicao_veiculo_geo": {"name": "posicao_veiculo_geo", "description": "Coordenada geogr\u00e1fica (POINT) com a posi\u00e7\u00e3o que o ve\u00edculo se encontra, conforme 'longitude' e 'latitude' informadas pelo GPS (EPSG:4326 - WGS84)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "velocidade": {"name": "velocidade", "description": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "linha": {"name": "linha", "description": "Linha de \u00f4nibus (servi\u00e7o) ou, se realocada, informada pela empresa operadora", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_gps": {"name": "timestamp_gps", "description": "Timestamp de emiss\u00e3o do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timestamp_captura": {"name": "timestamp_captura", "description": "Timestamp de captura, pela SMTR, do sinal de GPS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data": {"name": "data", "description": "Data do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "hora": {"name": "hora", "description": "Hora do 'timestamp_captura'", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "SHA da branch no Github", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_onibus_gps/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_onibus_gps", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.7735593, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_filtrada`", "raw_code": "{% if var(\"fifteen_minutes\") == \"_15_minutos\" %}\n{{\n  config(\n      materialized='ephemeral',\n  )\n}}\n{% else %}\n{{\n  config(\n      materialized='incremental',\n      partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n      }\n  )\n}}\n{% endif %}\n\n  /*\nDescri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.\n2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.\n3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.\n\t- id_veiculo --> ordem\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\t{{ var('limites_caixa') }}\n),\ngps AS (\n  /*2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    {{ ref('sppo_registros') }}\n  WHERE\n    data between DATE(\"{{var('date_range_start')}}\") and DATE(\"{{var('date_range_end')}}\")\n  {% if is_incremental() -%}\n    AND timestamp_gps > \"{{var('date_range_start')}}\" and timestamp_gps <=\"{{var('date_range_end')}}\"\n  {%- endif -%}\n),\nrealocacao as (\n  SELECT\n    g.* except(linha),\n    coalesce(r.servico_realocado, g.linha) as linha\n  FROM\n    gps g\n  LEFT JOIN\n    {{ ref('sppo_aux_registros_realocacao') }} r\n  ON\n    g.ordem = r.id_veiculo\n    and g.timestamp_gps = r.timestamp_gps\n),\nfiltrada AS (\n  /*1,2, e 3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.*/\n  SELECT\n    ordem AS id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    linha,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by ordem, timestamp_gps, linha) rn\n  FROM\n    realocacao\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"{{ var(\"version\") }}\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "language": "sql", "refs": [{"name": "sppo_registros", "package": null, "version": null}, {"name": "sppo_aux_registros_realocacao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_registros", "model.rj_smtr.sppo_aux_registros_realocacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_onibus_gps/sppo_aux_registros_filtrada.sql", "compiled": true, "compiled_code": "\n\n\n\n  /*\nDescri\u00e7\u00e3o:\nFiltragem e tratamento b\u00e1sico de registros de gps.\n1. Filtra registros que est\u00e3o fora de uma caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.\n2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.\n3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.\n\t- id_veiculo --> ordem\n*/\nWITH\nbox AS (\n  /*1. Geometria de caixa que cont\u00e9m a \u00e1rea do munic\u00edpio de Rio de Janeiro.*/\n\tSELECT\n\t*\n\tFROM\n\trj-smtr.br_rj_riodejaneiro_geo.limites_geograficos_caixa\n),\ngps AS (\n  /*2. Filtra registros antigos. Remove registros que tem diferen\u00e7a maior que 1 minuto entre o timestamp_captura e timestamp_gps.*/\n  SELECT\n    *,\n    ST_GEOGPOINT(longitude, latitude) posicao_veiculo_geo\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_registros`\n  WHERE\n    data between DATE(\"2022-01-01T00:00:00\") and DATE(\"2022-01-01T01:00:00\")\n  AND timestamp_gps > \"2022-01-01T00:00:00\" and timestamp_gps <=\"2022-01-01T01:00:00\"),\nrealocacao as (\n  SELECT\n    g.* except(linha),\n    coalesce(r.servico_realocado, g.linha) as linha\n  FROM\n    gps g\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_onibus_gps`.`sppo_aux_registros_realocacao` r\n  ON\n    g.ordem = r.id_veiculo\n    and g.timestamp_gps = r.timestamp_gps\n),\nfiltrada AS (\n  /*1,2, e 3. Muda o nome de vari\u00e1veis para o padr\u00e3o do projeto.*/\n  SELECT\n    ordem AS id_veiculo,\n    latitude,\n    longitude,\n    posicao_veiculo_geo,\n    velocidade,\n    linha,\n    timestamp_gps,\n    timestamp_captura,\n    data,\n    hora,\n    row_number() over (partition by ordem, timestamp_gps, linha) rn\n  FROM\n    realocacao\n  WHERE\n    ST_INTERSECTSBOX(posicao_veiculo_geo,\n      ( SELECT min_longitude FROM box),\n      ( SELECT min_latitude FROM box),\n      ( SELECT max_longitude FROM box),\n      ( SELECT max_latitude FROM box))\n  )\nSELECT\n  * except(rn),\n  \"\" as versao\nFROM\n  filtrada\nWHERE\n  rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.indicadores_mes": {"database": "rj-smtr", "schema": "indicadores_continuados_egp", "name": "indicadores_mes", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/indicadores_mes.sql", "original_file_path": "models/indicadores_continuados_egp/indicadores_mes.sql", "unique_id": "model.rj_smtr.indicadores_mes", "fqn": ["rj_smtr", "indicadores_continuados_egp", "indicadores_mes"], "alias": "indicadores_mes", "checksum": {"name": "sha256", "checksum": "1354f1a642e8e28481efc91d55e3fd4d733d12e09d1bdb2de284a872714e3f49"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Indicadores mensais vinculados ao Escrit\u00f3rio de Gerenciamento de Projetos e de Metas (EGP-Rio)", "columns": {"ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte (quando aplic\u00e1vel)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "nome_indicador": {"name": "nome_indicador", "description": "Nome do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor": {"name": "valor", "description": "Valor do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_atualizacao": {"name": "data_ultima_atualizacao", "description": "Data da \u00faltima atualiza\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "indicadores_continuados_egp"}, "created_at": 1727709588.6731312, "relation_name": "`rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`", "raw_code": "{% set queries = [\n    {\"table\": \"passageiro_pagante\", \"indicator\": \"Passageiros pagantes por m\u00eas\", \"field\": \"quantidade_passageiro_pagante_mes\"},\n    {\"table\": \"passageiro_gratuidade\", \"indicator\": \"Gratuidades por m\u00eas\", \"field\": \"quantidade_passageiro_gratuidade_mes\"},\n    {\"table\": \"frota_operante\", \"indicator\": \"Frota operante por m\u00eas\", \"field\": \"quantidade_veiculo_mes\"},\n    {\"table\": \"idade_media_frota_operante_onibus\", \"indicator\": \"Idade m\u00e9dia da frota operante por m\u00eas\", \"field\": \"idade_media_veiculo_mes\"}\n] %}\n\n{% for query in queries %}\nSELECT\n    ano,\n    mes,\n    {% if query.mode is defined %}NULL{% else %}modo{% endif %} AS modo,\n    \"{{ query.indicator }}\" AS nome_indicador,\n    {{ query.field }} AS valor,\n    data_ultima_atualizacao\nFROM {{ ref(query.table) }}\n{% if not loop.last %}UNION ALL{% endif %}\n{% endfor %}", "language": "sql", "refs": [{"name": "passageiro_pagante", "package": null, "version": null}, {"name": "passageiro_gratuidade", "package": null, "version": null}, {"name": "frota_operante", "package": null, "version": null}, {"name": "idade_media_frota_operante_onibus", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.passageiro_pagante", "model.rj_smtr.passageiro_gratuidade", "model.rj_smtr.frota_operante", "model.rj_smtr.idade_media_frota_operante_onibus"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/indicadores_mes.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n    ano,\n    mes,\n    modo AS modo,\n    \"Passageiros pagantes por m\u00eas\" AS nome_indicador,\n    quantidade_passageiro_pagante_mes AS valor,\n    data_ultima_atualizacao\nFROM `rj-smtr`.`indicadores_continuados_egp_staging`.`passageiro_pagante`\nUNION ALL\n\nSELECT\n    ano,\n    mes,\n    modo AS modo,\n    \"Gratuidades por m\u00eas\" AS nome_indicador,\n    quantidade_passageiro_gratuidade_mes AS valor,\n    data_ultima_atualizacao\nFROM `rj-smtr`.`indicadores_continuados_egp_staging`.`passageiro_gratuidade`\nUNION ALL\n\nSELECT\n    ano,\n    mes,\n    modo AS modo,\n    \"Frota operante por m\u00eas\" AS nome_indicador,\n    quantidade_veiculo_mes AS valor,\n    data_ultima_atualizacao\nFROM `rj-smtr`.`indicadores_continuados_egp_staging`.`frota_operante`\nUNION ALL\n\nSELECT\n    ano,\n    mes,\n    modo AS modo,\n    \"Idade m\u00e9dia da frota operante por m\u00eas\" AS nome_indicador,\n    idade_media_veiculo_mes AS valor,\n    data_ultima_atualizacao\nFROM `rj-smtr`.`indicadores_continuados_egp_staging`.`idade_media_frota_operante_onibus`\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.indicadores_mes_pivot": {"database": "rj-smtr", "schema": "indicadores_continuados_egp", "name": "indicadores_mes_pivot", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/indicadores_mes_pivot.sql", "original_file_path": "models/indicadores_continuados_egp/indicadores_mes_pivot.sql", "unique_id": "model.rj_smtr.indicadores_mes_pivot", "fqn": ["rj_smtr", "indicadores_continuados_egp", "indicadores_mes_pivot"], "alias": "indicadores_mes_pivot", "checksum": {"name": "sha256", "checksum": "a88a77219089ee85ae4a97fb60346a37be97908b010e559e4a3add304f1a873c"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Indicadores mensais vinculados ao Escrit\u00f3rio de Gerenciamento de Projetos e de Metas (EGP-Rio) pivotados por m\u00eas", "columns": {"indicador": {"name": "indicador", "description": "Nome do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte (quando aplic\u00e1vel)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Janeiro": {"name": "Janeiro", "description": "Valor apurado do indicador no m\u00eas de janeiro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Fevereiro": {"name": "Fevereiro", "description": "Valor apurado do indicador no m\u00eas de fevereiro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Marco": {"name": "Marco", "description": "Valor apurado do indicador no m\u00eas de mar\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Abril": {"name": "Abril", "description": "Valor apurado do indicador no m\u00eas de abril", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Maio": {"name": "Maio", "description": "Valor apurado do indicador no m\u00eas de maio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Junho": {"name": "Junho", "description": "Valor apurado do indicador no m\u00eas de junho", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Julho": {"name": "Julho", "description": "Valor apurado do indicador no m\u00eas de julho", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Agosto": {"name": "Agosto", "description": "Valor apurado do indicador no m\u00eas de agosto", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Setembro": {"name": "Setembro", "description": "Valor apurado do indicador no m\u00eas de setembro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Outubro": {"name": "Outubro", "description": "Valor apurado do indicador no m\u00eas de outubro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Novembro": {"name": "Novembro", "description": "Valor apurado do indicador no m\u00eas de novembro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "Dezembro": {"name": "Dezembro", "description": "Valor apurado do indicador no m\u00eas de dezembro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "indicadores_continuados_egp"}, "created_at": 1727709588.678039, "relation_name": "`rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes_pivot`", "raw_code": "{% set table_name = ref(\"indicadores_mes\") %}\n\n{% if execute %}\n    {% set result = run_query(\"SELECT DISTINCT nome_indicador, modo FROM \" ~ table_name) %}\n    {% set indicadores_modos = {} %}\n    {% set total_indicators = namespace(value=0) %}\n    {% for row in result %}\n        {% set indicador = row['nome_indicador'] %}\n        {% set modo = row['modo'] %}\n        {% if indicador in indicadores_modos %}\n            {% do indicadores_modos[indicador].append(modo) %}\n        {% else %}\n            {% do indicadores_modos.update({indicador: [modo]}) %}\n        {% endif %}\n        {% set total_indicators.value = total_indicators.value + 1 %}\n    {% endfor %}\n\n    {% set outer_loop_iteration = namespace(value=0) %}\n\n{% endif %}\n\n{% for indicador, modos in indicadores_modos.items() %}\n    {% for modo in modos %}\n    {% set outer_loop_iteration.value = outer_loop_iteration.value + 1 %}\n    SELECT\n        \"{{ indicador }}\" AS indicador,\n        {% if modo %}\"{{ modo }}\"{% else %}NULL{% endif %} AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                {{ table_name }}\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"{{ indicador }}\"\n                AND modo {% if modo %}= \"{{ modo }}\"{% else %}IS NULL{% endif %}\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    {% if outer_loop_iteration.value != total_indicators.value %}UNION ALL{% endif %}\n    {% endfor %}\n{% endfor %}", "language": "sql", "refs": [{"name": "indicadores_mes", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.run_query"], "nodes": ["model.rj_smtr.indicadores_mes"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/indicadores_mes_pivot.sql", "compiled": true, "compiled_code": "\n\n\n    \n    \n    \n    \n        \n        \n        \n            \n        \n        \n    \n        \n        \n        \n            \n        \n        \n    \n        \n        \n        \n            \n        \n        \n    \n        \n        \n        \n            \n        \n        \n    \n        \n        \n        \n            \n        \n        \n    \n        \n        \n        \n            \n        \n        \n    \n\n    \n\n\n\n\n    \n    \n    SELECT\n        \"Idade m\u00e9dia da frota operante por m\u00eas\" AS indicador,\n        \"\u00d4nibus\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Idade m\u00e9dia da frota operante por m\u00eas\"\n                AND modo = \"\u00d4nibus\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    UNION ALL\n    \n\n    \n    \n    SELECT\n        \"Passageiros pagantes por m\u00eas\" AS indicador,\n        \"BRT\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Passageiros pagantes por m\u00eas\"\n                AND modo = \"BRT\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    UNION ALL\n    \n    \n    SELECT\n        \"Passageiros pagantes por m\u00eas\" AS indicador,\n        \"\u00d4nibus\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Passageiros pagantes por m\u00eas\"\n                AND modo = \"\u00d4nibus\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    UNION ALL\n    \n\n    \n    \n    SELECT\n        \"Gratuidades por m\u00eas\" AS indicador,\n        \"BRT\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Gratuidades por m\u00eas\"\n                AND modo = \"BRT\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    UNION ALL\n    \n    \n    SELECT\n        \"Gratuidades por m\u00eas\" AS indicador,\n        \"\u00d4nibus\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Gratuidades por m\u00eas\"\n                AND modo = \"\u00d4nibus\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    UNION ALL\n    \n\n    \n    \n    SELECT\n        \"Frota operante por m\u00eas\" AS indicador,\n        \"\u00d4nibus\" AS modo,\n        *\n    FROM (\n        SELECT\n            *\n        FROM (\n            SELECT\n                ano,\n                mes,\n                valor\n            FROM\n                `rj-smtr`.`indicadores_continuados_egp`.`indicadores_mes`\n                --rj-smtr.indicadores_continuados_egp.indicadores_mes\n            WHERE\n                nome_indicador = \"Frota operante por m\u00eas\"\n                AND modo = \"\u00d4nibus\"\n        ) PIVOT ( MAX(valor) FOR mes IN (\n            1 Janeiro,\n            2 Fevereiro,\n            3 Marco,\n            4 Abril,\n            5 Maio,\n            6 Junho,\n            7 Julho,\n            8 Agosto,\n            9 Setembro,\n            10 Outubro,\n            11 Novembro,\n            12 Dezembro )\n        )\n    )\n    \n    \n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.passageiro_pagante": {"database": "rj-smtr", "schema": "indicadores_continuados_egp_staging", "name": "passageiro_pagante", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/staging/passageiro_pagante.sql", "original_file_path": "models/indicadores_continuados_egp/staging/passageiro_pagante.sql", "unique_id": "model.rj_smtr.passageiro_pagante", "fqn": ["rj_smtr", "indicadores_continuados_egp", "staging", "passageiro_pagante"], "alias": "passageiro_pagante", "checksum": {"name": "sha256", "checksum": "3832ae06cb45cf695e89954ffaf5e76c61a7745a8d1d5426175ecc121cc6414e"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "tags": [], "description": "Indicador de passageiros pagantes por m\u00eas", "columns": {"data": {"name": "data", "description": "Data de refer\u00eancia para parti\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte (se aplic\u00e1vel)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiro_pagante_mes": {"name": "quantidade_passageiro_pagante_mes", "description": "Indicador de passageiros pagantes por m\u00eas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_atualizacao": {"name": "data_ultima_atualizacao", "description": "Data da \u00faltima atualiza\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "indicadores_continuados_egp_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "created_at": 1727709588.682266, "relation_name": "`rj-smtr`.`indicadores_continuados_egp_staging`.`passageiro_pagante`", "raw_code": "{{\n  config(\n    partition_by = {\n    \"field\": \"data\",\n    \"data_type\": \"date\",\n    \"granularity\": \"month\"\n    },\n)}}\n\nWITH consorcio AS (\n  SELECT\n    id_consorcio,\n    modo\n  FROM\n    {{ ref(\"consorcios\") }}\n    -- rj-smtr.cadastro.consorcios\n  WHERE\n    modo IN (\"\u00d4nibus\", \"BRT\")\n)\nSELECT\n  DATE_TRUNC(data, MONTH) AS data,\n  rdo.ano,\n  rdo.mes,\n  c.modo,\n  SUM(qtd_buc_1_perna+qtd_buc_2_perna_integracao+\n      qtd_buc_supervia_1_perna+qtd_buc_supervia_2_perna_integracao+\n      qtd_cartoes_perna_unica_e_demais+qtd_pagamentos_especie) AS quantidade_passageiro_pagante_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '{{ var(\"version\") }}' as versao\nFROM\n  consorcio AS c\nLEFT JOIN\n  {{ source(\"br_rj_riodejaneiro_rdo\", \"rdo40_tratado\") }} AS rdo\nON\n  rdo.termo = c.id_consorcio\nWHERE\n  rdo.data >= \"2015-01-01\"\n  {% if is_incremental() %}\n  AND rdo.data BETWEEN DATE_TRUNC(DATE(\"{{ var(\"start_date\") }}\"), MONTH)\n  AND LAST_DAY(DATE(\"{{ var(\"end_date\") }}\"), MONTH)\n  AND rdo.data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% endif %}\nGROUP BY\n  data,\n  rdo.ano,\n  rdo.mes,\n  c.modo", "language": "sql", "refs": [{"name": "consorcios", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_rdo", "rdo40_tratado"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/staging/passageiro_pagante.sql", "compiled": true, "compiled_code": "\n\nWITH consorcio AS (\n  SELECT\n    id_consorcio,\n    modo\n  FROM\n    `rj-smtr`.`cadastro`.`consorcios`\n    -- rj-smtr.cadastro.consorcios\n  WHERE\n    modo IN (\"\u00d4nibus\", \"BRT\")\n)\nSELECT\n  DATE_TRUNC(data, MONTH) AS data,\n  rdo.ano,\n  rdo.mes,\n  c.modo,\n  SUM(qtd_buc_1_perna+qtd_buc_2_perna_integracao+\n      qtd_buc_supervia_1_perna+qtd_buc_supervia_2_perna_integracao+\n      qtd_cartoes_perna_unica_e_demais+qtd_pagamentos_especie) AS quantidade_passageiro_pagante_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '' as versao\nFROM\n  consorcio AS c\nLEFT JOIN\n  `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_tratado` AS rdo\nON\n  rdo.termo = c.id_consorcio\nWHERE\n  rdo.data >= \"2015-01-01\"\n  \n  AND rdo.data BETWEEN DATE_TRUNC(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND LAST_DAY(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND rdo.data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  \nGROUP BY\n  data,\n  rdo.ano,\n  rdo.mes,\n  c.modo", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.passageiro_gratuidade": {"database": "rj-smtr", "schema": "indicadores_continuados_egp_staging", "name": "passageiro_gratuidade", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/staging/passageiro_gratuidade.sql", "original_file_path": "models/indicadores_continuados_egp/staging/passageiro_gratuidade.sql", "unique_id": "model.rj_smtr.passageiro_gratuidade", "fqn": ["rj_smtr", "indicadores_continuados_egp", "staging", "passageiro_gratuidade"], "alias": "passageiro_gratuidade", "checksum": {"name": "sha256", "checksum": "4a63882cce10ee30f00713e815830122f0e6724c9c175c0c85246e8411eec544"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "tags": [], "description": "Indicador de gratuidades por m\u00eas", "columns": {"data": {"name": "data", "description": "Data de refer\u00eancia para parti\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte (se aplic\u00e1vel)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_passageiro_gratuidade_mes": {"name": "quantidade_passageiro_gratuidade_mes", "description": "Indicador de gratuidades por m\u00eas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_atualizacao": {"name": "data_ultima_atualizacao", "description": "Data da \u00faltima atualiza\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "indicadores_continuados_egp_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "created_at": 1727709588.6812823, "relation_name": "`rj-smtr`.`indicadores_continuados_egp_staging`.`passageiro_gratuidade`", "raw_code": "{{\n  config(\n    partition_by = {\n    \"field\": \"data\",\n    \"data_type\": \"date\",\n    \"granularity\": \"month\"\n    },\n)}}\n\nWITH consorcio AS (\n  SELECT\n    id_consorcio,\n    modo\n  FROM\n    {{ ref(\"consorcios\") }}\n    -- rj-smtr.cadastro.consorcios\n  WHERE\n    modo IN (\"\u00d4nibus\", \"BRT\")\n)\nSELECT\n  DATE_TRUNC(data, MONTH) AS data,\n  rdo.ano,\n  rdo.mes,\n  c.modo,\n  SUM(rdo.qtd_grt_idoso + rdo.qtd_grt_especial +\n      rdo.qtd_grt_estud_federal + rdo.qtd_grt_estud_estadual +\n      rdo.qtd_grt_estud_municipal + rdo.qtd_grt_rodoviario +\n      rdo.qtd_grt_passe_livre_universitario) AS quantidade_passageiro_gratuidade_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '{{ var(\"version\") }}' as versao\nFROM\n  consorcio AS c\nLEFT JOIN\n  {{ source(\"br_rj_riodejaneiro_rdo\", \"rdo40_tratado\") }} AS rdo\nON\n  rdo.termo = c.id_consorcio\nWHERE\n  rdo.data >= \"2015-01-01\"\n  {% if is_incremental() %}\n  AND rdo.data BETWEEN DATE_TRUNC(DATE(\"{{ var(\"start_date\") }}\"), MONTH)\n  AND LAST_DAY(DATE(\"{{ var(\"end_date\") }}\"), MONTH)\n  AND rdo.data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% endif %}\nGROUP BY\n  data,\n  rdo.ano,\n  rdo.mes,\n  c.modo", "language": "sql", "refs": [{"name": "consorcios", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_rdo", "rdo40_tratado"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado", "model.rj_smtr.consorcios"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/staging/passageiro_gratuidade.sql", "compiled": true, "compiled_code": "\n\nWITH consorcio AS (\n  SELECT\n    id_consorcio,\n    modo\n  FROM\n    `rj-smtr`.`cadastro`.`consorcios`\n    -- rj-smtr.cadastro.consorcios\n  WHERE\n    modo IN (\"\u00d4nibus\", \"BRT\")\n)\nSELECT\n  DATE_TRUNC(data, MONTH) AS data,\n  rdo.ano,\n  rdo.mes,\n  c.modo,\n  SUM(rdo.qtd_grt_idoso + rdo.qtd_grt_especial +\n      rdo.qtd_grt_estud_federal + rdo.qtd_grt_estud_estadual +\n      rdo.qtd_grt_estud_municipal + rdo.qtd_grt_rodoviario +\n      rdo.qtd_grt_passe_livre_universitario) AS quantidade_passageiro_gratuidade_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '' as versao\nFROM\n  consorcio AS c\nLEFT JOIN\n  `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_tratado` AS rdo\nON\n  rdo.termo = c.id_consorcio\nWHERE\n  rdo.data >= \"2015-01-01\"\n  \n  AND rdo.data BETWEEN DATE_TRUNC(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND LAST_DAY(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND rdo.data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  \nGROUP BY\n  data,\n  rdo.ano,\n  rdo.mes,\n  c.modo", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.frota_operante": {"database": "rj-smtr", "schema": "indicadores_continuados_egp_staging", "name": "frota_operante", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/staging/frota_operante.sql", "original_file_path": "models/indicadores_continuados_egp/staging/frota_operante.sql", "unique_id": "model.rj_smtr.frota_operante", "fqn": ["rj_smtr", "indicadores_continuados_egp", "staging", "frota_operante"], "alias": "frota_operante", "checksum": {"name": "sha256", "checksum": "f4f89ea10a3cdcbae9b1ff48cf72153cbcf8c7037ea6bcda0b7d3174c1e66011"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "tags": [], "description": "Indicador de frota operante por m\u00eas", "columns": {"data": {"name": "data", "description": "Data de refer\u00eancia para parti\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "quantidade_veiculo_mes": {"name": "quantidade_veiculo_mes", "description": "Quantidade de ve\u00edculos operantes no m\u00eas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_atualizacao": {"name": "data_ultima_atualizacao", "description": "Data da \u00faltima atualiza\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "indicadores_continuados_egp_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "created_at": 1727709588.6791675, "relation_name": "`rj-smtr`.`indicadores_continuados_egp_staging`.`frota_operante`", "raw_code": "{{\n  config(\n    partition_by = {\n    \"field\": \"data\",\n    \"data_type\": \"date\",\n    \"granularity\": \"month\"\n    },\n)}}\n\nSELECT\n  MIN(data) AS data,\n  EXTRACT(YEAR FROM data) AS ano,\n  EXTRACT(MONTH FROM data) AS mes,\n  \"\u00d4nibus\" AS modo,\n  COUNT(DISTINCT id_veiculo) AS quantidade_veiculo_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '{{ var(\"version\") }}' as versao\nFROM\n  {{ ref('viagem_completa') }}\n  --rj-smtr.projeto_subsidio_sppo.viagem_completa\nWHERE\n{% if is_incremental() %}\n  data BETWEEN DATE_TRUNC(DATE(\"{{ var(\"start_date\") }}\"), MONTH)\n  AND LAST_DAY(DATE(\"{{ var(\"end_date\") }}\"), MONTH)\n  AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n{% else %}\n  data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n{% endif %}\nGROUP BY\n  2,\n  3", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/staging/frota_operante.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  MIN(data) AS data,\n  EXTRACT(YEAR FROM data) AS ano,\n  EXTRACT(MONTH FROM data) AS mes,\n  \"\u00d4nibus\" AS modo,\n  COUNT(DISTINCT id_veiculo) AS quantidade_veiculo_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '' as versao\nFROM\n  `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n  --rj-smtr.projeto_subsidio_sppo.viagem_completa\nWHERE\n\n  data BETWEEN DATE_TRUNC(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND LAST_DAY(DATE(\"2022-01-01T01:00:00\"), MONTH)\n  AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n\nGROUP BY\n  2,\n  3", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.idade_media_frota_operante_onibus": {"database": "rj-smtr", "schema": "indicadores_continuados_egp_staging", "name": "idade_media_frota_operante_onibus", "resource_type": "model", "package_name": "rj_smtr", "path": "indicadores_continuados_egp/staging/idade_media_frota_operante_onibus.sql", "original_file_path": "models/indicadores_continuados_egp/staging/idade_media_frota_operante_onibus.sql", "unique_id": "model.rj_smtr.idade_media_frota_operante_onibus", "fqn": ["rj_smtr", "indicadores_continuados_egp", "staging", "idade_media_frota_operante_onibus"], "alias": "idade_media_frota_operante_onibus", "checksum": {"name": "sha256", "checksum": "84cd34034b759a84c94fa397f1e4d1b9c4f0db74c46153e9e4b2303b558e90a8"}, "config": {"enabled": true, "alias": null, "schema": "indicadores_continuados_egp_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "tags": [], "description": "Indicador de idade m\u00e9dia da frota operante por m\u00eas", "columns": {"data": {"name": "data", "description": "Data de refer\u00eancia para parti\u00e7\u00e3o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ano": {"name": "ano", "description": "Ano de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "mes": {"name": "mes", "description": "M\u00eas de apura\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "idade_media_veiculo_mes": {"name": "idade_media_veiculo_mes", "description": "Indicador de idade m\u00e9dia da frota operante por m\u00eas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_ultima_atualizacao": {"name": "data_ultima_atualizacao", "description": "Data da \u00faltima atualiza\u00e7\u00e3o do indicador", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/indicadores_continuados_egp/staging/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "indicadores_continuados_egp_staging", "incremental_strategy": "insert_overwrite", "partition_by": {"field": "data", "data_type": "date", "granularity": "month"}}, "created_at": 1727709588.68016, "relation_name": "`rj-smtr`.`indicadores_continuados_egp_staging`.`idade_media_frota_operante_onibus`", "raw_code": "{{\n  config(\n    partition_by = {\n    \"field\": \"data\",\n    \"data_type\": \"date\",\n    \"granularity\": \"month\"\n    },\n)}}\n\nWITH\n  -- 1. Seleciona a \u00faltima data dispon\u00edvel de cada m\u00eas\n  datas AS (\n  SELECT\n    EXTRACT(MONTH FROM data) AS mes,\n    EXTRACT(YEAR FROM data) AS ano,\n    MAX(data) AS data\n  FROM\n    {{ ref(\"sppo_licenciamento\") }}\n    --rj-smtr.veiculo.sppo_licenciamento\n  WHERE\n  {% if is_incremental() %}\n    data BETWEEN DATE_TRUNC(DATE(\"{{ var(\"start_date\") }}\"), MONTH)\n    AND LAST_DAY(DATE(\"{{ var(\"end_date\") }}\"), MONTH)\n    AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% else %}\n    data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% endif %}\n  GROUP BY\n    1,\n    2),\n  -- 2. Verifica frota operante\n  frota_operante AS (\n  SELECT\n    DISTINCT id_veiculo,\n    EXTRACT(MONTH FROM data) AS mes,\n    EXTRACT(YEAR FROM data) AS ano,\n  FROM\n    {{ ref('viagem_completa') }}\n    --rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n  {% if is_incremental() %}\n    data BETWEEN DATE_TRUNC(DATE(\"{{ var(\"start_date\") }}\"), MONTH)\n    AND LAST_DAY(DATE(\"{{ var(\"end_date\") }}\"), MONTH)\n    AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% else %}\n    data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  {% endif %}\n  ),\n  -- 3. Calcula a idade de todos os ve\u00edculos para a data de refer\u00eancia\n  idade_frota AS (\n  SELECT\n    data,\n    EXTRACT(YEAR FROM data) - CAST(ano_fabricacao AS INT64) AS idade\n  FROM\n    datas AS d\n  LEFT JOIN\n    {{ ref(\"sppo_licenciamento\") }}\n    --rj-smtr.veiculo.sppo_licenciamento AS l\n  USING\n    (data)\n  LEFT JOIN\n    frota_operante AS f\n  USING\n    (id_veiculo, mes, ano)\n  WHERE\n    f.id_veiculo IS NOT NULL\n  )\n-- 4. Calcula a idade m\u00e9dia\nSELECT\n  data,\n  EXTRACT(YEAR FROM data) AS ano,\n  EXTRACT(MONTH FROM data) AS mes,\n  \"\u00d4nibus\" AS modo,\n  ROUND(AVG(idade),2) AS idade_media_veiculo_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '{{ var(\"version\") }}' as versao\nFROM\n  idade_frota\nGROUP BY\n  1,\n  2,\n  3", "language": "sql", "refs": [{"name": "sppo_licenciamento", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}, {"name": "sppo_licenciamento", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.sppo_licenciamento", "model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/indicadores_continuados_egp/staging/idade_media_frota_operante_onibus.sql", "compiled": true, "compiled_code": "\n\nWITH\n  -- 1. Seleciona a \u00faltima data dispon\u00edvel de cada m\u00eas\n  datas AS (\n  SELECT\n    EXTRACT(MONTH FROM data) AS mes,\n    EXTRACT(YEAR FROM data) AS ano,\n    MAX(data) AS data\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_licenciamento`\n    --rj-smtr.veiculo.sppo_licenciamento\n  WHERE\n  \n    data BETWEEN DATE_TRUNC(DATE(\"2022-01-01T01:00:00\"), MONTH)\n    AND LAST_DAY(DATE(\"2022-01-01T01:00:00\"), MONTH)\n    AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  \n  GROUP BY\n    1,\n    2),\n  -- 2. Verifica frota operante\n  frota_operante AS (\n  SELECT\n    DISTINCT id_veiculo,\n    EXTRACT(MONTH FROM data) AS mes,\n    EXTRACT(YEAR FROM data) AS ano,\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    --rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n  \n    data BETWEEN DATE_TRUNC(DATE(\"2022-01-01T01:00:00\"), MONTH)\n    AND LAST_DAY(DATE(\"2022-01-01T01:00:00\"), MONTH)\n    AND data < DATE_TRUNC(CURRENT_DATE(\"America/Sao_Paulo\"), MONTH)\n  \n  ),\n  -- 3. Calcula a idade de todos os ve\u00edculos para a data de refer\u00eancia\n  idade_frota AS (\n  SELECT\n    data,\n    EXTRACT(YEAR FROM data) - CAST(ano_fabricacao AS INT64) AS idade\n  FROM\n    datas AS d\n  LEFT JOIN\n    `rj-smtr`.`veiculo`.`sppo_licenciamento`\n    --rj-smtr.veiculo.sppo_licenciamento AS l\n  USING\n    (data)\n  LEFT JOIN\n    frota_operante AS f\n  USING\n    (id_veiculo, mes, ano)\n  WHERE\n    f.id_veiculo IS NOT NULL\n  )\n-- 4. Calcula a idade m\u00e9dia\nSELECT\n  data,\n  EXTRACT(YEAR FROM data) AS ano,\n  EXTRACT(MONTH FROM data) AS mes,\n  \"\u00d4nibus\" AS modo,\n  ROUND(AVG(idade),2) AS idade_media_veiculo_mes,\n  CURRENT_DATE(\"America/Sao_Paulo\") AS data_ultima_atualizacao,\n  '' as versao\nFROM\n  idade_frota\nGROUP BY\n  1,\n  2,\n  3", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stop_times": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stop_times", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stop_times.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stop_times.sql", "unique_id": "model.rj_smtr.stop_times", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stop_times"], "alias": "stop_times", "checksum": {"name": "sha256", "checksum": "3e807c3ca667f182aca7162bf6381705fefe3cb8eb03d4eba451455a28b8a61e"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro dos hor\u00e1rios em que um ve\u00edculo chega e sai das paradas de cada viagem (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7888439, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_times`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"stop_times_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stop_times.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.stop_times as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stop_details": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stop_details", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stop_details.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stop_details.sql", "unique_id": "model.rj_smtr.stop_details", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stop_details"], "alias": "stop_details", "checksum": {"name": "sha256", "checksum": "fcbbbac730a934fe020196d5ef1dd7cb70a2450690a6ba0dca2491d3928d6539"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro detalhado dos pontos de parada (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7883065, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_details`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"stop_details_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stop_details.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.stop_details as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stop_details_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stop_details_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stop_details_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stop_details_desaninhada.sql", "unique_id": "model.rj_smtr.stop_details_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stop_details_desaninhada"], "alias": "stop_details_desaninhada", "checksum": {"name": "sha256", "checksum": "7431783cb9b97359bc04a4cb79c8bae58d450dd6452b7ffae71293ddc8238746"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro detalhado dos pontos de parada (stop_details) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7887309, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_details_desaninhada`", "raw_code": "/*Desaninha os campos presentes em 'content' da tabela stop_details*/\nSELECT\n  stop_id,\n  json_value(content, '$.stop_name') stop_name,\n  json_value(content, '$.stop_desc') stop_desc,\n  json_value(content, '$.stop_lat') stop_lat,\n  json_value(content, '$.stop_lon') stop_lon,\n  json_value(content, '$.location_type') location_type,\n  json_value(content, '$.Modal') modal,\n  json_value(content, '$.Corredor') corredor,\n  json_value(content, '$.Tipo de parada') tipo_de_parada ,\n  json_value(content, '$.Tipo Sentido') tipo_sentido,\n  json_value(content, '$.Propriedade da Parada') propriedade_da_parada,\n  json_value(content, '$.Seletivado') seletivado,\n  json_value(content, '$.Sinaliza\u00e7\u00e3o') sinalizacao,\n  json_value(content, '$.Conserva\u00e7\u00e3o') conservacao,\n  json_value(content, '$.Tipo de abrigo') tipo_de_abrigo,\n  json_value(content, '$.Conserva\u00e7\u00e3o do abrigo') conservacao_do_abrigo,\n  json_value(content, '$.Tipo de assento') tipo_do_assento,\n  json_value(content, '$.Tipo de baia') tipo_de_baia,\n  json_value(content, '$.Tipo de cal\u00e7ada') tipo_de_calcada,\n  json_value(content, '$.\"Possui lixeiras?\"') possui_lixeiras,\n  json_value(content, '$.Tipo rampa') tipo_rampa,\n  json_value(content, '$.\"Braile?\"') braile,\n  json_value(content, '$.\"Piso t\u00e1til?\"') piso_tatil,\n  json_value(content, '$.\"Elevador?\"') elevador,\n  json_value(content, '$.N\u00famero de vagas') numero_de_vagas,\n  json_value(content, '$.N\u00famero de cabines') numero_de_cabines,\n  json_value(content, '$.AP') ap,\n  json_value(content, '$.RA') ra,\n  json_value(content, '$.Bairro') bairro,\n  json_value(content, '$.Observa\u00e7\u00f5es') observacoes,\n  json_value(content, '$.Endere\u00e7o') endereco,\n  json_value(content, '$.MultiModal') multi_modal,\n  json_value(content, '$.id_sequencial') id_sequencial,\n  json_value(content, '$.NumeroLinha') numero_linha,\n  json_value(content, '$.Vista') vista,\n  json_value(content, '$.Hor\u00e1rios') horarios,\n  json_value(content, '$.\"Existe o ponto?\"') existe_o_ponto,\n  json_value(content, '$.parent_station') parent_station,\n  json_value(content, '$.nome_ponto') nome_ponto,\n  json_value(content, '$.route_type') route_type,\n  data_versao\n\nFROM {{ ref(\"stop_details\") }}", "language": "sql", "refs": [{"name": "stop_details", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.stop_details"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stop_details_desaninhada.sql", "compiled": true, "compiled_code": "/*Desaninha os campos presentes em 'content' da tabela stop_details*/\nSELECT\n  stop_id,\n  json_value(content, '$.stop_name') stop_name,\n  json_value(content, '$.stop_desc') stop_desc,\n  json_value(content, '$.stop_lat') stop_lat,\n  json_value(content, '$.stop_lon') stop_lon,\n  json_value(content, '$.location_type') location_type,\n  json_value(content, '$.Modal') modal,\n  json_value(content, '$.Corredor') corredor,\n  json_value(content, '$.Tipo de parada') tipo_de_parada ,\n  json_value(content, '$.Tipo Sentido') tipo_sentido,\n  json_value(content, '$.Propriedade da Parada') propriedade_da_parada,\n  json_value(content, '$.Seletivado') seletivado,\n  json_value(content, '$.Sinaliza\u00e7\u00e3o') sinalizacao,\n  json_value(content, '$.Conserva\u00e7\u00e3o') conservacao,\n  json_value(content, '$.Tipo de abrigo') tipo_de_abrigo,\n  json_value(content, '$.Conserva\u00e7\u00e3o do abrigo') conservacao_do_abrigo,\n  json_value(content, '$.Tipo de assento') tipo_do_assento,\n  json_value(content, '$.Tipo de baia') tipo_de_baia,\n  json_value(content, '$.Tipo de cal\u00e7ada') tipo_de_calcada,\n  json_value(content, '$.\"Possui lixeiras?\"') possui_lixeiras,\n  json_value(content, '$.Tipo rampa') tipo_rampa,\n  json_value(content, '$.\"Braile?\"') braile,\n  json_value(content, '$.\"Piso t\u00e1til?\"') piso_tatil,\n  json_value(content, '$.\"Elevador?\"') elevador,\n  json_value(content, '$.N\u00famero de vagas') numero_de_vagas,\n  json_value(content, '$.N\u00famero de cabines') numero_de_cabines,\n  json_value(content, '$.AP') ap,\n  json_value(content, '$.RA') ra,\n  json_value(content, '$.Bairro') bairro,\n  json_value(content, '$.Observa\u00e7\u00f5es') observacoes,\n  json_value(content, '$.Endere\u00e7o') endereco,\n  json_value(content, '$.MultiModal') multi_modal,\n  json_value(content, '$.id_sequencial') id_sequencial,\n  json_value(content, '$.NumeroLinha') numero_linha,\n  json_value(content, '$.Vista') vista,\n  json_value(content, '$.Hor\u00e1rios') horarios,\n  json_value(content, '$.\"Existe o ponto?\"') existe_o_ponto,\n  json_value(content, '$.parent_station') parent_station,\n  json_value(content, '$.nome_ponto') nome_ponto,\n  json_value(content, '$.route_type') route_type,\n  data_versao\n\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_details`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.routes": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "routes", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/routes.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/routes.sql", "unique_id": "model.rj_smtr.routes", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "routes"], "alias": "routes", "checksum": {"name": "sha256", "checksum": "b7748ca21aa5f1b1b08526a56cdd9ca8845d5659207f25bdfd8ed498c226ff3b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro dos servi\u00e7os (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7822697, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(route_id AS STRING) route_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"routes_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/routes.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(route_id AS STRING) route_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.routes as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.shapes": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "shapes", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/shapes.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/shapes.sql", "unique_id": "model.rj_smtr.shapes", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "shapes"], "alias": "shapes", "checksum": {"name": "sha256", "checksum": "cbb1508b58bca2c7eac1a392bab6094bceca790fa6bcdb33bcc2551d8f545d2c"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro das regras para mapear caminhos de deslocamento de ve\u00edculos (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7878845, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(shape_id AS STRING) shape_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"shapes_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/shapes.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(shape_id AS STRING) shape_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.shapes as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.holidays": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "holidays", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/holidays.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/holidays.sql", "unique_id": "model.rj_smtr.holidays", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "holidays"], "alias": "holidays", "checksum": {"name": "sha256", "checksum": "5fc1720e10e61f166473ad11be266754a5fc71bdaab0150a468f2346329166b3"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro dos feriados (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.786919, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`holidays`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nDATE(SAFE_CAST(Data AS DATETIME)) data,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"holidays_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/holidays.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nDATE(SAFE_CAST(Data AS DATETIME)) data,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.holidays as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stops_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stops_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stops_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stops_desaninhada.sql", "unique_id": "model.rj_smtr.stops_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stops_desaninhada"], "alias": "stops_desaninhada", "checksum": {"name": "sha256", "checksum": "c6e49f05f15cb397e5798cc5aa16968928c2c59fd91bc7eefb8718cf917e1bf8"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro dos pontos de parada (stops) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7899077, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops_desaninhada`", "raw_code": "SELECT\n    stop_id,\n    case when json_value(content, '$.IDPropriedadeParada') is null then false else true end flag_vistoriada,\n    json_value(content, '$.stop_name') as stop_name,\n    json_value(content, '$.stop_desc') as stop_desc,\n    json_value(content, '$.stop_lat') as stop_lat,\n    json_value(content, '$.stop_lon') as stop_lon,\n    json_value(content, '$.location_type') as location_type,\n    json_value(content, '$.GrupoLatitude') as GrupoLatitude,\n    json_value(content, '$.GrupoLongitude') as GrupoLongitude,\n    json_value(content, '$.idModalSmtr') as idModalSmtr,\n    json_value(content, '$.IDCorredor') as IDCorredor,\n    json_value(content, '$.IDTipoParada') as IDTipoParada,\n    json_value(content, '$.IDTipoSentido') as IDTipoSentido,\n    json_value(content, '$.IDPropriedadeParada') as IDPropriedadeParada,\n    json_value(content, '$.Seletivado') as Seletivado,\n    json_value(content, '$.BRS') as BRS,\n    json_value(content, '$.IDTipoSinalizacao') as IDTipoSinalizacao,\n    json_value(content, '$.IDConservacaoSinalizacao') as IDConservacaoSinalizacao,\n    json_value(content, '$.IDTipoAbrigo') as IDTipoAbrigo,\n    json_value(content, '$.ConservacaoAbrigo') as ConservacaoAbrigo,\n    json_value(content, '$.IDTipoAssento') as IDTipoAssento,\n    json_value(content, '$.IDTipoBaia') as IDTipoBaia,\n    json_value(content, '$.QualidadePavimento') as QualidadePavimento,\n    json_value(content, '$.IDTipoCalcada') as IDTipoCalcada,\n    json_value(content, '$.IDLixeiras') as IDLixeiras,\n    json_value(content, '$.IDRampa') as IDRampa,\n    json_value(content, '$.braile') as braile,\n    json_value(content, '$.piso_tatil') as piso_tatil,\n    json_value(content, '$.elevador') as elevador,\n    json_value(content, '$.n_vagas') as n_vagas,\n    json_value(content, '$.n_cabines') as n_cabines,\n    json_value(content, '$.AP') as AP,\n    json_value(content, '$.RA') as RA,\n    json_value(content, '$.Bairro') as Bairro,\n    json_value(content, '$.Observacoes') as Observacoes,\n    json_value(content, '$.dataAtualizacao') as dataAtualizacao,\n    json_value(content, '$.endereco') as endereco,\n    json_value(content, '$.IDBairro') as IDBairro,\n    json_value(content, '$.IDRa') as IDRa,\n    json_value(content, '$.MultiModal') as MultiModal,\n    json_value(content, '$.id_sequencial') as id_sequencial,\n    json_value(content, '$.NumeroLinha') as NumeroLinha,\n    json_value(content, '$.Vista') as Vista,\n    json_value(content, '$.Horarios') as Horarios,\n    json_value(content, '$.id') as id,\n    json_value(content, '$.PontoExistente') as PontoExistente\nFROM {{ ref('stops') }} t\nwhere data_versao = (select max(data_versao) FROM {{ ref(\"stops\") }})\nand json_value(content, '$.PontoExistente') = 'SIM'\nand json_value(content, '$.idModalSmtr') in ('22', '23', 'O')", "language": "sql", "refs": [{"name": "stops", "package": null, "version": null}, {"name": "stops", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.stops"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stops_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\n    stop_id,\n    case when json_value(content, '$.IDPropriedadeParada') is null then false else true end flag_vistoriada,\n    json_value(content, '$.stop_name') as stop_name,\n    json_value(content, '$.stop_desc') as stop_desc,\n    json_value(content, '$.stop_lat') as stop_lat,\n    json_value(content, '$.stop_lon') as stop_lon,\n    json_value(content, '$.location_type') as location_type,\n    json_value(content, '$.GrupoLatitude') as GrupoLatitude,\n    json_value(content, '$.GrupoLongitude') as GrupoLongitude,\n    json_value(content, '$.idModalSmtr') as idModalSmtr,\n    json_value(content, '$.IDCorredor') as IDCorredor,\n    json_value(content, '$.IDTipoParada') as IDTipoParada,\n    json_value(content, '$.IDTipoSentido') as IDTipoSentido,\n    json_value(content, '$.IDPropriedadeParada') as IDPropriedadeParada,\n    json_value(content, '$.Seletivado') as Seletivado,\n    json_value(content, '$.BRS') as BRS,\n    json_value(content, '$.IDTipoSinalizacao') as IDTipoSinalizacao,\n    json_value(content, '$.IDConservacaoSinalizacao') as IDConservacaoSinalizacao,\n    json_value(content, '$.IDTipoAbrigo') as IDTipoAbrigo,\n    json_value(content, '$.ConservacaoAbrigo') as ConservacaoAbrigo,\n    json_value(content, '$.IDTipoAssento') as IDTipoAssento,\n    json_value(content, '$.IDTipoBaia') as IDTipoBaia,\n    json_value(content, '$.QualidadePavimento') as QualidadePavimento,\n    json_value(content, '$.IDTipoCalcada') as IDTipoCalcada,\n    json_value(content, '$.IDLixeiras') as IDLixeiras,\n    json_value(content, '$.IDRampa') as IDRampa,\n    json_value(content, '$.braile') as braile,\n    json_value(content, '$.piso_tatil') as piso_tatil,\n    json_value(content, '$.elevador') as elevador,\n    json_value(content, '$.n_vagas') as n_vagas,\n    json_value(content, '$.n_cabines') as n_cabines,\n    json_value(content, '$.AP') as AP,\n    json_value(content, '$.RA') as RA,\n    json_value(content, '$.Bairro') as Bairro,\n    json_value(content, '$.Observacoes') as Observacoes,\n    json_value(content, '$.dataAtualizacao') as dataAtualizacao,\n    json_value(content, '$.endereco') as endereco,\n    json_value(content, '$.IDBairro') as IDBairro,\n    json_value(content, '$.IDRa') as IDRa,\n    json_value(content, '$.MultiModal') as MultiModal,\n    json_value(content, '$.id_sequencial') as id_sequencial,\n    json_value(content, '$.NumeroLinha') as NumeroLinha,\n    json_value(content, '$.Vista') as Vista,\n    json_value(content, '$.Horarios') as Horarios,\n    json_value(content, '$.id') as id,\n    json_value(content, '$.PontoExistente') as PontoExistente\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops` t\nwhere data_versao = (select max(data_versao) FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops`)\nand json_value(content, '$.PontoExistente') = 'SIM'\nand json_value(content, '$.idModalSmtr') in ('22', '23', 'O')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.agg_stops_vistoriadas": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "agg_stops_vistoriadas", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/agg_stops_vistoriadas.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/agg_stops_vistoriadas.sql", "unique_id": "model.rj_smtr.agg_stops_vistoriadas", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "agg_stops_vistoriadas"], "alias": "agg_stops_vistoriadas", "checksum": {"name": "sha256", "checksum": "8c4805e73ee577547be098e1d483c2cdc1a04b7e553a2a8a1ae2fbdb22f6f748"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View com os dados agrupados dos pontos de paradas existentes e vistoriados (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7854168, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`agg_stops_vistoriadas`", "raw_code": "WITH t AS (\nSELECT\n    data_versao,\n    case\n        when\n        json_value(content, '$.IDPropriedadeParada') is null\n        then false\n    else true\n    end flag_vistoriada,\n    json_value(content, '$.AP') as AP,\n    json_value(content, '$.RA') as RA,\n    json_value(content, '$.Bairro') as Bairro\nFROM {{ ref('stops') }}\nwhere json_value(content, '$.PontoExistente') = 'SIM'\nand json_value(content, '$.idModalSmtr') in ('22', 'O'))\nselect data_versao, AP, Bairro,\n    sum(case when flag_vistoriada then 1 else 0 end) n_vistoridas,\n    count(*) n_pontos\nfrom t\ngroup by data_versao, AP, Bairro\norder by 1,2,3", "language": "sql", "refs": [{"name": "stops", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.stops"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/agg_stops_vistoriadas.sql", "compiled": true, "compiled_code": "WITH t AS (\nSELECT\n    data_versao,\n    case\n        when\n        json_value(content, '$.IDPropriedadeParada') is null\n        then false\n    else true\n    end flag_vistoriada,\n    json_value(content, '$.AP') as AP,\n    json_value(content, '$.RA') as RA,\n    json_value(content, '$.Bairro') as Bairro\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops`\nwhere json_value(content, '$.PontoExistente') = 'SIM'\nand json_value(content, '$.idModalSmtr') in ('22', 'O'))\nselect data_versao, AP, Bairro,\n    sum(case when flag_vistoriada then 1 else 0 end) n_vistoridas,\n    count(*) n_pontos\nfrom t\ngroup by data_versao, AP, Bairro\norder by 1,2,3", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.frota_determinada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "frota_determinada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/frota_determinada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/frota_determinada.sql", "unique_id": "model.rj_smtr.frota_determinada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "frota_determinada"], "alias": "frota_determinada", "checksum": {"name": "sha256", "checksum": "4d40201965580033208ac661939d35df19002486c9bba9a43adf2e4a80450f1b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro da frota determinada (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7860687, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`frota_determinada`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(route_id AS STRING) route_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"frota_determinada_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/frota_determinada.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(route_id AS STRING) route_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.frota_determinada as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.frota_determinada_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "frota_determinada_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/frota_determinada_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/frota_determinada_desaninhada.sql", "unique_id": "model.rj_smtr.frota_determinada_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "frota_determinada_desaninhada"], "alias": "frota_determinada_desaninhada", "checksum": {"name": "sha256", "checksum": "07e83057bf93f574a122ee2f690025122e879825d2fb61c3e7079ee9ee0ee816"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro da frota determinada (frota_determinada) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7864938, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`frota_determinada_desaninhada`", "raw_code": "select\n    data_versao,\n    json_value(content, '$.IDFrotaDeterminada') IDFrotaDeterminada,\n    json_value(content, '$.TipoOnibusID') TipoOnibusID,\n    SAFE_CAST(json_value(content, '$.FrotaDeterminada') AS INT64) FrotaDeterminada,\n    SAFE_CAST(json_value(content, '$.FrotaServico') AS INT64) FrotaServico,\n    json_value(content, '$.dataInicioVigencia') dataInicioVigencia,\n    json_value(content, '$.dataFimVigencia') dataFimVigencia,\n    json_value(content, '$.legislacaoInicioVigencia') legislacaoInicioVigencia,\n    json_value(content, '$.legislacaoFimVigencia') legislacaoFimVigencia,\n    json_value(content, '$.route_id') route_id\nFROM {{ ref('frota_determinada') }}", "language": "sql", "refs": [{"name": "frota_determinada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.frota_determinada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/frota_determinada_desaninhada.sql", "compiled": true, "compiled_code": "select\n    data_versao,\n    json_value(content, '$.IDFrotaDeterminada') IDFrotaDeterminada,\n    json_value(content, '$.TipoOnibusID') TipoOnibusID,\n    SAFE_CAST(json_value(content, '$.FrotaDeterminada') AS INT64) FrotaDeterminada,\n    SAFE_CAST(json_value(content, '$.FrotaServico') AS INT64) FrotaServico,\n    json_value(content, '$.dataInicioVigencia') dataInicioVigencia,\n    json_value(content, '$.dataFimVigencia') dataFimVigencia,\n    json_value(content, '$.legislacaoInicioVigencia') legislacaoInicioVigencia,\n    json_value(content, '$.legislacaoFimVigencia') legislacaoFimVigencia,\n    json_value(content, '$.route_id') route_id\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`frota_determinada`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.trips_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "trips_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/trips_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/trips_desaninhada.sql", "unique_id": "model.rj_smtr.trips_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "trips_desaninhada"], "alias": "trips_desaninhada", "checksum": {"name": "sha256", "checksum": "bb938a701d11ef57d83e84ec7416f82b60343636c80aeacb683ac58a051b79d9"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro dos itiner\u00e1rios (trips) (Descontinuada a partir de 2022-09-13).", "columns": {"trip_id": {"name": "trip_id", "description": "Identificador \u00fanico para um itiner\u00e1rio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "Identificador \u00fanica para a route (servi\u00e7o)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7837288, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`", "raw_code": "with contents as (\n  select\n    trip_id,\n    json_value(content, \"$.route_id\") route_id,\n    json_value(content, \"$.service_id\") service_id,\n    json_value(content, \"$.trip_headsign\") trip_headsign,\n    json_value(content, \"$.trip_short_name\") trip_short_name,\n    json_value(content, \"$.direction_id\") direction_id,\n    json_value(content, \"$.block_id\") block_id,\n    json_value(content, \"$.shape_id\") shape_id,\n    json_value(content, \"$.variacao_itinerario\") variacao_itinerario,\n    json_value(content, \"$.versao\") versao,\n    json_value(content, \"$.complemento\") complemento,\n    json_value(content, \"$.via\") via,\n    json_value(content, \"$.observacoes\") observacoes,\n    json_value(content, \"$.ultima_medicao_operante\") ultima_medicao_operante,\n    json_value(content, \"$.idModalSmtr\") id_modal_smtr,\n    json_value(content, \"$.Direcao\") direcao,\n    json_value(content, \"$.id\") id,\n    DATE(data_versao) data_versao\n\n  from {{ ref('trips') }}\n),\nroutes as (\n  select\n    *\n  from {{ ref('routes_desaninhada') }}\n),\nultimas_versoes as (\n  select\n    c.*,\n    row_number() over(\n      partition by c.data_versao, c.route_id, c.direction_id, c.variacao_itinerario\n      order by c.versao desc\n    ) rn\n  from contents c\n  join routes r\n  on c.route_id = r.route_id\n  and c.data_versao = r.data_versao\n)\nselect\n  * except(rn)\nfrom ultimas_versoes\nwhere rn=1", "language": "sql", "refs": [{"name": "trips", "package": null, "version": null}, {"name": "routes_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.trips", "model.rj_smtr.routes_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/trips_desaninhada.sql", "compiled": true, "compiled_code": "with contents as (\n  select\n    trip_id,\n    json_value(content, \"$.route_id\") route_id,\n    json_value(content, \"$.service_id\") service_id,\n    json_value(content, \"$.trip_headsign\") trip_headsign,\n    json_value(content, \"$.trip_short_name\") trip_short_name,\n    json_value(content, \"$.direction_id\") direction_id,\n    json_value(content, \"$.block_id\") block_id,\n    json_value(content, \"$.shape_id\") shape_id,\n    json_value(content, \"$.variacao_itinerario\") variacao_itinerario,\n    json_value(content, \"$.versao\") versao,\n    json_value(content, \"$.complemento\") complemento,\n    json_value(content, \"$.via\") via,\n    json_value(content, \"$.observacoes\") observacoes,\n    json_value(content, \"$.ultima_medicao_operante\") ultima_medicao_operante,\n    json_value(content, \"$.idModalSmtr\") id_modal_smtr,\n    json_value(content, \"$.Direcao\") direcao,\n    json_value(content, \"$.id\") id,\n    DATE(data_versao) data_versao\n\n  from `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips`\n),\nroutes as (\n  select\n    *\n  from `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`\n),\nultimas_versoes as (\n  select\n    c.*,\n    row_number() over(\n      partition by c.data_versao, c.route_id, c.direction_id, c.variacao_itinerario\n      order by c.versao desc\n    ) rn\n  from contents c\n  join routes r\n  on c.route_id = r.route_id\n  and c.data_versao = r.data_versao\n)\nselect\n  * except(rn)\nfrom ultimas_versoes\nwhere rn=1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.shapes_geom": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "shapes_geom", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/shapes_geom.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/shapes_geom.sql", "unique_id": "model.rj_smtr.shapes_geom", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "shapes_geom"], "alias": "shapes_geom", "checksum": {"name": "sha256", "checksum": "2d125c234c73d4ed554eade25b3e7c89ec5b8177aae6d4da38e404f5d920b560"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data_versao", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Tabela com as linestrings de cada itinar\u00e1rio consolidadas a partir da captura ponto a ponto (Descontinuada a partir de 2022-09-13).", "columns": {"shape_id": {"name": "shape_id", "description": "", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_sigmob", "partition_by": {"field": "data_versao", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.7843306, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`", "raw_code": "{{ config(\n       materialized='incremental',\n       partition_by={\n              \"field\":\"data_versao\",\n              \"data_type\": \"date\",\n              \"granularity\":\"day\"\n       }\n)\n}}\n{% if is_incremental() and execute %}\n       {% set start_date = run_query(\"select max(data_versao) from \" ~ this).columns[0].values()[0] %}\n{% else %}\n       {% set start_date = \"2021-08-24\" %}\n{% endif %}\nwith\n       trips as (\n              SELECT\n                     trip_id,\n                     shape_id,\n                     route_id,\n                     DATE(data_versao) data_versao\n              FROM {{ ref('trips_desaninhada') }} t\n              WHERE DATE(data_versao) between DATE(\"{{start_date}}\") and DATE_ADD(DATE(\"{{start_date}}\"), INTERVAL 15 DAY)\n       ),\n       linhas as (\n              SELECT\n                     trip_id,\n                     shape_id,\n                     t.route_id,\n                     route_short_name linha,\n                     idModalSmtr id_modal_smtr,\n                     t.data_versao,\n              FROM trips t\n              INNER JOIN (\n              SELECT *\n              FROM {{ ref('routes_desaninhada') }}\n              WHERE DATE(data_versao) between DATE(\"{{start_date}}\") and DATE_ADD(DATE(\"{{start_date}}\"), INTERVAL 15 DAY)\n              ) r\n              on t.route_id = r.route_id\n              and t.data_versao = r.data_versao\n       ),\n       contents as (\n       -- EXTRACTS VALUES FROM JSON STRING FIELD 'content'\n              SELECT\n                     shape_id,\n                     ST_GEOGPOINT(\n                            SAFE_CAST(json_value(content, \"$.shape_pt_lon\") AS FLOAT64),\n                            SAFE_CAST(json_value(content, \"$.shape_pt_lat\") AS FLOAT64)\n                     ) ponto_shape,\n                     SAFE_CAST(json_value(content, \"$.shape_pt_sequence\") as INT64) shape_pt_sequence,\n                     DATE(data_versao) AS data_versao\n              FROM {{ ref('shapes') }} s\n              WHERE DATE(data_versao) between DATE(\"{{start_date}}\") and DATE_ADD(DATE(\"{{start_date}}\"), INTERVAL 15 DAY)\n       ),\n       pts as (\n              select\n                     *,\n                     max(shape_pt_sequence) over(\n                            partition by data_versao, shape_id\n                     ) final_pt_sequence\n              from contents c\n              order by data_versao, shape_id, shape_pt_sequence\n       ),\n       shapes as (\n              -- BUILD LINESTRINGS OVER SHAPE POINTS\n              SELECT\n                     shape_id,\n                     data_versao,\n                     st_makeline(ARRAY_AGG(ponto_shape)) as shape\n              FROM pts\n              GROUP BY 1,2\n       ),\n       boundary as (\n              -- EXTRACT START AND END POINTS FROM SHAPES\n              SELECT\n                     c1.shape_id,\n                     c1.ponto_shape start_pt,\n                     c2.ponto_shape end_pt,\n                     c1.data_versao\n              FROM (select * from pts where shape_pt_sequence = 1) c1\n              JOIN (select * from pts where shape_pt_sequence = final_pt_sequence) c2\n              ON c1.shape_id = c2.shape_id and c1.data_versao = c2.data_versao\n       ),\n       merged as (\n              -- JOIN SHAPES AND BOUNDARY POINTS\n              SELECT\n                     s.*,\n                     b.* except(data_versao, shape_id),\n                     round(ST_LENGTH(shape),1) shape_distance,\n              FROM shapes s\n              JOIN boundary b\n              ON s.shape_id = b.shape_id and s.data_versao = b.data_versao\n       ),\n       ids as (\n              SELECT\n                     trip_id,\n                     m.shape_id,\n                     route_id,\n                     id_modal_smtr,\n                     replace(linha, \" \", \"\") as linha_gtfs,\n                     shape,\n                     shape_distance,\n                     start_pt,\n                     end_pt,\n                     m.data_versao,\n                     row_number() over(\n                            partition by m.data_versao, m.shape_id, l.trip_id\n                     ) rn\n              FROM merged m\n              JOIN linhas l\n              ON m.shape_id = l.shape_id\n              AND m.data_versao = l.data_versao\n              -- mudar join para o route_id em todas as dependencias\n       )\nSELECT\n       * except(rn)\nFROM ids\nWHERE rn = 1\n{% if is_incremental %}\nAND data_versao > DATE(\"{{start_date}}\")\n{% endif %}", "language": "sql", "refs": [{"name": "trips_desaninhada", "package": null, "version": null}, {"name": "routes_desaninhada", "package": null, "version": null}, {"name": "shapes", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.trips_desaninhada", "model.rj_smtr.routes_desaninhada", "model.rj_smtr.shapes"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/shapes_geom.sql", "compiled": true, "compiled_code": "\n\n       \n\nwith\n       trips as (\n              SELECT\n                     trip_id,\n                     shape_id,\n                     route_id,\n                     DATE(data_versao) data_versao\n              FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada` t\n              WHERE DATE(data_versao) between DATE(\"2022-08-14\") and DATE_ADD(DATE(\"2022-08-14\"), INTERVAL 15 DAY)\n       ),\n       linhas as (\n              SELECT\n                     trip_id,\n                     shape_id,\n                     t.route_id,\n                     route_short_name linha,\n                     idModalSmtr id_modal_smtr,\n                     t.data_versao,\n              FROM trips t\n              INNER JOIN (\n              SELECT *\n              FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`\n              WHERE DATE(data_versao) between DATE(\"2022-08-14\") and DATE_ADD(DATE(\"2022-08-14\"), INTERVAL 15 DAY)\n              ) r\n              on t.route_id = r.route_id\n              and t.data_versao = r.data_versao\n       ),\n       contents as (\n       -- EXTRACTS VALUES FROM JSON STRING FIELD 'content'\n              SELECT\n                     shape_id,\n                     ST_GEOGPOINT(\n                            SAFE_CAST(json_value(content, \"$.shape_pt_lon\") AS FLOAT64),\n                            SAFE_CAST(json_value(content, \"$.shape_pt_lat\") AS FLOAT64)\n                     ) ponto_shape,\n                     SAFE_CAST(json_value(content, \"$.shape_pt_sequence\") as INT64) shape_pt_sequence,\n                     DATE(data_versao) AS data_versao\n              FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes` s\n              WHERE DATE(data_versao) between DATE(\"2022-08-14\") and DATE_ADD(DATE(\"2022-08-14\"), INTERVAL 15 DAY)\n       ),\n       pts as (\n              select\n                     *,\n                     max(shape_pt_sequence) over(\n                            partition by data_versao, shape_id\n                     ) final_pt_sequence\n              from contents c\n              order by data_versao, shape_id, shape_pt_sequence\n       ),\n       shapes as (\n              -- BUILD LINESTRINGS OVER SHAPE POINTS\n              SELECT\n                     shape_id,\n                     data_versao,\n                     st_makeline(ARRAY_AGG(ponto_shape)) as shape\n              FROM pts\n              GROUP BY 1,2\n       ),\n       boundary as (\n              -- EXTRACT START AND END POINTS FROM SHAPES\n              SELECT\n                     c1.shape_id,\n                     c1.ponto_shape start_pt,\n                     c2.ponto_shape end_pt,\n                     c1.data_versao\n              FROM (select * from pts where shape_pt_sequence = 1) c1\n              JOIN (select * from pts where shape_pt_sequence = final_pt_sequence) c2\n              ON c1.shape_id = c2.shape_id and c1.data_versao = c2.data_versao\n       ),\n       merged as (\n              -- JOIN SHAPES AND BOUNDARY POINTS\n              SELECT\n                     s.*,\n                     b.* except(data_versao, shape_id),\n                     round(ST_LENGTH(shape),1) shape_distance,\n              FROM shapes s\n              JOIN boundary b\n              ON s.shape_id = b.shape_id and s.data_versao = b.data_versao\n       ),\n       ids as (\n              SELECT\n                     trip_id,\n                     m.shape_id,\n                     route_id,\n                     id_modal_smtr,\n                     replace(linha, \" \", \"\") as linha_gtfs,\n                     shape,\n                     shape_distance,\n                     start_pt,\n                     end_pt,\n                     m.data_versao,\n                     row_number() over(\n                            partition by m.data_versao, m.shape_id, l.trip_id\n                     ) rn\n              FROM merged m\n              JOIN linhas l\n              ON m.shape_id = l.shape_id\n              AND m.data_versao = l.data_versao\n              -- mudar join para o route_id em todas as dependencias\n       )\nSELECT\n       * except(rn)\nFROM ids\nWHERE rn = 1\n\nAND data_versao > DATE(\"2022-08-14\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.agency_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "agency_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/agency_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/agency_desaninhada.sql", "unique_id": "model.rj_smtr.agency_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "agency_desaninhada"], "alias": "agency_desaninhada", "checksum": {"name": "sha256", "checksum": "3f570555667b8fdd7a57517e84568dca93a6bfc14dc40a0d7279d1a05aadcd89"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro das ag\u00eancias de transporte p\u00fablico (agency) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7849894, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`agency_desaninhada`", "raw_code": "SELECT\n  agency_id,\n  JSON_VALUE(content, \"$.agency_name\") agency_name,\n  JSON_VALUE(content, \"$.agency_url\") agency_url,\n  JSON_VALUE(content, \"$.agency_timezone\") agency_timezone,\n  JSON_VALUE(content, \"$.agency_lang\") agency_lang,\n  JSON_VALUE(content, \"$.agency_phone\") agency_phone,\n  DATE(data_versao) data_versao\nFROM {{ ref('agency') }}", "language": "sql", "refs": [{"name": "agency", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.agency"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/agency_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\n  agency_id,\n  JSON_VALUE(content, \"$.agency_name\") agency_name,\n  JSON_VALUE(content, \"$.agency_url\") agency_url,\n  JSON_VALUE(content, \"$.agency_timezone\") agency_timezone,\n  JSON_VALUE(content, \"$.agency_lang\") agency_lang,\n  JSON_VALUE(content, \"$.agency_phone\") agency_phone,\n  DATE(data_versao) data_versao\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`agency`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.linhas": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "linhas", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/linhas.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/linhas.sql", "unique_id": "model.rj_smtr.linhas", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "linhas"], "alias": "linhas", "checksum": {"name": "sha256", "checksum": "3adf3a5ae7ae1457ae2600acd80c2a0b71945bf20f05b2ff02d29983b65617e4"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro das linhas (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7873476, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`linhas`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(linha_id AS STRING) linha_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"linhas_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/linhas.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(linha_id AS STRING) linha_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.linhas as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.agency": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "agency", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/agency.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/agency.sql", "unique_id": "model.rj_smtr.agency", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "agency"], "alias": "agency", "checksum": {"name": "sha256", "checksum": "2b96d47a82811f28f584ad2bdf3ae8088bc03ecf628b3e651d01cf23413f98f8"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro das ag\u00eancias de transporte p\u00fablico (Descontinuada a partir de 2022-09-13).", "columns": {"agency_id": {"name": "agency_id", "description": "Identificador \u00fanico para uma ag\u00eancia", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "content": {"name": "content", "description": "Dados brutos capturados aninhados em formato JSON", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao": {"name": "data_versao", "description": "Data de refer\u00eancia do planejamento (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7845623, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`agency`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(agency_id AS STRING) agency_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var('agency_staging')}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/agency.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(agency_id AS STRING) agency_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.agency as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.data_versao_efetiva": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "data_versao_efetiva", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/data_versao_efetiva.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/data_versao_efetiva.sql", "unique_id": "model.rj_smtr.data_versao_efetiva", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "data_versao_efetiva"], "alias": "data_versao_efetiva", "checksum": {"name": "sha256", "checksum": "7faca82db7e9118ab3583daafce0d3f4f370ba4aa345d3424b993986de140d87"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "data", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Especifica qual data versao mais recente dispon\u00edvel para uma determinada data (Descontinuada a partir de 2022-09-13).", "columns": {"data": {"name": "data", "description": "The primary key for this table", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_agency": {"name": "data_versao_efetiva_agency", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_calendar": {"name": "data_versao_efetiva_calendar", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_frota_determinada": {"name": "data_versao_efetiva_frota_determinada", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_holidays": {"name": "data_versao_efetiva_holidays", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_linhas": {"name": "data_versao_efetiva_linhas", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_routes": {"name": "data_versao_efetiva_routes", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_shapes": {"name": "data_versao_efetiva_shapes", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_stop_details": {"name": "data_versao_efetiva_stop_details", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_stop_times": {"name": "data_versao_efetiva_stop_times", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_stops": {"name": "data_versao_efetiva_stops", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao_efetiva_trips": {"name": "data_versao_efetiva_trips", "description": "data_versao mais recente para a tabela descrita no sufixo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "schema": "br_rj_riodejaneiro_sigmob", "unique_key": "data", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.782146, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`data_versao_efetiva`", "raw_code": "{{\n    config(\n        materialized='incremental',\n        unique_key='data',\n        partition_by={\n            \"field\":\"data\",\n            \"data_type\": \"date\",\n            \"granularity\":\"day\"\n        }\n    )\n}}\n\nwith\nagency as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_agency\")}}\") THEN DATE(\"{{var(\"data_inclusao_agency\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"agency\") }}\n    )\nON data = DATE(data_versao)\n),\ncalendar as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_calendar\")}}\") THEN DATE(\"{{var(\"data_inclusao_calendar\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"calendar\") }}\n    )\nON data = DATE(data_versao)\n),\nfrota_determinada as (\nSELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_frota_determinada\")}}\") THEN DATE(\"{{var(\"data_inclusao_frota_determinada\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"frota_determinada\") }}\n    )\nON DATE(data) = DATE(data_versao)\n),\nholidays as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_holidays\")}}\") THEN DATE(\"{{var(\"data_inclusao_holidays\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"holidays\") }}\n    )\nON data = DATE(data_versao)\n),\nlinhas as (\n    SELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_linhas\")}}\") THEN DATE(\"{{var(\"data_inclusao_linhas\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"linhas\") }}\n    )\nON data = DATE(data_versao)\n),\nroutes as (\nSELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_routes\")}}\") THEN DATE(\"{{var(\"data_inclusao_routes\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"routes\") }}\n    )\nON data = data_versao\n),\nshapes as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_shapes\")}}\") THEN DATE(\"{{var(\"data_inclusao_shapes\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"shapes_geom\") }}\n    )\nON data = DATE(data_versao)\n),\nstop_details as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_stop_details\")}}\") THEN DATE(\"{{var(\"data_inclusao_stop_details\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"stop_details\") }}\n    )\nON data = DATE(data_versao)\n),\nstop_times as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_stop_times\")}}\") THEN DATE(\"{{var(\"data_inclusao_stop_times\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"stop_times\") }}\n    )\nON data = DATE(data_versao)\n),\nstops as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_stops\")}}\") THEN DATE(\"{{var(\"data_inclusao_stops\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"stops\") }}\n    )\nON data = DATE(data_versao)\n),\ntrips as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"{{var(\"data_inclusao_trips\")}}\") THEN DATE(\"{{var(\"data_inclusao_trips\")}}\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM {{ ref(\"trips\") }}\n    )\nON data = DATE(data_versao)\n),\njoined as (\n    select\n    DATE_ADD(s.data, INTERVAL 1 DAY) data,\n    a.data_versao_efetiva as data_versao_efetiva_agency,\n    c.data_versao_efetiva as data_versao_efetiva_calendar,\n    f.data_versao_efetiva as data_versao_efetiva_frota_determinada,\n    h.data_versao_efetiva as data_versao_efetiva_holidays,\n    l.data_versao_efetiva as data_versao_efetiva_linhas,\n    r.data_versao_efetiva as data_versao_efetiva_routes,\n    s.data_versao_efetiva as data_versao_efetiva_shapes,\n    sd.data_versao_efetiva as data_versao_efetiva_stop_details,\n    st.data_versao_efetiva as data_versao_efetiva_stop_times,\n    sp.data_versao_efetiva as data_versao_efetiva_stops,\n    t.data_versao_efetiva as data_versao_efetiva_trips\n    from agency a\n    join shapes s\n    on s.data = a.data\n    join calendar c\n    on a.data = c.data\n    join frota_determinada f\n    on a.data = f.data\n    join holidays h\n    on a.data = h.data\n    join linhas l\n    on a.data = l.data\n    join routes r\n    on a.data = r.data\n    join stops sp\n    on a.data = sp.data\n    join stop_details sd\n    on a.data = sd.data\n    join stop_times st\n    on a.data = st.data\n    join trips t\n    on a.data = t.data\n)\nselect *\nfrom joined\n{% if is_incremental() %}\n    {%set max_date_partition = run_query(\"select max(DATE(data)) from \" ~ this).columns[0].values()[0]%}\n    where DATE(data) > (\"{{max_date_partition}}\")\n{% endif %}", "language": "sql", "refs": [{"name": "agency", "package": null, "version": null}, {"name": "calendar", "package": null, "version": null}, {"name": "frota_determinada", "package": null, "version": null}, {"name": "holidays", "package": null, "version": null}, {"name": "linhas", "package": null, "version": null}, {"name": "routes", "package": null, "version": null}, {"name": "shapes_geom", "package": null, "version": null}, {"name": "stop_details", "package": null, "version": null}, {"name": "stop_times", "package": null, "version": null}, {"name": "stops", "package": null, "version": null}, {"name": "trips", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.agency", "model.rj_smtr.calendar", "model.rj_smtr.frota_determinada", "model.rj_smtr.holidays", "model.rj_smtr.linhas", "model.rj_smtr.routes", "model.rj_smtr.shapes_geom", "model.rj_smtr.stop_details", "model.rj_smtr.stop_times", "model.rj_smtr.stops", "model.rj_smtr.trips"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/data_versao_efetiva.sql", "compiled": true, "compiled_code": "\n\nwith\nagency as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-03\") THEN DATE(\"2021-08-03\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`agency`\n    )\nON data = DATE(data_versao)\n),\ncalendar as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-09-30\") THEN DATE(\"2021-09-30\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`calendar`\n    )\nON data = DATE(data_versao)\n),\nfrota_determinada as (\nSELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-09-30\") THEN DATE(\"2021-09-30\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`frota_determinada`\n    )\nON DATE(data) = DATE(data_versao)\n),\nholidays as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-11-05\") THEN DATE(\"2021-11-05\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`holidays`\n    )\nON data = DATE(data_versao)\n),\nlinhas as (\n    SELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-03\") THEN DATE(\"2021-08-03\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`linhas`\n    )\nON data = DATE(data_versao)\n),\nroutes as (\nSELECT\n    data,\n    DATE(data_versao) as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-03\") THEN DATE(\"2021-08-03\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes`\n    )\nON data = data_versao\n),\nshapes as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-24\") THEN DATE(\"2021-08-24\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n    )\nON data = DATE(data_versao)\n),\nstop_details as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-09-30\") THEN DATE(\"2021-09-30\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_details`\n    )\nON data = DATE(data_versao)\n),\nstop_times as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-03\") THEN DATE(\"2021-08-03\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_times`\n    )\nON data = DATE(data_versao)\n),\nstops as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-24\") THEN DATE(\"2021-08-24\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops`\n    )\nON data = DATE(data_versao)\n),\ntrips as (\nSELECT\n    data,\n    data_versao as data_versao_original,\n    CASE WHEN data <= DATE(\"2021-08-03\") THEN DATE(\"2021-08-03\") ELSE\n        LAST_VALUE(DATE(data_versao) IGNORE NULLS) OVER (ORDER BY data ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\n    END AS data_versao_efetiva\nFROM UNNEST(GENERATE_DATE_ARRAY(DATE('2021-01-01'), CURRENT_DATE())) data\nLEFT JOIN (\n    SELECT DISTINCT data_versao\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips`\n    )\nON data = DATE(data_versao)\n),\njoined as (\n    select\n    DATE_ADD(s.data, INTERVAL 1 DAY) data,\n    a.data_versao_efetiva as data_versao_efetiva_agency,\n    c.data_versao_efetiva as data_versao_efetiva_calendar,\n    f.data_versao_efetiva as data_versao_efetiva_frota_determinada,\n    h.data_versao_efetiva as data_versao_efetiva_holidays,\n    l.data_versao_efetiva as data_versao_efetiva_linhas,\n    r.data_versao_efetiva as data_versao_efetiva_routes,\n    s.data_versao_efetiva as data_versao_efetiva_shapes,\n    sd.data_versao_efetiva as data_versao_efetiva_stop_details,\n    st.data_versao_efetiva as data_versao_efetiva_stop_times,\n    sp.data_versao_efetiva as data_versao_efetiva_stops,\n    t.data_versao_efetiva as data_versao_efetiva_trips\n    from agency a\n    join shapes s\n    on s.data = a.data\n    join calendar c\n    on a.data = c.data\n    join frota_determinada f\n    on a.data = f.data\n    join holidays h\n    on a.data = h.data\n    join linhas l\n    on a.data = l.data\n    join routes r\n    on a.data = r.data\n    join stops sp\n    on a.data = sp.data\n    join stop_details sd\n    on a.data = sd.data\n    join stop_times st\n    on a.data = st.data\n    join trips t\n    on a.data = t.data\n)\nselect *\nfrom joined\n\n    \n    where DATE(data) > (\"2023-01-28\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.calendar": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "calendar", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/calendar.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/calendar.sql", "unique_id": "model.rj_smtr.calendar", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "calendar"], "alias": "calendar", "checksum": {"name": "sha256", "checksum": "1bfb9427f105f6e4bcd0b68492127b88ba37ff996f94eb22229f924bfdf3c81b"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro das datas de servi\u00e7o especificadas usando uma programa\u00e7\u00e3o semanal com datas de in\u00edcio e t\u00e9rmino (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.785531, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`calendar`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(service_id AS STRING) service_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"calendar_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/calendar.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(service_id AS STRING) service_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.calendar as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.calendar_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "calendar_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/calendar_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/calendar_desaninhada.sql", "unique_id": "model.rj_smtr.calendar_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "calendar_desaninhada"], "alias": "calendar_desaninhada", "checksum": {"name": "sha256", "checksum": "ad119773d1b4840bb4359055efb81e6428b4d2e8aedd208f480baec08daff45d"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro das datas de servi\u00e7o especificadas (calendar) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7859561, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`calendar_desaninhada`", "raw_code": "SELECT\n  service_id,\n  JSON_VALUE(content, \"$.monday\") monday,\n  JSON_VALUE(content, \"$.tuesday\") tuesday,\n  JSON_VALUE(content, \"$.wednesday\") wednesday,\n  JSON_VALUE(content, \"$.thursday\") thursday,\n  JSON_VALUE(content, \"$.friday\") friday,\n  JSON_VALUE(content, \"$.saturday\") saturday,\n  JSON_VALUE(content, \"$.sunday\") sunday,\n  JSON_VALUE(content, \"$.start_date\") start_date,\n  JSON_VALUE(content, \"$.end_date\") end_date,\n  DATE(data_versao) data_versao\n\nFROM {{ ref('calendar') }}", "language": "sql", "refs": [{"name": "calendar", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.calendar"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/calendar_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\n  service_id,\n  JSON_VALUE(content, \"$.monday\") monday,\n  JSON_VALUE(content, \"$.tuesday\") tuesday,\n  JSON_VALUE(content, \"$.wednesday\") wednesday,\n  JSON_VALUE(content, \"$.thursday\") thursday,\n  JSON_VALUE(content, \"$.friday\") friday,\n  JSON_VALUE(content, \"$.saturday\") saturday,\n  JSON_VALUE(content, \"$.sunday\") sunday,\n  JSON_VALUE(content, \"$.start_date\") start_date,\n  JSON_VALUE(content, \"$.end_date\") end_date,\n  DATE(data_versao) data_versao\n\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`calendar`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.linhas_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "linhas_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/linhas_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/linhas_desaninhada.sql", "unique_id": "model.rj_smtr.linhas_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "linhas_desaninhada"], "alias": "linhas_desaninhada", "checksum": {"name": "sha256", "checksum": "7ec6ddc37f4b7b4da98f116333e9aa4fbca3cae8f2a6d4ae3b392d84d7127dcb"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro das linhas (linhas) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7877705, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`linhas_desaninhada`", "raw_code": "SELECT\n  linha_id,\n  JSON_VALUE(content, \"$.agency_id\") agency_id,\n  JSON_VALUE(content, \"$.sigla\") sigla,\n  JSON_VALUE(content, \"$.idModalSmtr\") id_modal_smtr,\n  JSON_VALUE(content, \"$.TipoLinha\") tipo_linha,\n  JSON_VALUE(content, \"$.NomeLinha\") nome_linha,\n  JSON_VALUE(content, \"$.SiglaCompleta\") sigla_completa,\n  JSON_VALUE(content, \"$.NumeroServicos\") numero_servicos,\n  JSON_VALUE(content, \"$.ativa\") ativa,\n  JSON_VALUE(content, \"$.FrotaDeterminada\") frota_determinada,\n  JSON_VALUE(content, \"$.LegisFrotaDeterminada\") legis_frota_determinada,\n  JSON_VALUE(content, \"$.FrotaOperante\") frota_operante,\n  JSON_VALUE(content, \"$.id\") id,\n  JSON_VALUE(content, \"$.Apresentacao\") apresentacao,\n  JSON_VALUE(content, \"$.agency_name\") agency_name,\n  DATE(data_versao) data_versao\nFROM {{ ref('linhas') }}", "language": "sql", "refs": [{"name": "linhas", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.linhas"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/linhas_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\n  linha_id,\n  JSON_VALUE(content, \"$.agency_id\") agency_id,\n  JSON_VALUE(content, \"$.sigla\") sigla,\n  JSON_VALUE(content, \"$.idModalSmtr\") id_modal_smtr,\n  JSON_VALUE(content, \"$.TipoLinha\") tipo_linha,\n  JSON_VALUE(content, \"$.NomeLinha\") nome_linha,\n  JSON_VALUE(content, \"$.SiglaCompleta\") sigla_completa,\n  JSON_VALUE(content, \"$.NumeroServicos\") numero_servicos,\n  JSON_VALUE(content, \"$.ativa\") ativa,\n  JSON_VALUE(content, \"$.FrotaDeterminada\") frota_determinada,\n  JSON_VALUE(content, \"$.LegisFrotaDeterminada\") legis_frota_determinada,\n  JSON_VALUE(content, \"$.FrotaOperante\") frota_operante,\n  JSON_VALUE(content, \"$.id\") id,\n  JSON_VALUE(content, \"$.Apresentacao\") apresentacao,\n  JSON_VALUE(content, \"$.agency_name\") agency_name,\n  DATE(data_versao) data_versao\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`linhas`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.routes_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "routes_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/routes_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/routes_desaninhada.sql", "unique_id": "model.rj_smtr.routes_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "routes_desaninhada"], "alias": "routes_desaninhada", "checksum": {"name": "sha256", "checksum": "28d7d6168e2a2a69eb6a3fca0374dfb5fe0febcc27a8a8b5c3d9ada635f6e819"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro dos servi\u00e7os (routes) (Descontinuada a partir de 2022-09-13).", "columns": {"route_id": {"name": "route_id", "description": "", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.782798, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`", "raw_code": "with desaninhada as (\n    select\n    data_versao,\n    json_value(content, '$.agency_id') agency_id,\n    json_value(content, '$.route_short_name') route_short_name,\n    json_value(content, '$.route_long_name') route_long_name,\n    json_value(content, '$.route_desc') route_desc,\n    json_value(content, '$.route_type') route_type,\n    json_value(content, '$.route_url') route_url,\n    json_value(content, '$.route_color') route_color,\n    json_value(content, '$.route_text_color') route_text_color,\n    json_value(content, '$.ATIVA') ATIVA,\n    json_value(content, '$.ATUALIZADO') ATUALIZADO,\n    json_value(content, '$.Descricao') Descricao,\n    json_value(content, '$.idModalSmtr') idModalSmtr,\n    json_value(content, '$.linha_id') linha_id,\n    json_value(content, '$.brs') brs,\n    json_value(content, '$.IDTipoServico') IDTipoServico,\n    json_value(content, '$.IDVariacaoServico') IDVariacaoServico,\n    json_value(content, '$.origem') origem,\n    json_value(content, '$.destino') destino,\n    json_value(content, '$.ClassificacaoEspacial') ClassificacaoEspacial,\n    json_value(content, '$.ClassificacaoHierarquica') ClassificacaoHierarquica,\n    json_value(content, '$.InicioVigencia') InicioVigencia,\n    json_value(content, '$.LegisInicioVigencia') LegisInicioVigencia,\n    json_value(content, '$.fimVigencia') fimVigencia,\n    json_value(content, '$.LegisfimVigencia') LegisfimVigencia,\n    json_value(content, '$.FlagVigente') FlagVigente,\n    json_value(content, '$.FrotaDeterminada') FrotaDeterminada,\n    json_value(content, '$.LegisFrota') LegisFrota,\n    json_value(content, '$.FrotaServico') FrotaServico,\n    json_value(content, '$.FrotaOperante') FrotaOperante,\n    json_value(content, '$.Observacoes') Observacoes,\n    json_value(content, '$.IDParadaOrigem') IDParadaOrigem,\n    json_value(content, '$.SiglaServico') SiglaServico,\n    json_value(content, '$.IDParadaDestino') IDParadaDestino,\n    json_value(content, '$.route_id') route_id,\n    json_value(content, '$.id') id,\n    json_value(content, '$.agency_name') agency_name,\n    json_value(content, '$.Via') Via,\n    json_value(content, '$.Vista') Vista,\n    json_value(content, '$.Complemento') Complemento,\n    json_value(content,'$.OLD_routes_id') old_route_id\nfrom {{ ref('routes') }}\n),\nultimas_versoes as (\n    select\n        *\n    from desaninhada\n    where DATE(fimVigencia) >= DATE(data_versao) or fimVigencia is null\n    order by route_id, fimVigencia\n)\nselect\n    *\nfrom ultimas_versoes", "language": "sql", "refs": [{"name": "routes", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.routes"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/routes_desaninhada.sql", "compiled": true, "compiled_code": "with desaninhada as (\n    select\n    data_versao,\n    json_value(content, '$.agency_id') agency_id,\n    json_value(content, '$.route_short_name') route_short_name,\n    json_value(content, '$.route_long_name') route_long_name,\n    json_value(content, '$.route_desc') route_desc,\n    json_value(content, '$.route_type') route_type,\n    json_value(content, '$.route_url') route_url,\n    json_value(content, '$.route_color') route_color,\n    json_value(content, '$.route_text_color') route_text_color,\n    json_value(content, '$.ATIVA') ATIVA,\n    json_value(content, '$.ATUALIZADO') ATUALIZADO,\n    json_value(content, '$.Descricao') Descricao,\n    json_value(content, '$.idModalSmtr') idModalSmtr,\n    json_value(content, '$.linha_id') linha_id,\n    json_value(content, '$.brs') brs,\n    json_value(content, '$.IDTipoServico') IDTipoServico,\n    json_value(content, '$.IDVariacaoServico') IDVariacaoServico,\n    json_value(content, '$.origem') origem,\n    json_value(content, '$.destino') destino,\n    json_value(content, '$.ClassificacaoEspacial') ClassificacaoEspacial,\n    json_value(content, '$.ClassificacaoHierarquica') ClassificacaoHierarquica,\n    json_value(content, '$.InicioVigencia') InicioVigencia,\n    json_value(content, '$.LegisInicioVigencia') LegisInicioVigencia,\n    json_value(content, '$.fimVigencia') fimVigencia,\n    json_value(content, '$.LegisfimVigencia') LegisfimVigencia,\n    json_value(content, '$.FlagVigente') FlagVigente,\n    json_value(content, '$.FrotaDeterminada') FrotaDeterminada,\n    json_value(content, '$.LegisFrota') LegisFrota,\n    json_value(content, '$.FrotaServico') FrotaServico,\n    json_value(content, '$.FrotaOperante') FrotaOperante,\n    json_value(content, '$.Observacoes') Observacoes,\n    json_value(content, '$.IDParadaOrigem') IDParadaOrigem,\n    json_value(content, '$.SiglaServico') SiglaServico,\n    json_value(content, '$.IDParadaDestino') IDParadaDestino,\n    json_value(content, '$.route_id') route_id,\n    json_value(content, '$.id') id,\n    json_value(content, '$.agency_name') agency_name,\n    json_value(content, '$.Via') Via,\n    json_value(content, '$.Vista') Vista,\n    json_value(content, '$.Complemento') Complemento,\n    json_value(content,'$.OLD_routes_id') old_route_id\nfrom `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes`\n),\nultimas_versoes as (\n    select\n        *\n    from desaninhada\n    where DATE(fimVigencia) >= DATE(data_versao) or fimVigencia is null\n    order by route_id, fimVigencia\n)\nselect\n    *\nfrom ultimas_versoes", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stop_times_desaninhada": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stop_times_desaninhada", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stop_times_desaninhada.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stop_times_desaninhada.sql", "unique_id": "model.rj_smtr.stop_times_desaninhada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stop_times_desaninhada"], "alias": "stop_times_desaninhada", "checksum": {"name": "sha256", "checksum": "24968d4fd8be1dca3ca6881799d44fd0e5fb982b1b35e0c5701b28aae7d3c6e4"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging com os valores da coluna content desaninhados do cadastro dos hor\u00e1rios em que um ve\u00edculo chega e sai das paradas de cada viagem (stop_times) (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7893713, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_times_desaninhada`", "raw_code": "SELECT\n  stop_id,\n  JSON_VALUE(content, \"$.trip_id\") trip_id,\n  JSON_VALUE(content, \"$.arrival_time\") arrival_time,\n  JSON_VALUE(content, \"$.departure_time\") departure_time,\n  JSON_VALUE(content, \"$.stop_sequence\") stop_sequence,\n  JSON_VALUE(content, \"$.shape_dist_traveled\") shape_dist_traveled,\n  DATE(data_versao) data_versao\nFROM {{ ref('stop_times') }}", "language": "sql", "refs": [{"name": "stop_times", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.stop_times"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stop_times_desaninhada.sql", "compiled": true, "compiled_code": "SELECT\n  stop_id,\n  JSON_VALUE(content, \"$.trip_id\") trip_id,\n  JSON_VALUE(content, \"$.arrival_time\") arrival_time,\n  JSON_VALUE(content, \"$.departure_time\") departure_time,\n  JSON_VALUE(content, \"$.stop_sequence\") stop_sequence,\n  JSON_VALUE(content, \"$.shape_dist_traveled\") shape_dist_traveled,\n  DATE(data_versao) data_versao\nFROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stop_times`", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stops": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "stops", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/stops.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/stops.sql", "unique_id": "model.rj_smtr.stops", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "stops"], "alias": "stops", "checksum": {"name": "sha256", "checksum": "986aad37bfa1a3cb37fb5629d1e8bcdc44fca38eb5a01bc0a67beaa1d347ae72"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro dos pontos de parada (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.7894824, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`stops`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"stops_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/stops.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(stop_id AS STRING) stop_id,\nREPLACE(content, \"None\", '') content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.stops as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.trips": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_sigmob", "name": "trips", "resource_type": "model", "package_name": "rj_smtr", "path": "br_rj_riodejaneiro_sigmob/trips.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/trips.sql", "unique_id": "model.rj_smtr.trips", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "trips"], "alias": "trips", "checksum": {"name": "sha256", "checksum": "ff57f9b953adea93374741e82ff61e47e031963f1a6e5db0baddb73001408715"}, "config": {"enabled": true, "alias": null, "schema": "br_rj_riodejaneiro_sigmob", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "View para os dados capturados em staging do cadastro dos itiner\u00e1rios (Descontinuada a partir de 2022-09-13).", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/br_rj_riodejaneiro_sigmob/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "br_rj_riodejaneiro_sigmob"}, "created_at": 1727709588.782912, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips`", "raw_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(trip_id AS STRING) trip_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom {{var(\"trips_staging\")}} as t", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/trips.sql", "compiled": true, "compiled_code": "/*\n\nQuery para publicar a tabela.\n\nEsse \u00e9 o lugar para:\n    - modificar nomes, ordem e tipos de colunas\n    - dar join com outras tabelas\n    - criar colunas extras (e.g. logs, propor\u00e7\u00f5es, etc.)\n\nQualquer coluna definida aqui deve tamb\u00e9m existir em `table_config.yaml`.\n\n# Al\u00e9m disso, sinta-se \u00e0 vontade para alterar alguns nomes obscuros\n# para algo um pouco mais expl\u00edcito.\n\nTIPOS:\n    - Para modificar tipos de colunas, basta substituir STRING por outro tipo v\u00e1lido.\n    - Exemplo: `SAFE_CAST(column_name AS NUMERIC) column_name`\n    - Mais detalhes: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types\n\n*/\n\nSELECT\nSAFE_CAST(trip_id AS STRING) trip_id,\nREPLACE(content,\"None\",\"\") content,\nSAFE_CAST(data_versao AS DATE) data_versao\nfrom rj-smtr-staging.br_rj_riodejaneiro_sigmob_staging.trips as t", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_penalidade_servico_dia": {"database": "rj-smtr", "schema": "financeiro", "name": "subsidio_penalidade_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "financeiro/subsidio_penalidade_servico_dia.sql", "original_file_path": "models/financeiro/subsidio_penalidade_servico_dia.sql", "unique_id": "model.rj_smtr.subsidio_penalidade_servico_dia", "fqn": ["rj_smtr", "financeiro", "subsidio_penalidade_servico_dia"], "alias": "subsidio_penalidade_servico_dia", "checksum": {"name": "sha256", "checksum": "a49330b1cce1179034fcb6d5f4f20f9f5f5a37dad7f38273022c2b01ecbe31b9"}, "config": {"enabled": true, "alias": null, "schema": "financeiro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "financeiro", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709587.075818, "relation_name": "`rj-smtr`.`financeiro`.`subsidio_penalidade_servico_dia`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    MIN(pof) AS min_pof\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia\") }}\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  penalidade AS (\n  SELECT\n    data_inicio,\n    data_fim,\n    perc_km_inferior,\n    perc_km_superior,\n    IFNULL(-valor, 0) AS valor_penalidade\n  FROM\n    {{ ref(\"valor_tipo_penalidade\") }}\n    -- rj-smtr.dashboard_subsidio_sppo.valor_tipo_penalidade\n  )\nSELECT\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    SAFE_CAST(COALESCE(pe.valor_penalidade, 0) AS NUMERIC) AS valor_penalidade,\n    '{{ var(\"version\") }}' as versao,\n    CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_dia AS s\nLEFT JOIN\n  penalidade AS pe\nON\n  s.data BETWEEN pe.data_inicio\n  AND pe.data_fim\n  AND s.min_pof >= pe.perc_km_inferior\n  AND s.min_pof < pe.perc_km_superior", "language": "sql", "refs": [{"name": "subsidio_faixa_servico_dia", "package": null, "version": null}, {"name": "valor_tipo_penalidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.valor_tipo_penalidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/financeiro/subsidio_penalidade_servico_dia.sql", "compiled": true, "compiled_code": "\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    MIN(pof) AS min_pof\n  FROM\n    `rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  penalidade AS (\n  SELECT\n    data_inicio,\n    data_fim,\n    perc_km_inferior,\n    perc_km_superior,\n    IFNULL(-valor, 0) AS valor_penalidade\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`valor_tipo_penalidade`\n    -- rj-smtr.dashboard_subsidio_sppo.valor_tipo_penalidade\n  )\nSELECT\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    SAFE_CAST(COALESCE(pe.valor_penalidade, 0) AS NUMERIC) AS valor_penalidade,\n    '' as versao,\n    CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_dia AS s\nLEFT JOIN\n  penalidade AS pe\nON\n  s.data BETWEEN pe.data_inicio\n  AND pe.data_fim\n  AND s.min_pof >= pe.perc_km_inferior\n  AND s.min_pof < pe.perc_km_superior", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem": {"database": "rj-smtr", "schema": "financeiro", "name": "subsidio_faixa_servico_dia_tipo_viagem", "resource_type": "model", "package_name": "rj_smtr", "path": "financeiro/subsidio_faixa_servico_dia_tipo_viagem.sql", "original_file_path": "models/financeiro/subsidio_faixa_servico_dia_tipo_viagem.sql", "unique_id": "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "fqn": ["rj_smtr", "financeiro", "subsidio_faixa_servico_dia_tipo_viagem"], "alias": "subsidio_faixa_servico_dia_tipo_viagem", "checksum": {"name": "sha256", "checksum": "cb8b1f7e673b71ab2746bf2b41fca65b362d7400dc787c40f2dd5bbb32718e9c"}, "config": {"enabled": true, "alias": null, "schema": "financeiro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia, faixa hor\u00e1ria e tipo de viagem.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "description": "Hor\u00e1rio inicial da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_fim": {"name": "faixa_horaria_fim", "description": "Hor\u00e1rio final da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_ar_condicionado": {"name": "indicador_ar_condicionado", "description": "Indicador se o ve\u00edculo foi licenciado com ar condicionado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_viagem": {"name": "tipo_viagem", "description": "Tipo de viagem", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_faixa": {"name": "viagens_faixa", "description": "Quantidade de viagens apuradas por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_faixa": {"name": "km_apurada_faixa", "description": "Dist\u00e2ncia apurada para o servi\u00e7o por faixa hor\u00e1ria(km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada_faixa": {"name": "km_subsidiada_faixa", "description": "Dist\u00e2ncia subsidiada para o servi\u00e7o por faixa hor\u00e1ria (km)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_apurado": {"name": "valor_apurado", "description": "Valor da dist\u00e2ncia apurada multiplicada pelo subs\u00eddio por quil\u00f4metro (sem glosa). \u00c9 zerado quando POF < 80%.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_acima_limite": {"name": "valor_acima_limite", "description": "Valor apurado das viagens que n\u00e3o foram remuneradas (por estar acima do teto de 120% / 200%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_sem_glosa": {"name": "valor_total_sem_glosa", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/financeiro/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "financeiro", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.8382058, "relation_name": "`rj-smtr`.`financeiro`.`subsidio_faixa_servico_dia_tipo_viagem`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\nWITH\n  subsidio_faixa_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    pof\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia\") }}\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  servico_km_apuracao AS (\n  SELECT\n    data,\n    servico,\n    CASE\n      WHEN tipo_viagem = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\n      WHEN tipo_viagem = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\n      WHEN tipo_viagem = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\n      WHEN tipo_viagem = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\n      ELSE tipo_viagem\n    END AS tipo_viagem,\n    id_viagem,\n    distancia_planejada,\n    subsidio_km,\n    subsidio_km_teto,\n    indicador_penalidade_judicial,\n    indicador_viagem_dentro_limite\n  FROM\n    {{ ref(\"viagens_remuneradas\") }}\n    -- rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  indicador_ar AS (\n  SELECT\n    data,\n    id_veiculo,\n    status,\n    SAFE_CAST(JSON_VALUE(indicadores,\"$.indicador_ar_condicionado\") AS BOOL) AS indicador_ar_condicionado\n  FROM\n    {{ ref(\"sppo_veiculo_dia\") }}\n    -- rj-smtr.veiculo.sppo_veiculo_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  viagem AS (\n  SELECT\n    data,\n    servico_realizado AS servico,\n    id_veiculo,\n    id_viagem,\n    datetime_partida\n  FROM\n    {{ ref(\"viagem_completa\") }}\n    -- rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  ar_viagem AS (\n  SELECT\n    v.data,\n    v.servico,\n    v.id_viagem,\n    v.datetime_partida,\n    COALESCE(ia.indicador_ar_condicionado, FALSE) AS indicador_ar_condicionado\n  FROM\n    viagem v\n  LEFT JOIN\n    indicador_ar ia\n  ON\n    ia.data = v.data\n    AND ia.id_veiculo = v.id_veiculo\n  ),\n  subsidio_servico_ar AS (\n    SELECT\n      sfd.data,\n      sfd.tipo_dia,\n      sfd.faixa_horaria_inicio,\n      sfd.faixa_horaria_fim,\n      sfd.consorcio,\n      sfd.servico,\n      sfd.pof,\n      COALESCE(s.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\n      s.id_viagem,\n      SAFE_CAST(s.distancia_planejada AS NUMERIC) AS distancia_planejada,\n      SAFE_CAST(s.subsidio_km AS NUMERIC) AS subsidio_km,\n      SAFE_CAST(s.subsidio_km_teto AS NUMERIC) AS subsidio_km_teto,\n      s.indicador_viagem_dentro_limite,\n      CASE\n        WHEN sfd.pof < 60 THEN TRUE\n        ELSE s.indicador_penalidade_judicial\n      END AS indicador_penalidade_judicial,\n      COALESCE(av.indicador_ar_condicionado, FALSE) AS indicador_ar_condicionado\n    FROM\n      subsidio_faixa_dia AS sfd\n    LEFT JOIN\n      ar_viagem AS av\n    ON\n      sfd.data = av.data\n      AND sfd.servico = av.servico\n      AND av.datetime_partida BETWEEN sfd.faixa_horaria_inicio\n      AND sfd.faixa_horaria_fim\n    LEFT JOIN\n      servico_km_apuracao AS s\n    ON\n      sfd.data = s.data\n      AND sfd.servico = s.servico\n      AND s.id_viagem = av.id_viagem\n  )\nSELECT\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  indicador_ar_condicionado,\n  indicador_penalidade_judicial,\n  indicador_viagem_dentro_limite,\n  tipo_viagem,\n  SAFE_CAST(COALESCE(COUNT(id_viagem), 0) AS INT64) AS viagens_faixa,\n  SAFE_CAST(COALESCE(SUM(distancia_planejada), 0) AS NUMERIC) AS km_apurada_faixa,\n  SAFE_CAST(COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE AND pof >= 80 AND subsidio_km > 0, distancia_planejada, 0)), 0) AS NUMERIC) AS km_subsidiada_faixa,\n  SAFE_CAST(SUM(IF(indicador_viagem_dentro_limite = TRUE AND pof >= 80, distancia_planejada*subsidio_km, 0)) AS NUMERIC) AS valor_apurado,\n  SAFE_CAST(-COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE, 0, distancia_planejada*subsidio_km)), 0) AS NUMERIC) AS valor_acima_limite,\n  SAFE_CAST(SUM(IF(pof >= 80 AND tipo_viagem != \"N\u00e3o licenciado\", distancia_planejada*subsidio_km_teto, 0)) - COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE, 0, distancia_planejada*subsidio_km)), 0) AS NUMERIC) AS valor_total_sem_glosa,\n  '{{ var(\"version\") }}' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_servico_ar\nGROUP BY\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  indicador_ar_condicionado,\n  indicador_penalidade_judicial,\n  indicador_viagem_dentro_limite,\n  tipo_viagem", "language": "sql", "refs": [{"name": "subsidio_faixa_servico_dia", "package": null, "version": null}, {"name": "viagens_remuneradas", "package": null, "version": null}, {"name": "sppo_veiculo_dia", "package": null, "version": null}, {"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.viagens_remuneradas", "model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/financeiro/subsidio_faixa_servico_dia_tipo_viagem.sql", "compiled": true, "compiled_code": "\n\nWITH\n  subsidio_faixa_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    consorcio,\n    servico,\n    pof\n  FROM\n    `rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  servico_km_apuracao AS (\n  SELECT\n    data,\n    servico,\n    CASE\n      WHEN tipo_viagem = \"Nao licenciado\" THEN \"N\u00e3o licenciado\"\n      WHEN tipo_viagem = \"Licenciado com ar e autuado (023.II)\" THEN \"Autuado por ar inoperante\"\n      WHEN tipo_viagem = \"Licenciado sem ar\" THEN \"Licenciado sem ar e n\u00e3o autuado\"\n      WHEN tipo_viagem = \"Licenciado com ar e n\u00e3o autuado (023.II)\" THEN \"Licenciado com ar e n\u00e3o autuado\"\n      ELSE tipo_viagem\n    END AS tipo_viagem,\n    id_viagem,\n    distancia_planejada,\n    subsidio_km,\n    subsidio_km_teto,\n    indicador_penalidade_judicial,\n    indicador_viagem_dentro_limite\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo`.`viagens_remuneradas`\n    -- rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  indicador_ar AS (\n  SELECT\n    data,\n    id_veiculo,\n    status,\n    SAFE_CAST(JSON_VALUE(indicadores,\"$.indicador_ar_condicionado\") AS BOOL) AS indicador_ar_condicionado\n  FROM\n    `rj-smtr`.`veiculo`.`sppo_veiculo_dia`\n    -- rj-smtr.veiculo.sppo_veiculo_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  viagem AS (\n  SELECT\n    data,\n    servico_realizado AS servico,\n    id_veiculo,\n    id_viagem,\n    datetime_partida\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    -- rj-smtr.projeto_subsidio_sppo.viagem_completa\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  ar_viagem AS (\n  SELECT\n    v.data,\n    v.servico,\n    v.id_viagem,\n    v.datetime_partida,\n    COALESCE(ia.indicador_ar_condicionado, FALSE) AS indicador_ar_condicionado\n  FROM\n    viagem v\n  LEFT JOIN\n    indicador_ar ia\n  ON\n    ia.data = v.data\n    AND ia.id_veiculo = v.id_veiculo\n  ),\n  subsidio_servico_ar AS (\n    SELECT\n      sfd.data,\n      sfd.tipo_dia,\n      sfd.faixa_horaria_inicio,\n      sfd.faixa_horaria_fim,\n      sfd.consorcio,\n      sfd.servico,\n      sfd.pof,\n      COALESCE(s.tipo_viagem, \"Sem viagem apurada\") AS tipo_viagem,\n      s.id_viagem,\n      SAFE_CAST(s.distancia_planejada AS NUMERIC) AS distancia_planejada,\n      SAFE_CAST(s.subsidio_km AS NUMERIC) AS subsidio_km,\n      SAFE_CAST(s.subsidio_km_teto AS NUMERIC) AS subsidio_km_teto,\n      s.indicador_viagem_dentro_limite,\n      CASE\n        WHEN sfd.pof < 60 THEN TRUE\n        ELSE s.indicador_penalidade_judicial\n      END AS indicador_penalidade_judicial,\n      COALESCE(av.indicador_ar_condicionado, FALSE) AS indicador_ar_condicionado\n    FROM\n      subsidio_faixa_dia AS sfd\n    LEFT JOIN\n      ar_viagem AS av\n    ON\n      sfd.data = av.data\n      AND sfd.servico = av.servico\n      AND av.datetime_partida BETWEEN sfd.faixa_horaria_inicio\n      AND sfd.faixa_horaria_fim\n    LEFT JOIN\n      servico_km_apuracao AS s\n    ON\n      sfd.data = s.data\n      AND sfd.servico = s.servico\n      AND s.id_viagem = av.id_viagem\n  )\nSELECT\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  indicador_ar_condicionado,\n  indicador_penalidade_judicial,\n  indicador_viagem_dentro_limite,\n  tipo_viagem,\n  SAFE_CAST(COALESCE(COUNT(id_viagem), 0) AS INT64) AS viagens_faixa,\n  SAFE_CAST(COALESCE(SUM(distancia_planejada), 0) AS NUMERIC) AS km_apurada_faixa,\n  SAFE_CAST(COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE AND pof >= 80 AND subsidio_km > 0, distancia_planejada, 0)), 0) AS NUMERIC) AS km_subsidiada_faixa,\n  SAFE_CAST(SUM(IF(indicador_viagem_dentro_limite = TRUE AND pof >= 80, distancia_planejada*subsidio_km, 0)) AS NUMERIC) AS valor_apurado,\n  SAFE_CAST(-COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE, 0, distancia_planejada*subsidio_km)), 0) AS NUMERIC) AS valor_acima_limite,\n  SAFE_CAST(SUM(IF(pof >= 80 AND tipo_viagem != \"N\u00e3o licenciado\", distancia_planejada*subsidio_km_teto, 0)) - COALESCE(SUM(IF(indicador_viagem_dentro_limite = TRUE, 0, distancia_planejada*subsidio_km)), 0) AS NUMERIC) AS valor_total_sem_glosa,\n  '' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_servico_ar\nGROUP BY\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  indicador_ar_condicionado,\n  indicador_penalidade_judicial,\n  indicador_viagem_dentro_limite,\n  tipo_viagem", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_sumario_servico_dia_pagamento": {"database": "rj-smtr", "schema": "financeiro", "name": "subsidio_sumario_servico_dia_pagamento", "resource_type": "model", "package_name": "rj_smtr", "path": "financeiro/subsidio_sumario_servico_dia_pagamento.sql", "original_file_path": "models/financeiro/subsidio_sumario_servico_dia_pagamento.sql", "unique_id": "model.rj_smtr.subsidio_sumario_servico_dia_pagamento", "fqn": ["rj_smtr", "financeiro", "subsidio_sumario_servico_dia_pagamento"], "alias": "subsidio_sumario_servico_dia_pagamento", "checksum": {"name": "sha256", "checksum": "0caf3b0f7c463db79378e783bf3a02cee8d44c952cedaf0498d2696b4ea78b8f"}, "config": {"enabled": true, "alias": null, "schema": "financeiro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_dia": {"name": "viagens_dia", "description": "Quantidade de viagens apuradas por dia.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_dia": {"name": "km_apurada_dia", "description": "Dist\u00e2ncia apurada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada_dia": {"name": "km_subsidiada_dia", "description": "Dist\u00e2ncia subsidiada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada_dia": {"name": "km_planejada_dia", "description": "Dist\u00e2ncia planejada para o servi\u00e7o por dia (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_a_pagar": {"name": "valor_a_pagar", "description": "Valor efetivo de pagamento (valor_total_apurado - valor_acima_limite - valor_glosado).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_glosado": {"name": "valor_glosado", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km, subtra\u00eddo pelo valor efetivo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_acima_limite": {"name": "valor_acima_limite", "description": "Valor apurado das viagens que n\u00e3o foram remuneradas (por estar acima do teto de 120% / 200%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_sem_glosa": {"name": "valor_total_sem_glosa", "description": "Valor total das viagens considerando o valor m\u00e1ximo por km.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_total_apurado": {"name": "valor_total_apurado", "description": "Valor total das viagens apuradas, subtra\u00eddas as penalidades (POF =< 60%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_judicial": {"name": "valor_judicial", "description": "Valor de glosa depositada em ju\u00edzo (Autua\u00e7\u00e3o por ar inoperante, Ve\u00edculo licenciado sem ar, Penalidade abaixo de 60% e Notifica\u00e7\u00e3o dos Agentes de Ver\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "valor_penalidade": {"name": "valor_penalidade", "description": "Valor penalidade [negativa] (POF =< 60%).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/financeiro/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "financeiro", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.8391607, "relation_name": "`rj-smtr`.`financeiro`.`subsidio_sumario_servico_dia_pagamento`", "raw_code": "{{\n  config(\n    materialized=\"incremental\",\n    partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n    incremental_strategy=\"insert_overwrite\",\n  )\n}}\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    SUM(viagens_faixa) AS viagens_dia,\n    SUM(km_planejada_faixa) AS km_planejada_dia\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia\") }}\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  subsidio_parametros AS (\n  SELECT\n    DISTINCT data_inicio,\n    data_fim,\n    status,\n    subsidio_km,\n    MAX(subsidio_km) OVER (PARTITION BY data_inicio, data_fim) AS subsidio_km_teto\n  FROM\n    {{ ref(\"subsidio_valor_km_tipo_viagem\") }}\n    -- rj-smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem\n),\n  penalidade AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    valor_penalidade\n  FROM\n    {{ ref(\"subsidio_penalidade_servico_dia\") }}\n  ),\n  subsidio_dia_tipo_viagem AS (\n  SELECT\n    *\n  FROM\n    {{ ref(\"subsidio_faixa_servico_dia_tipo_viagem\") }}\n    -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n  valores_calculados AS (\n  SELECT\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    pe.valor_penalidade,\n    SUM(s.km_apurada_faixa) AS km_apurada_dia,\n    SUM(s.km_subsidiada_faixa) AS km_subsidiada_dia,\n    COALESCE(SUM(s.valor_acima_limite), 0) AS valor_acima_limite,\n    COALESCE(SUM(s.valor_total_sem_glosa), 0) AS valor_total_sem_glosa,\n    SUM(s.valor_apurado) + pe.valor_penalidade AS valor_total_com_glosa,\n    CASE\n      WHEN pe.valor_penalidade != 0 THEN -pe.valor_penalidade\n      ELSE SAFE_CAST((SUM(IF(indicador_viagem_dentro_limite = TRUE AND indicador_penalidade_judicial = TRUE, km_apurada_faixa*subsidio_km_teto, 0))\n           - SUM(IF(indicador_viagem_dentro_limite = TRUE AND indicador_penalidade_judicial = TRUE, km_apurada_faixa*subsidio_km, 0))) AS NUMERIC)\n    END AS valor_judicial,\n  FROM\n    subsidio_dia_tipo_viagem AS s\n  LEFT JOIN\n    penalidade AS pe\n  USING(data, tipo_dia, consorcio, servico)\n  LEFT JOIN\n    subsidio_parametros AS sp\n  ON\n    s.data BETWEEN sp.data_inicio\n    AND sp.data_fim\n    AND s.tipo_viagem = sp.status\n  GROUP BY\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    pe.valor_penalidade\n  )\nSELECT\n  sd.data,\n  sd.tipo_dia,\n  sd.consorcio,\n  sd.servico,\n  sd.viagens_dia,\n  vc.km_apurada_dia,\n  vc.km_subsidiada_dia,\n  sd.km_planejada_dia,\n  vc.valor_total_com_glosa AS valor_a_pagar,\n  vc.valor_total_com_glosa - vc.valor_total_sem_glosa AS valor_glosado,\n  vc.valor_acima_limite,\n  vc.valor_total_sem_glosa,\n  vc.valor_acima_limite + vc.valor_penalidade + vc.valor_total_sem_glosa AS valor_total_apurado,\n  vc.valor_judicial,\n  vc.valor_penalidade,\n  '{{ var(\"version\") }}' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_dia AS sd\nLEFT JOIN\n  valores_calculados AS vc\nUSING(data, tipo_dia, consorcio, servico)", "language": "sql", "refs": [{"name": "subsidio_faixa_servico_dia", "package": null, "version": null}, {"name": "subsidio_valor_km_tipo_viagem", "package": null, "version": null}, {"name": "subsidio_penalidade_servico_dia", "package": null, "version": null}, {"name": "subsidio_faixa_servico_dia_tipo_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_valor_km_tipo_viagem", "model.rj_smtr.subsidio_penalidade_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/financeiro/subsidio_sumario_servico_dia_pagamento.sql", "compiled": true, "compiled_code": "\n\nWITH\n  subsidio_dia AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    SUM(viagens_faixa) AS viagens_dia,\n    SUM(km_planejada_faixa) AS km_planejada_dia\n  FROM\n    `rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`\n    -- rj-smtr.financeiro_staging.subsidio_faixa_servico_dia\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  GROUP BY\n    data,\n    tipo_dia,\n    consorcio,\n    servico\n  ),\n  subsidio_parametros AS (\n  SELECT\n    DISTINCT data_inicio,\n    data_fim,\n    status,\n    subsidio_km,\n    MAX(subsidio_km) OVER (PARTITION BY data_inicio, data_fim) AS subsidio_km_teto\n  FROM\n    `rj-smtr`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`\n    -- rj-smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem\n),\n  penalidade AS (\n  SELECT\n    data,\n    tipo_dia,\n    consorcio,\n    servico,\n    valor_penalidade\n  FROM\n    `rj-smtr`.`financeiro`.`subsidio_penalidade_servico_dia`\n  ),\n  subsidio_dia_tipo_viagem AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`financeiro`.`subsidio_faixa_servico_dia_tipo_viagem`\n    -- rj-smtr.financeiro.subsidio_faixa_servico_dia_tipo_viagem\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n  valores_calculados AS (\n  SELECT\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    pe.valor_penalidade,\n    SUM(s.km_apurada_faixa) AS km_apurada_dia,\n    SUM(s.km_subsidiada_faixa) AS km_subsidiada_dia,\n    COALESCE(SUM(s.valor_acima_limite), 0) AS valor_acima_limite,\n    COALESCE(SUM(s.valor_total_sem_glosa), 0) AS valor_total_sem_glosa,\n    SUM(s.valor_apurado) + pe.valor_penalidade AS valor_total_com_glosa,\n    CASE\n      WHEN pe.valor_penalidade != 0 THEN -pe.valor_penalidade\n      ELSE SAFE_CAST((SUM(IF(indicador_viagem_dentro_limite = TRUE AND indicador_penalidade_judicial = TRUE, km_apurada_faixa*subsidio_km_teto, 0))\n           - SUM(IF(indicador_viagem_dentro_limite = TRUE AND indicador_penalidade_judicial = TRUE, km_apurada_faixa*subsidio_km, 0))) AS NUMERIC)\n    END AS valor_judicial,\n  FROM\n    subsidio_dia_tipo_viagem AS s\n  LEFT JOIN\n    penalidade AS pe\n  USING(data, tipo_dia, consorcio, servico)\n  LEFT JOIN\n    subsidio_parametros AS sp\n  ON\n    s.data BETWEEN sp.data_inicio\n    AND sp.data_fim\n    AND s.tipo_viagem = sp.status\n  GROUP BY\n    s.data,\n    s.tipo_dia,\n    s.consorcio,\n    s.servico,\n    pe.valor_penalidade\n  )\nSELECT\n  sd.data,\n  sd.tipo_dia,\n  sd.consorcio,\n  sd.servico,\n  sd.viagens_dia,\n  vc.km_apurada_dia,\n  vc.km_subsidiada_dia,\n  sd.km_planejada_dia,\n  vc.valor_total_com_glosa AS valor_a_pagar,\n  vc.valor_total_com_glosa - vc.valor_total_sem_glosa AS valor_glosado,\n  vc.valor_acima_limite,\n  vc.valor_total_sem_glosa,\n  vc.valor_acima_limite + vc.valor_penalidade + vc.valor_total_sem_glosa AS valor_total_apurado,\n  vc.valor_judicial,\n  vc.valor_penalidade,\n  '' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  subsidio_dia AS sd\nLEFT JOIN\n  valores_calculados AS vc\nUSING(data, tipo_dia, consorcio, servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.subsidio_faixa_servico_dia": {"database": "rj-smtr", "schema": "financeiro_staging", "name": "subsidio_faixa_servico_dia", "resource_type": "model", "package_name": "rj_smtr", "path": "financeiro/staging/subsidio_faixa_servico_dia.sql", "original_file_path": "models/financeiro/staging/subsidio_faixa_servico_dia.sql", "unique_id": "model.rj_smtr.subsidio_faixa_servico_dia", "fqn": ["rj_smtr", "financeiro", "staging", "subsidio_faixa_servico_dia"], "alias": "subsidio_faixa_servico_dia", "checksum": {"name": "sha256", "checksum": "8a6f84b75b2118f94792c24a8bf92d4bac388cd5993d0df59353d8c997728435"}, "config": {"enabled": true, "alias": null, "schema": "financeiro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Sum\u00e1rio do subs\u00eddio dos servi\u00e7os de \u00f4nibus (SPPO) por dia e faixa hor\u00e1ria.", "columns": {"data": {"name": "data", "description": "Data de emiss\u00e3o do sinal de GPS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana considerado para o c\u00e1lculo da dist\u00e2ncia planejada - categorias: Dia \u00datil, Sabado, Domingo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "description": "Hor\u00e1rio inicial da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "faixa_horaria_fim": {"name": "faixa_horaria_fim", "description": "Hor\u00e1rio final da faixa hor\u00e1ria", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio que opera o servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_faixa": {"name": "viagens_faixa", "description": "Quantidade de viagens apuradas por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_apurada_faixa": {"name": "km_apurada_faixa", "description": "Dist\u00e2ncia apurada para o servi\u00e7o por faixa hor\u00e1ria(km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_planejada_faixa": {"name": "km_planejada_faixa", "description": "Dist\u00e2ncia planejada para o servi\u00e7o por faixa hor\u00e1ria (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "pof": {"name": "pof", "description": "Indicador percentual de quilometragem apurada em rela\u00e7\u00e3o \u00e0 planejada da linha por faixa hor\u00e1ria.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "description": "\u00daltima atualiza\u00e7\u00e3o (GMT-3).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/financeiro/staging/schema.yaml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "financeiro_staging", "partition_by": {"field": "data", "data_type": "date", "granularity": "day"}}, "created_at": 1727709588.8400962, "relation_name": "`rj-smtr`.`financeiro_staging`.`subsidio_faixa_servico_dia`", "raw_code": "{{\n    config(\n        materialized=\"incremental\",\n        partition_by={\"field\": \"data\", \"data_type\": \"date\", \"granularity\": \"day\"},\n        incremental_strategy=\"insert_overwrite\",\n    )\n}}\n\nWITH\n-- 1. Viagens planejadas\n  planejado AS (\n  SELECT\n    DISTINCT data,\n    tipo_dia,\n    consorcio,\n    servico,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    distancia_total_planejada AS km_planejada\n  FROM\n    {{ ref(\"viagem_planejada\") }}\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n    AND distancia_total_planejada > 0\n  ),\n-- 2. Viagens realizadas\n  viagem AS (\n  SELECT\n    data,\n    servico,\n    id_viagem,\n    tipo_viagem,\n    datetime_partida,\n    distancia_planejada\n FROM\n    {{ ref(\"viagem_transacao\") }}\n    -- rj-smtr.subsidio.viagem_transacao\n  WHERE\n    data BETWEEN DATE(\"{{ var(\"start_date\") }}\")\n    AND DATE(\"{{ var(\"end_date\") }}\")\n  ),\n-- 3. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o por faixa\n  servico_km_apuracao AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.faixa_horaria_inicio,\n    p.faixa_horaria_fim,\n    p.consorcio,\n    p.servico,\n    SAFE_CAST(p.km_planejada AS NUMERIC) AS km_planejada_faixa,\n    SAFE_CAST(COALESCE(COUNT(v.id_viagem), 0) AS INT64) AS viagens_faixa,\n    SAFE_CAST(COALESCE(SUM(v.distancia_planejada), 0) AS NUMERIC) AS km_apurada_faixa,\n    SAFE_CAST(COALESCE(ROUND(100 * SUM(IF(v.tipo_viagem NOT IN (\"N\u00e3o licenciado\",\"N\u00e3o vistoriado\"),v.distancia_planejada, 0)) / p.km_planejada,2), 0) AS NUMERIC) AS pof\n  FROM\n    planejado AS p\n  LEFT JOIN\n    viagem AS v\n  ON\n    p.data = v.data\n    AND p.servico = v.servico\n    AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\n    AND p.faixa_horaria_fim\n  GROUP BY\n    p.data, p.tipo_dia, p.faixa_horaria_inicio, p.faixa_horaria_fim, p.consorcio, p.servico, p.km_planejada\n)\nSELECT\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  viagens_faixa,\n  km_apurada_faixa,\n  km_planejada_faixa,\n  pof,\n  '{{ var(\"version\") }}' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  servico_km_apuracao", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}, {"name": "viagem_transacao", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_transacao"]}, "compiled_path": "target-base/compiled/rj_smtr/models/financeiro/staging/subsidio_faixa_servico_dia.sql", "compiled": true, "compiled_code": "\n\nWITH\n-- 1. Viagens planejadas\n  planejado AS (\n  SELECT\n    DISTINCT data,\n    tipo_dia,\n    consorcio,\n    servico,\n    faixa_horaria_inicio,\n    faixa_horaria_fim,\n    distancia_total_planejada AS km_planejada\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    -- rj-smtr.projeto_subsidio_sppo.viagem_planejada\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n    AND distancia_total_planejada > 0\n  ),\n-- 2. Viagens realizadas\n  viagem AS (\n  SELECT\n    data,\n    servico,\n    id_viagem,\n    tipo_viagem,\n    datetime_partida,\n    distancia_planejada\n FROM\n    `rj-smtr`.`subsidio`.`viagem_transacao`\n    -- rj-smtr.subsidio.viagem_transacao\n  WHERE\n    data BETWEEN DATE(\"2022-01-01T01:00:00\")\n    AND DATE(\"2022-01-01T01:00:00\")\n  ),\n-- 3. Apura\u00e7\u00e3o de km realizado e Percentual de Opera\u00e7\u00e3o por faixa\n  servico_km_apuracao AS (\n  SELECT\n    p.data,\n    p.tipo_dia,\n    p.faixa_horaria_inicio,\n    p.faixa_horaria_fim,\n    p.consorcio,\n    p.servico,\n    SAFE_CAST(p.km_planejada AS NUMERIC) AS km_planejada_faixa,\n    SAFE_CAST(COALESCE(COUNT(v.id_viagem), 0) AS INT64) AS viagens_faixa,\n    SAFE_CAST(COALESCE(SUM(v.distancia_planejada), 0) AS NUMERIC) AS km_apurada_faixa,\n    SAFE_CAST(COALESCE(ROUND(100 * SUM(IF(v.tipo_viagem NOT IN (\"N\u00e3o licenciado\",\"N\u00e3o vistoriado\"),v.distancia_planejada, 0)) / p.km_planejada,2), 0) AS NUMERIC) AS pof\n  FROM\n    planejado AS p\n  LEFT JOIN\n    viagem AS v\n  ON\n    p.data = v.data\n    AND p.servico = v.servico\n    AND v.datetime_partida BETWEEN p.faixa_horaria_inicio\n    AND p.faixa_horaria_fim\n  GROUP BY\n    p.data, p.tipo_dia, p.faixa_horaria_inicio, p.faixa_horaria_fim, p.consorcio, p.servico, p.km_planejada\n)\nSELECT\n  data,\n  tipo_dia,\n  faixa_horaria_inicio,\n  faixa_horaria_fim,\n  consorcio,\n  servico,\n  viagens_faixa,\n  km_apurada_faixa,\n  km_planejada_faixa,\n  pof,\n  '' as versao,\n  CURRENT_DATETIME(\"America/Sao_Paulo\") as datetime_ultima_atualizacao\nFROM\n  servico_km_apuracao", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.routes_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "routes_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/routes_gtfs.sql", "original_file_path": "models/gtfs/routes_gtfs.sql", "unique_id": "model.rj_smtr.routes_gtfs", "fqn": ["rj_smtr", "gtfs", "routes_gtfs"], "alias": "routes", "checksum": {"name": "sha256", "checksum": "2fd748c69b35a47a31964802432fa2bdd4b49095fc9a1ddd95cffacb309a6fdc"}, "config": {"enabled": true, "alias": "routes", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["route_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Rotas de tr\u00e2nsito. Uma rota \u00e9 um grupo de viagens exibidas aos passageiros como um \u00fanico servi\u00e7o.", "columns": {"route_id": {"name": "route_id", "description": "Identifica uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_id": {"name": "agency_id", "description": "Ag\u00eancia para a rota especificada.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_short_name": {"name": "route_short_name", "description": "Nome abreviado de uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_long_name": {"name": "route_long_name", "description": "Nome completo de uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_desc": {"name": "route_desc", "description": "Descri\u00e7\u00e3o de uma rota que fornece informa\u00e7\u00f5es \u00fateis e de qualidade.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_type": {"name": "route_type", "description": "Indica o tipo de transporte utilizado em uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_url": {"name": "route_url", "description": "URL de uma p\u00e1gina da web sobre uma rota espec\u00edfica.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_color": {"name": "route_color", "description": "Designa\u00e7\u00e3o de cores da rota que corresponda ao material voltado para o p\u00fablico.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_text_color": {"name": "route_text_color", "description": "Cor leg\u00edvel a ser usada para texto desenhado contra um fundo de route_color.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_sort_order": {"name": "route_sort_order", "description": "Ordena as rotas de forma ideal para apresenta\u00e7\u00e3o aos clientes.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "continuous_pickup": {"name": "continuous_pickup", "description": "Indica que o passageiro pode embarcar no ve\u00edculo de transporte p\u00fablico em qualquer ponto ao longo do trajeto de viagem do ve\u00edculo, conforme descrito em shape.txt, em cada viagem do trajeto.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "continuous_drop_off": {"name": "continuous_drop_off", "description": "Indica que o passageiro pode descer do ve\u00edculo de transporte p\u00fablico em qualquer ponto ao longo do trajeto de viagem do ve\u00edculo, conforme descrito em shape.txt, em cada viagem da rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "network_id": {"name": "network_id", "description": "Identifica um grupo de rotas. V\u00e1rias linhas em rotas.txt podem ter o mesmo network_id.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["route_id", "feed_start_date"], "alias": "routes"}, "created_at": 1727709588.7041748, "relation_name": "`rj-smtr`.`gtfs`.`routes`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['route_id', 'feed_start_date'],\n    alias = 'routes'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(r.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(r.route_id AS STRING) route_id,\n  SAFE_CAST(JSON_VALUE(r.content, '$.agency_id') AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_short_name') AS STRING) route_short_name,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_long_name') AS STRING) route_long_name,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_desc') AS STRING) route_desc,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_type') AS STRING) route_type,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_url') AS STRING) route_url,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_color') AS STRING) route_color,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_text_color') AS STRING) route_text_color,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_sort_order') AS INT64) route_sort_order,\n  SAFE_CAST(JSON_VALUE(r.content, '$.continuous_pickup') AS STRING) continuous_pickup,\n  SAFE_CAST(JSON_VALUE(r.content, '$.continuous_drop_off') AS STRING) continuous_drop_off,\n  SAFE_CAST(JSON_VALUE(r.content, '$.network_id') AS STRING) network_id,\n  '{{ var(\"version\") }}' AS versao_modelo\n FROM\n  {{ source(\n    'br_rj_riodejaneiro_gtfs_staging',\n    'routes'\n  ) }} r\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  r.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    r.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "routes"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/routes_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(r.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(r.route_id AS STRING) route_id,\n  SAFE_CAST(JSON_VALUE(r.content, '$.agency_id') AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_short_name') AS STRING) route_short_name,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_long_name') AS STRING) route_long_name,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_desc') AS STRING) route_desc,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_type') AS STRING) route_type,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_url') AS STRING) route_url,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_color') AS STRING) route_color,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_text_color') AS STRING) route_text_color,\n  SAFE_CAST(JSON_VALUE(r.content, '$.route_sort_order') AS INT64) route_sort_order,\n  SAFE_CAST(JSON_VALUE(r.content, '$.continuous_pickup') AS STRING) continuous_pickup,\n  SAFE_CAST(JSON_VALUE(r.content, '$.continuous_drop_off') AS STRING) continuous_drop_off,\n  SAFE_CAST(JSON_VALUE(r.content, '$.network_id') AS STRING) network_id,\n  '' AS versao_modelo\n FROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`routes` r\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  r.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    r.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_trips_shapes_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_trips_shapes_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_trips_shapes_gtfs.sql", "original_file_path": "models/gtfs/ordem_servico_trips_shapes_gtfs.sql", "unique_id": "model.rj_smtr.ordem_servico_trips_shapes_gtfs", "fqn": ["rj_smtr", "gtfs", "ordem_servico_trips_shapes_gtfs"], "alias": "ordem_servico_trips_shapes", "checksum": {"name": "sha256", "checksum": "64bdc0a1e99cf664b47c8637ab40bbedf7a4b2680ebf433ea2472df64f748a20"}, "config": {"enabled": true, "alias": "ordem_servico_trips_shapes", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Jun\u00e7\u00e3o da Ordem de Servi\u00e7o (OS) com trips e shapes dos servi\u00e7os", "columns": {"feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, Sabado, Domingo e Ponto Facultativo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto do servi\u00e7o operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 006, 010, ...).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio respons\u00e1vel pelo servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido planejado - categorias: I (ida), V (volta), C (circular)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_planejada": {"name": "distancia_planejada", "description": "Dist\u00e2ncia planejada de uma viagem do servi\u00e7o (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia total planejada do servi\u00e7o em km (junta ida+volta multiplicado pela quantidade de viagens).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "Hor\u00e1rio inicial de funcionamento do servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Hor\u00e1rio da final de funcionamento do servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id_planejado": {"name": "trip_id_planejado", "description": "C\u00f3digo identificador de trip de refer\u00eancia no GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_id": {"name": "trip_id", "description": "C\u00f3digo identificador de trip de refer\u00eancia no GTFS com ajustes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "C\u00f3digo identificador de shape no GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id_planejado": {"name": "shape_id_planejado", "description": "C\u00f3digo identificador de shape no GTFS com ajustes", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape": {"name": "shape", "description": "Shape em formato geogr\u00e1fico (usualmente LineString).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido_shape": {"name": "sentido_shape", "description": "Sentido do shape - categorias: I (ida), V (volta)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_pt": {"name": "start_pt", "description": "Ponto inicial do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_pt": {"name": "end_pt", "description": "Ponto final do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_tipo_trajeto": {"name": "id_tipo_trajeto", "description": "Tipo de trajeto (0 - Regular, 1 - Alternativo)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_os": {"name": "tipo_os", "description": "Tipo de Ordem de Servi\u00e7o (ex: 'Regular', 'Extraordin\u00e1ria - Ver\u00e3o')", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "alias": "ordem_servico_trips_shapes"}, "created_at": 1727709588.7239664, "relation_name": "`rj-smtr`.`gtfs`.`ordem_servico_trips_shapes`", "raw_code": "{{\n  config(\n    partition_by = {\n      \"field\": \"feed_start_date\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n    alias = \"ordem_servico_trips_shapes\"\n  )\n}}\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      {{ ref(\"shapes_geom_gtfs\") }}\n    {% if is_incremental() -%}\n    WHERE\n      feed_start_date = '{{ var(\"data_versao_gtfs\") }}'\n    {% endif -%}\n  ),\n  -- 2. Trata a OS, inclui trip_ids e ajusta nomes das colunas\n  ordem_servico_tratada AS (\n  SELECT\n    *\n  FROM\n    (\n      (\n      SELECT\n        o.feed_version,\n        o.feed_start_date,\n        o.feed_end_date,\n        o.tipo_os,\n        o.tipo_dia,\n        servico,\n        vista,\n        consorcio,\n        sentido,\n        distancia_planejada,\n        distancia_total_planejada,\n        inicio_periodo,\n        fim_periodo,\n        trip_id,\n        shape_id,\n        indicador_trajeto_alternativo\n      FROM\n        {{ ref(\"ordem_servico_sentido_atualizado_aux_gtfs\") }} AS o\n      LEFT JOIN\n        {{ ref(\"trips_filtrada_aux_gtfs\") }} AS t\n      ON\n        t.feed_version = o.feed_version\n        AND o.servico = t.trip_short_name\n        AND\n          ((o.tipo_dia = t.tipo_dia AND o.tipo_os != \"CNU\")\n          OR (o.tipo_dia = \"Ponto Facultativo\" AND t.tipo_dia = \"Dia \u00datil\" AND o.tipo_os != \"CNU\")\n          OR (o.feed_start_date = \"2024-08-16\" AND o.tipo_os = \"CNU\" AND o.tipo_dia = \"Domingo\" AND t.tipo_dia = \"Sabado\")) -- Domingo CNU\n        AND\n          ((o.sentido IN (\"I\", \"C\") AND t.direction_id = \"0\")\n          OR (o.sentido = \"V\" AND t.direction_id = \"1\"))\n      WHERE\n        indicador_trajeto_alternativo IS FALSE\n      )\n    UNION ALL\n      (\n      SELECT\n        o.feed_version,\n        o.feed_start_date,\n        o.feed_end_date,\n        o.tipo_os,\n        o.tipo_dia,\n        servico,\n        o.vista || \" \" || ot.evento AS vista,\n        o.consorcio,\n        sentido,\n        ot.distancia_planejada,\n        distancia_total_planejada,\n        COALESCE(ot.inicio_periodo, o.inicio_periodo) AS inicio_periodo,\n        COALESCE(ot.fim_periodo, o.fim_periodo) AS fim_periodo,\n        trip_id,\n        shape_id,\n        indicador_trajeto_alternativo\n      FROM\n        {{ ref(\"ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs\") }} AS ot\n      LEFT JOIN\n        {{ ref(\"ordem_servico_sentido_atualizado_aux_gtfs\") }} AS o\n      USING\n        (feed_version,\n          tipo_os,\n          servico,\n          sentido)\n      LEFT JOIN\n        {{ ref(\"trips_filtrada_aux_gtfs\") }} AS t\n      ON\n        t.feed_version = o.feed_version\n        AND o.servico = t.trip_short_name\n        AND\n          (o.tipo_dia = t.tipo_dia\n          OR (o.tipo_dia = \"Ponto Facultativo\" AND t.tipo_dia = \"Dia \u00datil\")\n          OR (t.tipo_dia = \"EXCEP\")) -- Inclui trips do service_id/tipo_dia \"EXCEP\"\n        AND\n          ((o.sentido IN (\"I\", \"C\") AND t.direction_id = \"0\")\n          OR (o.sentido = \"V\" AND t.direction_id = \"1\"))\n        AND t.trip_headsign LIKE CONCAT(\"%\", ot.evento, \"%\")\n      WHERE\n        indicador_trajeto_alternativo IS TRUE\n        AND trip_id IS NOT NULL -- Remove servi\u00e7os de tipo_dia sem planejamento\n      )\n    )\n  ),\n  -- 3. Inclui trip_ids de ida e volta para trajetos circulares, ajusta shape_id para trajetos circulares e inclui id_tipo_trajeto\n  ordem_servico_trips AS (\n    SELECT\n      * EXCEPT(shape_id, indicador_trajeto_alternativo),\n      shape_id AS shape_id_planejado,\n      CASE\n        WHEN sentido = \"C\" THEN shape_id || \"_\" || SPLIT(trip_id, \"_\")[OFFSET(1)]\n      ELSE\n      shape_id\n    END\n      AS shape_id,\n      CASE\n        WHEN indicador_trajeto_alternativo IS FALSE THEN 0 -- Trajeto regular\n        WHEN indicador_trajeto_alternativo IS TRUE THEN 1 -- Trajeto alternativo\n    END\n      AS id_tipo_trajeto,\n    FROM\n    (\n      (\n        SELECT\n          DISTINCT * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          trip_id\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"I\"\n          OR sentido = \"V\"\n      )\n      UNION ALL\n      (\n        SELECT\n          * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          CONCAT(trip_id, \"_0\") AS trip_id,\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"C\"\n      )\n      UNION ALL\n      (\n        SELECT\n          * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          CONCAT(trip_id, \"_1\") AS trip_id,\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"C\"\n      )\n    )\n  )\nSELECT\n  feed_version,\n  feed_start_date,\n  o.feed_end_date,\n  tipo_os,\n  tipo_dia,\n  servico,\n  vista,\n  o.consorcio,\n  sentido,\n  CASE\n    WHEN feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}' THEN fh.partidas\n    ELSE NULL\n  END AS partidas_total_planejada,\n  distancia_planejada,\n  CASE\n    WHEN feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}' THEN fh.quilometragem\n    ELSE distancia_total_planejada\n  END AS distancia_total_planejada,\n  inicio_periodo,\n  fim_periodo,\n  CASE\n    WHEN feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}' THEN fh.faixa_horaria_inicio\n    ELSE \"00:00:00\"\n  END AS faixa_horaria_inicio,\n  CASE\n    WHEN feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}' THEN fh.faixa_horaria_fim\n    ELSE \"23:59:59\"\n  END AS faixa_horaria_fim,\n  trip_id_planejado,\n  trip_id,\n  shape_id,\n  shape_id_planejado,\n  shape,\n  CASE\n    WHEN sentido = \"C\" AND SPLIT(shape_id, \"_\")[OFFSET(1)] = \"0\" THEN \"I\"\n    WHEN sentido = \"C\" AND SPLIT(shape_id, \"_\")[OFFSET(1)] = \"1\" THEN \"V\"\n    WHEN sentido = \"I\" OR sentido = \"V\" THEN sentido\nEND\n  AS sentido_shape,\n  s.start_pt,\n  s.end_pt,\n  id_tipo_trajeto,\nFROM\n  ordem_servico_trips AS o\nLEFT JOIN\n  shapes AS s\nUSING\n  (feed_version,\n    feed_start_date,\n    shape_id)\nLEFT JOIN\n  {{ ref(\"ordem_servico_faixa_horaria\") }} AS fh\n  -- rj-smtr-dev.gtfs.ordem_servico_faixa_horaria AS fh\nUSING\n  (feed_version, feed_start_date, tipo_os, tipo_dia, servico)\nWHERE\n{% if is_incremental() -%}\n  feed_start_date = '{{ var(\"data_versao_gtfs\") }}' AND\n{% endif -%}\n  (\n    (\n    feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}'\n    AND\n      (\n        fh.quilometragem != 0\n        AND (fh.partidas != 0 OR fh.partidas IS NULL)\n      )\n    )\n    OR\n      feed_start_date < '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}'\n  )", "language": "sql", "refs": [{"name": "shapes_geom_gtfs", "package": null, "version": null}, {"name": "ordem_servico_sentido_atualizado_aux_gtfs", "package": null, "version": null}, {"name": "trips_filtrada_aux_gtfs", "package": null, "version": null}, {"name": "ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "package": null, "version": null}, {"name": "ordem_servico_sentido_atualizado_aux_gtfs", "package": null, "version": null}, {"name": "trips_filtrada_aux_gtfs", "package": null, "version": null}, {"name": "ordem_servico_faixa_horaria", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "model.rj_smtr.trips_filtrada_aux_gtfs", "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_faixa_horaria"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_trips_shapes_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH\n   __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n),  __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\nWITH\n  -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          __dbt__cte__trips_filtrada_aux_gtfs\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    \n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '2024-08-16'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '2024-08-16'\n      )\n),  __dbt__cte__ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_trajeto_alternativo_gtfs com sentidos despivotados e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\n\n-- 1. Busca anexo de trajetos alternativos\nWITH\n  ordem_servico_trajeto_alternativo AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n    \n  ),\n  -- 2. Despivota anexo de trajetos alternativos\n  ordem_servico_trajeto_alternativo_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico_trajeto_alternativo\n    UNPIVOT\n    (\n      (\n        distancia_planejada\n      ) FOR sentido IN (\n        (\n          extensao_ida\n        ) AS \"I\",\n        (\n          extensao_volta\n        ) AS \"V\"\n      )\n    )\n  )\n-- 3. Atualiza sentido dos servi\u00e7os circulares no anexo de trajetos alternativos\nSELECT\n    * EXCEPT(sentido),\n    CASE\n        WHEN \"C\" IN UNNEST(sentido_array) THEN \"C\"\n        ELSE o.sentido\n    END AS sentido,\nFROM\n    ordem_servico_trajeto_alternativo_sentido AS o\nLEFT JOIN\n(\n    SELECT\n        feed_start_date,\n        servico,\n        ARRAY_AGG(DISTINCT sentido) AS sentido_array,\n    FROM\n        __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs\n    GROUP BY\n        1,\n        2\n) AS s\nUSING\n    (feed_start_date, servico)\nWHERE\n    distancia_planejada != 0\n), -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    WHERE\n      feed_start_date = '2024-05-03'\n    ),\n  -- 2. Trata a OS, inclui trip_ids e ajusta nomes das colunas\n  ordem_servico_tratada AS (\n  SELECT\n    *\n  FROM\n    (\n      (\n      SELECT\n        o.feed_version,\n        o.feed_start_date,\n        o.feed_end_date,\n        o.tipo_os,\n        o.tipo_dia,\n        servico,\n        vista,\n        consorcio,\n        sentido,\n        distancia_planejada,\n        distancia_total_planejada,\n        inicio_periodo,\n        fim_periodo,\n        trip_id,\n        shape_id,\n        indicador_trajeto_alternativo\n      FROM\n        __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs AS o\n      LEFT JOIN\n        __dbt__cte__trips_filtrada_aux_gtfs AS t\n      ON\n        t.feed_version = o.feed_version\n        AND o.servico = t.trip_short_name\n        AND\n          ((o.tipo_dia = t.tipo_dia AND o.tipo_os != \"CNU\")\n          OR (o.tipo_dia = \"Ponto Facultativo\" AND t.tipo_dia = \"Dia \u00datil\" AND o.tipo_os != \"CNU\")\n          OR (o.feed_start_date = \"2024-08-16\" AND o.tipo_os = \"CNU\" AND o.tipo_dia = \"Domingo\" AND t.tipo_dia = \"Sabado\")) -- Domingo CNU\n        AND\n          ((o.sentido IN (\"I\", \"C\") AND t.direction_id = \"0\")\n          OR (o.sentido = \"V\" AND t.direction_id = \"1\"))\n      WHERE\n        indicador_trajeto_alternativo IS FALSE\n      )\n    UNION ALL\n      (\n      SELECT\n        o.feed_version,\n        o.feed_start_date,\n        o.feed_end_date,\n        o.tipo_os,\n        o.tipo_dia,\n        servico,\n        o.vista || \" \" || ot.evento AS vista,\n        o.consorcio,\n        sentido,\n        ot.distancia_planejada,\n        distancia_total_planejada,\n        COALESCE(ot.inicio_periodo, o.inicio_periodo) AS inicio_periodo,\n        COALESCE(ot.fim_periodo, o.fim_periodo) AS fim_periodo,\n        trip_id,\n        shape_id,\n        indicador_trajeto_alternativo\n      FROM\n        __dbt__cte__ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs AS ot\n      LEFT JOIN\n        __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs AS o\n      USING\n        (feed_version,\n          tipo_os,\n          servico,\n          sentido)\n      LEFT JOIN\n        __dbt__cte__trips_filtrada_aux_gtfs AS t\n      ON\n        t.feed_version = o.feed_version\n        AND o.servico = t.trip_short_name\n        AND\n          (o.tipo_dia = t.tipo_dia\n          OR (o.tipo_dia = \"Ponto Facultativo\" AND t.tipo_dia = \"Dia \u00datil\")\n          OR (t.tipo_dia = \"EXCEP\")) -- Inclui trips do service_id/tipo_dia \"EXCEP\"\n        AND\n          ((o.sentido IN (\"I\", \"C\") AND t.direction_id = \"0\")\n          OR (o.sentido = \"V\" AND t.direction_id = \"1\"))\n        AND t.trip_headsign LIKE CONCAT(\"%\", ot.evento, \"%\")\n      WHERE\n        indicador_trajeto_alternativo IS TRUE\n        AND trip_id IS NOT NULL -- Remove servi\u00e7os de tipo_dia sem planejamento\n      )\n    )\n  ),\n  -- 3. Inclui trip_ids de ida e volta para trajetos circulares, ajusta shape_id para trajetos circulares e inclui id_tipo_trajeto\n  ordem_servico_trips AS (\n    SELECT\n      * EXCEPT(shape_id, indicador_trajeto_alternativo),\n      shape_id AS shape_id_planejado,\n      CASE\n        WHEN sentido = \"C\" THEN shape_id || \"_\" || SPLIT(trip_id, \"_\")[OFFSET(1)]\n      ELSE\n      shape_id\n    END\n      AS shape_id,\n      CASE\n        WHEN indicador_trajeto_alternativo IS FALSE THEN 0 -- Trajeto regular\n        WHEN indicador_trajeto_alternativo IS TRUE THEN 1 -- Trajeto alternativo\n    END\n      AS id_tipo_trajeto,\n    FROM\n    (\n      (\n        SELECT\n          DISTINCT * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          trip_id\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"I\"\n          OR sentido = \"V\"\n      )\n      UNION ALL\n      (\n        SELECT\n          * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          CONCAT(trip_id, \"_0\") AS trip_id,\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"C\"\n      )\n      UNION ALL\n      (\n        SELECT\n          * EXCEPT(trip_id),\n          trip_id AS trip_id_planejado,\n          CONCAT(trip_id, \"_1\") AS trip_id,\n        FROM\n          ordem_servico_tratada\n        WHERE\n          sentido = \"C\"\n      )\n    )\n  )\nSELECT\n  feed_version,\n  feed_start_date,\n  o.feed_end_date,\n  tipo_os,\n  tipo_dia,\n  servico,\n  vista,\n  o.consorcio,\n  sentido,\n  CASE\n    WHEN feed_start_date >= '2024-08-16' THEN fh.partidas\n    ELSE NULL\n  END AS partidas_total_planejada,\n  distancia_planejada,\n  CASE\n    WHEN feed_start_date >= '2024-08-16' THEN fh.quilometragem\n    ELSE distancia_total_planejada\n  END AS distancia_total_planejada,\n  inicio_periodo,\n  fim_periodo,\n  CASE\n    WHEN feed_start_date >= '2024-08-16' THEN fh.faixa_horaria_inicio\n    ELSE \"00:00:00\"\n  END AS faixa_horaria_inicio,\n  CASE\n    WHEN feed_start_date >= '2024-08-16' THEN fh.faixa_horaria_fim\n    ELSE \"23:59:59\"\n  END AS faixa_horaria_fim,\n  trip_id_planejado,\n  trip_id,\n  shape_id,\n  shape_id_planejado,\n  shape,\n  CASE\n    WHEN sentido = \"C\" AND SPLIT(shape_id, \"_\")[OFFSET(1)] = \"0\" THEN \"I\"\n    WHEN sentido = \"C\" AND SPLIT(shape_id, \"_\")[OFFSET(1)] = \"1\" THEN \"V\"\n    WHEN sentido = \"I\" OR sentido = \"V\" THEN sentido\nEND\n  AS sentido_shape,\n  s.start_pt,\n  s.end_pt,\n  id_tipo_trajeto,\nFROM\n  ordem_servico_trips AS o\nLEFT JOIN\n  shapes AS s\nUSING\n  (feed_version,\n    feed_start_date,\n    shape_id)\nLEFT JOIN\n  `rj-smtr`.`planejamento`.`ordem_servico_faixa_horaria` AS fh\n  -- rj-smtr-dev.gtfs.ordem_servico_faixa_horaria AS fh\nUSING\n  (feed_version, feed_start_date, tipo_os, tipo_dia, servico)\nWHERE\nfeed_start_date = '2024-05-03' AND\n(\n    (\n    feed_start_date >= '2024-08-16'\n    AND\n      (\n        fh.quilometragem != 0\n        AND (fh.partidas != 0 OR fh.partidas IS NULL)\n      )\n    )\n    OR\n      feed_start_date < '2024-08-16'\n  )", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.trips_filtrada_aux_gtfs", "sql": " __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n)"}, {"id": "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "sql": " __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\nWITH\n  -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          __dbt__cte__trips_filtrada_aux_gtfs\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    \n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '2024-08-16'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '2024-08-16'\n      )\n)"}, {"id": "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "sql": " __dbt__cte__ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_trajeto_alternativo_gtfs com sentidos despivotados e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\n\n-- 1. Busca anexo de trajetos alternativos\nWITH\n  ordem_servico_trajeto_alternativo AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n    \n  ),\n  -- 2. Despivota anexo de trajetos alternativos\n  ordem_servico_trajeto_alternativo_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico_trajeto_alternativo\n    UNPIVOT\n    (\n      (\n        distancia_planejada\n      ) FOR sentido IN (\n        (\n          extensao_ida\n        ) AS \"I\",\n        (\n          extensao_volta\n        ) AS \"V\"\n      )\n    )\n  )\n-- 3. Atualiza sentido dos servi\u00e7os circulares no anexo de trajetos alternativos\nSELECT\n    * EXCEPT(sentido),\n    CASE\n        WHEN \"C\" IN UNNEST(sentido_array) THEN \"C\"\n        ELSE o.sentido\n    END AS sentido,\nFROM\n    ordem_servico_trajeto_alternativo_sentido AS o\nLEFT JOIN\n(\n    SELECT\n        feed_start_date,\n        servico,\n        ARRAY_AGG(DISTINCT sentido) AS sentido_array,\n    FROM\n        __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs\n    GROUP BY\n        1,\n        2\n) AS s\nUSING\n    (feed_start_date, servico)\nWHERE\n    distancia_planejada != 0\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_trajeto_alternativo_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_trajeto_alternativo_gtfs.sql", "original_file_path": "models/gtfs/ordem_servico_trajeto_alternativo_gtfs.sql", "unique_id": "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs", "fqn": ["rj_smtr", "gtfs", "ordem_servico_trajeto_alternativo_gtfs"], "alias": "ordem_servico_trajeto_alternativo", "checksum": {"name": "sha256", "checksum": "631e6801e3e606e203ed9dace1801a6577f3be5c24ef9158261dea985c763758"}, "config": {"enabled": true, "alias": "ordem_servico_trajeto_alternativo", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Anexo da Ordem de Servi\u00e7o (OS) com trajetos alternativos de servi\u00e7os", "columns": {"feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome curto do servi\u00e7o operada pelo ve\u00edculo com varia\u00e7\u00e3o de servi\u00e7o (ex: 006, 010, ...).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio respons\u00e1vel pelo servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "ativacao": {"name": "ativacao", "description": "Modo de ativa\u00e7\u00e3o do trajeto alternativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao": {"name": "descricao", "description": "Descria\u00e7\u00e3o sobre o trajeto alternativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "evento": {"name": "evento", "description": "Evento relacionado ao trajeto alternativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "extensao_ida": {"name": "extensao_ida", "description": "Dist\u00e2ncia planejada de ida do trajeto alternativo (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "extensao_volta": {"name": "extensao_volta", "description": "Dist\u00e2ncia planejada de volta do trajeto alternativo (km).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "Hor\u00e1rio inicial de funcionamento do trajeto alternativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Hor\u00e1rio final de funcionamento do trajeto alternativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_os": {"name": "tipo_os", "description": "Tipo de Ordem de Servi\u00e7o (ex: 'Regular', 'Extraordin\u00e1ria - Ver\u00e3o')", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "alias": "ordem_servico_trajeto_alternativo"}, "created_at": 1727709588.722761, "relation_name": "`rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`", "raw_code": "{{\n  config(\n    partition_by = {\n      \"field\": \"feed_start_date\",\n      \"data_type\": \"date\",\n      \"granularity\": \"day\"\n    },\n    alias = \"ordem_servico_trajeto_alternativo\"\n  )\n}}\n\nWITH ordem_servico_trajeto_alternativo AS (\n  SELECT\n    fi.feed_version,\n    SAFE_CAST(o.data_versao AS DATE) feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(tipo_os AS STRING) tipo_os,\n    SAFE_CAST(evento AS STRING) evento,\n    SAFE_CAST(o.servico AS STRING) servico,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.ativacao\") AS STRING) ativacao,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.consorcio\") AS STRING) consorcio,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.descricao\") AS STRING) descricao,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.extensao_ida\") AS FLOAT64) extensao_ida,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.extensao_volta\") AS FLOAT64) extensao_volta,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.horario_inicio\") AS STRING) horario_inicio,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.horario_fim\") AS STRING) horario_fim,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.vista\") AS STRING) vista,\n  FROM\n    {{ source(\"br_rj_riodejaneiro_gtfs_staging\", \"ordem_servico_trajeto_alternativo\") }} O\n  LEFT JOIN\n    {{ ref(\"feed_info_gtfs\") }} fi\n  ON\n    o.data_versao = CAST(fi.feed_start_date AS STRING)\n  {% if is_incremental() -%}\n    WHERE\n      o.data_versao = \"{{ var('data_versao_gtfs') }}\"\n      AND fi.feed_start_date = \"{{ var('data_versao_gtfs') }}\"\n  {%- endif %}\n)\n\nSELECT\n  feed_version,\n  feed_start_date,\n  feed_end_date,\n  tipo_os,\n  servico,\n  consorcio,\n  vista,\n  ativacao,\n  descricao,\n  CASE\n    WHEN evento LIKE '[%]' THEN LOWER(evento)\n    ELSE REGEXP_REPLACE(LOWER(evento), r\"([a-z\u00e1\u00e9\u00ed\u00f3\u00fa\u00f1\u00fc\u00e7]+)\", r\"[\\1]\")\n  END AS evento,\n  extensao_ida/1000 AS extensao_ida,\n  extensao_volta/1000 AS extensao_volta,\n  horario_inicio AS inicio_periodo,\n  horario_fim AS fim_periodo,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  ordem_servico_trajeto_alternativo", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "ordem_servico_trajeto_alternativo"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_trajeto_alternativo_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_servico_trajeto_alternativo AS (\n  SELECT\n    fi.feed_version,\n    SAFE_CAST(o.data_versao AS DATE) feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(tipo_os AS STRING) tipo_os,\n    SAFE_CAST(evento AS STRING) evento,\n    SAFE_CAST(o.servico AS STRING) servico,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.ativacao\") AS STRING) ativacao,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.consorcio\") AS STRING) consorcio,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.descricao\") AS STRING) descricao,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.extensao_ida\") AS FLOAT64) extensao_ida,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.extensao_volta\") AS FLOAT64) extensao_volta,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.horario_inicio\") AS STRING) horario_inicio,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.horario_fim\") AS STRING) horario_fim,\n    SAFE_CAST(JSON_VALUE(o.content, \"$.vista\") AS STRING) vista,\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico_trajeto_alternativo` O\n  LEFT JOIN\n    `rj-smtr`.`gtfs`.`feed_info` fi\n  ON\n    o.data_versao = CAST(fi.feed_start_date AS STRING)\n  WHERE\n      o.data_versao = \"2024-05-03\"\n      AND fi.feed_start_date = \"2024-05-03\"\n)\n\nSELECT\n  feed_version,\n  feed_start_date,\n  feed_end_date,\n  tipo_os,\n  servico,\n  consorcio,\n  vista,\n  ativacao,\n  descricao,\n  CASE\n    WHEN evento LIKE '[%]' THEN LOWER(evento)\n    ELSE REGEXP_REPLACE(LOWER(evento), r\"([a-z\u00e1\u00e9\u00ed\u00f3\u00fa\u00f1\u00fc\u00e7]+)\", r\"[\\1]\")\n  END AS evento,\n  extensao_ida/1000 AS extensao_ida,\n  extensao_volta/1000 AS extensao_volta,\n  horario_inicio AS inicio_periodo,\n  horario_fim AS fim_periodo,\n  '' AS versao_modelo\nFROM\n  ordem_servico_trajeto_alternativo", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.fare_rules_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "fare_rules_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/fare_rules_gtfs.sql", "original_file_path": "models/gtfs/fare_rules_gtfs.sql", "unique_id": "model.rj_smtr.fare_rules_gtfs", "fqn": ["rj_smtr", "gtfs", "fare_rules_gtfs"], "alias": "fare_rules", "checksum": {"name": "sha256", "checksum": "21e0c7052bfc12b2745c7e1855b293fc0693445d8871de48ccbea4ab5a33adad"}, "config": {"enabled": true, "alias": "fare_rules", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["fare_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Regras para aplica\u00e7\u00e3o de tarifas de itiner\u00e1rios.", "columns": {"fare_id": {"name": "fare_id", "description": "Identifica uma classe de tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "Identifica uma rota associada \u00e0 classe de tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "origin_id": {"name": "origin_id", "description": "Identifica uma zona de origem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "destination_id": {"name": "destination_id", "description": "Identifica uma zona de destino.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "contains_id": {"name": "contains_id", "description": "Identifica as zonas nas quais um passageiro entrar\u00e1 ao usar uma determinada classe de tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["fare_id", "feed_start_date"], "alias": "fare_rules"}, "created_at": 1727709588.694848, "relation_name": "`rj-smtr`.`gtfs`.`fare_rules`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['fare_id', 'feed_start_date'],\n    alias = 'fare_rules'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(fr.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(fr.fare_id AS STRING) fare_id,\n  SAFE_CAST(fr.route_id AS STRING) route_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.origin_id') AS STRING) origin_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.destination_id') AS STRING) destination_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.contains_id') AS STRING) contains_id,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{ source(\n    'br_rj_riodejaneiro_gtfs_staging',\n    'fare_rules'\n  ) }} fr\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  fr.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    fr.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "fare_rules"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/fare_rules_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(fr.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(fr.fare_id AS STRING) fare_id,\n  SAFE_CAST(fr.route_id AS STRING) route_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.origin_id') AS STRING) origin_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.destination_id') AS STRING) destination_id,\n  SAFE_CAST(JSON_VALUE(fr.content, '$.contains_id') AS STRING) contains_id,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`fare_rules` fr\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  fr.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    fr.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.trips_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "trips_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/trips_gtfs.sql", "original_file_path": "models/gtfs/trips_gtfs.sql", "unique_id": "model.rj_smtr.trips_gtfs", "fqn": ["rj_smtr", "gtfs", "trips_gtfs"], "alias": "trips", "checksum": {"name": "sha256", "checksum": "7dbd27131161ec8f57a931beaa6146ea03048988910b9a3124ac53aa45584597"}, "config": {"enabled": true, "alias": "trips", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["trip_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Viagens para cada rota.", "columns": {"trip_id": {"name": "trip_id", "description": "Identifica uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "route_id": {"name": "route_id", "description": "Identifica uma rota.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "service_id": {"name": "service_id", "description": "Identifica um conjunto de datas em que o servi\u00e7o est\u00e1 dispon\u00edvel para uma ou mais rotas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_headsign": {"name": "trip_headsign", "description": "Texto que aparece na sinaliza\u00e7\u00e3o identificando o destino da viagem aos passageiros.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "trip_short_name": {"name": "trip_short_name", "description": "Texto voltado ao p\u00fablico usado para identificar a viagem aos passageiros, por exemplo, para identificar os n\u00fameros dos trens para viagens de trens suburbanos.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "direction_id": {"name": "direction_id", "description": "Indica a dire\u00e7\u00e3o de deslocamento de uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "block_id": {"name": "block_id", "description": "Identifica o bloco ao qual pertence a viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "Identifica uma forma geoespacial que descreve o caminho de deslocamento do ve\u00edculo para uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "wheelchair_accessible": {"name": "wheelchair_accessible", "description": "Indica acessibilidade para cadeiras de rodas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "bikes_allowed": {"name": "bikes_allowed", "description": "Indica se bicicletas s\u00e3o permitidas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["trip_id", "feed_start_date"], "alias": "trips"}, "created_at": 1727709588.7165365, "relation_name": "`rj-smtr`.`gtfs`.`trips`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['trip_id','feed_start_date'],\n    alias = 'trips'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(t.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(JSON_VALUE(t.content, '$.route_id') AS STRING) route_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.service_id') AS STRING) service_id,\n    SAFE_CAST(t.trip_id AS STRING) trip_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.trip_headsign') AS STRING) trip_headsign,\n    SAFE_CAST(JSON_VALUE(t.content, '$.trip_short_name') AS STRING) trip_short_name,\n    SAFE_CAST(JSON_VALUE(t.content, '$.direction_id') AS STRING) direction_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.block_id') AS STRING) block_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.shape_id') AS STRING) shape_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.wheelchair_accessible') AS STRING) wheelchair_accessible,\n    SAFE_CAST(JSON_VALUE(t.content, '$.bikes_allowed') AS STRING) bikes_allowed,\n    '{{ var(\"version\") }}' as versao_modelo\nFROM\n    {{ source(\n        'br_rj_riodejaneiro_gtfs_staging',\n        'trips'\n    ) }} t\nJOIN\n    {{ ref('feed_info_gtfs') }} fi\nON\n    t.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n    WHERE\n        t.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n        AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "trips"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/trips_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(t.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(JSON_VALUE(t.content, '$.route_id') AS STRING) route_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.service_id') AS STRING) service_id,\n    SAFE_CAST(t.trip_id AS STRING) trip_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.trip_headsign') AS STRING) trip_headsign,\n    SAFE_CAST(JSON_VALUE(t.content, '$.trip_short_name') AS STRING) trip_short_name,\n    SAFE_CAST(JSON_VALUE(t.content, '$.direction_id') AS STRING) direction_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.block_id') AS STRING) block_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.shape_id') AS STRING) shape_id,\n    SAFE_CAST(JSON_VALUE(t.content, '$.wheelchair_accessible') AS STRING) wheelchair_accessible,\n    SAFE_CAST(JSON_VALUE(t.content, '$.bikes_allowed') AS STRING) bikes_allowed,\n    '' as versao_modelo\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`trips` t\nJOIN\n    `rj-smtr`.`gtfs`.`feed_info` fi\nON\n    t.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n        t.data_versao IN ('2024-04-15', '2024-05-03')\n        AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_sentido_atualizado_aux_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_sentido_atualizado_aux_gtfs.sql", "original_file_path": "models/gtfs/ordem_servico_sentido_atualizado_aux_gtfs.sql", "unique_id": "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "fqn": ["rj_smtr", "gtfs", "ordem_servico_sentido_atualizado_aux_gtfs"], "alias": "ordem_servico_sentido_atualizado_aux_gtfs", "checksum": {"name": "sha256", "checksum": "37da5d9756be4915626b769dac11215a6d44d27b8ed1e3453fe6bb82eecd5bd7"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709587.1417139, "relation_name": null, "raw_code": "/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\nWITH\n  -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          {{ ref(\"trips_filtrada_aux_gtfs\") }}\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      {{ ref('ordem_servico_gtfs') }}\n    {% if is_incremental() -%}\n      WHERE\n        feed_start_date = '{{ var(\"data_versao_gtfs\") }}'\n    {%- endif %}\n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '{{ var(\"DATA_SUBSIDIO_V9_INICIO\") }}'\n      )", "language": "sql", "refs": [{"name": "trips_filtrada_aux_gtfs", "package": null, "version": null}, {"name": "ordem_servico_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.trips_filtrada_aux_gtfs", "model.rj_smtr.ordem_servico_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_sentido_atualizado_aux_gtfs.sql", "compiled": true, "compiled_code": "/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\nWITH\n   __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n), -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          __dbt__cte__trips_filtrada_aux_gtfs\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    \n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '2024-08-16'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '2024-08-16'\n      )", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.trips_filtrada_aux_gtfs", "sql": " __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.shapes_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "shapes_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/shapes_gtfs.sql", "original_file_path": "models/gtfs/shapes_gtfs.sql", "unique_id": "model.rj_smtr.shapes_gtfs", "fqn": ["rj_smtr", "gtfs", "shapes_gtfs"], "alias": "shapes", "checksum": {"name": "sha256", "checksum": "ad6198d5a4482d07a63f657b275e14d1ce3d8f234a2cd23b1ec3bf880e166d55"}, "config": {"enabled": true, "alias": "shapes", "schema": "gtfs", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["shape_id", "shape_pt_sequence", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Regras para mapear caminhos de deslocamento de ve\u00edculos, \u00e0s vezes chamados de alinhamentos de rotas.", "columns": {"shape_id": {"name": "shape_id", "description": "Identifica uma forma.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_pt_sequence": {"name": "shape_pt_sequence", "description": "Sequ\u00eancia na qual os pontos da forma se conectam para formar a forma.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_pt_lat": {"name": "shape_pt_lat", "description": "Latitude de um ponto de forma.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_pt_lon": {"name": "shape_pt_lon", "description": "Longitude de um ponto de forma.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_dist_traveled": {"name": "shape_dist_traveled", "description": "Dist\u00e2ncia real percorrida ao longo da forma desde o primeiro ponto da forma at\u00e9 o ponto especificado neste registro.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["shape_id", "shape_pt_sequence", "feed_start_date"], "alias": "shapes", "tags": ["geolocalizacao"]}, "created_at": 1727709588.7069573, "relation_name": "`rj-smtr`.`gtfs`.`shapes`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['shape_id', 'shape_pt_sequence', 'feed_start_date'],\n    alias = 'shapes',\n    tags=['geolocalizacao']\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(s.data_versao AS DATE) as feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(s.shape_id AS STRING) shape_id,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_pt_lat') AS FLOAT64) shape_pt_lat,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_pt_lon') AS FLOAT64) shape_pt_lon,\n  SAFE_CAST(s.shape_pt_sequence AS INT64) shape_pt_sequence,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_dist_traveled') AS FLOAT64) shape_dist_traveled,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{source('br_rj_riodejaneiro_gtfs_staging', 'shapes')}} s\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  s.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    s.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "shapes"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/shapes_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(s.data_versao AS DATE) as feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(s.shape_id AS STRING) shape_id,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_pt_lat') AS FLOAT64) shape_pt_lat,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_pt_lon') AS FLOAT64) shape_pt_lon,\n  SAFE_CAST(s.shape_pt_sequence AS INT64) shape_pt_sequence,\n  SAFE_CAST(JSON_VALUE(s.content, '$.shape_dist_traveled') AS FLOAT64) shape_dist_traveled,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`shapes` s\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  s.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    s.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.calendar_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "calendar_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/calendar_gtfs.sql", "original_file_path": "models/gtfs/calendar_gtfs.sql", "unique_id": "model.rj_smtr.calendar_gtfs", "fqn": ["rj_smtr", "gtfs", "calendar_gtfs"], "alias": "calendar", "checksum": {"name": "sha256", "checksum": "80313110b1200d67f40c7d89108bab5cd454a472c24b67c75ef5a01473b7ed13"}, "config": {"enabled": true, "alias": "calendar", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["service_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Datas de servi\u00e7o especificadas usando uma programa\u00e7\u00e3o semanal com datas de in\u00edcio e t\u00e9rmino.", "columns": {"service_id": {"name": "service_id", "description": "Identifica um conjunto de datas em que o servi\u00e7o est\u00e1 dispon\u00edvel para uma ou mais rotas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "monday": {"name": "monday", "description": "Indica se o servi\u00e7o funciona todas as segundas-feiras no intervalo de datas especificado pelos campos start_date e end_date", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tuesday": {"name": "tuesday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica \u00e0s ter\u00e7as-feiras.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "wednesday": {"name": "wednesday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica \u00e0s quartas-feiras.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "thursday": {"name": "thursday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica \u00e0s quintas-feiras.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "friday": {"name": "friday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica \u00e0s sextas-feiras.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saturday": {"name": "saturday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica aos s\u00e1bados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sunday": {"name": "sunday", "description": "Funciona da mesma forma que segunda-feira, exceto se aplica aos domingos.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_date": {"name": "start_date", "description": "Inicie o dia de servi\u00e7o para o intervalo de servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_date": {"name": "end_date", "description": "Finalize o dia de servi\u00e7o para o intervalo de servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["service_id", "feed_start_date"], "alias": "calendar"}, "created_at": 1727709588.6889157, "relation_name": "`rj-smtr`.`gtfs`.`calendar`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['service_id', 'feed_start_date'],\n    alias = 'calendar'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(c.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(c.service_id AS STRING) service_id,\n  SAFE_CAST(JSON_VALUE(c.content, '$.monday') AS STRING) monday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.tuesday') AS STRING) tuesday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.wednesday') AS STRING) wednesday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.thursday') AS STRING) thursday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.friday') AS STRING) friday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.saturday') AS STRING) saturday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.sunday') AS STRING) sunday,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(JSON_VALUE(c.content, '$.start_date') AS STRING)) start_date,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(JSON_VALUE(c.content, '$.end_date') AS STRING)) end_date,\n  '{{ var(\"version\") }}' AS versao_modelo\n FROM {{ source(\n            'br_rj_riodejaneiro_gtfs_staging',\n            'calendar'\n        ) }} c\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  c.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    c.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "calendar"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/calendar_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(c.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(c.service_id AS STRING) service_id,\n  SAFE_CAST(JSON_VALUE(c.content, '$.monday') AS STRING) monday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.tuesday') AS STRING) tuesday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.wednesday') AS STRING) wednesday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.thursday') AS STRING) thursday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.friday') AS STRING) friday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.saturday') AS STRING) saturday,\n  SAFE_CAST(JSON_VALUE(c.content, '$.sunday') AS STRING) sunday,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(JSON_VALUE(c.content, '$.start_date') AS STRING)) start_date,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(JSON_VALUE(c.content, '$.end_date') AS STRING)) end_date,\n  '' AS versao_modelo\n FROM `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`calendar` c\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  c.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    c.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stop_times_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "stop_times_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/stop_times_gtfs.sql", "original_file_path": "models/gtfs/stop_times_gtfs.sql", "unique_id": "model.rj_smtr.stop_times_gtfs", "fqn": ["rj_smtr", "gtfs", "stop_times_gtfs"], "alias": "stop_times", "checksum": {"name": "sha256", "checksum": "38f1118c01ab1e583713cef7e4a15d2b0d0d99666154aff98164ad381ef743a1"}, "config": {"enabled": true, "alias": "stop_times", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["trip_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Hor\u00e1rios em que um ve\u00edculo chega e sai das paradas de cada viagem.", "columns": {"trip_id": {"name": "trip_id", "description": "Identifica uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_sequence": {"name": "stop_sequence", "description": "Ordem das paradas para uma viagem espec\u00edfica.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_id": {"name": "stop_id", "description": "Identifica a parada atendida.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "arrival_time": {"name": "arrival_time", "description": "Hora de chegada na parada (definida por stop_times.stop_id) para uma viagem espec\u00edfica (definida por stop_times.trip_id) no fuso hor\u00e1rio especificado por agency.agency_timezone, n\u00e3o por stops.stop_timezone.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "departure_time": {"name": "departure_time", "description": "Hora de partida da parada (definida por stop_times.stop_id) para uma viagem espec\u00edfica (definida por stop_times.trip_id) no fuso hor\u00e1rio especificado por agency.agency_timezone, n\u00e3o por stops.stop_timezone.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_headsign": {"name": "stop_headsign", "description": "Texto que aparece na sinaliza\u00e7\u00e3o identificando o destino da viagem aos passageiros.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "pickup_type": {"name": "pickup_type", "description": "Indica o m\u00e9todo de coleta.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "drop_off_type": {"name": "drop_off_type", "description": " Indica o m\u00e9todo de entrega.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "continuous_pickup": {"name": "continuous_pickup", "description": "Indica que o passageiro pode embarcar no ve\u00edculo de transporte p\u00fablico em qualquer ponto ao longo do trajeto de viagem do ve\u00edculo, conforme descrito em shape.txt, deste stop_time at\u00e9 o pr\u00f3ximo stop_time na stop_sequence da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "continuous_drop_off": {"name": "continuous_drop_off", "description": "Indica que o passageiro pode descer do ve\u00edculo de transporte p\u00fablico em qualquer ponto ao longo do caminho de viagem do ve\u00edculo, conforme descrito por shape.txt, deste stop_time at\u00e9 o pr\u00f3ximo stop_time na stop_sequence da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_dist_traveled": {"name": "shape_dist_traveled", "description": "Dist\u00e2ncia real percorrida ao longo do formato associado, desde a primeira parada at\u00e9 a parada especificada neste registro.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "timepoint": {"name": "timepoint", "description": "Indica se os hor\u00e1rios de chegada e sa\u00edda de uma parada s\u00e3o rigorosamente respeitados pelo ve\u00edculo ou se s\u00e3o hor\u00e1rios aproximados e/ou interpolados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["trip_id", "feed_start_date"], "alias": "stop_times"}, "created_at": 1727709588.7146547, "relation_name": "`rj-smtr`.`gtfs`.`stop_times`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['trip_id', 'feed_start_date'],\n    alias = 'stop_times'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(st.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(st.trip_id AS STRING) trip_id,\n    SAFE_CAST(JSON_VALUE(st.content, '$.arrival_time') AS STRING) arrival_time,\n    SAFE_CAST(JSON_VALUE(st.content, '$.departure_time') AS DATETIME) departure_time,\n    SAFE_CAST(JSON_VALUE(st.content, '$.stop_id') AS STRING) stop_id,\n    SAFE_CAST(st.stop_sequence AS INT64) stop_sequence,\n    SAFE_CAST(JSON_VALUE(st.content, '$.stop_headsign') AS STRING) stop_headsign,\n    SAFE_CAST(JSON_VALUE(st.content, '$.pickup_type') AS STRING) pickup_type,\n    SAFE_CAST(JSON_VALUE(st.content, '$.drop_off_type') AS STRING) drop_off_type,\n    SAFE_CAST(JSON_VALUE(st.content, '$.continuous_pickup') AS STRING) continuous_pickup,\n    SAFE_CAST(JSON_VALUE(st.content, '$.continuous_drop_off') AS STRING) continuous_drop_off,\n    SAFE_CAST(JSON_VALUE(st.content, '$.shape_dist_traveled') AS FLOAT64) shape_dist_traveled,\n    SAFE_CAST(JSON_VALUE(st.content, '$.timepoint') AS STRING) timepoint,\n    '{{ var(\"version\") }}' AS versao_modelo\nFROM\n    {{ source(\n        'br_rj_riodejaneiro_gtfs_staging',\n        'stop_times'\n    ) }} st\nJOIN\n    {{ ref('feed_info_gtfs') }} fi\nON\n    st.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n    WHERE\n        st.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n        AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "stop_times"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/stop_times_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(st.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(st.trip_id AS STRING) trip_id,\n    SAFE_CAST(JSON_VALUE(st.content, '$.arrival_time') AS STRING) arrival_time,\n    SAFE_CAST(JSON_VALUE(st.content, '$.departure_time') AS DATETIME) departure_time,\n    SAFE_CAST(JSON_VALUE(st.content, '$.stop_id') AS STRING) stop_id,\n    SAFE_CAST(st.stop_sequence AS INT64) stop_sequence,\n    SAFE_CAST(JSON_VALUE(st.content, '$.stop_headsign') AS STRING) stop_headsign,\n    SAFE_CAST(JSON_VALUE(st.content, '$.pickup_type') AS STRING) pickup_type,\n    SAFE_CAST(JSON_VALUE(st.content, '$.drop_off_type') AS STRING) drop_off_type,\n    SAFE_CAST(JSON_VALUE(st.content, '$.continuous_pickup') AS STRING) continuous_pickup,\n    SAFE_CAST(JSON_VALUE(st.content, '$.continuous_drop_off') AS STRING) continuous_drop_off,\n    SAFE_CAST(JSON_VALUE(st.content, '$.shape_dist_traveled') AS FLOAT64) shape_dist_traveled,\n    SAFE_CAST(JSON_VALUE(st.content, '$.timepoint') AS STRING) timepoint,\n    '' AS versao_modelo\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`stop_times` st\nJOIN\n    `rj-smtr`.`gtfs`.`feed_info` fi\nON\n    st.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n        st.data_versao IN ('2024-04-15', '2024-05-03')\n        AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.fare_attributes_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "fare_attributes_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/fare_attributes_gtfs.sql", "original_file_path": "models/gtfs/fare_attributes_gtfs.sql", "unique_id": "model.rj_smtr.fare_attributes_gtfs", "fqn": ["rj_smtr", "gtfs", "fare_attributes_gtfs"], "alias": "fare_attributes", "checksum": {"name": "sha256", "checksum": "3da450c71cf7d180feed695fb832e061b7b37ba3fd0277976d29900925edf870"}, "config": {"enabled": true, "alias": "fare_attributes", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["fare_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Informa\u00e7\u00f5es sobre tarifas para rotas de uma ag\u00eancia de transporte p\u00fablico.", "columns": {"fare_id": {"name": "fare_id", "description": "Identifica uma classe de tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "price": {"name": "price", "description": "Pre\u00e7o da tarifa, na unidade especificada por currency_type.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "currency_type": {"name": "currency_type", "description": "Moeda usada para pagar a tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "payment_method": {"name": "payment_method", "description": "Indica quando a tarifa deve ser paga.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "transfers": {"name": "transfers", "description": "Indica o n\u00famero de transfer\u00eancias permitidas nesta tarifa", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_id": {"name": "agency_id", "description": "Identifica a ag\u00eancia relevante para uma tarifa.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "transfer_duration": {"name": "transfer_duration", "description": "Per\u00edodo de tempo em segundos antes que uma transfer\u00eancia expire.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["fare_id", "feed_start_date"], "alias": "fare_attributes"}, "created_at": 1727709588.6932037, "relation_name": "`rj-smtr`.`gtfs`.`fare_attributes`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['fare_id', 'feed_start_date'],\n    alias = 'fare_attributes'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(fa.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(fa.fare_id AS STRING) fare_id,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.price') AS FLOAT64) price,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.currency_type') AS STRING) currency_type,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.payment_method') AS STRING) payment_method,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.transfers') AS STRING) transfers,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.agency_id') AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.transfer_duration') AS INT64) transfer_duration,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{source(\n    'br_rj_riodejaneiro_gtfs_staging',\n    'fare_attributes'\n  )}} fa\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  fa.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    fa.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "fare_attributes"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/fare_attributes_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(fa.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(fa.fare_id AS STRING) fare_id,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.price') AS FLOAT64) price,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.currency_type') AS STRING) currency_type,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.payment_method') AS STRING) payment_method,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.transfers') AS STRING) transfers,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.agency_id') AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(fa.content, '$.transfer_duration') AS INT64) transfer_duration,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`fare_attributes` fa\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  fa.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    fa.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.trips_filtrada_aux_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "trips_filtrada_aux_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/trips_filtrada_aux_gtfs.sql", "original_file_path": "models/gtfs/trips_filtrada_aux_gtfs.sql", "unique_id": "model.rj_smtr.trips_filtrada_aux_gtfs", "fqn": ["rj_smtr", "gtfs", "trips_filtrada_aux_gtfs"], "alias": "trips_filtrada_aux_gtfs", "checksum": {"name": "sha256", "checksum": "1a3264a980c18bf556c13b6f33e76b941251e3d0c174f5169456daf06269d1f6"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709587.1768835, "relation_name": null, "raw_code": "-- depends_on: {{ ref('ordem_servico_trajeto_alternativo_gtfs') }}\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n{% if execute -%}\n  {% if is_incremental() -%}\n    {%- set query = \"SELECT DISTINCT evento FROM \" ~ ref('ordem_servico_trajeto_alternativo_gtfs') ~ \" WHERE feed_start_date = '\" ~ var('data_versao_gtfs')  ~ \"'\" -%}\n  {% else %}\n    {%- set query = \"SELECT DISTINCT evento FROM \" ~ ref('ordem_servico_trajeto_alternativo_gtfs') -%}\n  {% endif -%}\n  {%- set eventos_trajetos_alternativos = run_query(query).columns[0].values() -%}\n{% endif %}\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      {{ ref(\"shapes_geom_gtfs\") }}\n    {% if is_incremental() -%}\n    WHERE\n      feed_start_date = '{{ var(\"data_versao_gtfs\") }}'\n    {% endif -%}\n  ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          {% for evento in eventos_trajetos_alternativos %}\n          trip_headsign LIKE \"%{{evento}}%\" OR\n          {% endfor %}\n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        {{ ref(\"trips_gtfs\") }}\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        {% if is_incremental() -%}\n        feed_start_date = '{{ var(\"data_versao_gtfs\") }}' AND\n        {% endif %}\n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1", "language": "sql", "refs": [{"name": "ordem_servico_trajeto_alternativo_gtfs", "package": null, "version": null}, {"name": "shapes_geom_gtfs", "package": null, "version": null}, {"name": "trips_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.dbt.run_query"], "nodes": ["model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs", "model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.trips_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/trips_filtrada_aux_gtfs.sql", "compiled": true, "compiled_code": "-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.feed_info_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "feed_info_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/feed_info_gtfs.sql", "original_file_path": "models/gtfs/feed_info_gtfs.sql", "unique_id": "model.rj_smtr.feed_info_gtfs", "fqn": ["rj_smtr", "gtfs", "feed_info_gtfs"], "alias": "feed_info", "checksum": {"name": "sha256", "checksum": "53b8273e5260c85ab63cf0ed0236efa82ff2238d6fbf8f9b0c57f80afa1a7509"}, "config": {"enabled": true, "alias": "feed_info", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "feed_start_date", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Metadados do conjunto de dados, incluindo informa\u00e7\u00f5es sobre editor, vers\u00e3o e expira\u00e7\u00e3o.", "columns": {"feed_publisher_name": {"name": "feed_publisher_name", "description": "Nome completo da organiza\u00e7\u00e3o que publica o conjunto de dados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_publisher_url": {"name": "feed_publisher_url", "description": "URL do site da organiza\u00e7\u00e3o que publica o conjunto de dados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_lang": {"name": "feed_lang", "description": "Idioma padr\u00e3o usado para o texto neste conjunto de dados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "default_lang": {"name": "default_lang", "description": "Define o idioma que deve ser usado quando o consumidor de dados n\u00e3o conhece o idioma do passageiro.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "Data de refer\u00eancia do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "O conjunto de dados fornece informa\u00e7\u00f5es de programa\u00e7\u00e3o completas e confi\u00e1veis \u200b\u200bpara servi\u00e7o no per\u00edodo que vai do in\u00edcio do dia feed_start_date at\u00e9 o final do dia feed_end_date.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_contact_email": {"name": "feed_contact_email", "description": "Endere\u00e7o de e-mail para comunica\u00e7\u00e3o sobre o conjunto de dados gtfs e pr\u00e1ticas de publica\u00e7\u00e3o de dados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_contact_url": {"name": "feed_contact_url", "description": "URL para informa\u00e7\u00f5es de contato, um formul\u00e1rio web, uma mesa de suporte ou outras ferramentas de comunica\u00e7\u00e3o relativas ao conjunto de dados GTFS e pr\u00e1ticas de publica\u00e7\u00e3o de dados.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_update_datetime": {"name": "feed_update_datetime", "description": "Data e hora da \u00faltima atualiza\u00e7\u00e3o do feed.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "alias": "feed_info", "unique_key": "feed_start_date"}, "created_at": 1727709588.6978965, "relation_name": "`rj-smtr`.`gtfs`.`feed_info`", "raw_code": "{{config(\n  materialized='incremental',\n  partition_by = { 'field' :'feed_start_date',\n  'data_type' :'date',\n  'granularity': 'day' },\n  alias = 'feed_info',\n  unique_key = 'feed_start_date',\n  incremental_strategy = 'insert_overwrite'\n)}}\n\nWITH feed_info AS (\n  SELECT\n    SAFE_CAST(timestamp_captura AS STRING) AS feed_version,\n    SAFE_CAST(data_versao AS DATE) AS feed_start_date,\n    NULL AS feed_end_date,\n    SAFE_CAST(feed_publisher_name AS STRING) feed_publisher_name,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_publisher_url') AS STRING) feed_publisher_url,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_lang') AS STRING) feed_lang,\n    SAFE_CAST(JSON_VALUE(content, '$.default_lang') AS STRING) default_lang,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_contact_email') AS STRING) feed_contact_email,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_contact_url') AS STRING) feed_contact_url,\n    CURRENT_DATETIME(\"America/Sao_Paulo\") AS feed_update_datetime,\n    '{{ var(\"version\") }}' AS versao_modelo\n  FROM\n    {{ source(\n      'br_rj_riodejaneiro_gtfs_staging',\n      'feed_info'\n    ) }}\n  {% if is_incremental() %}\n    WHERE\n      data_versao =  '{{ var(\"data_versao_gtfs\") }}'\n    UNION ALL\n      SELECT\n        *\n      FROM\n        {{ this }}\n      WHERE\n        feed_start_date != DATE('{{ var(\"data_versao_gtfs\") }}')\n  {% endif %}\n  )\n  SELECT\n    feed_version,\n    feed_start_date,\n    DATE_SUB(LEAD(DATE(feed_version)) OVER (ORDER BY feed_version), INTERVAL 1 DAY) AS feed_end_date,\n    feed_publisher_name,\n    feed_publisher_url,\n    feed_lang,\n    default_lang,\n    feed_contact_email,\n    feed_contact_url,\n    feed_update_datetime,\n    versao_modelo\n  FROM\n    feed_info", "language": "sql", "refs": [], "sources": [["br_rj_riodejaneiro_gtfs_staging", "feed_info"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/feed_info_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH feed_info AS (\n  SELECT\n    SAFE_CAST(timestamp_captura AS STRING) AS feed_version,\n    SAFE_CAST(data_versao AS DATE) AS feed_start_date,\n    NULL AS feed_end_date,\n    SAFE_CAST(feed_publisher_name AS STRING) feed_publisher_name,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_publisher_url') AS STRING) feed_publisher_url,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_lang') AS STRING) feed_lang,\n    SAFE_CAST(JSON_VALUE(content, '$.default_lang') AS STRING) default_lang,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_contact_email') AS STRING) feed_contact_email,\n    SAFE_CAST(JSON_VALUE(content, '$.feed_contact_url') AS STRING) feed_contact_url,\n    CURRENT_DATETIME(\"America/Sao_Paulo\") AS feed_update_datetime,\n    '' AS versao_modelo\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`feed_info`\n  \n    WHERE\n      data_versao =  '2024-05-03'\n    UNION ALL\n      SELECT\n        *\n      FROM\n        `rj-smtr`.`gtfs`.`feed_info`\n      WHERE\n        feed_start_date != DATE('2024-05-03')\n  \n  )\n  SELECT\n    feed_version,\n    feed_start_date,\n    DATE_SUB(LEAD(DATE(feed_version)) OVER (ORDER BY feed_version), INTERVAL 1 DAY) AS feed_end_date,\n    feed_publisher_name,\n    feed_publisher_url,\n    feed_lang,\n    default_lang,\n    feed_contact_email,\n    feed_contact_url,\n    feed_update_datetime,\n    versao_modelo\n  FROM\n    feed_info", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.frequencies_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "frequencies_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/frequencies_gtfs.sql", "original_file_path": "models/gtfs/frequencies_gtfs.sql", "unique_id": "model.rj_smtr.frequencies_gtfs", "fqn": ["rj_smtr", "gtfs", "frequencies_gtfs"], "alias": "frequencies", "checksum": {"name": "sha256", "checksum": "29d45cbf124a6c31620b34ad87ec289bf0c188fccea752fd32fee87e9994a6b8"}, "config": {"enabled": true, "alias": "frequencies", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["trip_id", "start_time", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Intervalo (tempo entre viagens) para servi\u00e7o baseado em intervalo ou uma representa\u00e7\u00e3o compactada de servi\u00e7o com hor\u00e1rio fixo.", "columns": {"trip_id": {"name": "trip_id", "description": "Identifica uma viagem \u00e0 qual se aplica o intervalo de servi\u00e7o especificado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_time": {"name": "start_time", "description": "Hora em que o primeiro ve\u00edculo sai da primeira parada da viagem com o intervalo especificado.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_time": {"name": "end_time", "description": "Hora em que o servi\u00e7o muda para um intervalo diferente (ou cessa) na primeira parada da viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "headway_secs": {"name": "headway_secs", "description": "Tempo, em segundos, entre partidas da mesma parada (intervalo) da viagem, durante o intervalo de tempo especificado por start_time e end_time.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "exact_times": {"name": "exact_times", "description": "Indica o tipo de servi\u00e7o para uma viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["trip_id", "start_time", "feed_start_date"], "alias": "frequencies"}, "created_at": 1727709588.6998327, "relation_name": "`rj-smtr`.`gtfs`.`frequencies`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['trip_id', 'start_time', 'feed_start_date'],\n    alias = 'frequencies'\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(f.data_versao AS DATE) as feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(f.trip_id AS STRING) trip_id,\n  SAFE_CAST(f.start_time AS STRING) start_time,\n  SAFE_CAST(JSON_VALUE(f.content, '$.end_time') AS STRING) end_time,\n  SAFE_CAST(JSON_VALUE(f.content, '$.headway_secs') AS INT64) headway_secs,\n  SAFE_CAST(JSON_VALUE(f.content, '$.exact_times') AS STRING) exact_times,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{source('br_rj_riodejaneiro_gtfs_staging', 'frequencies')}} f\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  f.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    f.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "frequencies"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/frequencies_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(f.data_versao AS DATE) as feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(f.trip_id AS STRING) trip_id,\n  SAFE_CAST(f.start_time AS STRING) start_time,\n  SAFE_CAST(JSON_VALUE(f.content, '$.end_time') AS STRING) end_time,\n  SAFE_CAST(JSON_VALUE(f.content, '$.headway_secs') AS INT64) headway_secs,\n  SAFE_CAST(JSON_VALUE(f.content, '$.exact_times') AS STRING) exact_times,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`frequencies` f\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  f.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    f.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.servicos_sentido": {"database": "rj-smtr", "schema": "gtfs", "name": "servicos_sentido", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/servicos_sentido.sql", "original_file_path": "models/gtfs/servicos_sentido.sql", "unique_id": "model.rj_smtr.servicos_sentido", "fqn": ["rj_smtr", "gtfs", "servicos_sentido"], "alias": "servicos_sentido", "checksum": {"name": "sha256", "checksum": "f1c0cdbfc5886081fbdd734aced2bdadb926f36b2d81d5f417fa135c3fa4330c"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Sentido dos servi\u00e7os (I - Ida, V - Volta, C - Circular)", "columns": {"feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709588.7187147, "relation_name": "`rj-smtr`.`gtfs`.`servicos_sentido`", "raw_code": "{{ config(\n  materialized=\"view\"\n) }}\n\nWITH\n  servicos_exclusivos_sabado AS (\n    SELECT\n      DISTINCT servico\n    FROM\n      {{ ref(\"ordem_servico_gtfs\") }}\n    WHERE\n      tipo_dia = \"Dia \u00datil\"\n      AND viagens_planejadas = 0),\n  servicos AS (\n    SELECT\n      * EXCEPT(versao_modelo,\n        shape)\n    FROM\n      {{ ref(\"trips_gtfs\") }} AS t\n    LEFT JOIN\n      {{ ref(\"shapes_geom_gtfs\") }} AS s\n    USING\n      (feed_start_date,\n        shape_id)\n    WHERE\n      (feed_start_date >= \"2023-06-01\" AND\n        ( trip_short_name NOT IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND (service_id LIKE \"U_R%\"\n            OR service_id LIKE \"U_O%\") )\n        OR ( trip_short_name IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND (service_id LIKE \"S_R%\"\n            OR service_id LIKE \"S_O%\")))\n      OR\n      (feed_start_date < \"2023-06-01\" AND\n        ( trip_short_name NOT IN (SELECT * FROM servicos_exclusivos_sabado)\n        OR ( trip_short_name IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND service_id = \"S\")))\n      AND shape_distance IS NOT NULL),\n  servicos_rn AS (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY feed_start_date, trip_short_name, direction_id ORDER BY trip_short_name, service_id, shape_id, direction_id) AS rn\n    FROM\n      servicos ),\n    servicos_filtrada AS (\n    SELECT\n      * EXCEPT(rn)\n    FROM\n      servicos_rn\n    WHERE\n      rn = 1),\n  servicos_potencialmente_circulares AS (\n    SELECT\n      feed_start_date,\n      trip_short_name,\n      COUNT(DISTINCT direction_id) AS q_direcoes\n    FROM\n      servicos_filtrada\n    GROUP BY\n      1,\n      2\n    HAVING\n      COUNT(DISTINCT direction_id) = 1 )\nSELECT\n  feed_start_date,\n  trip_short_name AS servico,\n  CASE\n    WHEN q_direcoes = 1 AND ST_DISTANCE(start_pt, end_pt) <= 50 THEN \"C\"\n    WHEN direction_id = \"0\" THEN \"I\"\n    WHEN direction_id = \"1\" THEN \"V\"\nEND\n  AS sentido\nFROM\n  servicos_filtrada AS sf\nLEFT JOIN\n  servicos_potencialmente_circulares AS spc\nUSING\n  (feed_start_date,\n    trip_short_name)", "language": "sql", "refs": [{"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "trips_gtfs", "package": null, "version": null}, {"name": "shapes_geom_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.trips_gtfs", "model.rj_smtr.shapes_geom_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/servicos_sentido.sql", "compiled": true, "compiled_code": "\n\nWITH\n  servicos_exclusivos_sabado AS (\n    SELECT\n      DISTINCT servico\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    WHERE\n      tipo_dia = \"Dia \u00datil\"\n      AND viagens_planejadas = 0),\n  servicos AS (\n    SELECT\n      * EXCEPT(versao_modelo,\n        shape)\n    FROM\n      `rj-smtr`.`gtfs`.`trips` AS t\n    LEFT JOIN\n      `rj-smtr`.`gtfs`.`shapes_geom` AS s\n    USING\n      (feed_start_date,\n        shape_id)\n    WHERE\n      (feed_start_date >= \"2023-06-01\" AND\n        ( trip_short_name NOT IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND (service_id LIKE \"U_R%\"\n            OR service_id LIKE \"U_O%\") )\n        OR ( trip_short_name IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND (service_id LIKE \"S_R%\"\n            OR service_id LIKE \"S_O%\")))\n      OR\n      (feed_start_date < \"2023-06-01\" AND\n        ( trip_short_name NOT IN (SELECT * FROM servicos_exclusivos_sabado)\n        OR ( trip_short_name IN (SELECT * FROM servicos_exclusivos_sabado)\n          AND service_id = \"S\")))\n      AND shape_distance IS NOT NULL),\n  servicos_rn AS (\n    SELECT\n      *,\n      ROW_NUMBER() OVER (PARTITION BY feed_start_date, trip_short_name, direction_id ORDER BY trip_short_name, service_id, shape_id, direction_id) AS rn\n    FROM\n      servicos ),\n    servicos_filtrada AS (\n    SELECT\n      * EXCEPT(rn)\n    FROM\n      servicos_rn\n    WHERE\n      rn = 1),\n  servicos_potencialmente_circulares AS (\n    SELECT\n      feed_start_date,\n      trip_short_name,\n      COUNT(DISTINCT direction_id) AS q_direcoes\n    FROM\n      servicos_filtrada\n    GROUP BY\n      1,\n      2\n    HAVING\n      COUNT(DISTINCT direction_id) = 1 )\nSELECT\n  feed_start_date,\n  trip_short_name AS servico,\n  CASE\n    WHEN q_direcoes = 1 AND ST_DISTANCE(start_pt, end_pt) <= 50 THEN \"C\"\n    WHEN direction_id = \"0\" THEN \"I\"\n    WHEN direction_id = \"1\" THEN \"V\"\nEND\n  AS sentido\nFROM\n  servicos_filtrada AS sf\nLEFT JOIN\n  servicos_potencialmente_circulares AS spc\nUSING\n  (feed_start_date,\n    trip_short_name)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_diaria": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_diaria", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_diaria.sql", "original_file_path": "models/gtfs/ordem_servico_diaria.sql", "unique_id": "model.rj_smtr.ordem_servico_diaria", "fqn": ["rj_smtr", "gtfs", "ordem_servico_diaria"], "alias": "ordem_servico_diaria", "checksum": {"name": "sha256", "checksum": "bc71ca111a218433470cf43a3638d3ba50cc824fe4089e9d114beccf542ff4cf"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Dados di\u00e1rios das linhas presentes no munic\u00edpio.", "columns": {"DATA": {"name": "DATA", "description": "Data da ordem de servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, S\u00e1bado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio ao qual o servi\u00e7o pertence.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "sentido": {"name": "sentido", "description": "Sentido da linha", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_planejadas": {"name": "viagens_planejadas", "description": "Viagens planejadas no per\u00edodo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "inicio_periodo": {"name": "inicio_periodo", "description": "In\u00edcio do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "fim_periodo": {"name": "fim_periodo", "description": "Fim do per\u00edodo de opera\u00e7\u00e3o planejado", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709588.7175684, "relation_name": "`rj-smtr`.`gtfs`.`ordem_servico_diaria`", "raw_code": "{{ config(\n  materialized=\"view\"\n) }}\n\nWITH\n  feed_start_date AS (\n  SELECT\n    feed_start_date,\n    feed_start_date AS data_inicio,\n    COALESCE(DATE_SUB(LEAD(feed_start_date) OVER (ORDER BY feed_start_date), INTERVAL 1 DAY), LAST_DAY(feed_start_date, MONTH)) AS data_fim\n  FROM (\n    SELECT\n      DISTINCT feed_start_date,\n    FROM\n      {{ ref(\"ordem_servico_gtfs\") }} )),\n  ordem_servico_pivot AS (\n  SELECT\n    *\n  FROM\n    {{ ref(\"ordem_servico_gtfs\") }}\n    PIVOT( MAX(partidas_ida) AS partidas_ida,\n      MAX(partidas_volta) AS partidas_volta,\n      MAX(viagens_planejadas) AS viagens_planejadas,\n      MAX(distancia_total_planejada) AS km FOR\n      tipo_dia IN (\n        'Dia \u00datil' AS du,\n        'Ponto Facultativo' AS pf,\n        'Sabado' AS sab,\n        'Domingo' AS dom ))),\n  subsidio_feed_start_date_efetiva AS (\n  SELECT\n    data,\n    SPLIT(tipo_dia, \" - \")[0] AS tipo_dia,\n    tipo_dia AS tipo_dia_original\n  FROM\n    {{ ref(\"subsidio_data_versao_efetiva\") }} )\nSELECT\n  DATA,\n  tipo_dia_original AS tipo_dia,\n  servico,\n  vista,\n  consorcio,\n  sentido,\n  CASE\n  {% set tipo_dia = {\"Dia \u00datil\": \"du\", \"Ponto Facultativo\": \"pf\", \"Sabado\": \"sab\", \"Domingo\": \"dom\"} %}\n  {% set sentido = {\"ida\": (\"I\", \"C\"), \"volta\": \"V\"} %}\n  {%- for key_s, value_s in sentido.items() %}\n    {%- for key_td, value_td in tipo_dia.items() %}\n      WHEN sentido {% if key_s == \"ida\" %} IN {{ value_s }} {% else %} = \"{{ value_s }}\" {% endif %} AND tipo_dia = \"{{ key_td }}\" THEN {% if key_td in [\"Sabado\", \"Domingo\"] %} ROUND(SAFE_DIVIDE((partidas_{{ key_s }}_du * km_{{ value_td }}), km_du)) {% else %} partidas_{{ key_s }}_{{ value_td }} {% endif %}\n    {% endfor -%}\n  {% endfor -%}\nEND\n  AS viagens_planejadas,\n  horario_inicio AS inicio_periodo,\n  horario_fim AS fim_periodo\nFROM\n  UNNEST(GENERATE_DATE_ARRAY((SELECT MIN(data_inicio) FROM feed_start_date), (SELECT MAX(data_fim) FROM feed_start_date))) AS DATA\nLEFT JOIN\n  feed_start_date AS d\nON\n  DATA BETWEEN d.data_inicio\n  AND d.data_fim\nLEFT JOIN\n  subsidio_feed_start_date_efetiva AS sd\nUSING\n  (DATA)\nLEFT JOIN\n  ordem_servico_pivot AS o\nUSING\n  (feed_start_date)\nLEFT JOIN\n  {{ ref(\"servicos_sentido\") }}\nUSING\n  (feed_start_date,\n    servico)", "language": "sql", "refs": [{"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "servicos_sentido", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.servicos_sentido"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_diaria.sql", "compiled": true, "compiled_code": "\n\nWITH\n  feed_start_date AS (\n  SELECT\n    feed_start_date,\n    feed_start_date AS data_inicio,\n    COALESCE(DATE_SUB(LEAD(feed_start_date) OVER (ORDER BY feed_start_date), INTERVAL 1 DAY), LAST_DAY(feed_start_date, MONTH)) AS data_fim\n  FROM (\n    SELECT\n      DISTINCT feed_start_date,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico` )),\n  ordem_servico_pivot AS (\n  SELECT\n    *\n  FROM\n    `rj-smtr`.`gtfs`.`ordem_servico`\n    PIVOT( MAX(partidas_ida) AS partidas_ida,\n      MAX(partidas_volta) AS partidas_volta,\n      MAX(viagens_planejadas) AS viagens_planejadas,\n      MAX(distancia_total_planejada) AS km FOR\n      tipo_dia IN (\n        'Dia \u00datil' AS du,\n        'Ponto Facultativo' AS pf,\n        'Sabado' AS sab,\n        'Domingo' AS dom ))),\n  subsidio_feed_start_date_efetiva AS (\n  SELECT\n    data,\n    SPLIT(tipo_dia, \" - \")[0] AS tipo_dia,\n    tipo_dia AS tipo_dia_original\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva` )\nSELECT\n  DATA,\n  tipo_dia_original AS tipo_dia,\n  servico,\n  vista,\n  consorcio,\n  sentido,\n  CASE\n  \n  \n      WHEN sentido  IN ('I', 'C')  AND tipo_dia = \"Dia \u00datil\" THEN  partidas_ida_du \n    \n      WHEN sentido  IN ('I', 'C')  AND tipo_dia = \"Ponto Facultativo\" THEN  partidas_ida_pf \n    \n      WHEN sentido  IN ('I', 'C')  AND tipo_dia = \"Sabado\" THEN  ROUND(SAFE_DIVIDE((partidas_ida_du * km_sab), km_du)) \n    \n      WHEN sentido  IN ('I', 'C')  AND tipo_dia = \"Domingo\" THEN  ROUND(SAFE_DIVIDE((partidas_ida_du * km_dom), km_du)) \n    \n      WHEN sentido  = \"V\"  AND tipo_dia = \"Dia \u00datil\" THEN  partidas_volta_du \n    \n      WHEN sentido  = \"V\"  AND tipo_dia = \"Ponto Facultativo\" THEN  partidas_volta_pf \n    \n      WHEN sentido  = \"V\"  AND tipo_dia = \"Sabado\" THEN  ROUND(SAFE_DIVIDE((partidas_volta_du * km_sab), km_du)) \n    \n      WHEN sentido  = \"V\"  AND tipo_dia = \"Domingo\" THEN  ROUND(SAFE_DIVIDE((partidas_volta_du * km_dom), km_du)) \n    END\n  AS viagens_planejadas,\n  horario_inicio AS inicio_periodo,\n  horario_fim AS fim_periodo\nFROM\n  UNNEST(GENERATE_DATE_ARRAY((SELECT MIN(data_inicio) FROM feed_start_date), (SELECT MAX(data_fim) FROM feed_start_date))) AS DATA\nLEFT JOIN\n  feed_start_date AS d\nON\n  DATA BETWEEN d.data_inicio\n  AND d.data_fim\nLEFT JOIN\n  subsidio_feed_start_date_efetiva AS sd\nUSING\n  (DATA)\nLEFT JOIN\n  ordem_servico_pivot AS o\nUSING\n  (feed_start_date)\nLEFT JOIN\n  `rj-smtr`.`gtfs`.`servicos_sentido`\nUSING\n  (feed_start_date,\n    servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.stops_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "stops_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/stops_gtfs.sql", "original_file_path": "models/gtfs/stops_gtfs.sql", "unique_id": "model.rj_smtr.stops_gtfs", "fqn": ["rj_smtr", "gtfs", "stops_gtfs"], "alias": "stops", "checksum": {"name": "sha256", "checksum": "5d9f1d01b8ec6f7922e2706993a946ec5689e3b50dc01644c2eed5649d379308"}, "config": {"enabled": true, "alias": "stops", "schema": "gtfs", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["stop_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Paradas onde os ve\u00edculos pegam ou deixam os passageiros. Tamb\u00e9m define esta\u00e7\u00f5es e entradas de esta\u00e7\u00e3o.", "columns": {"stop_id": {"name": "stop_id", "description": "Identifica uma localiza\u00e7\u00e3o: paragem/plataforma, esta\u00e7\u00e3o, entrada/sa\u00edda, n\u00f3 gen\u00e9rico ou \u00e1rea de embarque", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_code": {"name": "stop_code", "description": "Texto curto ou um n\u00famero que identifica a localiza\u00e7\u00e3o dos passageiros.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_name": {"name": "stop_name", "description": "Nome do local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tts_stop_name": {"name": "tts_stop_name", "description": "Vers\u00e3o leg\u00edvel do stop_name.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_desc": {"name": "stop_desc", "description": "Descri\u00e7\u00e3o do local que fornece informa\u00e7\u00f5es \u00fateis e de qualidade.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_lat": {"name": "stop_lat", "description": "Latitude do local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_lon": {"name": "stop_lon", "description": "Longitude do local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "zone_id": {"name": "zone_id", "description": "Identifica a zona tarif\u00e1ria para uma parada.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_url": {"name": "stop_url", "description": "URL de uma p\u00e1gina da web sobre o local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "location_type": {"name": "location_type", "description": "Tipo de localiza\u00e7\u00e3o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "parent_station": {"name": "parent_station", "description": "Define a hierarquia entre os diferentes locais definidos em stops.txt.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "stop_timezone": {"name": "stop_timezone", "description": "Fuso hor\u00e1rio do local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "wheelchair_boarding": {"name": "wheelchair_boarding", "description": "Indica se o embarque para cadeiras de rodas \u00e9 poss\u00edvel no local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "level_id": {"name": "level_id", "description": "N\u00edvel do local.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "platform_code": {"name": "platform_code", "description": "Identificador de plataforma para uma parada de plataforma (uma parada pertencente a uma esta\u00e7\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["stop_id", "feed_start_date"], "alias": "stops", "tags": ["geolocalizacao"]}, "created_at": 1727709588.7116544, "relation_name": "`rj-smtr`.`gtfs`.`stops`", "raw_code": "{{config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['stop_id', 'feed_start_date'],\n    alias = 'stops',\n    tags=['geolocalizacao']\n)}}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(s.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(s.stop_id AS STRING) stop_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_code') AS STRING) stop_code,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_name') AS STRING) stop_name,\n    SAFE_CAST(JSON_VALUE(s.content, '$.tts_stop_name') AS STRING) tts_stop_name,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_desc') AS STRING) stop_desc,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_lat') AS FLOAT64) stop_lat,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_lon') AS FLOAT64) stop_lon,\n    SAFE_CAST(JSON_VALUE(s.content, '$.zone_id') AS STRING) zone_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_url') AS STRING) stop_url,\n    SAFE_CAST(SAFE_CAST(SAFE_CAST(JSON_VALUE(s.content, '$.location_type') AS FLOAT64) AS INT64) AS STRING) location_type,\n    SAFE_CAST(JSON_VALUE(s.content, '$.parent_station') AS STRING) parent_station,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_timezone') AS STRING) stop_timezone,\n    SAFE_CAST(JSON_VALUE(s.content, '$.wheelchair_boarding') AS STRING) wheelchair_boarding,\n    SAFE_CAST(JSON_VALUE(s.content, '$.level_id') AS STRING) level_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.platform_code') AS STRING) platform_code,\n    '{{ var(\"version\") }}' AS versao_modelo\nFROM\n    {{ source(\n        'br_rj_riodejaneiro_gtfs_staging',\n        'stops'\n    ) }} s\nJOIN\n    {{ ref('feed_info_gtfs') }} fi\nON\n    s.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n    WHERE\n        s.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n        AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "stops"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/stops_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n    fi.feed_version,\n    SAFE_CAST(s.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(s.stop_id AS STRING) stop_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_code') AS STRING) stop_code,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_name') AS STRING) stop_name,\n    SAFE_CAST(JSON_VALUE(s.content, '$.tts_stop_name') AS STRING) tts_stop_name,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_desc') AS STRING) stop_desc,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_lat') AS FLOAT64) stop_lat,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_lon') AS FLOAT64) stop_lon,\n    SAFE_CAST(JSON_VALUE(s.content, '$.zone_id') AS STRING) zone_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_url') AS STRING) stop_url,\n    SAFE_CAST(SAFE_CAST(SAFE_CAST(JSON_VALUE(s.content, '$.location_type') AS FLOAT64) AS INT64) AS STRING) location_type,\n    SAFE_CAST(JSON_VALUE(s.content, '$.parent_station') AS STRING) parent_station,\n    SAFE_CAST(JSON_VALUE(s.content, '$.stop_timezone') AS STRING) stop_timezone,\n    SAFE_CAST(JSON_VALUE(s.content, '$.wheelchair_boarding') AS STRING) wheelchair_boarding,\n    SAFE_CAST(JSON_VALUE(s.content, '$.level_id') AS STRING) level_id,\n    SAFE_CAST(JSON_VALUE(s.content, '$.platform_code') AS STRING) platform_code,\n    '' AS versao_modelo\nFROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`stops` s\nJOIN\n    `rj-smtr`.`gtfs`.`feed_info` fi\nON\n    s.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n        s.data_versao IN ('2024-04-15', '2024-05-03')\n        AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs.sql", "original_file_path": "models/gtfs/ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs.sql", "unique_id": "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "fqn": ["rj_smtr", "gtfs", "ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs"], "alias": "ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "checksum": {"name": "sha256", "checksum": "0bb32a04a764ed080c387ea8e368b8ca60c22c7ed5642fe2eda2a42b00a422bc"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "ephemeral", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709587.2179704, "relation_name": null, "raw_code": "/*\n  ordem_servico_trajeto_alternativo_gtfs com sentidos despivotados e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n{{\n  config(\n    materialized='ephemeral'\n  )\n}}\n\n-- 1. Busca anexo de trajetos alternativos\nWITH\n  ordem_servico_trajeto_alternativo AS (\n    SELECT\n      *\n    FROM\n      {{ ref(\"ordem_servico_trajeto_alternativo_gtfs\") }}\n    {% if is_incremental() -%}\n      WHERE\n        feed_start_date = \"{{ var('data_versao_gtfs') }}\"\n    {%- endif %}\n  ),\n  -- 2. Despivota anexo de trajetos alternativos\n  ordem_servico_trajeto_alternativo_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico_trajeto_alternativo\n    UNPIVOT\n    (\n      (\n        distancia_planejada\n      ) FOR sentido IN (\n        (\n          extensao_ida\n        ) AS \"I\",\n        (\n          extensao_volta\n        ) AS \"V\"\n      )\n    )\n  )\n-- 3. Atualiza sentido dos servi\u00e7os circulares no anexo de trajetos alternativos\nSELECT\n    * EXCEPT(sentido),\n    CASE\n        WHEN \"C\" IN UNNEST(sentido_array) THEN \"C\"\n        ELSE o.sentido\n    END AS sentido,\nFROM\n    ordem_servico_trajeto_alternativo_sentido AS o\nLEFT JOIN\n(\n    SELECT\n        feed_start_date,\n        servico,\n        ARRAY_AGG(DISTINCT sentido) AS sentido_array,\n    FROM\n        {{ ref(\"ordem_servico_sentido_atualizado_aux_gtfs\") }}\n    GROUP BY\n        1,\n        2\n) AS s\nUSING\n    (feed_start_date, servico)\nWHERE\n    distancia_planejada != 0", "language": "sql", "refs": [{"name": "ordem_servico_trajeto_alternativo_gtfs", "package": null, "version": null}, {"name": "ordem_servico_sentido_atualizado_aux_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs", "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs.sql", "compiled": true, "compiled_code": "/*\n  ordem_servico_trajeto_alternativo_gtfs com sentidos despivotados e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\n\n-- 1. Busca anexo de trajetos alternativos\nWITH\n   __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n),  __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\nWITH\n  -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          __dbt__cte__trips_filtrada_aux_gtfs\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    \n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '2024-08-16'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '2024-08-16'\n      )\n), ordem_servico_trajeto_alternativo AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n    \n  ),\n  -- 2. Despivota anexo de trajetos alternativos\n  ordem_servico_trajeto_alternativo_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico_trajeto_alternativo\n    UNPIVOT\n    (\n      (\n        distancia_planejada\n      ) FOR sentido IN (\n        (\n          extensao_ida\n        ) AS \"I\",\n        (\n          extensao_volta\n        ) AS \"V\"\n      )\n    )\n  )\n-- 3. Atualiza sentido dos servi\u00e7os circulares no anexo de trajetos alternativos\nSELECT\n    * EXCEPT(sentido),\n    CASE\n        WHEN \"C\" IN UNNEST(sentido_array) THEN \"C\"\n        ELSE o.sentido\n    END AS sentido,\nFROM\n    ordem_servico_trajeto_alternativo_sentido AS o\nLEFT JOIN\n(\n    SELECT\n        feed_start_date,\n        servico,\n        ARRAY_AGG(DISTINCT sentido) AS sentido_array,\n    FROM\n        __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs\n    GROUP BY\n        1,\n        2\n) AS s\nUSING\n    (feed_start_date, servico)\nWHERE\n    distancia_planejada != 0", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.trips_filtrada_aux_gtfs", "sql": " __dbt__cte__trips_filtrada_aux_gtfs as (\n-- depends_on: `rj-smtr`.`gtfs`.`ordem_servico_trajeto_alternativo`\n/*\nIdentifica\u00e7\u00e3o de um trip de refer\u00eancia para cada servi\u00e7o e sentido regular\nIdentifica\u00e7\u00e3o de todas as trips de refer\u00eancia para os trajetos alternativos\n*/\n\n\n\n\n\nWITH\n  -- 1. Busca os shapes em formato geogr\u00e1fico\n  shapes AS (\n    SELECT\n      *\n    FROM\n      `rj-smtr`.`gtfs`.`shapes_geom`\n    ),\n  -- 2. Busca as trips\n  trips_all AS (\n    SELECT\n      *,\n      CASE\n        WHEN indicador_trajeto_alternativo = TRUE THEN CONCAT(feed_version, trip_short_name, tipo_dia, direction_id, shape_id)\n        ELSE CONCAT(feed_version, trip_short_name, tipo_dia, direction_id)\n      END AS trip_partition\n    FROM\n    (\n      SELECT\n        service_id,\n        trip_id,\n        trip_headsign,\n        trip_short_name,\n        direction_id,\n        shape_id,\n        feed_version,\n        shape_distance,\n        start_pt,\n        end_pt,\n        CASE\n          WHEN service_id LIKE \"%U_%\" THEN \"Dia \u00datil\"\n          WHEN service_id LIKE \"%S_%\" THEN \"Sabado\"\n          WHEN service_id LIKE \"%D_%\" THEN \"Domingo\"\n        ELSE\n        service_id\n      END\n        AS tipo_dia,\n        CASE WHEN (\n          \n          trip_headsign LIKE \"%[revers\u00edvel]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_1]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade_2]%\" OR\n          \n          trip_headsign LIKE \"%[desvio] [feira]%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 1%\" OR\n          \n          trip_headsign LIKE \"%[excepcionalidade] 2%\" OR\n          \n          trip_headsign LIKE \"%[madonna]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 3]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 2]%\" OR\n          \n          trip_headsign LIKE \"%[madonna 1]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_t\u00fanel]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_lazer]%\" OR\n          \n          trip_headsign LIKE \"%[rock_in_rio]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_maracan\u00e3]%\" OR\n          \n          trip_headsign LIKE \"%[desvio_janu\u00e1rio]%\" OR\n          \n          service_id = \"EXCEP\") THEN TRUE\n        ELSE FALSE\n      END\n        AS indicador_trajeto_alternativo,\n      FROM\n        `rj-smtr`.`gtfs`.`trips`\n      LEFT JOIN\n        shapes\n      USING\n        (feed_start_date,\n        feed_version,\n        shape_id)\n      WHERE\n        \n        service_id NOT LIKE \"%_DESAT_%\"  -- Desconsidera service_ids desativados\n    )\n  )\n-- 3. Busca as trips de refer\u00eancia para cada servi\u00e7o, sentido, e tipo_dia\nSELECT\n    * EXCEPT(rn)\nFROM\n(\n    SELECT\n    * EXCEPT(shape_distance),\n    ROW_NUMBER() OVER (PARTITION BY trip_partition ORDER BY feed_version, trip_short_name, tipo_dia, direction_id, shape_distance DESC) AS rn\n    FROM\n    trips_all\n)\nWHERE\n    rn = 1\n)"}, {"id": "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "sql": " __dbt__cte__ordem_servico_sentido_atualizado_aux_gtfs as (\n/*\n  ordem_servico_gtfs com sentidos despivotados, ajustes nos hor\u00e1rios e com atualiza\u00e7\u00e3o dos sentidos circulares\n*/\n\n\nWITH\n  -- 1. Identifica o sentido de cada servi\u00e7o\n  servico_trips_sentido AS (\n    SELECT\n      DISTINCT *\n    FROM\n      (\n        SELECT\n          feed_version,\n          trip_short_name AS servico,\n          CASE\n            WHEN ROUND(ST_Y(start_pt),4) = ROUND(ST_Y(end_pt),4) AND ROUND(ST_X(start_pt),4) = ROUND(ST_X(end_pt),4) THEN \"C\"\n            WHEN direction_id = \"0\" THEN \"I\"\n            WHEN direction_id = \"1\" THEN \"V\"\n        END\n          AS sentido\n        FROM\n          __dbt__cte__trips_filtrada_aux_gtfs\n        WHERE\n          indicador_trajeto_alternativo IS FALSE\n      )\n    WHERE\n      sentido = \"C\"\n  ),\n  -- 2. Busca principais informa\u00e7\u00f5es na Ordem de Servi\u00e7o (OS)\n  ordem_servico AS (\n    SELECT\n      * EXCEPT(horario_inicio, horario_fim),\n      horario_inicio AS inicio_periodo,\n      horario_fim  AS fim_periodo,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico`\n    \n  ),\n  -- 3. Despivota ordem de servi\u00e7o por sentido\n  ordem_servico_sentido AS (\n    SELECT\n      *\n    FROM\n      ordem_servico\n    UNPIVOT\n    (\n      (\n        distancia_planejada,\n        partidas\n      ) FOR sentido IN (\n        (\n          extensao_ida,\n          partidas_ida\n        ) AS \"I\",\n        (\n          extensao_volta,\n          partidas_volta\n        ) AS \"V\"\n      )\n    )\n  )\n  -- 4. Atualiza sentido dos servi\u00e7os circulares na ordem de servi\u00e7o\nSELECT\n    o.* EXCEPT(sentido),\n    COALESCE(s.sentido, o.sentido) AS sentido\nFROM\n    ordem_servico_sentido AS o\nLEFT JOIN\n    servico_trips_sentido AS s\nUSING\n    (feed_version, servico)\nWHERE\n    distancia_planejada != 0\n    AND\n      (\n        (\n          feed_start_date < '2024-08-16'\n          AND\n            (\n              distancia_total_planejada != 0\n              AND (partidas != 0 OR partidas IS NULL)\n            )\n        )\n      OR\n        feed_start_date >= '2024-08-16'\n      )\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.agency_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "agency_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/agency_gtfs.sql", "original_file_path": "models/gtfs/agency_gtfs.sql", "unique_id": "model.rj_smtr.agency_gtfs", "fqn": ["rj_smtr", "gtfs", "agency_gtfs"], "alias": "agency", "checksum": {"name": "sha256", "checksum": "0b11036262ba488e3def851ae0a0082d7d435b4ae09108347e44cfe83762c784"}, "config": {"enabled": true, "alias": "agency", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["agency_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Ag\u00eancia de transporte p\u00fablico com servi\u00e7os representados neste conjunto de dados.", "columns": {"agency_id": {"name": "agency_id", "description": "Identifica uma marca de transporte p\u00fablico que geralmente \u00e9 sin\u00f4nimo de ag\u00eancia de transporte p\u00fablico.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_name": {"name": "agency_name", "description": "Nome completo da ag\u00eancia de transporte p\u00fablico.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_url": {"name": "agency_url", "description": "URL da ag\u00eancia de transporte p\u00fablico.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_timezone": {"name": "agency_timezone", "description": "Fuso hor\u00e1rio onde a ag\u00eancia de transporte p\u00fablico est\u00e1 localizada", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agency_lang": {"name": "agency_lang", "description": "Idioma principal usado por esta ag\u00eancia de transporte p\u00fablico.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["agency_id", "feed_start_date"], "alias": "agency"}, "created_at": 1727709588.6849327, "relation_name": "`rj-smtr`.`gtfs`.`agency`", "raw_code": "{{ config(\n  partition_by = { 'field' :'feed_start_date',\n  'data_type' :'date',\n  'granularity': 'day' },\n  unique_key = ['agency_id', 'feed_start_date'],\n  alias = 'agency'\n) }}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(a.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(a.agency_id AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_name') AS STRING) agency_name,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_url') AS STRING) agency_url,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_timezone') AS STRING) agency_timezone,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_lang') AS STRING) agency_lang,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{ source('br_rj_riodejaneiro_gtfs_staging', 'agency') }} a\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  a.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    a.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "agency"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/agency_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(a.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(a.agency_id AS STRING) agency_id,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_name') AS STRING) agency_name,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_url') AS STRING) agency_url,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_timezone') AS STRING) agency_timezone,\n  SAFE_CAST(JSON_VALUE(a.content, '$.agency_lang') AS STRING) agency_lang,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`agency` a\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  a.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    a.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_gtfs.sql", "original_file_path": "models/gtfs/ordem_servico_gtfs.sql", "unique_id": "model.rj_smtr.ordem_servico_gtfs", "fqn": ["rj_smtr", "gtfs", "ordem_servico_gtfs"], "alias": "ordem_servico", "checksum": {"name": "sha256", "checksum": "1806aaeb06247f35c782e12cb90d58a45f7e6ab0d6f9d8a233e17458f45c0f78"}, "config": {"enabled": true, "alias": "ordem_servico", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["servico", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Dados das linhas presentes no munic\u00edpio.", "columns": {"servico": {"name": "servico", "description": "N\u00famero da linha de \u00f4nibus.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "vista": {"name": "vista", "description": "Letreiro do \u00f4nibus.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio respons\u00e1vel pela linha.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "horario_inicio": {"name": "horario_inicio", "description": "Hor\u00e1rio inicial de funcionamento.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "horario_fim": {"name": "horario_fim", "description": "Hor\u00e1rio da \u00faltima viagem.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "extensao_ida": {"name": "extensao_ida", "description": "Dist\u00e2ncia percorrida na ida.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "extensao_volta": {"name": "extensao_volta", "description": "Dist\u00e2ncia percorrida na volta.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "partidas_ida": {"name": "partidas_ida", "description": "Quantidade de partidas no sentido ida.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "partidas_volta": {"name": "partidas_volta", "description": "Quantidade de partidas no sentido volta.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_planejadas": {"name": "viagens_planejadas", "description": "Quantidade de viagens realizadas.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "distancia_total_planejada": {"name": "distancia_total_planejada", "description": "Dist\u00e2ncia total planejada di\u00e1ria para o servi\u00e7o. ", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Tipo de dia, se dia \u00fatil, s\u00e1bado, domingo ou ponto facultativo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_os": {"name": "tipo_os", "description": "Tipo de Ordem de Servi\u00e7o (ex: 'Regular', 'Extraordin\u00e1ria - Ver\u00e3o')", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["servico", "feed_start_date"], "alias": "ordem_servico"}, "created_at": 1727709588.720957, "relation_name": "`rj-smtr`.`gtfs`.`ordem_servico`", "raw_code": "{{ config(\n  partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n  unique_key = ['servico', 'feed_start_date'],\n  alias = 'ordem_servico'\n) }}\n\nWITH ordem_servico AS (\n  SELECT\n    fi.feed_version,\n    SAFE_CAST(os.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(tipo_os AS STRING) tipo_os,\n    SAFE_CAST(os.servico AS STRING) servico,\n    SAFE_CAST(JSON_VALUE(os.content, '$.vista') AS STRING) vista,\n    SAFE_CAST(JSON_VALUE(os.content, '$.consorcio') AS STRING) consorcio,\n    SAFE_CAST(JSON_VALUE(os.content, '$.horario_inicio') AS STRING) horario_inicio,\n    SAFE_CAST(JSON_VALUE(os.content, '$.horario_fim') AS STRING) horario_fim,\n    SAFE_CAST(JSON_VALUE(os.content, '$.extensao_ida') AS FLOAT64) extensao_ida,\n    SAFE_CAST(JSON_VALUE(os.content, '$.extensao_volta') AS FLOAT64) extensao_volta,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_du') AS FLOAT64) AS INT64) partidas_ida_du,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_du') AS FLOAT64) AS INT64) partidas_volta_du,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_du') AS FLOAT64) viagens_du,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_dia_util') AS FLOAT64) km_du,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_pf') AS FLOAT64) AS INT64) partidas_ida_pf,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_pf') AS FLOAT64) AS INT64) partidas_volta_pf,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_pf') AS FLOAT64) viagens_pf,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_pf') AS FLOAT64) km_pf,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_sabado') AS FLOAT64) AS INT64) partidas_ida_sabado,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_sabado') AS FLOAT64) AS INT64) partidas_volta_sabado,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_sabado') AS FLOAT64) viagens_sabado,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_sabado') AS FLOAT64) km_sabado,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_domingo') AS FLOAT64) AS INT64) partidas_ida_domingo,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_domingo') AS FLOAT64) AS INT64) partidas_volta_domingo,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_domingo') AS FLOAT64) viagens_domingo,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_domingo') AS FLOAT64) km_domingo,\n  FROM\n    {{ source(\n      'br_rj_riodejaneiro_gtfs_staging',\n      'ordem_servico'\n    ) }} os\n  JOIN\n    {{ ref('feed_info_gtfs') }} fi\n  ON\n    os.data_versao = CAST(fi.feed_start_date AS STRING)\n  {% if is_incremental() -%}\n    WHERE\n      os.data_versao = '{{ var(\"data_versao_gtfs\") }}'\n      AND fi.feed_start_date = '{{ var(\"data_versao_gtfs\") }}'\n  {%- endif %}\n)\nSELECT *,\n  '{{ var(\"version\") }}' as versao_modelo\nFROM ordem_servico UNPIVOT (\n    (\n      partidas_ida,\n      partidas_volta,\n      viagens_planejadas,\n      distancia_total_planejada\n    ) FOR tipo_dia IN (\n      (\n        partidas_ida_du,\n        partidas_volta_du,\n        viagens_du,\n        km_du\n      ) AS 'Dia \u00datil',\n      (\n        partidas_ida_pf,\n        partidas_volta_pf,\n        viagens_pf,\n        km_pf\n      ) AS 'Ponto Facultativo',\n      (\n        partidas_ida_sabado,\n        partidas_volta_sabado,\n        viagens_sabado,\n        km_sabado\n      ) AS 'Sabado',\n      (\n        partidas_ida_domingo,\n        partidas_volta_domingo,\n        viagens_domingo,\n        km_domingo\n      ) AS 'Domingo'\n    )\n  )", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "ordem_servico"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH ordem_servico AS (\n  SELECT\n    fi.feed_version,\n    SAFE_CAST(os.data_versao AS DATE) as feed_start_date,\n    fi.feed_end_date,\n    SAFE_CAST(tipo_os AS STRING) tipo_os,\n    SAFE_CAST(os.servico AS STRING) servico,\n    SAFE_CAST(JSON_VALUE(os.content, '$.vista') AS STRING) vista,\n    SAFE_CAST(JSON_VALUE(os.content, '$.consorcio') AS STRING) consorcio,\n    SAFE_CAST(JSON_VALUE(os.content, '$.horario_inicio') AS STRING) horario_inicio,\n    SAFE_CAST(JSON_VALUE(os.content, '$.horario_fim') AS STRING) horario_fim,\n    SAFE_CAST(JSON_VALUE(os.content, '$.extensao_ida') AS FLOAT64) extensao_ida,\n    SAFE_CAST(JSON_VALUE(os.content, '$.extensao_volta') AS FLOAT64) extensao_volta,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_du') AS FLOAT64) AS INT64) partidas_ida_du,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_du') AS FLOAT64) AS INT64) partidas_volta_du,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_du') AS FLOAT64) viagens_du,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_dia_util') AS FLOAT64) km_du,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_pf') AS FLOAT64) AS INT64) partidas_ida_pf,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_pf') AS FLOAT64) AS INT64) partidas_volta_pf,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_pf') AS FLOAT64) viagens_pf,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_pf') AS FLOAT64) km_pf,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_sabado') AS FLOAT64) AS INT64) partidas_ida_sabado,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_sabado') AS FLOAT64) AS INT64) partidas_volta_sabado,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_sabado') AS FLOAT64) viagens_sabado,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_sabado') AS FLOAT64) km_sabado,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_ida_domingo') AS FLOAT64) AS INT64) partidas_ida_domingo,\n    SAFE_CAST(SAFE_CAST(JSON_VALUE(os.content, '$.partidas_volta_domingo') AS FLOAT64) AS INT64) partidas_volta_domingo,\n    SAFE_CAST(JSON_VALUE(os.content, '$.viagens_domingo') AS FLOAT64) viagens_domingo,\n    SAFE_CAST(JSON_VALUE(os.content, '$.km_domingo') AS FLOAT64) km_domingo,\n  FROM\n    `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico` os\n  JOIN\n    `rj-smtr`.`gtfs`.`feed_info` fi\n  ON\n    os.data_versao = CAST(fi.feed_start_date AS STRING)\n  WHERE\n      os.data_versao = '2024-05-03'\n      AND fi.feed_start_date = '2024-05-03'\n)\nSELECT *,\n  '' as versao_modelo\nFROM ordem_servico UNPIVOT (\n    (\n      partidas_ida,\n      partidas_volta,\n      viagens_planejadas,\n      distancia_total_planejada\n    ) FOR tipo_dia IN (\n      (\n        partidas_ida_du,\n        partidas_volta_du,\n        viagens_du,\n        km_du\n      ) AS 'Dia \u00datil',\n      (\n        partidas_ida_pf,\n        partidas_volta_pf,\n        viagens_pf,\n        km_pf\n      ) AS 'Ponto Facultativo',\n      (\n        partidas_ida_sabado,\n        partidas_volta_sabado,\n        viagens_sabado,\n        km_sabado\n      ) AS 'Sabado',\n      (\n        partidas_ida_domingo,\n        partidas_volta_domingo,\n        viagens_domingo,\n        km_domingo\n      ) AS 'Domingo'\n    )\n  )", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.calendar_dates_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "calendar_dates_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/calendar_dates_gtfs.sql", "original_file_path": "models/gtfs/calendar_dates_gtfs.sql", "unique_id": "model.rj_smtr.calendar_dates_gtfs", "fqn": ["rj_smtr", "gtfs", "calendar_dates_gtfs"], "alias": "calendar_dates", "checksum": {"name": "sha256", "checksum": "4dfaef7047a549bc15f1b672f3866def962bf2ff99255ec0e96fcc4a0beca8ef"}, "config": {"enabled": true, "alias": "calendar_dates", "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["service_id", "date", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": [], "description": "Exce\u00e7\u00f5es para os servi\u00e7os definidos no calendar.txt.", "columns": {"service_id": {"name": "service_id", "description": "Identifica um conjunto de datas quando ocorre uma exce\u00e7\u00e3o de servi\u00e7o para uma ou mais rotas", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "date": {"name": "date", "description": "Data em que ocorre a exce\u00e7\u00e3o de servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "exception_type": {"name": "exception_type", "description": "Indica se o servi\u00e7o est\u00e1 dispon\u00edvel na data especificada no campo de data.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados gtfs.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["service_id", "date", "feed_start_date"], "alias": "calendar_dates"}, "created_at": 1727709588.6901903, "relation_name": "`rj-smtr`.`gtfs`.`calendar_dates`", "raw_code": "{{ config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['service_id', 'date', 'feed_start_date'],\n    alias = 'calendar_dates'\n) }}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(cd.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(cd.service_id AS STRING) service_id,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(cd.DATE AS STRING)) DATE,\n  SAFE_CAST(JSON_VALUE(cd.content, '$.exception_type') AS STRING) exception_type,\n  '{{ var(\"version\") }}' AS versao_modelo\nFROM\n  {{ source(\n    'br_rj_riodejaneiro_gtfs_staging',\n    'calendar_dates'\n  ) }} cd\nJOIN\n  {{ ref('feed_info_gtfs') }} fi\nON\n  cd.data_versao = CAST(fi.feed_start_date AS STRING)\n{% if is_incremental() -%}\n  WHERE\n    cd.data_versao IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    AND fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [["br_rj_riodejaneiro_gtfs_staging", "calendar_dates"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/calendar_dates_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\n\nSELECT\n  fi.feed_version,\n  SAFE_CAST(cd.data_versao AS DATE) feed_start_date,\n  fi.feed_end_date,\n  SAFE_CAST(cd.service_id AS STRING) service_id,\n  PARSE_DATE('%Y%m%d', SAFE_CAST(cd.DATE AS STRING)) DATE,\n  SAFE_CAST(JSON_VALUE(cd.content, '$.exception_type') AS STRING) exception_type,\n  '' AS versao_modelo\nFROM\n  `rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`calendar_dates` cd\nJOIN\n  `rj-smtr`.`gtfs`.`feed_info` fi\nON\n  cd.data_versao = CAST(fi.feed_start_date AS STRING)\nWHERE\n    cd.data_versao IN ('2024-04-15', '2024-05-03')\n    AND fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.ordem_servico_viagens_planejadas": {"database": "rj-smtr", "schema": "gtfs", "name": "ordem_servico_viagens_planejadas", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/ordem_servico_viagens_planejadas.sql", "original_file_path": "models/gtfs/ordem_servico_viagens_planejadas.sql", "unique_id": "model.rj_smtr.ordem_servico_viagens_planejadas", "fqn": ["rj_smtr", "gtfs", "ordem_servico_viagens_planejadas"], "alias": "ordem_servico_viagens_planejadas", "checksum": {"name": "sha256", "checksum": "cfff9dbae0b4431a465ecb6561985fe4037149ee6debb01e14976289ba939aed"}, "config": {"enabled": true, "alias": null, "schema": "gtfs", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Viagens planejadas das linhas presentes no munic\u00edpio.", "columns": {"data": {"name": "data", "description": "Data da ordem de servi\u00e7o.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tipo_dia": {"name": "tipo_dia", "description": "Dia da semana - categorias: Dia \u00datil, S\u00e1bado, Domingo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o realizado pelo ve\u00edculo.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "viagens_planejadas": {"name": "viagens_planejadas", "description": "Viagens planejadas no per\u00edodo", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "incremental_strategy": "insert_overwrite", "schema": "gtfs"}, "created_at": 1727709588.718156, "relation_name": "`rj-smtr`.`gtfs`.`ordem_servico_viagens_planejadas`", "raw_code": "{{ config(\n  materialized=\"view\"\n) }}\n\nWITH\n  data_versao AS (\n  SELECT\n    feed_start_date,\n    feed_start_date AS data_inicio,\n    COALESCE(DATE_SUB(LEAD(feed_start_date) OVER (ORDER BY feed_start_date), INTERVAL 1 DAY), LAST_DAY(feed_start_date, MONTH)) AS data_fim\n  FROM (\n    SELECT\n      DISTINCT feed_start_date,\n    FROM\n      {{ ref(\"ordem_servico_gtfs\") }} )),\n  subsidio_data_versao_efetiva AS (\n  SELECT\n    * EXCEPT(tipo_dia),\n    SPLIT(tipo_dia, \" - \")[0] AS tipo_dia\n  FROM\n    {{ ref(\"subsidio_data_versao_efetiva\") }} )\nSELECT\n  data,\n  sd.tipo_dia,\n  servico,\n  viagens_planejadas\nFROM\n  UNNEST(GENERATE_DATE_ARRAY((SELECT MIN(data_inicio) FROM data_versao), (SELECT MAX(data_fim) FROM data_versao))) AS data\nLEFT JOIN\n  data_versao AS d\nON\n  data BETWEEN d.data_inicio\n  AND d.data_fim\nLEFT JOIN\n  subsidio_data_versao_efetiva AS sd\nON\n  data = sd.data\n  AND (d.feed_start_date = sd.feed_start_date\n      OR sd.feed_start_date IS NULL)\nLEFT JOIN\n  {{ ref(\"ordem_servico_gtfs\") }} AS o\nON\n  d.feed_start_date = o.feed_start_date\n  AND sd.tipo_dia = o.tipo_dia", "language": "sql", "refs": [{"name": "ordem_servico_gtfs", "package": null, "version": null}, {"name": "subsidio_data_versao_efetiva", "package": null, "version": null}, {"name": "ordem_servico_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/ordem_servico_viagens_planejadas.sql", "compiled": true, "compiled_code": "\n\nWITH\n  data_versao AS (\n  SELECT\n    feed_start_date,\n    feed_start_date AS data_inicio,\n    COALESCE(DATE_SUB(LEAD(feed_start_date) OVER (ORDER BY feed_start_date), INTERVAL 1 DAY), LAST_DAY(feed_start_date, MONTH)) AS data_fim\n  FROM (\n    SELECT\n      DISTINCT feed_start_date,\n    FROM\n      `rj-smtr`.`gtfs`.`ordem_servico` )),\n  subsidio_data_versao_efetiva AS (\n  SELECT\n    * EXCEPT(tipo_dia),\n    SPLIT(tipo_dia, \" - \")[0] AS tipo_dia\n  FROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`subsidio_data_versao_efetiva` )\nSELECT\n  data,\n  sd.tipo_dia,\n  servico,\n  viagens_planejadas\nFROM\n  UNNEST(GENERATE_DATE_ARRAY((SELECT MIN(data_inicio) FROM data_versao), (SELECT MAX(data_fim) FROM data_versao))) AS data\nLEFT JOIN\n  data_versao AS d\nON\n  data BETWEEN d.data_inicio\n  AND d.data_fim\nLEFT JOIN\n  subsidio_data_versao_efetiva AS sd\nON\n  data = sd.data\n  AND (d.feed_start_date = sd.feed_start_date\n      OR sd.feed_start_date IS NULL)\nLEFT JOIN\n  `rj-smtr`.`gtfs`.`ordem_servico` AS o\nON\n  d.feed_start_date = o.feed_start_date\n  AND sd.tipo_dia = o.tipo_dia", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.shapes_geom_gtfs": {"database": "rj-smtr", "schema": "gtfs", "name": "shapes_geom_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "gtfs/shapes_geom_gtfs.sql", "original_file_path": "models/gtfs/shapes_geom_gtfs.sql", "unique_id": "model.rj_smtr.shapes_geom_gtfs", "fqn": ["rj_smtr", "gtfs", "shapes_geom_gtfs"], "alias": "shapes_geom", "checksum": {"name": "sha256", "checksum": "a1e7780750308fbc17fcb9accdfa7014a56dcbc1ca1a0f599b369b548092c7cc"}, "config": {"enabled": true, "alias": "shapes_geom", "schema": "gtfs", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": ["shape_id", "feed_start_date"], "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}}, "tags": ["geolocalizacao"], "description": "Shapes em formatos geogr\u00e1ficos dos servi\u00e7os.", "columns": {"feed_start_date": {"name": "feed_start_date", "description": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_end_date": {"name": "feed_end_date", "description": "Data final do feed (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_version": {"name": "feed_version", "description": "String que indica a vers\u00e3o atual do conjunto de dados GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_id": {"name": "shape_id", "description": "Identificador de shape.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape": {"name": "shape", "description": "Shape em formato geogr\u00e1fico (usualmente LineString).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "shape_distance": {"name": "shape_distance", "description": "Extens\u00e3o do shape.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "start_pt": {"name": "start_pt", "description": "Ponto inicial do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "end_pt": {"name": "end_pt", "description": "Ponto final do shape em formato geogr\u00e1fico (Point).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_versao": {"name": "data_versao", "description": "Data de refer\u00eancia do planejamento (vers\u00e3o).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao_modelo": {"name": "versao_modelo", "description": "C\u00f3digo de controle de vers\u00e3o (SHA do GitHub).", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/gtfs/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "incremental", "incremental_strategy": "insert_overwrite", "schema": "gtfs", "partition_by": {"field": "feed_start_date", "data_type": "date", "granularity": "day"}, "unique_key": ["shape_id", "feed_start_date"], "alias": "shapes_geom", "tags": ["geolocalizacao"]}, "created_at": 1727709588.7049403, "relation_name": "`rj-smtr`.`gtfs`.`shapes_geom`", "raw_code": "{{ config(\n    partition_by = { 'field' :'feed_start_date',\n    'data_type' :'date',\n    'granularity': 'day' },\n    unique_key = ['shape_id', 'feed_start_date'],\n    alias = 'shapes_geom',\n    tags=['geolocalizacao']\n) }}\n\n{% if execute and is_incremental() %}\n  {% set last_feed_version = get_last_feed_start_date(var(\"data_versao_gtfs\")) %}\n{% endif %}\n\nWITH contents AS (\n    SELECT\n        shape_id,\n        ST_GEOGPOINT(shape_pt_lon, shape_pt_lat) AS ponto_shape,\n        shape_pt_sequence,\n        feed_start_date,\n    FROM {{ref('shapes_gtfs')}} s\n    {% if is_incremental() -%}\n        WHERE feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n    {%- endif %}\n),\npts AS (\n    SELECT *,\n        MAX(shape_pt_sequence) OVER(PARTITION BY feed_start_date, shape_id) final_pt_sequence\n    FROM contents c\n    ORDER BY feed_start_date,\n        shape_id,\n        shape_pt_sequence\n),\nshapes AS (\n    -- BUILD LINESTRINGS OVER SHAPE POINTS\n    SELECT\n        shape_id,\n        feed_start_date,\n        ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n        ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n        ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n    FROM pts\n    GROUP BY 1,\n            2\n),\nshapes_half AS (\n    -- BUILD HALF LINESTRINGS OVER SHAPE POINTS\n    (\n        SELECT\n            shape_id,\n            feed_start_date,\n            shape_id || \"_0\" AS new_shape_id,\n            ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n            ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n            ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n        FROM\n            pts\n        WHERE\n            shape_pt_sequence <= ROUND(final_pt_sequence / 2)\n        GROUP BY\n            1,\n            2\n    )\n    UNION ALL\n    (\n        SELECT\n            shape_id,\n            feed_start_date,\n            shape_id || \"_1\" AS new_shape_id,\n            ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n            ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n            ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n        FROM\n            pts\n        WHERE\n            shape_pt_sequence > ROUND(final_pt_sequence / 2)\n        GROUP BY\n            1,\n            2\n    )\n),\nids AS (\n    SELECT\n      * EXCEPT(rn)\n    FROM\n    (\n        SELECT\n            feed_start_date,\n            shape_id,\n            shape,\n            start_pt,\n            end_pt,\n            ROW_NUMBER() OVER(PARTITION BY feed_start_date, shape_id) rn\n        FROM\n            shapes\n    )\n    WHERE rn = 1\n),\nunion_shapes AS (\n  (\n    SELECT\n        feed_start_date,\n        shape_id,\n        shape,\n        start_pt,\n        end_pt,\n    FROM\n        ids\n  )\n  UNION ALL\n  (\n    SELECT\n        feed_start_date,\n        new_shape_id AS shape_id,\n        s.shape,\n        s.start_pt,\n        s.end_pt,\n    FROM\n        ids AS i\n    LEFT JOIN\n        shapes_half AS s\n    USING\n        (feed_start_date, shape_id)\n    WHERE\n        ROUND(ST_Y(i.start_pt),4) = ROUND(ST_Y(i.end_pt),4)\n        AND ROUND(ST_X(i.start_pt),4) = ROUND(ST_X(i.end_pt),4)\n  )\n)\nSELECT\n    feed_version,\n    feed_start_date,\n    feed_end_date,\n    shape_id,\n    shape,\n    ROUND(ST_LENGTH(shape), 1) shape_distance,\n    start_pt,\n    end_pt,\n    '{{ var(\"version\") }}' as versao_modelo\nFROM union_shapes AS m\nLEFT JOIN\n    {{ ref('feed_info_gtfs') }} AS fi\nUSING\n    (feed_start_date)\n{% if is_incremental() -%}\nWHERE\n    fi.feed_start_date IN ('{{ last_feed_version }}', '{{ var(\"data_versao_gtfs\") }}')\n{%- endif %}", "language": "sql", "refs": [{"name": "shapes_gtfs", "package": null, "version": null}, {"name": "feed_info_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental", "macro.rj_smtr.get_last_feed_start_date"], "nodes": ["model.rj_smtr.shapes_gtfs", "model.rj_smtr.feed_info_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/gtfs/shapes_geom_gtfs.sql", "compiled": true, "compiled_code": "\n\n\n  \n\n\nWITH contents AS (\n    SELECT\n        shape_id,\n        ST_GEOGPOINT(shape_pt_lon, shape_pt_lat) AS ponto_shape,\n        shape_pt_sequence,\n        feed_start_date,\n    FROM `rj-smtr`.`gtfs`.`shapes` s\n    WHERE feed_start_date IN ('2024-04-15', '2024-05-03')\n),\npts AS (\n    SELECT *,\n        MAX(shape_pt_sequence) OVER(PARTITION BY feed_start_date, shape_id) final_pt_sequence\n    FROM contents c\n    ORDER BY feed_start_date,\n        shape_id,\n        shape_pt_sequence\n),\nshapes AS (\n    -- BUILD LINESTRINGS OVER SHAPE POINTS\n    SELECT\n        shape_id,\n        feed_start_date,\n        ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n        ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n        ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n    FROM pts\n    GROUP BY 1,\n            2\n),\nshapes_half AS (\n    -- BUILD HALF LINESTRINGS OVER SHAPE POINTS\n    (\n        SELECT\n            shape_id,\n            feed_start_date,\n            shape_id || \"_0\" AS new_shape_id,\n            ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n            ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n            ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n        FROM\n            pts\n        WHERE\n            shape_pt_sequence <= ROUND(final_pt_sequence / 2)\n        GROUP BY\n            1,\n            2\n    )\n    UNION ALL\n    (\n        SELECT\n            shape_id,\n            feed_start_date,\n            shape_id || \"_1\" AS new_shape_id,\n            ST_MAKELINE(ARRAY_AGG(ponto_shape)) AS shape,\n            ARRAY_AGG(ponto_shape)[ORDINAL(1)] AS start_pt,\n            ARRAY_AGG(ponto_shape)[ORDINAL(ARRAY_LENGTH(ARRAY_AGG(ponto_shape)))] AS end_pt,\n        FROM\n            pts\n        WHERE\n            shape_pt_sequence > ROUND(final_pt_sequence / 2)\n        GROUP BY\n            1,\n            2\n    )\n),\nids AS (\n    SELECT\n      * EXCEPT(rn)\n    FROM\n    (\n        SELECT\n            feed_start_date,\n            shape_id,\n            shape,\n            start_pt,\n            end_pt,\n            ROW_NUMBER() OVER(PARTITION BY feed_start_date, shape_id) rn\n        FROM\n            shapes\n    )\n    WHERE rn = 1\n),\nunion_shapes AS (\n  (\n    SELECT\n        feed_start_date,\n        shape_id,\n        shape,\n        start_pt,\n        end_pt,\n    FROM\n        ids\n  )\n  UNION ALL\n  (\n    SELECT\n        feed_start_date,\n        new_shape_id AS shape_id,\n        s.shape,\n        s.start_pt,\n        s.end_pt,\n    FROM\n        ids AS i\n    LEFT JOIN\n        shapes_half AS s\n    USING\n        (feed_start_date, shape_id)\n    WHERE\n        ROUND(ST_Y(i.start_pt),4) = ROUND(ST_Y(i.end_pt),4)\n        AND ROUND(ST_X(i.start_pt),4) = ROUND(ST_X(i.end_pt),4)\n  )\n)\nSELECT\n    feed_version,\n    feed_start_date,\n    feed_end_date,\n    shape_id,\n    shape,\n    ROUND(ST_LENGTH(shape), 1) shape_distance,\n    start_pt,\n    end_pt,\n    '' as versao_modelo\nFROM union_shapes AS m\nLEFT JOIN\n    `rj-smtr`.`gtfs`.`feed_info` AS fi\nUSING\n    (feed_start_date)\nWHERE\n    fi.feed_start_date IN ('2024-04-15', '2024-05-03')", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.servico_operadora": {"database": "rj-smtr", "schema": "cadastro", "name": "servico_operadora", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/servico_operadora.sql", "original_file_path": "models/cadastro/servico_operadora.sql", "unique_id": "model.rj_smtr.servico_operadora", "fqn": ["rj_smtr", "cadastro", "servico_operadora"], "alias": "servico_operadora", "checksum": {"name": "sha256", "checksum": "cdc02a9fc979950264fb0292136f65b7963104a6eb6f17356503583e6ae7d1ed"}, "config": {"enabled": true, "alias": null, "schema": "cadastro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com a rela\u00e7\u00e3o entre servi\u00e7o, consorcio e operadora de transporte de acordo com a base da Ja\u00e9", "columns": {"id_consorcio": {"name": "id_consorcio", "description": "Identificador \u00fanico do cons\u00f3rcio, podendo ser o c\u00f3digo de permission\u00e1rio ou c\u00f3digo da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora": {"name": "id_operadora", "description": "Identificador \u00fanico do operador, podendo ser o c\u00f3digo de permission\u00e1rio ou c\u00f3digo da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome do operador (mascarado quando o operador \u00e9 pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome do servi\u00e7o consolidado. Para linhas, \u00e9 o nome curto da linha (ex: 010, 011SN). E para esta\u00e7\u00f5es, \u00e9 o stop_code do GTFS ou o c\u00f3digo interno da esta\u00e7\u00e3o no banco de dados da Ja\u00e9. (Caso o registro n\u00e3o exista no GTFS, busca o servi\u00e7o na base de dados da Ja\u00e9)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador \u00fanico do servi\u00e7o no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico": {"name": "descricao_servico", "description": "Nome completo do servi\u00e7o consolidado. Para linhas \u00e9, primariamente o route_long_name da tabela routes do GTFS. Para esta\u00e7\u00f5es \u00e9 primariamente a coluna stop_name da tabela stops do GTFS. (Caso o registro n\u00e3o exista no GTFS, busca o nome do servi\u00e7o na base de dados da Ja\u00e9)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio_validade": {"name": "data_inicio_validade", "description": "Data de inicio da validade do registro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_fim_validade": {"name": "data_fim_validade", "description": "Data de fim da validade do registro", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/cadastro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro", "materialized": "table"}, "created_at": 1727709588.738361, "relation_name": "`rj-smtr`.`cadastro`.`servico_operadora`", "raw_code": "{{\n  config(\n    materialized=\"table\"\n  )\n}}\n\nSELECT\n  c.id_consorcio,\n  c.consorcio,\n  o.id_operadora,\n  o.operadora,\n  lco.cd_linha AS id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  lco.dt_inicio_validade AS data_inicio_validade,\n  lco.dt_fim_validade AS data_fim_validade,\n  '{{ var(\"version\") }}' as versao\nFROM\n  {{ ref(\"staging_linha_consorcio_operadora_transporte\") }} lco\nJOIN\n  {{ ref(\"operadoras\") }} o\nON\n  lco.cd_operadora_transporte = o.id_operadora_jae\nJOIN\n  {{ ref(\"consorcios\") }} c\nON\n  lco.cd_consorcio = c.id_consorcio_jae\nJOIN\n  {{ ref(\"servicos\") }} s\nON\n  lco.cd_linha = s.id_servico_jae", "language": "sql", "refs": [{"name": "staging_linha_consorcio_operadora_transporte", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}, {"name": "consorcios", "package": null, "version": null}, {"name": "servicos", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_linha_consorcio_operadora_transporte", "model.rj_smtr.operadoras", "model.rj_smtr.consorcios", "model.rj_smtr.servicos"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/servico_operadora.sql", "compiled": true, "compiled_code": "\n\nSELECT\n  c.id_consorcio,\n  c.consorcio,\n  o.id_operadora,\n  o.operadora,\n  lco.cd_linha AS id_servico_jae,\n  s.servico,\n  s.descricao_servico,\n  lco.dt_inicio_validade AS data_inicio_validade,\n  lco.dt_fim_validade AS data_fim_validade,\n  '' as versao\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio_operadora_transporte` lco\nJOIN\n  `rj-smtr`.`cadastro`.`operadoras` o\nON\n  lco.cd_operadora_transporte = o.id_operadora_jae\nJOIN\n  `rj-smtr`.`cadastro`.`consorcios` c\nON\n  lco.cd_consorcio = c.id_consorcio_jae\nJOIN\n  `rj-smtr`.`cadastro`.`servicos` s\nON\n  lco.cd_linha = s.id_servico_jae", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.servicos": {"database": "rj-smtr", "schema": "cadastro", "name": "servicos", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/servicos.sql", "original_file_path": "models/cadastro/servicos.sql", "unique_id": "model.rj_smtr.servicos", "fqn": ["rj_smtr", "cadastro", "servicos"], "alias": "servicos", "checksum": {"name": "sha256", "checksum": "cf6798668a7039d896fb6aa7a6a1740e37386871b91c404ddcc643612eff2c5a"}, "config": {"enabled": true, "alias": null, "schema": "cadastro", "database": null, "tags": ["geolocalizacao"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": ["geolocalizacao"], "description": "Tabela com dados unificados de servi\u00e7os (linhas e esta\u00e7\u00f5es)", "columns": {"id_servico_gtfs": {"name": "id_servico_gtfs", "description": "Identificador \u00fanico do servi\u00e7o no GTFS, podendo ser o stop_id (no caso de esta\u00e7\u00f5es) ou o route_id (no caso de linhas)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_servico_jae": {"name": "id_servico_jae", "description": "Identificador \u00fanico do servi\u00e7o no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Nome do servi\u00e7o consolidado. Para linhas, \u00e9 o nome curto da linha (ex: 010, 011SN). E para esta\u00e7\u00f5es, \u00e9 o stop_code do GTFS ou o c\u00f3digo interno da esta\u00e7\u00e3o no banco de dados da Ja\u00e9. (Caso o registro n\u00e3o exista no GTFS, busca o servi\u00e7o na base de dados da Ja\u00e9)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_gtfs": {"name": "servico_gtfs", "description": "Nome do servi\u00e7o consolidado. Para linhas, \u00e9 a coluna route_short_name da tabela routes do GTFS, que cont\u00e9m o nome curto da linha (ex: 010, 011SN). Para esta\u00e7\u00f5es, \u00e9 a coluna stop_code da tabela stops do GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico_jae": {"name": "servico_jae", "description": "Nome do servi\u00e7o consolidado. C\u00f3digo interno do cadastro de linhas e esta\u00e7\u00f5es do banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico": {"name": "descricao_servico", "description": "Nome completo do servi\u00e7o consolidado. Para linhas \u00e9, primariamente o route_long_name da tabela routes do GTFS. Para esta\u00e7\u00f5es \u00e9 primariamente a coluna stop_name da tabela stops do GTFS. (Caso o registro n\u00e3o exista no GTFS, busca o nome do servi\u00e7o na base de dados da Ja\u00e9)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_gtfs": {"name": "descricao_servico_gtfs", "description": "Nome completo do servi\u00e7o no GTFS. Para linhas \u00e9, primariamente o route_long_name da tabela routes do GTFS. Para esta\u00e7\u00f5es \u00e9 primariamente a coluna stop_name da tabela stops do GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "descricao_servico_jae": {"name": "descricao_servico_jae", "description": "Nome completo do servi\u00e7o no banco de dados da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "latitude": {"name": "latitude", "description": "Latitude da esta\u00e7\u00e3o na tabela stops do GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "longitude": {"name": "longitude", "description": "Longitude da esta\u00e7\u00e3o na tabela stops do GTFS.", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "tabela_origem_gtfs": {"name": "tabela_origem_gtfs", "description": "Tabela do GTFS de onde foram coletadas as informa\u00e7\u00f5es (stops ou routes)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "feed_start_date_gtfs": {"name": "feed_start_date_gtfs", "description": "\u00daltimo feed_start_date do GTFS em que as informa\u00e7\u00f5es do servi\u00e7o estavam dispon\u00edveis", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_inicio_vigencia": {"name": "data_inicio_vigencia", "description": "Data de inicio da vig\u00eancia do servi\u00e7o segundo o GTFS ou o cadastro do servi\u00e7o no sistema da Ja\u00e9 (caso n\u00e3o exista no GTFS)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_fim_vigencia": {"name": "data_fim_vigencia", "description": "Data de fim da vig\u00eancia do servi\u00e7o segundo o GTFS", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "versao": {"name": "versao", "description": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/cadastro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro", "materialized": "table", "tags": ["geolocalizacao"]}, "created_at": 1727709588.7375925, "relation_name": "`rj-smtr`.`cadastro`.`servicos`", "raw_code": "{{\n    config(\n        materialized='table',\n        tags=['geolocalizacao']\n    )\n}}\n\nSELECT\n    g.id_servico AS id_servico_gtfs,\n    j.cd_linha AS id_servico_jae,\n    COALESCE(g.servico, j.nr_linha) AS servico,\n    g.servico AS servico_gtfs,\n    j.nr_linha AS servico_jae,\n    COALESCE(g.descricao_servico, j.nm_linha) AS descricao_servico,\n    g.descricao_servico AS descricao_servico_gtfs,\n    j.nm_linha AS descricao_servico_jae,\n    g.latitude,\n    g.longitude,\n    g.tabela_origem_gtfs,\n    COALESCE(g.inicio_vigencia, DATE(j.datetime_inclusao)) AS data_inicio_vigencia,\n    g.fim_vigencia AS data_fim_vigencia,\n    '{{ var(\"version\") }}' as versao\nFROM\n    {{ ref(\"staging_linha\") }} j\nFULL OUTER JOIN\n    {{ ref(\"aux_servicos_gtfs\") }} g\nON\n    COALESCE(j.gtfs_route_id, j.gtfs_stop_id) = g.id_servico", "language": "sql", "refs": [{"name": "staging_linha", "package": null, "version": null}, {"name": "aux_servicos_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_linha", "model.rj_smtr.aux_servicos_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/servicos.sql", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__aux_routes_vigencia_gtfs as (\n\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`routes`\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n),  __dbt__cte__aux_stops_vigencia_gtfs as (\n\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`stops`\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n),  __dbt__cte__aux_servicos_gtfs as (\n\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_routes_vigencia_gtfs\n\nUNION ALL\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_stops_vigencia_gtfs\n) SELECT\n    g.id_servico AS id_servico_gtfs,\n    j.cd_linha AS id_servico_jae,\n    COALESCE(g.servico, j.nr_linha) AS servico,\n    g.servico AS servico_gtfs,\n    j.nr_linha AS servico_jae,\n    COALESCE(g.descricao_servico, j.nm_linha) AS descricao_servico,\n    g.descricao_servico AS descricao_servico_gtfs,\n    j.nm_linha AS descricao_servico_jae,\n    g.latitude,\n    g.longitude,\n    g.tabela_origem_gtfs,\n    COALESCE(g.inicio_vigencia, DATE(j.datetime_inclusao)) AS data_inicio_vigencia,\n    g.fim_vigencia AS data_fim_vigencia,\n    '' as versao\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha` j\nFULL OUTER JOIN\n    __dbt__cte__aux_servicos_gtfs g\nON\n    COALESCE(j.gtfs_route_id, j.gtfs_stop_id) = g.id_servico", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_routes_vigencia_gtfs", "sql": " __dbt__cte__aux_routes_vigencia_gtfs as (\n\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`routes`\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n)"}, {"id": "model.rj_smtr.aux_stops_vigencia_gtfs", "sql": " __dbt__cte__aux_stops_vigencia_gtfs as (\n\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`stops`\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n)"}, {"id": "model.rj_smtr.aux_servicos_gtfs", "sql": " __dbt__cte__aux_servicos_gtfs as (\n\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_routes_vigencia_gtfs\n\nUNION ALL\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_stops_vigencia_gtfs\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.operadoras_contato": {"database": "rj-smtr", "schema": "cadastro", "name": "operadoras_contato", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/operadoras_contato.sql", "original_file_path": "models/cadastro/operadoras_contato.sql", "unique_id": "model.rj_smtr.operadoras_contato", "fqn": ["rj_smtr", "cadastro", "operadoras_contato"], "alias": "operadoras_contato", "checksum": {"name": "sha256", "checksum": "61a30b1d0ca6f6f4dfe28116e818acb976e3f17702aa6998393545bbd6d455ba"}, "config": {"enabled": true, "alias": null, "schema": "cadastro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela de contatos das operadoras de transporte", "columns": {"id_operadora": {"name": "id_operadora", "description": "Identificador \u00fanico da tabela cadastro.operadoras", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "contato": {"name": "contato", "description": "Nome do contato [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "ramal": {"name": "ramal", "description": "Ramal do telefone [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "telefone": {"name": "telefone", "description": "N\u00famero de telefone [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "email": {"name": "email", "description": "Endere\u00e7o de E-Mail [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/cadastro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro", "materialized": "table"}, "created_at": 1727709588.732581, "relation_name": "`rj-smtr`.`cadastro`.`operadoras_contato`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n  )\n}}\n\n\nSELECT\n  d.id_operadora,\n  cpj.nm_contato AS contato,\n  cpj.nr_ramal AS ramal,\n  COALESCE(cpj.nr_telefone, c.nr_telefone) AS telefone,\n  COALESCE(cpj.tx_email, c.tx_email) AS email\nFROM\n  {{ ref(\"staging_cliente\") }} AS c\nLEFT JOIN\n  {{ ref(\"staging_contato_pessoa_juridica\") }} cpj\nON\n  c.cd_cliente = cpj.cd_cliente\nJOIN\n  {{ ref(\"staging_operadora_transporte\") }} AS ot\nON\n  ot.cd_cliente = c.cd_cliente\nJOIN\n  {{ ref(\"operadoras\") }} d\nON d.id_operadora_jae = ot.cd_operadora_transporte", "language": "sql", "refs": [{"name": "staging_cliente", "package": null, "version": null}, {"name": "staging_contato_pessoa_juridica", "package": null, "version": null}, {"name": "staging_operadora_transporte", "package": null, "version": null}, {"name": "operadoras", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.staging_cliente", "model.rj_smtr.staging_contato_pessoa_juridica", "model.rj_smtr.staging_operadora_transporte", "model.rj_smtr.operadoras"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/operadoras_contato.sql", "compiled": true, "compiled_code": "\n\n\nSELECT\n  d.id_operadora,\n  cpj.nm_contato AS contato,\n  cpj.nr_ramal AS ramal,\n  COALESCE(cpj.nr_telefone, c.nr_telefone) AS telefone,\n  COALESCE(cpj.tx_email, c.tx_email) AS email\nFROM\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`cliente` AS c\nLEFT JOIN\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`contato_pessoa_juridica` cpj\nON\n  c.cd_cliente = cpj.cd_cliente\nJOIN\n  `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`operadora_transporte` AS ot\nON\n  ot.cd_cliente = c.cd_cliente\nJOIN\n  `rj-smtr`.`cadastro`.`operadoras` d\nON d.id_operadora_jae = ot.cd_operadora_transporte", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.operadoras": {"database": "rj-smtr", "schema": "cadastro", "name": "operadoras", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/operadoras.sql", "original_file_path": "models/cadastro/operadoras.sql", "unique_id": "model.rj_smtr.operadoras", "fqn": ["rj_smtr", "cadastro", "operadoras"], "alias": "operadoras", "checksum": {"name": "sha256", "checksum": "2519efc0475a4113a61eb736714384da396f3cae4b068471000b48206410474f"}, "config": {"enabled": true, "alias": null, "schema": "cadastro", "database": null, "tags": ["identificacao"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": ["identificacao"], "description": "Tabela de operadoras de transporte", "columns": {"id_operadora": {"name": "id_operadora", "description": "Identificador \u00fanico do operador, podendo ser o c\u00f3digo de permission\u00e1rio ou c\u00f3digo da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora": {"name": "operadora", "description": "Nome do operador (mascarado quando o operador \u00e9 pessoa f\u00edsica)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "operadora_completo": {"name": "operadora_completo", "description": "Nome do operador [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "tipo_operadora": {"name": "tipo_operadora", "description": "Tipo de permission\u00e1rio (Exemplos: aut\u00f4nomo, empresa, cooperativa)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte do operador, podendo ser o modo na Ja\u00e9 ou no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_stu": {"name": "modo_stu", "description": "Modo de transporte no STU (\u00f4nibus, van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo_jae": {"name": "modo_jae", "description": "Modo de transporte na Ja\u00e9 (\u00f4nibus, van, BRT)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_processo": {"name": "id_processo", "description": "N\u00famero do processo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_processo": {"name": "data_processo", "description": "Data do processo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "documento": {"name": "documento", "description": "Documento do operador (CPF ou CNPJ) [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "tipo_documento": {"name": "tipo_documento", "description": "Tipo do documento do operador (CPF ou CNPJ)", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora_stu": {"name": "id_operadora_stu", "description": "C\u00f3digo de permission\u00e1rio vindo do STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_operadora_jae": {"name": "id_operadora_jae", "description": "C\u00f3digo do operador no sistema da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "indicador_operador_ativo_jae": {"name": "indicador_operador_ativo_jae", "description": "Indicador de atividade do operador no sistema da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "agencia": {"name": "agencia", "description": "N\u00famero da ag\u00eancia banc\u00e1ria do operador [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "tipo_conta": {"name": "tipo_conta", "description": "Tipo da conta banc\u00e1ria do operador [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "banco": {"name": "banco", "description": "Nome do banco [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "codigo_banco": {"name": "codigo_banco", "description": "C\u00f3digo do banco (COMPE) [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}, "conta": {"name": "conta", "description": "N\u00famero da conta banc\u00e1ria do operador [protegido]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "policy_tags": ["projects/rj-smtr/locations/us/taxonomies/388050497607535163/policyTags/3935188996031375059"]}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/cadastro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro", "materialized": "table", "tags": ["identificacao"]}, "created_at": 1727709588.7307298, "relation_name": "`rj-smtr`.`cadastro`.`operadoras`", "raw_code": "{{\n  config(\n    materialized=\"table\",\n    tags=[\"identificacao\"]\n  )\n}}\n\nWITH operadora_jae AS (\n  SELECT\n    ot.cd_operadora_transporte,\n    ot.cd_cliente,\n    m.modo,\n    ot.cd_tipo_modal,\n    ot.ds_tipo_modal AS modo_jae,\n    -- STU considera BRT como \u00d4nibus\n    CASE\n      WHEN ot.cd_tipo_modal = '3' THEN '\u00d4nibus'\n      ELSE m.modo\n    END AS modo_join,\n    ot.in_situacao_atividade,\n    CASE\n      WHEN c.in_tipo_pessoa_fisica_juridica = 'F' THEN 'CPF'\n      WHEN c.in_tipo_pessoa_fisica_juridica = 'J' THEN 'CNPJ'\n    END AS tipo_documento,\n    c.nr_documento,\n    c.nm_cliente,\n    cb.cd_agencia,\n    cb.cd_tipo_conta,\n    cb.nm_banco,\n    cb.nr_banco,\n    cb.nr_conta\n  FROM\n    {{ ref(\"staging_operadora_transporte\") }} AS ot\n  JOIN\n    {{ ref(\"staging_cliente\") }} AS c\n  ON\n    ot.cd_cliente = c.cd_cliente\n  LEFT JOIN\n    {{ ref(\"staging_conta_bancaria\") }} AS cb\n  ON\n    ot.cd_cliente = cb.cd_cliente\n  JOIN\n    {{ source(\"cadastro\", \"modos\") }} m\n  ON\n    ot.cd_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n),\nstu_pessoa_juridica AS (\n  SELECT\n    perm_autor,\n    cnpj AS documento,\n    processo,\n    id_modo,\n    modo AS modo_stu,\n    tipo_permissao,\n    data_registro,\n    razao_social AS nome_operadora,\n    \"CNPJ\" AS tipo_documento\n  FROM\n    {{ ref(\"staging_operadora_empresa\") }}\n  WHERE perm_autor NOT IN ({{ var(\"ids_consorcios\").keys()|reject(\"equalto\", \"'229000010'\")|join(\", \") }})\n),\nstu_pessoa_fisica AS (\n  SELECT\n    perm_autor,\n    cpf AS documento,\n    processo,\n    id_modo,\n    modo AS modo_stu,\n    tipo_permissao,\n    data_registro,\n    nome AS nome_operadora,\n    \"CPF\" AS tipo_documento\n  FROM\n    {{ ref(\"staging_operadora_pessoa_fisica\") }}\n),\nstu AS (\n  SELECT\n    s.*,\n    m.modo\n  FROM (\n    SELECT\n      *\n    FROM\n      stu_pessoa_juridica\n\n    UNION ALL\n\n    SELECT\n      *\n    FROM\n      stu_pessoa_fisica\n  ) s\n  JOIN\n    {{ source(\"cadastro\", \"modos\") }} m\n  ON\n    s.id_modo = m.id_modo AND m.fonte = \"stu\"\n),\ncadastro AS (\n  SELECT\n    COALESCE(s.perm_autor, j.cd_operadora_transporte) AS id_operadora,\n    UPPER(REGEXP_REPLACE(NORMALIZE(COALESCE(s.nome_operadora, j.nm_cliente), NFD), r\"\\pM\", '')) AS operadora_completo,\n    s.tipo_permissao AS tipo_operadora,\n    COALESCE(j.modo, s.modo) AS modo,\n    s.modo_stu,\n    j.modo_jae,\n    s.processo AS id_processo,\n    s.data_registro AS data_processo,\n    COALESCE(s.documento, j.nr_documento) AS documento,\n    COALESCE(s.tipo_documento, j.tipo_documento) AS tipo_documento,\n    s.perm_autor AS id_operadora_stu,\n    j.cd_operadora_transporte AS id_operadora_jae,\n    SAFE_CAST(j.in_situacao_atividade AS BOOLEAN) AS indicador_operador_ativo_jae,\n    j.cd_agencia AS agencia,\n    j.cd_tipo_conta AS tipo_conta,\n    j.nm_banco AS banco,\n    LPAD(j.nr_banco, 3, '0') AS codigo_banco,\n    j.nr_conta AS conta\n  FROM\n    stu AS s\n  FULL OUTER JOIN\n    operadora_jae AS j\n  ON\n    s.documento = j.nr_documento\n    AND s.modo = j.modo_join\n)\nSELECT\n  id_operadora,\n  modo,\n  modo_stu,\n  modo_jae,\n  CASE\n    WHEN tipo_documento = \"CNPJ\" THEN operadora_completo\n    ELSE REGEXP_REPLACE(operadora_completo, '[^ ]', '*')\n  END AS operadora,\n  operadora_completo,\n  tipo_operadora,\n  tipo_documento,\n  documento,\n  codigo_banco,\n  banco,\n  agencia,\n  tipo_conta,\n  conta,\n  id_operadora_stu,\n  id_operadora_jae,\n  id_processo,\n  data_processo,\n  indicador_operador_ativo_jae\nFROM\n  cadastro\nWHERE\n  modo NOT IN (\"Escolar\", \"T\u00e1xi\", \"TEC\")", "language": "sql", "refs": [{"name": "staging_operadora_transporte", "package": null, "version": null}, {"name": "staging_cliente", "package": null, "version": null}, {"name": "staging_conta_bancaria", "package": null, "version": null}, {"name": "staging_operadora_empresa", "package": null, "version": null}, {"name": "staging_operadora_pessoa_fisica", "package": null, "version": null}], "sources": [["cadastro", "modos"], ["cadastro", "modos"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.cadastro.modos", "model.rj_smtr.staging_operadora_transporte", "model.rj_smtr.staging_cliente", "model.rj_smtr.staging_conta_bancaria", "model.rj_smtr.staging_operadora_empresa", "model.rj_smtr.staging_operadora_pessoa_fisica"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/operadoras.sql", "compiled": true, "compiled_code": "\n\nWITH operadora_jae AS (\n  SELECT\n    ot.cd_operadora_transporte,\n    ot.cd_cliente,\n    m.modo,\n    ot.cd_tipo_modal,\n    ot.ds_tipo_modal AS modo_jae,\n    -- STU considera BRT como \u00d4nibus\n    CASE\n      WHEN ot.cd_tipo_modal = '3' THEN '\u00d4nibus'\n      ELSE m.modo\n    END AS modo_join,\n    ot.in_situacao_atividade,\n    CASE\n      WHEN c.in_tipo_pessoa_fisica_juridica = 'F' THEN 'CPF'\n      WHEN c.in_tipo_pessoa_fisica_juridica = 'J' THEN 'CNPJ'\n    END AS tipo_documento,\n    c.nr_documento,\n    c.nm_cliente,\n    cb.cd_agencia,\n    cb.cd_tipo_conta,\n    cb.nm_banco,\n    cb.nr_banco,\n    cb.nr_conta\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`operadora_transporte` AS ot\n  JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`cliente` AS c\n  ON\n    ot.cd_cliente = c.cd_cliente\n  LEFT JOIN\n    `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`conta_bancaria` AS cb\n  ON\n    ot.cd_cliente = cb.cd_cliente\n  JOIN\n    `rj-smtr`.`cadastro`.`modos` m\n  ON\n    ot.cd_tipo_modal = m.id_modo AND m.fonte = \"jae\"\n),\nstu_pessoa_juridica AS (\n  SELECT\n    perm_autor,\n    cnpj AS documento,\n    processo,\n    id_modo,\n    modo AS modo_stu,\n    tipo_permissao,\n    data_registro,\n    razao_social AS nome_operadora,\n    \"CNPJ\" AS tipo_documento\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_stu`.`operadora_empresa`\n  WHERE perm_autor NOT IN ('221000014', '221000023', '221000032', '221000041', '221000050')\n),\nstu_pessoa_fisica AS (\n  SELECT\n    perm_autor,\n    cpf AS documento,\n    processo,\n    id_modo,\n    modo AS modo_stu,\n    tipo_permissao,\n    data_registro,\n    nome AS nome_operadora,\n    \"CPF\" AS tipo_documento\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_stu`.`operadora_pessoa_fisica`\n),\nstu AS (\n  SELECT\n    s.*,\n    m.modo\n  FROM (\n    SELECT\n      *\n    FROM\n      stu_pessoa_juridica\n\n    UNION ALL\n\n    SELECT\n      *\n    FROM\n      stu_pessoa_fisica\n  ) s\n  JOIN\n    `rj-smtr`.`cadastro`.`modos` m\n  ON\n    s.id_modo = m.id_modo AND m.fonte = \"stu\"\n),\ncadastro AS (\n  SELECT\n    COALESCE(s.perm_autor, j.cd_operadora_transporte) AS id_operadora,\n    UPPER(REGEXP_REPLACE(NORMALIZE(COALESCE(s.nome_operadora, j.nm_cliente), NFD), r\"\\pM\", '')) AS operadora_completo,\n    s.tipo_permissao AS tipo_operadora,\n    COALESCE(j.modo, s.modo) AS modo,\n    s.modo_stu,\n    j.modo_jae,\n    s.processo AS id_processo,\n    s.data_registro AS data_processo,\n    COALESCE(s.documento, j.nr_documento) AS documento,\n    COALESCE(s.tipo_documento, j.tipo_documento) AS tipo_documento,\n    s.perm_autor AS id_operadora_stu,\n    j.cd_operadora_transporte AS id_operadora_jae,\n    SAFE_CAST(j.in_situacao_atividade AS BOOLEAN) AS indicador_operador_ativo_jae,\n    j.cd_agencia AS agencia,\n    j.cd_tipo_conta AS tipo_conta,\n    j.nm_banco AS banco,\n    LPAD(j.nr_banco, 3, '0') AS codigo_banco,\n    j.nr_conta AS conta\n  FROM\n    stu AS s\n  FULL OUTER JOIN\n    operadora_jae AS j\n  ON\n    s.documento = j.nr_documento\n    AND s.modo = j.modo_join\n)\nSELECT\n  id_operadora,\n  modo,\n  modo_stu,\n  modo_jae,\n  CASE\n    WHEN tipo_documento = \"CNPJ\" THEN operadora_completo\n    ELSE REGEXP_REPLACE(operadora_completo, '[^ ]', '*')\n  END AS operadora,\n  operadora_completo,\n  tipo_operadora,\n  tipo_documento,\n  documento,\n  codigo_banco,\n  banco,\n  agencia,\n  tipo_conta,\n  conta,\n  id_operadora_stu,\n  id_operadora_jae,\n  id_processo,\n  data_processo,\n  indicador_operador_ativo_jae\nFROM\n  cadastro\nWHERE\n  modo NOT IN (\"Escolar\", \"T\u00e1xi\", \"TEC\")", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.consorcios": {"database": "rj-smtr", "schema": "cadastro", "name": "consorcios", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/consorcios.sql", "original_file_path": "models/cadastro/consorcios.sql", "unique_id": "model.rj_smtr.consorcios", "fqn": ["rj_smtr", "cadastro", "consorcios"], "alias": "consorcios", "checksum": {"name": "sha256", "checksum": "2e66d33b59c043e31760f1d1354c2bd37208844a90ed8e62e0ba544fdcbe3e66"}, "config": {"enabled": true, "alias": null, "schema": "cadastro", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Tabela com dados unificados de consorcios", "columns": {"id_consorcio": {"name": "id_consorcio", "description": "Identificador \u00fanico do cons\u00f3rcio, podendo ser o c\u00f3digo de permission\u00e1rio ou c\u00f3digo da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Nome do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "modo": {"name": "modo", "description": "Modo de transporte do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_processo": {"name": "id_processo", "description": "N\u00famero do processo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "data_processo": {"name": "data_processo", "description": "Data do processo no STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "cnpj": {"name": "cnpj", "description": "CNPJ do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "razao_social": {"name": "razao_social", "description": "Raz\u00e3o social do cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio_stu": {"name": "id_consorcio_stu", "description": "C\u00f3digo de permission\u00e1rio vindo do STU", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "id_consorcio_jae": {"name": "id_consorcio_jae", "description": "C\u00f3digo do cons\u00f3rcio no sistema da Ja\u00e9", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/cadastro/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro", "materialized": "table"}, "created_at": 1727709588.7345972, "relation_name": "`rj-smtr`.`cadastro`.`consorcios`", "raw_code": "{{\n  config(\n    materialized=\"table\"\n  )\n}}\n\nWITH stu AS (\n  SELECT\n      perm_autor AS id_consorcio,\n      cnpj,\n      processo,\n      data_registro,\n      razao_social,\n      CASE\n        {% for id_stu, id_jae in var(\"ids_consorcios\").items() %}\n          WHEN perm_autor = {{ id_stu }} THEN {{ id_jae }}\n        {% endfor %}\n      END AS cd_consorcio_jae\n  FROM\n    {{ ref(\"staging_operadora_empresa\") }} AS stu\n  WHERE\n    perm_autor IN ({{ var(\"ids_consorcios\").keys()|join(\", \") }})\n), consorcio AS (\n  SELECT\n    COALESCE(s.id_consorcio, j.cd_consorcio) AS id_consorcio,\n    CASE\n      WHEN s.id_consorcio = '221000050' THEN \"Cons\u00f3rcio BRT\"\n      ELSE j.nm_consorcio\n    END AS consorcio,\n    s.cnpj,\n    s.razao_social,\n    s.id_consorcio AS id_consorcio_stu,\n    j.cd_consorcio AS id_consorcio_jae,\n    s.processo AS id_processo\n  FROM {{ ref(\"staging_consorcio\") }} AS j\n  FULL OUTER JOIN\n    stu AS s\n  ON\n    j.cd_consorcio = s.cd_consorcio_jae\n)\nSELECT\n  c.id_consorcio,\n  c.consorcio,\n  m.modo,\n  c.cnpj,\n  c.razao_social,\n  c.id_consorcio_stu,\n  c.id_consorcio_jae,\n  c.id_processo\nFROM consorcio c\nLEFT JOIN\n  {{ source(\"cadastro_staging\",\"consorcio_modo\") }} AS cm\nUSING (id_consorcio)\nLEFT JOIN\n  {{ source(\"cadastro\",\"modos\") }} AS m\nON\n  m.id_modo = cm.id_modo\n  AND cm.fonte_id_modo = m.fonte", "language": "sql", "refs": [{"name": "staging_operadora_empresa", "package": null, "version": null}, {"name": "staging_consorcio", "package": null, "version": null}], "sources": [["cadastro_staging", "consorcio_modo"], ["cadastro", "modos"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.rj_smtr.cadastro_staging.consorcio_modo", "source.rj_smtr.cadastro.modos", "model.rj_smtr.staging_operadora_empresa", "model.rj_smtr.staging_consorcio"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/consorcios.sql", "compiled": true, "compiled_code": "\n\nWITH stu AS (\n  SELECT\n      perm_autor AS id_consorcio,\n      cnpj,\n      processo,\n      data_registro,\n      razao_social,\n      CASE\n        \n          WHEN perm_autor = '221000014' THEN '6'\n        \n          WHEN perm_autor = '221000023' THEN '4'\n        \n          WHEN perm_autor = '221000032' THEN '3'\n        \n          WHEN perm_autor = '221000041' THEN '5'\n        \n          WHEN perm_autor = '221000050' THEN NULL\n        \n          WHEN perm_autor = '229000010' THEN '1'\n        \n      END AS cd_consorcio_jae\n  FROM\n    `rj-smtr`.`br_rj_riodejaneiro_stu`.`operadora_empresa` AS stu\n  WHERE\n    perm_autor IN ('221000014', '221000023', '221000032', '221000041', '221000050', '229000010')\n), consorcio AS (\n  SELECT\n    COALESCE(s.id_consorcio, j.cd_consorcio) AS id_consorcio,\n    CASE\n      WHEN s.id_consorcio = '221000050' THEN \"Cons\u00f3rcio BRT\"\n      ELSE j.nm_consorcio\n    END AS consorcio,\n    s.cnpj,\n    s.razao_social,\n    s.id_consorcio AS id_consorcio_stu,\n    j.cd_consorcio AS id_consorcio_jae,\n    s.processo AS id_processo\n  FROM `rj-smtr`.`br_rj_riodejaneiro_bilhetagem_staging`.`consorcio` AS j\n  FULL OUTER JOIN\n    stu AS s\n  ON\n    j.cd_consorcio = s.cd_consorcio_jae\n)\nSELECT\n  c.id_consorcio,\n  c.consorcio,\n  m.modo,\n  c.cnpj,\n  c.razao_social,\n  c.id_consorcio_stu,\n  c.id_consorcio_jae,\n  c.id_processo\nFROM consorcio c\nLEFT JOIN\n  `rj-smtr`.`cadastro_staging`.`consorcio_modo` AS cm\nUSING (id_consorcio)\nLEFT JOIN\n  `rj-smtr`.`cadastro`.`modos` AS m\nON\n  m.id_modo = cm.id_modo\n  AND cm.fonte_id_modo = m.fonte", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_servicos_gtfs": {"database": "rj-smtr", "schema": "cadastro_staging", "name": "aux_servicos_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/staging/aux_servicos_gtfs.sql", "original_file_path": "models/cadastro/staging/aux_servicos_gtfs.sql", "unique_id": "model.rj_smtr.aux_servicos_gtfs", "fqn": ["rj_smtr", "cadastro", "staging", "aux_servicos_gtfs"], "alias": "aux_servicos_gtfs", "checksum": {"name": "sha256", "checksum": "5bab4ed4451af4803246e9db653e62728d5f5d2c3b943458ee6cef1eadb7e581"}, "config": {"enabled": true, "alias": null, "schema": "cadastro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro_staging", "materialized": "ephemeral"}, "created_at": 1727709587.282813, "relation_name": null, "raw_code": "{{\n  config(\n    materialized=\"ephemeral\",\n  )\n}}\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '{{ var(\"version\") }}' as versao\nFROM\n    {{ ref('aux_routes_vigencia_gtfs') }}\n\nUNION ALL\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '{{ var(\"version\") }}' as versao\nFROM\n    {{ ref('aux_stops_vigencia_gtfs') }}", "language": "sql", "refs": [{"name": "aux_routes_vigencia_gtfs", "package": null, "version": null}, {"name": "aux_stops_vigencia_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.aux_routes_vigencia_gtfs", "model.rj_smtr.aux_stops_vigencia_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/staging/aux_servicos_gtfs.sql", "compiled": true, "compiled_code": "\n\nwith __dbt__cte__aux_routes_vigencia_gtfs as (\n\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`routes`\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n),  __dbt__cte__aux_stops_vigencia_gtfs as (\n\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`stops`\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n) SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_routes_vigencia_gtfs\n\nUNION ALL\n\nSELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude,\n    inicio_vigencia,\n    fim_vigencia,\n    tabela_origem_gtfs,\n    '' as versao\nFROM\n    __dbt__cte__aux_stops_vigencia_gtfs", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.rj_smtr.aux_routes_vigencia_gtfs", "sql": " __dbt__cte__aux_routes_vigencia_gtfs as (\n\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`routes`\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n)"}, {"id": "model.rj_smtr.aux_stops_vigencia_gtfs", "sql": " __dbt__cte__aux_stops_vigencia_gtfs as (\n\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`stops`\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)\n)"}], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_routes_vigencia_gtfs": {"database": "rj-smtr", "schema": "cadastro_staging", "name": "aux_routes_vigencia_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/staging/aux_routes_vigencia_gtfs.sql", "original_file_path": "models/cadastro/staging/aux_routes_vigencia_gtfs.sql", "unique_id": "model.rj_smtr.aux_routes_vigencia_gtfs", "fqn": ["rj_smtr", "cadastro", "staging", "aux_routes_vigencia_gtfs"], "alias": "aux_routes_vigencia_gtfs", "checksum": {"name": "sha256", "checksum": "eec9b25befe744ea617e0b1200b95d003118f8b83509ed0da1698ff5b25654e9"}, "config": {"enabled": true, "alias": null, "schema": "cadastro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro_staging", "materialized": "ephemeral"}, "created_at": 1727709587.2880442, "relation_name": null, "raw_code": "{{\n  config(\n    materialized=\"ephemeral\",\n  )\n}}\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    {{ ref(\"routes_gtfs\") }}\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)", "language": "sql", "refs": [{"name": "routes_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.routes_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/staging/aux_routes_vigencia_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH routes_rn AS (\n  SELECT\n    route_id AS id_servico,\n    route_short_name AS servico,\n    route_long_name AS descricao_servico,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY route_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY route_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`routes`\n),\nroutes_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) as fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    routes_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    routes_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  NULL AS latitude,\n  NULL AS longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'routes' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico\n  FROM\n    routes_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "model.rj_smtr.aux_stops_vigencia_gtfs": {"database": "rj-smtr", "schema": "cadastro_staging", "name": "aux_stops_vigencia_gtfs", "resource_type": "model", "package_name": "rj_smtr", "path": "cadastro/staging/aux_stops_vigencia_gtfs.sql", "original_file_path": "models/cadastro/staging/aux_stops_vigencia_gtfs.sql", "unique_id": "model.rj_smtr.aux_stops_vigencia_gtfs", "fqn": ["rj_smtr", "cadastro", "staging", "aux_stops_vigencia_gtfs"], "alias": "aux_stops_vigencia_gtfs", "checksum": {"name": "sha256", "checksum": "60d0565bc8a11162637bc6f7fd7e980b955e96438d34f817ffc660d82f2cd198"}, "config": {"enabled": true, "alias": null, "schema": "cadastro_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "ephemeral", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "schema": "cadastro_staging", "materialized": "ephemeral"}, "created_at": 1727709587.2901752, "relation_name": null, "raw_code": "{{\n  config(\n    materialized=\"ephemeral\",\n  )\n}}\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    {{ ref(\"stops_gtfs\") }}\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)", "language": "sql", "refs": [{"name": "stops_gtfs", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.rj_smtr.stops_gtfs"]}, "compiled_path": "target-base/compiled/rj_smtr/models/cadastro/staging/aux_stops_vigencia_gtfs.sql", "compiled": true, "compiled_code": "\n\nWITH stops_rn AS (\n  SELECT\n    stop_id AS id_servico,\n    stop_code AS servico,\n    stop_name AS descricao_servico,\n    stop_lat AS latitude,\n    stop_lon AS longitude,\n    feed_start_date AS inicio_vigencia,\n    feed_end_date AS fim_vigencia,\n    LAG(feed_end_date) OVER (PARTITION BY stop_id ORDER BY feed_start_date) AS feed_end_date_anterior,\n    ROW_NUMBER() OVER (PARTITION BY stop_id ORDER BY feed_start_date DESC) AS rn\n  FROM\n    `rj-smtr`.`gtfs`.`stops`\n  WHERE\n    location_type = '1'\n),\nstops_agrupada AS (\n  SELECT\n    id_servico,\n    inicio_vigencia,\n    servico,\n    descricao_servico,\n    IFNULL(fim_vigencia, CURRENT_DATE(\"America/Sao_Paulo\")) AS fim_vigencia,\n    SUM(\n      CASE\n        WHEN feed_end_date_anterior IS NULL OR feed_end_date_anterior <> DATE_SUB(inicio_vigencia, INTERVAL 1 DAY) THEN 1\n        ELSE 0\n      END\n    ) OVER (PARTITION BY id_servico ORDER BY inicio_vigencia) AS group_id\n  FROM\n    stops_rn\n),\nvigencia AS (\n  SELECT\n    id_servico,\n    MIN(inicio_vigencia) AS inicio_vigencia,\n    MAX(fim_vigencia) AS fim_vigencia\n  FROM\n    stops_agrupada\n  GROUP BY\n    id_servico,\n    group_id\n)\nSELECT\n  id_servico,\n  r.servico,\n  r.descricao_servico,\n  r.latitude,\n  r.longitude,\n  v.inicio_vigencia,\n  CASE\n    WHEN v.fim_vigencia != CURRENT_DATE(\"America/Sao_Paulo\") THEN v.fim_vigencia\n  END AS fim_vigencia,\n  'stops' AS tabela_origem_gtfs,\nFROM\n vigencia v\nJOIN\n(\n  SELECT\n    id_servico,\n    servico,\n    descricao_servico,\n    latitude,\n    longitude\n  FROM\n    stops_rn\n  WHERE\n    rn = 1\n) r\nUSING(id_servico)", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null}, "test.rj_smtr.unique_my_first_dbt_model_id.16e066b321": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_first_dbt_model')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_my_first_dbt_model_id", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_my_first_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.rj_smtr.unique_my_first_dbt_model_id.16e066b321", "fqn": ["rj_smtr", "example", "unique_my_first_dbt_model_id"], "alias": "unique_my_first_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.7316062, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.my_first_dbt_model"]}, "compiled_path": "target-base/compiled/rj_smtr/models/example/schema.yml/unique_my_first_dbt_model_id.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id as unique_field\n  from `rj-smtr`.`dbt`.`my_first_dbt_model`\n  where id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_first_dbt_model", "attached_node": "model.rj_smtr.my_first_dbt_model"}, "test.rj_smtr.not_null_my_first_dbt_model_id.5fb22c2710": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_first_dbt_model')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_my_first_dbt_model_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_my_first_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.rj_smtr.not_null_my_first_dbt_model_id.5fb22c2710", "fqn": ["rj_smtr", "example", "not_null_my_first_dbt_model_id"], "alias": "not_null_my_first_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.7333214, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.my_first_dbt_model"]}, "compiled_path": "target-base/compiled/rj_smtr/models/example/schema.yml/not_null_my_first_dbt_model_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    id\nFROM\n    `rj-smtr`.`dbt`.`my_first_dbt_model`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`dbt`.`my_first_dbt_model`)\nAND\n    id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_first_dbt_model", "attached_node": "model.rj_smtr.my_first_dbt_model"}, "test.rj_smtr.unique_my_second_dbt_model_id.57a0f8c493": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_second_dbt_model')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_my_second_dbt_model_id", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_my_second_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.rj_smtr.unique_my_second_dbt_model_id.57a0f8c493", "fqn": ["rj_smtr", "example", "unique_my_second_dbt_model_id"], "alias": "unique_my_second_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.7407744, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "my_second_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.my_second_dbt_model"]}, "compiled_path": "target-base/compiled/rj_smtr/models/example/schema.yml/unique_my_second_dbt_model_id.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id as unique_field\n  from `rj-smtr`.`dbt`.`my_second_dbt_model`\n  where id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_second_dbt_model", "attached_node": "model.rj_smtr.my_second_dbt_model"}, "test.rj_smtr.not_null_my_second_dbt_model_id.151b76d778": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_second_dbt_model')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_my_second_dbt_model_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_my_second_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.rj_smtr.not_null_my_second_dbt_model_id.151b76d778", "fqn": ["rj_smtr", "example", "not_null_my_second_dbt_model_id"], "alias": "not_null_my_second_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.7421882, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "my_second_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.my_second_dbt_model"]}, "compiled_path": "target-base/compiled/rj_smtr/models/example/schema.yml/not_null_my_second_dbt_model_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    id\nFROM\n    `rj-smtr`.`dbt`.`my_second_dbt_model`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`dbt`.`my_second_dbt_model`)\nAND\n    id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_second_dbt_model", "attached_node": "model.rj_smtr.my_second_dbt_model"}, "test.rj_smtr.not_null_viagem_planejada_consorcio.3058dfe52a": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "consorcio", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_consorcio", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_consorcio.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_consorcio.3058dfe52a", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_consorcio"], "alias": "not_null_viagem_planejada_consorcio", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9307337, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_consorcio.sql", "compiled": true, "compiled_code": "\nSELECT\n    consorcio\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    consorcio is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "consorcio", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_data.908c75b0d4": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_data.908c75b0d4", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_data"], "alias": "not_null_viagem_planejada_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9344313, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_data_shape.5117fd368b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data_shape", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_data_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_data_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_data_shape.5117fd368b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_data_shape"], "alias": "not_null_viagem_planejada_data_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.937941, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_data_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    data_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    data_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data_shape", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_tipo_dia.a605476b6d": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "tipo_dia", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_tipo_dia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_tipo_dia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_tipo_dia.a605476b6d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_tipo_dia"], "alias": "not_null_viagem_planejada_tipo_dia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9412618, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_tipo_dia.sql", "compiled": true, "compiled_code": "\nSELECT\n    tipo_dia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    tipo_dia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_dia", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.accepted_values_viagem_planejada_tipo_dia__I__V__C.fabfbe2d14": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "tipo_dia", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_planejada_tipo_dia__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_planejada_tipo_dia__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_planejada_tipo_dia__I__V__C.fabfbe2d14", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_planejada_tipo_dia__I__V__C"], "alias": "accepted_values_viagem_planejada_tipo_dia__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9447703, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_planejada_tipo_dia__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        tipo_dia as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    group by tipo_dia\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_dia", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_servico.a9fd6c7425": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_servico", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_servico.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_servico.a9fd6c7425", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_servico"], "alias": "not_null_viagem_planejada_servico", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9522855, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_servico.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    servico is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_sentido.40310b764f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_sentido.40310b764f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_sentido"], "alias": "not_null_viagem_planejada_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.955699, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_inicio_periodo.c62783ac90": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "inicio_periodo", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_inicio_periodo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_inicio_periodo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_inicio_periodo.c62783ac90", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_inicio_periodo"], "alias": "not_null_viagem_planejada_inicio_periodo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9591947, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_inicio_periodo.sql", "compiled": true, "compiled_code": "\nSELECT\n    inicio_periodo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    inicio_periodo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "inicio_periodo", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_fim_periodo.b2cf28f8cc": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "fim_periodo", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_fim_periodo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_fim_periodo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_fim_periodo.b2cf28f8cc", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_fim_periodo"], "alias": "not_null_viagem_planejada_fim_periodo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9625413, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_fim_periodo.sql", "compiled": true, "compiled_code": "\nSELECT\n    fim_periodo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    fim_periodo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "fim_periodo", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_intervalo.1fb7eb9e45": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "intervalo", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_intervalo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_intervalo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_intervalo.1fb7eb9e45", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_intervalo"], "alias": "not_null_viagem_planejada_intervalo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.966094, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_intervalo.sql", "compiled": true, "compiled_code": "\nSELECT\n    intervalo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    intervalo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "intervalo", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_variacao_itinerario.ea024350d5": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "variacao_itinerario", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_variacao_itinerario", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_variacao_itinerario.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_variacao_itinerario.ea024350d5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_variacao_itinerario"], "alias": "not_null_viagem_planejada_variacao_itinerario", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9695656, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_variacao_itinerario.sql", "compiled": true, "compiled_code": "\nSELECT\n    variacao_itinerario\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    variacao_itinerario is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "variacao_itinerario", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA.19c1ddab9e": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["DD", "DU", "SS", "RT", "RM", "DA", "SA"], "column_name": "variacao_itinerario", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA.19c1ddab9e", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA"], "alias": "accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904"}, "created_at": 1727709587.9729042, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}{{ config(alias=\"accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904\") }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_planeja_9cbf33dc0de267e1804d8f413ecf3904.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        variacao_itinerario as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    group by variacao_itinerario\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'DD','DU','SS','RT','RM','DA','SA'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "variacao_itinerario", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_sentido_shape.7b97f6ff04": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_sentido_shape.7b97f6ff04", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_sentido_shape"], "alias": "not_null_viagem_planejada_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9795742, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.accepted_values_viagem_planejada_sentido_shape__I__V__C.65301f5e21": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_planejada_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_planejada_sentido_shape__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_planejada_sentido_shape__I__V__C.65301f5e21", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_planejada_sentido_shape__I__V__C"], "alias": "accepted_values_viagem_planejada_sentido_shape__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9831004, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_planejada_sentido_shape__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_shape.5f910173a9": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_shape.5f910173a9", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_shape"], "alias": "not_null_viagem_planejada_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9865031, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_distancia_planejada.74a4f2d184": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_distancia_planejada.74a4f2d184", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_distancia_planejada"], "alias": "not_null_viagem_planejada_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9899697, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_viagem_planejada_distancia_total_planejada.fc1b124982": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_total_planejada", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_planejada_distancia_total_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_planejada_distancia_total_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_planejada_distancia_total_planejada.fc1b124982", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_planejada_distancia_total_planejada"], "alias": "not_null_viagem_planejada_distancia_total_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9941945, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_planejada_distancia_total_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_total_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`)\nAND\n    distancia_total_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_total_planejada", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.greater_than_zero_viagem_planejada_distancia_total_planejada.d8c80cf89c": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_total_planejada", "model": "{{ get_where_subquery(ref('viagem_planejada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_planejada_distancia_total_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_planejada_distancia_total_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_planejada_distancia_total_planejada.d8c80cf89c", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_planejada_distancia_total_planejada"], "alias": "greater_than_zero_viagem_planejada_distancia_total_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709587.9977267, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_planejada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_planejada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_planejada_distancia_total_planejada.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_planejada`\n    where distancia_total_planejada <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_total_planejada", "file_key_name": "models.viagem_planejada", "attached_node": "model.rj_smtr.viagem_planejada"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_data.652ad0c445": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_data.652ad0c445", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_data"], "alias": "not_null_aux_registros_status_trajeto_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0019226, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_id_veiculo.101e6b5227": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_id_veiculo.101e6b5227", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_id_veiculo"], "alias": "not_null_aux_registros_status_trajeto_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0054576, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_gps.703590c517": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "timestamp_gps", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_timestamp_gps", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_timestamp_gps.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_gps.703590c517", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_timestamp_gps"], "alias": "not_null_aux_registros_status_trajeto_timestamp_gps", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0094104, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_timestamp_gps.sql", "compiled": true, "compiled_code": "\nSELECT\n    timestamp_gps\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    timestamp_gps is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "timestamp_gps", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_minuto_gps.d2799a61bf": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "timestamp_minuto_gps", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_timestamp_minuto_gps", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_timestamp_minuto_gps.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_minuto_gps.d2799a61bf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_timestamp_minuto_gps"], "alias": "not_null_aux_registros_status_trajeto_timestamp_minuto_gps", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.013012, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_timestamp_minuto_gps.sql", "compiled": true, "compiled_code": "\nSELECT\n    timestamp_minuto_gps\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    timestamp_minuto_gps is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "timestamp_minuto_gps", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_posicao_veiculo_geo.33c0d51e40": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "posicao_veiculo_geo", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_posicao_veiculo_geo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_posicao_veiculo_geo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_posicao_veiculo_geo.33c0d51e40", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_posicao_veiculo_geo"], "alias": "not_null_aux_registros_status_trajeto_posicao_veiculo_geo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0163393, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_posicao_veiculo_geo.sql", "compiled": true, "compiled_code": "\nSELECT\n    posicao_veiculo_geo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    posicao_veiculo_geo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "posicao_veiculo_geo", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_servico_informado.11333dadfe": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_servico_informado.11333dadfe", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_servico_informado"], "alias": "not_null_aux_registros_status_trajeto_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.019794, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_shape_id.586a1a0d47": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_shape_id.586a1a0d47", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_shape_id"], "alias": "not_null_aux_registros_status_trajeto_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0230293, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia_planejada.39e1e1d472": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia_planejada.39e1e1d472", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_distancia_planejada"], "alias": "not_null_aux_registros_status_trajeto_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0265236, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia.703c10aaaf": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia.703c10aaaf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_distancia"], "alias": "not_null_aux_registros_status_trajeto_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0300314, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_distancia.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    distancia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_negative_aux_registros_status_trajeto_distancia.b4cb13122d": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "distancia", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_aux_registros_status_trajeto_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_aux_registros_status_trajeto_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_aux_registros_status_trajeto_distancia.b4cb13122d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_aux_registros_status_trajeto_distancia"], "alias": "not_negative_aux_registros_status_trajeto_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0333, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_aux_registros_status_trajeto_distancia.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\n    where distancia < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_status_viagem.24b7f26346": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "status_viagem", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_status_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_status_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_status_viagem.24b7f26346", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_status_viagem"], "alias": "not_null_aux_registros_status_trajeto_status_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0374465, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_status_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    status_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    status_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "status_viagem", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_versao_modelo.22de27b835": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_versao_modelo.22de27b835", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_versao_modelo"], "alias": "not_null_aux_registros_status_trajeto_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0406942, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido_shape.a14a95f5e8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido_shape.a14a95f5e8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_sentido_shape"], "alias": "not_null_aux_registros_status_trajeto_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0442684, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C.5b82f18cbf": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_registros__251d833025d82c18b293337ceba65d74.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C.5b82f18cbf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C"], "alias": "accepted_values_aux_registros__251d833025d82c18b293337ceba65d74", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "accepted_values_aux_registros__251d833025d82c18b293337ceba65d74", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "accepted_values_aux_registros__251d833025d82c18b293337ceba65d74"}, "created_at": 1727709588.0485132, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}{{ config(alias=\"accepted_values_aux_registros__251d833025d82c18b293337ceba65d74\") }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_registros__251d833025d82c18b293337ceba65d74.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido.6291e69d70": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_registros_status_trajeto_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_registros_status_trajeto_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido.6291e69d70", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_registros_status_trajeto_sentido"], "alias": "not_null_aux_registros_status_trajeto_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0520675, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_registros_status_trajeto_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido__I__V__C.2082fbe17f": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_registros_status_trajeto')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_registros_status_trajeto_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_registros_status_trajeto_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido__I__V__C.2082fbe17f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_registros_status_trajeto_sentido__I__V__C"], "alias": "accepted_values_aux_registros_status_trajeto_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0555325, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_registros_status_trajeto", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_registros_status_trajeto"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_registros_status_trajeto_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_registros_status_trajeto`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_registros_status_trajeto", "attached_node": "model.rj_smtr.aux_registros_status_trajeto"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_data.3ef5737e0d": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_data.3ef5737e0d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_data"], "alias": "not_null_aux_viagem_inicio_fim_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0588493, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_veiculo.c69fdfc708": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_veiculo.c69fdfc708", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_id_veiculo"], "alias": "not_null_aux_viagem_inicio_fim_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0623908, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_informado.7adb7ebfd7": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_informado.7adb7ebfd7", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_servico_informado"], "alias": "not_null_aux_viagem_inicio_fim_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0659285, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_realizado.60bf591717": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_realizado", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_servico_realizado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_servico_realizado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_realizado.60bf591717", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_servico_realizado"], "alias": "not_null_aux_viagem_inicio_fim_servico_realizado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.069259, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_servico_realizado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_realizado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    servico_realizado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_realizado", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_shape_id.9b971af0ae": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_shape_id.9b971af0ae", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_shape_id"], "alias": "not_null_aux_viagem_inicio_fim_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0727146, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido_shape.4c3ec0996b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido_shape.4c3ec0996b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_sentido_shape"], "alias": "not_null_aux_viagem_inicio_fim_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0759635, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.9af2f7b6e0": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.9af2f7b6e0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C"], "alias": "accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0797844, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido.976bd6a11f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido.976bd6a11f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_sentido"], "alias": "not_null_aux_viagem_inicio_fim_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0833178, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.4f2096c560": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_viagem_inicio_fim_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.4f2096c560", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_viagem_inicio_fim_sentido__I__V__C"], "alias": "accepted_values_aux_viagem_inicio_fim_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0868475, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_viagem.9cfe2e3fdd": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_viagem.9cfe2e3fdd", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_id_viagem"], "alias": "not_null_aux_viagem_inicio_fim_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0903933, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.unique_aux_viagem_inicio_fim_id_viagem.321f77f756": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_aux_viagem_inicio_fim_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_aux_viagem_inicio_fim_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_aux_viagem_inicio_fim_id_viagem.321f77f756", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_aux_viagem_inicio_fim_id_viagem"], "alias": "unique_aux_viagem_inicio_fim_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0937397, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_aux_viagem_inicio_fim_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_partida.c668ec6882": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_partida", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_datetime_partida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_datetime_partida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_partida.c668ec6882", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_datetime_partida"], "alias": "not_null_aux_viagem_inicio_fim_datetime_partida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.095172, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_datetime_partida.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_partida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    datetime_partida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_partida", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_chegada.2e883813e8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_chegada", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_datetime_chegada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_datetime_chegada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_chegada.2e883813e8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_datetime_chegada"], "alias": "not_null_aux_viagem_inicio_fim_datetime_chegada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.0988576, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_datetime_chegada.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_chegada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    datetime_chegada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_chegada", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_versao_modelo.7bace7cce8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_versao_modelo.7bace7cce8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_versao_modelo"], "alias": "not_null_aux_viagem_inicio_fim_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1022139, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_inicio_fim_distancia_planejada.a26e748226": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('aux_viagem_inicio_fim')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_inicio_fim_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_inicio_fim_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_inicio_fim_distancia_planejada.a26e748226", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_inicio_fim_distancia_planejada"], "alias": "not_null_aux_viagem_inicio_fim_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1057508, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_inicio_fim", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_inicio_fim"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_inicio_fim_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_inicio_fim`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.aux_viagem_inicio_fim", "attached_node": "model.rj_smtr.aux_viagem_inicio_fim"}, "test.rj_smtr.not_null_aux_viagem_circular_data.9696b69d2f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_data.9696b69d2f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_data"], "alias": "not_null_aux_viagem_circular_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.109241, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_id_veiculo.f928466090": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_id_veiculo.f928466090", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_id_veiculo"], "alias": "not_null_aux_viagem_circular_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.112538, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_servico_informado.e43d2419a6": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_servico_informado.e43d2419a6", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_servico_informado"], "alias": "not_null_aux_viagem_circular_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1160157, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_shape_id.d4509226b0": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_shape_id.d4509226b0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_shape_id"], "alias": "not_null_aux_viagem_circular_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.119266, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_sentido_shape.ca74a5e3f0": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_sentido_shape.ca74a5e3f0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_sentido_shape"], "alias": "not_null_aux_viagem_circular_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.123298, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.accepted_values_aux_viagem_circular_sentido_shape__I__V__C.39a2bf1eea": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_viagem_circular_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_viagem_circular_sentido_shape__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_viagem_circular_sentido_shape__I__V__C.39a2bf1eea", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_viagem_circular_sentido_shape__I__V__C"], "alias": "accepted_values_aux_viagem_circular_sentido_shape__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1267815, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_viagem_circular_sentido_shape__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_sentido.d255c2ea5c": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_sentido.d255c2ea5c", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_sentido"], "alias": "not_null_aux_viagem_circular_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.130173, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.accepted_values_aux_viagem_circular_sentido__I__V__C.70c058ec81": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_aux_viagem_circular_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_aux_viagem_circular_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_aux_viagem_circular_sentido__I__V__C.70c058ec81", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_aux_viagem_circular_sentido__I__V__C"], "alias": "accepted_values_aux_viagem_circular_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1336486, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_aux_viagem_circular_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_id_viagem.48bb460a25": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_id_viagem.48bb460a25", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_id_viagem"], "alias": "not_null_aux_viagem_circular_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1369958, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.unique_aux_viagem_circular_id_viagem.1ee2d25705": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_aux_viagem_circular_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_aux_viagem_circular_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_aux_viagem_circular_id_viagem.1ee2d25705", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_aux_viagem_circular_id_viagem"], "alias": "unique_aux_viagem_circular_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.140482, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_aux_viagem_circular_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_datetime_partida.44f6ea1a28": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_partida", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_datetime_partida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_datetime_partida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_datetime_partida.44f6ea1a28", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_datetime_partida"], "alias": "not_null_aux_viagem_circular_datetime_partida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1418924, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_datetime_partida.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_partida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    datetime_partida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_partida", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_datetime_chegada.129de567e2": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_chegada", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_datetime_chegada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_datetime_chegada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_datetime_chegada.129de567e2", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_datetime_chegada"], "alias": "not_null_aux_viagem_circular_datetime_chegada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.145384, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_datetime_chegada.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_chegada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    datetime_chegada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_chegada", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_versao_modelo.5c199c2365": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_versao_modelo.5c199c2365", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_versao_modelo"], "alias": "not_null_aux_viagem_circular_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1487026, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_aux_viagem_circular_distancia_planejada.5baf640cb6": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('aux_viagem_circular')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_circular_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_circular_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_circular_distancia_planejada.5baf640cb6", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_circular_distancia_planejada"], "alias": "not_null_aux_viagem_circular_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1521914, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_circular", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_circular"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_circular_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_circular`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.aux_viagem_circular", "attached_node": "model.rj_smtr.aux_viagem_circular"}, "test.rj_smtr.not_null_registros_status_viagem_data.fc562948d5": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_data.fc562948d5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_data"], "alias": "not_null_registros_status_viagem_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1555252, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_id_veiculo.3c008a9ac4": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_id_veiculo.3c008a9ac4", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_id_veiculo"], "alias": "not_null_registros_status_viagem_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1589947, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_id_empresa.3108e4aab8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_empresa", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_id_empresa", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_id_empresa.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_id_empresa.3108e4aab8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_id_empresa"], "alias": "not_null_registros_status_viagem_id_empresa", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1625462, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_id_empresa.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_empresa\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    id_empresa is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_empresa", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_timestamp_gps.01b64d27a5": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "timestamp_gps", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_timestamp_gps", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_timestamp_gps.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_timestamp_gps.01b64d27a5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_timestamp_gps"], "alias": "not_null_registros_status_viagem_timestamp_gps", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1658597, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_timestamp_gps.sql", "compiled": true, "compiled_code": "\nSELECT\n    timestamp_gps\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    timestamp_gps is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "timestamp_gps", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_timestamp_minuto_gps.1157bb9203": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "timestamp_minuto_gps", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_timestamp_minuto_gps", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_timestamp_minuto_gps.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_timestamp_minuto_gps.1157bb9203", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_timestamp_minuto_gps"], "alias": "not_null_registros_status_viagem_timestamp_minuto_gps", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1693132, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_timestamp_minuto_gps.sql", "compiled": true, "compiled_code": "\nSELECT\n    timestamp_minuto_gps\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    timestamp_minuto_gps is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "timestamp_minuto_gps", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_posicao_veiculo_geo.78b9ad4651": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "posicao_veiculo_geo", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_posicao_veiculo_geo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_posicao_veiculo_geo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_posicao_veiculo_geo.78b9ad4651", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_posicao_veiculo_geo"], "alias": "not_null_registros_status_viagem_posicao_veiculo_geo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1725402, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_posicao_veiculo_geo.sql", "compiled": true, "compiled_code": "\nSELECT\n    posicao_veiculo_geo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    posicao_veiculo_geo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "posicao_veiculo_geo", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_servico_informado.dd60d17ad8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_servico_informado.dd60d17ad8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_servico_informado"], "alias": "not_null_registros_status_viagem_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1760168, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_servico_realizado.5376b0386b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_realizado", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_servico_realizado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_servico_realizado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_servico_realizado.5376b0386b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_servico_realizado"], "alias": "not_null_registros_status_viagem_servico_realizado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1793165, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_servico_realizado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_realizado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    servico_realizado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_realizado", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_shape_id.1d4aad9d42": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_shape_id.1d4aad9d42", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_shape_id"], "alias": "not_null_registros_status_viagem_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1828449, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_distancia_planejada.97e1779cf0": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_distancia_planejada.97e1779cf0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_distancia_planejada"], "alias": "not_null_registros_status_viagem_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1864145, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_distancia.85f4f41092": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_distancia.85f4f41092", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_distancia"], "alias": "not_null_registros_status_viagem_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1897287, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_distancia.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    distancia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_negative_registros_status_viagem_distancia.34c62e5708": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "distancia", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_registros_status_viagem_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_registros_status_viagem_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_registros_status_viagem_distancia.34c62e5708", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_registros_status_viagem_distancia"], "alias": "not_negative_registros_status_viagem_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1940806, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_registros_status_viagem_distancia.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\n    where distancia < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_status_viagem.d00cac767b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "status_viagem", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_status_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_status_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_status_viagem.d00cac767b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_status_viagem"], "alias": "not_null_registros_status_viagem_status_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.1980672, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_status_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    status_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    status_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "status_viagem", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_sentido_shape.88347d2c2f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_sentido_shape.88347d2c2f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_sentido_shape"], "alias": "not_null_registros_status_viagem_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2021072, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.accepted_values_registros_status_viagem_sentido_shape__I__V__C.a6ccf195ec": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_registros_status_viagem_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_registros_status_viagem_sentido_shape__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_registros_status_viagem_sentido_shape__I__V__C.a6ccf195ec", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_registros_status_viagem_sentido_shape__I__V__C"], "alias": "accepted_values_registros_status_viagem_sentido_shape__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.206244, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_registros_status_viagem_sentido_shape__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_sentido.85a3d01213": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_sentido.85a3d01213", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_sentido"], "alias": "not_null_registros_status_viagem_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2098093, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.accepted_values_registros_status_viagem_sentido__I__V__C.8b8fa70da7": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_registros_status_viagem_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_registros_status_viagem_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_registros_status_viagem_sentido__I__V__C.8b8fa70da7", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_registros_status_viagem_sentido__I__V__C"], "alias": "accepted_values_registros_status_viagem_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2135603, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_registros_status_viagem_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_id_viagem.b81547c9af": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_id_viagem.b81547c9af", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_id_viagem"], "alias": "not_null_registros_status_viagem_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2170403, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.unique_registros_status_viagem_id_viagem.5e7788f7bf": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_registros_status_viagem_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_registros_status_viagem_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_registros_status_viagem_id_viagem.5e7788f7bf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_registros_status_viagem_id_viagem"], "alias": "unique_registros_status_viagem_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.220622, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_registros_status_viagem_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_datetime_partida.15c5410b28": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_partida", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_datetime_partida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_datetime_partida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_datetime_partida.15c5410b28", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_datetime_partida"], "alias": "not_null_registros_status_viagem_datetime_partida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2220442, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_datetime_partida.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_partida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    datetime_partida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_partida", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_datetime_chegada.5dbeb5b878": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_chegada", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_datetime_chegada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_datetime_chegada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_datetime_chegada.5dbeb5b878", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_datetime_chegada"], "alias": "not_null_registros_status_viagem_datetime_chegada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.225557, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_datetime_chegada.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_chegada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    datetime_chegada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_chegada", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_registros_status_viagem_versao_modelo.86225e08a6": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('registros_status_viagem')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_registros_status_viagem_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_registros_status_viagem_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_registros_status_viagem_versao_modelo.86225e08a6", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_registros_status_viagem_versao_modelo"], "alias": "not_null_registros_status_viagem_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2289155, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "registros_status_viagem", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.registros_status_viagem"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_registros_status_viagem_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`registros_status_viagem`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.registros_status_viagem", "attached_node": "model.rj_smtr.registros_status_viagem"}, "test.rj_smtr.not_null_aux_viagem_registros_id_viagem.a786e08594": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_id_viagem.a786e08594", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_id_viagem"], "alias": "not_null_aux_viagem_registros_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2325215, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.unique_aux_viagem_registros_id_viagem.f0eebfdeac": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_aux_viagem_registros_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_aux_viagem_registros_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_aux_viagem_registros_id_viagem.f0eebfdeac", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_aux_viagem_registros_id_viagem"], "alias": "unique_aux_viagem_registros_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2358418, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_aux_viagem_registros_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_distancia_planejada.a779141cf5": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_distancia_planejada.a779141cf5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_distancia_planejada"], "alias": "not_null_aux_viagem_registros_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.23752, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_planejada.ad85bf839a": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_planejada.ad85bf839a", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_distancia_planejada"], "alias": "greater_than_zero_aux_viagem_registros_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2407937, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_distancia_planejada.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where distancia_planejada <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_distancia_aferida.af703eccfb": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_distancia_aferida.af703eccfb", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_distancia_aferida"], "alias": "not_null_aux_viagem_registros_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2442338, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_distancia_aferida.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_aferida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    distancia_aferida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_aferida.3f4f58b67a": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_aferida.3f4f58b67a", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_distancia_aferida"], "alias": "greater_than_zero_aux_viagem_registros_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2475863, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_distancia_aferida.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where distancia_aferida <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_middle.32807232ce": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_middle", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_middle", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_middle.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_middle.32807232ce", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_middle"], "alias": "not_null_aux_viagem_registros_n_registros_middle", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2510805, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_middle.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_middle\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_middle is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_middle", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_middle.6fda2c93f2": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_middle", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_n_registros_middle", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_n_registros_middle.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_middle.6fda2c93f2", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_n_registros_middle"], "alias": "greater_than_zero_aux_viagem_registros_n_registros_middle", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2546313, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_n_registros_middle.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_middle <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_middle", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_start.4e1ace515e": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_start", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_start", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_start.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_start.4e1ace515e", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_start"], "alias": "not_null_aux_viagem_registros_n_registros_start", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2579367, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_start.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_start\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_start is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_start", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_start.6777af50be": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_start", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_n_registros_start", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_n_registros_start.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_start.6777af50be", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_n_registros_start"], "alias": "greater_than_zero_aux_viagem_registros_n_registros_start", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2614484, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_n_registros_start.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_start <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_start", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_end.6be4269aee": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_end", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_end", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_end.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_end.6be4269aee", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_end"], "alias": "not_null_aux_viagem_registros_n_registros_end", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2647984, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_end.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_end\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_end is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_end", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_end.e1ccb9c563": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_end", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_n_registros_end", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_n_registros_end.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_end.e1ccb9c563", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_n_registros_end"], "alias": "greater_than_zero_aux_viagem_registros_n_registros_end", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2688065, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_n_registros_end.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_end <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_end", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_out.0e8817c0b4": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_out", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_out", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_out.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_out.0e8817c0b4", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_out"], "alias": "not_null_aux_viagem_registros_n_registros_out", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2720983, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_out.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_out\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_out is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_out", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_out.16cc121f84": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "n_registros_out", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_aux_viagem_registros_n_registros_out", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_aux_viagem_registros_n_registros_out.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_out.16cc121f84", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_aux_viagem_registros_n_registros_out"], "alias": "not_negative_aux_viagem_registros_n_registros_out", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2755735, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_aux_viagem_registros_n_registros_out.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_out < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_out", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_total.0a1be4060f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_total.0a1be4060f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_total"], "alias": "not_null_aux_viagem_registros_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.279125, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_total.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_total\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_total is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_total.c812b681b0": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_total.c812b681b0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_n_registros_total"], "alias": "greater_than_zero_aux_viagem_registros_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.2825062, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_n_registros_total.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_total <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_minuto.157ae1cdaf": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_minuto.157ae1cdaf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_minuto"], "alias": "not_null_aux_viagem_registros_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.285956, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_minuto.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_minuto\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_minuto is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_minuto.82864933b3": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_aux_viagem_registros_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_aux_viagem_registros_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_minuto.82864933b3", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_aux_viagem_registros_n_registros_minuto"], "alias": "greater_than_zero_aux_viagem_registros_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.289209, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_aux_viagem_registros_n_registros_minuto.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_minuto <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_versao_modelo.4e6a36e817": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_versao_modelo.4e6a36e817", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_versao_modelo"], "alias": "not_null_aux_viagem_registros_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.292724, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_aux_viagem_registros_n_registros_shape.e354f14169": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_aux_viagem_registros_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_aux_viagem_registros_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_aux_viagem_registros_n_registros_shape.e354f14169", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_aux_viagem_registros_n_registros_shape"], "alias": "not_null_aux_viagem_registros_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.296326, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_aux_viagem_registros_n_registros_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`)\nAND\n    n_registros_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_shape.d8d479f025": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('aux_viagem_registros')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_aux_viagem_registros_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_aux_viagem_registros_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_shape.d8d479f025", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_aux_viagem_registros_n_registros_shape"], "alias": "not_negative_aux_viagem_registros_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.299649, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "aux_viagem_registros", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.aux_viagem_registros"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_aux_viagem_registros_n_registros_shape.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`aux_viagem_registros`\n    where n_registros_shape < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.aux_viagem_registros", "attached_node": "model.rj_smtr.aux_viagem_registros"}, "test.rj_smtr.not_null_viagem_conformidade_data.dba44f5b88": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_data.dba44f5b88", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_data"], "alias": "not_null_viagem_conformidade_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3031065, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_id_veiculo.4dc76608fb": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_id_veiculo.4dc76608fb", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_id_veiculo"], "alias": "not_null_viagem_conformidade_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.306366, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_servico_informado.d130583ad1": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_servico_informado.d130583ad1", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_servico_informado"], "alias": "not_null_viagem_conformidade_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.309877, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_servico_realizado.3bd70666f8": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_realizado", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_servico_realizado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_servico_realizado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_servico_realizado.3bd70666f8", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_servico_realizado"], "alias": "not_null_viagem_conformidade_servico_realizado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3132427, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_servico_realizado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_realizado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    servico_realizado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_realizado", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_shape_id.2fd4863204": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_shape_id.2fd4863204", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_shape_id"], "alias": "not_null_viagem_conformidade_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.316809, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_sentido_shape.e828f58e76": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_sentido_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_sentido_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_sentido_shape.e828f58e76", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_sentido_shape"], "alias": "not_null_viagem_conformidade_sentido_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.320268, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_sentido_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    sentido_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.accepted_values_viagem_conformidade_sentido_shape__I__V__C.1c6ae2b41d": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_conformidade_sentido_shape__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_conformidade_sentido_shape__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_conformidade_sentido_shape__I__V__C.1c6ae2b41d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_conformidade_sentido_shape__I__V__C"], "alias": "accepted_values_viagem_conformidade_sentido_shape__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.323532, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_conformidade_sentido_shape__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido_shape as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    group by sentido_shape\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_sentido.9ff9017055": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_sentido.9ff9017055", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_sentido"], "alias": "not_null_viagem_conformidade_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3270366, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.accepted_values_viagem_conformidade_sentido__I__V__C.37e4bf801f": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_conformidade_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_conformidade_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_conformidade_sentido__I__V__C.37e4bf801f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_conformidade_sentido__I__V__C"], "alias": "accepted_values_viagem_conformidade_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3303583, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_conformidade_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_id_viagem.52f7dd7469": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_id_viagem.52f7dd7469", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_id_viagem"], "alias": "not_null_viagem_conformidade_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3339512, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.unique_viagem_conformidade_id_viagem.5aa802e5bf": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_viagem_conformidade_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_viagem_conformidade_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_viagem_conformidade_id_viagem.5aa802e5bf", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_viagem_conformidade_id_viagem"], "alias": "unique_viagem_conformidade_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3379796, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_viagem_conformidade_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_datetime_partida.fd79047671": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_partida", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_datetime_partida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_datetime_partida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_datetime_partida.fd79047671", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_datetime_partida"], "alias": "not_null_viagem_conformidade_datetime_partida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3394086, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_datetime_partida.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_partida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    datetime_partida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_partida", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_datetime_chegada.72c3aa8bba": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_chegada", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_datetime_chegada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_datetime_chegada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_datetime_chegada.72c3aa8bba", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_datetime_chegada"], "alias": "not_null_viagem_conformidade_datetime_chegada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3426511, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_datetime_chegada.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_chegada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    datetime_chegada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_chegada", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_tempo_viagem.9d731143cc": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "tempo_viagem", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_tempo_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_tempo_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_tempo_viagem.9d731143cc", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_tempo_viagem"], "alias": "not_null_viagem_conformidade_tempo_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3461664, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_tempo_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    tempo_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    tempo_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tempo_viagem", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_tempo_viagem.94e16edeba": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "tempo_viagem", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_tempo_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_tempo_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_tempo_viagem.94e16edeba", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_tempo_viagem"], "alias": "greater_than_zero_viagem_conformidade_tempo_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3495562, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_tempo_viagem.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where tempo_viagem <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tempo_viagem", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_distancia_planejada.9a5bf3230e": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_distancia_planejada.9a5bf3230e", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_distancia_planejada"], "alias": "not_null_viagem_conformidade_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3532066, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_planejada.399d334601": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_planejada.399d334601", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_distancia_planejada"], "alias": "greater_than_zero_viagem_conformidade_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.35685, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_distancia_planejada.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where distancia_planejada <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_distancia_aferida.f7b56d4343": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_distancia_aferida.f7b56d4343", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_distancia_aferida"], "alias": "not_null_viagem_conformidade_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.360263, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_distancia_aferida.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_aferida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    distancia_aferida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_aferida.14ac42d258": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_aferida.14ac42d258", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_distancia_aferida"], "alias": "greater_than_zero_viagem_conformidade_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3640943, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_distancia_aferida.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where distancia_aferida <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_middle.7965304122": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_middle", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_middle", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_middle.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_middle.7965304122", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_middle"], "alias": "not_null_viagem_conformidade_n_registros_middle", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3677194, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_middle.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_middle\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_middle is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_middle", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_middle.794c022bd1": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_middle", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_n_registros_middle", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_n_registros_middle.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_middle.794c022bd1", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_n_registros_middle"], "alias": "greater_than_zero_viagem_conformidade_n_registros_middle", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3713849, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_n_registros_middle.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_middle <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_middle", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_start.53a2b2e530": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_start", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_start", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_start.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_start.53a2b2e530", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_start"], "alias": "not_null_viagem_conformidade_n_registros_start", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3748953, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_start.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_start\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_start is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_start", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_start.3b4d5df527": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_start", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_n_registros_start", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_n_registros_start.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_start.3b4d5df527", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_n_registros_start"], "alias": "greater_than_zero_viagem_conformidade_n_registros_start", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3798306, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_n_registros_start.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_start <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_start", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_end.accb64d6bd": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_end", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_end", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_end.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_end.accb64d6bd", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_end"], "alias": "not_null_viagem_conformidade_n_registros_end", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3837295, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_end.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_end\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_end is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_end", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_end.2e79c19e44": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_end", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_n_registros_end", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_n_registros_end.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_end.2e79c19e44", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_n_registros_end"], "alias": "greater_than_zero_viagem_conformidade_n_registros_end", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.387066, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_n_registros_end.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_end <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_end", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_out.6dac645a68": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_out", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_out", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_out.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_out.6dac645a68", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_out"], "alias": "not_null_viagem_conformidade_n_registros_out", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.390621, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_out.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_out\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_out is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_out", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_negative_viagem_conformidade_n_registros_out.05ed52b76e": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "n_registros_out", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_viagem_conformidade_n_registros_out", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_viagem_conformidade_n_registros_out.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_viagem_conformidade_n_registros_out.05ed52b76e", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_viagem_conformidade_n_registros_out"], "alias": "not_negative_viagem_conformidade_n_registros_out", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3940346, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_viagem_conformidade_n_registros_out.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_out < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_out", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_shape.567191d3b2": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_shape.567191d3b2", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_shape"], "alias": "not_null_viagem_conformidade_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.3976676, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_negative_viagem_conformidade_n_registros_shape.fa86a62956": {"test_metadata": {"name": "not_negative", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_negative_viagem_conformidade_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_negative_viagem_conformidade_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_negative_viagem_conformidade_n_registros_shape.fa86a62956", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_negative_viagem_conformidade_n_registros_shape"], "alias": "not_negative_viagem_conformidade_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.401183, "relation_name": null, "raw_code": "{{ test_not_negative(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_negative", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_negative_viagem_conformidade_n_registros_shape.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_shape < 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_total.8514b50af0": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_total.8514b50af0", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_total"], "alias": "not_null_viagem_conformidade_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4044797, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_total.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_total\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_total is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_total.845a3f5e81": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_total.845a3f5e81", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_n_registros_total"], "alias": "greater_than_zero_viagem_conformidade_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.407947, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_n_registros_total.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_total <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_n_registros_minuto.a1804e8458": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_n_registros_minuto.a1804e8458", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_n_registros_minuto"], "alias": "not_null_viagem_conformidade_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.411359, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_n_registros_minuto.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_minuto\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    n_registros_minuto is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_minuto.44dcb2a328": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_minuto.44dcb2a328", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_n_registros_minuto"], "alias": "greater_than_zero_viagem_conformidade_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4155324, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_n_registros_minuto.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where n_registros_minuto <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_shape.c779adcc22": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_perc_conformidade_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_perc_conformidade_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_shape.c779adcc22", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_perc_conformidade_shape"], "alias": "not_null_viagem_conformidade_perc_conformidade_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4190269, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_perc_conformidade_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    perc_conformidade_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_shape.672bafc4f5": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_shape", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_perc_conformidade_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_conformidade_perc_conformidade_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_shape.672bafc4f5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_perc_conformidade_shape"], "alias": "greater_than_zero_viagem_conformidade_perc_conformidade_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.422326, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_conformidade_perc_conformidade_shape.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where perc_conformidade_shape <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_shape", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_distancia.e95ad3d84b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_distancia", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_perc_conformidade_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_perc_conformidade_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_distancia.e95ad3d84b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_perc_conformidade_distancia"], "alias": "not_null_viagem_conformidade_perc_conformidade_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4268024, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_perc_conformidade_distancia.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_distancia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    perc_conformidade_distancia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_distancia", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_distancia.947723cc56": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_distancia", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_perc_conformidade_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_distancia.947723cc56", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_perc_conformidade_distancia"], "alias": "greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0"}, "created_at": 1727709588.4306588, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}{{ config(alias=\"greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0\") }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_confo_fb43a4eab057a3ac1dff2f61fba3efa0.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where perc_conformidade_distancia <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_distancia", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_registros.5889951b7b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_registros", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_perc_conformidade_registros", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_perc_conformidade_registros.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_registros.5889951b7b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_perc_conformidade_registros"], "alias": "not_null_viagem_conformidade_perc_conformidade_registros", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.434507, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_perc_conformidade_registros.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_registros\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    perc_conformidade_registros is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_registros", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_registros.078f53372c": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_registros", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_conformidade_perc_conformidade_registros", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_registros.078f53372c", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_conformidade_perc_conformidade_registros"], "alias": "greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647"}, "created_at": 1727709588.4378483, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}{{ config(alias=\"greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647\") }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_confo_03c3c673b33201153d6881b11c2d2647.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\n    where perc_conformidade_registros <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_registros", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_conformidade_versao_modelo.ddf040eb5f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('viagem_conformidade')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_conformidade_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_conformidade_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_conformidade_versao_modelo.ddf040eb5f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_conformidade_versao_modelo"], "alias": "not_null_viagem_conformidade_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4415338, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_conformidade", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_conformidade"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_conformidade_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_conformidade`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.viagem_conformidade", "attached_node": "model.rj_smtr.viagem_conformidade"}, "test.rj_smtr.not_null_viagem_completa_consorcio.ef41dcab9b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "consorcio", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_consorcio", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_consorcio.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_consorcio.ef41dcab9b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_consorcio"], "alias": "not_null_viagem_completa_consorcio", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4451027, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_consorcio.sql", "compiled": true, "compiled_code": "\nSELECT\n    consorcio\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    consorcio is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "consorcio", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_data.60008eec9c": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "data", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_data", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_data.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_data.60008eec9c", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_data"], "alias": "not_null_viagem_completa_data", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4484484, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_data.sql", "compiled": true, "compiled_code": "\nSELECT\n    data\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    data is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "data", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_tipo_dia.1718470616": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "tipo_dia", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_tipo_dia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_tipo_dia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_tipo_dia.1718470616", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_tipo_dia"], "alias": "not_null_viagem_completa_tipo_dia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4519196, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_tipo_dia.sql", "compiled": true, "compiled_code": "\nSELECT\n    tipo_dia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    tipo_dia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_dia", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo.be741d00ee": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["Dia \u00datil", "Sabado", "Domingo"], "column_name": "tipo_dia", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo.be741d00ee", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo"], "alias": "accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21"}, "created_at": 1727709588.455204, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}{{ config(alias=\"accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21\") }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_complet_ceabc8f97f6e4d8a1c71251cbf337b21.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        tipo_dia as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    group by tipo_dia\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Dia \u00datil','Sabado','Domingo'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_dia", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_id_veiculo.4b31ddd12f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_veiculo", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_id_veiculo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_id_veiculo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_id_veiculo.4b31ddd12f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_id_veiculo"], "alias": "not_null_viagem_completa_id_veiculo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4599528, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_id_veiculo.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_veiculo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    id_veiculo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_veiculo", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_servico_informado.3aa58feb5f": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_informado", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_servico_informado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_servico_informado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_servico_informado.3aa58feb5f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_servico_informado"], "alias": "not_null_viagem_completa_servico_informado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4635487, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_servico_informado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_informado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    servico_informado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_informado", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_servico_realizado.7433281d87": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "servico_realizado", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_servico_realizado", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_servico_realizado.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_servico_realizado.7433281d87", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_servico_realizado"], "alias": "not_null_viagem_completa_servico_realizado", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4668279, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_servico_realizado.sql", "compiled": true, "compiled_code": "\nSELECT\n    servico_realizado\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    servico_realizado is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "servico_realizado", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_vista.ace89b5843": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "vista", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_vista", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_vista.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_vista.ace89b5843", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_vista"], "alias": "not_null_viagem_completa_vista", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4703143, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_vista.sql", "compiled": true, "compiled_code": "\nSELECT\n    vista\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    vista is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "vista", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_trip_id.b9d8d1d6fd": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "trip_id", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_trip_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_trip_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_trip_id.b9d8d1d6fd", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_trip_id"], "alias": "not_null_viagem_completa_trip_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.473552, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_trip_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    trip_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    trip_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_shape_id.cfa5f99155": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "shape_id", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_shape_id", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_shape_id.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_shape_id.cfa5f99155", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_shape_id"], "alias": "not_null_viagem_completa_shape_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4770455, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_shape_id.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_sentido.a8ba9e34e6": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "sentido", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_sentido", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_sentido.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_sentido.a8ba9e34e6", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_sentido"], "alias": "not_null_viagem_completa_sentido", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.480617, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_sentido.sql", "compiled": true, "compiled_code": "\nSELECT\n    sentido\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    sentido is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.accepted_values_viagem_completa_sentido__I__V__C.14734d12d7": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["I", "V", "C"], "column_name": "sentido", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_completa_sentido__I__V__C", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_completa_sentido__I__V__C.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_completa_sentido__I__V__C.14734d12d7", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_completa_sentido__I__V__C"], "alias": "accepted_values_viagem_completa_sentido__I__V__C", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.483933, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_completa_sentido__I__V__C.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sentido as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    group by sentido\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'I','V','C'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "sentido", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_id_viagem.c4481cf0da": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_id_viagem.c4481cf0da", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_id_viagem"], "alias": "not_null_viagem_completa_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.488045, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_id_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    id_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    id_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.unique_viagem_completa_id_viagem.e7a957c7b9": {"test_metadata": {"name": "unique", "kwargs": {"column_name": "id_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_viagem_completa_id_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_viagem_completa_id_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.unique_viagem_completa_id_viagem.e7a957c7b9", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "unique_viagem_completa_id_viagem"], "alias": "unique_viagem_completa_id_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4912894, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/unique_viagem_completa_id_viagem.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select id_viagem as unique_field\n  from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n  where id_viagem is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_datetime_partida.a62e5f9eac": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_partida", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_datetime_partida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_datetime_partida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_datetime_partida.a62e5f9eac", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_datetime_partida"], "alias": "not_null_viagem_completa_datetime_partida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4930577, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_datetime_partida.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_partida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    datetime_partida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_partida", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_datetime_chegada.fac30fe07a": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "datetime_chegada", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_datetime_chegada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_datetime_chegada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_datetime_chegada.fac30fe07a", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_datetime_chegada"], "alias": "not_null_viagem_completa_datetime_chegada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4964058, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_datetime_chegada.sql", "compiled": true, "compiled_code": "\nSELECT\n    datetime_chegada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    datetime_chegada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "datetime_chegada", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_tipo_viagem.6bda4a1de6": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "tipo_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_tipo_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_tipo_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_tipo_viagem.6bda4a1de6", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_tipo_viagem"], "alias": "not_null_viagem_completa_tipo_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.4998903, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_tipo_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    tipo_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    tipo_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta.d7777aca98": {"test_metadata": {"name": "accepted_values", "kwargs": {"values": ["Completa linha correta", "Completa linha incorreta"], "column_name": "tipo_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta", "resource_type": "test", "package_name": "rj_smtr", "path": "accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta.d7777aca98", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta"], "alias": "accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223"}, "created_at": 1727709588.5035458, "relation_name": null, "raw_code": "{{ test_accepted_values(**_dbt_generic_test_kwargs) }}{{ config(alias=\"accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223\") }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_accepted_values", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/accepted_values_viagem_complet_e13e96d55e27ff0c7566ab576dda5223.sql", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        tipo_viagem as value_field,\n        count(*) as n_records\n\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    group by tipo_viagem\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Completa linha correta','Completa linha incorreta'\n)\n\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tipo_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_tempo_viagem.2d2a673c5b": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "tempo_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_tempo_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_tempo_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_tempo_viagem.2d2a673c5b", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_tempo_viagem"], "alias": "not_null_viagem_completa_tempo_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5079763, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_tempo_viagem.sql", "compiled": true, "compiled_code": "\nSELECT\n    tempo_viagem\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    tempo_viagem is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tempo_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_tempo_viagem.6c4c35eea7": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "tempo_viagem", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_tempo_viagem", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_tempo_viagem.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_tempo_viagem.6c4c35eea7", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_tempo_viagem"], "alias": "greater_than_zero_viagem_completa_tempo_viagem", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5114923, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_tempo_viagem.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where tempo_viagem <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "tempo_viagem", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_distancia_planejada.bbd49d7634": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_distancia_planejada.bbd49d7634", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_distancia_planejada"], "alias": "not_null_viagem_completa_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5148308, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_distancia_planejada.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_planejada\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    distancia_planejada is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_distancia_planejada.a4e65fb078": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_planejada", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_distancia_planejada", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_distancia_planejada.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_distancia_planejada.a4e65fb078", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_distancia_planejada"], "alias": "greater_than_zero_viagem_completa_distancia_planejada", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.518345, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_distancia_planejada.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where distancia_planejada <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_planejada", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_distancia_aferida.0edb9adb33": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_distancia_aferida.0edb9adb33", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_distancia_aferida"], "alias": "not_null_viagem_completa_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5215862, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_distancia_aferida.sql", "compiled": true, "compiled_code": "\nSELECT\n    distancia_aferida\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    distancia_aferida is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_distancia_aferida.f5d805262a": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "distancia_aferida", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_distancia_aferida", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_distancia_aferida.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_distancia_aferida.f5d805262a", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_distancia_aferida"], "alias": "greater_than_zero_viagem_completa_distancia_aferida", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5250616, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_distancia_aferida.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where distancia_aferida <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "distancia_aferida", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_n_registros_shape.9d239e7953": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_n_registros_shape.9d239e7953", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_n_registros_shape"], "alias": "not_null_viagem_completa_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5286489, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_n_registros_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    n_registros_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_shape.8fb346344d": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_shape", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_n_registros_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_n_registros_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_shape.8fb346344d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_n_registros_shape"], "alias": "greater_than_zero_viagem_completa_n_registros_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5319858, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_n_registros_shape.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where n_registros_shape <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_shape", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_n_registros_total.4a103f1249": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_n_registros_total.4a103f1249", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_n_registros_total"], "alias": "not_null_viagem_completa_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5354328, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_n_registros_total.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_total\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    n_registros_total is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_total.25967100b1": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_total", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_n_registros_total", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_n_registros_total.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_total.25967100b1", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_n_registros_total"], "alias": "greater_than_zero_viagem_completa_n_registros_total", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5386791, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_n_registros_total.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where n_registros_total <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_total", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_n_registros_minuto.4c23c345c5": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_n_registros_minuto.4c23c345c5", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_n_registros_minuto"], "alias": "not_null_viagem_completa_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5421417, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_n_registros_minuto.sql", "compiled": true, "compiled_code": "\nSELECT\n    n_registros_minuto\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    n_registros_minuto is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_minuto.1fa0ffac2f": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "n_registros_minuto", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_n_registros_minuto", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_n_registros_minuto.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_minuto.1fa0ffac2f", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_n_registros_minuto"], "alias": "greater_than_zero_viagem_completa_n_registros_minuto", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5454192, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_n_registros_minuto.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where n_registros_minuto <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "n_registros_minuto", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_perc_conformidade_shape.25bb80e526": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_shape", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_perc_conformidade_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_perc_conformidade_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_perc_conformidade_shape.25bb80e526", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_perc_conformidade_shape"], "alias": "not_null_viagem_completa_perc_conformidade_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5489392, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_perc_conformidade_shape.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_shape\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    perc_conformidade_shape is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_shape", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_shape.1ad412b569": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_shape", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_perc_conformidade_shape", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_perc_conformidade_shape.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_shape.1ad412b569", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_perc_conformidade_shape"], "alias": "greater_than_zero_viagem_completa_perc_conformidade_shape", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.552396, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_perc_conformidade_shape.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where perc_conformidade_shape <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_shape", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_perc_conformidade_distancia.837283bcfc": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_distancia", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_perc_conformidade_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_perc_conformidade_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_perc_conformidade_distancia.837283bcfc", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_perc_conformidade_distancia"], "alias": "not_null_viagem_completa_perc_conformidade_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5556424, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_perc_conformidade_distancia.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_distancia\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    perc_conformidade_distancia is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_distancia", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_distancia.7087a86b2d": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_distancia", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_perc_conformidade_distancia", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_perc_conformidade_distancia.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_distancia.7087a86b2d", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_perc_conformidade_distancia"], "alias": "greater_than_zero_viagem_completa_perc_conformidade_distancia", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5596435, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_perc_conformidade_distancia.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where perc_conformidade_distancia <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_distancia", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_perc_conformidade_registros.0d86da0376": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "perc_conformidade_registros", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_perc_conformidade_registros", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_perc_conformidade_registros.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_perc_conformidade_registros.0d86da0376", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_perc_conformidade_registros"], "alias": "not_null_viagem_completa_perc_conformidade_registros", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5629537, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_perc_conformidade_registros.sql", "compiled": true, "compiled_code": "\nSELECT\n    perc_conformidade_registros\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    perc_conformidade_registros is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_registros", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_registros.8cc9a28202": {"test_metadata": {"name": "greater_than_zero", "kwargs": {"column_name": "perc_conformidade_registros", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "greater_than_zero_viagem_completa_perc_conformidade_registros", "resource_type": "test", "package_name": "rj_smtr", "path": "greater_than_zero_viagem_completa_perc_conformidade_registros.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_registros.8cc9a28202", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "greater_than_zero_viagem_completa_perc_conformidade_registros"], "alias": "greater_than_zero_viagem_completa_perc_conformidade_registros", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5664499, "relation_name": null, "raw_code": "{{ test_greater_than_zero(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_greater_than_zero", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/greater_than_zero_viagem_completa_perc_conformidade_registros.sql", "compiled": true, "compiled_code": "\n\n    select *\n    from `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\n    where perc_conformidade_registros <= 0\n\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "perc_conformidade_registros", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_viagem_completa_versao_modelo.08474ee6c1": {"test_metadata": {"name": "not_null", "kwargs": {"column_name": "versao_modelo", "model": "{{ get_where_subquery(ref('viagem_completa')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_viagem_completa_versao_modelo", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_viagem_completa_versao_modelo.sql", "original_file_path": "models/projeto_subsidio_sppo/schema.yml", "unique_id": "test.rj_smtr.not_null_viagem_completa_versao_modelo.08474ee6c1", "fqn": ["rj_smtr", "projeto_subsidio_sppo", "not_null_viagem_completa_versao_modelo"], "alias": "not_null_viagem_completa_versao_modelo", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.5699449, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "viagem_completa", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.viagem_completa"]}, "compiled_path": "target-base/compiled/rj_smtr/models/projeto_subsidio_sppo/schema.yml/not_null_viagem_completa_versao_modelo.sql", "compiled": true, "compiled_code": "\nSELECT\n    versao_modelo\nFROM\n    `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`\nWHERE\n     = (SELECT MAX() FROM `rj-smtr`.`projeto_subsidio_sppo`.`viagem_completa`)\nAND\n    versao_modelo is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "versao_modelo", "file_key_name": "models.viagem_completa", "attached_node": "model.rj_smtr.viagem_completa"}, "test.rj_smtr.not_null_routes_desaninhada_route_id__data_versao.dd77dca831": {"test_metadata": {"name": "not_null", "kwargs": {"partition_column": "data_versao", "column_name": "route_id", "model": "{{ get_where_subquery(ref('routes_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_routes_desaninhada_route_id__data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_routes_desaninhada_route_id__data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.not_null_routes_desaninhada_route_id__data_versao.dd77dca831", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "not_null_routes_desaninhada_route_id__data_versao"], "alias": "not_null_routes_desaninhada_route_id__data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.79076, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "routes_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.routes_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/not_null_routes_desaninhada_route_id__data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    route_id\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`\nWHERE\n    data_versao = (SELECT MAX(data_versao) FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`)\nAND\n    route_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "route_id", "file_key_name": "models.routes_desaninhada", "attached_node": "model.rj_smtr.routes_desaninhada"}, "test.rj_smtr.unique_key_routes_desaninhada_route_id____data_versao.c670eae320": {"test_metadata": {"name": "unique_key", "kwargs": {"partition_column": "data_versao", "combined_keys": "", "column_name": "route_id", "model": "{{ get_where_subquery(ref('routes_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_key_routes_desaninhada_route_id____data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_key_routes_desaninhada_route_id____data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.unique_key_routes_desaninhada_route_id____data_versao.c670eae320", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "unique_key_routes_desaninhada_route_id____data_versao"], "alias": "unique_key_routes_desaninhada_route_id____data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.7944741, "relation_name": null, "raw_code": "{{ test_unique_key(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "routes_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_unique_key", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.routes_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/unique_key_routes_desaninhada_route_id____data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    *\nFROM (\n    SELECT\n        route_id,\n        data_versao,\n        ROW_NUMBER() over (partition by route_id) rn\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`\n    WHERE\n        data_versao = (select max(data_versao) from `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`)\n)\n\nWHERE rn>1\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "route_id", "file_key_name": "models.routes_desaninhada", "attached_node": "model.rj_smtr.routes_desaninhada"}, "test.rj_smtr.not_null_trips_desaninhada_trip_id__data_versao.bc1b38cd1a": {"test_metadata": {"name": "not_null", "kwargs": {"partition_column": "data_versao", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('trips_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_trips_desaninhada_trip_id__data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_trips_desaninhada_trip_id__data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.not_null_trips_desaninhada_trip_id__data_versao.bc1b38cd1a", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "not_null_trips_desaninhada_trip_id__data_versao"], "alias": "not_null_trips_desaninhada_trip_id__data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.8006144, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "trips_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.trips_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/not_null_trips_desaninhada_trip_id__data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    trip_id\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`\nWHERE\n    data_versao = (SELECT MAX(data_versao) FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`)\nAND\n    trip_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.trips_desaninhada", "attached_node": "model.rj_smtr.trips_desaninhada"}, "test.rj_smtr.unique_key_trips_desaninhada_trip_id____data_versao.42406b5b36": {"test_metadata": {"name": "unique_key", "kwargs": {"partition_column": "data_versao", "combined_keys": "", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('trips_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_key_trips_desaninhada_trip_id____data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_key_trips_desaninhada_trip_id____data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.unique_key_trips_desaninhada_trip_id____data_versao.42406b5b36", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "unique_key_trips_desaninhada_trip_id____data_versao"], "alias": "unique_key_trips_desaninhada_trip_id____data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.8044665, "relation_name": null, "raw_code": "{{ test_unique_key(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "trips_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_unique_key", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.trips_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/unique_key_trips_desaninhada_trip_id____data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    *\nFROM (\n    SELECT\n        trip_id,\n        data_versao,\n        ROW_NUMBER() over (partition by trip_id) rn\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`\n    WHERE\n        data_versao = (select max(data_versao) from `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`)\n)\n\nWHERE rn>1\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.trips_desaninhada", "attached_node": "model.rj_smtr.trips_desaninhada"}, "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe": {"test_metadata": {"name": "one_to_one", "kwargs": {"partition_column": "data_versao", "to_table": "ref('shapes_geom')", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('trips_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_", "resource_type": "test", "package_name": "rj_smtr", "path": "one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_"], "alias": "one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9"}, "created_at": 1727709588.807856, "relation_name": null, "raw_code": "{{ test_one_to_one(**_dbt_generic_test_kwargs) }}{{ config(alias=\"one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9\") }}", "language": "sql", "refs": [{"name": "shapes_geom", "package": null, "version": null}, {"name": "trips_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_one_to_one", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.shapes_geom", "model.rj_smtr.trips_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/one_to_one_trips_desaninhada_e671df6e46fcb072eaa6aa2f41e49cd9.sql", "compiled": true, "compiled_code": "\n\n\n\n\nwith t as (\nSELECT\n    m.trip_id from_col,\n    n.trip_id to_col\nFROM (\n    SELECT\n        trip_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`\n    WHERE data_versao = \"2022-09-12\"\n) m\nLEFT JOIN (\n    SELECT\n        trip_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n    WHERE data_versao = \"2022-08-14\"\n) n\nON m.trip_id = n.trip_id\n)\nSELECT *\nFROM (\n    SELECT\n        from_col,\n        count(to_col) ct\n    FROM t\n    GROUP BY from_col\n)\nwhere ct != 1\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.trips_desaninhada", "attached_node": "model.rj_smtr.trips_desaninhada"}, "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b": {"test_metadata": {"name": "many_to_one", "kwargs": {"foreign_key": "route_id", "partition_column": "data_versao", "to_table": "ref('routes_desaninhada')", "column_name": "route_id", "model": "{{ get_where_subquery(ref('trips_desaninhada')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_", "resource_type": "test", "package_name": "rj_smtr", "path": "many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_"], "alias": "many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6"}, "created_at": 1727709588.8155634, "relation_name": null, "raw_code": "{{ test_many_to_one(**_dbt_generic_test_kwargs) }}{{ config(alias=\"many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6\") }}", "language": "sql", "refs": [{"name": "routes_desaninhada", "package": null, "version": null}, {"name": "trips_desaninhada", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_many_to_one", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.routes_desaninhada", "model.rj_smtr.trips_desaninhada"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/many_to_one_trips_desaninhada_3fbe5d42a97a6bd72d13f98c60bdf3a6.sql", "compiled": true, "compiled_code": "with t as (\nSELECT\n    m.route_id from_col,\n    n.route_id to_col\nFROM (\n    SELECT\n        route_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`\n    WHERE data_versao = \"2022-09-12\"\n) m\nLEFT JOIN (\n    SELECT\n        route_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`routes_desaninhada`\n    WHERE data_versao = \"2022-09-12\"\n) n\nON m.route_id = n.route_id\n)\n\nSELECT\n    *\nFROM t\nWHERE to_col is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "route_id", "file_key_name": "models.trips_desaninhada", "attached_node": "model.rj_smtr.trips_desaninhada"}, "test.rj_smtr.not_null_shapes_geom_shape_id__data_versao.7a66dc45a2": {"test_metadata": {"name": "not_null", "kwargs": {"partition_column": "data_versao", "column_name": "shape_id", "model": "{{ get_where_subquery(ref('shapes_geom')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_shapes_geom_shape_id__data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_shapes_geom_shape_id__data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.not_null_shapes_geom_shape_id__data_versao.7a66dc45a2", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "not_null_shapes_geom_shape_id__data_versao"], "alias": "not_null_shapes_geom_shape_id__data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.822982, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/not_null_shapes_geom_shape_id__data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    shape_id\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\nWHERE\n    data_versao = (SELECT MAX(data_versao) FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`)\nAND\n    shape_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "shape_id", "file_key_name": "models.shapes_geom", "attached_node": "model.rj_smtr.shapes_geom"}, "test.rj_smtr.not_null_shapes_geom_trip_id__data_versao.80cc520fd9": {"test_metadata": {"name": "not_null", "kwargs": {"partition_column": "data_versao", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('shapes_geom')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "not_null_shapes_geom_trip_id__data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "not_null_shapes_geom_trip_id__data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.not_null_shapes_geom_trip_id__data_versao.80cc520fd9", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "not_null_shapes_geom_trip_id__data_versao"], "alias": "not_null_shapes_geom_trip_id__data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.8262775, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_not_null", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/not_null_shapes_geom_trip_id__data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    trip_id\nFROM\n    `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\nWHERE\n    data_versao = (SELECT MAX(data_versao) FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`)\nAND\n    trip_id is null\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.shapes_geom", "attached_node": "model.rj_smtr.shapes_geom"}, "test.rj_smtr.unique_key_shapes_geom_trip_id____data_versao.a58fed7dbf": {"test_metadata": {"name": "unique_key", "kwargs": {"partition_column": "data_versao", "combined_keys": "", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('shapes_geom')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "unique_key_shapes_geom_trip_id____data_versao", "resource_type": "test", "package_name": "rj_smtr", "path": "unique_key_shapes_geom_trip_id____data_versao.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.unique_key_shapes_geom_trip_id____data_versao.a58fed7dbf", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "unique_key_shapes_geom_trip_id____data_versao"], "alias": "unique_key_shapes_geom_trip_id____data_versao", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {}, "created_at": 1727709588.8303556, "relation_name": null, "raw_code": "{{ test_unique_key(**_dbt_generic_test_kwargs) }}", "language": "sql", "refs": [{"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_unique_key", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/unique_key_shapes_geom_trip_id____data_versao.sql", "compiled": true, "compiled_code": "\nSELECT\n    *\nFROM (\n    SELECT\n        trip_id,\n        data_versao,\n        ROW_NUMBER() over (partition by trip_id) rn\n    FROM\n        `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n    WHERE\n        data_versao = (select max(data_versao) from `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`)\n)\n\nWHERE rn>1\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.shapes_geom", "attached_node": "model.rj_smtr.shapes_geom"}, "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d": {"test_metadata": {"name": "one_to_one", "kwargs": {"partition_column": "data_versao", "to_table": "ref('trips_desaninhada')", "column_name": "trip_id", "model": "{{ get_where_subquery(ref('shapes_geom')) }}"}, "namespace": null}, "database": "rj-smtr", "schema": "dbt_test__audit", "name": "one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_", "resource_type": "test", "package_name": "rj_smtr", "path": "one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818.sql", "original_file_path": "models/br_rj_riodejaneiro_sigmob/schema.yaml", "unique_id": "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d", "fqn": ["rj_smtr", "br_rj_riodejaneiro_sigmob", "one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_"], "alias": "one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": "one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818", "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"alias": "one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818"}, "created_at": 1727709588.8338428, "relation_name": null, "raw_code": "{{ test_one_to_one(**_dbt_generic_test_kwargs) }}{{ config(alias=\"one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818\") }}", "language": "sql", "refs": [{"name": "trips_desaninhada", "package": null, "version": null}, {"name": "shapes_geom", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.rj_smtr.test_one_to_one", "macro.dbt.get_where_subquery"], "nodes": ["model.rj_smtr.trips_desaninhada", "model.rj_smtr.shapes_geom"]}, "compiled_path": "target-base/compiled/rj_smtr/models/br_rj_riodejaneiro_sigmob/schema.yaml/one_to_one_shapes_geom_084f9b960b15216e27d564b483a50818.sql", "compiled": true, "compiled_code": "\n\n\n\n\nwith t as (\nSELECT\n    m.trip_id from_col,\n    n.trip_id to_col\nFROM (\n    SELECT\n        trip_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`shapes_geom`\n    WHERE data_versao = \"2022-08-14\"\n) m\nLEFT JOIN (\n    SELECT\n        trip_id\n    FROM `rj-smtr`.`br_rj_riodejaneiro_sigmob`.`trips_desaninhada`\n    WHERE data_versao = \"2022-09-12\"\n) n\nON m.trip_id = n.trip_id\n)\nSELECT *\nFROM (\n    SELECT\n        from_col,\n        count(to_col) ct\n    FROM t\n    GROUP BY from_col\n)\nwhere ct != 1\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "trip_id", "file_key_name": "models.shapes_geom", "attached_node": "model.rj_smtr.shapes_geom"}}, "sources": {"source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "transacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "transacao"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "transacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao`", "created_at": 1727709588.8434107}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "transacao_riocard", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "transacao_riocard"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "transacao_riocard", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`transacao_riocard`", "created_at": 1727709588.8435984}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "linha", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "linha"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "linha", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha`", "created_at": 1727709588.843756}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "dicionario", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "dicionario"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "dicionario", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`dicionario`", "created_at": 1727709588.8439107}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "consorcio", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "consorcio"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "consorcio", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`consorcio`", "created_at": 1727709588.8440602}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "operadora_transporte", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "operadora_transporte"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "operadora_transporte", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`operadora_transporte`", "created_at": 1727709588.8445287}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "ordem_pagamento", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "ordem_pagamento", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento`", "created_at": 1727709588.8446963}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "ordem_ressarcimento", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "ordem_ressarcimento"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "ordem_ressarcimento", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_ressarcimento`", "created_at": 1727709588.8448505}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "conta_bancaria", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "conta_bancaria"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "conta_bancaria", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`conta_bancaria`", "created_at": 1727709588.845001}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "contato_pessoa_juridica", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "contato_pessoa_juridica"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "contato_pessoa_juridica", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`contato_pessoa_juridica`", "created_at": 1727709588.8451495}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "cliente", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "cliente"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "cliente", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`cliente`", "created_at": 1727709588.845299}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "percentual_rateio_integracao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "percentual_rateio_integracao"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "percentual_rateio_integracao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`percentual_rateio_integracao`", "created_at": 1727709588.8454463}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "integracao_transacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "integracao_transacao"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "integracao_transacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`integracao_transacao`", "created_at": 1727709588.8455935}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.tipo_modal": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "tipo_modal", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.tipo_modal", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "tipo_modal"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "tipo_modal", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`tipo_modal`", "created_at": 1727709588.84574}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "gps_validador", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "gps_validador"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "gps_validador", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`gps_validador`", "created_at": 1727709588.8458865}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "gratuidade", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "gratuidade"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "gratuidade", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`gratuidade`", "created_at": 1727709588.8460345}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "ordem_rateio", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "ordem_rateio"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "ordem_rateio", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_rateio`", "created_at": 1727709588.8461802}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "servico_motorista", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "servico_motorista"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "servico_motorista", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`servico_motorista`", "created_at": 1727709588.8463254}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "linha_sem_ressarcimento", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "linha_sem_ressarcimento"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "linha_sem_ressarcimento", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_sem_ressarcimento`", "created_at": 1727709588.8464706}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "ordem_pagamento_consorcio_operadora", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento_consorcio_operadora"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "ordem_pagamento_consorcio_operadora", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio_operadora`", "created_at": 1727709588.8466132}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "ordem_pagamento_consorcio", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "ordem_pagamento_consorcio"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "ordem_pagamento_consorcio", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`ordem_pagamento_consorcio`", "created_at": 1727709588.8467546}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "linha_consorcio", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "linha_consorcio"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "linha_consorcio", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio`", "created_at": 1727709588.8468947}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "linha_consorcio_operadora_transporte", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "linha_consorcio_operadora_transporte"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "linha_consorcio_operadora_transporte", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`linha_consorcio_operadora_transporte`", "created_at": 1727709588.8470352}, "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_bilhetagem_staging", "name": "endereco", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco", "fqn": ["rj_smtr", "br_rj_riodejaneiro_bilhetagem_staging", "endereco"], "source_name": "br_rj_riodejaneiro_bilhetagem_staging", "source_description": "", "loader": "", "identifier": "endereco", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_bilhetagem_staging`.`endereco`", "created_at": 1727709588.8471746}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "agency", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "agency"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "agency", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`agency`", "created_at": 1727709588.8473232}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "calendar", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "calendar"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "calendar", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`calendar`", "created_at": 1727709588.8474677}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "calendar_dates", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "calendar_dates"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "calendar_dates", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`calendar_dates`", "created_at": 1727709588.8476117}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "fare_attributes", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "fare_attributes"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "fare_attributes", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`fare_attributes`", "created_at": 1727709588.8477557}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "fare_rules", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "fare_rules"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "fare_rules", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`fare_rules`", "created_at": 1727709588.847899}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "feed_info", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "feed_info"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "feed_info", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`feed_info`", "created_at": 1727709588.8480415}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "frequencies", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "frequencies"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "frequencies", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`frequencies`", "created_at": 1727709588.8481848}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "routes", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "routes"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "routes", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`routes`", "created_at": 1727709588.8483262}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "shapes", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "shapes"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "shapes", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`shapes`", "created_at": 1727709588.848466}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "stops", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "stops"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "stops", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`stops`", "created_at": 1727709588.8486063}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "stop_times", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "stop_times"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "stop_times", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`stop_times`", "created_at": 1727709588.8487458}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "trips", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "trips"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "trips", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`trips`", "created_at": 1727709588.848884}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "ordem_servico", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "ordem_servico"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "ordem_servico", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico`", "created_at": 1727709588.8490226}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "ordem_servico_trajeto_alternativo", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "ordem_servico_trajeto_alternativo"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "ordem_servico_trajeto_alternativo", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico_trajeto_alternativo`", "created_at": 1727709588.849165}, "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_gtfs_staging", "name": "ordem_servico_faixa_horaria", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria", "fqn": ["rj_smtr", "br_rj_riodejaneiro_gtfs_staging", "ordem_servico_faixa_horaria"], "source_name": "br_rj_riodejaneiro_gtfs_staging", "source_description": "", "loader": "", "identifier": "ordem_servico_faixa_horaria", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_gtfs_staging`.`ordem_servico_faixa_horaria`", "created_at": 1727709588.849306}, "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_stu_staging", "name": "operadora_empresa", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa", "fqn": ["rj_smtr", "br_rj_riodejaneiro_stu_staging", "operadora_empresa"], "source_name": "br_rj_riodejaneiro_stu_staging", "source_description": "", "loader": "", "identifier": "operadora_empresa", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_stu_staging`.`operadora_empresa`", "created_at": 1727709588.8494482}, "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_stu_staging", "name": "operadora_pessoa_fisica", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica", "fqn": ["rj_smtr", "br_rj_riodejaneiro_stu_staging", "operadora_pessoa_fisica"], "source_name": "br_rj_riodejaneiro_stu_staging", "source_description": "", "loader": "", "identifier": "operadora_pessoa_fisica", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_stu_staging`.`operadora_pessoa_fisica`", "created_at": 1727709588.8495903}, "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_viagens_individuais", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_viagens_individuais"], "source_name": "br_rj_riodejaneiro_recursos_staging", "source_description": "", "loader": "", "identifier": "recursos_sppo_viagens_individuais", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_viagens_individuais`", "created_at": 1727709588.8497334}, "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_bloqueio_via", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_bloqueio_via"], "source_name": "br_rj_riodejaneiro_recursos_staging", "source_description": "", "loader": "", "identifier": "recursos_sppo_bloqueio_via", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_bloqueio_via`", "created_at": 1727709588.8498752}, "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_reprocessamento", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_reprocessamento"], "source_name": "br_rj_riodejaneiro_recursos_staging", "source_description": "", "loader": "", "identifier": "recursos_sppo_reprocessamento", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_reprocessamento`", "created_at": 1727709588.850019}, "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_servico_dia_avaliacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_servico_dia_avaliacao"], "source_name": "br_rj_riodejaneiro_recursos_staging", "source_description": "", "loader": "", "identifier": "recursos_sppo_servico_dia_avaliacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_servico_dia_avaliacao`", "created_at": 1727709588.8501604}, "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_recursos_staging", "name": "recursos_sppo_servico_dia_pago", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago", "fqn": ["rj_smtr", "br_rj_riodejaneiro_recursos_staging", "recursos_sppo_servico_dia_pago"], "source_name": "br_rj_riodejaneiro_recursos_staging", "source_description": "", "loader": "", "identifier": "recursos_sppo_servico_dia_pago", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_recursos_staging`.`recursos_sppo_servico_dia_pago`", "created_at": 1727709588.8503017}, "source.rj_smtr.cadastro.modos": {"database": "rj-smtr", "schema": "cadastro", "name": "modos", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.cadastro.modos", "fqn": ["rj_smtr", "cadastro", "modos"], "source_name": "cadastro", "source_description": "", "loader": "", "identifier": "modos", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`cadastro`.`modos`", "created_at": 1727709588.850441}, "source.rj_smtr.cadastro_staging.consorcio_modo": {"database": "rj-smtr", "schema": "cadastro_staging", "name": "consorcio_modo", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.cadastro_staging.consorcio_modo", "fqn": ["rj_smtr", "cadastro_staging", "consorcio_modo"], "source_name": "cadastro_staging", "source_description": "", "loader": "", "identifier": "consorcio_modo", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`cadastro_staging`.`consorcio_modo`", "created_at": 1727709588.8505816}, "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_rdo_staging", "name": "rho_registros_sppo", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo_staging", "rho_registros_sppo"], "source_name": "br_rj_riodejaneiro_rdo_staging", "source_description": "", "loader": "", "identifier": "rho_registros_sppo", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_rdo_staging`.`rho_registros_sppo`", "created_at": 1727709588.8507204}, "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_rdo_staging", "name": "rho5_registros_stpl", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo_staging", "rho5_registros_stpl"], "source_name": "br_rj_riodejaneiro_rdo_staging", "source_description": "", "loader": "", "identifier": "rho5_registros_stpl", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_rdo_staging`.`rho5_registros_stpl`", "created_at": 1727709588.8508584}, "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo", "name": "rdo40_tratado", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo", "rdo40_tratado"], "source_name": "br_rj_riodejaneiro_rdo", "source_description": "", "loader": "", "identifier": "rdo40_tratado", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_tratado`", "created_at": 1727709588.851028}, "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_registros_sppo": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_rdo", "name": "rdo40_registros_sppo", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_registros_sppo", "fqn": ["rj_smtr", "br_rj_riodejaneiro_rdo", "rdo40_registros_sppo"], "source_name": "br_rj_riodejaneiro_rdo", "source_description": "", "loader": "", "identifier": "rdo40_registros_sppo", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros_sppo`", "created_at": 1727709588.8511717}, "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km": {"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "parametros_km", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "parametros_km"], "source_name": "projeto_subsidio_sppo_encontro_contas", "source_description": "", "loader": "", "identifier": "parametros_km", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`parametros_km`", "created_at": 1727709588.8513162}, "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_2023", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023", "fqn": ["rj_smtr", "veiculo_staging", "sppo_vistoria_tr_subtt_cglf_2023"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_vistoria_tr_subtt_cglf_2023", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2023`", "created_at": 1727709588.8514569}, "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_2024", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024", "fqn": ["rj_smtr", "veiculo_staging", "sppo_vistoria_tr_subtt_cglf_2024"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_vistoria_tr_subtt_cglf_2024", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_2024`", "created_at": 1727709588.8515952}, "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_vistoria_tr_subtt_cglf_pendentes_2024", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024", "fqn": ["rj_smtr", "veiculo_staging", "sppo_vistoria_tr_subtt_cglf_pendentes_2024"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_vistoria_tr_subtt_cglf_pendentes_2024", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_vistoria_tr_subtt_cglf_pendentes_2024`", "created_at": 1727709588.8517327}, "source.rj_smtr.veiculo_staging.sppo_registro_agente_verao": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_registro_agente_verao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_registro_agente_verao", "fqn": ["rj_smtr", "veiculo_staging", "sppo_registro_agente_verao"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_registro_agente_verao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_registro_agente_verao`", "created_at": 1727709588.851871}, "source.rj_smtr.veiculo_staging.sppo_infracao": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_infracao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_infracao", "fqn": ["rj_smtr", "veiculo_staging", "sppo_infracao"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_infracao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_infracao`", "created_at": 1727709588.8520098}, "source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_licenciamento_solicitacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao", "fqn": ["rj_smtr", "veiculo_staging", "sppo_licenciamento_solicitacao"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_licenciamento_solicitacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_licenciamento_solicitacao`", "created_at": 1727709588.8521464}, "source.rj_smtr.veiculo_staging.sppo_licenciamento": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_licenciamento", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_licenciamento", "fqn": ["rj_smtr", "veiculo_staging", "sppo_licenciamento"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_licenciamento", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_licenciamento`", "created_at": 1727709588.8522832}, "source.rj_smtr.veiculo_staging.sppo_licenciamento_stu": {"database": "rj-smtr-staging", "schema": "veiculo_staging", "name": "sppo_licenciamento_stu", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.veiculo_staging.sppo_licenciamento_stu", "fqn": ["rj_smtr", "veiculo_staging", "sppo_licenciamento_stu"], "source_name": "veiculo_staging", "source_description": "", "loader": "", "identifier": "sppo_licenciamento_stu", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`veiculo_staging`.`sppo_licenciamento_stu`", "created_at": 1727709588.8524194}, "source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem": {"database": "rj-smtr-staging", "schema": "dashboard_subsidio_sppo_staging", "name": "subsidio_valor_km_tipo_viagem", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem", "fqn": ["rj_smtr", "dashboard_subsidio_sppo_staging", "subsidio_valor_km_tipo_viagem"], "source_name": "dashboard_subsidio_sppo_staging", "source_description": "", "loader": "", "identifier": "subsidio_valor_km_tipo_viagem", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`dashboard_subsidio_sppo_staging`.`subsidio_valor_km_tipo_viagem`", "created_at": 1727709588.8525581}, "source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae": {"database": "rj-smtr-staging", "schema": "dashboard_controle_vinculo_jae_riocard_staging", "name": "relatorio_instalacao_jae", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae", "fqn": ["rj_smtr", "dashboard_controle_vinculo_jae_riocard_staging", "relatorio_instalacao_jae"], "source_name": "dashboard_controle_vinculo_jae_riocard_staging", "source_description": "", "loader": "", "identifier": "relatorio_instalacao_jae", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`dashboard_controle_vinculo_jae_riocard_staging`.`relatorio_instalacao_jae`", "created_at": 1727709588.852701}, "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_onibus_gps_zirix_staging", "name": "registros", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix_staging", "registros"], "source_name": "br_rj_riodejaneiro_onibus_gps_zirix_staging", "source_description": "", "loader": "", "identifier": "registros", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_onibus_gps_zirix_staging`.`registros`", "created_at": 1727709588.8528414}, "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_onibus_gps_zirix_staging", "name": "realocacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao", "fqn": ["rj_smtr", "br_rj_riodejaneiro_onibus_gps_zirix_staging", "realocacao"], "source_name": "br_rj_riodejaneiro_onibus_gps_zirix_staging", "source_description": "", "loader": "", "identifier": "realocacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_onibus_gps_zirix_staging`.`realocacao`", "created_at": 1727709588.852982}, "source.rj_smtr.controle_financeiro_staging.cb": {"database": "rj-smtr-staging", "schema": "controle_financeiro_staging", "name": "cb", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.controle_financeiro_staging.cb", "fqn": ["rj_smtr", "controle_financeiro_staging", "cb"], "source_name": "controle_financeiro_staging", "source_description": "", "loader": "", "identifier": "cb", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`controle_financeiro_staging`.`cb`", "created_at": 1727709588.8531237}, "source.rj_smtr.controle_financeiro_staging.cett": {"database": "rj-smtr-staging", "schema": "controle_financeiro_staging", "name": "cett", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.controle_financeiro_staging.cett", "fqn": ["rj_smtr", "controle_financeiro_staging", "cett"], "source_name": "controle_financeiro_staging", "source_description": "", "loader": "", "identifier": "cett", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`controle_financeiro_staging`.`cett`", "created_at": 1727709588.8532643}, "source.rj_smtr.controle_financeiro_staging.arquivo_retorno": {"database": "rj-smtr-staging", "schema": "controle_financeiro_staging", "name": "arquivo_retorno", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.controle_financeiro_staging.arquivo_retorno", "fqn": ["rj_smtr", "controle_financeiro_staging", "arquivo_retorno"], "source_name": "controle_financeiro_staging", "source_description": "", "loader": "", "identifier": "arquivo_retorno", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`controle_financeiro_staging`.`arquivo_retorno`", "created_at": 1727709588.8534048}, "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.rdo_correcao_rioonibus_servico_quinzena": {"database": "rj-smtr-staging", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "rdo_correcao_rioonibus_servico_quinzena", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.rdo_correcao_rioonibus_servico_quinzena", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "rdo_correcao_rioonibus_servico_quinzena"], "source_name": "projeto_subsidio_sppo_encontro_contas", "source_description": "", "loader": "", "identifier": "rdo_correcao_rioonibus_servico_quinzena", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`projeto_subsidio_sppo_encontro_contas`.`rdo_correcao_rioonibus_servico_quinzena`", "created_at": 1727709588.8535452}, "source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9": {"database": "rj-smtr", "schema": "br_rj_riodejaneiro_geo", "name": "h3_res9", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9", "fqn": ["rj_smtr", "br_rj_riodejaneiro_geo", "h3_res9"], "source_name": "br_rj_riodejaneiro_geo", "source_description": "", "loader": "", "identifier": "h3_res9", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr`.`br_rj_riodejaneiro_geo`.`h3_res9`", "created_at": 1727709588.8536863}, "source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada": {"database": "rj-smtr-staging", "schema": "br_rj_riodejaneiro_viagem_zirix_staging", "name": "viagem_informada", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada", "fqn": ["rj_smtr", "br_rj_riodejaneiro_viagem_zirix_staging", "viagem_informada"], "source_name": "br_rj_riodejaneiro_viagem_zirix_staging", "source_description": "", "loader": "", "identifier": "viagem_informada", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`br_rj_riodejaneiro_viagem_zirix_staging`.`viagem_informada`", "created_at": 1727709588.8538249}, "source.rj_smtr.infracao_staging.autuacoes_citran": {"database": "rj-smtr-staging", "schema": "infracao_staging", "name": "autuacoes_citran", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.infracao_staging.autuacoes_citran", "fqn": ["rj_smtr", "infracao_staging", "autuacoes_citran"], "source_name": "infracao_staging", "source_description": "", "loader": "", "identifier": "autuacoes_citran", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`infracao_staging`.`autuacoes_citran`", "created_at": 1727709588.8539634}, "source.rj_smtr.infracao_staging.receita_autuacao": {"database": "rj-smtr-staging", "schema": "infracao_staging", "name": "receita_autuacao", "resource_type": "source", "package_name": "rj_smtr", "path": "models/sources.yml", "original_file_path": "models/sources.yml", "unique_id": "source.rj_smtr.infracao_staging.receita_autuacao", "fqn": ["rj_smtr", "infracao_staging", "receita_autuacao"], "source_name": "infracao_staging", "source_description": "", "loader": "", "identifier": "receita_autuacao", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true}, "patch_path": null, "unrendered_config": {}, "relation_name": "`rj-smtr-staging`.`infracao_staging`.`receita_autuacao`", "created_at": 1727709588.854101}}, "macros": {"macro.rj_smtr.test_one_to_one": {"name": "test_one_to_one", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/one_to_one.sql", "original_file_path": "macros/one_to_one.sql", "unique_id": "macro.rj_smtr.test_one_to_one", "macro_sql": "{% test one_to_one(model, column_name, partition_column, to_table) %}\n{% if execute %}\n{% set model_max_partition = run_query('SELECT MAX('~partition_column~') FROM '~model).columns[0].values()[0] %}\n{% set to_table_max_partition = run_query('SELECT MAX('~partition_column~') FROM '~to_table).columns[0].values()[0] %}\n{% endif %}\nwith t as (\nSELECT\n    m.{{column_name}} from_col,\n    n.{{column_name}} to_col\nFROM (\n    SELECT\n        {{column_name}}\n    FROM {{model}}\n    WHERE {{partition_column}} = \"{{model_max_partition}}\"\n) m\nLEFT JOIN (\n    SELECT\n        {{column_name}}\n    FROM {{to_table}}\n    WHERE {{partition_column}} = \"{{to_table_max_partition}}\"\n) n\nON m.{{column_name}} = n.{{column_name}}\n)\nSELECT *\nFROM (\n    SELECT\n        from_col,\n        count(to_col) ct\n    FROM t\n    GROUP BY from_col\n)\nwhere ct != 1\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5025272, "supported_languages": null}, "macro.rj_smtr.generate_schema_name": {"name": "generate_schema_name", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/generate_schema_name.sql", "original_file_path": "macros/generate_schema_name.sql", "unique_id": "macro.rj_smtr.generate_schema_name", "macro_sql": "{% macro generate_schema_name(custom_schema_name, node) -%}\n\n    {%- set default_schema = target.schema -%}\n    {%- if custom_schema_name is none -%}\n\n        {% set schema_name = default_schema %}\n\n    {%- else -%}\n\n        {% set schema_name = custom_schema_name | trim %}\n\n    {%- endif -%}\n\n    {% if target.name == \"dev\" %}\n        {% set schema_name = env_var(\"DBT_USER\") + \"__\" + schema_name %}\n    {% endif %}\n\n    {% if target.name == \"hmg\" and schema_name.endswith(\"_staging\") %}\n        {% set schema_name = schema_name + \"_dbt\" %}\n    {% endif %}\n\n    {{ schema_name }}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.504023, "supported_languages": null}, "macro.rj_smtr.test_many_to_one": {"name": "test_many_to_one", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/many_to_one.sql", "original_file_path": "macros/many_to_one.sql", "unique_id": "macro.rj_smtr.test_many_to_one", "macro_sql": "{% test many_to_one(model, column_name, foreign_key, partition_column, to_table) %}\n{%- if execute -%}\n{%- set model_max_partition = run_query('SELECT MAX('~partition_column~') FROM '~model).columns[0].values()[0] -%}\n{%- set to_table_max_partition = run_query('SELECT MAX('~partition_column~') FROM '~to_table).columns[0].values()[0] -%}\n{%- endif -%}\nwith t as (\nSELECT\n    m.{{column_name}} from_col,\n    n.{{column_name}} to_col\nFROM (\n    SELECT\n        {{column_name}}\n    FROM {{model}}\n    WHERE {{partition_column}} = \"{{model_max_partition}}\"\n) m\nLEFT JOIN (\n    SELECT\n        {{column_name}}\n    FROM {{to_table}}\n    WHERE {{partition_column}} = \"{{to_table_max_partition}}\"\n) n\nON m.{{column_name}} = n.{{column_name}}\n)\n\nSELECT\n    *\nFROM t\nWHERE to_col is null\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5056365, "supported_languages": null}, "macro.rj_smtr.get_license_date": {"name": "get_license_date", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/get_license_date.sql", "original_file_path": "macros/get_license_date.sql", "unique_id": "macro.rj_smtr.get_license_date", "macro_sql": "{% macro get_license_date() %}\nSELECT\n  CASE\n    {% if var(\"stu_data_versao\") != \"\" %}\n    WHEN \"{{ var('stu_data_versao') }}\" != \"\" THEN DATE(\"{{ var('stu_data_versao') }}\")\n    {% endif %}\n    --- Vers\u00e3o fixa do STU em 2024-03-25 para mar/Q1 devido \u00e0 falha de atualiza\u00e7\u00e3o na fonte da dados (SIURB)\n    WHEN DATE(\"{{ var('run_date') }}\") >= \"2024-03-01\" AND DATE(\"{{ var('run_date') }}\") < \"2024-03-16\" THEN DATE(\"2024-03-25\")\n    -- Vers\u00e3o fixa do STU em 2024-04-09 para mar/Q2 devido \u00e0 falha de atualiza\u00e7\u00e3o na fonte da dados (SIURB)\n    WHEN DATE(\"{{ var('run_date') }}\") >= \"2024-03-16\" AND DATE(\"{{ var('run_date') }}\") < \"2024-04-01\" THEN DATE(\"2024-04-09\")\n    ELSE (\n      SELECT MIN(DATE(data))\n      FROM {{ ref(\"sppo_licenciamento_stu_staging\") }}\n      WHERE DATE(data) >= DATE_ADD(DATE(\"{{ var('run_date') }}\"), INTERVAL 5 DAY)\n        -- Admite apenas vers\u00f5es do STU igual ou ap\u00f3s 2024-04-09 a partir de abril/24 devido \u00e0 falha de atualiza\u00e7\u00e3o na fonte da dados (SIURB)\n        AND (DATE(\"{{ var('run_date') }}\") < \"2024-04-01\" OR DATE(data) >= '2024-04-09')\n    )\n  END\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5071223, "supported_languages": null}, "macro.rj_smtr.test_not_null": {"name": "test_not_null", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/not_null.sql", "original_file_path": "macros/not_null.sql", "unique_id": "macro.rj_smtr.test_not_null", "macro_sql": "{%test not_null(model, column_name, partition_column)%}\nSELECT\n    {{column_name}}\nFROM\n    {{model}}\nWHERE\n    {{partition_column}} = (SELECT MAX({{partition_column}}) FROM {{model}})\nAND\n    {{column_name}} is null\n{%endtest%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5076575, "supported_languages": null}, "macro.rj_smtr.generate_database_name": {"name": "generate_database_name", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/generate_database_name.sql", "original_file_path": "macros/generate_database_name.sql", "unique_id": "macro.rj_smtr.generate_database_name", "macro_sql": "{% macro generate_database_name(custom_database_name=none, node=none) -%}\n\n    {%- set default_database = target.database -%}\n    {% set dev_database = \"rj-smtr-dev\" %}\n    {%- if custom_database_name is none -%}\n\n        {% if target.name in (\"dev\", \"hmg\") %}\n\n            {{ dev_database }}\n\n        {% else %}\n\n            {{ default_database }}\n\n        {% endif %}\n\n    {%- else -%}\n\n        {{ custom_database_name | trim }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.508685, "supported_languages": null}, "macro.rj_smtr.test_unique_key": {"name": "test_unique_key", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/unique_key.sql", "original_file_path": "macros/unique_key.sql", "unique_id": "macro.rj_smtr.test_unique_key", "macro_sql": "{% test unique_key(model, column_name, partition_column, combined_keys) %}\nSELECT\n    *\nFROM (\n    SELECT\n        {{ column_name }},\n        {{ partition_column }},\n        ROW_NUMBER() over (partition by {{(column_name~\",\"~combined_keys|join(',')) if combined_keys != \"\" else column_name}}) rn\n    FROM\n        {{ model }}\n    WHERE\n        {{ partition_column }} = (select max({{ partition_column }}) from {{ model }})\n)\n\nWHERE rn>1\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.509535, "supported_languages": null}, "macro.rj_smtr.get_models_with_tags": {"name": "get_models_with_tags", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/get_models_with_tags.sql", "original_file_path": "macros/get_models_with_tags.sql", "unique_id": "macro.rj_smtr.get_models_with_tags", "macro_sql": "{% macro get_models_with_tags(tags) %}\n\n{% set models_with_tag = [] %}\n\n{% for model in graph.nodes.values() | selectattr(\"resource_type\", \"equalto\", \"model\") %}\n\n    {% for tag in tags %}\n        {% if tag in model.config.tags %}\n            {{ models_with_tag.append(model) }}\n        {% endif %}\n    {% endfor %}\n\n{% endfor %}\n\n{{ return(models_with_tag) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5106394, "supported_languages": null}, "macro.rj_smtr.get_last_feed_start_date": {"name": "get_last_feed_start_date", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/get_last_feed_start_date.sql", "original_file_path": "macros/get_last_feed_start_date.sql", "unique_id": "macro.rj_smtr.get_last_feed_start_date", "macro_sql": "{% macro get_last_feed_start_date(data_versao_gtfs) %}\n  {{ return(run_query(\"SELECT MAX(feed_start_date) FROM \" ~ ref('feed_info_gtfs') ~ \" WHERE feed_start_date < \" ~ \"'\" ~ data_versao_gtfs ~ \"'\").columns[0].values()[0]) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.511255, "supported_languages": null}, "macro.rj_smtr.test_not_negative": {"name": "test_not_negative", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/test_not_negative.sql", "original_file_path": "macros/test_not_negative.sql", "unique_id": "macro.rj_smtr.test_not_negative", "macro_sql": "{% test not_negative(model, column_name) %}\n\n    select *\n    from {{ model }}\n    where {{ column_name }} < 0\n\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5115976, "supported_languages": null}, "macro.rj_smtr.test_greater_than_zero": {"name": "test_greater_than_zero", "resource_type": "macro", "package_name": "rj_smtr", "path": "macros/test_greater_than_zero.sql", "original_file_path": "macros/test_greater_than_zero.sql", "unique_id": "macro.rj_smtr.test_greater_than_zero", "macro_sql": "{% test greater_than_zero(model, column_name) %}\n\n    select *\n    from {{ model }}\n    where {{ column_name }} <= 0\n\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5119262, "supported_languages": null}, "macro.rj_smtr.test_unique_relation": {"name": "test_unique_relation", "resource_type": "macro", "package_name": "rj_smtr", "path": "tests/generic/unique_relation.sql", "original_file_path": "tests/generic/unique_relation.sql", "unique_id": "macro.rj_smtr.test_unique_relation", "macro_sql": "{% test unique_relation(model, column_name, partition_column, relation_field) %}\nSELECT *\nFROM (\n    SELECT\n        {{ column_name }},\n        {{ partition_column}},\n        COUNT({{ relation_field }}) ct\n    FROM {{ model }}\n    WHERE\n        {{ partition_column }} = (select max({{ partition_column }}) from {{ model }})\n    GROUP BY 1, 2\n)\nWHERE ct != 1\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5125587, "supported_languages": null}, "macro.rj_smtr.test_contained": {"name": "test_contained", "resource_type": "macro", "package_name": "rj_smtr", "path": "tests/generic/contained.sql", "original_file_path": "tests/generic/contained.sql", "unique_id": "macro.rj_smtr.test_contained", "macro_sql": "{% test contained(model, column_name, in, field) %}\nselect *\nfrom (\n    SELECT DISTINCT\n        {{ column_name }} contained,\n        _contains\n    FROM {{model}}\n    LEFT JOIN (\n        SELECT DISTINCT\n            {{ field }} _contains\n        FROM {{ in }}\n    )\n    ON {{column_name }} = _contains\n)\nwhere _contains is null\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.513096, "supported_languages": null}, "macro.rj_smtr.test_unique_by_date": {"name": "test_unique_by_date", "resource_type": "macro", "package_name": "rj_smtr", "path": "tests/generic/unique_by_date.sql", "original_file_path": "tests/generic/unique_by_date.sql", "unique_id": "macro.rj_smtr.test_unique_by_date", "macro_sql": "{% test unique_by_date(model, column_name, date_column_name) %}\nSELECT\n    *\nFROM (\n    SELECT\n        {{ column_name }},\n        {{ date_column_name }},\n        ROW_NUMBER() over (partition by {{ column_name }}, {{ date_column_name }}) rn\n    FROM\n        {{ model }}\n    WHERE\n        {{ date_column_name }} = (select max({{ date_column_name }}) from {{ model }})\n)\n\nWHERE rn>1\n{% endtest %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.513844, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_table_as": {"name": "bigquery__create_table_as", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_table_as", "macro_sql": "{% macro bigquery__create_table_as(temporary, relation, compiled_code, language='sql') -%}\n  {%- if language == 'sql' -%}\n    {%- set raw_partition_by = config.get('partition_by', none) -%}\n    {%- set raw_cluster_by = config.get('cluster_by', none) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {%- set partition_config = adapter.parse_partition_by(raw_partition_by) -%}\n    {%- if partition_config.time_ingestion_partitioning -%}\n    {%- set columns = get_columns_with_types_in_query_sql(sql) -%}\n    {%- set table_dest_columns_csv = columns_without_partition_fields_csv(partition_config, columns) -%}\n    {%- set columns = '(' ~ table_dest_columns_csv ~ ')' -%}\n    {%- endif -%}\n\n    {{ sql_header if sql_header is not none }}\n\n    create or replace table {{ relation }}\n      {%- set contract_config = config.get('contract') -%}\n      {%- if contract_config.enforced -%}\n        {{ get_assert_columns_equivalent(compiled_code) }}\n        {{ get_table_columns_and_constraints() }}\n        {%- set compiled_code = get_select_subquery(compiled_code) %}\n      {% else %}\n        {#-- cannot do contracts at the same time as time ingestion partitioning -#}\n        {{ columns }}\n      {% endif %}\n    {{ partition_by(partition_config) }}\n    {{ cluster_by(raw_cluster_by) }}\n\n    {{ bigquery_table_options(config, model, temporary) }}\n\n    {#-- PARTITION BY cannot be used with the AS query_statement clause.\n         https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#partition_expression\n    -#}\n    {%- if not partition_config.time_ingestion_partitioning %}\n    as (\n      {{ compiled_code }}\n    );\n    {%- endif %}\n  {%- elif language == 'python' -%}\n    {#--\n    N.B. Python models _can_ write to temp views HOWEVER they use a different session\n    and have already expired by the time they need to be used (I.E. in merges for incremental models)\n\n    TODO: Deep dive into spark sessions to see if we can reuse a single session for an entire\n    dbt invocation.\n     --#}\n\n    {#-- when a user wants to change the schema of an existing relation, they must intentionally drop the table in the dataset --#}\n    {%- set old_relation = adapter.get_relation(database=relation.database, schema=relation.schema, identifier=relation.identifier) -%}\n    {%- if (old_relation.is_table and (should_full_refresh())) -%}\n      {% do adapter.drop_relation(relation) %}\n    {%- endif -%}\n    {{ py_write_table(compiled_code=compiled_code, target_relation=relation.quote(database=False, schema=False, identifier=False)) }}\n  {%- else -%}\n    {% do exceptions.raise_compiler_error(\"bigquery__create_table_as macro didn't get supported language, it got %s\" % language) %}\n  {%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_bigquery.get_columns_with_types_in_query_sql", "macro.dbt_bigquery.columns_without_partition_fields_csv", "macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_table_columns_and_constraints", "macro.dbt.get_select_subquery", "macro.dbt_bigquery.partition_by", "macro.dbt_bigquery.cluster_by", "macro.dbt_bigquery.bigquery_table_options", "macro.dbt.should_full_refresh", "macro.dbt_bigquery.py_write_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5200908, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_view_as": {"name": "bigquery__create_view_as", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_view_as", "macro_sql": "{% macro bigquery__create_view_as(relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create or replace view {{ relation }}\n  {{ bigquery_view_options(config, model) }}\n  {%- set contract_config = config.get('contract') -%}\n  {%- if contract_config.enforced -%}\n    {{ get_assert_columns_equivalent(sql) }}\n  {%- endif %}\n  as {{ sql }};\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery_view_options", "macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5209715, "supported_languages": null}, "macro.dbt_bigquery.bigquery__drop_schema": {"name": "bigquery__drop_schema", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__drop_schema", "macro_sql": "{% macro bigquery__drop_schema(relation) -%}\n  {{ adapter.drop_schema(relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.521229, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_columns_in_relation": {"name": "bigquery__get_columns_in_relation", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_columns_in_relation", "macro_sql": "{% macro bigquery__get_columns_in_relation(relation) -%}\n  {{ return(adapter.get_columns_in_relation(relation)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5215073, "supported_languages": null}, "macro.dbt_bigquery.bigquery__list_relations_without_caching": {"name": "bigquery__list_relations_without_caching", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__list_relations_without_caching", "macro_sql": "{% macro bigquery__list_relations_without_caching(schema_relation) -%}\n  {{ return(adapter.list_relations_without_caching(schema_relation)) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5217774, "supported_languages": null}, "macro.dbt_bigquery.bigquery__list_schemas": {"name": "bigquery__list_schemas", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__list_schemas", "macro_sql": "{% macro bigquery__list_schemas(database) -%}\n  {{ return(adapter.list_schemas(database)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5220556, "supported_languages": null}, "macro.dbt_bigquery.bigquery__check_schema_exists": {"name": "bigquery__check_schema_exists", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__check_schema_exists", "macro_sql": "{% macro bigquery__check_schema_exists(information_schema, schema) %}\n  {{ return(adapter.check_schema_exists(information_schema.database, schema)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.522389, "supported_languages": null}, "macro.dbt_bigquery.bigquery__persist_docs": {"name": "bigquery__persist_docs", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__persist_docs", "macro_sql": "{% macro bigquery__persist_docs(relation, model, for_relation, for_columns) -%}\n  {% if for_columns and config.persist_column_docs() and model.columns %}\n    {% do alter_column_comment(relation, model.columns) %}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5228803, "supported_languages": null}, "macro.dbt_bigquery.bigquery__alter_column_comment": {"name": "bigquery__alter_column_comment", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__alter_column_comment", "macro_sql": "{% macro bigquery__alter_column_comment(relation, column_dict) -%}\n  {% do adapter.update_columns(relation, column_dict) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.523175, "supported_languages": null}, "macro.dbt_bigquery.bigquery__alter_relation_add_columns": {"name": "bigquery__alter_relation_add_columns", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__alter_relation_add_columns", "macro_sql": "{% macro bigquery__alter_relation_add_columns(relation, add_columns) %}\n\n  {% set sql -%}\n\n     alter {{ relation.type }} {{ relation }}\n        {% for column in add_columns %}\n          add column {{ column.name }} {{ column.data_type }}{{ ',' if not loop.last }}\n        {% endfor %}\n\n  {%- endset -%}\n\n  {{ return(run_query(sql)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.523938, "supported_languages": null}, "macro.dbt_bigquery.bigquery__alter_relation_drop_columns": {"name": "bigquery__alter_relation_drop_columns", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__alter_relation_drop_columns", "macro_sql": "{% macro bigquery__alter_relation_drop_columns(relation, drop_columns) %}\n\n  {% set sql -%}\n\n     alter {{ relation.type }} {{ relation }}\n\n        {% for column in drop_columns %}\n          drop column {{ column.name }}{{ ',' if not loop.last }}\n        {% endfor %}\n\n  {%- endset -%}\n\n  {{ return(run_query(sql)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5246143, "supported_languages": null}, "macro.dbt_bigquery.bigquery__alter_column_type": {"name": "bigquery__alter_column_type", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__alter_column_type", "macro_sql": "{% macro bigquery__alter_column_type(relation, column_name, new_column_type) -%}\n  {#-- Changing a column's data type using a query requires you to scan the entire table.\n    The query charges can be significant if the table is very large.\n\n    https://cloud.google.com/bigquery/docs/manually-changing-schemas#changing_a_columns_data_type\n  #}\n  {% set relation_columns = get_columns_in_relation(relation) %}\n\n  {% set sql %}\n    select\n      {%- for col in relation_columns -%}\n        {% if col.column == column_name %}\n          CAST({{ col.quoted }} AS {{ new_column_type }}) AS {{ col.quoted }}\n        {%- else %}\n          {{ col.quoted }}\n        {%- endif %}\n        {%- if not loop.last %},{% endif -%}\n      {%- endfor %}\n    from {{ relation }}\n  {% endset %}\n\n  {% call statement('alter_column_type') %}\n    {{ create_table_as(False, relation, sql)}}\n  {%- endcall %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_columns_in_relation", "macro.dbt.statement", "macro.dbt.create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5257976, "supported_languages": null}, "macro.dbt_bigquery.bigquery__test_unique": {"name": "bigquery__test_unique", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__test_unique", "macro_sql": "{% macro bigquery__test_unique(model, column_name) %}\n\nwith dbt_test__target as (\n\n  select {{ column_name }} as unique_field\n  from {{ model }}\n  where {{ column_name }} is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5261126, "supported_languages": null}, "macro.dbt_bigquery.bigquery__upload_file": {"name": "bigquery__upload_file", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_bigquery.bigquery__upload_file", "macro_sql": "{% macro bigquery__upload_file(local_file_path, database, table_schema, table_name) %}\n\n  {{ log(\"kwargs: \" ~ kwargs) }}\n\n  {% do adapter.upload_file(local_file_path, database, table_schema, table_name, kwargs=kwargs) %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5266192, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_catalog": {"name": "bigquery__get_catalog", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/catalog.sql", "original_file_path": "macros/catalog.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_catalog", "macro_sql": "{% macro bigquery__get_catalog(information_schema, schemas) -%}\n\n  {%- if (schemas | length) == 0 -%}\n    {# Hopefully nothing cares about the columns we return when there are no rows #}\n    {%- set query  = \"select 1 as id limit 0\" -%}\n  {%- else -%}\n\n  {%- set query -%}\n    with materialized_views as (\n        select\n            table_catalog as project_id,\n            table_schema as dataset_id,\n            table_name as table_id\n        from {{ information_schema.replace(information_schema_view='MATERIALIZED_VIEWS') }}\n    ),\n    tables as (\n        select\n            tables.project_id as table_database,\n            tables.dataset_id as table_schema,\n            tables.table_id as original_table_name,\n\n            concat(tables.project_id, '.', tables.dataset_id, '.', tables.table_id) as relation_id,\n\n            tables.row_count,\n            tables.size_bytes as size_bytes,\n            case\n                when materialized_views.table_id is not null then 'materialized view'\n                when tables.type = 1 then 'table'\n                when tables.type = 2 then 'view'\n                else 'external'\n            end as table_type,\n\n            REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and coalesce(type, 0) = 1 as is_date_shard,\n            REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$') as shard_base_name,\n            REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_name\n\n        from {{ information_schema.replace(information_schema_view='__TABLES__') }} tables\n        left join materialized_views\n            on materialized_views.project_id = tables.project_id\n            and materialized_views.dataset_id = tables.dataset_id\n            and materialized_views.table_id = tables.table_id\n        where (\n          {%- for schema in schemas -%}\n            upper(tables.dataset_id) = upper('{{ schema }}'){%- if not loop.last %} or {% endif -%}\n          {%- endfor -%}\n        )\n    ),\n\n    table_options as (\n        select\n            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,\n            JSON_VALUE(option_value) as table_comment\n\n        from {{ information_schema.replace(information_schema_view='TABLE_OPTIONS') }}\n        where option_name = 'description'\n    ),\n    extracted as (\n\n        select *,\n            case\n                when is_date_shard then shard_base_name\n                else original_table_name\n            end as table_name\n\n        from tables\n\n    ),\n\n    unsharded_tables as (\n\n        select\n            table_database,\n            table_schema,\n            table_name,\n            coalesce(table_type, 'external') as table_type,\n            is_date_shard,\n\n            struct(\n                min(shard_name) as shard_min,\n                max(shard_name) as shard_max,\n                count(*) as shard_count\n            ) as table_shards,\n\n            sum(size_bytes) as size_bytes,\n            sum(row_count) as row_count,\n\n            max(relation_id) as relation_id\n\n        from extracted\n        group by 1,2,3,4,5\n\n    ),\n\n    info_schema_columns as (\n\n        select\n            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,\n            table_catalog as table_database,\n            table_schema,\n            table_name,\n\n            -- use the \"real\" column name from the paths query below\n            column_name as base_column_name,\n            ordinal_position as column_index,\n\n            is_partitioning_column,\n            clustering_ordinal_position\n\n        from {{ information_schema.replace(information_schema_view='COLUMNS') }}\n        where ordinal_position is not null\n\n    ),\n\n    info_schema_column_paths as (\n\n        select\n            concat(table_catalog, '.', table_schema, '.', table_name) as relation_id,\n            field_path as column_name,\n            data_type as column_type,\n            column_name as base_column_name,\n            description as column_comment\n\n        from {{ information_schema.replace(information_schema_view='COLUMN_FIELD_PATHS') }}\n\n    ),\n\n    columns as (\n\n        select * except (base_column_name)\n        from info_schema_columns\n        join info_schema_column_paths using (relation_id, base_column_name)\n\n    ),\n\n    column_stats as (\n\n        select\n            table_database,\n            table_schema,\n            table_name,\n            max(relation_id) as relation_id,\n            max(case when is_partitioning_column = 'YES' then 1 else 0 end) = 1 as is_partitioned,\n            max(case when is_partitioning_column = 'YES' then column_name else null end) as partition_column,\n            max(case when clustering_ordinal_position is not null then 1 else 0 end) = 1 as is_clustered,\n            array_to_string(\n                array_agg(\n                    case\n                        when clustering_ordinal_position is not null then column_name\n                        else null\n                    end ignore nulls\n                    order by clustering_ordinal_position\n                ), ', '\n            ) as clustering_columns\n\n        from columns\n        group by 1,2,3\n\n    )\n\n    select\n        unsharded_tables.table_database,\n        unsharded_tables.table_schema,\n        case\n            when is_date_shard then concat(unsharded_tables.table_name, '*')\n            else unsharded_tables.table_name\n        end as table_name,\n        unsharded_tables.table_type,\n        table_options.table_comment,\n\n        -- coalesce name and type for External tables - these columns are not\n        -- present in the COLUMN_FIELD_PATHS resultset\n        coalesce(columns.column_name, '<unknown>') as column_name,\n        -- invent a row number to account for nested fields -- BQ does\n        -- not treat these nested properties as independent fields\n        row_number() over (\n            partition by relation_id\n            order by columns.column_index, columns.column_name\n        ) as column_index,\n        coalesce(columns.column_type, '<unknown>') as column_type,\n        columns.column_comment,\n\n        'Shard count' as `stats__date_shards__label`,\n        table_shards.shard_count as `stats__date_shards__value`,\n        'The number of date shards in this table' as `stats__date_shards__description`,\n        is_date_shard as `stats__date_shards__include`,\n\n        'Shard (min)' as `stats__date_shard_min__label`,\n        table_shards.shard_min as `stats__date_shard_min__value`,\n        'The first date shard in this table' as `stats__date_shard_min__description`,\n        is_date_shard as `stats__date_shard_min__include`,\n\n        'Shard (max)' as `stats__date_shard_max__label`,\n        table_shards.shard_max as `stats__date_shard_max__value`,\n        'The last date shard in this table' as `stats__date_shard_max__description`,\n        is_date_shard as `stats__date_shard_max__include`,\n\n        '# Rows' as `stats__num_rows__label`,\n        row_count as `stats__num_rows__value`,\n        'Approximate count of rows in this table' as `stats__num_rows__description`,\n        (unsharded_tables.table_type = 'table') as `stats__num_rows__include`,\n\n        'Approximate Size' as `stats__num_bytes__label`,\n        size_bytes as `stats__num_bytes__value`,\n        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,\n        (unsharded_tables.table_type = 'table') as `stats__num_bytes__include`,\n\n        'Partitioned By' as `stats__partitioning_type__label`,\n        partition_column as `stats__partitioning_type__value`,\n        'The partitioning column for this table' as `stats__partitioning_type__description`,\n        is_partitioned as `stats__partitioning_type__include`,\n\n        'Clustered By' as `stats__clustering_fields__label`,\n        clustering_columns as `stats__clustering_fields__value`,\n        'The clustering columns for this table' as `stats__clustering_fields__description`,\n        is_clustered as `stats__clustering_fields__include`\n\n    -- join using relation_id (an actual relation, not a shard prefix) to make\n    -- sure that column metadata is picked up through the join. This will only\n    -- return the column information for the \"max\" table in a date-sharded table set\n    from unsharded_tables\n    left join table_options using (relation_id)\n    left join columns using (relation_id)\n    left join column_stats using (relation_id)\n  {%- endset -%}\n\n  {%- endif -%}\n\n  {{ return(run_query(query)) }}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.replace", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5323663, "supported_languages": null}, "macro.dbt_bigquery.date_sharded_table": {"name": "date_sharded_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/etc.sql", "original_file_path": "macros/etc.sql", "unique_id": "macro.dbt_bigquery.date_sharded_table", "macro_sql": "{% macro date_sharded_table(base_name) %}\n    {{ return(base_name ~ \"[DBT__PARTITION_DATE]\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.532865, "supported_languages": null}, "macro.dbt_bigquery.grant_access_to": {"name": "grant_access_to", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/etc.sql", "original_file_path": "macros/etc.sql", "unique_id": "macro.dbt_bigquery.grant_access_to", "macro_sql": "{% macro grant_access_to(entity, entity_type, role, grant_target_dict) -%}\n  {% do adapter.grant_access_to(entity, entity_type, role, grant_target_dict) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5332417, "supported_languages": null}, "macro.dbt_bigquery.get_partitions_metadata": {"name": "get_partitions_metadata", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/etc.sql", "original_file_path": "macros/etc.sql", "unique_id": "macro.dbt_bigquery.get_partitions_metadata", "macro_sql": "\n\n{%- macro get_partitions_metadata(table) -%}\n  {%- if execute -%}\n    {%- set res = adapter.get_partitions_metadata(table) -%}\n    {{- return(res) -}}\n  {%- endif -%}\n  {{- return(None) -}}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5338242, "supported_languages": null}, "macro.dbt_bigquery.bigquery__rename_relation": {"name": "bigquery__rename_relation", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt_bigquery.bigquery__rename_relation", "macro_sql": "{% macro bigquery__rename_relation(from_relation, to_relation) -%}\n  {% do adapter.rename_relation(from_relation, to_relation) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5341887, "supported_languages": null}, "macro.dbt_bigquery.bigquery_options": {"name": "bigquery_options", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/options.sql", "original_file_path": "macros/relations/options.sql", "unique_id": "macro.dbt_bigquery.bigquery_options", "macro_sql": "{% macro bigquery_options(opts) %}\n  {% set options -%}\n    OPTIONS({% for opt_key, opt_val in opts.items() %}\n      {{ opt_key }}={{ opt_val }}{{ \",\" if not loop.last }}\n    {% endfor %})\n  {%- endset %}\n  {%- do return(options) -%}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5349615, "supported_languages": null}, "macro.dbt_bigquery.bigquery__drop_relation": {"name": "bigquery__drop_relation", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt_bigquery.bigquery__drop_relation", "macro_sql": "{% macro bigquery__drop_relation(relation) -%}\n    {% do adapter.drop_relation(relation) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5352864, "supported_languages": null}, "macro.dbt_bigquery.cluster_by": {"name": "cluster_by", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/cluster.sql", "original_file_path": "macros/relations/cluster.sql", "unique_id": "macro.dbt_bigquery.cluster_by", "macro_sql": "{% macro cluster_by(raw_cluster_by) %}\n  {%- if raw_cluster_by is not none -%}\n  cluster by {% if raw_cluster_by is string -%}\n    {% set raw_cluster_by = [raw_cluster_by] %}\n  {%- endif -%}\n  {%- for cluster in raw_cluster_by -%}\n    {{ cluster }}\n    {%- if not loop.last -%}, {% endif -%}\n  {%- endfor -%}\n\n  {% endif %}\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5361028, "supported_languages": null}, "macro.dbt_bigquery.partition_by": {"name": "partition_by", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/partition.sql", "original_file_path": "macros/relations/partition.sql", "unique_id": "macro.dbt_bigquery.partition_by", "macro_sql": "{% macro partition_by(partition_config) -%}\n    {%- if partition_config is none -%}\n      {% do return('') %}\n    {%- elif partition_config.time_ingestion_partitioning -%}\n        partition by {{ partition_config.render_wrapped() }}\n    {%- elif partition_config.data_type | lower in ('date','timestamp','datetime') -%}\n        partition by {{ partition_config.render() }}\n    {%- elif partition_config.data_type | lower in ('int64') -%}\n        {%- set range = partition_config.range -%}\n        partition by range_bucket(\n            {{ partition_config.field }},\n            generate_array({{ range.start}}, {{ range.end }}, {{ range.interval }})\n        )\n    {%- endif -%}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.537489, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_rename_table_sql": {"name": "bigquery__get_rename_table_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_rename_table_sql", "macro_sql": "{%- macro bigquery__get_rename_table_sql(relation, new_name) -%}\n    alter table {{ relation }} rename to {{ new_name }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.537817, "supported_languages": null}, "macro.dbt_bigquery.bigquery_table_options": {"name": "bigquery_table_options", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/table/options.sql", "original_file_path": "macros/relations/table/options.sql", "unique_id": "macro.dbt_bigquery.bigquery_table_options", "macro_sql": "{% macro bigquery_table_options(config, node, temporary) %}\n  {% set opts = adapter.get_table_options(config, node, temporary) %}\n  {%- do return(bigquery_options(opts)) -%}\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5383437, "supported_languages": null}, "macro.dbt_bigquery.bigquery__drop_table": {"name": "bigquery__drop_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt_bigquery.bigquery__drop_table", "macro_sql": "{% macro bigquery__drop_table(relation) %}\n    drop table if exists {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5386076, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_rename_view_sql": {"name": "bigquery__get_rename_view_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_rename_view_sql", "macro_sql": "{%- macro bigquery__get_rename_view_sql(relation, new_name) -%}\n    alter view {{ relation }} rename to {{ new_name }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5389228, "supported_languages": null}, "macro.dbt_bigquery.bigquery_view_options": {"name": "bigquery_view_options", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/options.sql", "original_file_path": "macros/relations/view/options.sql", "unique_id": "macro.dbt_bigquery.bigquery_view_options", "macro_sql": "{% macro bigquery_view_options(config, node) %}\n  {% set opts = adapter.get_view_options(config, node) %}\n  {%- do return(bigquery_options(opts)) -%}\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5394292, "supported_languages": null}, "macro.dbt_bigquery.bigquery__drop_view": {"name": "bigquery__drop_view", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt_bigquery.bigquery__drop_view", "macro_sql": "{% macro bigquery__drop_view(relation) %}\n    drop view if exists {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5396965, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_or_replace_view": {"name": "bigquery__create_or_replace_view", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_or_replace_view", "macro_sql": "{% macro bigquery__create_or_replace_view() %}\n  {%- set identifier = model['alias'] -%}\n\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n  {%- set exists_as_view = (old_relation is not none and old_relation.is_view) -%}\n\n  {%- set target_relation = api.Relation.create(\n      identifier=identifier, schema=schema, database=database,\n      type='view') -%}\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks) }}\n\n  -- If there's a table with the same name and we weren't told to full refresh,\n  -- that's an error. If we were told to full refresh, drop it. This behavior differs\n  -- for Snowflake and BigQuery, so multiple dispatch is used.\n  {%- if old_relation is not none and not old_relation.is_view -%}\n    {{ handle_existing_table(should_full_refresh(), old_relation) }}\n  {%- endif -%}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(target_relation, sql) }}\n  {%- endcall %}\n\n  {% set should_revoke = should_revoke(exists_as_view, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {{ run_hooks(post_hooks) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt_bigquery.handle_existing_table", "macro.dbt.should_full_refresh", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5424032, "supported_languages": null}, "macro.dbt_bigquery.handle_existing_table": {"name": "handle_existing_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt_bigquery.handle_existing_table", "macro_sql": "{% macro handle_existing_table(full_refresh, old_relation) %}\n    {{ adapter.dispatch('handle_existing_table', 'dbt')(full_refresh, old_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__handle_existing_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5427728, "supported_languages": null}, "macro.dbt_bigquery.default__handle_existing_table": {"name": "default__handle_existing_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt_bigquery.default__handle_existing_table", "macro_sql": "{% macro default__handle_existing_table(full_refresh, old_relation) %}\n    {{ log(\"Dropping relation \" ~ old_relation ~ \" because it is of type \" ~ old_relation.type) }}\n    {{ adapter.drop_relation(old_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5431821, "supported_languages": null}, "macro.dbt_bigquery.bigquery__refresh_materialized_view": {"name": "bigquery__refresh_materialized_view", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt_bigquery.bigquery__refresh_materialized_view", "macro_sql": "{% macro bigquery__refresh_materialized_view(relation) %}\n    call bq.refresh_materialized_view('{{ relation.database }}.{{ relation.schema }}.{{ relation.identifier }}')\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5435867, "supported_languages": null}, "macro.dbt_bigquery.bigquery__drop_materialized_view": {"name": "bigquery__drop_materialized_view", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt_bigquery.bigquery__drop_materialized_view", "macro_sql": "{% macro bigquery__drop_materialized_view(relation) %}\n    drop materialized view if exists {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5438504, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_replace_materialized_view_as_sql": {"name": "bigquery__get_replace_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/replace.sql", "original_file_path": "macros/relations/materialized_view/replace.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_replace_materialized_view_as_sql", "macro_sql": "{% macro bigquery__get_replace_materialized_view_as_sql(relation, sql) %}\n\n    {%- set materialized_view = adapter.Relation.materialized_view_from_model_node(config.model) -%}\n\n    create or replace materialized view if not exists {{ relation }}\n    {% if materialized_view.partition %}{{ partition_by(materialized_view.partition) }}{% endif %}\n    {% if materialized_view.cluster %}{{ cluster_by(materialized_view.cluster.fields) }}{% endif %}\n    {{ bigquery_options(materialized_view.options.as_ddl_dict()) }}\n    as {{ sql }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.partition_by", "macro.dbt_bigquery.cluster_by", "macro.dbt_bigquery.bigquery_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.544881, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_alter_materialized_view_as_sql": {"name": "bigquery__get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_alter_materialized_view_as_sql", "macro_sql": "{% macro bigquery__get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n\n    {% if configuration_changes.requires_full_refresh %}\n        {{ get_replace_sql(existing_relation, relation, sql) }}\n    {% else %}\n\n        alter materialized view {{ relation }}\n            set {{ bigquery_options(configuration_changes.options.context.as_ddl_dict()) }}\n\n    {%- endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_replace_sql", "macro.dbt_bigquery.bigquery_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5458996, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_materialized_view_configuration_changes": {"name": "bigquery__get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_materialized_view_configuration_changes", "macro_sql": "{% macro bigquery__get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    {% set _existing_materialized_view = adapter.describe_relation(existing_relation) %}\n    {% set _configuration_changes = existing_relation.materialized_view_config_changeset(_existing_materialized_view, new_config) %}\n    {% do return(_configuration_changes) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5464435, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_create_materialized_view_as_sql": {"name": "bigquery__get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_create_materialized_view_as_sql", "macro_sql": "{% macro bigquery__get_create_materialized_view_as_sql(relation, sql) %}\n\n    {%- set materialized_view = adapter.Relation.materialized_view_from_model_node(config.model) -%}\n\n    create materialized view if not exists {{ relation }}\n    {% if materialized_view.partition %}{{ partition_by(materialized_view.partition) }}{% endif %}\n    {% if materialized_view.cluster %}{{ cluster_by(materialized_view.cluster.fields) }}{% endif %}\n    {{ bigquery_options(materialized_view.options.as_ddl_dict()) }}\n    as {{ sql }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.partition_by", "macro.dbt_bigquery.cluster_by", "macro.dbt_bigquery.bigquery_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5474982, "supported_languages": null}, "macro.dbt_bigquery.bigquery__safe_cast": {"name": "bigquery__safe_cast", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/safe_cast.sql", "original_file_path": "macros/utils/safe_cast.sql", "unique_id": "macro.dbt_bigquery.bigquery__safe_cast", "macro_sql": "{% macro bigquery__safe_cast(field, type) %}\n    safe_cast({{field}} as {{type}})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5478213, "supported_languages": null}, "macro.dbt_bigquery.bigquery__dateadd": {"name": "bigquery__dateadd", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt_bigquery.bigquery__dateadd", "macro_sql": "{% macro bigquery__dateadd(datepart, interval, from_date_or_timestamp) %}\n\n        datetime_add(\n            cast( {{ from_date_or_timestamp }} as datetime),\n        interval {{ interval }} {{ datepart }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5482194, "supported_languages": null}, "macro.dbt_bigquery.bigquery__split_part": {"name": "bigquery__split_part", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt_bigquery.bigquery__split_part", "macro_sql": "{% macro bigquery__split_part(string_text, delimiter_text, part_number) %}\n\n  {% if part_number >= 0 %}\n    split(\n        {{ string_text }},\n        {{ delimiter_text }}\n        )[safe_offset({{ part_number - 1 }})]\n  {% else %}\n    split(\n        {{ string_text }},\n        {{ delimiter_text }}\n        )[safe_offset(\n          length({{ string_text }})\n          - length(\n              replace({{ string_text }},  {{ delimiter_text }}, '')\n          ) + 1 + {{ part_number }}\n        )]\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.549179, "supported_languages": null}, "macro.dbt_bigquery.bigquery__format_column": {"name": "bigquery__format_column", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/get_columns_spec_ddl.sql", "original_file_path": "macros/utils/get_columns_spec_ddl.sql", "unique_id": "macro.dbt_bigquery.bigquery__format_column", "macro_sql": "{% macro bigquery__format_column(column) -%}\n  {% set data_type = column.data_type %}\n  {% set formatted = column.column.lower() ~ \" \" ~ data_type %}\n  {{ return({'name': column.name, 'data_type': data_type, 'formatted': formatted}) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5504405, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_empty_schema_sql": {"name": "bigquery__get_empty_schema_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/get_columns_spec_ddl.sql", "original_file_path": "macros/utils/get_columns_spec_ddl.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_empty_schema_sql", "macro_sql": "{% macro bigquery__get_empty_schema_sql(columns) %}\n    {%- set col_err = [] -%}\n    {% for col in columns.values() %}\n      {%- if col['data_type'] is not defined -%}\n        {{ col_err.append(col['name']) }}\n      {%- endif -%}\n    {%- endfor -%}\n    {%- if (col_err | length) > 0 -%}\n      {{ exceptions.column_type_missing(column_names=col_err) }}\n    {%- endif -%}\n\n    {%- set columns = adapter.nest_column_data_types(columns) -%}\n    {{ return(dbt.default__get_empty_schema_sql(columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_empty_schema_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5514822, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_select_subquery": {"name": "bigquery__get_select_subquery", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/get_columns_spec_ddl.sql", "original_file_path": "macros/utils/get_columns_spec_ddl.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_select_subquery", "macro_sql": "{% macro bigquery__get_select_subquery(sql) %}\n    select {{ adapter.dispatch('get_column_names')() }}\n    from (\n        {{ sql }}\n    ) as model_subq\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_column_names"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5518103, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_column_names": {"name": "bigquery__get_column_names", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/get_columns_spec_ddl.sql", "original_file_path": "macros/utils/get_columns_spec_ddl.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_column_names", "macro_sql": "{% macro bigquery__get_column_names() %}\n  {#- loop through nested user_provided_columns to get column names -#}\n    {%- set user_provided_columns = adapter.nest_column_data_types(model['columns']) -%}\n    {%- for i in user_provided_columns %}\n      {%- set col = user_provided_columns[i] -%}\n      {%- set col_name = adapter.quote(col['name']) if col.get('quote') else col['name'] -%}\n      {{ col_name }}{{ \", \" if not loop.last }}\n    {%- endfor -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.552665, "supported_languages": null}, "macro.dbt_bigquery.bigquery__datediff": {"name": "bigquery__datediff", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt_bigquery.bigquery__datediff", "macro_sql": "{% macro bigquery__datediff(first_date, second_date, datepart) -%}\n\n  {% if dbt_version[0] == 1 and dbt_version[2] >= 2 %}\n    {{ return(dbt.datediff(first_date, second_date, datepart)) }}\n  {% else %}\n\n    datetime_diff(\n        cast({{second_date}} as datetime),\n        cast({{first_date}} as datetime),\n        {{datepart}}\n    )\n\n  {% endif %}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5535092, "supported_languages": null}, "macro.dbt_bigquery.bigquery__array_concat": {"name": "bigquery__array_concat", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt_bigquery.bigquery__array_concat", "macro_sql": "{% macro bigquery__array_concat(array_1, array_2) -%}\n    array_concat({{ array_1 }}, {{ array_2 }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5538352, "supported_languages": null}, "macro.dbt_bigquery.bigquery__right": {"name": "bigquery__right", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/right.sql", "original_file_path": "macros/utils/right.sql", "unique_id": "macro.dbt_bigquery.bigquery__right", "macro_sql": "{% macro bigquery__right(string_text, length_expression) %}\n\n    case when {{ length_expression }} = 0\n        then ''\n    else\n        substr(\n            {{ string_text }},\n            -1 * ({{ length_expression }})\n        )\n    end\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5542383, "supported_languages": null}, "macro.dbt_bigquery.bigquery__intersect": {"name": "bigquery__intersect", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/intersect.sql", "original_file_path": "macros/utils/intersect.sql", "unique_id": "macro.dbt_bigquery.bigquery__intersect", "macro_sql": "{% macro bigquery__intersect() %}\n\n    intersect distinct\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5544407, "supported_languages": null}, "macro.dbt_bigquery.bigquery__except": {"name": "bigquery__except", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/except.sql", "original_file_path": "macros/utils/except.sql", "unique_id": "macro.dbt_bigquery.bigquery__except", "macro_sql": "{% macro bigquery__except() %}\n\n    except distinct\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.554638, "supported_languages": null}, "macro.dbt_bigquery.bigquery__array_construct": {"name": "bigquery__array_construct", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt_bigquery.bigquery__array_construct", "macro_sql": "{% macro bigquery__array_construct(inputs, data_type) -%}\n    {% if inputs|length > 0 %}\n    [ {{ inputs|join(' , ') }} ]\n    {% else %}\n    ARRAY<{{data_type}}>[]\n    {% endif %}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5551832, "supported_languages": null}, "macro.dbt_bigquery.bigquery__hash": {"name": "bigquery__hash", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/hash.sql", "original_file_path": "macros/utils/hash.sql", "unique_id": "macro.dbt_bigquery.bigquery__hash", "macro_sql": "{% macro bigquery__hash(field) -%}\n    to_hex({{dbt.default__hash(field)}})\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__hash"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.555496, "supported_languages": null}, "macro.dbt_bigquery.bigquery__position": {"name": "bigquery__position", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/position.sql", "original_file_path": "macros/utils/position.sql", "unique_id": "macro.dbt_bigquery.bigquery__position", "macro_sql": "{% macro bigquery__position(substring_text, string_text) %}\n\n    strpos(\n        {{ string_text }},\n        {{ substring_text }}\n\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5558286, "supported_languages": null}, "macro.dbt_bigquery.bigquery__current_timestamp": {"name": "bigquery__current_timestamp", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/timestamps.sql", "original_file_path": "macros/utils/timestamps.sql", "unique_id": "macro.dbt_bigquery.bigquery__current_timestamp", "macro_sql": "{% macro bigquery__current_timestamp() -%}\n  current_timestamp()\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5561209, "supported_languages": null}, "macro.dbt_bigquery.bigquery__snapshot_string_as_time": {"name": "bigquery__snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/timestamps.sql", "original_file_path": "macros/utils/timestamps.sql", "unique_id": "macro.dbt_bigquery.bigquery__snapshot_string_as_time", "macro_sql": "{% macro bigquery__snapshot_string_as_time(timestamp) -%}\n    {%- set result = 'TIMESTAMP(\"' ~ timestamp ~ '\")' -%}\n    {{ return(result) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5564742, "supported_languages": null}, "macro.dbt_bigquery.bigquery__current_timestamp_backcompat": {"name": "bigquery__current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/timestamps.sql", "original_file_path": "macros/utils/timestamps.sql", "unique_id": "macro.dbt_bigquery.bigquery__current_timestamp_backcompat", "macro_sql": "{% macro bigquery__current_timestamp_backcompat() -%}\n  current_timestamp\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5567253, "supported_languages": null}, "macro.dbt_bigquery.bigquery__date_trunc": {"name": "bigquery__date_trunc", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/date_trunc.sql", "original_file_path": "macros/utils/date_trunc.sql", "unique_id": "macro.dbt_bigquery.bigquery__date_trunc", "macro_sql": "{% macro bigquery__date_trunc(datepart, date) -%}\n    timestamp_trunc(\n        cast({{date}} as timestamp),\n        {{datepart}}\n    )\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.557048, "supported_languages": null}, "macro.dbt_bigquery.bigquery__bool_or": {"name": "bigquery__bool_or", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/bool_or.sql", "original_file_path": "macros/utils/bool_or.sql", "unique_id": "macro.dbt_bigquery.bigquery__bool_or", "macro_sql": "{% macro bigquery__bool_or(expression) -%}\n\n    logical_or({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5573006, "supported_languages": null}, "macro.dbt_bigquery.bigquery__listagg": {"name": "bigquery__listagg", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt_bigquery.bigquery__listagg", "macro_sql": "{% macro bigquery__listagg(measure, delimiter_text, order_by_clause, limit_num) -%}\n\n    string_agg(\n        {{ measure }},\n        {{ delimiter_text }}\n        {% if order_by_clause -%}\n        {{ order_by_clause }}\n        {%- endif %}\n        {% if limit_num -%}\n        limit {{ limit_num }}\n        {%- endif %}\n        )\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5579536, "supported_languages": null}, "macro.dbt_bigquery.bigquery__array_append": {"name": "bigquery__array_append", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt_bigquery.bigquery__array_append", "macro_sql": "{% macro bigquery__array_append(array, new_element) -%}\n    {{ array_concat(array, array_construct([new_element])) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.array_concat", "macro.dbt.array_construct"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.558328, "supported_languages": null}, "macro.dbt_bigquery.bigquery__escape_single_quotes": {"name": "bigquery__escape_single_quotes", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/utils/escape_single_quotes.sql", "original_file_path": "macros/utils/escape_single_quotes.sql", "unique_id": "macro.dbt_bigquery.bigquery__escape_single_quotes", "macro_sql": "{% macro bigquery__escape_single_quotes(expression) -%}\n{{ expression | replace(\"'\", \"\\\\'\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5586672, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_csv_table": {"name": "bigquery__create_csv_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/seed.sql", "original_file_path": "macros/materializations/seed.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_csv_table", "macro_sql": "{% macro bigquery__create_csv_table(model, agate_table) %}\n    -- no-op\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.559202, "supported_languages": null}, "macro.dbt_bigquery.bigquery__reset_csv_table": {"name": "bigquery__reset_csv_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/seed.sql", "original_file_path": "macros/materializations/seed.sql", "unique_id": "macro.dbt_bigquery.bigquery__reset_csv_table", "macro_sql": "{% macro bigquery__reset_csv_table(model, full_refresh, old_relation, agate_table) %}\n    {{ adapter.drop_relation(old_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5594988, "supported_languages": null}, "macro.dbt_bigquery.bigquery__load_csv_rows": {"name": "bigquery__load_csv_rows", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/seed.sql", "original_file_path": "macros/materializations/seed.sql", "unique_id": "macro.dbt_bigquery.bigquery__load_csv_rows", "macro_sql": "{% macro bigquery__load_csv_rows(model, agate_table) %}\n\n  {%- set column_override = model['config'].get('column_types', {}) -%}\n  {{ adapter.load_dataframe(model['database'], model['schema'], model['alias'],\n  \t\t\t\t\t\t\tagate_table, column_override) }}\n\n  {% call statement() %}\n    alter table {{ this.render() }} set {{ bigquery_table_options(config, model) }}\n  {% endcall %}\n\n  {% if config.persist_relation_docs() and 'description' in model %}\n\n  \t{{ adapter.update_table_description(model['database'], model['schema'], model['alias'], model['description']) }}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_bigquery.bigquery_table_options"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5607607, "supported_languages": null}, "macro.dbt_bigquery.materialization_table_bigquery": {"name": "materialization_table_bigquery", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/table.sql", "original_file_path": "macros/materializations/table.sql", "unique_id": "macro.dbt_bigquery.materialization_table_bigquery", "macro_sql": "{% materialization table, adapter='bigquery', supported_languages=['sql', 'python']-%}\n\n  {%- set language = model['language'] -%}\n  {%- set identifier = model['alias'] -%}\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n  {%- set exists_not_as_table = (old_relation is not none and not old_relation.is_table) -%}\n  {%- set target_relation = api.Relation.create(database=database, schema=schema, identifier=identifier, type='table') -%}\n\n  -- grab current tables grants config for comparision later on\n  {%- set grant_config = config.get('grants') -%}\n\n  {{ run_hooks(pre_hooks) }}\n\n  {#\n      We only need to drop this thing if it is not a table.\n      If it _is_ already a table, then we can overwrite it without downtime\n      Unlike table -> view, no need for `--full-refresh`: dropping a view is no big deal\n  #}\n  {%- if exists_not_as_table -%}\n      {{ adapter.drop_relation(old_relation) }}\n  {%- endif -%}\n\n  -- build model\n  {%- set raw_partition_by = config.get('partition_by', none) -%}\n  {%- set partition_by = adapter.parse_partition_by(raw_partition_by) -%}\n  {%- set cluster_by = config.get('cluster_by', none) -%}\n  {% if not adapter.is_replaceable(old_relation, partition_by, cluster_by) %}\n    {% do log(\"Hard refreshing \" ~ old_relation ~ \" because it is not replaceable\") %}\n    {% do adapter.drop_relation(old_relation) %}\n  {% endif %}\n\n  -- build model\n  {%- call statement('main', language=language) -%}\n    {{ create_table_as(False, target_relation, compiled_code, language) }}\n  {%- endcall -%}\n\n  {{ run_hooks(post_hooks) }}\n\n  {% set should_revoke = should_revoke(old_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.create_table_as", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5662558, "supported_languages": ["sql", "python"]}, "macro.dbt_bigquery.py_write_table": {"name": "py_write_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/table.sql", "original_file_path": "macros/materializations/table.sql", "unique_id": "macro.dbt_bigquery.py_write_table", "macro_sql": "{% macro py_write_table(compiled_code, target_relation) %}\nfrom pyspark.sql import SparkSession\n{%- set raw_partition_by = config.get('partition_by', none) -%}\n{%- set raw_cluster_by = config.get('cluster_by', none) -%}\n{%- set partition_config = adapter.parse_partition_by(raw_partition_by) %}\n\nspark = SparkSession.builder.appName('smallTest').getOrCreate()\n\nspark.conf.set(\"viewsEnabled\",\"true\")\nspark.conf.set(\"temporaryGcsBucket\",\"{{target.gcs_bucket}}\")\n\n{{ compiled_code }}\ndbt = dbtObj(spark.read.format(\"bigquery\").load)\ndf = model(dbt, spark)\n\n# COMMAND ----------\n# this is materialization code dbt generated, please do not modify\n\nimport pyspark\n# make sure pandas exists before using it\ntry:\n  import pandas\n  pandas_available = True\nexcept ImportError:\n  pandas_available = False\n\n# make sure pyspark.pandas exists before using it\ntry:\n  import pyspark.pandas\n  pyspark_pandas_api_available = True\nexcept ImportError:\n  pyspark_pandas_api_available = False\n\n# make sure databricks.koalas exists before using it\ntry:\n  import databricks.koalas\n  koalas_available = True\nexcept ImportError:\n  koalas_available = False\n\n# preferentially convert pandas DataFrames to pandas-on-Spark or Koalas DataFrames first\n# since they know how to convert pandas DataFrames better than `spark.createDataFrame(df)`\n# and converting from pandas-on-Spark to Spark DataFrame has no overhead\nif pyspark_pandas_api_available and pandas_available and isinstance(df, pandas.core.frame.DataFrame):\n  df = pyspark.pandas.frame.DataFrame(df)\nelif koalas_available and pandas_available and isinstance(df, pandas.core.frame.DataFrame):\n  df = databricks.koalas.frame.DataFrame(df)\n\n# convert to pyspark.sql.dataframe.DataFrame\nif isinstance(df, pyspark.sql.dataframe.DataFrame):\n  pass  # since it is already a Spark DataFrame\nelif pyspark_pandas_api_available and isinstance(df, pyspark.pandas.frame.DataFrame):\n  df = df.to_spark()\nelif koalas_available and isinstance(df, databricks.koalas.frame.DataFrame):\n  df = df.to_spark()\nelif pandas_available and isinstance(df, pandas.core.frame.DataFrame):\n  df = spark.createDataFrame(df)\nelse:\n  msg = f\"{type(df)} is not a supported type for dbt Python materialization\"\n  raise Exception(msg)\n\ndf.write \\\n  .mode(\"overwrite\") \\\n  .format(\"bigquery\") \\\n  .option(\"writeMethod\", \"indirect\").option(\"writeDisposition\", 'WRITE_TRUNCATE') \\\n  {%- if partition_config is not none %}\n  {%- if partition_config.data_type | lower in ('date','timestamp','datetime') %}\n  .option(\"partitionField\", \"{{- partition_config.field -}}\") \\\n  {%- if partition_config.granularity is not none %}\n  .option(\"partitionType\", \"{{- partition_config.granularity| upper -}}\") \\\n  {%- endif %}\n  {%- endif %}\n  {%- endif %}\n  {%- if raw_cluster_by is not none %}\n  .option(\"clusteredFields\", \"{{- raw_cluster_by | join(',') -}}\") \\\n  {%- endif %}\n  .save(\"{{target_relation}}\")\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.567981, "supported_languages": null}, "macro.dbt_bigquery.materialization_copy_bigquery": {"name": "materialization_copy_bigquery", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/copy.sql", "original_file_path": "macros/materializations/copy.sql", "unique_id": "macro.dbt_bigquery.materialization_copy_bigquery", "macro_sql": "{% materialization copy, adapter='bigquery' -%}\n\n  {# Setup #}\n  {{ run_hooks(pre_hooks) }}\n\n  {% set destination = this.incorporate(type='table') %}\n\n  {# there can be several ref() or source() according to BQ copy API docs #}\n  {# cycle over ref() and source() to create source tables array #}\n  {% set source_array = [] %}\n  {% for ref_table in model.refs %}\n    {{ source_array.append(ref(ref_table.get('package'), ref_table.name, version=ref_table.get('version'))) }}\n  {% endfor %}\n\n  {% for src_table in model.sources %}\n    {{ source_array.append(source(*src_table)) }}\n  {% endfor %}\n\n  {# Call adapter copy_table function #}\n  {%- set result_str = adapter.copy_table(\n      source_array,\n      destination,\n      config.get('copy_materialization', default = 'table')) -%}\n\n  {{ store_result('main', response=result_str) }}\n\n  {# Clean up #}\n  {{ run_hooks(post_hooks) }}\n  {%- do apply_grants(target_relation, grant_config) -%}\n  {{ adapter.commit() }}\n\n  {{ return({'relations': [destination]}) }}\n{%- endmaterialization %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5701709, "supported_languages": ["sql"]}, "macro.dbt_bigquery.dbt_bigquery_validate_get_incremental_strategy": {"name": "dbt_bigquery_validate_get_incremental_strategy", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental.sql", "original_file_path": "macros/materializations/incremental.sql", "unique_id": "macro.dbt_bigquery.dbt_bigquery_validate_get_incremental_strategy", "macro_sql": "{% macro dbt_bigquery_validate_get_incremental_strategy(config) %}\n  {#-- Find and validate the incremental strategy #}\n  {%- set strategy = config.get(\"incremental_strategy\") or 'merge' -%}\n\n  {% set invalid_strategy_msg -%}\n    Invalid incremental strategy provided: {{ strategy }}\n    Expected one of: 'merge', 'insert_overwrite'\n  {%- endset %}\n  {% if strategy not in ['merge', 'insert_overwrite'] %}\n    {% do exceptions.raise_compiler_error(invalid_strategy_msg) %}\n  {% endif %}\n\n  {% do return(strategy) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5731108, "supported_languages": null}, "macro.dbt_bigquery.source_sql_with_partition": {"name": "source_sql_with_partition", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental.sql", "original_file_path": "macros/materializations/incremental.sql", "unique_id": "macro.dbt_bigquery.source_sql_with_partition", "macro_sql": "{% macro source_sql_with_partition(partition_by, source_sql) %}\n\n  {%- if partition_by.time_ingestion_partitioning %}\n    {{ return(wrap_with_time_ingestion_partitioning_sql(partition_by, source_sql, False))  }}\n  {% else %}\n    {{ return(source_sql)  }}\n  {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5736248, "supported_languages": null}, "macro.dbt_bigquery.bq_create_table_as": {"name": "bq_create_table_as", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental.sql", "original_file_path": "macros/materializations/incremental.sql", "unique_id": "macro.dbt_bigquery.bq_create_table_as", "macro_sql": "{% macro bq_create_table_as(partition_by, temporary, relation, compiled_code, language='sql') %}\n  {%- set _dbt_max_partition = declare_dbt_max_partition(this, partition_by, compiled_code, language) -%}\n  {% if partition_by.time_ingestion_partitioning and language == 'python' %}\n    {% do exceptions.raise_compiler_error(\n      \"Python models do not support ingestion time partitioning\"\n    ) %}\n  {% elif partition_by.time_ingestion_partitioning and language == 'sql' %}\n    {#-- Create the table before inserting data as ingestion time partitioned tables can't be created with the transformed data --#}\n    {% do run_query(create_table_as(temporary, relation, compiled_code)) %}\n    {{ return(_dbt_max_partition + bq_insert_into_ingestion_time_partitioned_table_sql(relation, compiled_code)) }}\n  {% else %}\n    {{ return(_dbt_max_partition + create_table_as(temporary, relation, compiled_code, language)) }}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.declare_dbt_max_partition", "macro.dbt.run_query", "macro.dbt.create_table_as", "macro.dbt_bigquery.bq_insert_into_ingestion_time_partitioned_table_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5748816, "supported_languages": null}, "macro.dbt_bigquery.bq_generate_incremental_build_sql": {"name": "bq_generate_incremental_build_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental.sql", "original_file_path": "macros/materializations/incremental.sql", "unique_id": "macro.dbt_bigquery.bq_generate_incremental_build_sql", "macro_sql": "{% macro bq_generate_incremental_build_sql(\n    strategy, tmp_relation, target_relation, sql, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions, incremental_predicates\n) %}\n  {#-- if partitioned, use BQ scripting to get the range of partition values to be updated --#}\n  {% if strategy == 'insert_overwrite' %}\n\n    {% set build_sql = bq_generate_incremental_insert_overwrite_build_sql(\n        tmp_relation, target_relation, sql, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions\n    ) %}\n\n  {% else %} {# strategy == 'merge' #}\n\n    {% set build_sql = bq_generate_incremental_merge_build_sql(\n        tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, incremental_predicates\n    ) %}\n\n  {% endif %}\n\n  {{ return(build_sql) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bq_generate_incremental_insert_overwrite_build_sql", "macro.dbt_bigquery.bq_generate_incremental_merge_build_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.576112, "supported_languages": null}, "macro.dbt_bigquery.materialization_incremental_bigquery": {"name": "materialization_incremental_bigquery", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental.sql", "original_file_path": "macros/materializations/incremental.sql", "unique_id": "macro.dbt_bigquery.materialization_incremental_bigquery", "macro_sql": "{% materialization incremental, adapter='bigquery', supported_languages=['sql', 'python'] -%}\n\n  {%- set unique_key = config.get('unique_key') -%}\n  {%- set full_refresh_mode = (should_full_refresh()) -%}\n  {%- set language = model['language'] %}\n\n  {%- set target_relation = this %}\n  {%- set existing_relation = load_relation(this) %}\n  {%- set tmp_relation = make_temp_relation(this) %}\n\n  {#-- Validate early so we don't run SQL if the strategy is invalid --#}\n  {% set strategy = dbt_bigquery_validate_get_incremental_strategy(config) -%}\n\n  {%- set raw_partition_by = config.get('partition_by', none) -%}\n  {%- set partition_by = adapter.parse_partition_by(raw_partition_by) -%}\n  {%- set partitions = config.get('partitions', none) -%}\n  {%- set cluster_by = config.get('cluster_by', none) -%}\n\n  {% set on_schema_change = incremental_validate_on_schema_change(config.get('on_schema_change'), default='ignore') %}\n  {% set incremental_predicates = config.get('predicates', default=none) or config.get('incremental_predicates', default=none) %}\n\n   -- grab current tables grants config for comparison later on\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks) }}\n\n  {% if partition_by.copy_partitions is true and strategy != 'insert_overwrite' %} {#-- We can't copy partitions with merge strategy --#}\n        {% set wrong_strategy_msg -%}\n        The 'copy_partitions' option requires the 'incremental_strategy' option to be set to 'insert_overwrite'.\n        {%- endset %}\n        {% do exceptions.raise_compiler_error(wrong_strategy_msg) %}\n\n  {% elif existing_relation is none %}\n      {%- call statement('main', language=language) -%}\n        {{ bq_create_table_as(partition_by, False, target_relation, compiled_code, language) }}\n      {%- endcall -%}\n\n  {% elif existing_relation.is_view %}\n      {#-- There's no way to atomically replace a view with a table on BQ --#}\n      {{ adapter.drop_relation(existing_relation) }}\n      {%- call statement('main', language=language) -%}\n        {{ bq_create_table_as(partition_by, False, target_relation, compiled_code, language) }}\n      {%- endcall -%}\n\n  {% elif full_refresh_mode %}\n      {#-- If the partition/cluster config has changed, then we must drop and recreate --#}\n      {% if not adapter.is_replaceable(existing_relation, partition_by, cluster_by) %}\n          {% do log(\"Hard refreshing \" ~ existing_relation ~ \" because it is not replaceable\") %}\n          {{ adapter.drop_relation(existing_relation) }}\n      {% endif %}\n      {%- call statement('main', language=language) -%}\n        {{ bq_create_table_as(partition_by, False, target_relation, compiled_code, language) }}\n      {%- endcall -%}\n\n  {% else %}\n    {%- if language == 'python' and strategy == 'insert_overwrite' -%}\n      {#-- This lets us move forward assuming no python will be directly templated into a query --#}\n      {%- set python_unsupported_msg -%}\n        The 'insert_overwrite' strategy is not yet supported for python models.\n      {%- endset %}\n      {% do exceptions.raise_compiler_error(python_unsupported_msg) %}\n    {%- endif -%}\n\n    {% set tmp_relation_exists = false %}\n    {% if on_schema_change != 'ignore' or language == 'python' %}\n      {#-- Check first, since otherwise we may not build a temp table --#}\n      {#-- Python always needs to create a temp table --#}\n      {%- call statement('create_tmp_relation', language=language) -%}\n        {{ bq_create_table_as(partition_by, True, tmp_relation, compiled_code, language) }}\n      {%- endcall -%}\n      {% set tmp_relation_exists = true %}\n      {#-- Process schema changes. Returns dict of changes if successful. Use source columns for upserting/merging --#}\n      {% set dest_columns = process_schema_changes(on_schema_change, tmp_relation, existing_relation) %}\n    {% endif %}\n\n    {% if not dest_columns %}\n      {% set dest_columns = adapter.get_columns_in_relation(existing_relation) %}\n    {% endif %}\n    {#--  Add time ingestion pseudo column to destination column as not part of the 'schema' but still need it for actual data insertion --#}\n    {% if partition_by.time_ingestion_partitioning %}\n      {% set dest_columns = adapter.add_time_ingestion_partition_column(partition_by, dest_columns) %}\n    {% endif %}\n\n    {% set build_sql = bq_generate_incremental_build_sql(\n        strategy, tmp_relation, target_relation, compiled_code, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, partition_by.copy_partitions, incremental_predicates\n    ) %}\n\n    {%- call statement('main') -%}\n      {{ build_sql }}\n    {% endcall %}\n\n    {%- if language == 'python' and tmp_relation -%}\n      {{ adapter.drop_relation(tmp_relation) }}\n    {%- endif -%}\n\n  {% endif %}\n\n  {{ run_hooks(post_hooks) }}\n\n  {% set target_relation = this.incorporate(type='table') %}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh", "macro.dbt.load_relation", "macro.dbt.make_temp_relation", "macro.dbt_bigquery.dbt_bigquery_validate_get_incremental_strategy", "macro.dbt.incremental_validate_on_schema_change", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt_bigquery.bq_create_table_as", "macro.dbt.process_schema_changes", "macro.dbt_bigquery.bq_generate_incremental_build_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5838418, "supported_languages": ["sql", "python"]}, "macro.dbt_bigquery.bigquery__handle_existing_table": {"name": "bigquery__handle_existing_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/view.sql", "original_file_path": "macros/materializations/view.sql", "unique_id": "macro.dbt_bigquery.bigquery__handle_existing_table", "macro_sql": "{% macro bigquery__handle_existing_table(full_refresh, old_relation) %}\n    {%- if full_refresh -%}\n      {{ adapter.drop_relation(old_relation) }}\n    {%- else -%}\n      {{ exceptions.relation_wrong_type(old_relation, 'view') }}\n    {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5851529, "supported_languages": null}, "macro.dbt_bigquery.materialization_view_bigquery": {"name": "materialization_view_bigquery", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/view.sql", "original_file_path": "macros/materializations/view.sql", "unique_id": "macro.dbt_bigquery.materialization_view_bigquery", "macro_sql": "{% materialization view, adapter='bigquery' -%}\n    -- grab current tables grants config for comparision later on\n    {% set grant_config = config.get('grants') %}\n\n    {% set to_return = bigquery__create_or_replace_view() %}\n\n    {% set target_relation = this.incorporate(type='view') %}\n\n    {% do persist_docs(target_relation, model) %}\n\n    {% if config.get('grant_access_to') %}\n      {% for grant_target_dict in config.get('grant_access_to') %}\n        {% do adapter.grant_access_to(this, 'view', None, grant_target_dict) %}\n      {% endfor %}\n    {% endif %}\n\n    {% do return(to_return) %}\n\n{%- endmaterialization %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_or_replace_view", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.586318, "supported_languages": ["sql"]}, "macro.dbt_bigquery.bigquery__can_clone_table": {"name": "bigquery__can_clone_table", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/clone.sql", "original_file_path": "macros/materializations/clone.sql", "unique_id": "macro.dbt_bigquery.bigquery__can_clone_table", "macro_sql": "{% macro bigquery__can_clone_table() %}\n    {{ return(True) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5867271, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_or_replace_clone": {"name": "bigquery__create_or_replace_clone", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/clone.sql", "original_file_path": "macros/materializations/clone.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_or_replace_clone", "macro_sql": "{% macro bigquery__create_or_replace_clone(this_relation, defer_relation) %}\n    create or replace\n      table {{ this_relation }}\n      clone {{ defer_relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5869808, "supported_languages": null}, "macro.dbt_bigquery.bigquery__snapshot_hash_arguments": {"name": "bigquery__snapshot_hash_arguments", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/snapshot.sql", "original_file_path": "macros/materializations/snapshot.sql", "unique_id": "macro.dbt_bigquery.bigquery__snapshot_hash_arguments", "macro_sql": "{% macro bigquery__snapshot_hash_arguments(args) -%}\n  to_hex(md5(concat({%- for arg in args -%}\n    coalesce(cast({{ arg }} as string), ''){% if not loop.last %}, '|',{% endif -%}\n  {%- endfor -%}\n  )))\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5876887, "supported_languages": null}, "macro.dbt_bigquery.bigquery__create_columns": {"name": "bigquery__create_columns", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/snapshot.sql", "original_file_path": "macros/materializations/snapshot.sql", "unique_id": "macro.dbt_bigquery.bigquery__create_columns", "macro_sql": "{% macro bigquery__create_columns(relation, columns) %}\n  {{ adapter.alter_table_add_columns(relation, columns) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5879974, "supported_languages": null}, "macro.dbt_bigquery.bigquery__post_snapshot": {"name": "bigquery__post_snapshot", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/snapshot.sql", "original_file_path": "macros/materializations/snapshot.sql", "unique_id": "macro.dbt_bigquery.bigquery__post_snapshot", "macro_sql": "{% macro bigquery__post_snapshot(staging_relation) %}\n  -- Clean up the snapshot temp table\n  {% do drop_relation(staging_relation) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.drop_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.588264, "supported_languages": null}, "macro.dbt_bigquery.declare_dbt_max_partition": {"name": "declare_dbt_max_partition", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/common.sql", "original_file_path": "macros/materializations/incremental_strategy/common.sql", "unique_id": "macro.dbt_bigquery.declare_dbt_max_partition", "macro_sql": "{% macro declare_dbt_max_partition(relation, partition_by, compiled_code, language='sql') %}\n\n  {#-- TODO: revisit partitioning with python models --#}\n  {%- if '_dbt_max_partition' in compiled_code and language == 'sql' -%}\n\n    declare _dbt_max_partition {{ partition_by.data_type_for_partition() }} default (\n      select max({{ partition_by.field }}) from {{ this }}\n      where {{ partition_by.field }} is not null\n    );\n\n  {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5890548, "supported_languages": null}, "macro.dbt_bigquery.bq_generate_incremental_merge_build_sql": {"name": "bq_generate_incremental_merge_build_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/merge.sql", "original_file_path": "macros/materializations/incremental_strategy/merge.sql", "unique_id": "macro.dbt_bigquery.bq_generate_incremental_merge_build_sql", "macro_sql": "{% macro bq_generate_incremental_merge_build_sql(\n    tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, incremental_predicates\n) %}\n    {%- set source_sql -%}\n        {%- if tmp_relation_exists -%}\n        (\n        select\n        {% if partition_by.time_ingestion_partitioning -%}\n        {{ partition_by.insertable_time_partitioning_field() }},\n        {%- endif -%}\n        * from {{ tmp_relation }}\n        )\n        {%- else -%} {#-- wrap sql in parens to make it a subquery --#}\n        (\n            {%- if partition_by.time_ingestion_partitioning -%}\n            {{ wrap_with_time_ingestion_partitioning_sql(partition_by, sql, True) }}\n            {%- else -%}\n            {{sql}}\n            {%- endif %}\n        )\n        {%- endif -%}\n    {%- endset -%}\n\n    {% set build_sql = get_merge_sql(target_relation, source_sql, unique_key, dest_columns, incremental_predicates) %}\n\n    {{ return(build_sql) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql", "macro.dbt.get_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5905464, "supported_languages": null}, "macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql": {"name": "wrap_with_time_ingestion_partitioning_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "original_file_path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "unique_id": "macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql", "macro_sql": "{% macro wrap_with_time_ingestion_partitioning_sql(partition_by, sql, is_nested) %}\n\n  select TIMESTAMP({{ partition_by.field }}) as {{ partition_by.insertable_time_partitioning_field() }}, * EXCEPT({{ partition_by.field }}) from (\n    {{ sql }}\n  ){%- if not is_nested -%};{%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5924456, "supported_languages": null}, "macro.dbt_bigquery.get_quoted_with_types_csv": {"name": "get_quoted_with_types_csv", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "original_file_path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "unique_id": "macro.dbt_bigquery.get_quoted_with_types_csv", "macro_sql": "{% macro get_quoted_with_types_csv(columns) %}\n    {% set quoted = [] %}\n    {% for col in columns -%}\n        {%- do quoted.append(adapter.quote(col.name) ~ \" \" ~ col.data_type) -%}\n    {%- endfor %}\n    {%- set dest_cols_csv = quoted | join(', ') -%}\n    {{ return(dest_cols_csv) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5931518, "supported_languages": null}, "macro.dbt_bigquery.columns_without_partition_fields_csv": {"name": "columns_without_partition_fields_csv", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "original_file_path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "unique_id": "macro.dbt_bigquery.columns_without_partition_fields_csv", "macro_sql": "{% macro columns_without_partition_fields_csv(partition_config, columns) -%}\n  {%- set columns_no_partition = partition_config.reject_partition_field_column(columns) -%}\n  {% set columns_names = get_quoted_with_types_csv(columns_no_partition) %}\n  {{ return(columns_names) }}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_bigquery.get_quoted_with_types_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5936053, "supported_languages": null}, "macro.dbt_bigquery.bq_insert_into_ingestion_time_partitioned_table_sql": {"name": "bq_insert_into_ingestion_time_partitioned_table_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "original_file_path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "unique_id": "macro.dbt_bigquery.bq_insert_into_ingestion_time_partitioned_table_sql", "macro_sql": "{% macro bq_insert_into_ingestion_time_partitioned_table_sql(target_relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n  {{ sql_header if sql_header is not none }}\n  {%- set raw_partition_by = config.get('partition_by', none) -%}\n  {%- set partition_by = adapter.parse_partition_by(raw_partition_by) -%}\n  {% set dest_columns = adapter.get_columns_in_relation(target_relation) %}\n  {%- set dest_columns_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n  insert into {{ target_relation }} ({{ partition_by.insertable_time_partitioning_field() }}, {{ dest_columns_csv }})\n    {{ wrap_with_time_ingestion_partitioning_sql(partition_by, sql, False) }}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.get_quoted_csv", "macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.594766, "supported_languages": null}, "macro.dbt_bigquery.get_columns_with_types_in_query_sql": {"name": "get_columns_with_types_in_query_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "original_file_path": "macros/materializations/incremental_strategy/time_ingestion_tables.sql", "unique_id": "macro.dbt_bigquery.get_columns_with_types_in_query_sql", "macro_sql": "{% macro get_columns_with_types_in_query_sql(select_sql) %}\n  {% set sql %}\n    {%- set sql_header = config.get('sql_header', none) -%}\n    {{ sql_header if sql_header is not none }}\n    select * from (\n      {{ select_sql }}\n    ) as __dbt_sbq\n    where false\n    limit 0\n  {% endset %}\n  {{ return(adapter.get_columns_in_select_sql(sql)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5954914, "supported_languages": null}, "macro.dbt_bigquery.bq_generate_incremental_insert_overwrite_build_sql": {"name": "bq_generate_incremental_insert_overwrite_build_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_generate_incremental_insert_overwrite_build_sql", "macro_sql": "{% macro bq_generate_incremental_insert_overwrite_build_sql(\n    tmp_relation, target_relation, sql, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions\n) %}\n    {% if partition_by is none %}\n      {% set missing_partition_msg -%}\n      The 'insert_overwrite' strategy requires the `partition_by` config.\n      {%- endset %}\n      {% do exceptions.raise_compiler_error(missing_partition_msg) %}\n    {% endif %}\n\n    {% set build_sql = bq_insert_overwrite_sql(\n        tmp_relation, target_relation, sql, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions\n    ) %}\n\n    {{ return(build_sql) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bq_insert_overwrite_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.5991554, "supported_languages": null}, "macro.dbt_bigquery.bq_copy_partitions": {"name": "bq_copy_partitions", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_copy_partitions", "macro_sql": "{% macro bq_copy_partitions(tmp_relation, target_relation, partitions, partition_by) %}\n\n  {% for partition in partitions %}\n    {% if partition_by.data_type == 'int64' %}\n      {% set partition = partition | as_text %}\n    {% elif partition_by.granularity == 'hour' %}\n      {% set partition = partition.strftime(\"%Y%m%d%H\") %}\n    {% elif partition_by.granularity == 'day' %}\n      {% set partition = partition.strftime(\"%Y%m%d\") %}\n    {% elif partition_by.granularity == 'month' %}\n      {% set partition = partition.strftime(\"%Y%m\") %}\n    {% elif partition_by.granularity == 'year' %}\n      {% set partition = partition.strftime(\"%Y\") %}\n    {% endif %}\n    {% set tmp_relation_partitioned = api.Relation.create(database=tmp_relation.database, schema=tmp_relation.schema, identifier=tmp_relation.table ~ '$' ~ partition, type=tmp_relation.type) %}\n    {% set target_relation_partitioned = api.Relation.create(database=target_relation.database, schema=target_relation.schema, identifier=target_relation.table ~ '$' ~ partition, type=target_relation.type) %}\n    {% do adapter.copy_table(tmp_relation_partitioned, target_relation_partitioned, \"table\") %}\n  {% endfor %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6014435, "supported_languages": null}, "macro.dbt_bigquery.bq_insert_overwrite_sql": {"name": "bq_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_insert_overwrite_sql", "macro_sql": "{% macro bq_insert_overwrite_sql(\n    tmp_relation, target_relation, sql, unique_key, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions\n) %}\n  {% if partitions is not none and partitions != [] %} {# static #}\n      {{ bq_static_insert_overwrite_sql(tmp_relation, target_relation, sql, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions) }}\n  {% else %} {# dynamic #}\n      {{ bq_dynamic_insert_overwrite_sql(tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, copy_partitions) }}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bq_static_insert_overwrite_sql", "macro.dbt_bigquery.bq_dynamic_insert_overwrite_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6024182, "supported_languages": null}, "macro.dbt_bigquery.bq_static_insert_overwrite_sql": {"name": "bq_static_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_static_insert_overwrite_sql", "macro_sql": "{% macro bq_static_insert_overwrite_sql(\n    tmp_relation, target_relation, sql, partition_by, partitions, dest_columns, tmp_relation_exists, copy_partitions\n) %}\n\n      {% set predicate -%}\n          {{ partition_by.render_wrapped(alias='DBT_INTERNAL_DEST') }} in (\n              {{ partitions | join (', ') }}\n          )\n      {%- endset %}\n\n      {%- set source_sql -%}\n        (\n          {% if partition_by.time_ingestion_partitioning and tmp_relation_exists -%}\n          select\n            {{ partition_by.insertable_time_partitioning_field() }},\n            * from {{ tmp_relation }}\n          {% elif tmp_relation_exists -%}\n            select\n            * from {{ tmp_relation }}\n          {%- elif partition_by.time_ingestion_partitioning -%}\n            {{ wrap_with_time_ingestion_partitioning_sql(partition_by, sql, True) }}\n          {%- else -%}\n            {{sql}}\n          {%- endif -%}\n\n        )\n      {%- endset -%}\n\n      {% if copy_partitions %}\n          {% do bq_copy_partitions(tmp_relation, target_relation, partitions, partition_by) %}\n      {% else %}\n\n      {#-- In case we're putting the model SQL _directly_ into the MERGE statement,\n         we need to prepend the MERGE statement with the user-configured sql_header,\n         which may be needed to resolve that model SQL (e.g. referencing a variable or UDF in the header)\n         in the \"temporary table exists\" case, we save the model SQL result as a temp table first, wherein the\n         sql_header is included by the create_table_as macro.\n      #}\n      -- 1. run the merge statement\n      {{ get_insert_overwrite_merge_sql(target_relation, source_sql, dest_columns, [predicate], include_sql_header = not tmp_relation_exists) }};\n\n      {%- if tmp_relation_exists -%}\n      -- 2. clean up the temp table\n      drop table if exists {{ tmp_relation }};\n      {%- endif -%}\n\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.wrap_with_time_ingestion_partitioning_sql", "macro.dbt_bigquery.bq_copy_partitions", "macro.dbt.get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6042535, "supported_languages": null}, "macro.dbt_bigquery.bq_dynamic_copy_partitions_insert_overwrite_sql": {"name": "bq_dynamic_copy_partitions_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_dynamic_copy_partitions_insert_overwrite_sql", "macro_sql": "{% macro bq_dynamic_copy_partitions_insert_overwrite_sql(\n  tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, copy_partitions\n  ) %}\n  {%- if tmp_relation_exists is false -%}\n  {# We run temp table creation in a separated script to move to partitions copy if it doesn't already exist #}\n    {%- call statement('create_tmp_relation_for_copy', language='sql') -%}\n      {{ bq_create_table_as(partition_by, True, tmp_relation, sql, 'sql')\n    }}\n    {%- endcall %}\n  {%- endif -%}\n  {%- set partitions_sql -%}\n    select distinct {{ partition_by.render_wrapped() }}\n    from {{ tmp_relation }}\n  {%- endset -%}\n  {%- set partitions = run_query(partitions_sql).columns[0].values() -%}\n  {# We copy the partitions #}\n  {%- do bq_copy_partitions(tmp_relation, target_relation, partitions, partition_by) -%}\n  -- Clean up the temp table\n  drop table if exists {{ tmp_relation }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_bigquery.bq_create_table_as", "macro.dbt.run_query", "macro.dbt_bigquery.bq_copy_partitions"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6054964, "supported_languages": null}, "macro.dbt_bigquery.bq_dynamic_insert_overwrite_sql": {"name": "bq_dynamic_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "original_file_path": "macros/materializations/incremental_strategy/insert_overwrite.sql", "unique_id": "macro.dbt_bigquery.bq_dynamic_insert_overwrite_sql", "macro_sql": "{% macro bq_dynamic_insert_overwrite_sql(tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, copy_partitions) %}\n  {%- if copy_partitions is true %}\n     {{ bq_dynamic_copy_partitions_insert_overwrite_sql(tmp_relation, target_relation, sql, unique_key, partition_by, dest_columns, tmp_relation_exists, copy_partitions) }}\n  {% else -%}\n      {% set predicate -%}\n          {{ partition_by.render_wrapped(alias='DBT_INTERNAL_DEST') }} in unnest(dbt_partitions_for_replacement)\n      {%- endset %}\n\n      {%- set source_sql -%}\n      (\n        select\n        {% if partition_by.time_ingestion_partitioning -%}\n        {{ partition_by.insertable_time_partitioning_field() }},\n        {%- endif -%}\n        * from {{ tmp_relation }}\n      )\n      {%- endset -%}\n\n      -- generated script to merge partitions into {{ target_relation }}\n      declare dbt_partitions_for_replacement array<{{ partition_by.data_type_for_partition() }}>;\n\n      {# have we already created the temp table to check for schema changes? #}\n      {% if not tmp_relation_exists %}\n       -- 1. create a temp table with model data\n        {{ bq_create_table_as(partition_by, True, tmp_relation, sql, 'sql') }}\n      {% else %}\n        -- 1. temp table already exists, we used it to check for schema changes\n      {% endif %}\n      {%- set partition_field = partition_by.time_partitioning_field() if partition_by.time_ingestion_partitioning else partition_by.render_wrapped() -%}\n\n      -- 2. define partitions to update\n      set (dbt_partitions_for_replacement) = (\n          select as struct\n              -- IGNORE NULLS: this needs to be aligned to _dbt_max_partition, which ignores null\n              array_agg(distinct {{ partition_field }} IGNORE NULLS)\n          from {{ tmp_relation }}\n      );\n\n      -- 3. run the merge statement\n      {{ get_insert_overwrite_merge_sql(target_relation, source_sql, dest_columns, [predicate]) }};\n\n      -- 4. clean up the temp table\n      drop table if exists {{ tmp_relation }}\n\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bq_dynamic_copy_partitions_insert_overwrite_sql", "macro.dbt_bigquery.bq_create_table_as", "macro.dbt.get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6074438, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_show_grant_sql": {"name": "bigquery__get_show_grant_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_show_grant_sql", "macro_sql": "{% macro bigquery__get_show_grant_sql(relation) %}\n    {% set location = adapter.get_dataset_location(relation) %}\n    {% set relation = relation.incorporate(location=location) %}\n\n    select privilege_type, grantee\n    from {{ relation.information_schema(\"OBJECT_PRIVILEGES\") }}\n    where object_schema = \"{{ relation.dataset }}\"\n      and object_name = \"{{ relation.identifier }}\"\n      -- filter out current user\n      and split(grantee, ':')[offset(1)] != session_user()\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6084476, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_grant_sql": {"name": "bigquery__get_grant_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_grant_sql", "macro_sql": "\n\n\n{%- macro bigquery__get_grant_sql(relation, privilege, grantee) -%}\n    grant `{{ privilege }}` on {{ relation.type }} {{ relation }} to {{ '\\\"' + grantee|join('\\\", \\\"') + '\\\"' }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6088917, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_revoke_sql": {"name": "bigquery__get_revoke_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_revoke_sql", "macro_sql": "{%- macro bigquery__get_revoke_sql(relation, privilege, grantee) -%}\n    revoke `{{ privilege }}` on {{ relation.type }} {{ relation }} from {{ '\\\"' + grantee|join('\\\", \\\"') + '\\\"' }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6093252, "supported_languages": null}, "macro.dbt_bigquery.bigquery__get_empty_subquery_sql": {"name": "bigquery__get_empty_subquery_sql", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt_bigquery.bigquery__get_empty_subquery_sql", "macro_sql": "{% macro bigquery__get_empty_subquery_sql(select_sql, select_sql_header=none) %}\n    {%- if select_sql_header is not none -%}\n    {{ select_sql_header }}\n    {%- endif -%}\n    select * from (\n        {{ select_sql }}\n    ) as __dbt_sbq\n    where false and current_timestamp() = current_timestamp()\n    limit 0\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6098197, "supported_languages": null}, "macro.dbt_bigquery.bigquery__resolve_model_name": {"name": "bigquery__resolve_model_name", "resource_type": "macro", "package_name": "dbt_bigquery", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt_bigquery.bigquery__resolve_model_name", "macro_sql": "{% macro bigquery__resolve_model_name(input_model_name) -%}\n    {{ input_model_name | string | replace('`', '') | replace('\"', '\\\"') }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.61024, "supported_languages": null}, "macro.dbt.get_create_intermediate_sql": {"name": "get_create_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_intermediate.sql", "original_file_path": "macros/relations/create_intermediate.sql", "unique_id": "macro.dbt.get_create_intermediate_sql", "macro_sql": "{%- macro get_create_intermediate_sql(relation, sql) -%}\n    {{- log('Applying CREATE INTERMEDIATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_intermediate_sql', 'dbt')(relation, sql) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_intermediate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6108549, "supported_languages": null}, "macro.dbt.default__get_create_intermediate_sql": {"name": "default__get_create_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_intermediate.sql", "original_file_path": "macros/relations/create_intermediate.sql", "unique_id": "macro.dbt.default__get_create_intermediate_sql", "macro_sql": "{%- macro default__get_create_intermediate_sql(relation, sql) -%}\n\n    -- get the standard intermediate name\n    {% set intermediate_relation = make_intermediate_relation(relation) %}\n\n    -- drop any pre-existing intermediate\n    {{ get_drop_sql(intermediate_relation) }};\n\n    {{ get_create_sql(intermediate_relation, sql) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_intermediate_relation", "macro.dbt.get_drop_sql", "macro.dbt.get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6113987, "supported_languages": null}, "macro.dbt.get_rename_sql": {"name": "get_rename_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.get_rename_sql", "macro_sql": "{%- macro get_rename_sql(relation, new_name) -%}\n    {{- log('Applying RENAME to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_rename_sql', 'dbt')(relation, new_name) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6124475, "supported_languages": null}, "macro.dbt.default__get_rename_sql": {"name": "default__get_rename_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.default__get_rename_sql", "macro_sql": "{%- macro default__get_rename_sql(relation, new_name) -%}\n\n    {%- if relation.is_view -%}\n        {{ get_rename_view_sql(relation, new_name) }}\n\n    {%- elif relation.is_table -%}\n        {{ get_rename_table_sql(relation, new_name) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ get_rename_materialized_view_sql(relation, new_name) }}\n\n    {%- else -%}\n        {{- exceptions.raise_compiler_error(\"`get_rename_sql` has not been implemented for: \" ~ relation.type ) -}}\n\n    {%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.get_rename_view_sql", "macro.dbt.get_rename_table_sql", "macro.dbt.get_rename_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6132362, "supported_languages": null}, "macro.dbt.rename_relation": {"name": "rename_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.rename_relation", "macro_sql": "{% macro rename_relation(from_relation, to_relation) -%}\n  {{ return(adapter.dispatch('rename_relation', 'dbt')(from_relation, to_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__rename_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6136136, "supported_languages": null}, "macro.dbt.default__rename_relation": {"name": "default__rename_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.default__rename_relation", "macro_sql": "{% macro default__rename_relation(from_relation, to_relation) -%}\n  {% set target_name = adapter.quote_as_configured(to_relation.identifier, 'identifier') %}\n  {% call statement('rename_relation') -%}\n    alter table {{ from_relation }} rename to {{ target_name }}\n  {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6141315, "supported_languages": null}, "macro.dbt.get_drop_sql": {"name": "get_drop_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.get_drop_sql", "macro_sql": "{%- macro get_drop_sql(relation) -%}\n    {{- log('Applying DROP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_drop_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6151302, "supported_languages": null}, "macro.dbt.default__get_drop_sql": {"name": "default__get_drop_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.default__get_drop_sql", "macro_sql": "{%- macro default__get_drop_sql(relation) -%}\n\n    {%- if relation.is_view -%}\n        {{ drop_view(relation) }}\n\n    {%- elif relation.is_table -%}\n        {{ drop_table(relation) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ drop_materialized_view(relation) }}\n\n    {%- else -%}\n        drop {{ relation.type }} if exists {{ relation }} cascade\n\n    {%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.drop_view", "macro.dbt.drop_table", "macro.dbt.drop_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.615827, "supported_languages": null}, "macro.dbt.drop_relation": {"name": "drop_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.drop_relation", "macro_sql": "{% macro drop_relation(relation) -%}\n    {{ return(adapter.dispatch('drop_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__drop_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6161613, "supported_languages": null}, "macro.dbt.default__drop_relation": {"name": "default__drop_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.default__drop_relation", "macro_sql": "{% macro default__drop_relation(relation) -%}\n    {% call statement('drop_relation', auto_begin=False) -%}\n        {{ get_drop_sql(relation) }}\n    {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6165264, "supported_languages": null}, "macro.dbt.drop_relation_if_exists": {"name": "drop_relation_if_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.drop_relation_if_exists", "macro_sql": "{% macro drop_relation_if_exists(relation) %}\n  {% if relation is not none %}\n    {{ adapter.drop_relation(relation) }}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.616884, "supported_languages": null}, "macro.dbt.get_replace_sql": {"name": "get_replace_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/replace.sql", "original_file_path": "macros/relations/replace.sql", "unique_id": "macro.dbt.get_replace_sql", "macro_sql": "{% macro get_replace_sql(existing_relation, target_relation, sql) %}\n    {{- log('Applying REPLACE to: ' ~ existing_relation) -}}\n    {{- adapter.dispatch('get_replace_sql', 'dbt')(existing_relation, target_relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6179912, "supported_languages": null}, "macro.dbt.default__get_replace_sql": {"name": "default__get_replace_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/replace.sql", "original_file_path": "macros/relations/replace.sql", "unique_id": "macro.dbt.default__get_replace_sql", "macro_sql": "{% macro default__get_replace_sql(existing_relation, target_relation, sql) %}\n\n    {# /* use a create or replace statement if possible */ #}\n\n    {% set is_replaceable = existing_relation.type == target_relation_type and existing_relation.can_be_replaced %}\n\n    {% if is_replaceable and existing_relation.is_view %}\n        {{ get_replace_view_sql(target_relation, sql) }}\n\n    {% elif is_replaceable and existing_relation.is_table %}\n        {{ get_replace_table_sql(target_relation, sql) }}\n\n    {% elif is_replaceable and existing_relation.is_materialized_view %}\n        {{ get_replace_materialized_view_sql(target_relation, sql) }}\n\n    {# /* a create or replace statement is not possible, so try to stage and/or backup to be safe */ #}\n\n    {# /* create target_relation as an intermediate relation, then swap it out with the existing one using a backup */ #}\n    {%- elif target_relation.can_be_renamed and existing_relation.can_be_renamed -%}\n        {{ get_create_intermediate_sql(target_relation, sql) }};\n        {{ get_create_backup_sql(existing_relation) }};\n        {{ get_rename_intermediate_sql(target_relation) }};\n        {{ get_drop_backup_sql(existing_relation) }}\n\n    {# /* create target_relation as an intermediate relation, then swap it out with the existing one without using a backup */ #}\n    {%- elif target_relation.can_be_renamed -%}\n        {{ get_create_intermediate_sql(target_relation, sql) }};\n        {{ get_drop_sql(existing_relation) }};\n        {{ get_rename_intermediate_sql(target_relation) }}\n\n    {# /* create target_relation in place by first backing up the existing relation */ #}\n    {%- elif existing_relation.can_be_renamed -%}\n        {{ get_create_backup_sql(existing_relation) }};\n        {{ get_create_sql(target_relation, sql) }};\n        {{ get_drop_backup_sql(existing_relation) }}\n\n    {# /* no renaming is allowed, so just drop and create */ #}\n    {%- else -%}\n        {{ get_drop_sql(existing_relation) }};\n        {{ get_create_sql(target_relation, sql) }}\n\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_replace_view_sql", "macro.dbt.get_replace_table_sql", "macro.dbt.get_replace_materialized_view_sql", "macro.dbt.get_create_intermediate_sql", "macro.dbt.get_create_backup_sql", "macro.dbt.get_rename_intermediate_sql", "macro.dbt.get_drop_backup_sql", "macro.dbt.get_drop_sql", "macro.dbt.get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.62022, "supported_languages": null}, "macro.dbt.get_create_sql": {"name": "get_create_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create.sql", "original_file_path": "macros/relations/create.sql", "unique_id": "macro.dbt.get_create_sql", "macro_sql": "{%- macro get_create_sql(relation, sql) -%}\n    {{- log('Applying CREATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_sql', 'dbt')(relation, sql) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6209629, "supported_languages": null}, "macro.dbt.default__get_create_sql": {"name": "default__get_create_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create.sql", "original_file_path": "macros/relations/create.sql", "unique_id": "macro.dbt.default__get_create_sql", "macro_sql": "{%- macro default__get_create_sql(relation, sql) -%}\n\n    {%- if relation.is_view -%}\n        {{ get_create_view_as_sql(relation, sql) }}\n\n    {%- elif relation.is_table -%}\n        {{ get_create_table_as_sql(False, relation, sql) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ get_create_materialized_view_as_sql(relation, sql) }}\n\n    {%- else -%}\n        {{- exceptions.raise_compiler_error(\"`get_create_sql` has not been implemented for: \" ~ relation.type ) -}}\n\n    {%- endif -%}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.get_create_view_as_sql", "macro.dbt.get_create_table_as_sql", "macro.dbt.get_create_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6217554, "supported_languages": null}, "macro.dbt.get_drop_backup_sql": {"name": "get_drop_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop_backup.sql", "original_file_path": "macros/relations/drop_backup.sql", "unique_id": "macro.dbt.get_drop_backup_sql", "macro_sql": "{%- macro get_drop_backup_sql(relation) -%}\n    {{- log('Applying DROP BACKUP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_drop_backup_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_drop_backup_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6223252, "supported_languages": null}, "macro.dbt.default__get_drop_backup_sql": {"name": "default__get_drop_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop_backup.sql", "original_file_path": "macros/relations/drop_backup.sql", "unique_id": "macro.dbt.default__get_drop_backup_sql", "macro_sql": "{%- macro default__get_drop_backup_sql(relation) -%}\n\n    -- get the standard backup name\n    {% set backup_relation = make_backup_relation(relation, relation.type) %}\n\n    {{ get_drop_sql(backup_relation) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_backup_relation", "macro.dbt.get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.622716, "supported_languages": null}, "macro.dbt.get_rename_intermediate_sql": {"name": "get_rename_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename_intermediate.sql", "original_file_path": "macros/relations/rename_intermediate.sql", "unique_id": "macro.dbt.get_rename_intermediate_sql", "macro_sql": "{%- macro get_rename_intermediate_sql(relation) -%}\n    {{- log('Applying RENAME INTERMEDIATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_rename_intermediate_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_rename_intermediate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6232905, "supported_languages": null}, "macro.dbt.default__get_rename_intermediate_sql": {"name": "default__get_rename_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename_intermediate.sql", "original_file_path": "macros/relations/rename_intermediate.sql", "unique_id": "macro.dbt.default__get_rename_intermediate_sql", "macro_sql": "{%- macro default__get_rename_intermediate_sql(relation) -%}\n\n    -- get the standard intermediate name\n    {% set intermediate_relation = make_intermediate_relation(relation) %}\n\n    {{ get_rename_sql(intermediate_relation, relation.identifier) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_intermediate_relation", "macro.dbt.get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6236668, "supported_languages": null}, "macro.dbt.get_create_backup_sql": {"name": "get_create_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_backup.sql", "original_file_path": "macros/relations/create_backup.sql", "unique_id": "macro.dbt.get_create_backup_sql", "macro_sql": "{%- macro get_create_backup_sql(relation) -%}\n    {{- log('Applying CREATE BACKUP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_backup_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_backup_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6242404, "supported_languages": null}, "macro.dbt.default__get_create_backup_sql": {"name": "default__get_create_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_backup.sql", "original_file_path": "macros/relations/create_backup.sql", "unique_id": "macro.dbt.default__get_create_backup_sql", "macro_sql": "{%- macro default__get_create_backup_sql(relation) -%}\n\n    -- get the standard backup name\n    {% set backup_relation = make_backup_relation(relation, relation.type) %}\n\n    -- drop any pre-existing backup\n    {{ get_drop_sql(backup_relation) }};\n\n    {{ get_rename_sql(relation, backup_relation.identifier) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_backup_relation", "macro.dbt.get_drop_sql", "macro.dbt.get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6247199, "supported_languages": null}, "macro.dbt.get_rename_table_sql": {"name": "get_rename_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt.get_rename_table_sql", "macro_sql": "{% macro get_rename_table_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_table_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_rename_table_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6251872, "supported_languages": null}, "macro.dbt.default__get_rename_table_sql": {"name": "default__get_rename_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt.default__get_rename_table_sql", "macro_sql": "{% macro default__get_rename_table_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_table_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6254632, "supported_languages": null}, "macro.dbt.drop_table": {"name": "drop_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt.drop_table", "macro_sql": "{% macro drop_table(relation) -%}\n    {{ return(adapter.dispatch('drop_table', 'dbt')(relation)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__drop_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6259181, "supported_languages": null}, "macro.dbt.default__drop_table": {"name": "default__drop_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt.default__drop_table", "macro_sql": "{% macro default__drop_table(relation) -%}\n    drop table if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6261237, "supported_languages": null}, "macro.dbt.get_replace_table_sql": {"name": "get_replace_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/replace.sql", "original_file_path": "macros/relations/table/replace.sql", "unique_id": "macro.dbt.get_replace_table_sql", "macro_sql": "{% macro get_replace_table_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_table_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_table_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6265864, "supported_languages": null}, "macro.dbt.default__get_replace_table_sql": {"name": "default__get_replace_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/replace.sql", "original_file_path": "macros/relations/table/replace.sql", "unique_id": "macro.dbt.default__get_replace_table_sql", "macro_sql": "{% macro default__get_replace_table_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_table_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6268616, "supported_languages": null}, "macro.dbt.get_create_table_as_sql": {"name": "get_create_table_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.get_create_table_as_sql", "macro_sql": "{% macro get_create_table_as_sql(temporary, relation, sql) -%}\n  {{ adapter.dispatch('get_create_table_as_sql', 'dbt')(temporary, relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_create_table_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6281502, "supported_languages": null}, "macro.dbt.default__get_create_table_as_sql": {"name": "default__get_create_table_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_create_table_as_sql", "macro_sql": "{% macro default__get_create_table_as_sql(temporary, relation, sql) -%}\n  {{ return(create_table_as(temporary, relation, sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6285198, "supported_languages": null}, "macro.dbt.create_table_as": {"name": "create_table_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.create_table_as", "macro_sql": "{% macro create_table_as(temporary, relation, compiled_code, language='sql') -%}\n  {# backward compatibility for create_table_as that does not support language #}\n  {% if language == \"sql\" %}\n    {{ adapter.dispatch('create_table_as', 'dbt')(temporary, relation, compiled_code)}}\n  {% else %}\n    {{ adapter.dispatch('create_table_as', 'dbt')(temporary, relation, compiled_code, language) }}\n  {% endif %}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.629751, "supported_languages": null}, "macro.dbt.default__create_table_as": {"name": "default__create_table_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__create_table_as", "macro_sql": "{% macro default__create_table_as(temporary, relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create {% if temporary: -%}temporary{%- endif %} table\n    {{ relation.include(database=(not temporary), schema=(not temporary)) }}\n  {% set contract_config = config.get('contract') %}\n  {% if contract_config.enforced and (not temporary) %}\n    {{ get_assert_columns_equivalent(sql) }}\n    {{ get_table_columns_and_constraints() }}\n    {%- set sql = get_select_subquery(sql) %}\n  {% endif %}\n  as (\n    {{ sql }}\n  );\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_table_columns_and_constraints", "macro.dbt.get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6317744, "supported_languages": null}, "macro.dbt.default__get_column_names": {"name": "default__get_column_names", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_column_names", "macro_sql": "{% macro default__get_column_names() %}\n  {#- loop through user_provided_columns to get column names -#}\n    {%- set user_provided_columns = model['columns'] -%}\n    {%- for i in user_provided_columns %}\n      {%- set col = user_provided_columns[i] -%}\n      {%- set col_name = adapter.quote(col['name']) if col.get('quote') else col['name'] -%}\n      {{ col_name }}{{ \", \" if not loop.last }}\n    {%- endfor -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6329098, "supported_languages": null}, "macro.dbt.get_select_subquery": {"name": "get_select_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.get_select_subquery", "macro_sql": "{% macro get_select_subquery(sql) %}\n  {{ return(adapter.dispatch('get_select_subquery', 'dbt')(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6332543, "supported_languages": null}, "macro.dbt.default__get_select_subquery": {"name": "default__get_select_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_select_subquery", "macro_sql": "{% macro default__get_select_subquery(sql) %}\n    select {{ adapter.dispatch('get_column_names', 'dbt')() }}\n    from (\n        {{ sql }}\n    ) as model_subq\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_column_names"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.633582, "supported_languages": null}, "macro.dbt.get_table_columns_and_constraints": {"name": "get_table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.get_table_columns_and_constraints", "macro_sql": "{%- macro get_table_columns_and_constraints() -%}\n  {{ adapter.dispatch('get_table_columns_and_constraints', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__get_table_columns_and_constraints"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6350174, "supported_languages": null}, "macro.dbt.default__get_table_columns_and_constraints": {"name": "default__get_table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__get_table_columns_and_constraints", "macro_sql": "{% macro default__get_table_columns_and_constraints() -%}\n  {{ return(table_columns_and_constraints()) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.table_columns_and_constraints"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6352494, "supported_languages": null}, "macro.dbt.table_columns_and_constraints": {"name": "table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.table_columns_and_constraints", "macro_sql": "{% macro table_columns_and_constraints() %}\n  {# loop through user_provided_columns to create DDL with data types and constraints #}\n    {%- set raw_column_constraints = adapter.render_raw_columns_constraints(raw_columns=model['columns']) -%}\n    {%- set raw_model_constraints = adapter.render_raw_model_constraints(raw_constraints=model['constraints']) -%}\n    (\n    {% for c in raw_column_constraints -%}\n      {{ c }}{{ \",\" if not loop.last or raw_model_constraints }}\n    {% endfor %}\n    {% for c in raw_model_constraints -%}\n        {{ c }}{{ \",\" if not loop.last }}\n    {% endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6362655, "supported_languages": null}, "macro.dbt.get_assert_columns_equivalent": {"name": "get_assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.get_assert_columns_equivalent", "macro_sql": "\n\n{%- macro get_assert_columns_equivalent(sql) -%}\n  {{ adapter.dispatch('get_assert_columns_equivalent', 'dbt')(sql) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6365747, "supported_languages": null}, "macro.dbt.default__get_assert_columns_equivalent": {"name": "default__get_assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__get_assert_columns_equivalent", "macro_sql": "{% macro default__get_assert_columns_equivalent(sql) -%}\n  {{ return(assert_columns_equivalent(sql)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6368794, "supported_languages": null}, "macro.dbt.assert_columns_equivalent": {"name": "assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.assert_columns_equivalent", "macro_sql": "{% macro assert_columns_equivalent(sql) %}\n\n  {#-- First ensure the user has defined 'columns' in yaml specification --#}\n  {%- set user_defined_columns = model['columns'] -%}\n  {%- if not user_defined_columns -%}\n      {{ exceptions.raise_contract_error([], []) }}\n  {%- endif -%}\n\n  {#-- Obtain the column schema provided by sql file. #}\n  {%- set sql_file_provided_columns = get_column_schema_from_query(sql, config.get('sql_header', none)) -%}\n  {#--Obtain the column schema provided by the schema file by generating an 'empty schema' query from the model's columns. #}\n  {%- set schema_file_provided_columns = get_column_schema_from_query(get_empty_schema_sql(user_defined_columns)) -%}\n\n  {#-- create dictionaries with name and formatted data type and strings for exception #}\n  {%- set sql_columns = format_columns(sql_file_provided_columns) -%}\n  {%- set yaml_columns = format_columns(schema_file_provided_columns)  -%}\n\n  {%- if sql_columns|length != yaml_columns|length -%}\n    {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n  {%- endif -%}\n\n  {%- for sql_col in sql_columns -%}\n    {%- set yaml_col = [] -%}\n    {%- for this_col in yaml_columns -%}\n      {%- if this_col['name'] == sql_col['name'] -%}\n        {%- do yaml_col.append(this_col) -%}\n        {%- break -%}\n      {%- endif -%}\n    {%- endfor -%}\n    {%- if not yaml_col -%}\n      {#-- Column with name not found in yaml #}\n      {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n    {%- endif -%}\n    {%- if sql_col['formatted'] != yaml_col[0]['formatted'] -%}\n      {#-- Column data types don't match #}\n      {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n    {%- endif -%}\n  {%- endfor -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_column_schema_from_query", "macro.dbt.get_empty_schema_sql", "macro.dbt.format_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6390924, "supported_languages": null}, "macro.dbt.format_columns": {"name": "format_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.format_columns", "macro_sql": "{% macro format_columns(columns) %}\n  {% set formatted_columns = [] %}\n  {% for column in columns %}\n    {%- set formatted_column = adapter.dispatch('format_column', 'dbt')(column) -%}\n    {%- do formatted_columns.append(formatted_column) -%}\n  {% endfor %}\n  {{ return(formatted_columns) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__format_column"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6398177, "supported_languages": null}, "macro.dbt.default__format_column": {"name": "default__format_column", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__format_column", "macro_sql": "{% macro default__format_column(column) -%}\n  {% set data_type = column.dtype %}\n  {% set formatted = column.column.lower() ~ \" \" ~ data_type %}\n  {{ return({'name': column.name, 'data_type': data_type, 'formatted': formatted}) }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.640422, "supported_languages": null}, "macro.dbt.get_rename_view_sql": {"name": "get_rename_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt.get_rename_view_sql", "macro_sql": "{% macro get_rename_view_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_view_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_rename_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6408997, "supported_languages": null}, "macro.dbt.default__get_rename_view_sql": {"name": "default__get_rename_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt.default__get_rename_view_sql", "macro_sql": "{% macro default__get_rename_view_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6411738, "supported_languages": null}, "macro.dbt.drop_view": {"name": "drop_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt.drop_view", "macro_sql": "{% macro drop_view(relation) -%}\n    {{ return(adapter.dispatch('drop_view', 'dbt')(relation)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__drop_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6416256, "supported_languages": null}, "macro.dbt.default__drop_view": {"name": "default__drop_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt.default__drop_view", "macro_sql": "{% macro default__drop_view(relation) -%}\n    drop view if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6418307, "supported_languages": null}, "macro.dbt.get_replace_view_sql": {"name": "get_replace_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.get_replace_view_sql", "macro_sql": "{% macro get_replace_view_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_view_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6430528, "supported_languages": null}, "macro.dbt.default__get_replace_view_sql": {"name": "default__get_replace_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.default__get_replace_view_sql", "macro_sql": "{% macro default__get_replace_view_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6433766, "supported_languages": null}, "macro.dbt.create_or_replace_view": {"name": "create_or_replace_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.create_or_replace_view", "macro_sql": "{% macro create_or_replace_view() %}\n  {%- set identifier = model['alias'] -%}\n\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n  {%- set exists_as_view = (old_relation is not none and old_relation.is_view) -%}\n\n  {%- set target_relation = api.Relation.create(\n      identifier=identifier, schema=schema, database=database,\n      type='view') -%}\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks) }}\n\n  -- If there's a table with the same name and we weren't told to full refresh,\n  -- that's an error. If we were told to full refresh, drop it. This behavior differs\n  -- for Snowflake and BigQuery, so multiple dispatch is used.\n  {%- if old_relation is not none and old_relation.is_table -%}\n    {{ handle_existing_table(should_full_refresh(), old_relation) }}\n  {%- endif -%}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(target_relation, sql) }}\n  {%- endcall %}\n\n  {% set should_revoke = should_revoke(exists_as_view, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {{ run_hooks(post_hooks) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.handle_existing_table", "macro.dbt.should_full_refresh", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.645486, "supported_languages": null}, "macro.dbt.handle_existing_table": {"name": "handle_existing_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.handle_existing_table", "macro_sql": "{% macro handle_existing_table(full_refresh, old_relation) %}\n    {{ adapter.dispatch('handle_existing_table', 'dbt')(full_refresh, old_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__handle_existing_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.645947, "supported_languages": null}, "macro.dbt.default__handle_existing_table": {"name": "default__handle_existing_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.default__handle_existing_table", "macro_sql": "{% macro default__handle_existing_table(full_refresh, old_relation) %}\n    {{ log(\"Dropping relation \" ~ old_relation ~ \" because it is of type \" ~ old_relation.type) }}\n    {{ adapter.drop_relation(old_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.646352, "supported_languages": null}, "macro.dbt.get_create_view_as_sql": {"name": "get_create_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.get_create_view_as_sql", "macro_sql": "{% macro get_create_view_as_sql(relation, sql) -%}\n  {{ adapter.dispatch('get_create_view_as_sql', 'dbt')(relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_create_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.647069, "supported_languages": null}, "macro.dbt.default__get_create_view_as_sql": {"name": "default__get_create_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.default__get_create_view_as_sql", "macro_sql": "{% macro default__get_create_view_as_sql(relation, sql) -%}\n  {{ return(create_view_as(relation, sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_view_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6474218, "supported_languages": null}, "macro.dbt.create_view_as": {"name": "create_view_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.create_view_as", "macro_sql": "{% macro create_view_as(relation, sql) -%}\n  {{ adapter.dispatch('create_view_as', 'dbt')(relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_view_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6477757, "supported_languages": null}, "macro.dbt.default__create_view_as": {"name": "default__create_view_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.default__create_view_as", "macro_sql": "{% macro default__create_view_as(relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n  create view {{ relation }}\n    {% set contract_config = config.get('contract') %}\n    {% if contract_config.enforced %}\n      {{ get_assert_columns_equivalent(sql) }}\n    {%- endif %}\n  as (\n    {{ sql }}\n  );\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6486304, "supported_languages": null}, "macro.dbt.get_rename_materialized_view_sql": {"name": "get_rename_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/rename.sql", "original_file_path": "macros/relations/materialized_view/rename.sql", "unique_id": "macro.dbt.get_rename_materialized_view_sql", "macro_sql": "{% macro get_rename_materialized_view_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_materialized_view_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_rename_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6493273, "supported_languages": null}, "macro.dbt.default__get_rename_materialized_view_sql": {"name": "default__get_rename_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/rename.sql", "original_file_path": "macros/relations/materialized_view/rename.sql", "unique_id": "macro.dbt.default__get_rename_materialized_view_sql", "macro_sql": "{% macro default__get_rename_materialized_view_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_materialized_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6497383, "supported_languages": null}, "macro.dbt.refresh_materialized_view": {"name": "refresh_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt.refresh_materialized_view", "macro_sql": "{% macro refresh_materialized_view(relation) %}\n    {{- log('Applying REFRESH to: ' ~ relation) -}}\n    {{- adapter.dispatch('refresh_materialized_view', 'dbt')(relation) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__refresh_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6502845, "supported_languages": null}, "macro.dbt.default__refresh_materialized_view": {"name": "default__refresh_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt.default__refresh_materialized_view", "macro_sql": "{% macro default__refresh_materialized_view(relation) %}\n    {{ exceptions.raise_compiler_error(\"`refresh_materialized_view` has not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6505473, "supported_languages": null}, "macro.dbt.drop_materialized_view": {"name": "drop_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt.drop_materialized_view", "macro_sql": "{% macro drop_materialized_view(relation) -%}\n    {{ return(adapter.dispatch('drop_materialized_view', 'dbt')(relation)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__drop_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6510522, "supported_languages": null}, "macro.dbt.default__drop_materialized_view": {"name": "default__drop_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt.default__drop_materialized_view", "macro_sql": "{% macro default__drop_materialized_view(relation) -%}\n    drop materialized view if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6513271, "supported_languages": null}, "macro.dbt.get_replace_materialized_view_sql": {"name": "get_replace_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/replace.sql", "original_file_path": "macros/relations/materialized_view/replace.sql", "unique_id": "macro.dbt.get_replace_materialized_view_sql", "macro_sql": "{% macro get_replace_materialized_view_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_materialized_view_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6518176, "supported_languages": null}, "macro.dbt.default__get_replace_materialized_view_sql": {"name": "default__get_replace_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/replace.sql", "original_file_path": "macros/relations/materialized_view/replace.sql", "unique_id": "macro.dbt.default__get_replace_materialized_view_sql", "macro_sql": "{% macro default__get_replace_materialized_view_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_materialized_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6520991, "supported_languages": null}, "macro.dbt.get_alter_materialized_view_as_sql": {"name": "get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.get_alter_materialized_view_as_sql", "macro_sql": "{% macro get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n    {{- log('Applying ALTER to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_alter_materialized_view_as_sql', 'dbt')(\n        relation,\n        configuration_changes,\n        sql,\n        existing_relation,\n        backup_relation,\n        intermediate_relation\n    ) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_alter_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6530313, "supported_languages": null}, "macro.dbt.default__get_alter_materialized_view_as_sql": {"name": "default__get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.default__get_alter_materialized_view_as_sql", "macro_sql": "{% macro default__get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n    {{ exceptions.raise_compiler_error(\"Materialized views have not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6533751, "supported_languages": null}, "macro.dbt.get_materialized_view_configuration_changes": {"name": "get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.get_materialized_view_configuration_changes", "macro_sql": "{% macro get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    /* {#\n    It's recommended that configuration changes be formatted as follows:\n    {\"<change_category>\": [{\"action\": \"<name>\", \"context\": ...}]}\n\n    For example:\n    {\n        \"indexes\": [\n            {\"action\": \"drop\", \"context\": \"index_abc\"},\n            {\"action\": \"create\", \"context\": {\"columns\": [\"column_1\", \"column_2\"], \"type\": \"hash\", \"unique\": True}},\n        ],\n    }\n\n    Either way, `get_materialized_view_configuration_changes` needs to align with `get_alter_materialized_view_as_sql`.\n    #} */\n    {{- log('Determining configuration changes on: ' ~ existing_relation) -}}\n    {%- do return(adapter.dispatch('get_materialized_view_configuration_changes', 'dbt')(existing_relation, new_config)) -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_materialized_view_configuration_changes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6538746, "supported_languages": null}, "macro.dbt.default__get_materialized_view_configuration_changes": {"name": "default__get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.default__get_materialized_view_configuration_changes", "macro_sql": "{% macro default__get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    {{ exceptions.raise_compiler_error(\"Materialized views have not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6541445, "supported_languages": null}, "macro.dbt.get_create_materialized_view_as_sql": {"name": "get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt.get_create_materialized_view_as_sql", "macro_sql": "{% macro get_create_materialized_view_as_sql(relation, sql) -%}\n    {{- adapter.dispatch('get_create_materialized_view_as_sql', 'dbt')(relation, sql) -}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_create_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.654625, "supported_languages": null}, "macro.dbt.default__get_create_materialized_view_as_sql": {"name": "default__get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt.default__get_create_materialized_view_as_sql", "macro_sql": "{% macro default__get_create_materialized_view_as_sql(relation, sql) -%}\n    {{ exceptions.raise_compiler_error(\n        \"`get_create_materialized_view_as_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6549048, "supported_languages": null}, "macro.dbt.generate_alias_name": {"name": "generate_alias_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_alias.sql", "original_file_path": "macros/get_custom_name/get_custom_alias.sql", "unique_id": "macro.dbt.generate_alias_name", "macro_sql": "{% macro generate_alias_name(custom_alias_name=none, node=none) -%}\n    {% do return(adapter.dispatch('generate_alias_name', 'dbt')(custom_alias_name, node)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_alias_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6557446, "supported_languages": null}, "macro.dbt.default__generate_alias_name": {"name": "default__generate_alias_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_alias.sql", "original_file_path": "macros/get_custom_name/get_custom_alias.sql", "unique_id": "macro.dbt.default__generate_alias_name", "macro_sql": "{% macro default__generate_alias_name(custom_alias_name=none, node=none) -%}\n\n    {%- if custom_alias_name -%}\n\n        {{ custom_alias_name | trim }}\n\n    {%- elif node.version -%}\n\n        {{ return(node.name ~ \"_v\" ~ (node.version | replace(\".\", \"_\"))) }}\n\n    {%- else -%}\n\n        {{ node.name }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6564348, "supported_languages": null}, "macro.dbt.generate_schema_name": {"name": "generate_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.generate_schema_name", "macro_sql": "{% macro generate_schema_name(custom_schema_name=none, node=none) -%}\n    {{ return(adapter.dispatch('generate_schema_name', 'dbt')(custom_schema_name, node)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_schema_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6572456, "supported_languages": null}, "macro.dbt.default__generate_schema_name": {"name": "default__generate_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.default__generate_schema_name", "macro_sql": "{% macro default__generate_schema_name(custom_schema_name, node) -%}\n\n    {%- set default_schema = target.schema -%}\n    {%- if custom_schema_name is none -%}\n\n        {{ default_schema }}\n\n    {%- else -%}\n\n        {{ default_schema }}_{{ custom_schema_name | trim }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.657733, "supported_languages": null}, "macro.dbt.generate_schema_name_for_env": {"name": "generate_schema_name_for_env", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.generate_schema_name_for_env", "macro_sql": "{% macro generate_schema_name_for_env(custom_schema_name, node) -%}\n\n    {%- set default_schema = target.schema -%}\n    {%- if target.name == 'prod' and custom_schema_name is not none -%}\n\n        {{ custom_schema_name | trim }}\n\n    {%- else -%}\n\n        {{ default_schema }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6582582, "supported_languages": null}, "macro.dbt.generate_database_name": {"name": "generate_database_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_database.sql", "original_file_path": "macros/get_custom_name/get_custom_database.sql", "unique_id": "macro.dbt.generate_database_name", "macro_sql": "{% macro generate_database_name(custom_database_name=none, node=none) -%}\n    {% do return(adapter.dispatch('generate_database_name', 'dbt')(custom_database_name, node)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_database_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6589043, "supported_languages": null}, "macro.dbt.default__generate_database_name": {"name": "default__generate_database_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_database.sql", "original_file_path": "macros/get_custom_name/get_custom_database.sql", "unique_id": "macro.dbt.default__generate_database_name", "macro_sql": "{% macro default__generate_database_name(custom_database_name=none, node=none) -%}\n    {%- set default_database = target.database -%}\n    {%- if custom_database_name is none -%}\n\n        {{ default_database }}\n\n    {%- else -%}\n\n        {{ custom_database_name }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6593838, "supported_languages": null}, "macro.dbt.safe_cast": {"name": "safe_cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/safe_cast.sql", "original_file_path": "macros/utils/safe_cast.sql", "unique_id": "macro.dbt.safe_cast", "macro_sql": "{% macro safe_cast(field, type) %}\n  {{ return(adapter.dispatch('safe_cast', 'dbt') (field, type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__safe_cast"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.659897, "supported_languages": null}, "macro.dbt.default__safe_cast": {"name": "default__safe_cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/safe_cast.sql", "original_file_path": "macros/utils/safe_cast.sql", "unique_id": "macro.dbt.default__safe_cast", "macro_sql": "{% macro default__safe_cast(field, type) %}\n    {# most databases don't support this function yet\n    so we just need to use cast #}\n    cast({{field}} as {{type}})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6601691, "supported_languages": null}, "macro.dbt.dateadd": {"name": "dateadd", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt.dateadd", "macro_sql": "{% macro dateadd(datepart, interval, from_date_or_timestamp) %}\n  {{ return(adapter.dispatch('dateadd', 'dbt')(datepart, interval, from_date_or_timestamp)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6607428, "supported_languages": null}, "macro.dbt.default__dateadd": {"name": "default__dateadd", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt.default__dateadd", "macro_sql": "{% macro default__dateadd(datepart, interval, from_date_or_timestamp) %}\n\n    dateadd(\n        {{ datepart }},\n        {{ interval }},\n        {{ from_date_or_timestamp }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6610987, "supported_languages": null}, "macro.dbt.split_part": {"name": "split_part", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt.split_part", "macro_sql": "{% macro split_part(string_text, delimiter_text, part_number) %}\n  {{ return(adapter.dispatch('split_part', 'dbt') (string_text, delimiter_text, part_number)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__split_part"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6619248, "supported_languages": null}, "macro.dbt.default__split_part": {"name": "default__split_part", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt.default__split_part", "macro_sql": "{% macro default__split_part(string_text, delimiter_text, part_number) %}\n\n    split_part(\n        {{ string_text }},\n        {{ delimiter_text }},\n        {{ part_number }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6622405, "supported_languages": null}, "macro.dbt._split_part_negative": {"name": "_split_part_negative", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt._split_part_negative", "macro_sql": "{% macro _split_part_negative(string_text, delimiter_text, part_number) %}\n\n    split_part(\n        {{ string_text }},\n        {{ delimiter_text }},\n          length({{ string_text }})\n          - length(\n              replace({{ string_text }},  {{ delimiter_text }}, '')\n          ) + 2 + {{ part_number }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6626549, "supported_languages": null}, "macro.dbt.string_literal": {"name": "string_literal", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/literal.sql", "original_file_path": "macros/utils/literal.sql", "unique_id": "macro.dbt.string_literal", "macro_sql": "{%- macro string_literal(value) -%}\n  {{ return(adapter.dispatch('string_literal', 'dbt') (value)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__string_literal"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6631005, "supported_languages": null}, "macro.dbt.default__string_literal": {"name": "default__string_literal", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/literal.sql", "original_file_path": "macros/utils/literal.sql", "unique_id": "macro.dbt.default__string_literal", "macro_sql": "{% macro default__string_literal(value) -%}\n    '{{ value }}'\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6633234, "supported_languages": null}, "macro.dbt.get_intervals_between": {"name": "get_intervals_between", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.get_intervals_between", "macro_sql": "{% macro get_intervals_between(start_date, end_date, datepart) -%}\n    {{ return(adapter.dispatch('get_intervals_between', 'dbt')(start_date, end_date, datepart)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_intervals_between"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.664372, "supported_languages": null}, "macro.dbt.default__get_intervals_between": {"name": "default__get_intervals_between", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.default__get_intervals_between", "macro_sql": "{% macro default__get_intervals_between(start_date, end_date, datepart) -%}\n    {%- call statement('get_intervals_between', fetch_result=True) %}\n\n        select {{ dbt.datediff(start_date, end_date, datepart) }}\n\n    {%- endcall -%}\n\n    {%- set value_list = load_result('get_intervals_between') -%}\n\n    {%- if value_list and value_list['data'] -%}\n        {%- set values = value_list['data'] | map(attribute=0) | list %}\n        {{ return(values[0]) }}\n    {%- else -%}\n        {{ return(1) }}\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6655514, "supported_languages": null}, "macro.dbt.date_spine": {"name": "date_spine", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.date_spine", "macro_sql": "{% macro date_spine(datepart, start_date, end_date) %}\n    {{ return(adapter.dispatch('date_spine', 'dbt')(datepart, start_date, end_date)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__date_spine"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.665982, "supported_languages": null}, "macro.dbt.default__date_spine": {"name": "default__date_spine", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.default__date_spine", "macro_sql": "{% macro default__date_spine(datepart, start_date, end_date) %}\n\n\n    {# call as follows:\n\n    date_spine(\n        \"day\",\n        \"to_date('01/01/2016', 'mm/dd/yyyy')\",\n        \"dbt.dateadd(week, 1, current_date)\"\n    ) #}\n\n\n    with rawdata as (\n\n        {{dbt.generate_series(\n            dbt.get_intervals_between(start_date, end_date, datepart)\n        )}}\n\n    ),\n\n    all_periods as (\n\n        select (\n            {{\n                dbt.dateadd(\n                    datepart,\n                    \"row_number() over (order by 1) - 1\",\n                    start_date\n                )\n            }}\n        ) as date_{{datepart}}\n        from rawdata\n\n    ),\n\n    filtered as (\n\n        select *\n        from all_periods\n        where date_{{datepart}} <= {{ end_date }}\n\n    )\n\n    select * from filtered\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.generate_series", "macro.dbt.get_intervals_between", "macro.dbt.dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6666458, "supported_languages": null}, "macro.dbt.datediff": {"name": "datediff", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt.datediff", "macro_sql": "{% macro datediff(first_date, second_date, datepart) %}\n  {{ return(adapter.dispatch('datediff', 'dbt')(first_date, second_date, datepart)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6672196, "supported_languages": null}, "macro.dbt.default__datediff": {"name": "default__datediff", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt.default__datediff", "macro_sql": "{% macro default__datediff(first_date, second_date, datepart) -%}\n\n    datediff(\n        {{ datepart }},\n        {{ first_date }},\n        {{ second_date }}\n        )\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6675613, "supported_languages": null}, "macro.dbt.array_concat": {"name": "array_concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt.array_concat", "macro_sql": "{% macro array_concat(array_1, array_2) -%}\n  {{ return(adapter.dispatch('array_concat', 'dbt')(array_1, array_2)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__array_concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6680515, "supported_languages": null}, "macro.dbt.default__array_concat": {"name": "default__array_concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt.default__array_concat", "macro_sql": "{% macro default__array_concat(array_1, array_2) -%}\n    array_cat({{ array_1 }}, {{ array_2 }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6683116, "supported_languages": null}, "macro.dbt.replace": {"name": "replace", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/replace.sql", "original_file_path": "macros/utils/replace.sql", "unique_id": "macro.dbt.replace", "macro_sql": "{% macro replace(field, old_chars, new_chars) -%}\n    {{ return(adapter.dispatch('replace', 'dbt') (field, old_chars, new_chars)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__replace"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6688676, "supported_languages": null}, "macro.dbt.default__replace": {"name": "default__replace", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/replace.sql", "original_file_path": "macros/utils/replace.sql", "unique_id": "macro.dbt.default__replace", "macro_sql": "{% macro default__replace(field, old_chars, new_chars) %}\n\n    replace(\n        {{ field }},\n        {{ old_chars }},\n        {{ new_chars }}\n    )\n\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.669182, "supported_languages": null}, "macro.dbt.type_string": {"name": "type_string", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_string", "macro_sql": "\n\n{%- macro type_string() -%}\n  {{ return(adapter.dispatch('type_string', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6705873, "supported_languages": null}, "macro.dbt.default__type_string": {"name": "default__type_string", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_string", "macro_sql": "{% macro default__type_string() %}\n    {{ return(api.Column.translate_type(\"string\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6708891, "supported_languages": null}, "macro.dbt.type_timestamp": {"name": "type_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_timestamp", "macro_sql": "\n\n{%- macro type_timestamp() -%}\n  {{ return(adapter.dispatch('type_timestamp', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.671196, "supported_languages": null}, "macro.dbt.default__type_timestamp": {"name": "default__type_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_timestamp", "macro_sql": "{% macro default__type_timestamp() %}\n    {{ return(api.Column.translate_type(\"timestamp\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.671493, "supported_languages": null}, "macro.dbt.type_float": {"name": "type_float", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_float", "macro_sql": "\n\n{%- macro type_float() -%}\n  {{ return(adapter.dispatch('type_float', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_float"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6718102, "supported_languages": null}, "macro.dbt.default__type_float": {"name": "default__type_float", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_float", "macro_sql": "{% macro default__type_float() %}\n    {{ return(api.Column.translate_type(\"float\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6720977, "supported_languages": null}, "macro.dbt.type_numeric": {"name": "type_numeric", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_numeric", "macro_sql": "\n\n{%- macro type_numeric() -%}\n  {{ return(adapter.dispatch('type_numeric', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.672399, "supported_languages": null}, "macro.dbt.default__type_numeric": {"name": "default__type_numeric", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_numeric", "macro_sql": "{% macro default__type_numeric() %}\n    {{ return(api.Column.numeric_type(\"numeric\", 28, 6)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6727362, "supported_languages": null}, "macro.dbt.type_bigint": {"name": "type_bigint", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_bigint", "macro_sql": "\n\n{%- macro type_bigint() -%}\n  {{ return(adapter.dispatch('type_bigint', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_bigint"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.673044, "supported_languages": null}, "macro.dbt.default__type_bigint": {"name": "default__type_bigint", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_bigint", "macro_sql": "{% macro default__type_bigint() %}\n    {{ return(api.Column.translate_type(\"bigint\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.673336, "supported_languages": null}, "macro.dbt.type_int": {"name": "type_int", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_int", "macro_sql": "\n\n{%- macro type_int() -%}\n  {{ return(adapter.dispatch('type_int', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_int"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.673641, "supported_languages": null}, "macro.dbt.default__type_int": {"name": "default__type_int", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_int", "macro_sql": "{%- macro default__type_int() -%}\n  {{ return(api.Column.translate_type(\"integer\")) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6740274, "supported_languages": null}, "macro.dbt.type_boolean": {"name": "type_boolean", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_boolean", "macro_sql": "\n\n{%- macro type_boolean() -%}\n  {{ return(adapter.dispatch('type_boolean', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_boolean"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6743345, "supported_languages": null}, "macro.dbt.default__type_boolean": {"name": "default__type_boolean", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_boolean", "macro_sql": "{%- macro default__type_boolean() -%}\n  {{ return(api.Column.translate_type(\"boolean\")) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6746109, "supported_languages": null}, "macro.dbt.right": {"name": "right", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/right.sql", "original_file_path": "macros/utils/right.sql", "unique_id": "macro.dbt.right", "macro_sql": "{% macro right(string_text, length_expression) -%}\n    {{ return(adapter.dispatch('right', 'dbt') (string_text, length_expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__right"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6751254, "supported_languages": null}, "macro.dbt.default__right": {"name": "default__right", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/right.sql", "original_file_path": "macros/utils/right.sql", "unique_id": "macro.dbt.default__right", "macro_sql": "{% macro default__right(string_text, length_expression) %}\n\n    right(\n        {{ string_text }},\n        {{ length_expression }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6753979, "supported_languages": null}, "macro.dbt.last_day": {"name": "last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.last_day", "macro_sql": "{% macro last_day(date, datepart) %}\n  {{ return(adapter.dispatch('last_day', 'dbt') (date, datepart)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__last_day"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.675968, "supported_languages": null}, "macro.dbt.default_last_day": {"name": "default_last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.default_last_day", "macro_sql": "\n\n{%- macro default_last_day(date, datepart) -%}\n    cast(\n        {{dbt.dateadd('day', '-1',\n        dbt.dateadd(datepart, '1', dbt.date_trunc(datepart, date))\n        )}}\n        as date)\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.dateadd", "macro.dbt.date_trunc"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6764474, "supported_languages": null}, "macro.dbt.default__last_day": {"name": "default__last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.default__last_day", "macro_sql": "{% macro default__last_day(date, datepart) -%}\n    {{dbt.default_last_day(date, datepart)}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default_last_day"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6767287, "supported_languages": null}, "macro.dbt.intersect": {"name": "intersect", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/intersect.sql", "original_file_path": "macros/utils/intersect.sql", "unique_id": "macro.dbt.intersect", "macro_sql": "{% macro intersect() %}\n  {{ return(adapter.dispatch('intersect', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__intersect"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6771379, "supported_languages": null}, "macro.dbt.default__intersect": {"name": "default__intersect", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/intersect.sql", "original_file_path": "macros/utils/intersect.sql", "unique_id": "macro.dbt.default__intersect", "macro_sql": "{% macro default__intersect() %}\n\n    intersect\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6772964, "supported_languages": null}, "macro.dbt.except": {"name": "except", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/except.sql", "original_file_path": "macros/utils/except.sql", "unique_id": "macro.dbt.except", "macro_sql": "{% macro except() %}\n  {{ return(adapter.dispatch('except', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6777055, "supported_languages": null}, "macro.dbt.default__except": {"name": "default__except", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/except.sql", "original_file_path": "macros/utils/except.sql", "unique_id": "macro.dbt.default__except", "macro_sql": "{% macro default__except() %}\n\n    except\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6778657, "supported_languages": null}, "macro.dbt.any_value": {"name": "any_value", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/any_value.sql", "original_file_path": "macros/utils/any_value.sql", "unique_id": "macro.dbt.any_value", "macro_sql": "{% macro any_value(expression) -%}\n    {{ return(adapter.dispatch('any_value', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__any_value"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.678311, "supported_languages": null}, "macro.dbt.default__any_value": {"name": "default__any_value", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/any_value.sql", "original_file_path": "macros/utils/any_value.sql", "unique_id": "macro.dbt.default__any_value", "macro_sql": "{% macro default__any_value(expression) -%}\n\n    any_value({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6785607, "supported_languages": null}, "macro.dbt.cast_bool_to_text": {"name": "cast_bool_to_text", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast_bool_to_text.sql", "original_file_path": "macros/utils/cast_bool_to_text.sql", "unique_id": "macro.dbt.cast_bool_to_text", "macro_sql": "{% macro cast_bool_to_text(field) %}\n  {{ adapter.dispatch('cast_bool_to_text', 'dbt') (field) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__cast_bool_to_text"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.679035, "supported_languages": null}, "macro.dbt.default__cast_bool_to_text": {"name": "default__cast_bool_to_text", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast_bool_to_text.sql", "original_file_path": "macros/utils/cast_bool_to_text.sql", "unique_id": "macro.dbt.default__cast_bool_to_text", "macro_sql": "{% macro default__cast_bool_to_text(field) %}\n    cast({{ field }} as {{ api.Column.translate_type('string') }})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.67936, "supported_languages": null}, "macro.dbt.array_construct": {"name": "array_construct", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt.array_construct", "macro_sql": "{% macro array_construct(inputs=[], data_type=api.Column.translate_type('integer')) -%}\n  {{ return(adapter.dispatch('array_construct', 'dbt')(inputs, data_type)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__array_construct"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.680008, "supported_languages": null}, "macro.dbt.default__array_construct": {"name": "default__array_construct", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt.default__array_construct", "macro_sql": "{% macro default__array_construct(inputs, data_type) -%}\n    {% if inputs|length > 0 %}\n    array[ {{ inputs|join(' , ') }} ]\n    {% else %}\n    array[]::{{data_type}}[]\n    {% endif %}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6804616, "supported_languages": null}, "macro.dbt.hash": {"name": "hash", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/hash.sql", "original_file_path": "macros/utils/hash.sql", "unique_id": "macro.dbt.hash", "macro_sql": "{% macro hash(field) -%}\n  {{ return(adapter.dispatch('hash', 'dbt') (field)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__hash"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6809247, "supported_languages": null}, "macro.dbt.default__hash": {"name": "default__hash", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/hash.sql", "original_file_path": "macros/utils/hash.sql", "unique_id": "macro.dbt.default__hash", "macro_sql": "{% macro default__hash(field) -%}\n    md5(cast({{ field }} as {{ api.Column.translate_type('string') }}))\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6812322, "supported_languages": null}, "macro.dbt.concat": {"name": "concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/concat.sql", "original_file_path": "macros/utils/concat.sql", "unique_id": "macro.dbt.concat", "macro_sql": "{% macro concat(fields) -%}\n  {{ return(adapter.dispatch('concat', 'dbt')(fields)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6816723, "supported_languages": null}, "macro.dbt.default__concat": {"name": "default__concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/concat.sql", "original_file_path": "macros/utils/concat.sql", "unique_id": "macro.dbt.default__concat", "macro_sql": "{% macro default__concat(fields) -%}\n    {{ fields|join(' || ') }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6820283, "supported_languages": null}, "macro.dbt.position": {"name": "position", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/position.sql", "original_file_path": "macros/utils/position.sql", "unique_id": "macro.dbt.position", "macro_sql": "{% macro position(substring_text, string_text) -%}\n    {{ return(adapter.dispatch('position', 'dbt') (substring_text, string_text)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__position"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6825414, "supported_languages": null}, "macro.dbt.default__position": {"name": "default__position", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/position.sql", "original_file_path": "macros/utils/position.sql", "unique_id": "macro.dbt.default__position", "macro_sql": "{% macro default__position(substring_text, string_text) %}\n\n    position(\n        {{ substring_text }} in {{ string_text }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6828039, "supported_languages": null}, "macro.dbt.get_powers_of_two": {"name": "get_powers_of_two", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.get_powers_of_two", "macro_sql": "{% macro get_powers_of_two(upper_bound) %}\n    {{ return(adapter.dispatch('get_powers_of_two', 'dbt')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6839547, "supported_languages": null}, "macro.dbt.default__get_powers_of_two": {"name": "default__get_powers_of_two", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.default__get_powers_of_two", "macro_sql": "{% macro default__get_powers_of_two(upper_bound) %}\n\n    {% if upper_bound <= 0 %}\n    {{ exceptions.raise_compiler_error(\"upper bound must be positive\") }}\n    {% endif %}\n\n    {% for _ in range(1, 100) %}\n       {% if upper_bound <= 2 ** loop.index %}{{ return(loop.index) }}{% endif %}\n    {% endfor %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.684712, "supported_languages": null}, "macro.dbt.generate_series": {"name": "generate_series", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.generate_series", "macro_sql": "{% macro generate_series(upper_bound) %}\n    {{ return(adapter.dispatch('generate_series', 'dbt')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_series"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6850672, "supported_languages": null}, "macro.dbt.default__generate_series": {"name": "default__generate_series", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.default__generate_series", "macro_sql": "{% macro default__generate_series(upper_bound) %}\n\n    {% set n = dbt.get_powers_of_two(upper_bound) %}\n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    {% for i in range(n) %}\n    p{{i}}.generated_number * power(2, {{i}})\n    {% if not loop.last %} + {% endif %}\n    {% endfor %}\n    + 1\n    as generated_number\n\n    from\n\n    {% for i in range(n) %}\n    p as p{{i}}\n    {% if not loop.last %} cross join {% endif %}\n    {% endfor %}\n\n    )\n\n    select *\n    from unioned\n    where generated_number <= {{upper_bound}}\n    order by generated_number\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.68601, "supported_languages": null}, "macro.dbt.date_trunc": {"name": "date_trunc", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_trunc.sql", "original_file_path": "macros/utils/date_trunc.sql", "unique_id": "macro.dbt.date_trunc", "macro_sql": "{% macro date_trunc(datepart, date) -%}\n  {{ return(adapter.dispatch('date_trunc', 'dbt') (datepart, date)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__date_trunc"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6865034, "supported_languages": null}, "macro.dbt.default__date_trunc": {"name": "default__date_trunc", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_trunc.sql", "original_file_path": "macros/utils/date_trunc.sql", "unique_id": "macro.dbt.default__date_trunc", "macro_sql": "{% macro default__date_trunc(datepart, date) -%}\n    date_trunc('{{datepart}}', {{date}})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6867568, "supported_languages": null}, "macro.dbt.bool_or": {"name": "bool_or", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/bool_or.sql", "original_file_path": "macros/utils/bool_or.sql", "unique_id": "macro.dbt.bool_or", "macro_sql": "{% macro bool_or(expression) -%}\n    {{ return(adapter.dispatch('bool_or', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__bool_or"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6872046, "supported_languages": null}, "macro.dbt.default__bool_or": {"name": "default__bool_or", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/bool_or.sql", "original_file_path": "macros/utils/bool_or.sql", "unique_id": "macro.dbt.default__bool_or", "macro_sql": "{% macro default__bool_or(expression) -%}\n\n    bool_or({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6874182, "supported_languages": null}, "macro.dbt.length": {"name": "length", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/length.sql", "original_file_path": "macros/utils/length.sql", "unique_id": "macro.dbt.length", "macro_sql": "{% macro length(expression) -%}\n    {{ return(adapter.dispatch('length', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__length"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6878667, "supported_languages": null}, "macro.dbt.default__length": {"name": "default__length", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/length.sql", "original_file_path": "macros/utils/length.sql", "unique_id": "macro.dbt.default__length", "macro_sql": "{% macro default__length(expression) %}\n\n    length(\n        {{ expression }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6880758, "supported_languages": null}, "macro.dbt.listagg": {"name": "listagg", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt.listagg", "macro_sql": "{% macro listagg(measure, delimiter_text=\"','\", order_by_clause=none, limit_num=none) -%}\n    {{ return(adapter.dispatch('listagg', 'dbt') (measure, delimiter_text, order_by_clause, limit_num)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__listagg"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6890244, "supported_languages": null}, "macro.dbt.default__listagg": {"name": "default__listagg", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt.default__listagg", "macro_sql": "{% macro default__listagg(measure, delimiter_text, order_by_clause, limit_num) -%}\n\n    {% if limit_num -%}\n    array_to_string(\n        array_slice(\n            array_agg(\n                {{ measure }}\n            ){% if order_by_clause -%}\n            within group ({{ order_by_clause }})\n            {%- endif %}\n            ,0\n            ,{{ limit_num }}\n        ),\n        {{ delimiter_text }}\n        )\n    {%- else %}\n    listagg(\n        {{ measure }},\n        {{ delimiter_text }}\n        )\n        {% if order_by_clause -%}\n        within group ({{ order_by_clause }})\n        {%- endif %}\n    {%- endif %}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6897616, "supported_languages": null}, "macro.dbt.array_append": {"name": "array_append", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt.array_append", "macro_sql": "{% macro array_append(array, new_element) -%}\n  {{ return(adapter.dispatch('array_append', 'dbt')(array, new_element)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__array_append"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6902616, "supported_languages": null}, "macro.dbt.default__array_append": {"name": "default__array_append", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt.default__array_append", "macro_sql": "{% macro default__array_append(array, new_element) -%}\n    array_append({{ array }}, {{ new_element }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.69052, "supported_languages": null}, "macro.dbt.escape_single_quotes": {"name": "escape_single_quotes", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/escape_single_quotes.sql", "original_file_path": "macros/utils/escape_single_quotes.sql", "unique_id": "macro.dbt.escape_single_quotes", "macro_sql": "{% macro escape_single_quotes(expression) %}\n      {{ return(adapter.dispatch('escape_single_quotes', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__escape_single_quotes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6909962, "supported_languages": null}, "macro.dbt.default__escape_single_quotes": {"name": "default__escape_single_quotes", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/escape_single_quotes.sql", "original_file_path": "macros/utils/escape_single_quotes.sql", "unique_id": "macro.dbt.default__escape_single_quotes", "macro_sql": "{% macro default__escape_single_quotes(expression) -%}\n{{ expression | replace(\"'\",\"''\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.69128, "supported_languages": null}, "macro.dbt.run_hooks": {"name": "run_hooks", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.run_hooks", "macro_sql": "{% macro run_hooks(hooks, inside_transaction=True) %}\n  {% for hook in hooks | selectattr('transaction', 'equalto', inside_transaction)  %}\n    {% if not inside_transaction and loop.first %}\n      {% call statement(auto_begin=inside_transaction) %}\n        commit;\n      {% endcall %}\n    {% endif %}\n    {% set rendered = render(hook.get('sql')) | trim %}\n    {% if (rendered | length) > 0 %}\n      {% call statement(auto_begin=inside_transaction) %}\n        {{ rendered }}\n      {% endcall %}\n    {% endif %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.693113, "supported_languages": null}, "macro.dbt.make_hook_config": {"name": "make_hook_config", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.make_hook_config", "macro_sql": "{% macro make_hook_config(sql, inside_transaction) %}\n    {{ tojson({\"sql\": sql, \"transaction\": inside_transaction}) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6934803, "supported_languages": null}, "macro.dbt.before_begin": {"name": "before_begin", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.before_begin", "macro_sql": "{% macro before_begin(sql) %}\n    {{ make_hook_config(sql, inside_transaction=False) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.693759, "supported_languages": null}, "macro.dbt.in_transaction": {"name": "in_transaction", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.in_transaction", "macro_sql": "{% macro in_transaction(sql) %}\n    {{ make_hook_config(sql, inside_transaction=True) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6940315, "supported_languages": null}, "macro.dbt.after_commit": {"name": "after_commit", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.after_commit", "macro_sql": "{% macro after_commit(sql) %}\n    {{ make_hook_config(sql, inside_transaction=False) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6942976, "supported_languages": null}, "macro.dbt.set_sql_header": {"name": "set_sql_header", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.set_sql_header", "macro_sql": "{% macro set_sql_header(config) -%}\n  {{ config.set('sql_header', caller()) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6948879, "supported_languages": null}, "macro.dbt.should_full_refresh": {"name": "should_full_refresh", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.should_full_refresh", "macro_sql": "{% macro should_full_refresh() %}\n  {% set config_full_refresh = config.get('full_refresh') %}\n  {% if config_full_refresh is none %}\n    {% set config_full_refresh = flags.FULL_REFRESH %}\n  {% endif %}\n  {% do return(config_full_refresh) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.695513, "supported_languages": null}, "macro.dbt.should_store_failures": {"name": "should_store_failures", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.should_store_failures", "macro_sql": "{% macro should_store_failures() %}\n  {% set config_store_failures = config.get('store_failures') %}\n  {% if config_store_failures is none %}\n    {% set config_store_failures = flags.STORE_FAILURES %}\n  {% endif %}\n  {% do return(config_store_failures) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.6960745, "supported_languages": null}, "macro.dbt.materialization_table_default": {"name": "materialization_table_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/table.sql", "original_file_path": "macros/materializations/models/table.sql", "unique_id": "macro.dbt.materialization_table_default", "macro_sql": "{% materialization table, default %}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='table') %}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n      See ../view/view.sql for more information about this relation.\n  */\n  {%- set backup_relation_type = 'table' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_table_as_sql(False, intermediate_relation, sql) }}\n  {%- endcall %}\n\n  -- cleanup\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {{ adapter.rename_relation(existing_relation, backup_relation) }}\n    {% endif %}\n  {% endif %}\n\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {% do create_indexes(target_relation) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  -- `COMMIT` happens here\n  {{ adapter.commit() }}\n\n  -- finally, drop the existing/backup relation after the commit\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.get_create_table_as_sql", "macro.dbt.create_indexes", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7005079, "supported_languages": ["sql"]}, "macro.dbt.materialization_view_default": {"name": "materialization_view_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/view.sql", "original_file_path": "macros/materializations/models/view.sql", "unique_id": "macro.dbt.materialization_view_default", "macro_sql": "{%- materialization view, default -%}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='view') -%}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n     This relation (probably) doesn't exist yet. If it does exist, it's a leftover from\n     a previous run, and we're going to try to drop it immediately. At the end of this\n     materialization, we're going to rename the \"existing_relation\" to this identifier,\n     and then we're going to drop it. In order to make sure we run the correct one of:\n       - drop view ...\n       - drop table ...\n\n     We need to set the type of this relation to be the type of the existing_relation, if it exists,\n     or else \"view\" as a sane default if it does not. Note that if the existing_relation does not\n     exist, then there is nothing to move out of the way and subsequentally drop. In that case,\n     this relation will be effectively unused.\n  */\n  {%- set backup_relation_type = 'view' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(intermediate_relation, sql) }}\n  {%- endcall %}\n\n  -- cleanup\n  -- move the existing view out of the way\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {{ adapter.rename_relation(existing_relation, backup_relation) }}\n    {% endif %}\n  {% endif %}\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {{ adapter.commit() }}\n\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.run_hooks", "macro.dbt.drop_relation_if_exists", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7049267, "supported_languages": ["sql"]}, "macro.dbt.materialization_materialized_view_default": {"name": "materialization_materialized_view_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialization_materialized_view_default", "macro_sql": "{% materialization materialized_view, default %}\n    {% set existing_relation = load_cached_relation(this) %}\n    {% set target_relation = this.incorporate(type=this.MaterializedView) %}\n    {% set intermediate_relation = make_intermediate_relation(target_relation) %}\n    {% set backup_relation_type = target_relation.MaterializedView if existing_relation is none else existing_relation.type %}\n    {% set backup_relation = make_backup_relation(target_relation, backup_relation_type) %}\n\n    {{ materialized_view_setup(backup_relation, intermediate_relation, pre_hooks) }}\n\n        {% set build_sql = materialized_view_get_build_sql(existing_relation, target_relation, backup_relation, intermediate_relation) %}\n\n        {% if build_sql == '' %}\n            {{ materialized_view_execute_no_op(target_relation) }}\n        {% else %}\n            {{ materialized_view_execute_build_sql(build_sql, existing_relation, target_relation, post_hooks) }}\n        {% endif %}\n\n    {{ materialized_view_teardown(backup_relation, intermediate_relation, post_hooks) }}\n\n    {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.materialized_view_setup", "macro.dbt.materialized_view_get_build_sql", "macro.dbt.materialized_view_execute_no_op", "macro.dbt.materialized_view_execute_build_sql", "macro.dbt.materialized_view_teardown"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.711243, "supported_languages": ["sql"]}, "macro.dbt.materialized_view_setup": {"name": "materialized_view_setup", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_setup", "macro_sql": "{% macro materialized_view_setup(backup_relation, intermediate_relation, pre_hooks) %}\n\n    -- backup_relation and intermediate_relation should not already exist in the database\n    -- it's possible these exist because of a previous run that exited unexpectedly\n    {% set preexisting_backup_relation = load_cached_relation(backup_relation) %}\n    {% set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) %}\n\n    -- drop the temp relations if they exist already in the database\n    {{ drop_relation_if_exists(preexisting_backup_relation) }}\n    {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n\n    {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7120144, "supported_languages": null}, "macro.dbt.materialized_view_teardown": {"name": "materialized_view_teardown", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_teardown", "macro_sql": "{% macro materialized_view_teardown(backup_relation, intermediate_relation, post_hooks) %}\n\n    -- drop the temp relations if they exist to leave the database clean for the next run\n    {{ drop_relation_if_exists(backup_relation) }}\n    {{ drop_relation_if_exists(intermediate_relation) }}\n\n    {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.712477, "supported_languages": null}, "macro.dbt.materialized_view_get_build_sql": {"name": "materialized_view_get_build_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_get_build_sql", "macro_sql": "{% macro materialized_view_get_build_sql(existing_relation, target_relation, backup_relation, intermediate_relation) %}\n\n    {% set full_refresh_mode = should_full_refresh() %}\n\n    -- determine the scenario we're in: create, full_refresh, alter, refresh data\n    {% if existing_relation is none %}\n        {% set build_sql = get_create_materialized_view_as_sql(target_relation, sql) %}\n    {% elif full_refresh_mode or not existing_relation.is_materialized_view %}\n        {% set build_sql = get_replace_sql(existing_relation, target_relation, sql) %}\n    {% else %}\n\n        -- get config options\n        {% set on_configuration_change = config.get('on_configuration_change') %}\n        {% set configuration_changes = get_materialized_view_configuration_changes(existing_relation, config) %}\n\n        {% if configuration_changes is none %}\n            {% set build_sql = refresh_materialized_view(target_relation) %}\n\n        {% elif on_configuration_change == 'apply' %}\n            {% set build_sql = get_alter_materialized_view_as_sql(target_relation, configuration_changes, sql, existing_relation, backup_relation, intermediate_relation) %}\n        {% elif on_configuration_change == 'continue' %}\n            {% set build_sql = '' %}\n            {{ exceptions.warn(\"Configuration changes were identified and `on_configuration_change` was set to `continue` for `\" ~ target_relation ~ \"`\") }}\n        {% elif on_configuration_change == 'fail' %}\n            {{ exceptions.raise_fail_fast_error(\"Configuration changes were identified and `on_configuration_change` was set to `fail` for `\" ~ target_relation ~ \"`\") }}\n\n        {% else %}\n            -- this only happens if the user provides a value other than `apply`, 'skip', 'fail'\n            {{ exceptions.raise_compiler_error(\"Unexpected configuration scenario\") }}\n\n        {% endif %}\n\n    {% endif %}\n\n    {% do return(build_sql) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh", "macro.dbt.get_create_materialized_view_as_sql", "macro.dbt.get_replace_sql", "macro.dbt.get_materialized_view_configuration_changes", "macro.dbt.refresh_materialized_view", "macro.dbt.get_alter_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7148476, "supported_languages": null}, "macro.dbt.materialized_view_execute_no_op": {"name": "materialized_view_execute_no_op", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_execute_no_op", "macro_sql": "{% macro materialized_view_execute_no_op(target_relation) %}\n    {% do store_raw_result(\n        name=\"main\",\n        message=\"skip \" ~ target_relation,\n        code=\"skip\",\n        rows_affected=\"-1\"\n    ) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.715279, "supported_languages": null}, "macro.dbt.materialized_view_execute_build_sql": {"name": "materialized_view_execute_build_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_execute_build_sql", "macro_sql": "{% macro materialized_view_execute_build_sql(build_sql, existing_relation, target_relation, post_hooks) %}\n\n    -- `BEGIN` happens here:\n    {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n    {% set grant_config = config.get('grants') %}\n\n    {% call statement(name=\"main\") %}\n        {{ build_sql }}\n    {% endcall %}\n\n    {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n    {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n    {% do persist_docs(target_relation, model) %}\n\n    {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n    {{ adapter.commit() }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.716448, "supported_languages": null}, "macro.dbt.materialization_incremental_default": {"name": "materialization_incremental_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/incremental.sql", "original_file_path": "macros/materializations/models/incremental/incremental.sql", "unique_id": "macro.dbt.materialization_incremental_default", "macro_sql": "{% materialization incremental, default -%}\n\n  -- relations\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='table') -%}\n  {%- set temp_relation = make_temp_relation(target_relation)-%}\n  {%- set intermediate_relation = make_intermediate_relation(target_relation)-%}\n  {%- set backup_relation_type = 'table' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n\n  -- configs\n  {%- set unique_key = config.get('unique_key') -%}\n  {%- set full_refresh_mode = (should_full_refresh()  or existing_relation.is_view) -%}\n  {%- set on_schema_change = incremental_validate_on_schema_change(config.get('on_schema_change'), default='ignore') -%}\n\n  -- the temp_ and backup_ relations should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation. This has to happen before\n  -- BEGIN, in a separate transaction\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation)-%}\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n   -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  {% set to_drop = [] %}\n\n  {% if existing_relation is none %}\n      {% set build_sql = get_create_table_as_sql(False, target_relation, sql) %}\n  {% elif full_refresh_mode %}\n      {% set build_sql = get_create_table_as_sql(False, intermediate_relation, sql) %}\n      {% set need_swap = true %}\n  {% else %}\n    {% do run_query(get_create_table_as_sql(True, temp_relation, sql)) %}\n    {% do adapter.expand_target_column_types(\n             from_relation=temp_relation,\n             to_relation=target_relation) %}\n    {#-- Process schema changes. Returns dict of changes if successful. Use source columns for upserting/merging --#}\n    {% set dest_columns = process_schema_changes(on_schema_change, temp_relation, existing_relation) %}\n    {% if not dest_columns %}\n      {% set dest_columns = adapter.get_columns_in_relation(existing_relation) %}\n    {% endif %}\n\n    {#-- Get the incremental_strategy, the macro to use for the strategy, and build the sql --#}\n    {% set incremental_strategy = config.get('incremental_strategy') or 'default' %}\n    {% set incremental_predicates = config.get('predicates', none) or config.get('incremental_predicates', none) %}\n    {% set strategy_sql_macro_func = adapter.get_incremental_strategy_macro(context, incremental_strategy) %}\n    {% set strategy_arg_dict = ({'target_relation': target_relation, 'temp_relation': temp_relation, 'unique_key': unique_key, 'dest_columns': dest_columns, 'incremental_predicates': incremental_predicates }) %}\n    {% set build_sql = strategy_sql_macro_func(strategy_arg_dict) %}\n\n  {% endif %}\n\n  {% call statement(\"main\") %}\n      {{ build_sql }}\n  {% endcall %}\n\n  {% if need_swap %}\n      {% do adapter.rename_relation(target_relation, backup_relation) %}\n      {% do adapter.rename_relation(intermediate_relation, target_relation) %}\n      {% do to_drop.append(backup_relation) %}\n  {% endif %}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {% if existing_relation is none or existing_relation.is_view or should_full_refresh() %}\n    {% do create_indexes(target_relation) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  -- `COMMIT` happens here\n  {% do adapter.commit() %}\n\n  {% for rel in to_drop %}\n      {% do adapter.drop_relation(rel) %}\n  {% endfor %}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_temp_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.should_full_refresh", "macro.dbt.incremental_validate_on_schema_change", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks", "macro.dbt.get_create_table_as_sql", "macro.dbt.run_query", "macro.dbt.process_schema_changes", "macro.dbt.statement", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs", "macro.dbt.create_indexes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7244067, "supported_languages": ["sql"]}, "macro.dbt.get_merge_sql": {"name": "get_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_merge_sql", "macro_sql": "{% macro get_merge_sql(target, source, unique_key, dest_columns, incremental_predicates=none) -%}\n   -- back compat for old kwarg name\n  {% set incremental_predicates = kwargs.get('predicates', incremental_predicates) %}\n  {{ adapter.dispatch('get_merge_sql', 'dbt')(target, source, unique_key, dest_columns, incremental_predicates) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.73179, "supported_languages": null}, "macro.dbt.default__get_merge_sql": {"name": "default__get_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_merge_sql", "macro_sql": "{% macro default__get_merge_sql(target, source, unique_key, dest_columns, incremental_predicates=none) -%}\n    {%- set predicates = [] if incremental_predicates is none else [] + incremental_predicates -%}\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n    {%- set merge_update_columns = config.get('merge_update_columns') -%}\n    {%- set merge_exclude_columns = config.get('merge_exclude_columns') -%}\n    {%- set update_columns = get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {% if unique_key %}\n        {% if unique_key is sequence and unique_key is not mapping and unique_key is not string %}\n            {% for key in unique_key %}\n                {% set this_key_match %}\n                    DBT_INTERNAL_SOURCE.{{ key }} = DBT_INTERNAL_DEST.{{ key }}\n                {% endset %}\n                {% do predicates.append(this_key_match) %}\n            {% endfor %}\n        {% else %}\n            {% set unique_key_match %}\n                DBT_INTERNAL_SOURCE.{{ unique_key }} = DBT_INTERNAL_DEST.{{ unique_key }}\n            {% endset %}\n            {% do predicates.append(unique_key_match) %}\n        {% endif %}\n    {% else %}\n        {% do predicates.append('FALSE') %}\n    {% endif %}\n\n    {{ sql_header if sql_header is not none }}\n\n    merge into {{ target }} as DBT_INTERNAL_DEST\n        using {{ source }} as DBT_INTERNAL_SOURCE\n        on {{\"(\" ~ predicates | join(\") and (\") ~ \")\"}}\n\n    {% if unique_key %}\n    when matched then update set\n        {% for column_name in update_columns -%}\n            {{ column_name }} = DBT_INTERNAL_SOURCE.{{ column_name }}\n            {%- if not loop.last %}, {%- endif %}\n        {%- endfor %}\n    {% endif %}\n\n    when not matched then insert\n        ({{ dest_cols_csv }})\n    values\n        ({{ dest_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv", "macro.dbt.get_merge_update_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7345805, "supported_languages": null}, "macro.dbt.get_delete_insert_merge_sql": {"name": "get_delete_insert_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_delete_insert_merge_sql", "macro_sql": "{% macro get_delete_insert_merge_sql(target, source, unique_key, dest_columns, incremental_predicates) -%}\n  {{ adapter.dispatch('get_delete_insert_merge_sql', 'dbt')(target, source, unique_key, dest_columns, incremental_predicates) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_delete_insert_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7350457, "supported_languages": null}, "macro.dbt.default__get_delete_insert_merge_sql": {"name": "default__get_delete_insert_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_delete_insert_merge_sql", "macro_sql": "{% macro default__get_delete_insert_merge_sql(target, source, unique_key, dest_columns, incremental_predicates) -%}\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n    {% if unique_key %}\n        {% if unique_key is sequence and unique_key is not string %}\n            delete from {{target }}\n            using {{ source }}\n            where (\n                {% for key in unique_key %}\n                    {{ source }}.{{ key }} = {{ target }}.{{ key }}\n                    {{ \"and \" if not loop.last}}\n                {% endfor %}\n                {% if incremental_predicates %}\n                    {% for predicate in incremental_predicates %}\n                        and {{ predicate }}\n                    {% endfor %}\n                {% endif %}\n            );\n        {% else %}\n            delete from {{ target }}\n            where (\n                {{ unique_key }}) in (\n                select ({{ unique_key }})\n                from {{ source }}\n            )\n            {%- if incremental_predicates %}\n                {% for predicate in incremental_predicates %}\n                    and {{ predicate }}\n                {% endfor %}\n            {%- endif -%};\n\n        {% endif %}\n    {% endif %}\n\n    insert into {{ target }} ({{ dest_cols_csv }})\n    (\n        select {{ dest_cols_csv }}\n        from {{ source }}\n    )\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7368362, "supported_languages": null}, "macro.dbt.get_insert_overwrite_merge_sql": {"name": "get_insert_overwrite_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_insert_overwrite_merge_sql", "macro_sql": "{% macro get_insert_overwrite_merge_sql(target, source, dest_columns, predicates, include_sql_header=false) -%}\n  {{ adapter.dispatch('get_insert_overwrite_merge_sql', 'dbt')(target, source, dest_columns, predicates, include_sql_header) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7373192, "supported_languages": null}, "macro.dbt.default__get_insert_overwrite_merge_sql": {"name": "default__get_insert_overwrite_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_insert_overwrite_merge_sql", "macro_sql": "{% macro default__get_insert_overwrite_merge_sql(target, source, dest_columns, predicates, include_sql_header) -%}\n    {#-- The only time include_sql_header is True: --#}\n    {#-- BigQuery + insert_overwrite strategy + \"static\" partitions config --#}\n    {#-- We should consider including the sql header at the materialization level instead --#}\n\n    {%- set predicates = [] if predicates is none else [] + predicates -%}\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {{ sql_header if sql_header is not none and include_sql_header }}\n\n    merge into {{ target }} as DBT_INTERNAL_DEST\n        using {{ source }} as DBT_INTERNAL_SOURCE\n        on FALSE\n\n    when not matched by source\n        {% if predicates %} and {{ predicates | join(' and ') }} {% endif %}\n        then delete\n\n    when not matched then insert\n        ({{ dest_cols_csv }})\n    values\n        ({{ dest_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.738459, "supported_languages": null}, "macro.dbt.is_incremental": {"name": "is_incremental", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/is_incremental.sql", "original_file_path": "macros/materializations/models/incremental/is_incremental.sql", "unique_id": "macro.dbt.is_incremental", "macro_sql": "{% macro is_incremental() %}\n    {#-- do not run introspective queries in parsing #}\n    {% if not execute %}\n        {{ return(False) }}\n    {% else %}\n        {% set relation = adapter.get_relation(this.database, this.schema, this.table) %}\n        {{ return(relation is not none\n                  and relation.type == 'table'\n                  and model.config.materialized == 'incremental'\n                  and not should_full_refresh()) }}\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7395325, "supported_languages": null}, "macro.dbt.incremental_validate_on_schema_change": {"name": "incremental_validate_on_schema_change", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.incremental_validate_on_schema_change", "macro_sql": "{% macro incremental_validate_on_schema_change(on_schema_change, default='ignore') %}\n\n   {% if on_schema_change not in ['sync_all_columns', 'append_new_columns', 'fail', 'ignore'] %}\n\n     {% set log_message = 'Invalid value for on_schema_change (%s) specified. Setting default value of %s.' % (on_schema_change, default) %}\n     {% do log(log_message) %}\n\n     {{ return(default) }}\n\n   {% else %}\n\n     {{ return(on_schema_change) }}\n\n   {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7463727, "supported_languages": null}, "macro.dbt.check_for_schema_changes": {"name": "check_for_schema_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.check_for_schema_changes", "macro_sql": "{% macro check_for_schema_changes(source_relation, target_relation) %}\n\n  {% set schema_changed = False %}\n\n  {%- set source_columns = adapter.get_columns_in_relation(source_relation) -%}\n  {%- set target_columns = adapter.get_columns_in_relation(target_relation) -%}\n  {%- set source_not_in_target = diff_columns(source_columns, target_columns) -%}\n  {%- set target_not_in_source = diff_columns(target_columns, source_columns) -%}\n\n  {% set new_target_types = diff_column_data_types(source_columns, target_columns) %}\n\n  {% if source_not_in_target != [] %}\n    {% set schema_changed = True %}\n  {% elif target_not_in_source != [] or new_target_types != [] %}\n    {% set schema_changed = True %}\n  {% elif new_target_types != [] %}\n    {% set schema_changed = True %}\n  {% endif %}\n\n  {% set changes_dict = {\n    'schema_changed': schema_changed,\n    'source_not_in_target': source_not_in_target,\n    'target_not_in_source': target_not_in_source,\n    'source_columns': source_columns,\n    'target_columns': target_columns,\n    'new_target_types': new_target_types\n  } %}\n\n  {% set msg %}\n    In {{ target_relation }}:\n        Schema changed: {{ schema_changed }}\n        Source columns not in target: {{ source_not_in_target }}\n        Target columns not in source: {{ target_not_in_source }}\n        New column types: {{ new_target_types }}\n  {% endset %}\n\n  {% do log(msg) %}\n\n  {{ return(changes_dict) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.diff_columns", "macro.dbt.diff_column_data_types"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7485, "supported_languages": null}, "macro.dbt.sync_column_schemas": {"name": "sync_column_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.sync_column_schemas", "macro_sql": "{% macro sync_column_schemas(on_schema_change, target_relation, schema_changes_dict) %}\n\n  {%- set add_to_target_arr = schema_changes_dict['source_not_in_target'] -%}\n\n  {%- if on_schema_change == 'append_new_columns'-%}\n     {%- if add_to_target_arr | length > 0 -%}\n       {%- do alter_relation_add_remove_columns(target_relation, add_to_target_arr, none) -%}\n     {%- endif -%}\n\n  {% elif on_schema_change == 'sync_all_columns' %}\n     {%- set remove_from_target_arr = schema_changes_dict['target_not_in_source'] -%}\n     {%- set new_target_types = schema_changes_dict['new_target_types'] -%}\n\n     {% if add_to_target_arr | length > 0 or remove_from_target_arr | length > 0 %}\n       {%- do alter_relation_add_remove_columns(target_relation, add_to_target_arr, remove_from_target_arr) -%}\n     {% endif %}\n\n     {% if new_target_types != [] %}\n       {% for ntt in new_target_types %}\n         {% set column_name = ntt['column_name'] %}\n         {% set new_type = ntt['new_type'] %}\n         {% do alter_column_type(target_relation, column_name, new_type) %}\n       {% endfor %}\n     {% endif %}\n\n  {% endif %}\n\n  {% set schema_change_message %}\n    In {{ target_relation }}:\n        Schema change approach: {{ on_schema_change }}\n        Columns added: {{ add_to_target_arr }}\n        Columns removed: {{ remove_from_target_arr }}\n        Data types changed: {{ new_target_types }}\n  {% endset %}\n\n  {% do log(schema_change_message) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.alter_relation_add_remove_columns", "macro.dbt.alter_column_type"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7507138, "supported_languages": null}, "macro.dbt.process_schema_changes": {"name": "process_schema_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.process_schema_changes", "macro_sql": "{% macro process_schema_changes(on_schema_change, source_relation, target_relation) %}\n\n    {% if on_schema_change == 'ignore' %}\n\n     {{ return({}) }}\n\n    {% else %}\n\n      {% set schema_changes_dict = check_for_schema_changes(source_relation, target_relation) %}\n\n      {% if schema_changes_dict['schema_changed'] %}\n\n        {% if on_schema_change == 'fail' %}\n\n          {% set fail_msg %}\n              The source and target schemas on this incremental model are out of sync!\n              They can be reconciled in several ways:\n                - set the `on_schema_change` config to either append_new_columns or sync_all_columns, depending on your situation.\n                - Re-run the incremental model with `full_refresh: True` to update the target schema.\n                - update the schema manually and re-run the process.\n\n              Additional troubleshooting context:\n                 Source columns not in target: {{ schema_changes_dict['source_not_in_target'] }}\n                 Target columns not in source: {{ schema_changes_dict['target_not_in_source'] }}\n                 New column types: {{ schema_changes_dict['new_target_types'] }}\n          {% endset %}\n\n          {% do exceptions.raise_compiler_error(fail_msg) %}\n\n        {# -- unless we ignore, run the sync operation per the config #}\n        {% else %}\n\n          {% do sync_column_schemas(on_schema_change, target_relation, schema_changes_dict) %}\n\n        {% endif %}\n\n      {% endif %}\n\n      {{ return(schema_changes_dict['source_columns']) }}\n\n    {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.check_for_schema_changes", "macro.dbt.sync_column_schemas"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7522278, "supported_languages": null}, "macro.dbt.get_quoted_csv": {"name": "get_quoted_csv", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.get_quoted_csv", "macro_sql": "{% macro get_quoted_csv(column_names) %}\n\n    {% set quoted = [] %}\n    {% for col in column_names -%}\n        {%- do quoted.append(adapter.quote(col)) -%}\n    {%- endfor %}\n\n    {%- set dest_cols_csv = quoted | join(', ') -%}\n    {{ return(dest_cols_csv) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7544098, "supported_languages": null}, "macro.dbt.diff_columns": {"name": "diff_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.diff_columns", "macro_sql": "{% macro diff_columns(source_columns, target_columns) %}\n\n  {% set result = [] %}\n  {% set source_names = source_columns | map(attribute = 'column') | list %}\n  {% set target_names = target_columns | map(attribute = 'column') | list %}\n\n   {# --check whether the name attribute exists in the target - this does not perform a data type check #}\n   {% for sc in source_columns %}\n     {% if sc.name not in target_names %}\n        {{ result.append(sc) }}\n     {% endif %}\n   {% endfor %}\n\n  {{ return(result) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.755391, "supported_languages": null}, "macro.dbt.diff_column_data_types": {"name": "diff_column_data_types", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.diff_column_data_types", "macro_sql": "{% macro diff_column_data_types(source_columns, target_columns) %}\n\n  {% set result = [] %}\n  {% for sc in source_columns %}\n    {% set tc = target_columns | selectattr(\"name\", \"equalto\", sc.name) | list | first %}\n    {% if tc %}\n      {% if sc.data_type != tc.data_type and not sc.can_expand_to(other_column=tc) %}\n        {{ result.append( { 'column_name': tc.name, 'new_type': sc.data_type } ) }}\n      {% endif %}\n    {% endif %}\n  {% endfor %}\n\n  {{ return(result) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7565792, "supported_languages": null}, "macro.dbt.get_merge_update_columns": {"name": "get_merge_update_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.get_merge_update_columns", "macro_sql": "{% macro get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) %}\n  {{ return(adapter.dispatch('get_merge_update_columns', 'dbt')(merge_update_columns, merge_exclude_columns, dest_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_merge_update_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7570426, "supported_languages": null}, "macro.dbt.default__get_merge_update_columns": {"name": "default__get_merge_update_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.default__get_merge_update_columns", "macro_sql": "{% macro default__get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) %}\n  {%- set default_cols = dest_columns | map(attribute=\"quoted\") | list -%}\n\n  {%- if merge_update_columns and merge_exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\n        'Model cannot specify merge_update_columns and merge_exclude_columns. Please update model to use only one config'\n    )}}\n  {%- elif merge_update_columns -%}\n    {%- set update_columns = merge_update_columns -%}\n  {%- elif merge_exclude_columns -%}\n    {%- set update_columns = [] -%}\n    {%- for column in dest_columns -%}\n      {% if column.column | lower not in merge_exclude_columns | map(\"lower\") | list %}\n        {%- do update_columns.append(column.quoted) -%}\n      {% endif %}\n    {%- endfor -%}\n  {%- else -%}\n    {%- set update_columns = default_cols -%}\n  {%- endif -%}\n\n  {{ return(update_columns) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7582858, "supported_languages": null}, "macro.dbt.get_incremental_append_sql": {"name": "get_incremental_append_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_append_sql", "macro_sql": "{% macro get_incremental_append_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_append_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_append_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7595541, "supported_languages": null}, "macro.dbt.default__get_incremental_append_sql": {"name": "default__get_incremental_append_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_append_sql", "macro_sql": "{% macro default__get_incremental_append_sql(arg_dict) %}\n\n  {% do return(get_insert_into_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"dest_columns\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_insert_into_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7599761, "supported_languages": null}, "macro.dbt.get_incremental_delete_insert_sql": {"name": "get_incremental_delete_insert_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_delete_insert_sql", "macro_sql": "{% macro get_incremental_delete_insert_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_delete_insert_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_delete_insert_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7603207, "supported_languages": null}, "macro.dbt.default__get_incremental_delete_insert_sql": {"name": "default__get_incremental_delete_insert_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_delete_insert_sql", "macro_sql": "{% macro default__get_incremental_delete_insert_sql(arg_dict) %}\n\n  {% do return(get_delete_insert_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"unique_key\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_delete_insert_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.760848, "supported_languages": null}, "macro.dbt.get_incremental_merge_sql": {"name": "get_incremental_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_merge_sql", "macro_sql": "{% macro get_incremental_merge_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_merge_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7612088, "supported_languages": null}, "macro.dbt.default__get_incremental_merge_sql": {"name": "default__get_incremental_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_merge_sql", "macro_sql": "{% macro default__get_incremental_merge_sql(arg_dict) %}\n\n  {% do return(get_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"unique_key\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7617571, "supported_languages": null}, "macro.dbt.get_incremental_insert_overwrite_sql": {"name": "get_incremental_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_insert_overwrite_sql", "macro_sql": "{% macro get_incremental_insert_overwrite_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_insert_overwrite_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_insert_overwrite_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7621033, "supported_languages": null}, "macro.dbt.default__get_incremental_insert_overwrite_sql": {"name": "default__get_incremental_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_insert_overwrite_sql", "macro_sql": "{% macro default__get_incremental_insert_overwrite_sql(arg_dict) %}\n\n  {% do return(get_insert_overwrite_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7625785, "supported_languages": null}, "macro.dbt.get_incremental_default_sql": {"name": "get_incremental_default_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_default_sql", "macro_sql": "{% macro get_incremental_default_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_default_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_default_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7629516, "supported_languages": null}, "macro.dbt.default__get_incremental_default_sql": {"name": "default__get_incremental_default_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_default_sql", "macro_sql": "{% macro default__get_incremental_default_sql(arg_dict) %}\n\n  {% do return(get_incremental_append_sql(arg_dict)) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_incremental_append_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7632644, "supported_languages": null}, "macro.dbt.get_insert_into_sql": {"name": "get_insert_into_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_insert_into_sql", "macro_sql": "{% macro get_insert_into_sql(target_relation, temp_relation, dest_columns) %}\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n    insert into {{ target_relation }} ({{ dest_cols_csv }})\n    (\n        select {{ dest_cols_csv }}\n        from {{ temp_relation }}\n    )\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7638109, "supported_languages": null}, "macro.dbt.can_clone_table": {"name": "can_clone_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/can_clone_table.sql", "original_file_path": "macros/materializations/models/clone/can_clone_table.sql", "unique_id": "macro.dbt.can_clone_table", "macro_sql": "{% macro can_clone_table() %}\n    {{ return(adapter.dispatch('can_clone_table', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__can_clone_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7642553, "supported_languages": null}, "macro.dbt.default__can_clone_table": {"name": "default__can_clone_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/can_clone_table.sql", "original_file_path": "macros/materializations/models/clone/can_clone_table.sql", "unique_id": "macro.dbt.default__can_clone_table", "macro_sql": "{% macro default__can_clone_table() %}\n    {{ return(False) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7644894, "supported_languages": null}, "macro.dbt.create_or_replace_clone": {"name": "create_or_replace_clone", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/create_or_replace_clone.sql", "original_file_path": "macros/materializations/models/clone/create_or_replace_clone.sql", "unique_id": "macro.dbt.create_or_replace_clone", "macro_sql": "{% macro create_or_replace_clone(this_relation, defer_relation) %}\n    {{ return(adapter.dispatch('create_or_replace_clone', 'dbt')(this_relation, defer_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_or_replace_clone"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.765123, "supported_languages": null}, "macro.dbt.default__create_or_replace_clone": {"name": "default__create_or_replace_clone", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/create_or_replace_clone.sql", "original_file_path": "macros/materializations/models/clone/create_or_replace_clone.sql", "unique_id": "macro.dbt.default__create_or_replace_clone", "macro_sql": "{% macro default__create_or_replace_clone(this_relation, defer_relation) %}\n    create or replace table {{ this_relation }} clone {{ defer_relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7653863, "supported_languages": null}, "macro.dbt.materialization_clone_default": {"name": "materialization_clone_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/clone.sql", "original_file_path": "macros/materializations/models/clone/clone.sql", "unique_id": "macro.dbt.materialization_clone_default", "macro_sql": "{%- materialization clone, default -%}\n\n  {%- set relations = {'relations': []} -%}\n\n  {%- if not defer_relation -%}\n      -- nothing to do\n      {{ log(\"No relation found in state manifest for \" ~ model.unique_id, info=True) }}\n      {{ return(relations) }}\n  {%- endif -%}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n\n  {%- if existing_relation and not flags.FULL_REFRESH -%}\n      -- noop!\n      {{ log(\"Relation \" ~ existing_relation ~ \" already exists\", info=True) }}\n      {{ return(relations) }}\n  {%- endif -%}\n\n  {%- set other_existing_relation = load_cached_relation(defer_relation) -%}\n\n  -- If this is a database that can do zero-copy cloning of tables, and the other relation is a table, then this will be a table\n  -- Otherwise, this will be a view\n\n  {% set can_clone_table = can_clone_table() %}\n\n  {%- if other_existing_relation and other_existing_relation.type == 'table' and can_clone_table -%}\n\n      {%- set target_relation = this.incorporate(type='table') -%}\n      {% if existing_relation is not none and not existing_relation.is_table %}\n        {{ log(\"Dropping relation \" ~ existing_relation ~ \" because it is of type \" ~ existing_relation.type) }}\n        {{ drop_relation_if_exists(existing_relation) }}\n      {% endif %}\n\n      -- as a general rule, data platforms that can clone tables can also do atomic 'create or replace'\n      {% call statement('main') %}\n          {% if target_relation and defer_relation and target_relation == defer_relation %}\n              {{ log(\"Target relation and defer relation are the same, skipping clone for relation: \" ~ target_relation) }}\n          {% else %}\n              {{ create_or_replace_clone(target_relation, defer_relation) }}\n          {% endif %}\n\n      {% endcall %}\n\n      {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n      {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n      {% do persist_docs(target_relation, model) %}\n\n      {{ return({'relations': [target_relation]}) }}\n\n  {%- else -%}\n\n      {%- set target_relation = this.incorporate(type='view') -%}\n\n      -- reuse the view materialization\n      -- TODO: support actual dispatch for materialization macros\n      -- Tracking ticket: https://github.com/dbt-labs/dbt-core/issues/7799\n      {% set search_name = \"materialization_view_\" ~ adapter.type() %}\n      {% if not search_name in context %}\n          {% set search_name = \"materialization_view_default\" %}\n      {% endif %}\n      {% set materialization_macro = context[search_name] %}\n      {% set relations = materialization_macro() %}\n      {{ return(relations) }}\n\n  {%- endif -%}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.can_clone_table", "macro.dbt.drop_relation_if_exists", "macro.dbt.statement", "macro.dbt.create_or_replace_clone", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7708368, "supported_languages": ["sql"]}, "macro.dbt.materialization_test_default": {"name": "materialization_test_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/test.sql", "original_file_path": "macros/materializations/tests/test.sql", "unique_id": "macro.dbt.materialization_test_default", "macro_sql": "{%- materialization test, default -%}\n\n  {% set relations = [] %}\n\n  {% if should_store_failures() %}\n\n    {% set identifier = model['alias'] %}\n    {% set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) %}\n\n    {% set store_failures_as = config.get('store_failures_as') %}\n    -- if `--store-failures` is invoked via command line and `store_failures_as` is not set,\n    -- config.get('store_failures_as', 'table') returns None, not 'table'\n    {% if store_failures_as == none %}{% set store_failures_as = 'table' %}{% endif %}\n    {% if store_failures_as not in ['table', 'view'] %}\n        {{ exceptions.raise_compiler_error(\n            \"'\" ~ store_failures_as ~ \"' is not a valid value for `store_failures_as`. \"\n            \"Accepted values are: ['ephemeral', 'table', 'view']\"\n        ) }}\n    {% endif %}\n\n    {% set target_relation = api.Relation.create(\n        identifier=identifier, schema=schema, database=database, type=store_failures_as) -%} %}\n\n    {% if old_relation %}\n        {% do adapter.drop_relation(old_relation) %}\n    {% endif %}\n\n    {% call statement(auto_begin=True) %}\n        {{ get_create_sql(target_relation, sql) }}\n    {% endcall %}\n\n    {% do relations.append(target_relation) %}\n\n    {% set main_sql %}\n        select *\n        from {{ target_relation }}\n    {% endset %}\n\n    {{ adapter.commit() }}\n\n  {% else %}\n\n      {% set main_sql = sql %}\n\n  {% endif %}\n\n  {% set limit = config.get('limit') %}\n  {% set fail_calc = config.get('fail_calc') %}\n  {% set warn_if = config.get('warn_if') %}\n  {% set error_if = config.get('error_if') %}\n\n  {% call statement('main', fetch_result=True) -%}\n\n    {{ get_test_sql(main_sql, fail_calc, warn_if, error_if, limit)}}\n\n  {%- endcall %}\n\n  {{ return({'relations': relations}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.should_store_failures", "macro.dbt.statement", "macro.dbt.get_create_sql", "macro.dbt.get_test_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7751338, "supported_languages": ["sql"]}, "macro.dbt.get_test_sql": {"name": "get_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.get_test_sql", "macro_sql": "{% macro get_test_sql(main_sql, fail_calc, warn_if, error_if, limit) -%}\n  {{ adapter.dispatch('get_test_sql', 'dbt')(main_sql, fail_calc, warn_if, error_if, limit) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_test_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.775936, "supported_languages": null}, "macro.dbt.default__get_test_sql": {"name": "default__get_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.default__get_test_sql", "macro_sql": "{% macro default__get_test_sql(main_sql, fail_calc, warn_if, error_if, limit) -%}\n    select\n      {{ fail_calc }} as failures,\n      {{ fail_calc }} {{ warn_if }} as should_warn,\n      {{ fail_calc }} {{ error_if }} as should_error\n    from (\n      {{ main_sql }}\n      {{ \"limit \" ~ limit if limit != none }}\n    ) dbt_internal_test\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7764714, "supported_languages": null}, "macro.dbt.get_where_subquery": {"name": "get_where_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/where_subquery.sql", "original_file_path": "macros/materializations/tests/where_subquery.sql", "unique_id": "macro.dbt.get_where_subquery", "macro_sql": "{% macro get_where_subquery(relation) -%}\n    {% do return(adapter.dispatch('get_where_subquery', 'dbt')(relation)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_where_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7770603, "supported_languages": null}, "macro.dbt.default__get_where_subquery": {"name": "default__get_where_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/where_subquery.sql", "original_file_path": "macros/materializations/tests/where_subquery.sql", "unique_id": "macro.dbt.default__get_where_subquery", "macro_sql": "{% macro default__get_where_subquery(relation) -%}\n    {% set where = config.get('where', '') %}\n    {% if where %}\n        {%- set filtered -%}\n            (select * from {{ relation }} where {{ where }}) dbt_subquery\n        {%- endset -%}\n        {% do return(filtered) %}\n    {%- else -%}\n        {% do return(relation) %}\n    {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.777738, "supported_languages": null}, "macro.dbt.materialization_seed_default": {"name": "materialization_seed_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/seed.sql", "original_file_path": "macros/materializations/seeds/seed.sql", "unique_id": "macro.dbt.materialization_seed_default", "macro_sql": "{% materialization seed, default %}\n\n  {%- set identifier = model['alias'] -%}\n  {%- set full_refresh_mode = (should_full_refresh()) -%}\n\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n\n  {%- set exists_as_table = (old_relation is not none and old_relation.is_table) -%}\n  {%- set exists_as_view = (old_relation is not none and old_relation.is_view) -%}\n\n  {%- set grant_config = config.get('grants') -%}\n  {%- set agate_table = load_agate_table() -%}\n  -- grab current tables grants config for comparison later on\n\n  {%- do store_result('agate_table', response='OK', agate_table=agate_table) -%}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% set create_table_sql = \"\" %}\n  {% if exists_as_view %}\n    {{ exceptions.raise_compiler_error(\"Cannot seed to '{}', it is a view\".format(old_relation)) }}\n  {% elif exists_as_table %}\n    {% set create_table_sql = reset_csv_table(model, full_refresh_mode, old_relation, agate_table) %}\n  {% else %}\n    {% set create_table_sql = create_csv_table(model, agate_table) %}\n  {% endif %}\n\n  {% set code = 'CREATE' if full_refresh_mode else 'INSERT' %}\n  {% set rows_affected = (agate_table.rows | length) %}\n  {% set sql = load_csv_rows(model, agate_table) %}\n\n  {% call noop_statement('main', code ~ ' ' ~ rows_affected, code, rows_affected) %}\n    {{ get_csv_sql(create_table_sql, sql) }};\n  {% endcall %}\n\n  {% set target_relation = this.incorporate(type='table') %}\n\n  {% set should_revoke = should_revoke(old_relation, full_refresh_mode) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {% if full_refresh_mode or not exists_as_table %}\n    {% do create_indexes(target_relation) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  -- `COMMIT` happens here\n  {{ adapter.commit() }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh", "macro.dbt.run_hooks", "macro.dbt.reset_csv_table", "macro.dbt.create_csv_table", "macro.dbt.load_csv_rows", "macro.dbt.noop_statement", "macro.dbt.get_csv_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs", "macro.dbt.create_indexes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7830408, "supported_languages": ["sql"]}, "macro.dbt.create_csv_table": {"name": "create_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.create_csv_table", "macro_sql": "{% macro create_csv_table(model, agate_table) -%}\n  {{ adapter.dispatch('create_csv_table', 'dbt')(model, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7891724, "supported_languages": null}, "macro.dbt.default__create_csv_table": {"name": "default__create_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__create_csv_table", "macro_sql": "{% macro default__create_csv_table(model, agate_table) %}\n  {%- set column_override = model['config'].get('column_types', {}) -%}\n  {%- set quote_seed_column = model['config'].get('quote_columns', None) -%}\n\n  {% set sql %}\n    create table {{ this.render() }} (\n        {%- for col_name in agate_table.column_names -%}\n            {%- set inferred_type = adapter.convert_type(agate_table, loop.index0) -%}\n            {%- set type = column_override.get(col_name, inferred_type) -%}\n            {%- set column_name = (col_name | string) -%}\n            {{ adapter.quote_seed_column(column_name, quote_seed_column) }} {{ type }} {%- if not loop.last -%}, {%- endif -%}\n        {%- endfor -%}\n    )\n  {% endset %}\n\n  {% call statement('_') -%}\n    {{ sql }}\n  {%- endcall %}\n\n  {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7908425, "supported_languages": null}, "macro.dbt.reset_csv_table": {"name": "reset_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.reset_csv_table", "macro_sql": "{% macro reset_csv_table(model, full_refresh, old_relation, agate_table) -%}\n  {{ adapter.dispatch('reset_csv_table', 'dbt')(model, full_refresh, old_relation, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__reset_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7912772, "supported_languages": null}, "macro.dbt.default__reset_csv_table": {"name": "default__reset_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__reset_csv_table", "macro_sql": "{% macro default__reset_csv_table(model, full_refresh, old_relation, agate_table) %}\n    {% set sql = \"\" %}\n    {% if full_refresh %}\n        {{ adapter.drop_relation(old_relation) }}\n        {% set sql = create_csv_table(model, agate_table) %}\n    {% else %}\n        {{ adapter.truncate_relation(old_relation) }}\n        {% set sql = \"truncate table \" ~ old_relation %}\n    {% endif %}\n\n    {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7921343, "supported_languages": null}, "macro.dbt.get_csv_sql": {"name": "get_csv_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_csv_sql", "macro_sql": "{% macro get_csv_sql(create_or_truncate_sql, insert_sql) %}\n    {{ adapter.dispatch('get_csv_sql', 'dbt')(create_or_truncate_sql, insert_sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_csv_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7924907, "supported_languages": null}, "macro.dbt.default__get_csv_sql": {"name": "default__get_csv_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_csv_sql", "macro_sql": "{% macro default__get_csv_sql(create_or_truncate_sql, insert_sql) %}\n    {{ create_or_truncate_sql }};\n    -- dbt seed --\n    {{ insert_sql }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.792762, "supported_languages": null}, "macro.dbt.get_binding_char": {"name": "get_binding_char", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_binding_char", "macro_sql": "{% macro get_binding_char() -%}\n  {{ adapter.dispatch('get_binding_char', 'dbt')() }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_binding_char"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.793036, "supported_languages": null}, "macro.dbt.default__get_binding_char": {"name": "default__get_binding_char", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_binding_char", "macro_sql": "{% macro default__get_binding_char() %}\n  {{ return('%s') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.793269, "supported_languages": null}, "macro.dbt.get_batch_size": {"name": "get_batch_size", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_batch_size", "macro_sql": "{% macro get_batch_size() -%}\n  {{ return(adapter.dispatch('get_batch_size', 'dbt')()) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_batch_size"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.793576, "supported_languages": null}, "macro.dbt.default__get_batch_size": {"name": "default__get_batch_size", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_batch_size", "macro_sql": "{% macro default__get_batch_size() %}\n  {{ return(10000) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7938194, "supported_languages": null}, "macro.dbt.get_seed_column_quoted_csv": {"name": "get_seed_column_quoted_csv", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_seed_column_quoted_csv", "macro_sql": "{% macro get_seed_column_quoted_csv(model, column_names) %}\n  {%- set quote_seed_column = model['config'].get('quote_columns', None) -%}\n    {% set quoted = [] %}\n    {% for col in column_names -%}\n        {%- do quoted.append(adapter.quote_seed_column(col, quote_seed_column)) -%}\n    {%- endfor %}\n\n    {%- set dest_cols_csv = quoted | join(', ') -%}\n    {{ return(dest_cols_csv) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7947574, "supported_languages": null}, "macro.dbt.load_csv_rows": {"name": "load_csv_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.load_csv_rows", "macro_sql": "{% macro load_csv_rows(model, agate_table) -%}\n  {{ adapter.dispatch('load_csv_rows', 'dbt')(model, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__load_csv_rows"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7951112, "supported_languages": null}, "macro.dbt.default__load_csv_rows": {"name": "default__load_csv_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__load_csv_rows", "macro_sql": "{% macro default__load_csv_rows(model, agate_table) %}\n\n  {% set batch_size = get_batch_size() %}\n\n  {% set cols_sql = get_seed_column_quoted_csv(model, agate_table.column_names) %}\n  {% set bindings = [] %}\n\n  {% set statements = [] %}\n\n  {% for chunk in agate_table.rows | batch(batch_size) %}\n      {% set bindings = [] %}\n\n      {% for row in chunk %}\n          {% do bindings.extend(row) %}\n      {% endfor %}\n\n      {% set sql %}\n          insert into {{ this.render() }} ({{ cols_sql }}) values\n          {% for row in chunk -%}\n              ({%- for column in agate_table.column_names -%}\n                  {{ get_binding_char() }}\n                  {%- if not loop.last%},{%- endif %}\n              {%- endfor -%})\n              {%- if not loop.last%},{%- endif %}\n          {%- endfor %}\n      {% endset %}\n\n      {% do adapter.add_query(sql, bindings=bindings, abridge_sql_log=True) %}\n\n      {% if loop.index0 == 0 %}\n          {% do statements.append(sql) %}\n      {% endif %}\n  {% endfor %}\n\n  {# Return SQL so we can render it out into the compiled files #}\n  {{ return(statements[0]) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_batch_size", "macro.dbt.get_seed_column_quoted_csv", "macro.dbt.get_binding_char"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7975707, "supported_languages": null}, "macro.dbt.snapshot_merge_sql": {"name": "snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshots/snapshot_merge.sql", "unique_id": "macro.dbt.snapshot_merge_sql", "macro_sql": "{% macro snapshot_merge_sql(target, source, insert_cols) -%}\n  {{ adapter.dispatch('snapshot_merge_sql', 'dbt')(target, source, insert_cols) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__snapshot_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7982693, "supported_languages": null}, "macro.dbt.default__snapshot_merge_sql": {"name": "default__snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshots/snapshot_merge.sql", "unique_id": "macro.dbt.default__snapshot_merge_sql", "macro_sql": "{% macro default__snapshot_merge_sql(target, source, insert_cols) -%}\n    {%- set insert_cols_csv = insert_cols | join(', ') -%}\n\n    merge into {{ target }} as DBT_INTERNAL_DEST\n    using {{ source }} as DBT_INTERNAL_SOURCE\n    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id\n\n    when matched\n     and DBT_INTERNAL_DEST.dbt_valid_to is null\n     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')\n        then update\n        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to\n\n    when not matched\n     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'\n        then insert ({{ insert_cols_csv }})\n        values ({{ insert_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.7987626, "supported_languages": null}, "macro.dbt.create_columns": {"name": "create_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.create_columns", "macro_sql": "{% macro create_columns(relation, columns) %}\n  {{ adapter.dispatch('create_columns', 'dbt')(relation, columns) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__create_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8035707, "supported_languages": null}, "macro.dbt.default__create_columns": {"name": "default__create_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__create_columns", "macro_sql": "{% macro default__create_columns(relation, columns) %}\n  {% for column in columns %}\n    {% call statement() %}\n      alter table {{ relation }} add column \"{{ column.name }}\" {{ column.data_type }};\n    {% endcall %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8041215, "supported_languages": null}, "macro.dbt.post_snapshot": {"name": "post_snapshot", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.post_snapshot", "macro_sql": "{% macro post_snapshot(staging_relation) %}\n  {{ adapter.dispatch('post_snapshot', 'dbt')(staging_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__post_snapshot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8044572, "supported_languages": null}, "macro.dbt.default__post_snapshot": {"name": "default__post_snapshot", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__post_snapshot", "macro_sql": "{% macro default__post_snapshot(staging_relation) %}\n    {# no-op #}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.804649, "supported_languages": null}, "macro.dbt.get_true_sql": {"name": "get_true_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.get_true_sql", "macro_sql": "{% macro get_true_sql() %}\n  {{ adapter.dispatch('get_true_sql', 'dbt')() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_true_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8049471, "supported_languages": null}, "macro.dbt.default__get_true_sql": {"name": "default__get_true_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__get_true_sql", "macro_sql": "{% macro default__get_true_sql() %}\n    {{ return('TRUE') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.805181, "supported_languages": null}, "macro.dbt.snapshot_staging_table": {"name": "snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.snapshot_staging_table", "macro_sql": "{% macro snapshot_staging_table(strategy, source_sql, target_relation) -%}\n  {{ adapter.dispatch('snapshot_staging_table', 'dbt')(strategy, source_sql, target_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__snapshot_staging_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8055623, "supported_languages": null}, "macro.dbt.default__snapshot_staging_table": {"name": "default__snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__snapshot_staging_table", "macro_sql": "{% macro default__snapshot_staging_table(strategy, source_sql, target_relation) -%}\n\n    with snapshot_query as (\n\n        {{ source_sql }}\n\n    ),\n\n    snapshotted_data as (\n\n        select *,\n            {{ strategy.unique_key }} as dbt_unique_key\n\n        from {{ target_relation }}\n        where dbt_valid_to is null\n\n    ),\n\n    insertions_source_data as (\n\n        select\n            *,\n            {{ strategy.unique_key }} as dbt_unique_key,\n            {{ strategy.updated_at }} as dbt_updated_at,\n            {{ strategy.updated_at }} as dbt_valid_from,\n            nullif({{ strategy.updated_at }}, {{ strategy.updated_at }}) as dbt_valid_to,\n            {{ strategy.scd_id }} as dbt_scd_id\n\n        from snapshot_query\n    ),\n\n    updates_source_data as (\n\n        select\n            *,\n            {{ strategy.unique_key }} as dbt_unique_key,\n            {{ strategy.updated_at }} as dbt_updated_at,\n            {{ strategy.updated_at }} as dbt_valid_from,\n            {{ strategy.updated_at }} as dbt_valid_to\n\n        from snapshot_query\n    ),\n\n    {%- if strategy.invalidate_hard_deletes %}\n\n    deletes_source_data as (\n\n        select\n            *,\n            {{ strategy.unique_key }} as dbt_unique_key\n        from snapshot_query\n    ),\n    {% endif %}\n\n    insertions as (\n\n        select\n            'insert' as dbt_change_type,\n            source_data.*\n\n        from insertions_source_data as source_data\n        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key\n        where snapshotted_data.dbt_unique_key is null\n           or (\n                snapshotted_data.dbt_unique_key is not null\n            and (\n                {{ strategy.row_changed }}\n            )\n        )\n\n    ),\n\n    updates as (\n\n        select\n            'update' as dbt_change_type,\n            source_data.*,\n            snapshotted_data.dbt_scd_id\n\n        from updates_source_data as source_data\n        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key\n        where (\n            {{ strategy.row_changed }}\n        )\n    )\n\n    {%- if strategy.invalidate_hard_deletes -%}\n    ,\n\n    deletes as (\n\n        select\n            'delete' as dbt_change_type,\n            source_data.*,\n            {{ snapshot_get_time() }} as dbt_valid_from,\n            {{ snapshot_get_time() }} as dbt_updated_at,\n            {{ snapshot_get_time() }} as dbt_valid_to,\n            snapshotted_data.dbt_scd_id\n\n        from snapshotted_data\n        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key\n        where source_data.dbt_unique_key is null\n    )\n    {%- endif %}\n\n    select * from insertions\n    union all\n    select * from updates\n    {%- if strategy.invalidate_hard_deletes %}\n    union all\n    select * from deletes\n    {%- endif %}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.snapshot_get_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8070924, "supported_languages": null}, "macro.dbt.build_snapshot_table": {"name": "build_snapshot_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.build_snapshot_table", "macro_sql": "{% macro build_snapshot_table(strategy, sql) -%}\n  {{ adapter.dispatch('build_snapshot_table', 'dbt')(strategy, sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__build_snapshot_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8074565, "supported_languages": null}, "macro.dbt.default__build_snapshot_table": {"name": "default__build_snapshot_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__build_snapshot_table", "macro_sql": "{% macro default__build_snapshot_table(strategy, sql) %}\n\n    select *,\n        {{ strategy.scd_id }} as dbt_scd_id,\n        {{ strategy.updated_at }} as dbt_updated_at,\n        {{ strategy.updated_at }} as dbt_valid_from,\n        nullif({{ strategy.updated_at }}, {{ strategy.updated_at }}) as dbt_valid_to\n    from (\n        {{ sql }}\n    ) sbq\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.807925, "supported_languages": null}, "macro.dbt.build_snapshot_staging_table": {"name": "build_snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.build_snapshot_staging_table", "macro_sql": "{% macro build_snapshot_staging_table(strategy, sql, target_relation) %}\n    {% set temp_relation = make_temp_relation(target_relation) %}\n\n    {% set select = snapshot_staging_table(strategy, sql, target_relation) %}\n\n    {% call statement('build_snapshot_staging_relation') %}\n        {{ create_table_as(True, temp_relation, select) }}\n    {% endcall %}\n\n    {% do return(temp_relation) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_temp_relation", "macro.dbt.snapshot_staging_table", "macro.dbt.statement", "macro.dbt.create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8087041, "supported_languages": null}, "macro.dbt.strategy_dispatch": {"name": "strategy_dispatch", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.strategy_dispatch", "macro_sql": "{% macro strategy_dispatch(name) -%}\n{% set original_name = name %}\n  {% if '.' in name %}\n    {% set package_name, name = name.split(\".\", 1) %}\n  {% else %}\n    {% set package_name = none %}\n  {% endif %}\n\n  {% if package_name is none %}\n    {% set package_context = context %}\n  {% elif package_name in context %}\n    {% set package_context = context[package_name] %}\n  {% else %}\n    {% set error_msg %}\n        Could not find package '{{package_name}}', called with '{{original_name}}'\n    {% endset %}\n    {{ exceptions.raise_compiler_error(error_msg | trim) }}\n  {% endif %}\n\n  {%- set search_name = 'snapshot_' ~ name ~ '_strategy' -%}\n\n  {% if search_name not in package_context %}\n    {% set error_msg %}\n        The specified strategy macro '{{name}}' was not found in package '{{ package_name }}'\n    {% endset %}\n    {{ exceptions.raise_compiler_error(error_msg | trim) }}\n  {% endif %}\n  {{ return(package_context[search_name]) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8138363, "supported_languages": null}, "macro.dbt.snapshot_hash_arguments": {"name": "snapshot_hash_arguments", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_hash_arguments", "macro_sql": "{% macro snapshot_hash_arguments(args) -%}\n  {{ adapter.dispatch('snapshot_hash_arguments', 'dbt')(args) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.814153, "supported_languages": null}, "macro.dbt.default__snapshot_hash_arguments": {"name": "default__snapshot_hash_arguments", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.default__snapshot_hash_arguments", "macro_sql": "{% macro default__snapshot_hash_arguments(args) -%}\n    md5({%- for arg in args -%}\n        coalesce(cast({{ arg }} as varchar ), '')\n        {% if not loop.last %} || '|' || {% endif %}\n    {%- endfor -%})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8145673, "supported_languages": null}, "macro.dbt.snapshot_timestamp_strategy": {"name": "snapshot_timestamp_strategy", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_timestamp_strategy", "macro_sql": "{% macro snapshot_timestamp_strategy(node, snapshotted_rel, current_rel, config, target_exists) %}\n    {% set primary_key = config['unique_key'] %}\n    {% set updated_at = config['updated_at'] %}\n    {% set invalidate_hard_deletes = config.get('invalidate_hard_deletes', false) %}\n\n    {#/*\n        The snapshot relation might not have an {{ updated_at }} value if the\n        snapshot strategy is changed from `check` to `timestamp`. We\n        should use a dbt-created column for the comparison in the snapshot\n        table instead of assuming that the user-supplied {{ updated_at }}\n        will be present in the historical data.\n\n        See https://github.com/dbt-labs/dbt-core/issues/2350\n    */ #}\n    {% set row_changed_expr -%}\n        ({{ snapshotted_rel }}.dbt_valid_from < {{ current_rel }}.{{ updated_at }})\n    {%- endset %}\n\n    {% set scd_id_expr = snapshot_hash_arguments([primary_key, updated_at]) %}\n\n    {% do return({\n        \"unique_key\": primary_key,\n        \"updated_at\": updated_at,\n        \"row_changed\": row_changed_expr,\n        \"scd_id\": scd_id_expr,\n        \"invalidate_hard_deletes\": invalidate_hard_deletes\n    }) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.815918, "supported_languages": null}, "macro.dbt.snapshot_string_as_time": {"name": "snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_string_as_time", "macro_sql": "{% macro snapshot_string_as_time(timestamp) -%}\n    {{ adapter.dispatch('snapshot_string_as_time', 'dbt')(timestamp) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__snapshot_string_as_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8162422, "supported_languages": null}, "macro.dbt.default__snapshot_string_as_time": {"name": "default__snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.default__snapshot_string_as_time", "macro_sql": "{% macro default__snapshot_string_as_time(timestamp) %}\n    {% do exceptions.raise_not_implemented(\n        'snapshot_string_as_time macro not implemented for adapter '+adapter.type()\n    ) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.81656, "supported_languages": null}, "macro.dbt.snapshot_check_all_get_existing_columns": {"name": "snapshot_check_all_get_existing_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_check_all_get_existing_columns", "macro_sql": "{% macro snapshot_check_all_get_existing_columns(node, target_exists, check_cols_config) -%}\n    {%- if not target_exists -%}\n        {#-- no table yet -> return whatever the query does --#}\n        {{ return((false, query_columns)) }}\n    {%- endif -%}\n\n    {#-- handle any schema changes --#}\n    {%- set target_relation = adapter.get_relation(database=node.database, schema=node.schema, identifier=node.alias) -%}\n\n    {% if check_cols_config == 'all' %}\n        {%- set query_columns = get_columns_in_query(node['compiled_code']) -%}\n\n    {% elif check_cols_config is iterable and (check_cols_config | length) > 0 %}\n        {#-- query for proper casing/quoting, to support comparison below --#}\n        {%- set select_check_cols_from_target -%}\n            {#-- N.B. The whitespace below is necessary to avoid edge case issue with comments --#}\n            {#-- See: https://github.com/dbt-labs/dbt-core/issues/6781 --#}\n            select {{ check_cols_config | join(', ') }} from (\n                {{ node['compiled_code'] }}\n            ) subq\n        {%- endset -%}\n        {% set query_columns = get_columns_in_query(select_check_cols_from_target) %}\n\n    {% else %}\n        {% do exceptions.raise_compiler_error(\"Invalid value for 'check_cols': \" ~ check_cols_config) %}\n    {% endif %}\n\n    {%- set existing_cols = adapter.get_columns_in_relation(target_relation) | map(attribute = 'name') | list -%}\n    {%- set ns = namespace() -%} {#-- handle for-loop scoping with a namespace --#}\n    {%- set ns.column_added = false -%}\n\n    {%- set intersection = [] -%}\n    {%- for col in query_columns -%}\n        {%- if col in existing_cols -%}\n            {%- do intersection.append(adapter.quote(col)) -%}\n        {%- else -%}\n            {% set ns.column_added = true %}\n        {%- endif -%}\n    {%- endfor -%}\n    {{ return((ns.column_added, intersection)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_columns_in_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8190575, "supported_languages": null}, "macro.dbt.snapshot_check_strategy": {"name": "snapshot_check_strategy", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_check_strategy", "macro_sql": "{% macro snapshot_check_strategy(node, snapshotted_rel, current_rel, config, target_exists) %}\n    {% set check_cols_config = config['check_cols'] %}\n    {% set primary_key = config['unique_key'] %}\n    {% set invalidate_hard_deletes = config.get('invalidate_hard_deletes', false) %}\n    {% set updated_at = config.get('updated_at', snapshot_get_time()) %}\n\n    {% set column_added = false %}\n\n    {% set column_added, check_cols = snapshot_check_all_get_existing_columns(node, target_exists, check_cols_config) %}\n\n    {%- set row_changed_expr -%}\n    (\n    {%- if column_added -%}\n        {{ get_true_sql() }}\n    {%- else -%}\n    {%- for col in check_cols -%}\n        {{ snapshotted_rel }}.{{ col }} != {{ current_rel }}.{{ col }}\n        or\n        (\n            (({{ snapshotted_rel }}.{{ col }} is null) and not ({{ current_rel }}.{{ col }} is null))\n            or\n            ((not {{ snapshotted_rel }}.{{ col }} is null) and ({{ current_rel }}.{{ col }} is null))\n        )\n        {%- if not loop.last %} or {% endif -%}\n    {%- endfor -%}\n    {%- endif -%}\n    )\n    {%- endset %}\n\n    {% set scd_id_expr = snapshot_hash_arguments([primary_key, updated_at]) %}\n\n    {% do return({\n        \"unique_key\": primary_key,\n        \"updated_at\": updated_at,\n        \"row_changed\": row_changed_expr,\n        \"scd_id\": scd_id_expr,\n        \"invalidate_hard_deletes\": invalidate_hard_deletes\n    }) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.snapshot_get_time", "macro.dbt.snapshot_check_all_get_existing_columns", "macro.dbt.get_true_sql", "macro.dbt.snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8213837, "supported_languages": null}, "macro.dbt.materialization_snapshot_default": {"name": "materialization_snapshot_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot.sql", "original_file_path": "macros/materializations/snapshots/snapshot.sql", "unique_id": "macro.dbt.materialization_snapshot_default", "macro_sql": "{% materialization snapshot, default %}\n  {%- set config = model['config'] -%}\n\n  {%- set target_table = model.get('alias', model.get('name')) -%}\n\n  {%- set strategy_name = config.get('strategy') -%}\n  {%- set unique_key = config.get('unique_key') %}\n  -- grab current tables grants config for comparision later on\n  {%- set grant_config = config.get('grants') -%}\n\n  {% set target_relation_exists, target_relation = get_or_create_relation(\n          database=model.database,\n          schema=model.schema,\n          identifier=target_table,\n          type='table') -%}\n\n  {%- if not target_relation.is_table -%}\n    {% do exceptions.relation_wrong_type(target_relation, 'table') %}\n  {%- endif -%}\n\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  {% set strategy_macro = strategy_dispatch(strategy_name) %}\n  {% set strategy = strategy_macro(model, \"snapshotted_data\", \"source_data\", config, target_relation_exists) %}\n\n  {% if not target_relation_exists %}\n\n      {% set build_sql = build_snapshot_table(strategy, model['compiled_code']) %}\n      {% set final_sql = create_table_as(False, target_relation, build_sql) %}\n\n  {% else %}\n\n      {{ adapter.valid_snapshot_target(target_relation) }}\n\n      {% set staging_table = build_snapshot_staging_table(strategy, sql, target_relation) %}\n\n      -- this may no-op if the database does not require column expansion\n      {% do adapter.expand_target_column_types(from_relation=staging_table,\n                                               to_relation=target_relation) %}\n\n      {% set missing_columns = adapter.get_missing_columns(staging_table, target_relation)\n                                   | rejectattr('name', 'equalto', 'dbt_change_type')\n                                   | rejectattr('name', 'equalto', 'DBT_CHANGE_TYPE')\n                                   | rejectattr('name', 'equalto', 'dbt_unique_key')\n                                   | rejectattr('name', 'equalto', 'DBT_UNIQUE_KEY')\n                                   | list %}\n\n      {% do create_columns(target_relation, missing_columns) %}\n\n      {% set source_columns = adapter.get_columns_in_relation(staging_table)\n                                   | rejectattr('name', 'equalto', 'dbt_change_type')\n                                   | rejectattr('name', 'equalto', 'DBT_CHANGE_TYPE')\n                                   | rejectattr('name', 'equalto', 'dbt_unique_key')\n                                   | rejectattr('name', 'equalto', 'DBT_UNIQUE_KEY')\n                                   | list %}\n\n      {% set quoted_source_columns = [] %}\n      {% for column in source_columns %}\n        {% do quoted_source_columns.append(adapter.quote(column.name)) %}\n      {% endfor %}\n\n      {% set final_sql = snapshot_merge_sql(\n            target = target_relation,\n            source = staging_table,\n            insert_cols = quoted_source_columns\n         )\n      %}\n\n  {% endif %}\n\n  {% call statement('main') %}\n      {{ final_sql }}\n  {% endcall %}\n\n  {% set should_revoke = should_revoke(target_relation_exists, full_refresh_mode=False) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {% if not target_relation_exists %}\n    {% do create_indexes(target_relation) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {{ adapter.commit() }}\n\n  {% if staging_table is defined %}\n      {% do post_snapshot(staging_table) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.get_or_create_relation", "macro.dbt.run_hooks", "macro.dbt.strategy_dispatch", "macro.dbt.build_snapshot_table", "macro.dbt.create_table_as", "macro.dbt.build_snapshot_staging_table", "macro.dbt.create_columns", "macro.dbt.snapshot_merge_sql", "macro.dbt.statement", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs", "macro.dbt.create_indexes", "macro.dbt.post_snapshot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8304975, "supported_languages": ["sql"]}, "macro.dbt.get_show_sql": {"name": "get_show_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.get_show_sql", "macro_sql": "{% macro get_show_sql(compiled_code, sql_header, limit) -%}\n  {%- if sql_header -%}\n  {{ sql_header }}\n  {%- endif -%}\n  {%- if limit is not none -%}\n  {{ get_limit_subquery_sql(compiled_code, limit) }}\n  {%- else -%}\n  {{ compiled_code }}\n  {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_limit_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8314526, "supported_languages": null}, "macro.dbt.get_limit_subquery_sql": {"name": "get_limit_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.get_limit_subquery_sql", "macro_sql": "{% macro get_limit_subquery_sql(sql, limit) %}\n  {{ adapter.dispatch('get_limit_subquery_sql', 'dbt')(sql, limit) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_limit_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8318086, "supported_languages": null}, "macro.dbt.default__get_limit_subquery_sql": {"name": "default__get_limit_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.default__get_limit_subquery_sql", "macro_sql": "{% macro default__get_limit_subquery_sql(sql, limit) %}\n    select *\n    from (\n        {{ sql }}\n    ) as model_limit_subq\n    limit {{ limit }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8320699, "supported_languages": null}, "macro.dbt.collect_freshness": {"name": "collect_freshness", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.collect_freshness", "macro_sql": "{% macro collect_freshness(source, loaded_at_field, filter) %}\n  {{ return(adapter.dispatch('collect_freshness', 'dbt')(source, loaded_at_field, filter))}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__collect_freshness"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8327613, "supported_languages": null}, "macro.dbt.default__collect_freshness": {"name": "default__collect_freshness", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.default__collect_freshness", "macro_sql": "{% macro default__collect_freshness(source, loaded_at_field, filter) %}\n  {% call statement('collect_freshness', fetch_result=True, auto_begin=False) -%}\n    select\n      max({{ loaded_at_field }}) as max_loaded_at,\n      {{ current_timestamp() }} as snapshotted_at\n    from {{ source }}\n    {% if filter %}\n    where {{ filter }}\n    {% endif %}\n  {% endcall %}\n  {{ return(load_result('collect_freshness')) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8334851, "supported_languages": null}, "macro.dbt.copy_grants": {"name": "copy_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.copy_grants", "macro_sql": "{% macro copy_grants() %}\n    {{ return(adapter.dispatch('copy_grants', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__copy_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8358147, "supported_languages": null}, "macro.dbt.default__copy_grants": {"name": "default__copy_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__copy_grants", "macro_sql": "{% macro default__copy_grants() %}\n    {{ return(True) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8360455, "supported_languages": null}, "macro.dbt.support_multiple_grantees_per_dcl_statement": {"name": "support_multiple_grantees_per_dcl_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.support_multiple_grantees_per_dcl_statement", "macro_sql": "{% macro support_multiple_grantees_per_dcl_statement() %}\n    {{ return(adapter.dispatch('support_multiple_grantees_per_dcl_statement', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__support_multiple_grantees_per_dcl_statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8363602, "supported_languages": null}, "macro.dbt.default__support_multiple_grantees_per_dcl_statement": {"name": "default__support_multiple_grantees_per_dcl_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__support_multiple_grantees_per_dcl_statement", "macro_sql": "\n\n{%- macro default__support_multiple_grantees_per_dcl_statement() -%}\n    {{ return(True) }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8365817, "supported_languages": null}, "macro.dbt.should_revoke": {"name": "should_revoke", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.should_revoke", "macro_sql": "{% macro should_revoke(existing_relation, full_refresh_mode=True) %}\n\n    {% if not existing_relation %}\n        {#-- The table doesn't already exist, so no grants to copy over --#}\n        {{ return(False) }}\n    {% elif full_refresh_mode %}\n        {#-- The object is being REPLACED -- whether grants are copied over depends on the value of user config --#}\n        {{ return(copy_grants()) }}\n    {% else %}\n        {#-- The table is being merged/upserted/inserted -- grants will be carried over --#}\n        {{ return(True) }}\n    {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.copy_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.837207, "supported_languages": null}, "macro.dbt.get_show_grant_sql": {"name": "get_show_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_show_grant_sql", "macro_sql": "{% macro get_show_grant_sql(relation) %}\n    {{ return(adapter.dispatch(\"get_show_grant_sql\", \"dbt\")(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_show_grant_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8375561, "supported_languages": null}, "macro.dbt.default__get_show_grant_sql": {"name": "default__get_show_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_show_grant_sql", "macro_sql": "{% macro default__get_show_grant_sql(relation) %}\n    show grants on {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8377807, "supported_languages": null}, "macro.dbt.get_grant_sql": {"name": "get_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_grant_sql", "macro_sql": "{% macro get_grant_sql(relation, privilege, grantees) %}\n    {{ return(adapter.dispatch('get_grant_sql', 'dbt')(relation, privilege, grantees)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_grant_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8381834, "supported_languages": null}, "macro.dbt.default__get_grant_sql": {"name": "default__get_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_grant_sql", "macro_sql": "\n\n{%- macro default__get_grant_sql(relation, privilege, grantees) -%}\n    grant {{ privilege }} on {{ relation }} to {{ grantees | join(', ') }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8385274, "supported_languages": null}, "macro.dbt.get_revoke_sql": {"name": "get_revoke_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_revoke_sql", "macro_sql": "{% macro get_revoke_sql(relation, privilege, grantees) %}\n    {{ return(adapter.dispatch('get_revoke_sql', 'dbt')(relation, privilege, grantees)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_revoke_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8390028, "supported_languages": null}, "macro.dbt.default__get_revoke_sql": {"name": "default__get_revoke_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_revoke_sql", "macro_sql": "\n\n{%- macro default__get_revoke_sql(relation, privilege, grantees) -%}\n    revoke {{ privilege }} on {{ relation }} from {{ grantees | join(', ') }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.839358, "supported_languages": null}, "macro.dbt.get_dcl_statement_list": {"name": "get_dcl_statement_list", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_dcl_statement_list", "macro_sql": "{% macro get_dcl_statement_list(relation, grant_config, get_dcl_macro) %}\n    {{ return(adapter.dispatch('get_dcl_statement_list', 'dbt')(relation, grant_config, get_dcl_macro)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_dcl_statement_list"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.839789, "supported_languages": null}, "macro.dbt.default__get_dcl_statement_list": {"name": "default__get_dcl_statement_list", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_dcl_statement_list", "macro_sql": "\n\n{%- macro default__get_dcl_statement_list(relation, grant_config, get_dcl_macro) -%}\n    {#\n      -- Unpack grant_config into specific privileges and the set of users who need them granted/revoked.\n      -- Depending on whether this database supports multiple grantees per statement, pass in the list of\n      -- all grantees per privilege, or (if not) template one statement per privilege-grantee pair.\n      -- `get_dcl_macro` will be either `get_grant_sql` or `get_revoke_sql`\n    #}\n    {%- set dcl_statements = [] -%}\n    {%- for privilege, grantees in grant_config.items() %}\n        {%- if support_multiple_grantees_per_dcl_statement() and grantees -%}\n          {%- set dcl = get_dcl_macro(relation, privilege, grantees) -%}\n          {%- do dcl_statements.append(dcl) -%}\n        {%- else -%}\n          {%- for grantee in grantees -%}\n              {% set dcl = get_dcl_macro(relation, privilege, [grantee]) %}\n              {%- do dcl_statements.append(dcl) -%}\n          {% endfor -%}\n        {%- endif -%}\n    {%- endfor -%}\n    {{ return(dcl_statements) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.support_multiple_grantees_per_dcl_statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.841043, "supported_languages": null}, "macro.dbt.call_dcl_statements": {"name": "call_dcl_statements", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.call_dcl_statements", "macro_sql": "{% macro call_dcl_statements(dcl_statement_list) %}\n    {{ return(adapter.dispatch(\"call_dcl_statements\", \"dbt\")(dcl_statement_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__call_dcl_statements"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.841393, "supported_languages": null}, "macro.dbt.default__call_dcl_statements": {"name": "default__call_dcl_statements", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__call_dcl_statements", "macro_sql": "{% macro default__call_dcl_statements(dcl_statement_list) %}\n    {#\n      -- By default, supply all grant + revoke statements in a single semicolon-separated block,\n      -- so that they're all processed together.\n\n      -- Some databases do not support this. Those adapters will need to override this macro\n      -- to run each statement individually.\n    #}\n    {% call statement('grants') %}\n        {% for dcl_statement in dcl_statement_list %}\n            {{ dcl_statement }};\n        {% endfor %}\n    {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8419025, "supported_languages": null}, "macro.dbt.apply_grants": {"name": "apply_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.apply_grants", "macro_sql": "{% macro apply_grants(relation, grant_config, should_revoke) %}\n    {{ return(adapter.dispatch(\"apply_grants\", \"dbt\")(relation, grant_config, should_revoke)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8423107, "supported_languages": null}, "macro.dbt.default__apply_grants": {"name": "default__apply_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__apply_grants", "macro_sql": "{% macro default__apply_grants(relation, grant_config, should_revoke=True) %}\n    {#-- If grant_config is {} or None, this is a no-op --#}\n    {% if grant_config %}\n        {% if should_revoke %}\n            {#-- We think previous grants may have carried over --#}\n            {#-- Show current grants and calculate diffs --#}\n            {% set current_grants_table = run_query(get_show_grant_sql(relation)) %}\n            {% set current_grants_dict = adapter.standardize_grants_dict(current_grants_table) %}\n            {% set needs_granting = diff_of_two_dicts(grant_config, current_grants_dict) %}\n            {% set needs_revoking = diff_of_two_dicts(current_grants_dict, grant_config) %}\n            {% if not (needs_granting or needs_revoking) %}\n                {{ log('On ' ~ relation ~': All grants are in place, no revocation or granting needed.')}}\n            {% endif %}\n        {% else %}\n            {#-- We don't think there's any chance of previous grants having carried over. --#}\n            {#-- Jump straight to granting what the user has configured. --#}\n            {% set needs_revoking = {} %}\n            {% set needs_granting = grant_config %}\n        {% endif %}\n        {% if needs_granting or needs_revoking %}\n            {% set revoke_statement_list = get_dcl_statement_list(relation, needs_revoking, get_revoke_sql) %}\n            {% set grant_statement_list = get_dcl_statement_list(relation, needs_granting, get_grant_sql) %}\n            {% set dcl_statement_list = revoke_statement_list + grant_statement_list %}\n            {% if dcl_statement_list %}\n                {{ call_dcl_statements(dcl_statement_list) }}\n            {% endif %}\n        {% endif %}\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.get_show_grant_sql", "macro.dbt.get_dcl_statement_list", "macro.dbt.call_dcl_statements"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8443189, "supported_languages": null}, "macro.dbt.validate_sql": {"name": "validate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/validate_sql.sql", "original_file_path": "macros/adapters/validate_sql.sql", "unique_id": "macro.dbt.validate_sql", "macro_sql": "{% macro validate_sql(sql) -%}\n  {{ return(adapter.dispatch('validate_sql', 'dbt')(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__validate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8448184, "supported_languages": null}, "macro.dbt.default__validate_sql": {"name": "default__validate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/validate_sql.sql", "original_file_path": "macros/adapters/validate_sql.sql", "unique_id": "macro.dbt.default__validate_sql", "macro_sql": "{% macro default__validate_sql(sql) -%}\n  {% call statement('validate_sql') -%}\n    explain {{ sql }}\n  {% endcall %}\n  {{ return(load_result('validate_sql')) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8452673, "supported_languages": null}, "macro.dbt.create_schema": {"name": "create_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.create_schema", "macro_sql": "{% macro create_schema(relation) -%}\n  {{ adapter.dispatch('create_schema', 'dbt')(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__create_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8458617, "supported_languages": null}, "macro.dbt.default__create_schema": {"name": "default__create_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.default__create_schema", "macro_sql": "{% macro default__create_schema(relation) -%}\n  {%- call statement('create_schema') -%}\n    create schema if not exists {{ relation.without_identifier() }}\n  {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8462114, "supported_languages": null}, "macro.dbt.drop_schema": {"name": "drop_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.drop_schema", "macro_sql": "{% macro drop_schema(relation) -%}\n  {{ adapter.dispatch('drop_schema', 'dbt')(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__drop_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8465142, "supported_languages": null}, "macro.dbt.default__drop_schema": {"name": "default__drop_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.default__drop_schema", "macro_sql": "{% macro default__drop_schema(relation) -%}\n  {%- call statement('drop_schema') -%}\n    drop schema if exists {{ relation.without_identifier() }} cascade\n  {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8469057, "supported_languages": null}, "macro.dbt.alter_column_comment": {"name": "alter_column_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.alter_column_comment", "macro_sql": "{% macro alter_column_comment(relation, column_dict) -%}\n  {{ return(adapter.dispatch('alter_column_comment', 'dbt')(relation, column_dict)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8479257, "supported_languages": null}, "macro.dbt.default__alter_column_comment": {"name": "default__alter_column_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__alter_column_comment", "macro_sql": "{% macro default__alter_column_comment(relation, column_dict) -%}\n  {{ exceptions.raise_not_implemented(\n    'alter_column_comment macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8483868, "supported_languages": null}, "macro.dbt.alter_relation_comment": {"name": "alter_relation_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.alter_relation_comment", "macro_sql": "{% macro alter_relation_comment(relation, relation_comment) -%}\n  {{ return(adapter.dispatch('alter_relation_comment', 'dbt')(relation, relation_comment)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__alter_relation_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8487797, "supported_languages": null}, "macro.dbt.default__alter_relation_comment": {"name": "default__alter_relation_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__alter_relation_comment", "macro_sql": "{% macro default__alter_relation_comment(relation, relation_comment) -%}\n  {{ exceptions.raise_not_implemented(\n    'alter_relation_comment macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8492362, "supported_languages": null}, "macro.dbt.persist_docs": {"name": "persist_docs", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.persist_docs", "macro_sql": "{% macro persist_docs(relation, model, for_relation=true, for_columns=true) -%}\n  {{ return(adapter.dispatch('persist_docs', 'dbt')(relation, model, for_relation, for_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.849741, "supported_languages": null}, "macro.dbt.default__persist_docs": {"name": "default__persist_docs", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__persist_docs", "macro_sql": "{% macro default__persist_docs(relation, model, for_relation, for_columns) -%}\n  {% if for_relation and config.persist_relation_docs() and model.description %}\n    {% do run_query(alter_relation_comment(relation, model.description)) %}\n  {% endif %}\n\n  {% if for_columns and config.persist_column_docs() and model.columns %}\n    {% do run_query(alter_column_comment(relation, model.columns)) %}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.alter_relation_comment", "macro.dbt.alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8505924, "supported_languages": null}, "macro.dbt.get_create_index_sql": {"name": "get_create_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_create_index_sql", "macro_sql": "{% macro get_create_index_sql(relation, index_dict) -%}\n  {{ return(adapter.dispatch('get_create_index_sql', 'dbt')(relation, index_dict)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_create_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8518717, "supported_languages": null}, "macro.dbt.default__get_create_index_sql": {"name": "default__get_create_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_create_index_sql", "macro_sql": "{% macro default__get_create_index_sql(relation, index_dict) -%}\n  {% do return(None) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8521397, "supported_languages": null}, "macro.dbt.create_indexes": {"name": "create_indexes", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.create_indexes", "macro_sql": "{% macro create_indexes(relation) -%}\n  {{ adapter.dispatch('create_indexes', 'dbt')(relation) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__create_indexes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8524473, "supported_languages": null}, "macro.dbt.default__create_indexes": {"name": "default__create_indexes", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__create_indexes", "macro_sql": "{% macro default__create_indexes(relation) -%}\n  {%- set _indexes = config.get('indexes', default=[]) -%}\n\n  {% for _index_dict in _indexes %}\n    {% set create_index_sql = get_create_index_sql(relation, _index_dict) %}\n    {% if create_index_sql %}\n      {% do run_query(create_index_sql) %}\n    {% endif %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_create_index_sql", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8533235, "supported_languages": null}, "macro.dbt.get_drop_index_sql": {"name": "get_drop_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_drop_index_sql", "macro_sql": "{% macro get_drop_index_sql(relation, index_name) -%}\n    {{ adapter.dispatch('get_drop_index_sql', 'dbt')(relation, index_name) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_drop_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8536756, "supported_languages": null}, "macro.dbt.default__get_drop_index_sql": {"name": "default__get_drop_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_drop_index_sql", "macro_sql": "{% macro default__get_drop_index_sql(relation, index_name) -%}\n    {{ exceptions.raise_compiler_error(\"`get_drop_index_sql has not been implemented for this adapter.\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8539524, "supported_languages": null}, "macro.dbt.get_show_indexes_sql": {"name": "get_show_indexes_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_show_indexes_sql", "macro_sql": "{% macro get_show_indexes_sql(relation) -%}\n    {{ adapter.dispatch('get_show_indexes_sql', 'dbt')(relation) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_show_indexes_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8542426, "supported_languages": null}, "macro.dbt.default__get_show_indexes_sql": {"name": "default__get_show_indexes_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_show_indexes_sql", "macro_sql": "{% macro default__get_show_indexes_sql(relation) -%}\n    {{ exceptions.raise_compiler_error(\"`get_show_indexes_sql has not been implemented for this adapter.\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8544822, "supported_languages": null}, "macro.dbt.current_timestamp": {"name": "current_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp", "macro_sql": "{%- macro current_timestamp() -%}\n    {{ adapter.dispatch('current_timestamp', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8552067, "supported_languages": null}, "macro.dbt.default__current_timestamp": {"name": "default__current_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp", "macro_sql": "{% macro default__current_timestamp() -%}\n  {{ exceptions.raise_not_implemented(\n    'current_timestamp macro not implemented for adapter ' + adapter.type()) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8555365, "supported_languages": null}, "macro.dbt.snapshot_get_time": {"name": "snapshot_get_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.snapshot_get_time", "macro_sql": "\n\n{%- macro snapshot_get_time() -%}\n    {{ adapter.dispatch('snapshot_get_time', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__snapshot_get_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8558075, "supported_languages": null}, "macro.dbt.default__snapshot_get_time": {"name": "default__snapshot_get_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__snapshot_get_time", "macro_sql": "{% macro default__snapshot_get_time() %}\n    {{ current_timestamp() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.856011, "supported_languages": null}, "macro.dbt.current_timestamp_backcompat": {"name": "current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp_backcompat", "macro_sql": "{% macro current_timestamp_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__current_timestamp_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8563144, "supported_languages": null}, "macro.dbt.default__current_timestamp_backcompat": {"name": "default__current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp_backcompat", "macro_sql": "{% macro default__current_timestamp_backcompat() %}\n    current_timestamp::timestamp\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8564656, "supported_languages": null}, "macro.dbt.current_timestamp_in_utc_backcompat": {"name": "current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp_in_utc_backcompat", "macro_sql": "{% macro current_timestamp_in_utc_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_in_utc_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__current_timestamp_in_utc_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.856765, "supported_languages": null}, "macro.dbt.default__current_timestamp_in_utc_backcompat": {"name": "default__current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp_in_utc_backcompat", "macro_sql": "{% macro default__current_timestamp_in_utc_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp_backcompat", "macro.dbt_bigquery.bigquery__current_timestamp_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8570704, "supported_languages": null}, "macro.dbt.make_intermediate_relation": {"name": "make_intermediate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_intermediate_relation", "macro_sql": "{% macro make_intermediate_relation(base_relation, suffix='__dbt_tmp') %}\n  {{ return(adapter.dispatch('make_intermediate_relation', 'dbt')(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__make_intermediate_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8595796, "supported_languages": null}, "macro.dbt.default__make_intermediate_relation": {"name": "default__make_intermediate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_intermediate_relation", "macro_sql": "{% macro default__make_intermediate_relation(base_relation, suffix) %}\n    {{ return(default__make_temp_relation(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__make_temp_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8598988, "supported_languages": null}, "macro.dbt.make_temp_relation": {"name": "make_temp_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_temp_relation", "macro_sql": "{% macro make_temp_relation(base_relation, suffix='__dbt_tmp') %}\n  {{ return(adapter.dispatch('make_temp_relation', 'dbt')(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__make_temp_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8603032, "supported_languages": null}, "macro.dbt.default__make_temp_relation": {"name": "default__make_temp_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_temp_relation", "macro_sql": "{% macro default__make_temp_relation(base_relation, suffix) %}\n    {%- set temp_identifier = base_relation.identifier ~ suffix -%}\n    {%- set temp_relation = base_relation.incorporate(\n                                path={\"identifier\": temp_identifier}) -%}\n\n    {{ return(temp_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8608546, "supported_languages": null}, "macro.dbt.make_backup_relation": {"name": "make_backup_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_backup_relation", "macro_sql": "{% macro make_backup_relation(base_relation, backup_relation_type, suffix='__dbt_backup') %}\n    {{ return(adapter.dispatch('make_backup_relation', 'dbt')(base_relation, backup_relation_type, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__make_backup_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8613539, "supported_languages": null}, "macro.dbt.default__make_backup_relation": {"name": "default__make_backup_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_backup_relation", "macro_sql": "{% macro default__make_backup_relation(base_relation, backup_relation_type, suffix) %}\n    {%- set backup_identifier = base_relation.identifier ~ suffix -%}\n    {%- set backup_relation = base_relation.incorporate(\n                                  path={\"identifier\": backup_identifier},\n                                  type=backup_relation_type\n    ) -%}\n    {{ return(backup_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8620145, "supported_languages": null}, "macro.dbt.truncate_relation": {"name": "truncate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.truncate_relation", "macro_sql": "{% macro truncate_relation(relation) -%}\n  {{ return(adapter.dispatch('truncate_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__truncate_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.862364, "supported_languages": null}, "macro.dbt.default__truncate_relation": {"name": "default__truncate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__truncate_relation", "macro_sql": "{% macro default__truncate_relation(relation) -%}\n  {% call statement('truncate_relation') -%}\n    truncate table {{ relation }}\n  {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8628113, "supported_languages": null}, "macro.dbt.get_or_create_relation": {"name": "get_or_create_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.get_or_create_relation", "macro_sql": "{% macro get_or_create_relation(database, schema, identifier, type) -%}\n  {{ return(adapter.dispatch('get_or_create_relation', 'dbt')(database, schema, identifier, type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_or_create_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8632524, "supported_languages": null}, "macro.dbt.default__get_or_create_relation": {"name": "default__get_or_create_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__get_or_create_relation", "macro_sql": "{% macro default__get_or_create_relation(database, schema, identifier, type) %}\n  {%- set target_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) %}\n\n  {% if target_relation %}\n    {% do return([true, target_relation]) %}\n  {% endif %}\n\n  {%- set new_relation = api.Relation.create(\n      database=database,\n      schema=schema,\n      identifier=identifier,\n      type=type\n  ) -%}\n  {% do return([false, new_relation]) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8643034, "supported_languages": null}, "macro.dbt.load_cached_relation": {"name": "load_cached_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.load_cached_relation", "macro_sql": "{% macro load_cached_relation(relation) %}\n  {% do return(adapter.get_relation(\n    database=relation.database,\n    schema=relation.schema,\n    identifier=relation.identifier\n  )) -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8647153, "supported_languages": null}, "macro.dbt.load_relation": {"name": "load_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.load_relation", "macro_sql": "{% macro load_relation(relation) %}\n    {{ return(load_cached_relation(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8649883, "supported_languages": null}, "macro.dbt.get_catalog_relations": {"name": "get_catalog_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_catalog_relations", "macro_sql": "{% macro get_catalog_relations(information_schema, relations) -%}\n  {{ return(adapter.dispatch('get_catalog_relations', 'dbt')(information_schema, relations)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_catalog_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.868546, "supported_languages": null}, "macro.dbt.default__get_catalog_relations": {"name": "default__get_catalog_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_catalog_relations", "macro_sql": "{% macro default__get_catalog_relations(information_schema, relations) -%}\n  {% set typename = adapter.type() %}\n  {% set msg -%}\n    get_catalog_relations not implemented for {{ typename }}\n  {%- endset %}\n\n  {{ exceptions.raise_compiler_error(msg) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8690388, "supported_languages": null}, "macro.dbt.get_catalog": {"name": "get_catalog", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_catalog", "macro_sql": "{% macro get_catalog(information_schema, schemas) -%}\n  {{ return(adapter.dispatch('get_catalog', 'dbt')(information_schema, schemas)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_catalog"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8694217, "supported_languages": null}, "macro.dbt.default__get_catalog": {"name": "default__get_catalog", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_catalog", "macro_sql": "{% macro default__get_catalog(information_schema, schemas) -%}\n\n  {% set typename = adapter.type() %}\n  {% set msg -%}\n    get_catalog not implemented for {{ typename }}\n  {%- endset %}\n\n  {{ exceptions.raise_compiler_error(msg) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8699281, "supported_languages": null}, "macro.dbt.information_schema_name": {"name": "information_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.information_schema_name", "macro_sql": "{% macro information_schema_name(database) %}\n  {{ return(adapter.dispatch('information_schema_name', 'dbt')(database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__information_schema_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.870278, "supported_languages": null}, "macro.dbt.default__information_schema_name": {"name": "default__information_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__information_schema_name", "macro_sql": "{% macro default__information_schema_name(database) -%}\n  {%- if database -%}\n    {{ database }}.INFORMATION_SCHEMA\n  {%- else -%}\n    INFORMATION_SCHEMA\n  {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8705795, "supported_languages": null}, "macro.dbt.list_schemas": {"name": "list_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.list_schemas", "macro_sql": "{% macro list_schemas(database) -%}\n  {{ return(adapter.dispatch('list_schemas', 'dbt')(database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__list_schemas"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8709292, "supported_languages": null}, "macro.dbt.default__list_schemas": {"name": "default__list_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__list_schemas", "macro_sql": "{% macro default__list_schemas(database) -%}\n  {% set sql %}\n    select distinct schema_name\n    from {{ information_schema_name(database) }}.SCHEMATA\n    where catalog_name ilike '{{ database }}'\n  {% endset %}\n  {{ return(run_query(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.information_schema_name", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.871421, "supported_languages": null}, "macro.dbt.check_schema_exists": {"name": "check_schema_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.check_schema_exists", "macro_sql": "{% macro check_schema_exists(information_schema, schema) -%}\n  {{ return(adapter.dispatch('check_schema_exists', 'dbt')(information_schema, schema)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__check_schema_exists"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.871792, "supported_languages": null}, "macro.dbt.default__check_schema_exists": {"name": "default__check_schema_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__check_schema_exists", "macro_sql": "{% macro default__check_schema_exists(information_schema, schema) -%}\n  {% set sql -%}\n        select count(*)\n        from {{ information_schema.replace(information_schema_view='SCHEMATA') }}\n        where catalog_name='{{ information_schema.database }}'\n          and schema_name='{{ schema }}'\n  {%- endset %}\n  {{ return(run_query(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.replace", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.872329, "supported_languages": null}, "macro.dbt.list_relations_without_caching": {"name": "list_relations_without_caching", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.list_relations_without_caching", "macro_sql": "{% macro list_relations_without_caching(schema_relation) %}\n  {{ return(adapter.dispatch('list_relations_without_caching', 'dbt')(schema_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__list_relations_without_caching"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8727078, "supported_languages": null}, "macro.dbt.default__list_relations_without_caching": {"name": "default__list_relations_without_caching", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__list_relations_without_caching", "macro_sql": "{% macro default__list_relations_without_caching(schema_relation) %}\n  {{ exceptions.raise_not_implemented(\n    'list_relations_without_caching macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8730142, "supported_languages": null}, "macro.dbt.get_relations": {"name": "get_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_relations", "macro_sql": "{% macro get_relations() %}\n  {{ return(adapter.dispatch('get_relations', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8733308, "supported_languages": null}, "macro.dbt.default__get_relations": {"name": "default__get_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_relations", "macro_sql": "{% macro default__get_relations() %}\n  {{ exceptions.raise_not_implemented(\n    'get_relations macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8736253, "supported_languages": null}, "macro.dbt.get_relation_last_modified": {"name": "get_relation_last_modified", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_relation_last_modified", "macro_sql": "{% macro get_relation_last_modified(information_schema, relations) %}\n  {{ return(adapter.dispatch('get_relation_last_modified', 'dbt')(information_schema, relations)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_relation_last_modified"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8741257, "supported_languages": null}, "macro.dbt.default__get_relation_last_modified": {"name": "default__get_relation_last_modified", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_relation_last_modified", "macro_sql": "{% macro default__get_relation_last_modified(information_schema, relations) %}\n  {{ exceptions.raise_not_implemented(\n    'get_relation_last_modified macro not implemented for adapter ' + adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.874448, "supported_languages": null}, "macro.dbt.get_columns_in_relation": {"name": "get_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_columns_in_relation", "macro_sql": "{% macro get_columns_in_relation(relation) -%}\n  {{ return(adapter.dispatch('get_columns_in_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8774488, "supported_languages": null}, "macro.dbt.default__get_columns_in_relation": {"name": "default__get_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_columns_in_relation", "macro_sql": "{% macro default__get_columns_in_relation(relation) -%}\n  {{ exceptions.raise_not_implemented(\n    'get_columns_in_relation macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8777976, "supported_languages": null}, "macro.dbt.sql_convert_columns_in_relation": {"name": "sql_convert_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.sql_convert_columns_in_relation", "macro_sql": "{% macro sql_convert_columns_in_relation(table) -%}\n  {% set columns = [] %}\n  {% for row in table %}\n    {% do columns.append(api.Column(*row)) %}\n  {% endfor %}\n  {{ return(columns) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8784127, "supported_languages": null}, "macro.dbt.get_empty_subquery_sql": {"name": "get_empty_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_empty_subquery_sql", "macro_sql": "{% macro get_empty_subquery_sql(select_sql, select_sql_header=none) -%}\n  {{ return(adapter.dispatch('get_empty_subquery_sql', 'dbt')(select_sql, select_sql_header)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8788407, "supported_languages": null}, "macro.dbt.default__get_empty_subquery_sql": {"name": "default__get_empty_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_empty_subquery_sql", "macro_sql": "{% macro default__get_empty_subquery_sql(select_sql, select_sql_header=none) %}\n    {%- if select_sql_header is not none -%}\n    {{ select_sql_header }}\n    {%- endif -%}\n    select * from (\n        {{ select_sql }}\n    ) as __dbt_sbq\n    where false\n    limit 0\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8793657, "supported_languages": null}, "macro.dbt.get_empty_schema_sql": {"name": "get_empty_schema_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_empty_schema_sql", "macro_sql": "{% macro get_empty_schema_sql(columns) -%}\n  {{ return(adapter.dispatch('get_empty_schema_sql', 'dbt')(columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__get_empty_schema_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8797145, "supported_languages": null}, "macro.dbt.default__get_empty_schema_sql": {"name": "default__get_empty_schema_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_empty_schema_sql", "macro_sql": "{% macro default__get_empty_schema_sql(columns) %}\n    {%- set col_err = [] -%}\n    {%- set col_naked_numeric = [] -%}\n    select\n    {% for i in columns %}\n      {%- set col = columns[i] -%}\n      {%- if col['data_type'] is not defined -%}\n        {%- do col_err.append(col['name']) -%}\n      {#-- If this column's type is just 'numeric' then it is missing precision/scale, raise a warning --#}\n      {%- elif col['data_type'].strip().lower() in ('numeric', 'decimal', 'number') -%}\n        {%- do col_naked_numeric.append(col['name']) -%}\n      {%- endif -%}\n      {% set col_name = adapter.quote(col['name']) if col.get('quote') else col['name'] %}\n      cast(null as {{ col['data_type'] }}) as {{ col_name }}{{ \", \" if not loop.last }}\n    {%- endfor -%}\n    {%- if (col_err | length) > 0 -%}\n      {{ exceptions.column_type_missing(column_names=col_err) }}\n    {%- elif (col_naked_numeric | length) > 0 -%}\n      {{ exceptions.warn(\"Detected columns with numeric type and unspecified precision/scale, this can lead to unintended rounding: \" ~ col_naked_numeric ~ \"`\") }}\n    {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.881728, "supported_languages": null}, "macro.dbt.get_column_schema_from_query": {"name": "get_column_schema_from_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_column_schema_from_query", "macro_sql": "{% macro get_column_schema_from_query(select_sql, select_sql_header=none) -%}\n    {% set columns = [] %}\n    {# -- Using an 'empty subquery' here to get the same schema as the given select_sql statement, without necessitating a data scan.#}\n    {% set sql = get_empty_subquery_sql(select_sql, select_sql_header) %}\n    {% set column_schema = adapter.get_column_schema_from_query(sql) %}\n    {{ return(column_schema) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8823633, "supported_languages": null}, "macro.dbt.get_columns_in_query": {"name": "get_columns_in_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_columns_in_query", "macro_sql": "{% macro get_columns_in_query(select_sql) -%}\n  {{ return(adapter.dispatch('get_columns_in_query', 'dbt')(select_sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_columns_in_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8827293, "supported_languages": null}, "macro.dbt.default__get_columns_in_query": {"name": "default__get_columns_in_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_columns_in_query", "macro_sql": "{% macro default__get_columns_in_query(select_sql) %}\n    {% call statement('get_columns_in_query', fetch_result=True, auto_begin=False) -%}\n        {{ get_empty_subquery_sql(select_sql) }}\n    {% endcall %}\n    {{ return(load_result('get_columns_in_query').table.columns | map(attribute='name') | list) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8833928, "supported_languages": null}, "macro.dbt.alter_column_type": {"name": "alter_column_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.alter_column_type", "macro_sql": "{% macro alter_column_type(relation, column_name, new_column_type) -%}\n  {{ return(adapter.dispatch('alter_column_type', 'dbt')(relation, column_name, new_column_type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__alter_column_type"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8838522, "supported_languages": null}, "macro.dbt.default__alter_column_type": {"name": "default__alter_column_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__alter_column_type", "macro_sql": "{% macro default__alter_column_type(relation, column_name, new_column_type) -%}\n  {#\n    1. Create a new column (w/ temp name and correct type)\n    2. Copy data over to it\n    3. Drop the existing column (cascade!)\n    4. Rename the new column to existing column\n  #}\n  {%- set tmp_column = column_name + \"__dbt_alter\" -%}\n\n  {% call statement('alter_column_type') %}\n    alter table {{ relation }} add column {{ adapter.quote(tmp_column) }} {{ new_column_type }};\n    update {{ relation }} set {{ adapter.quote(tmp_column) }} = {{ adapter.quote(column_name) }};\n    alter table {{ relation }} drop column {{ adapter.quote(column_name) }} cascade;\n    alter table {{ relation }} rename column {{ adapter.quote(tmp_column) }} to {{ adapter.quote(column_name) }}\n  {% endcall %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8848822, "supported_languages": null}, "macro.dbt.alter_relation_add_remove_columns": {"name": "alter_relation_add_remove_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.alter_relation_add_remove_columns", "macro_sql": "{% macro alter_relation_add_remove_columns(relation, add_columns = none, remove_columns = none) -%}\n  {{ return(adapter.dispatch('alter_relation_add_remove_columns', 'dbt')(relation, add_columns, remove_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__alter_relation_add_remove_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8853314, "supported_languages": null}, "macro.dbt.default__alter_relation_add_remove_columns": {"name": "default__alter_relation_add_remove_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__alter_relation_add_remove_columns", "macro_sql": "{% macro default__alter_relation_add_remove_columns(relation, add_columns, remove_columns) %}\n\n  {% if add_columns is none %}\n    {% set add_columns = [] %}\n  {% endif %}\n  {% if remove_columns is none %}\n    {% set remove_columns = [] %}\n  {% endif %}\n\n  {% set sql -%}\n\n     alter {{ relation.type }} {{ relation }}\n\n            {% for column in add_columns %}\n               add column {{ column.name }} {{ column.data_type }}{{ ',' if not loop.last }}\n            {% endfor %}{{ ',' if add_columns and remove_columns }}\n\n            {% for column in remove_columns %}\n                drop column {{ column.name }}{{ ',' if not loop.last }}\n            {% endfor %}\n\n  {%- endset -%}\n\n  {% do run_query(sql) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8867989, "supported_languages": null}, "macro.dbt.default__test_accepted_values": {"name": "default__test_accepted_values", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/accepted_values.sql", "original_file_path": "macros/generic_test_sql/accepted_values.sql", "unique_id": "macro.dbt.default__test_accepted_values", "macro_sql": "{% macro default__test_accepted_values(model, column_name, values, quote=True) %}\n\nwith all_values as (\n\n    select\n        {{ column_name }} as value_field,\n        count(*) as n_records\n\n    from {{ model }}\n    group by {{ column_name }}\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    {% for value in values -%}\n        {% if quote -%}\n        '{{ value }}'\n        {%- else -%}\n        {{ value }}\n        {%- endif -%}\n        {%- if not loop.last -%},{%- endif %}\n    {%- endfor %}\n)\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8878286, "supported_languages": null}, "macro.dbt.default__test_not_null": {"name": "default__test_not_null", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/not_null.sql", "original_file_path": "macros/generic_test_sql/not_null.sql", "unique_id": "macro.dbt.default__test_not_null", "macro_sql": "{% macro default__test_not_null(model, column_name) %}\n\n{% set column_list = '*' if should_store_failures() else column_name %}\n\nselect {{ column_list }}\nfrom {{ model }}\nwhere {{ column_name }} is null\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_store_failures"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8884077, "supported_languages": null}, "macro.dbt.default__test_unique": {"name": "default__test_unique", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/unique.sql", "original_file_path": "macros/generic_test_sql/unique.sql", "unique_id": "macro.dbt.default__test_unique", "macro_sql": "{% macro default__test_unique(model, column_name) %}\n\nselect\n    {{ column_name }} as unique_field,\n    count(*) as n_records\n\nfrom {{ model }}\nwhere {{ column_name }} is not null\ngroup by {{ column_name }}\nhaving count(*) > 1\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8888688, "supported_languages": null}, "macro.dbt.default__test_relationships": {"name": "default__test_relationships", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/relationships.sql", "original_file_path": "macros/generic_test_sql/relationships.sql", "unique_id": "macro.dbt.default__test_relationships", "macro_sql": "{% macro default__test_relationships(model, column_name, to, field) %}\n\nwith child as (\n    select {{ column_name }} as from_field\n    from {{ model }}\n    where {{ column_name }} is not null\n),\n\nparent as (\n    select {{ field }} as to_field\n    from {{ to }}\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8894234, "supported_languages": null}, "macro.dbt.convert_datetime": {"name": "convert_datetime", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.convert_datetime", "macro_sql": "{% macro convert_datetime(date_str, date_fmt) %}\n\n  {% set error_msg -%}\n      The provided partition date '{{ date_str }}' does not match the expected format '{{ date_fmt }}'\n  {%- endset %}\n\n  {% set res = try_or_compiler_error(error_msg, modules.datetime.datetime.strptime, date_str.strip(), date_fmt) %}\n  {{ return(res) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8919053, "supported_languages": null}, "macro.dbt.dates_in_range": {"name": "dates_in_range", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.dates_in_range", "macro_sql": "{% macro dates_in_range(start_date_str, end_date_str=none, in_fmt=\"%Y%m%d\", out_fmt=\"%Y%m%d\") %}\n    {% set end_date_str = start_date_str if end_date_str is none else end_date_str %}\n\n    {% set start_date = convert_datetime(start_date_str, in_fmt) %}\n    {% set end_date = convert_datetime(end_date_str, in_fmt) %}\n\n    {% set day_count = (end_date - start_date).days %}\n    {% if day_count < 0 %}\n        {% set msg -%}\n            Partition start date is after the end date ({{ start_date }}, {{ end_date }})\n        {%- endset %}\n\n        {{ exceptions.raise_compiler_error(msg, model) }}\n    {% endif %}\n\n    {% set date_list = [] %}\n    {% for i in range(0, day_count + 1) %}\n        {% set the_date = (modules.datetime.timedelta(days=i) + start_date) %}\n        {% if not out_fmt %}\n            {% set _ = date_list.append(the_date) %}\n        {% else %}\n            {% set _ = date_list.append(the_date.strftime(out_fmt)) %}\n        {% endif %}\n    {% endfor %}\n\n    {{ return(date_list) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.convert_datetime"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8940725, "supported_languages": null}, "macro.dbt.partition_range": {"name": "partition_range", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.partition_range", "macro_sql": "{% macro partition_range(raw_partition_date, date_fmt='%Y%m%d') %}\n    {% set partition_range = (raw_partition_date | string).split(\",\") %}\n\n    {% if (partition_range | length) == 1 %}\n      {% set start_date = partition_range[0] %}\n      {% set end_date = none %}\n    {% elif (partition_range | length) == 2 %}\n      {% set start_date = partition_range[0] %}\n      {% set end_date = partition_range[1] %}\n    {% else %}\n      {{ exceptions.raise_compiler_error(\"Invalid partition time. Expected format: {Start Date}[,{End Date}]. Got: \" ~ raw_partition_date) }}\n    {% endif %}\n\n    {{ return(dates_in_range(start_date, end_date, in_fmt=date_fmt)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.dates_in_range"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8955412, "supported_languages": null}, "macro.dbt.py_current_timestring": {"name": "py_current_timestring", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.py_current_timestring", "macro_sql": "{% macro py_current_timestring() %}\n    {% set dt = modules.datetime.datetime.now() %}\n    {% do return(dt.strftime(\"%Y%m%d%H%M%S%f\")) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8959877, "supported_languages": null}, "macro.dbt.statement": {"name": "statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.statement", "macro_sql": "\n{%- macro statement(name=None, fetch_result=False, auto_begin=True, language='sql') -%}\n  {%- if execute: -%}\n    {%- set compiled_code = caller() -%}\n\n    {%- if name == 'main' -%}\n      {{ log('Writing runtime {} for node \"{}\"'.format(language, model['unique_id'])) }}\n      {{ write(compiled_code) }}\n    {%- endif -%}\n    {%- if language == 'sql'-%}\n      {%- set res, table = adapter.execute(compiled_code, auto_begin=auto_begin, fetch=fetch_result) -%}\n    {%- elif language == 'python' -%}\n      {%- set res = submit_python_job(model, compiled_code) -%}\n      {#-- TODO: What should table be for python models? --#}\n      {%- set table = None -%}\n    {%- else -%}\n      {% do exceptions.raise_compiler_error(\"statement macro didn't get supported language\") %}\n    {%- endif -%}\n\n    {%- if name is not none -%}\n      {{ store_result(name, response=res, agate_table=table) }}\n    {%- endif -%}\n\n  {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.898405, "supported_languages": null}, "macro.dbt.noop_statement": {"name": "noop_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.noop_statement", "macro_sql": "{% macro noop_statement(name=None, message=None, code=None, rows_affected=None, res=None) -%}\n  {%- set sql = caller() -%}\n\n  {%- if name == 'main' -%}\n    {{ log('Writing runtime SQL for node \"{}\"'.format(model['unique_id'])) }}\n    {{ write(sql) }}\n  {%- endif -%}\n\n  {%- if name is not none -%}\n    {{ store_raw_result(name, message=message, code=code, rows_affected=rows_affected, agate_table=res) }}\n  {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8994322, "supported_languages": null}, "macro.dbt.run_query": {"name": "run_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.run_query", "macro_sql": "{% macro run_query(sql) %}\n  {% call statement(\"run_query_statement\", fetch_result=true, auto_begin=false) %}\n    {{ sql }}\n  {% endcall %}\n\n  {% do return(load_result(\"run_query_statement\").table) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.8999944, "supported_languages": null}, "macro.dbt.resolve_model_name": {"name": "resolve_model_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.resolve_model_name", "macro_sql": "{% macro resolve_model_name(input_model_name) %}\n    {{ return(adapter.dispatch('resolve_model_name', 'dbt')(input_model_name)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9022002, "supported_languages": null}, "macro.dbt.default__resolve_model_name": {"name": "default__resolve_model_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.default__resolve_model_name", "macro_sql": "\n\n{%- macro default__resolve_model_name(input_model_name) -%}\n    {{  input_model_name | string | replace('\"', '\\\"') }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9025137, "supported_languages": null}, "macro.dbt.build_ref_function": {"name": "build_ref_function", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_ref_function", "macro_sql": "{% macro build_ref_function(model) %}\n\n    {%- set ref_dict = {} -%}\n    {%- for _ref in model.refs -%}\n        {% set _ref_args = [_ref.get('package'), _ref['name']] if _ref.get('package') else [_ref['name'],] %}\n        {%- set resolved = ref(*_ref_args, v=_ref.get('version')) -%}\n        {%- if _ref.get('version') -%}\n            {% do _ref_args.extend([\"v\" ~ _ref['version']]) %}\n        {%- endif -%}\n       {%- do ref_dict.update({_ref_args | join('.'): resolve_model_name(resolved)}) -%}\n    {%- endfor -%}\n\ndef ref(*args, **kwargs):\n    refs = {{ ref_dict | tojson }}\n    key = '.'.join(args)\n    version = kwargs.get(\"v\") or kwargs.get(\"version\")\n    if version:\n        key += f\".v{version}\"\n    dbt_load_df_function = kwargs.get(\"dbt_load_df_function\")\n    return dbt_load_df_function(refs[key])\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9039862, "supported_languages": null}, "macro.dbt.build_source_function": {"name": "build_source_function", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_source_function", "macro_sql": "{% macro build_source_function(model) %}\n\n    {%- set source_dict = {} -%}\n    {%- for _source in model.sources -%}\n        {%- set resolved = source(*_source) -%}\n        {%- do source_dict.update({_source | join('.'): resolve_model_name(resolved)}) -%}\n    {%- endfor -%}\n\ndef source(*args, dbt_load_df_function):\n    sources = {{ source_dict | tojson }}\n    key = '.'.join(args)\n    return dbt_load_df_function(sources[key])\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.904864, "supported_languages": null}, "macro.dbt.build_config_dict": {"name": "build_config_dict", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_config_dict", "macro_sql": "{% macro build_config_dict(model) %}\n    {%- set config_dict = {} -%}\n    {% set config_dbt_used = zip(model.config.config_keys_used, model.config.config_keys_defaults) | list %}\n    {%- for key, default in config_dbt_used -%}\n        {# weird type testing with enum, would be much easier to write this logic in Python! #}\n        {%- if key == \"language\" -%}\n          {%- set value = \"python\" -%}\n        {%- endif -%}\n        {%- set value = model.config.get(key, default) -%}\n        {%- do config_dict.update({key: value}) -%}\n    {%- endfor -%}\nconfig_dict = {{ config_dict }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9058645, "supported_languages": null}, "macro.dbt.py_script_postfix": {"name": "py_script_postfix", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.py_script_postfix", "macro_sql": "{% macro py_script_postfix(model) %}\n# This part is user provided model code\n# you will need to copy the next section to run the code\n# COMMAND ----------\n# this part is dbt logic for get ref work, do not modify\n\n{{ build_ref_function(model ) }}\n{{ build_source_function(model ) }}\n{{ build_config_dict(model) }}\n\nclass config:\n    def __init__(self, *args, **kwargs):\n        pass\n\n    @staticmethod\n    def get(key, default=None):\n        return config_dict.get(key, default)\n\nclass this:\n    \"\"\"dbt.this() or dbt.this.identifier\"\"\"\n    database = \"{{ this.database }}\"\n    schema = \"{{ this.schema }}\"\n    identifier = \"{{ this.identifier }}\"\n    {% set this_relation_name = resolve_model_name(this) %}\n    def __repr__(self):\n        return '{{ this_relation_name  }}'\n\n\nclass dbtObj:\n    def __init__(self, load_df_function) -> None:\n        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)\n        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)\n        self.config = config\n        self.this = this()\n        self.is_incremental = {{ is_incremental() }}\n\n# COMMAND ----------\n{{py_script_comment()}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.build_ref_function", "macro.dbt.build_source_function", "macro.dbt.build_config_dict", "macro.dbt.resolve_model_name", "macro.dbt.is_incremental", "macro.dbt.py_script_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.906735, "supported_languages": null}, "macro.dbt.py_script_comment": {"name": "py_script_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.py_script_comment", "macro_sql": "{%macro py_script_comment()%}\n{%endmacro%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9068854, "supported_languages": null}, "macro.dbt.test_unique": {"name": "test_unique", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_unique", "macro_sql": "{% test unique(model, column_name) %}\n    {% set macro = adapter.dispatch('test_unique', 'dbt') %}\n    {{ macro(model, column_name) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_bigquery.bigquery__test_unique"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.907712, "supported_languages": null}, "macro.dbt.test_not_null": {"name": "test_not_null", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_not_null", "macro_sql": "{% test not_null(model, column_name) %}\n    {% set macro = adapter.dispatch('test_not_null', 'dbt') %}\n    {{ macro(model, column_name) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_not_null"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9081264, "supported_languages": null}, "macro.dbt.test_accepted_values": {"name": "test_accepted_values", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_accepted_values", "macro_sql": "{% test accepted_values(model, column_name, values, quote=True) %}\n    {% set macro = adapter.dispatch('test_accepted_values', 'dbt') %}\n    {{ macro(model, column_name, values, quote) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_accepted_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.908624, "supported_languages": null}, "macro.dbt.test_relationships": {"name": "test_relationships", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_relationships", "macro_sql": "{% test relationships(model, column_name, to, field) %}\n    {% set macro = adapter.dispatch('test_relationships', 'dbt') %}\n    {{ macro(model, column_name, to, field) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_relationships"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.909107, "supported_languages": null}, "macro.dbt_profiler.type_string": {"name": "type_string", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.type_string", "macro_sql": "\n\n{%- macro type_string() -%}\n  {{ return(adapter.dispatch(\"type_string\", macro_namespace=\"dbt_profiler\")()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.bigquery__type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.910664, "supported_languages": null}, "macro.dbt_profiler.default__type_string": {"name": "default__type_string", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__type_string", "macro_sql": "{%- macro default__type_string() -%}\n  varchar\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.910858, "supported_languages": null}, "macro.dbt_profiler.bigquery__type_string": {"name": "bigquery__type_string", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.bigquery__type_string", "macro_sql": "{%- macro bigquery__type_string() -%}\n  string\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9110367, "supported_languages": null}, "macro.dbt_profiler.databricks__type_string": {"name": "databricks__type_string", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.databricks__type_string", "macro_sql": "{%- macro databricks__type_string() -%}\n  string\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9111912, "supported_languages": null}, "macro.dbt_profiler.is_numeric_dtype": {"name": "is_numeric_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.is_numeric_dtype", "macro_sql": "\n\n{%- macro is_numeric_dtype(dtype) -%}\n  {{ return(adapter.dispatch(\"is_numeric_dtype\", macro_namespace=\"dbt_profiler\")(dtype)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__is_numeric_dtype"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9115796, "supported_languages": null}, "macro.dbt_profiler.default__is_numeric_dtype": {"name": "default__is_numeric_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__is_numeric_dtype", "macro_sql": "{%- macro default__is_numeric_dtype(dtype) -%}\n  {% set is_numeric = dtype.startswith(\"int\") or dtype.startswith(\"float\") or \"numeric\" in dtype or \"number\" in dtype or \"double\" in dtype or \"bigint\" in dtype %}\n  {% do return(is_numeric) %}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9122176, "supported_languages": null}, "macro.dbt_profiler.sqlserver__is_numeric_dtype": {"name": "sqlserver__is_numeric_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.sqlserver__is_numeric_dtype", "macro_sql": "{%- macro sqlserver__is_numeric_dtype(dtype) -%}\n  {% set is_numeric = dtype in [\"decimal\", \"numeric\", \"bigint\" \"numeric\", \"smallint\", \"decimal\", \"int\", \"tinyint\", \"money\", \"float\", \"real\"]  %}\n  {% do return(is_numeric) %}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9128118, "supported_languages": null}, "macro.dbt_profiler.is_logical_dtype": {"name": "is_logical_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.is_logical_dtype", "macro_sql": "\n\n{%- macro is_logical_dtype(dtype) -%}\n  {{ return(adapter.dispatch(\"is_logical_dtype\", macro_namespace=\"dbt_profiler\")(dtype)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__is_logical_dtype"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9131546, "supported_languages": null}, "macro.dbt_profiler.default__is_logical_dtype": {"name": "default__is_logical_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__is_logical_dtype", "macro_sql": "{%- macro default__is_logical_dtype(dtype) -%}\n  {% set is_bool = dtype.startswith(\"bool\") %}\n  {% do return(is_bool) %}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9135065, "supported_languages": null}, "macro.dbt_profiler.is_date_or_time_dtype": {"name": "is_date_or_time_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.is_date_or_time_dtype", "macro_sql": "\n\n{%- macro is_date_or_time_dtype(dtype) -%}\n  {{ return(adapter.dispatch(\"is_date_or_time_dtype\", macro_namespace=\"dbt_profiler\")(dtype)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__is_date_or_time_dtype"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9138474, "supported_languages": null}, "macro.dbt_profiler.default__is_date_or_time_dtype": {"name": "default__is_date_or_time_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__is_date_or_time_dtype", "macro_sql": "{%- macro default__is_date_or_time_dtype(dtype) -%}\n  {% set is_date_or_time = dtype.startswith(\"timestamp\") or dtype.startswith(\"date\") %}\n  {% do return(is_date_or_time) %}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9142668, "supported_languages": null}, "macro.dbt_profiler.is_struct_dtype": {"name": "is_struct_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.is_struct_dtype", "macro_sql": "\n\n{%- macro is_struct_dtype(dtype) -%}\n  {{ return(adapter.dispatch(\"is_struct_dtype\", macro_namespace=\"dbt_profiler\")(dtype)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__is_struct_dtype"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9147246, "supported_languages": null}, "macro.dbt_profiler.default__is_struct_dtype": {"name": "default__is_struct_dtype", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__is_struct_dtype", "macro_sql": "{%- macro default__is_struct_dtype(dtype) -%}\n  {% do return((dtype | lower).startswith('struct')) %}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9150474, "supported_languages": null}, "macro.dbt_profiler.information_schema": {"name": "information_schema", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.information_schema", "macro_sql": "\n\n{%- macro information_schema(relation) -%}\n  {{ return(adapter.dispatch(\"information_schema\", macro_namespace=\"dbt_profiler\")(relation)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.bigquery__information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9154003, "supported_languages": null}, "macro.dbt_profiler.default__information_schema": {"name": "default__information_schema", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__information_schema", "macro_sql": "{%- macro default__information_schema(relation) -%}\n  {{ relation.information_schema() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9156215, "supported_languages": null}, "macro.dbt_profiler.bigquery__information_schema": {"name": "bigquery__information_schema", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.bigquery__information_schema", "macro_sql": "{%- macro bigquery__information_schema(relation) -%}\n  {{ adapter.quote(relation.database) }}.{{ adapter.quote(relation.schema) }}.INFORMATION_SCHEMA\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9159677, "supported_languages": null}, "macro.dbt_profiler.select_from_information_schema_columns": {"name": "select_from_information_schema_columns", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.select_from_information_schema_columns", "macro_sql": "\n\n{%- macro select_from_information_schema_columns(relation) -%}\n  {{ return(adapter.dispatch(\"select_from_information_schema_columns\", macro_namespace=\"dbt_profiler\")(relation)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__select_from_information_schema_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9163156, "supported_languages": null}, "macro.dbt_profiler.default__select_from_information_schema_columns": {"name": "default__select_from_information_schema_columns", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.default__select_from_information_schema_columns", "macro_sql": "{%- macro default__select_from_information_schema_columns(relation) -%}\n  select\n    *\n  from {{ dbt_profiler.information_schema(relation) }}.COLUMNS\n  where lower(table_schema) = lower('{{ relation.schema }}') \n    and lower(table_name) = lower('{{ relation.identifier }}')\n  order by ordinal_position asc\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9166758, "supported_languages": null}, "macro.dbt_profiler.redshift__select_from_information_schema_columns": {"name": "redshift__select_from_information_schema_columns", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/cross_db_utils.sql", "original_file_path": "macros/cross_db_utils.sql", "unique_id": "macro.dbt_profiler.redshift__select_from_information_schema_columns", "macro_sql": "{%- macro redshift__select_from_information_schema_columns(relation) -%}\n  select\n    attr.attname::varchar as column_name,\n    type.typname::varchar as data_type,\n    class.relname::varchar as table_name,\n    namespace.nspname::varchar as table_schema\n  from pg_catalog.pg_attribute as attr\n  join pg_catalog.pg_type as type on (attr.atttypid = type.oid)\n  join pg_catalog.pg_class as class on (attr.attrelid = class.oid)\n  join pg_catalog.pg_namespace as namespace on (class.relnamespace = namespace.oid)\n  where lower(table_schema) = lower('{{ relation.schema }}') \n    and lower(table_name) = lower('{{ relation.identifier }}')\n    and attr.attnum > 0\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9169822, "supported_languages": null}, "macro.dbt_profiler.print_profile": {"name": "print_profile", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/print_profile.sql", "original_file_path": "macros/print_profile.sql", "unique_id": "macro.dbt_profiler.print_profile", "macro_sql": "{% macro print_profile(relation=none, relation_name=none, schema=none, database=none, exclude_measures=[], include_columns=[], exclude_columns=[], max_rows=none, max_columns=13, max_column_width=30, max_precision=none, where_clause=none) %}\n\n{%- set results = dbt_profiler.get_profile_table(relation=relation, relation_name=relation_name, schema=schema, database=database, exclude_measures=exclude_measures, include_columns=include_columns, exclude_columns=exclude_columns, where_clause=where_clause) -%}\n\n{% if execute %}\n  {% do results.print_table(max_rows=max_rows, max_columns=max_columns, max_column_width=max_column_width, max_precision=max_precision) %}\n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.get_profile_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9182985, "supported_languages": null}, "macro.dbt_profiler.get_profile": {"name": "get_profile", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/get_profile.sql", "original_file_path": "macros/get_profile.sql", "unique_id": "macro.dbt_profiler.get_profile", "macro_sql": "{% macro get_profile(relation, exclude_measures=[], include_columns=[], exclude_columns=[], where_clause=none, group_by=[]) %}\n  {{ return(adapter.dispatch(\"get_profile\", macro_namespace=\"dbt_profiler\")(relation, exclude_measures, include_columns, exclude_columns, where_clause, group_by)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.default__get_profile"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.945143, "supported_languages": null}, "macro.dbt_profiler.default__get_profile": {"name": "default__get_profile", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/get_profile.sql", "original_file_path": "macros/get_profile.sql", "unique_id": "macro.dbt_profiler.default__get_profile", "macro_sql": "{% macro default__get_profile(relation, exclude_measures=[], include_columns=[], exclude_columns=[], where_clause=none, group_by=[]) %}\n\n{%- if include_columns and exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\"Both include_columns and exclude_columns arguments were provided to the `get_profile` macro. Only one is allowed.\") }}\n{%- endif -%}\n\n{%- set all_measures = [\n  \"row_count\",\n  \"not_null_proportion\",\n  \"distinct_proportion\",\n  \"distinct_count\",\n  \"is_unique\",\n  \"min\",\n  \"max\",\n  \"avg\",\n  \"median\",\n  \"std_dev_population\",\n  \"std_dev_sample\"\n] -%}\n\n{%- set include_measures = all_measures | reject(\"in\", exclude_measures) -%}\n\n{{ log(\"Include measures: \" ~ include_measures, info=False) }}\n\n{% if execute %}\n  {% do dbt_profiler.assert_relation_exists(relation) %}\n\n  {{ log(\"Get columns in relation %s\" | format(relation.include()), info=False) }}\n  {%- set relation_columns = adapter.get_columns_in_relation(relation) -%}\n  {%- set relation_column_names = relation_columns | map(attribute=\"name\") | list -%}\n  {{ log(\"Relation columns: \" ~ relation_column_names | join(', '), info=False) }}\n\n  {%- if include_columns -%}\n    {%- set profile_column_names = relation_column_names | select(\"in\", include_columns) | list -%}\n  {%- elif exclude_columns -%}\n    {%- set profile_column_names = relation_column_names | reject(\"in\", exclude_columns) | list -%}\n  {%- else -%}\n    {%- set profile_column_names = relation_column_names -%}\n  {%- endif -%}\n\n  {{ log(\"Profile columns: \" ~ profile_column_names | join(', '), info=False) }}\n\n  {% set information_schema_columns = run_query(dbt_profiler.select_from_information_schema_columns(relation)) %}\n  {% set information_schema_columns = information_schema_columns.rename(information_schema_columns.column_names | map('lower')) %}\n  {% set information_schema_data_types = information_schema_columns.columns['data_type'].values() | map('lower') | list %}\n  {% set information_schema_column_names = information_schema_columns.columns['column_name'].values() | map('lower') | list %}\n  {% set data_type_map = {} %}\n  {% for column_name in information_schema_column_names %}\n    {% do data_type_map.update({column_name: information_schema_data_types[loop.index-1]}) %}\n  {% endfor %}\n  {{ log(\"Column data types: \" ~ data_type_map, info=False) }}\n\n  {% set profile_sql %}\n    with source_data as (\n      select\n        *\n      from {{ relation }}\n      {% if where_clause %}\n        where {{ where_clause }}\n      {% endif %}\n    ),\n\n    column_profiles as (\n      {% for column_name in profile_column_names %}\n        {% set data_type = data_type_map.get(column_name.lower(), \"\") %}\n        select\n          {%- for group_by_column in group_by %}\n            {{ group_by_column }},\n          {%- endfor %}\n          lower('{{ column_name }}') as column_name,\n          nullif(lower('{{ data_type }}'), '') as data_type,\n          {% if \"row_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_row_count(column_name, data_type) }} as row_count,\n          {%- endif %}\n          {% if \"not_null_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_not_null_proportion(column_name, data_type) }} as not_null_proportion,\n          {%- endif %}\n          {% if \"distinct_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_proportion(column_name, data_type) }} as distinct_proportion,\n          {%- endif %}\n          {% if \"distinct_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_count(column_name, data_type) }} as distinct_count,\n          {%- endif %}\n          {% if \"is_unique\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_is_unique(column_name, data_type) }} as is_unique,\n          {%- endif %}\n          {% if \"min\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_min(column_name, data_type) }} as min,\n          {%- endif %}\n          {% if \"max\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_max(column_name, data_type) }} as max,\n          {%- endif %}\n          {% if \"avg\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_avg(column_name, data_type) }} as avg,\n          {%- endif %}\n          {% if \"median\" not in exclude_measures -%}\n            ({{ dbt_profiler.measure_median(column_name, data_type, 'source_data') }}) as median,\n          {%- endif %}\n          {% if \"std_dev_population\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_population(column_name, data_type) }} as std_dev_population,\n          {%- endif %}\n          {% if \"std_dev_sample\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_sample(column_name, data_type) }} as std_dev_sample,\n          {%- endif %}\n          cast(current_timestamp as {{ dbt_profiler.type_string() }}) as profiled_at,\n          {{ loop.index }} as _column_position\n        from source_data\n        {% if group_by %}\n          group by {{ group_by | join(\", \") }}\n        {% endif %}\n        {% if not loop.last %}union all{% endif %}\n      {% endfor %}\n    )\n\n    select\n      {%- for group_by_column in group_by %}\n        {{ group_by_column }},\n      {%- endfor %}\n      column_name,\n      data_type,\n      {% for measure in include_measures %}\n        {{ measure }},\n      {% endfor %}\n      profiled_at\n    from column_profiles\n    order by {% if group_by %}{{ group_by | join(\", \") }},{% endif %} _column_position asc\n  {% endset %}\n\n  {% do return(profile_sql) %}\n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.assert_relation_exists", "macro.dbt.run_query", "macro.dbt_profiler.select_from_information_schema_columns", "macro.dbt_profiler.measure_row_count", "macro.dbt_profiler.measure_not_null_proportion", "macro.dbt_profiler.measure_distinct_proportion", "macro.dbt_profiler.measure_distinct_count", "macro.dbt_profiler.measure_is_unique", "macro.dbt_profiler.measure_min", "macro.dbt_profiler.measure_max", "macro.dbt_profiler.measure_avg", "macro.dbt_profiler.measure_median", "macro.dbt_profiler.measure_std_dev_population", "macro.dbt_profiler.measure_std_dev_sample", "macro.dbt_profiler.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9545014, "supported_languages": null}, "macro.dbt_profiler.databricks__get_profile": {"name": "databricks__get_profile", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/get_profile.sql", "original_file_path": "macros/get_profile.sql", "unique_id": "macro.dbt_profiler.databricks__get_profile", "macro_sql": "{% macro databricks__get_profile(relation, exclude_measures=[], include_columns=[], exclude_columns=[], where_clause=none, group_by=[]) %}\n\n{%- if include_columns and exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\"Both include_columns and exclude_columns arguments were provided to the `get_profile` macro. Only one is allowed.\") }}\n{%- endif -%}\n\n{%- set all_measures = [\n  \"row_count\",\n  \"not_null_proportion\",\n  \"distinct_proportion\",\n  \"distinct_count\",\n  \"is_unique\",\n  \"min\",\n  \"max\",\n  \"avg\",\n  \"median\",\n  \"std_dev_population\",\n  \"std_dev_sample\"\n] -%}\n\n{%- set include_measures = all_measures | reject(\"in\", exclude_measures) -%}\n\n{{ log(\"Include measures: \" ~ include_measures, info=False) }}\n\n{% if execute %}\n  {% do dbt_profiler.assert_relation_exists(relation) %}\n\n  {{ log(\"Get columns in relation %s\" | format(relation.include()), info=True) }}\n  {%- set relation_columns = adapter.get_columns_in_relation(relation) -%}\n  {%- set relation_column_names = relation_columns | map(attribute=\"name\") | list -%}\n  {{ log(\"Relation columns: \" ~ relation_column_names | join(', '), info=False) }}\n\n  {%- if include_columns -%}\n    {%- set profile_column_names = relation_column_names | select(\"in\", include_columns) | list -%}\n  {%- elif exclude_columns -%}\n    {%- set profile_column_names = relation_column_names | reject(\"in\", exclude_columns) | list -%}\n  {%- else -%}\n    {%- set profile_column_names = relation_column_names -%}\n  {%- endif -%}\n\n  {{ log(\"Profile columns: \" ~ profile_column_names | join(', '), info=False) }}\n\n  {# Get column metadata. #}\n  {% call statement('table_metadata', fetch_result=True) -%}\n    describe table extended {{ relation.schema }}.{{ relation.identifier }}\n  {% endcall %}\n  {% set columns_metadata = load_result('table_metadata').table %}\n  {% set columns_metadata = columns_metadata.rename(columns_metadata.column_names | map('lower')) %}\n  \n  {% set data_types = columns_metadata.columns['data_type'].values() | map('lower') | list %}\n  {% set column_names = columns_metadata.columns['col_name'].values() | map('lower') | list %}\n  {% set data_type_map = {} %}\n  {% for column_name in column_names %}\n    {% do data_type_map.update({column_name: data_types[loop.index-1]}) %}\n  {% endfor %}\n  {{ log(\"Column data types: \" ~ data_type_map, info=False) }}\n\n  {% set profile_sql %}\n    with source_data as (\n      select\n        *\n      from {{ relation }}\n      {% if where_clause %}\n        where {{ where_clause }}\n      {% endif %}\n    ),\n\n    column_profiles as (\n      {% for column_name in profile_column_names %}\n        {% set data_type = data_type_map.get(column_name.lower(), \"\") %}\n        select \n          {%- for group_by_column in group_by %}\n            {{ group_by_column }},\n          {%- endfor %}\n          lower('{{ column_name }}') as column_name,\n          nullif(lower('{{ data_type }}'), '') as data_type,\n          {% if \"row_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_row_count(column_name, data_type) }} as row_count,\n          {%- endif %}\n          {% if \"not_null_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_not_null_proportion(column_name, data_type) }} as not_null_proportion,\n          {%- endif %}\n          {% if \"distinct_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_proportion(column_name, data_type) }} as distinct_proportion,\n          {%- endif %}\n          {% if \"distinct_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_count(column_name, data_type) }} as distinct_count,\n          {%- endif %}\n          {% if \"is_unique\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_is_unique(column_name, data_type) }} as is_unique,\n          {%- endif %}\n          {% if \"min\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_min(column_name, data_type) }} as min,\n          {%- endif %}\n          {% if \"max\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_max(column_name, data_type) }} as max,\n          {%- endif %}\n          {% if \"avg\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_avg(column_name, data_type) }} as avg,\n          {%- endif %}\n          {% if \"median\" not in exclude_measures -%}\n            ({{ dbt_profiler.measure_median(column_name, data_type, 'source_data') }}) as median,\n          {%- endif %}\n          {% if \"std_dev_population\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_population(column_name, data_type) }} as std_dev_population,\n          {%- endif %}\n          {% if \"std_dev_sample\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_sample(column_name, data_type) }} as std_dev_sample,\n          {%- endif %}\n          cast(current_timestamp as {{ dbt_profiler.type_string() }}) as profiled_at,\n          {{ loop.index }} as _column_position\n        from source_data\n        {% if group_by %}\n          group by {{ group_by | join(\", \") }}\n        {% endif %}\n        {% if not loop.last %}union all{% endif %}\n      {% endfor %}\n    )\n\n    select\n      {%- for group_by_column in group_by %}\n        {{ group_by_column }},\n      {%- endfor %}\n      column_name,\n      data_type,\n      {% for measure in include_measures %}\n        {{ measure }},\n      {% endfor %}\n      profiled_at\n    from column_profiles\n    order by {% if group_by %}{{ group_by | join(\", \") }},{% endif %} _column_position asc\n  {% endset %}\n\n  {# {{ print(profile_sql) }} #}\n\n  {% do return(profile_sql) %}\n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.assert_relation_exists", "macro.dbt.statement", "macro.dbt_profiler.measure_row_count", "macro.dbt_profiler.measure_not_null_proportion", "macro.dbt_profiler.measure_distinct_proportion", "macro.dbt_profiler.measure_distinct_count", "macro.dbt_profiler.measure_is_unique", "macro.dbt_profiler.measure_min", "macro.dbt_profiler.measure_max", "macro.dbt_profiler.measure_avg", "macro.dbt_profiler.measure_median", "macro.dbt_profiler.measure_std_dev_population", "macro.dbt_profiler.measure_std_dev_sample", "macro.dbt_profiler.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.962732, "supported_languages": null}, "macro.dbt_profiler.sqlserver__get_profile": {"name": "sqlserver__get_profile", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/get_profile.sql", "original_file_path": "macros/get_profile.sql", "unique_id": "macro.dbt_profiler.sqlserver__get_profile", "macro_sql": "{% macro sqlserver__get_profile(relation, exclude_measures=[], include_columns=[], exclude_columns=[], where_clause=none, group_by=[]) %}\n\n{%- if include_columns and exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\"Both include_columns and exclude_columns arguments were provided to the `get_profile` macro. Only one is allowed.\") }}\n{%- endif -%}\n\n{%- set all_measures = [\n  \"row_count\",\n  \"not_null_proportion\",\n  \"distinct_proportion\",\n  \"distinct_count\",\n  \"is_unique\",\n  \"min\",\n  \"max\",\n  \"avg\",\n  \"median\",\n  \"std_dev_population\",\n  \"std_dev_sample\"\n] -%}\n\n{%- set include_measures = all_measures | reject(\"in\", exclude_measures) -%}\n\n{{ log(\"Include measures: \" ~ include_measures, info=False) }}\n\n{% if execute %}\n  {% do dbt_profiler.assert_relation_exists(relation) %}\n\n  {{ log(\"Get columns in relation %s\" | format(relation.include()), info=False) }}\n  {%- set relation_columns = adapter.get_columns_in_relation(relation) -%}\n  {%- set relation_column_names = relation_columns | map(attribute=\"name\") | list -%}\n  {{ log(\"Relation columns: \" ~ relation_column_names | join(', '), info=False) }}\n\n  {%- if include_columns -%}\n    {%- set profile_column_names = relation_column_names | select(\"in\", include_columns) | list -%}\n  {%- elif exclude_columns -%}\n    {%- set profile_column_names = relation_column_names | reject(\"in\", exclude_columns) | list -%}\n  {%- else -%}\n    {%- set profile_column_names = relation_column_names -%}\n  {%- endif -%}\n\n  {{ log(\"Profile columns: \" ~ profile_column_names | join(', '), info=False) }}\n\n  {% set information_schema_columns = run_query(dbt_profiler.select_from_information_schema_columns(relation)) %}\n  {% set information_schema_columns = information_schema_columns.rename(information_schema_columns.column_names | map('lower')) %}\n  {% set information_schema_data_types = information_schema_columns.columns['data_type'].values() | map('lower') | list %}\n  {% set information_schema_column_names = information_schema_columns.columns['column_name'].values() | map('lower') | list %}\n  {% set data_type_map = {} %}\n  {% for column_name in information_schema_column_names %}\n    {% do data_type_map.update({column_name: information_schema_data_types[loop.index-1]}) %}\n  {% endfor %}\n  {{ log(\"Column data types: \" ~ data_type_map, info=False) }}\n\n  {% set profile_sql %}\n    with source_data as (\n      select\n        *\n      from {{ relation }}\n      {% if where_clause %}\n        where {{ where_clause }}\n      {% endif %}\n    ),\n\n    column_profiles as (\n      {% for column_name in profile_column_names %}\n        {% set data_type = data_type_map.get(column_name.lower(), \"\") %}\n        select \n          {%- for group_by_column in group_by %}\n            {{ group_by_column }},\n          {%- endfor %}\n          lower('{{ column_name }}') as column_name,\n          nullif(lower('{{ data_type }}'), '') as data_type,\n          {% if \"row_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_row_count(column_name, data_type) }} as row_count,\n          {%- endif %}\n          {% if \"not_null_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_not_null_proportion(column_name, data_type) }} as not_null_proportion,\n          {%- endif %}\n          {% if \"distinct_proportion\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_proportion(column_name, data_type) }} as distinct_proportion,\n          {%- endif %}\n          {% if \"distinct_count\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_distinct_count(column_name, data_type) }} as distinct_count,\n          {%- endif %}\n          {% if \"is_unique\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_is_unique(column_name, data_type) }} as is_unique,\n          {%- endif %}\n          {% if \"min\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_min(column_name, data_type) }} as min,\n          {%- endif %}\n          {% if \"max\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_max(column_name, data_type) }} as max,\n          {%- endif %}\n          {% if \"avg\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_avg(column_name, data_type) }} as avg,\n          {%- endif %}\n          {% if \"median\" not in exclude_measures -%}\n            ({{ dbt_profiler.measure_median(column_name, data_type, 'source_data') }}) as median,\n          {%- endif %}\n          {% if \"std_dev_population\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_population(column_name, data_type) }} as std_dev_population,\n          {%- endif %}\n          {% if \"std_dev_sample\" not in exclude_measures -%}\n            {{ dbt_profiler.measure_std_dev_sample(column_name, data_type) }} as std_dev_sample,\n          {%- endif %}\n          cast(current_timestamp as {{ dbt_profiler.type_string() }}) as profiled_at,\n          {{ loop.index }} as _column_position\n        from source_data\n        {% if group_by %}\n          group by {{ group_by | join(\", \") }}\n        {% endif %}\n        {% if not loop.last %}union all{% endif %}\n      {% endfor %}\n    )\n\n    select top 100 percent\n      {%- for group_by_column in group_by %}\n        {{ group_by_column }},\n      {%- endfor %}\n      column_name,\n      data_type,\n      {% for measure in include_measures %}\n        {{ measure }},\n      {% endfor %}\n      profiled_at\n    from column_profiles\n    order by {% if group_by %}{{ group_by | join(\", \") }},{% endif %} _column_position asc\n  {% endset %}\n\n  {% do return(profile_sql) %}\n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.assert_relation_exists", "macro.dbt.run_query", "macro.dbt_profiler.select_from_information_schema_columns", "macro.dbt_profiler.measure_row_count", "macro.dbt_profiler.measure_not_null_proportion", "macro.dbt_profiler.measure_distinct_proportion", "macro.dbt_profiler.measure_distinct_count", "macro.dbt_profiler.measure_is_unique", "macro.dbt_profiler.measure_min", "macro.dbt_profiler.measure_max", "macro.dbt_profiler.measure_avg", "macro.dbt_profiler.measure_median", "macro.dbt_profiler.measure_std_dev_population", "macro.dbt_profiler.measure_std_dev_sample", "macro.dbt_profiler.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.97074, "supported_languages": null}, "macro.dbt_profiler.print_profile_docs": {"name": "print_profile_docs", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/print_profile_docs.sql", "original_file_path": "macros/print_profile_docs.sql", "unique_id": "macro.dbt_profiler.print_profile_docs", "macro_sql": "{% macro print_profile_docs(relation=none, relation_name=none, docs_name=none, schema=none, database=none, exclude_measures=[], include_columns=[], exclude_columns=[], max_rows=none, max_columns=13, max_column_width=30, max_precision=none, where_clause=none) %}\n\n{% if execute %}\n\n    {%- set results = dbt_profiler.get_profile_table(relation=relation, relation_name=relation_name, schema=schema, database=database, exclude_measures=exclude_measures, include_columns=include_columns, exclude_columns=exclude_columns, where_clause=where_clause) -%}\n    \n    {% if docs_name is none %}\n        {% set docs_name = 'dbt_profiler__' + relation_name %}\n    {% endif %}\n    \n    {%- set startdocs = '{% docs ' ~ docs_name ~ '  %}' -%}\n    {%- set enddocs = '{% enddocs %}' -%}\n    \n    {# Check if macro is called in dbt Cloud? #}\n    {%- if flags.WHICH == 'rpc' -%}\n        {%- set is_dbt_cloud = true -%}\n    {%- else -%}\n        {%- set is_dbt_cloud = false -%}\n    {%- endif -%}\n    \n    {% if not is_dbt_cloud %}\n    \n        {{ print(startdocs) }}\n        {% do results.print_table(max_rows=max_rows, max_columns=max_columns, max_column_width=max_column_width, max_precision=max_precision) %}\n        {{ print(enddocs) }}\n    \n    {% else %}\n    \n        {%- set profile_docs=[] -%}\n        {% do profile_docs.append(startdocs) -%}\n        {% do profile_docs.append('') %}\n    \n        {# Get header from column names #}\n        {%- set headers = results.column_names -%}\n        {%- set header = [] -%}\n        {%- set horizontal_line = [] -%}\n    \n        {% for i in range(0,headers|length) %}\n            {% do header.append(headers[i]) %}\n            {% do horizontal_line.append('---') %}\n        {% endfor %}\n        {% do profile_docs.append('| ' ~ header|join(' | ') ~ ' |') %}\n        {% do profile_docs.append('| ' ~ horizontal_line|join(' | ') ~ ' |') %}\n    \n        {# Get row values #}\n        {% for row in results.rows %}\n            {%- set list_row = [''] -%}\n            {% for val in row.values() %}\n                {% do list_row.append(val) %}\n            {% endfor %}\n            {% do profile_docs.append(list_row|join(' | ') ~ ' |') %}\n        {% endfor %}\n        {% do profile_docs.append('') %}\n        {% do profile_docs.append(enddocs) %}\n    \n        {# Join profile docs #}\n        {%- set joined = profile_docs | join ('\\n') -%}\n        {{ log(joined, info=True) }}\n        {% do return(joined) %}\n    \n    {% endif %}\n    \n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.get_profile_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9761634, "supported_languages": null}, "macro.dbt_profiler.get_profile_table": {"name": "get_profile_table", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/get_profile_table.sql", "original_file_path": "macros/get_profile_table.sql", "unique_id": "macro.dbt_profiler.get_profile_table", "macro_sql": "{% macro get_profile_table(relation=none, relation_name=none, schema=none, database=none, exclude_measures=[], include_columns=[], exclude_columns=[], where_clause=none) %}\n\n{%- set relation = dbt_profiler.get_relation(\n  relation=relation,\n  relation_name=relation_name,\n  schema=schema,\n  database=database\n) -%}\n{%- set profile_sql = dbt_profiler.get_profile(relation=relation, exclude_measures=exclude_measures, include_columns=include_columns, exclude_columns=exclude_columns, where_clause=where_clause) -%}\n{{ log(profile_sql, info=False) }}\n{% set results = run_query(profile_sql) %}\n{% set results = results.rename(results.column_names | map('lower')) %}\n{% do return(results) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.get_relation", "macro.dbt_profiler.get_profile", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9777098, "supported_languages": null}, "macro.dbt_profiler.get_relation": {"name": "get_relation", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/relation.sql", "original_file_path": "macros/relation.sql", "unique_id": "macro.dbt_profiler.get_relation", "macro_sql": "{% macro get_relation(relation=none, relation_name=none, schema=none, database=none) %}\n\n{% if relation is none and relation_name is none %}\n  {{ exceptions.raise_compiler_error(\"Either relation or relation_name must be specified.\") }}\n{% endif %}\n\n{% if relation is none %}\n  {% if schema is none %}\n    {% set schema = target.schema %}\n  {% endif %}\n\n  {% if database is none %}\n    {% set database = target.database %}\n  {% endif %}\n\n  {{ log(\"Get relation %s (database=%s, schema=%s)\" | format(adapter.quote(relation_name), adapter.quote(database), adapter.quote(schema)), info=False) }}\n\n  {%- \n  set relation = adapter.get_relation(\n    database=database,\n    schema=schema,\n    identifier=relation_name\n  ) \n  -%}\n  {% if relation is none %}\n    {{ exceptions.raise_compiler_error(\"Relation \" ~ adapter.quote(relation_name) ~ \" does not exist or not authorized.\") }}\n  {% endif %}\n{% endif %}\n\n{% do return(relation) %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9802706, "supported_languages": null}, "macro.dbt_profiler.assert_relation_exists": {"name": "assert_relation_exists", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/relation.sql", "original_file_path": "macros/relation.sql", "unique_id": "macro.dbt_profiler.assert_relation_exists", "macro_sql": "\n\n{%- macro assert_relation_exists(relation) -%}\n  {{ return(adapter.dispatch(\"assert_relation_exists\", macro_namespace=\"dbt_profiler\")(relation)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__assert_relation_exists"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9806447, "supported_languages": null}, "macro.dbt_profiler.default__assert_relation_exists": {"name": "default__assert_relation_exists", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/relation.sql", "original_file_path": "macros/relation.sql", "unique_id": "macro.dbt_profiler.default__assert_relation_exists", "macro_sql": "{% macro default__assert_relation_exists(relation) %}\n\n{% do run_query(\"select * from \" ~ relation ~ \" limit 0\") %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9809465, "supported_languages": null}, "macro.dbt_profiler.sqlserver__assert_relation_exists": {"name": "sqlserver__assert_relation_exists", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/relation.sql", "original_file_path": "macros/relation.sql", "unique_id": "macro.dbt_profiler.sqlserver__assert_relation_exists", "macro_sql": "{% macro sqlserver__assert_relation_exists(relation) %}\n\n{% do run_query(\"select top(0) * from \" ~ relation ~ \"\") %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9812424, "supported_languages": null}, "macro.dbt_profiler.print_profile_schema": {"name": "print_profile_schema", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/print_profile_schema.sql", "original_file_path": "macros/print_profile_schema.sql", "unique_id": "macro.dbt_profiler.print_profile_schema", "macro_sql": "{% macro print_profile_schema(relation=none, relation_name=none, schema=none, database=none, exclude_measures=[], include_columns=[], exclude_columns=[], model_description=\"\", column_description=\"\", where_clause=none) %}\n\n{%- set column_dicts = [] -%}\n{%- set results = dbt_profiler.get_profile_table(relation=relation, relation_name=relation_name, schema=schema, database=database, exclude_measures=exclude_measures, include_columns=include_columns, exclude_columns=exclude_columns, where_clause=where_clause) -%}\n\n{% if execute %}\n  {% for row in results.rows %}\n\n    {% set row_dict = row.dict() %}\n    {% set column_name = row_dict.pop(\"column_name\") %}\n\n    {% set meta_dict = {} %}\n    {% for key, value in row_dict.items() %}\n      {% set column = results.columns.get(key) %}\n      {% do meta_dict.update({key: column.data_type.jsonify(value)}) %}\n    {% endfor %}\n\n    {% set column_dict = {\"name\": column_name, \"description\": column_description, \"meta\": meta_dict} %}\n    {% do column_dicts.append(column_dict) %}\n  {% endfor %}\n\n  {% set schema_dict = {\n    \"version\": 2,\n    \"models\": [\n      {\n        \"name\": relation_name,\n        \"description\": model_description,\n        \"columns\": column_dicts\n      }\n    ]\n  } %}\n  {% set schema_yaml = toyaml(schema_dict) %}\n\n  {{ log(schema_yaml, info=True) }}\n  {% do return(schema_dict) %}\n{% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.get_profile_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9845974, "supported_languages": null}, "macro.dbt_profiler.measure_row_count": {"name": "measure_row_count", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_row_count", "macro_sql": "\n\n{%- macro measure_row_count(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_row_count\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_row_count"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9884667, "supported_languages": null}, "macro.dbt_profiler.default__measure_row_count": {"name": "default__measure_row_count", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_row_count", "macro_sql": "{%- macro default__measure_row_count(column_name, data_type) -%}\ncast(count(*) as {{ dbt.type_numeric() }})\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9887362, "supported_languages": null}, "macro.dbt_profiler.measure_not_null_proportion": {"name": "measure_not_null_proportion", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_not_null_proportion", "macro_sql": "\n\n{%- macro measure_not_null_proportion(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_not_null_proportion\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_not_null_proportion"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9891348, "supported_languages": null}, "macro.dbt_profiler.default__measure_not_null_proportion": {"name": "default__measure_not_null_proportion", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_not_null_proportion", "macro_sql": "{%- macro default__measure_not_null_proportion(column_name, data_type) -%}\nsum(case when {{ adapter.quote(column_name) }} is null then 0 else 1 end) / cast(count(*) as {{ dbt.type_numeric() }})\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9894855, "supported_languages": null}, "macro.dbt_profiler.measure_distinct_proportion": {"name": "measure_distinct_proportion", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_distinct_proportion", "macro_sql": "\n\n{%- macro measure_distinct_proportion(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_distinct_proportion\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_distinct_proportion"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9899013, "supported_languages": null}, "macro.dbt_profiler.default__measure_distinct_proportion": {"name": "default__measure_distinct_proportion", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_distinct_proportion", "macro_sql": "{%- macro default__measure_distinct_proportion(column_name, data_type) -%}\n{%- if not dbt_profiler.is_struct_dtype(data_type) -%}\n    count(distinct {{ adapter.quote(column_name) }}) / cast(count(*) as {{ dbt.type_numeric() }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9904838, "supported_languages": null}, "macro.dbt_profiler.measure_distinct_count": {"name": "measure_distinct_count", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_distinct_count", "macro_sql": "\n\n{%- macro measure_distinct_count(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_distinct_count\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_distinct_count"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9909017, "supported_languages": null}, "macro.dbt_profiler.default__measure_distinct_count": {"name": "default__measure_distinct_count", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_distinct_count", "macro_sql": "{%- macro default__measure_distinct_count(column_name, data_type) -%}\n{%- if not dbt_profiler.is_struct_dtype(data_type) -%}\n    count(distinct {{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.99141, "supported_languages": null}, "macro.dbt_profiler.measure_is_unique": {"name": "measure_is_unique", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_is_unique", "macro_sql": "\n\n{%- macro measure_is_unique(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_is_unique\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_is_unique"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9918265, "supported_languages": null}, "macro.dbt_profiler.default__measure_is_unique": {"name": "default__measure_is_unique", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_is_unique", "macro_sql": "{%- macro default__measure_is_unique(column_name, data_type) -%}\n{%- if not dbt_profiler.is_struct_dtype(data_type) -%}\n    count(distinct {{ adapter.quote(column_name) }}) = count(*)\n{%- else -%}\n    null\n{%- endif -%}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_struct_dtype"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9923491, "supported_languages": null}, "macro.dbt_profiler.sqlserver__measure_is_unique": {"name": "sqlserver__measure_is_unique", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.sqlserver__measure_is_unique", "macro_sql": "{%- macro sqlserver__measure_is_unique(column_name, data_type) -%}\ncase when count(distinct {{ adapter.quote(column_name) }}) = count(*) then 1 else 0 end\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9926233, "supported_languages": null}, "macro.dbt_profiler.measure_min": {"name": "measure_min", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_min", "macro_sql": "\n\n{%- macro measure_min(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_min\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_min"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9930055, "supported_languages": null}, "macro.dbt_profiler.default__measure_min": {"name": "default__measure_min", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_min", "macro_sql": "{%- macro default__measure_min(column_name, data_type) -%}\n{%- if (dbt_profiler.is_numeric_dtype(data_type) or dbt_profiler.is_date_or_time_dtype(data_type)) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    cast(min({{ adapter.quote(column_name) }}) as {{ dbt_profiler.type_string() }})\n{%- else -%}\n    cast(null as {{ dbt_profiler.type_string() }})\n{%- endif -%}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_date_or_time_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt_profiler.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9936965, "supported_languages": null}, "macro.dbt_profiler.measure_max": {"name": "measure_max", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_max", "macro_sql": "\n\n{%- macro measure_max(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_max\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_max"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9940727, "supported_languages": null}, "macro.dbt_profiler.default__measure_max": {"name": "default__measure_max", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_max", "macro_sql": "{%- macro default__measure_max(column_name, data_type) -%}\n{%- if (dbt_profiler.is_numeric_dtype(data_type) or dbt_profiler.is_date_or_time_dtype(data_type)) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    cast(max({{ adapter.quote(column_name) }}) as {{ dbt_profiler.type_string() }})\n{%- else -%}\n    cast(null as {{ dbt_profiler.type_string() }})\n{%- endif -%}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_date_or_time_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt_profiler.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9947495, "supported_languages": null}, "macro.dbt_profiler.measure_avg": {"name": "measure_avg", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_avg", "macro_sql": "\n\n{%- macro measure_avg(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_avg\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_avg"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9951324, "supported_languages": null}, "macro.dbt_profiler.default__measure_avg": {"name": "default__measure_avg", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_avg", "macro_sql": "{%- macro default__measure_avg(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    avg({{ adapter.quote(column_name) }})\n{%- elif dbt_profiler.is_logical_dtype(data_type) -%}\n    avg(case when {{ adapter.quote(column_name) }} then 1 else 0 end)\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt_profiler.is_logical_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9959476, "supported_languages": null}, "macro.dbt_profiler.redshift__measure_avg": {"name": "redshift__measure_avg", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.redshift__measure_avg", "macro_sql": "{%- macro redshift__measure_avg(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    avg({{ adapter.quote(column_name) }}::float)\n{%- elif dbt_profiler.is_logical_dtype(data_type) -%}\n    avg(case when {{ adapter.quote(column_name) }} then 1.0 else 0.0 end)\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt_profiler.is_logical_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9966578, "supported_languages": null}, "macro.dbt_profiler.measure_median": {"name": "measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_median", "macro_sql": "\n\n{%- macro measure_median(column_name, data_type, cte_name) -%}\n  {{ return(adapter.dispatch(\"measure_median\", macro_namespace=\"dbt_profiler\")(column_name, data_type, cte_name)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.bigquery__measure_median"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9970765, "supported_languages": null}, "macro.dbt_profiler.default__measure_median": {"name": "default__measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_median", "macro_sql": "{%- macro default__measure_median(column_name, data_type, cte_name) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    median({{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9976785, "supported_languages": null}, "macro.dbt_profiler.bigquery__measure_median": {"name": "bigquery__measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.bigquery__measure_median", "macro_sql": "{%- macro bigquery__measure_median(column_name, data_type, cte_name) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    APPROX_QUANTILES({{ adapter.quote(column_name) }}, 100)[OFFSET(50)]\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.99826, "supported_languages": null}, "macro.dbt_profiler.postgres__measure_median": {"name": "postgres__measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.postgres__measure_median", "macro_sql": "{%- macro postgres__measure_median(column_name, data_type, cte_name) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    percentile_cont(0.5) within group (order by {{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9988499, "supported_languages": null}, "macro.dbt_profiler.redshift__measure_median": {"name": "redshift__measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.redshift__measure_median", "macro_sql": "{%- macro redshift__measure_median(column_name, data_type, cte_name) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    select percentile_cont(0.5) within group (order by {{ adapter.quote(column_name) }}) from {{ cte_name }}\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709584.9994426, "supported_languages": null}, "macro.dbt_profiler.sql_server__measure_median": {"name": "sql_server__measure_median", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.sql_server__measure_median", "macro_sql": "{%- macro sql_server__measure_median(column_name, data_type, cte_name) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    percentile_cont({{ adapter.quote(column_name) }}, 0.5) over ()\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0000312, "supported_languages": null}, "macro.dbt_profiler.measure_std_dev_population": {"name": "measure_std_dev_population", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_std_dev_population", "macro_sql": "\n\n{%- macro measure_std_dev_population(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_std_dev_population\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_std_dev_population"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0004203, "supported_languages": null}, "macro.dbt_profiler.default__measure_std_dev_population": {"name": "default__measure_std_dev_population", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_std_dev_population", "macro_sql": "{%- macro default__measure_std_dev_population(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    stddev_pop({{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.001006, "supported_languages": null}, "macro.dbt_profiler.sqlserver__measure_std_dev_population": {"name": "sqlserver__measure_std_dev_population", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.sqlserver__measure_std_dev_population", "macro_sql": "{%- macro sqlserver__measure_std_dev_population(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) -%}\n    stdevp({{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.001499, "supported_languages": null}, "macro.dbt_profiler.measure_std_dev_sample": {"name": "measure_std_dev_sample", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.measure_std_dev_sample", "macro_sql": "\n\n{%- macro measure_std_dev_sample(column_name, data_type) -%}\n  {{ return(adapter.dispatch(\"measure_std_dev_sample\", macro_namespace=\"dbt_profiler\")(column_name, data_type)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.default__measure_std_dev_sample"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.001891, "supported_languages": null}, "macro.dbt_profiler.default__measure_std_dev_sample": {"name": "default__measure_std_dev_sample", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.default__measure_std_dev_sample", "macro_sql": "{%- macro default__measure_std_dev_sample(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) and not dbt_profiler.is_struct_dtype(data_type) -%}\n    stddev_samp({{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt_profiler.is_struct_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.002562, "supported_languages": null}, "macro.dbt_profiler.sqlserver__measure_std_dev_sample": {"name": "sqlserver__measure_std_dev_sample", "resource_type": "macro", "package_name": "dbt_profiler", "path": "macros/measures.sql", "original_file_path": "macros/measures.sql", "unique_id": "macro.dbt_profiler.sqlserver__measure_std_dev_sample", "macro_sql": "{%- macro sqlserver__measure_std_dev_sample(column_name, data_type) -%}\n\n{%- if dbt_profiler.is_numeric_dtype(data_type) -%}\n    stdev({{ adapter.quote(column_name) }})\n{%- else -%}\n    cast(null as {{ dbt.type_numeric() }})\n{%- endif -%}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt_profiler.is_numeric_dtype", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.003058, "supported_languages": null}, "macro.dbt_utils.test_not_null_proportion": {"name": "test_not_null_proportion", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_null_proportion.sql", "original_file_path": "macros/generic_tests/not_null_proportion.sql", "unique_id": "macro.dbt_utils.test_not_null_proportion", "macro_sql": "{% macro test_not_null_proportion(model, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_not_null_proportion', 'dbt_utils')(model, group_by_columns, **kwargs)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_not_null_proportion"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0040715, "supported_languages": null}, "macro.dbt_utils.default__test_not_null_proportion": {"name": "default__test_not_null_proportion", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_null_proportion.sql", "original_file_path": "macros/generic_tests/not_null_proportion.sql", "unique_id": "macro.dbt_utils.default__test_not_null_proportion", "macro_sql": "{% macro default__test_not_null_proportion(model, group_by_columns) %}\n\n{% set column_name = kwargs.get('column_name', kwargs.get('arg')) %}\n{% set at_least = kwargs.get('at_least', kwargs.get('arg')) %}\n{% set at_most = kwargs.get('at_most', kwargs.get('arg', 1)) %}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(' ,') + ', ' %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n{% endif %}\n\nwith validation as (\n  select\n    {{select_gb_cols}}\n    sum(case when {{ column_name }} is null then 0 else 1 end) / cast(count(*) as {{ dbt.type_numeric() }}) as not_null_proportion\n  from {{ model }}\n  {{groupby_gb_cols}}\n),\nvalidation_errors as (\n  select\n    {{select_gb_cols}}\n    not_null_proportion\n  from validation\n  where not_null_proportion < {{ at_least }} or not_null_proportion > {{ at_most }}\n)\nselect\n  *\nfrom validation_errors\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.005608, "supported_languages": null}, "macro.dbt_utils.test_not_constant": {"name": "test_not_constant", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_constant.sql", "original_file_path": "macros/generic_tests/not_constant.sql", "unique_id": "macro.dbt_utils.test_not_constant", "macro_sql": "{% test not_constant(model, column_name, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_not_constant', 'dbt_utils')(model, column_name, group_by_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_not_constant"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0063295, "supported_languages": null}, "macro.dbt_utils.default__test_not_constant": {"name": "default__test_not_constant", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_constant.sql", "original_file_path": "macros/generic_tests/not_constant.sql", "unique_id": "macro.dbt_utils.default__test_not_constant", "macro_sql": "{% macro default__test_not_constant(model, column_name, group_by_columns) %}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(' ,') + ', ' %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n{% endif %}\n\n\nselect\n    {# In TSQL, subquery aggregate columns need aliases #}\n    {# thus: a filler col name, 'filler_column' #}\n    {{select_gb_cols}}\n    count(distinct {{ column_name }}) as filler_column\n\nfrom {{ model }}\n\n  {{groupby_gb_cols}}\n\nhaving count(distinct {{ column_name }}) = 1\n\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0071402, "supported_languages": null}, "macro.dbt_utils.test_relationships_where": {"name": "test_relationships_where", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/relationships_where.sql", "original_file_path": "macros/generic_tests/relationships_where.sql", "unique_id": "macro.dbt_utils.test_relationships_where", "macro_sql": "{% test relationships_where(model, column_name, to, field, from_condition=\"1=1\", to_condition=\"1=1\") %}\n  {{ return(adapter.dispatch('test_relationships_where', 'dbt_utils')(model, column_name, to, field, from_condition, to_condition)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_relationships_where"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.008098, "supported_languages": null}, "macro.dbt_utils.default__test_relationships_where": {"name": "default__test_relationships_where", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/relationships_where.sql", "original_file_path": "macros/generic_tests/relationships_where.sql", "unique_id": "macro.dbt_utils.default__test_relationships_where", "macro_sql": "{% macro default__test_relationships_where(model, column_name, to, field, from_condition=\"1=1\", to_condition=\"1=1\") %}\n\n{# T-SQL has no boolean data type so we use 1=1 which returns TRUE #}\n{# ref https://stackoverflow.com/a/7170753/3842610 #}\n\nwith left_table as (\n\n  select\n    {{column_name}} as id\n\n  from {{model}}\n\n  where {{column_name}} is not null\n    and {{from_condition}}\n\n),\n\nright_table as (\n\n  select\n    {{field}} as id\n\n  from {{to}}\n\n  where {{field}} is not null\n    and {{to_condition}}\n\n),\n\nexceptions as (\n\n  select\n    left_table.id,\n    right_table.id as right_id\n\n  from left_table\n\n  left join right_table\n         on left_table.id = right_table.id\n\n  where right_table.id is null\n\n)\n\nselect * from exceptions\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0087094, "supported_languages": null}, "macro.dbt_utils.test_cardinality_equality": {"name": "test_cardinality_equality", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/cardinality_equality.sql", "original_file_path": "macros/generic_tests/cardinality_equality.sql", "unique_id": "macro.dbt_utils.test_cardinality_equality", "macro_sql": "{% test cardinality_equality(model, column_name, to, field) %}\n    {{ return(adapter.dispatch('test_cardinality_equality', 'dbt_utils')(model, column_name, to, field)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_cardinality_equality"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0095198, "supported_languages": null}, "macro.dbt_utils.default__test_cardinality_equality": {"name": "default__test_cardinality_equality", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/cardinality_equality.sql", "original_file_path": "macros/generic_tests/cardinality_equality.sql", "unique_id": "macro.dbt_utils.default__test_cardinality_equality", "macro_sql": "{% macro default__test_cardinality_equality(model, column_name, to, field) %}\n\n{# T-SQL does not let you use numbers as aliases for columns #}\n{# Thus, no \"GROUP BY 1\" #}\n\nwith table_a as (\nselect\n  {{ column_name }},\n  count(*) as num_rows\nfrom {{ model }}\ngroup by {{ column_name }}\n),\n\ntable_b as (\nselect\n  {{ field }},\n  count(*) as num_rows\nfrom {{ to }}\ngroup by {{ field }}\n),\n\nexcept_a as (\n  select *\n  from table_a\n  {{ dbt.except() }}\n  select *\n  from table_b\n),\n\nexcept_b as (\n  select *\n  from table_b\n  {{ dbt.except() }}\n  select *\n  from table_a\n),\n\nunioned as (\n  select *\n  from except_a\n  union all\n  select *\n  from except_b\n)\n\nselect *\nfrom unioned\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.010129, "supported_languages": null}, "macro.dbt_utils.test_sequential_values": {"name": "test_sequential_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/sequential_values.sql", "original_file_path": "macros/generic_tests/sequential_values.sql", "unique_id": "macro.dbt_utils.test_sequential_values", "macro_sql": "{% test sequential_values(model, column_name, interval=1, datepart=None, group_by_columns = []) %}\n\n  {{ return(adapter.dispatch('test_sequential_values', 'dbt_utils')(model, column_name, interval, datepart, group_by_columns)) }}\n\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_sequential_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.011398, "supported_languages": null}, "macro.dbt_utils.default__test_sequential_values": {"name": "default__test_sequential_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/sequential_values.sql", "original_file_path": "macros/generic_tests/sequential_values.sql", "unique_id": "macro.dbt_utils.default__test_sequential_values", "macro_sql": "{% macro default__test_sequential_values(model, column_name, interval=1, datepart=None, group_by_columns = []) %}\n\n{% set previous_column_name = \"previous_\" ~ dbt_utils.slugify(column_name) %}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(',') + ', ' %}\n  {% set partition_gb_cols = 'partition by ' + group_by_columns|join(',') %}\n{% endif %}\n\nwith windowed as (\n\n    select\n        {{ select_gb_cols }}\n        {{ column_name }},\n        lag({{ column_name }}) over (\n            {{partition_gb_cols}}\n            order by {{ column_name }}\n        ) as {{ previous_column_name }}\n    from {{ model }}\n),\n\nvalidation_errors as (\n    select\n        *\n    from windowed\n    {% if datepart %}\n    where not(cast({{ column_name }} as {{ dbt.type_timestamp() }})= cast({{ dbt.dateadd(datepart, interval, previous_column_name) }} as {{ dbt.type_timestamp() }}))\n    {% else %}\n    where not({{ column_name }} = {{ previous_column_name }} + {{ interval }})\n    {% endif %}\n)\n\nselect *\nfrom validation_errors\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.slugify", "macro.dbt.type_timestamp", "macro.dbt.dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0130057, "supported_languages": null}, "macro.dbt_utils.test_not_empty_string": {"name": "test_not_empty_string", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_empty_string.sql", "original_file_path": "macros/generic_tests/not_empty_string.sql", "unique_id": "macro.dbt_utils.test_not_empty_string", "macro_sql": "{% test not_empty_string(model, column_name, trim_whitespace=true) %}\n\n  {{ return(adapter.dispatch('test_not_empty_string', 'dbt_utils')(model, column_name, trim_whitespace)) }}\n\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_not_empty_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.013783, "supported_languages": null}, "macro.dbt_utils.default__test_not_empty_string": {"name": "default__test_not_empty_string", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_empty_string.sql", "original_file_path": "macros/generic_tests/not_empty_string.sql", "unique_id": "macro.dbt_utils.default__test_not_empty_string", "macro_sql": "{% macro default__test_not_empty_string(model, column_name, trim_whitespace=true) %}\n\n    with\n    \n    all_values as (\n\n        select \n\n\n            {% if trim_whitespace == true -%}\n\n                trim({{ column_name }}) as {{ column_name }}\n\n            {%- else -%}\n\n                {{ column_name }}\n\n            {%- endif %}\n            \n        from {{ model }}\n\n    ),\n\n    errors as (\n\n        select * from all_values\n        where {{ column_name }} = ''\n\n    )\n\n    select * from errors\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0143263, "supported_languages": null}, "macro.dbt_utils.test_recency": {"name": "test_recency", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/recency.sql", "original_file_path": "macros/generic_tests/recency.sql", "unique_id": "macro.dbt_utils.test_recency", "macro_sql": "{% test recency(model, field, datepart, interval, ignore_time_component=False, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_recency', 'dbt_utils')(model, field, datepart, interval, ignore_time_component, group_by_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_recency"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0154014, "supported_languages": null}, "macro.dbt_utils.default__test_recency": {"name": "default__test_recency", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/recency.sql", "original_file_path": "macros/generic_tests/recency.sql", "unique_id": "macro.dbt_utils.default__test_recency", "macro_sql": "{% macro default__test_recency(model, field, datepart, interval, ignore_time_component, group_by_columns) %}\n\n{% set threshold = 'cast(' ~ dbt.dateadd(datepart, interval * -1, dbt.current_timestamp()) ~ ' as ' ~ ('date' if ignore_time_component else dbt.type_timestamp()) ~ ')'  %}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(' ,') + ', ' %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n{% endif %}\n\n\nwith recency as (\n\n    select \n\n      {{ select_gb_cols }}\n      {% if ignore_time_component %}\n        cast(max({{ field }}) as date) as most_recent\n      {%- else %}\n        max({{ field }}) as most_recent\n      {%- endif %}\n\n    from {{ model }}\n\n    {{ groupby_gb_cols }}\n\n)\n\nselect\n\n    {{ select_gb_cols }}\n    most_recent,\n    {{ threshold }} as threshold\n\nfrom recency\nwhere most_recent < {{ threshold }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.dateadd", "macro.dbt.current_timestamp", "macro.dbt.type_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0169632, "supported_languages": null}, "macro.dbt_utils.test_expression_is_true": {"name": "test_expression_is_true", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/expression_is_true.sql", "original_file_path": "macros/generic_tests/expression_is_true.sql", "unique_id": "macro.dbt_utils.test_expression_is_true", "macro_sql": "{% test expression_is_true(model, expression, column_name=None) %}\n  {{ return(adapter.dispatch('test_expression_is_true', 'dbt_utils')(model, expression, column_name)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_expression_is_true"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0176349, "supported_languages": null}, "macro.dbt_utils.default__test_expression_is_true": {"name": "default__test_expression_is_true", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/expression_is_true.sql", "original_file_path": "macros/generic_tests/expression_is_true.sql", "unique_id": "macro.dbt_utils.default__test_expression_is_true", "macro_sql": "{% macro default__test_expression_is_true(model, expression, column_name) %}\n\n{% set column_list = '*' if should_store_failures() else \"1\" %}\n\nselect\n    {{ column_list }}\nfrom {{ model }}\n{% if column_name is none %}\nwhere not({{ expression }})\n{%- else %}\nwhere not({{ column_name }} {{ expression }})\n{%- endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_store_failures"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0182843, "supported_languages": null}, "macro.dbt_utils.test_mutually_exclusive_ranges": {"name": "test_mutually_exclusive_ranges", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/mutually_exclusive_ranges.sql", "original_file_path": "macros/generic_tests/mutually_exclusive_ranges.sql", "unique_id": "macro.dbt_utils.test_mutually_exclusive_ranges", "macro_sql": "{% test mutually_exclusive_ranges(model, lower_bound_column, upper_bound_column, partition_by=None, gaps='allowed', zero_length_range_allowed=False) %}\n  {{ return(adapter.dispatch('test_mutually_exclusive_ranges', 'dbt_utils')(model, lower_bound_column, upper_bound_column, partition_by, gaps, zero_length_range_allowed)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_mutually_exclusive_ranges"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.022487, "supported_languages": null}, "macro.dbt_utils.default__test_mutually_exclusive_ranges": {"name": "default__test_mutually_exclusive_ranges", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/mutually_exclusive_ranges.sql", "original_file_path": "macros/generic_tests/mutually_exclusive_ranges.sql", "unique_id": "macro.dbt_utils.default__test_mutually_exclusive_ranges", "macro_sql": "{% macro default__test_mutually_exclusive_ranges(model, lower_bound_column, upper_bound_column, partition_by=None, gaps='allowed', zero_length_range_allowed=False) %}\n{% if gaps == 'not_allowed' %}\n    {% set allow_gaps_operator='=' %}\n    {% set allow_gaps_operator_in_words='equal_to' %}\n{% elif gaps == 'allowed' %}\n    {% set allow_gaps_operator='<=' %}\n    {% set allow_gaps_operator_in_words='less_than_or_equal_to' %}\n{% elif gaps == 'required' %}\n    {% set allow_gaps_operator='<' %}\n    {% set allow_gaps_operator_in_words='less_than' %}\n{% else %}\n    {{ exceptions.raise_compiler_error(\n        \"`gaps` argument for mutually_exclusive_ranges test must be one of ['not_allowed', 'allowed', 'required'] Got: '\" ~ gaps ~\"'.'\"\n    ) }}\n{% endif %}\n{% if not zero_length_range_allowed %}\n    {% set allow_zero_length_operator='<' %}\n    {% set allow_zero_length_operator_in_words='less_than' %}\n{% elif zero_length_range_allowed %}\n    {% set allow_zero_length_operator='<=' %}\n    {% set allow_zero_length_operator_in_words='less_than_or_equal_to' %}\n{% else %}\n    {{ exceptions.raise_compiler_error(\n        \"`zero_length_range_allowed` argument for mutually_exclusive_ranges test must be one of [true, false] Got: '\" ~ zero_length_range_allowed ~\"'.'\"\n    ) }}\n{% endif %}\n\n{% set partition_clause=\"partition by \" ~ partition_by if partition_by else '' %}\n\nwith window_functions as (\n\n    select\n        {% if partition_by %}\n        {{ partition_by }} as partition_by_col,\n        {% endif %}\n        {{ lower_bound_column }} as lower_bound,\n        {{ upper_bound_column }} as upper_bound,\n\n        lead({{ lower_bound_column }}) over (\n            {{ partition_clause }}\n            order by {{ lower_bound_column }}, {{ upper_bound_column }}\n        ) as next_lower_bound,\n\n        row_number() over (\n            {{ partition_clause }}\n            order by {{ lower_bound_column }} desc, {{ upper_bound_column }} desc\n        ) = 1 as is_last_record\n\n    from {{ model }}\n\n),\n\ncalc as (\n    -- We want to return records where one of our assumptions fails, so we'll use\n    -- the `not` function with `and` statements so we can write our assumptions more cleanly\n    select\n        *,\n\n        -- For each record: lower_bound should be < upper_bound.\n        -- Coalesce it to return an error on the null case (implicit assumption\n        -- these columns are not_null)\n        coalesce(\n            lower_bound {{ allow_zero_length_operator }} upper_bound,\n            false\n        ) as lower_bound_{{ allow_zero_length_operator_in_words }}_upper_bound,\n\n        -- For each record: upper_bound {{ allow_gaps_operator }} the next lower_bound.\n        -- Coalesce it to handle null cases for the last record.\n        coalesce(\n            upper_bound {{ allow_gaps_operator }} next_lower_bound,\n            is_last_record,\n            false\n        ) as upper_bound_{{ allow_gaps_operator_in_words }}_next_lower_bound\n\n    from window_functions\n\n),\n\nvalidation_errors as (\n\n    select\n        *\n    from calc\n\n    where not(\n        -- THE FOLLOWING SHOULD BE TRUE --\n        lower_bound_{{ allow_zero_length_operator_in_words }}_upper_bound\n        and upper_bound_{{ allow_gaps_operator_in_words }}_next_lower_bound\n    )\n)\n\nselect * from validation_errors\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.025193, "supported_languages": null}, "macro.dbt_utils.test_accepted_range": {"name": "test_accepted_range", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/accepted_range.sql", "original_file_path": "macros/generic_tests/accepted_range.sql", "unique_id": "macro.dbt_utils.test_accepted_range", "macro_sql": "{% test accepted_range(model, column_name, min_value=none, max_value=none, inclusive=true) %}\n  {{ return(adapter.dispatch('test_accepted_range', 'dbt_utils')(model, column_name, min_value, max_value, inclusive)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_accepted_range"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0261953, "supported_languages": null}, "macro.dbt_utils.default__test_accepted_range": {"name": "default__test_accepted_range", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/accepted_range.sql", "original_file_path": "macros/generic_tests/accepted_range.sql", "unique_id": "macro.dbt_utils.default__test_accepted_range", "macro_sql": "{% macro default__test_accepted_range(model, column_name, min_value=none, max_value=none, inclusive=true) %}\n\nwith meet_condition as(\n  select *\n  from {{ model }}\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n\n  {%- if min_value is not none %}\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not {{ column_name }} > {{- \"=\" if inclusive }} {{ min_value }}\n  {%- endif %}\n\n  {%- if max_value is not none %}\n    -- records with a value <= max_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not {{ column_name }} < {{- \"=\" if inclusive }} {{ max_value }}\n  {%- endif %}\n)\n\nselect *\nfrom validation_errors\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0270376, "supported_languages": null}, "macro.dbt_utils.test_equal_rowcount": {"name": "test_equal_rowcount", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/equal_rowcount.sql", "original_file_path": "macros/generic_tests/equal_rowcount.sql", "unique_id": "macro.dbt_utils.test_equal_rowcount", "macro_sql": "{% test equal_rowcount(model, compare_model, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_equal_rowcount', 'dbt_utils')(model, compare_model, group_by_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_equal_rowcount"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0282466, "supported_languages": null}, "macro.dbt_utils.default__test_equal_rowcount": {"name": "default__test_equal_rowcount", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/equal_rowcount.sql", "original_file_path": "macros/generic_tests/equal_rowcount.sql", "unique_id": "macro.dbt_utils.default__test_equal_rowcount", "macro_sql": "{% macro default__test_equal_rowcount(model, compare_model, group_by_columns) %}\n\n{#-- Needs to be set at parse time, before we return '' below --#}\n{{ config(fail_calc = 'sum(coalesce(diff_count, 0))') }}\n\n{#-- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. #}\n{%- if not execute -%}\n    {{ return('') }}\n{% endif %}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(', ') + ', ' %}\n  {% set join_gb_cols %}\n    {% for c in group_by_columns %}\n      and a.{{c}} = b.{{c}}\n    {% endfor %}\n  {% endset %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n{% endif %}\n\n{#-- We must add a fake join key in case additional grouping variables are not provided --#}\n{#-- Redshift does not allow for dynamically created join conditions (e.g. full join on 1 = 1 --#}\n{#-- The same logic is used in fewer_rows_than. In case of changes, maintain consistent logic --#}\n{% set group_by_columns = ['id_dbtutils_test_equal_rowcount'] + group_by_columns %}\n{% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n\nwith a as (\n\n    select \n      {{select_gb_cols}}\n      1 as id_dbtutils_test_equal_rowcount,\n      count(*) as count_a \n    from {{ model }}\n    {{groupby_gb_cols}}\n\n\n),\nb as (\n\n    select \n      {{select_gb_cols}}\n      1 as id_dbtutils_test_equal_rowcount,\n      count(*) as count_b \n    from {{ compare_model }}\n    {{groupby_gb_cols}}\n\n),\nfinal as (\n\n    select\n    \n        {% for c in group_by_columns -%}\n          a.{{c}} as {{c}}_a,\n          b.{{c}} as {{c}}_b,\n        {% endfor %}\n\n        count_a,\n        count_b,\n        abs(count_a - count_b) as diff_count\n\n    from a\n    full join b\n    on\n    a.id_dbtutils_test_equal_rowcount = b.id_dbtutils_test_equal_rowcount\n    {{join_gb_cols}}\n\n\n)\n\nselect * from final\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0302033, "supported_languages": null}, "macro.dbt_utils.test_fewer_rows_than": {"name": "test_fewer_rows_than", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/fewer_rows_than.sql", "original_file_path": "macros/generic_tests/fewer_rows_than.sql", "unique_id": "macro.dbt_utils.test_fewer_rows_than", "macro_sql": "{% test fewer_rows_than(model, compare_model, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_fewer_rows_than', 'dbt_utils')(model, compare_model, group_by_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_fewer_rows_than"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0316715, "supported_languages": null}, "macro.dbt_utils.default__test_fewer_rows_than": {"name": "default__test_fewer_rows_than", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/fewer_rows_than.sql", "original_file_path": "macros/generic_tests/fewer_rows_than.sql", "unique_id": "macro.dbt_utils.default__test_fewer_rows_than", "macro_sql": "{% macro default__test_fewer_rows_than(model, compare_model, group_by_columns) %}\n\n{{ config(fail_calc = 'sum(coalesce(row_count_delta, 0))') }}\n\n{% if group_by_columns|length() > 0 %}\n  {% set select_gb_cols = group_by_columns|join(' ,') + ', ' %}\n  {% set join_gb_cols %}\n    {% for c in group_by_columns %}\n      and a.{{c}} = b.{{c}}\n    {% endfor %}\n  {% endset %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n{% endif %}\n\n{#-- We must add a fake join key in case additional grouping variables are not provided --#}\n{#-- Redshift does not allow for dynamically created join conditions (e.g. full join on 1 = 1 --#}\n{#-- The same logic is used in equal_rowcount. In case of changes, maintain consistent logic --#}\n{% set group_by_columns = ['id_dbtutils_test_fewer_rows_than'] + group_by_columns %}\n{% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n\n\nwith a as (\n\n    select \n      {{select_gb_cols}}\n      1 as id_dbtutils_test_fewer_rows_than,\n      count(*) as count_our_model \n    from {{ model }}\n    {{ groupby_gb_cols }}\n\n),\nb as (\n\n    select \n      {{select_gb_cols}}\n      1 as id_dbtutils_test_fewer_rows_than,\n      count(*) as count_comparison_model \n    from {{ compare_model }}\n    {{ groupby_gb_cols }}\n\n),\ncounts as (\n\n    select\n\n        {% for c in group_by_columns -%}\n          a.{{c}} as {{c}}_a,\n          b.{{c}} as {{c}}_b,\n        {% endfor %}\n\n        count_our_model,\n        count_comparison_model\n    from a\n    full join b on \n    a.id_dbtutils_test_fewer_rows_than = b.id_dbtutils_test_fewer_rows_than\n    {{ join_gb_cols }}\n\n),\nfinal as (\n\n    select *,\n        case\n            -- fail the test if we have more rows than the reference model and return the row count delta\n            when count_our_model > count_comparison_model then (count_our_model - count_comparison_model)\n            -- fail the test if they are the same number\n            when count_our_model = count_comparison_model then 1\n            -- pass the test if the delta is positive (i.e. return the number 0)\n            else 0\n    end as row_count_delta\n    from counts\n\n)\n\nselect * from final\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0335078, "supported_languages": null}, "macro.dbt_utils.test_equality": {"name": "test_equality", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/equality.sql", "original_file_path": "macros/generic_tests/equality.sql", "unique_id": "macro.dbt_utils.test_equality", "macro_sql": "{% test equality(model, compare_model, compare_columns=None, exclude_columns=None, precision = None) %}\n  {{ return(adapter.dispatch('test_equality', 'dbt_utils')(model, compare_model, compare_columns, exclude_columns, precision)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_equality"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0360744, "supported_languages": null}, "macro.dbt_utils.default__test_equality": {"name": "default__test_equality", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/equality.sql", "original_file_path": "macros/generic_tests/equality.sql", "unique_id": "macro.dbt_utils.default__test_equality", "macro_sql": "{% macro default__test_equality(model, compare_model, compare_columns=None, exclude_columns=None, precision = None) %}\n\n{%- if compare_columns and exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\"Both a compare and an ignore list were provided to the `equality` macro. Only one is allowed\") }}\n{%- endif -%}\n\n{% set set_diff %}\n    count(*) + coalesce(abs(\n        sum(case when which_diff = 'a_minus_b' then 1 else 0 end) -\n        sum(case when which_diff = 'b_minus_a' then 1 else 0 end)\n    ), 0)\n{% endset %}\n\n{#-- Needs to be set at parse time, before we return '' below --#}\n{{ config(fail_calc = set_diff) }}\n\n{#-- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. #}\n{%- if not execute -%}\n    {{ return('') }}\n{% endif %}\n\n\n\n-- setup\n{%- do dbt_utils._is_relation(model, 'test_equality') -%}\n\n{# Ensure there are no extra columns in the compare_model vs model #}\n{%- if not compare_columns -%}\n    {%- do dbt_utils._is_ephemeral(model, 'test_equality') -%}\n    {%- do dbt_utils._is_ephemeral(compare_model, 'test_equality') -%}\n\n    {%- set model_columns = adapter.get_columns_in_relation(model) -%}\n    {%- set compare_model_columns = adapter.get_columns_in_relation(compare_model) -%}\n\n\n    {%- if exclude_columns -%}\n        {#-- Lower case ignore columns for easier comparison --#}\n        {%- set exclude_columns = exclude_columns | map(\"lower\") | list %}\n\n        {# Filter out the excluded columns #}\n        {%- set include_columns = [] %}\n        {%- set include_model_columns = [] %}\n        {%- for column in model_columns -%}\n            {%- if column.name | lower not in exclude_columns -%}\n                {% do include_columns.append(column) %}\n            {%- endif %}\n        {%- endfor %}\n        {%- for column in compare_model_columns -%}\n            {%- if column.name | lower not in exclude_columns -%}\n                {% do include_model_columns.append(column) %}\n            {%- endif %}\n        {%- endfor %}\n\n        {%- set compare_columns_set = set(include_columns | map(attribute='quoted') | map(\"lower\")) %}\n        {%- set compare_model_columns_set = set(include_model_columns | map(attribute='quoted') | map(\"lower\")) %}\n    {%- else -%}\n        {%- set compare_columns_set = set(model_columns | map(attribute='quoted') | map(\"lower\")) %}\n        {%- set compare_model_columns_set = set(compare_model_columns | map(attribute='quoted') | map(\"lower\")) %}\n    {%- endif -%}\n\n    {% if compare_columns_set != compare_model_columns_set %}\n        {{ exceptions.raise_compiler_error(compare_model ~\" has less columns than \" ~ model ~ \", please ensure they have the same columns or use the `compare_columns` or `exclude_columns` arguments to subset them.\") }}\n    {% endif %}\n\n\n{% endif %}\n\n{%- if not precision -%}\n    {%- if not compare_columns -%}\n        {# \n            You cannot get the columns in an ephemeral model (due to not existing in the information schema),\n            so if the user does not provide an explicit list of columns we must error in the case it is ephemeral\n        #}\n        {%- do dbt_utils._is_ephemeral(model, 'test_equality') -%}\n        {%- set compare_columns = adapter.get_columns_in_relation(model)-%}\n\n        {%- if exclude_columns -%}\n            {#-- Lower case ignore columns for easier comparison --#}\n            {%- set exclude_columns = exclude_columns | map(\"lower\") | list %}\n\n            {# Filter out the excluded columns #}\n            {%- set include_columns = [] %}\n            {%- for column in compare_columns -%}\n                {%- if column.name | lower not in exclude_columns -%}\n                    {% do include_columns.append(column) %}\n                {%- endif %}\n            {%- endfor %}\n\n            {%- set compare_columns = include_columns | map(attribute='quoted') %}\n        {%- else -%} {# Compare columns provided #}\n            {%- set compare_columns = compare_columns | map(attribute='quoted') %}\n        {%- endif -%}\n    {%- endif -%}\n\n    {% set compare_cols_csv = compare_columns | join(', ') %}\n\n{% else %} {# Precision required #}\n    {#-\n        If rounding is required, we need to get the types, so it cannot be ephemeral even if they provide column names\n    -#}\n    {%- do dbt_utils._is_ephemeral(model, 'test_equality') -%}\n    {%- set columns = adapter.get_columns_in_relation(model) -%}\n\n    {% set columns_list = [] %}\n    {%- for col in columns -%}\n        {%- if (\n                (col.name|lower in compare_columns|map('lower') or not compare_columns) and\n                (col.name|lower not in exclude_columns|map('lower') or not exclude_columns)\n                ) -%}\n            {# Databricks double type is not picked up by any number type checks in dbt #}\n            {%- if col.is_float() or col.is_numeric() or col.data_type == 'double' -%}\n                {# Cast is required due to postgres not having round for a double precision number #}\n                {%- do columns_list.append('round(cast(' ~ col.quoted ~ ' as ' ~ dbt.type_numeric() ~ '),' ~ precision ~ ') as ' ~ col.quoted) -%}\n            {%- else -%} {# Non-numeric type #}\n                {%- do columns_list.append(col.quoted) -%}\n            {%- endif -%}\n        {% endif %}\n    {%- endfor -%}\n\n    {% set compare_cols_csv = columns_list | join(', ') %}\n\n{% endif %}\n\nwith a as (\n\n    select * from {{ model }}\n\n),\n\nb as (\n\n    select * from {{ compare_model }}\n\n),\n\na_minus_b as (\n\n    select {{compare_cols_csv}} from a\n    {{ dbt.except() }}\n    select {{compare_cols_csv}} from b\n\n),\n\nb_minus_a as (\n\n    select {{compare_cols_csv}} from b\n    {{ dbt.except() }}\n    select {{compare_cols_csv}} from a\n\n),\n\nunioned as (\n\n    select 'a_minus_b' as which_diff, a_minus_b.* from a_minus_b\n    union all\n    select 'b_minus_a' as which_diff, b_minus_a.* from b_minus_a\n\n)\n\nselect * from unioned\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral", "macro.dbt.type_numeric", "macro.dbt.except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0431058, "supported_languages": null}, "macro.dbt_utils.test_at_least_one": {"name": "test_at_least_one", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/at_least_one.sql", "original_file_path": "macros/generic_tests/at_least_one.sql", "unique_id": "macro.dbt_utils.test_at_least_one", "macro_sql": "{% test at_least_one(model, column_name, group_by_columns = []) %}\n  {{ return(adapter.dispatch('test_at_least_one', 'dbt_utils')(model, column_name, group_by_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_at_least_one"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0441654, "supported_languages": null}, "macro.dbt_utils.default__test_at_least_one": {"name": "default__test_at_least_one", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/at_least_one.sql", "original_file_path": "macros/generic_tests/at_least_one.sql", "unique_id": "macro.dbt_utils.default__test_at_least_one", "macro_sql": "{% macro default__test_at_least_one(model, column_name, group_by_columns) %}\n\n{% set pruned_cols = [column_name] %}\n\n{% if group_by_columns|length() > 0 %}\n\n  {% set select_gb_cols = group_by_columns|join(' ,') + ', ' %}\n  {% set groupby_gb_cols = 'group by ' + group_by_columns|join(',') %}\n  {% set pruned_cols = group_by_columns %}\n\n  {% if column_name not in pruned_cols %}\n    {% do pruned_cols.append(column_name) %}\n  {% endif %}\n\n{% endif %}\n\n{% set select_pruned_cols = pruned_cols|join(' ,') %}\n\nselect *\nfrom (\n    with pruned_rows as (\n      select\n        {{ select_pruned_cols }}\n      from {{ model }}\n      {% if group_by_columns|length() == 0 %}\n        where {{ column_name }} is not null\n        limit 1\n      {% endif %}\n    )\n    select\n        {# In TSQL, subquery aggregate columns need aliases #}\n        {# thus: a filler col name, 'filler_column' #}\n      {{select_gb_cols}}\n      count({{ column_name }}) as filler_column\n\n    from pruned_rows\n\n    {{groupby_gb_cols}}\n\n    having count({{ column_name }}) = 0\n\n) validation_errors\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0457053, "supported_languages": null}, "macro.dbt_utils.test_not_accepted_values": {"name": "test_not_accepted_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_accepted_values.sql", "original_file_path": "macros/generic_tests/not_accepted_values.sql", "unique_id": "macro.dbt_utils.test_not_accepted_values", "macro_sql": "{% test not_accepted_values(model, column_name, values, quote=True) %}\n  {{ return(adapter.dispatch('test_not_accepted_values', 'dbt_utils')(model, column_name, values, quote)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_not_accepted_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0465446, "supported_languages": null}, "macro.dbt_utils.default__test_not_accepted_values": {"name": "default__test_not_accepted_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/not_accepted_values.sql", "original_file_path": "macros/generic_tests/not_accepted_values.sql", "unique_id": "macro.dbt_utils.default__test_not_accepted_values", "macro_sql": "{% macro default__test_not_accepted_values(model, column_name, values, quote=True) %}\nwith all_values as (\n\n    select distinct\n        {{ column_name }} as value_field\n\n    from {{ model }}\n\n),\n\nvalidation_errors as (\n\n    select\n        value_field\n\n    from all_values\n    where value_field in (\n        {% for value in values -%}\n            {% if quote -%}\n            '{{ value }}'\n            {%- else -%}\n            {{ value }}\n            {%- endif -%}\n            {%- if not loop.last -%},{%- endif %}\n        {%- endfor %}\n        )\n\n)\n\nselect *\nfrom validation_errors\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0472507, "supported_languages": null}, "macro.dbt_utils.test_unique_combination_of_columns": {"name": "test_unique_combination_of_columns", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/unique_combination_of_columns.sql", "original_file_path": "macros/generic_tests/unique_combination_of_columns.sql", "unique_id": "macro.dbt_utils.test_unique_combination_of_columns", "macro_sql": "{% test unique_combination_of_columns(model, combination_of_columns, quote_columns=false) %}\n  {{ return(adapter.dispatch('test_unique_combination_of_columns', 'dbt_utils')(model, combination_of_columns, quote_columns)) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt_utils.default__test_unique_combination_of_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0481744, "supported_languages": null}, "macro.dbt_utils.default__test_unique_combination_of_columns": {"name": "default__test_unique_combination_of_columns", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/generic_tests/unique_combination_of_columns.sql", "original_file_path": "macros/generic_tests/unique_combination_of_columns.sql", "unique_id": "macro.dbt_utils.default__test_unique_combination_of_columns", "macro_sql": "{% macro default__test_unique_combination_of_columns(model, combination_of_columns, quote_columns=false) %}\n\n{% if not quote_columns %}\n    {%- set column_list=combination_of_columns %}\n{% elif quote_columns %}\n    {%- set column_list=[] %}\n        {% for column in combination_of_columns -%}\n            {% set column_list = column_list.append( adapter.quote(column) ) %}\n        {%- endfor %}\n{% else %}\n    {{ exceptions.raise_compiler_error(\n        \"`quote_columns` argument for unique_combination_of_columns test must be one of [True, False] Got: '\" ~ quote ~\"'.'\"\n    ) }}\n{% endif %}\n\n{%- set columns_csv=column_list | join(', ') %}\n\n\nwith validation_errors as (\n\n    select\n        {{ columns_csv }}\n    from {{ model }}\n    group by {{ columns_csv }}\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0493267, "supported_languages": null}, "macro.dbt_utils.get_url_path": {"name": "get_url_path", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_path.sql", "original_file_path": "macros/web/get_url_path.sql", "unique_id": "macro.dbt_utils.get_url_path", "macro_sql": "{% macro get_url_path(field) -%}\n    {{ return(adapter.dispatch('get_url_path', 'dbt_utils')(field)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_url_path"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0500484, "supported_languages": null}, "macro.dbt_utils.default__get_url_path": {"name": "default__get_url_path", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_path.sql", "original_file_path": "macros/web/get_url_path.sql", "unique_id": "macro.dbt_utils.default__get_url_path", "macro_sql": "{% macro default__get_url_path(field) -%}\n\n    {%- set stripped_url =\n        dbt.replace(\n            dbt.replace(field, \"'http://'\", \"''\"), \"'https://'\", \"''\")\n    -%}\n\n    {%- set first_slash_pos -%}\n        coalesce(\n            nullif({{ dbt.position(\"'/'\", stripped_url) }}, 0),\n            {{ dbt.position(\"'?'\", stripped_url) }} - 1\n            )\n    {%- endset -%}\n\n    {%- set parsed_path =\n        dbt.split_part(\n            dbt.right(\n                stripped_url,\n                dbt.length(stripped_url) ~ \"-\" ~ first_slash_pos\n                ),\n            \"'?'\", 1\n            )\n    -%}\n\n    {{ dbt.safe_cast(\n        parsed_path,\n        dbt.type_string()\n    )}}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.replace", "macro.dbt.position", "macro.dbt.split_part", "macro.dbt.right", "macro.dbt.length", "macro.dbt.safe_cast", "macro.dbt.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0511823, "supported_languages": null}, "macro.dbt_utils.get_url_host": {"name": "get_url_host", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_host.sql", "original_file_path": "macros/web/get_url_host.sql", "unique_id": "macro.dbt_utils.get_url_host", "macro_sql": "{% macro get_url_host(field) -%}\n    {{ return(adapter.dispatch('get_url_host', 'dbt_utils')(field)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_url_host"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0518053, "supported_languages": null}, "macro.dbt_utils.default__get_url_host": {"name": "default__get_url_host", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_host.sql", "original_file_path": "macros/web/get_url_host.sql", "unique_id": "macro.dbt_utils.default__get_url_host", "macro_sql": "{% macro default__get_url_host(field) -%}\n\n{%- set parsed =\n    dbt.split_part(\n        dbt.split_part(\n            dbt.replace(\n                dbt.replace(\n                    dbt.replace(field, \"'android-app://'\", \"''\"\n                    ), \"'http://'\", \"''\"\n                ), \"'https://'\", \"''\"\n            ), \"'/'\", 1\n        ), \"'?'\", 1\n    )\n\n-%}\n\n\n    {{ dbt.safe_cast(\n        parsed,\n        dbt.type_string()\n        )}}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.split_part", "macro.dbt.replace", "macro.dbt.safe_cast", "macro.dbt.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.052617, "supported_languages": null}, "macro.dbt_utils.get_url_parameter": {"name": "get_url_parameter", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_parameter.sql", "original_file_path": "macros/web/get_url_parameter.sql", "unique_id": "macro.dbt_utils.get_url_parameter", "macro_sql": "{% macro get_url_parameter(field, url_parameter) -%}\n    {{ return(adapter.dispatch('get_url_parameter', 'dbt_utils')(field, url_parameter)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_url_parameter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0531628, "supported_languages": null}, "macro.dbt_utils.default__get_url_parameter": {"name": "default__get_url_parameter", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/web/get_url_parameter.sql", "original_file_path": "macros/web/get_url_parameter.sql", "unique_id": "macro.dbt_utils.default__get_url_parameter", "macro_sql": "{% macro default__get_url_parameter(field, url_parameter) -%}\n\n{%- set formatted_url_parameter = \"'\" + url_parameter + \"='\" -%}\n\n{%- set split = dbt.split_part(dbt.split_part(field, formatted_url_parameter, 2), \"'&'\", 1) -%}\n\nnullif({{ split }},'')\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.split_part"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0537274, "supported_languages": null}, "macro.dbt_utils.log_info": {"name": "log_info", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/log_info.sql", "original_file_path": "macros/jinja_helpers/log_info.sql", "unique_id": "macro.dbt_utils.log_info", "macro_sql": "{% macro log_info(message) %}\n    {{ return(adapter.dispatch('log_info', 'dbt_utils')(message)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__log_info"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.054174, "supported_languages": null}, "macro.dbt_utils.default__log_info": {"name": "default__log_info", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/log_info.sql", "original_file_path": "macros/jinja_helpers/log_info.sql", "unique_id": "macro.dbt_utils.default__log_info", "macro_sql": "{% macro default__log_info(message) %}\n    {{ log(dbt_utils.pretty_log_format(message), info=True) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.pretty_log_format"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0544872, "supported_languages": null}, "macro.dbt_utils.pretty_log_format": {"name": "pretty_log_format", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/pretty_log_format.sql", "original_file_path": "macros/jinja_helpers/pretty_log_format.sql", "unique_id": "macro.dbt_utils.pretty_log_format", "macro_sql": "{% macro pretty_log_format(message) %}\n    {{ return(adapter.dispatch('pretty_log_format', 'dbt_utils')(message)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__pretty_log_format"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0549896, "supported_languages": null}, "macro.dbt_utils.default__pretty_log_format": {"name": "default__pretty_log_format", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/pretty_log_format.sql", "original_file_path": "macros/jinja_helpers/pretty_log_format.sql", "unique_id": "macro.dbt_utils.default__pretty_log_format", "macro_sql": "{% macro default__pretty_log_format(message) %}\n    {{ return( dbt_utils.pretty_time() ~ ' + ' ~ message) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.pretty_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0552979, "supported_languages": null}, "macro.dbt_utils._is_ephemeral": {"name": "_is_ephemeral", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/_is_ephemeral.sql", "original_file_path": "macros/jinja_helpers/_is_ephemeral.sql", "unique_id": "macro.dbt_utils._is_ephemeral", "macro_sql": "{% macro _is_ephemeral(obj, macro) %}\n    {%- if obj.is_cte -%}\n        {% set ephemeral_prefix = api.Relation.add_ephemeral_prefix('') %}\n        {% if obj.name.startswith(ephemeral_prefix) %}\n            {% set model_name = obj.name[(ephemeral_prefix|length):] %}\n        {% else %}\n            {% set model_name = obj.name %}\n        {%- endif -%}\n        {% set error_message %}\nThe `{{ macro }}` macro cannot be used with ephemeral models, as it relies on the information schema.\n\n`{{ model_name }}` is an ephemeral model. Consider making it a view or table instead.\n        {% endset %}\n        {%- do exceptions.raise_compiler_error(error_message) -%}\n    {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0567105, "supported_languages": null}, "macro.dbt_utils.pretty_time": {"name": "pretty_time", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/pretty_time.sql", "original_file_path": "macros/jinja_helpers/pretty_time.sql", "unique_id": "macro.dbt_utils.pretty_time", "macro_sql": "{% macro pretty_time(format='%H:%M:%S') %}\n    {{ return(adapter.dispatch('pretty_time', 'dbt_utils')(format)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__pretty_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0571969, "supported_languages": null}, "macro.dbt_utils.default__pretty_time": {"name": "default__pretty_time", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/pretty_time.sql", "original_file_path": "macros/jinja_helpers/pretty_time.sql", "unique_id": "macro.dbt_utils.default__pretty_time", "macro_sql": "{% macro default__pretty_time(format='%H:%M:%S') %}\n    {{ return(modules.datetime.datetime.now().strftime(format)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0575418, "supported_languages": null}, "macro.dbt_utils._is_relation": {"name": "_is_relation", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/_is_relation.sql", "original_file_path": "macros/jinja_helpers/_is_relation.sql", "unique_id": "macro.dbt_utils._is_relation", "macro_sql": "{% macro _is_relation(obj, macro) %}\n    {%- if not (obj is mapping and obj.get('metadata', {}).get('type', '').endswith('Relation')) -%}\n        {%- do exceptions.raise_compiler_error(\"Macro \" ~ macro ~ \" expected a Relation but received the value: \" ~ obj) -%}\n    {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0582879, "supported_languages": null}, "macro.dbt_utils.slugify": {"name": "slugify", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/jinja_helpers/slugify.sql", "original_file_path": "macros/jinja_helpers/slugify.sql", "unique_id": "macro.dbt_utils.slugify", "macro_sql": "{% macro slugify(string) %}\n\n{% if not string %}\n{{ return('') }}\n{% endif %}\n\n{#- Lower case the string -#}\n{% set string = string | lower %}\n{#- Replace spaces and dashes with underscores -#}\n{% set string = modules.re.sub('[ -]+', '_', string) %}\n{#- Only take letters, numbers, and underscores -#}\n{% set string = modules.re.sub('[^a-z0-9_]+', '', string) %}\n{#- Prepends \"_\" if string begins with a number -#}\n{% set string = modules.re.sub('^[0-9]', '_' + string[0], string) %}\n\n{{ return(string) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0595648, "supported_languages": null}, "macro.dbt_utils.group_by": {"name": "group_by", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/groupby.sql", "original_file_path": "macros/sql/groupby.sql", "unique_id": "macro.dbt_utils.group_by", "macro_sql": "{%- macro group_by(n) -%}\n    {{ return(adapter.dispatch('group_by', 'dbt_utils')(n)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__group_by"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0600722, "supported_languages": null}, "macro.dbt_utils.default__group_by": {"name": "default__group_by", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/groupby.sql", "original_file_path": "macros/sql/groupby.sql", "unique_id": "macro.dbt_utils.default__group_by", "macro_sql": "\n\n{%- macro default__group_by(n) -%}\n\n  group by {% for i in range(1, n + 1) -%}\n      {{ i }}{{ ',' if not loop.last }}   \n   {%- endfor -%}\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0605268, "supported_languages": null}, "macro.dbt_utils.union_relations": {"name": "union_relations", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/union.sql", "original_file_path": "macros/sql/union.sql", "unique_id": "macro.dbt_utils.union_relations", "macro_sql": "{%- macro union_relations(relations, column_override=none, include=[], exclude=[], source_column_name='_dbt_source_relation', where=none) -%}\n    {{ return(adapter.dispatch('union_relations', 'dbt_utils')(relations, column_override, include, exclude, source_column_name, where)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__union_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0644305, "supported_languages": null}, "macro.dbt_utils.default__union_relations": {"name": "default__union_relations", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/union.sql", "original_file_path": "macros/sql/union.sql", "unique_id": "macro.dbt_utils.default__union_relations", "macro_sql": "\n\n{%- macro default__union_relations(relations, column_override=none, include=[], exclude=[], source_column_name='_dbt_source_relation', where=none) -%}\n\n    {%- if exclude and include -%}\n        {{ exceptions.raise_compiler_error(\"Both an exclude and include list were provided to the `union` macro. Only one is allowed\") }}\n    {%- endif -%}\n\n    {#-- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. -#}\n    {%- if not execute %}\n        {{ return('') }}\n    {% endif -%}\n\n    {%- set column_override = column_override if column_override is not none else {} -%}\n\n    {%- set relation_columns = {} -%}\n    {%- set column_superset = {} -%}\n    {%- set all_excludes = [] -%}\n    {%- set all_includes = [] -%}\n\n    {%- if exclude -%}\n        {%- for exc in exclude -%}\n            {%- do all_excludes.append(exc | lower) -%}\n        {%- endfor -%}\n    {%- endif -%}\n\n    {%- if include -%}\n        {%- for inc in include -%}\n            {%- do all_includes.append(inc | lower) -%}\n        {%- endfor -%}\n    {%- endif -%}\n\n    {%- for relation in relations -%}\n\n        {%- do relation_columns.update({relation: []}) -%}\n\n        {%- do dbt_utils._is_relation(relation, 'union_relations') -%}\n        {%- do dbt_utils._is_ephemeral(relation, 'union_relations') -%}\n        {%- set cols = adapter.get_columns_in_relation(relation) -%}\n        {%- for col in cols -%}\n\n        {#- If an exclude list was provided and the column is in the list, do nothing -#}\n        {%- if exclude and col.column | lower in all_excludes -%}\n\n        {#- If an include list was provided and the column is not in the list, do nothing -#}\n        {%- elif include and col.column | lower not in all_includes -%}\n\n        {#- Otherwise add the column to the column superset -#}\n        {%- else -%}\n\n            {#- update the list of columns in this relation -#}\n            {%- do relation_columns[relation].append(col.column) -%}\n\n            {%- if col.column in column_superset -%}\n\n                {%- set stored = column_superset[col.column] -%}\n                {%- if col.is_string() and stored.is_string() and col.string_size() > stored.string_size() -%}\n\n                    {%- do column_superset.update({col.column: col}) -%}\n\n                {%- endif %}\n\n            {%- else -%}\n\n                {%- do column_superset.update({col.column: col}) -%}\n\n            {%- endif -%}\n\n        {%- endif -%}\n\n        {%- endfor -%}\n    {%- endfor -%}\n\n    {%- set ordered_column_names = column_superset.keys() -%}\n    {%- set dbt_command = flags.WHICH -%}\n\n\n    {% if dbt_command in ['run', 'build'] %}\n    {% if (include | length > 0 or exclude | length > 0) and not column_superset.keys() %}\n        {%- set relations_string -%}\n            {%- for relation in relations -%}\n                {{ relation.name }}\n            {%- if not loop.last %}, {% endif -%}\n            {%- endfor -%}\n        {%- endset -%}\n\n        {%- set error_message -%}\n            There were no columns found to union for relations {{ relations_string }}\n        {%- endset -%}\n\n        {{ exceptions.raise_compiler_error(error_message) }}\n    {%- endif -%}\n    {%- endif -%}\n\n    {%- for relation in relations %}\n\n        (\n            select\n\n                {%- if source_column_name is not none %}\n                cast({{ dbt.string_literal(relation) }} as {{ dbt.type_string() }}) as {{ source_column_name }},\n                {%- endif %}\n\n                {% for col_name in ordered_column_names -%}\n\n                    {%- set col = column_superset[col_name] %}\n                    {%- set col_type = column_override.get(col.column, col.data_type) %}\n                    {%- set col_name = adapter.quote(col_name) if col_name in relation_columns[relation] else 'null' %}\n                    cast({{ col_name }} as {{ col_type }}) as {{ col.quoted }} {% if not loop.last %},{% endif -%}\n\n                {%- endfor %}\n\n            from {{ relation }}\n\n            {% if where -%}\n            where {{ where }}\n            {%- endif %}\n        )\n\n        {% if not loop.last -%}\n            union all\n        {% endif -%}\n\n    {%- endfor -%}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral", "macro.dbt.string_literal", "macro.dbt.type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0731344, "supported_languages": null}, "macro.dbt_utils.get_tables_by_prefix_sql": {"name": "get_tables_by_prefix_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_prefix_sql.sql", "original_file_path": "macros/sql/get_tables_by_prefix_sql.sql", "unique_id": "macro.dbt_utils.get_tables_by_prefix_sql", "macro_sql": "{% macro get_tables_by_prefix_sql(schema, prefix, exclude='', database=target.database) %}\n    {{ return(adapter.dispatch('get_tables_by_prefix_sql', 'dbt_utils')(schema, prefix, exclude, database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_tables_by_prefix_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0742607, "supported_languages": null}, "macro.dbt_utils.default__get_tables_by_prefix_sql": {"name": "default__get_tables_by_prefix_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_prefix_sql.sql", "original_file_path": "macros/sql/get_tables_by_prefix_sql.sql", "unique_id": "macro.dbt_utils.default__get_tables_by_prefix_sql", "macro_sql": "{% macro default__get_tables_by_prefix_sql(schema, prefix, exclude='', database=target.database) %}\n\n    {{ dbt_utils.get_tables_by_pattern_sql(\n        schema_pattern = schema,\n        table_pattern = prefix ~ '%',\n        exclude = exclude,\n        database = database\n    ) }}\n    \n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_tables_by_pattern_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.075025, "supported_languages": null}, "macro.dbt_utils.pivot": {"name": "pivot", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/pivot.sql", "original_file_path": "macros/sql/pivot.sql", "unique_id": "macro.dbt_utils.pivot", "macro_sql": "{% macro pivot(column,\n               values,\n               alias=True,\n               agg='sum',\n               cmp='=',\n               prefix='',\n               suffix='',\n               then_value=1,\n               else_value=0,\n               quote_identifiers=True,\n               distinct=False) %}\n    {{ return(adapter.dispatch('pivot', 'dbt_utils')(column, values, alias, agg, cmp, prefix, suffix, then_value, else_value, quote_identifiers, distinct)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__pivot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0768678, "supported_languages": null}, "macro.dbt_utils.default__pivot": {"name": "default__pivot", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/pivot.sql", "original_file_path": "macros/sql/pivot.sql", "unique_id": "macro.dbt_utils.default__pivot", "macro_sql": "{% macro default__pivot(column,\n               values,\n               alias=True,\n               agg='sum',\n               cmp='=',\n               prefix='',\n               suffix='',\n               then_value=1,\n               else_value=0,\n               quote_identifiers=True,\n               distinct=False) %}\n  {% for value in values %}\n    {{ agg }}(\n      {% if distinct %} distinct {% endif %}\n      case\n      when {{ column }} {{ cmp }} '{{ dbt.escape_single_quotes(value) }}'\n        then {{ then_value }}\n      else {{ else_value }}\n      end\n    )\n    {% if alias %}\n      {% if quote_identifiers %}\n            as {{ adapter.quote(prefix ~ value ~ suffix) }}\n      {% else %}\n        as {{ dbt_utils.slugify(prefix ~ value ~ suffix) }}\n      {% endif %}\n    {% endif %}\n    {% if not loop.last %},{% endif %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.escape_single_quotes", "macro.dbt_utils.slugify"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0783298, "supported_languages": null}, "macro.dbt_utils.get_intervals_between": {"name": "get_intervals_between", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/date_spine.sql", "original_file_path": "macros/sql/date_spine.sql", "unique_id": "macro.dbt_utils.get_intervals_between", "macro_sql": "{% macro get_intervals_between(start_date, end_date, datepart) -%}\n    {{ return(adapter.dispatch('get_intervals_between', 'dbt_utils')(start_date, end_date, datepart)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_intervals_between"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0794425, "supported_languages": null}, "macro.dbt_utils.default__get_intervals_between": {"name": "default__get_intervals_between", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/date_spine.sql", "original_file_path": "macros/sql/date_spine.sql", "unique_id": "macro.dbt_utils.default__get_intervals_between", "macro_sql": "{% macro default__get_intervals_between(start_date, end_date, datepart) -%}\n    {%- call statement('get_intervals_between', fetch_result=True) %}\n\n        select {{ dbt.datediff(start_date, end_date, datepart) }}\n\n    {%- endcall -%}\n\n    {%- set value_list = load_result('get_intervals_between') -%}\n\n    {%- if value_list and value_list['data'] -%}\n        {%- set values = value_list['data'] | map(attribute=0) | list %}\n        {{ return(values[0]) }}\n    {%- else -%}\n        {{ return(1) }}\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.080511, "supported_languages": null}, "macro.dbt_utils.date_spine": {"name": "date_spine", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/date_spine.sql", "original_file_path": "macros/sql/date_spine.sql", "unique_id": "macro.dbt_utils.date_spine", "macro_sql": "{% macro date_spine(datepart, start_date, end_date) %}\n    {{ return(adapter.dispatch('date_spine', 'dbt_utils')(datepart, start_date, end_date)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__date_spine"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.080937, "supported_languages": null}, "macro.dbt_utils.default__date_spine": {"name": "default__date_spine", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/date_spine.sql", "original_file_path": "macros/sql/date_spine.sql", "unique_id": "macro.dbt_utils.default__date_spine", "macro_sql": "{% macro default__date_spine(datepart, start_date, end_date) %}\n\n\n{# call as follows:\n\ndate_spine(\n    \"day\",\n    \"to_date('01/01/2016', 'mm/dd/yyyy')\",\n    \"dbt.dateadd(week, 1, current_date)\"\n) #}\n\n\nwith rawdata as (\n\n    {{dbt_utils.generate_series(\n        dbt_utils.get_intervals_between(start_date, end_date, datepart)\n    )}}\n\n),\n\nall_periods as (\n\n    select (\n        {{\n            dbt.dateadd(\n                datepart,\n                \"row_number() over (order by 1) - 1\",\n                start_date\n            )\n        }}\n    ) as date_{{datepart}}\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_{{datepart}} <= {{ end_date }}\n\n)\n\nselect * from filtered\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.generate_series", "macro.dbt_utils.get_intervals_between", "macro.dbt.dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0815654, "supported_languages": null}, "macro.dbt_utils.unpivot": {"name": "unpivot", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/unpivot.sql", "original_file_path": "macros/sql/unpivot.sql", "unique_id": "macro.dbt_utils.unpivot", "macro_sql": "{% macro unpivot(relation=none, cast_to='varchar', exclude=none, remove=none, field_name='field_name', value_name='value', quote_identifiers=False) -%}\n    {{ return(adapter.dispatch('unpivot', 'dbt_utils')(relation, cast_to, exclude, remove, field_name, value_name, quote_identifiers)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__unpivot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.083598, "supported_languages": null}, "macro.dbt_utils.default__unpivot": {"name": "default__unpivot", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/unpivot.sql", "original_file_path": "macros/sql/unpivot.sql", "unique_id": "macro.dbt_utils.default__unpivot", "macro_sql": "{% macro default__unpivot(relation=none, cast_to='varchar', exclude=none, remove=none, field_name='field_name', value_name='value', quote_identifiers=False) -%}\n\n    {% if not relation %}\n        {{ exceptions.raise_compiler_error(\"Error: argument `relation` is required for `unpivot` macro.\") }}\n    {% endif %}\n\n  {%- set exclude = exclude if exclude is not none else [] %}\n  {%- set remove = remove if remove is not none else [] %}\n\n  {%- set include_cols = [] %}\n\n  {%- set table_columns = {} %}\n\n  {%- do table_columns.update({relation: []}) %}\n\n  {%- do dbt_utils._is_relation(relation, 'unpivot') -%}\n  {%- do dbt_utils._is_ephemeral(relation, 'unpivot') -%}\n  {%- set cols = adapter.get_columns_in_relation(relation) %}\n\n  {%- for col in cols -%}\n    {%- if col.column.lower() not in remove|map('lower') and col.column.lower() not in exclude|map('lower') -%}\n      {% do include_cols.append(col) %}\n    {%- endif %}\n  {%- endfor %}\n\n\n  {%- for col in include_cols -%}\n    {%- set current_col_name = adapter.quote(col.column) if quote_identifiers else col.column -%}\n    select\n      {%- for exclude_col in exclude %}\n        {{ adapter.quote(exclude_col) if quote_identifiers else exclude_col }},\n      {%- endfor %}\n\n      cast('{{ col.column }}' as {{ dbt.type_string() }}) as {{ adapter.quote(field_name) if quote_identifiers else field_name  }},\n      cast(  {% if col.data_type == 'boolean' %}\n           {{ dbt.cast_bool_to_text(current_col_name) }}\n             {% else %}\n           {{ current_col_name }}\n             {% endif %}\n           as {{ cast_to }}) as {{ adapter.quote(value_name) if quote_identifiers else value_name }}\n\n    from {{ relation }}\n\n    {% if not loop.last -%}\n      union all\n    {% endif -%}\n  {%- endfor -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral", "macro.dbt.type_string", "macro.dbt.cast_bool_to_text"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0873427, "supported_languages": null}, "macro.dbt_utils.degrees_to_radians": {"name": "degrees_to_radians", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/haversine_distance.sql", "original_file_path": "macros/sql/haversine_distance.sql", "unique_id": "macro.dbt_utils.degrees_to_radians", "macro_sql": "{% macro degrees_to_radians(degrees) -%}\n    acos(-1) * {{degrees}} / 180\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0888014, "supported_languages": null}, "macro.dbt_utils.haversine_distance": {"name": "haversine_distance", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/haversine_distance.sql", "original_file_path": "macros/sql/haversine_distance.sql", "unique_id": "macro.dbt_utils.haversine_distance", "macro_sql": "{% macro haversine_distance(lat1, lon1, lat2, lon2, unit='mi') -%}\n    {{ return(adapter.dispatch('haversine_distance', 'dbt_utils')(lat1,lon1,lat2,lon2,unit)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.bigquery__haversine_distance"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.089304, "supported_languages": null}, "macro.dbt_utils.default__haversine_distance": {"name": "default__haversine_distance", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/haversine_distance.sql", "original_file_path": "macros/sql/haversine_distance.sql", "unique_id": "macro.dbt_utils.default__haversine_distance", "macro_sql": "{% macro default__haversine_distance(lat1, lon1, lat2, lon2, unit='mi') -%}\n{%- if unit == 'mi' %}\n    {% set conversion_rate = 1 %}\n{% elif unit == 'km' %}\n    {% set conversion_rate = 1.60934 %}\n{% else %}\n    {{ exceptions.raise_compiler_error(\"unit input must be one of 'mi' or 'km'. Got \" ~ unit) }}\n{% endif %}\n\n    2 * 3961 * asin(sqrt(power((sin(radians(({{ lat2 }} - {{ lat1 }}) / 2))), 2) +\n    cos(radians({{lat1}})) * cos(radians({{lat2}})) *\n    power((sin(radians(({{ lon2 }} - {{ lon1 }}) / 2))), 2))) * {{ conversion_rate }}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.090315, "supported_languages": null}, "macro.dbt_utils.bigquery__haversine_distance": {"name": "bigquery__haversine_distance", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/haversine_distance.sql", "original_file_path": "macros/sql/haversine_distance.sql", "unique_id": "macro.dbt_utils.bigquery__haversine_distance", "macro_sql": "{% macro bigquery__haversine_distance(lat1, lon1, lat2, lon2, unit='mi') -%}\n{% set radians_lat1 = dbt_utils.degrees_to_radians(lat1) %}\n{% set radians_lat2 = dbt_utils.degrees_to_radians(lat2) %}\n{% set radians_lon1 = dbt_utils.degrees_to_radians(lon1) %}\n{% set radians_lon2 = dbt_utils.degrees_to_radians(lon2) %}\n{%- if unit == 'mi' %}\n    {% set conversion_rate = 1 %}\n{% elif unit == 'km' %}\n    {% set conversion_rate = 1.60934 %}\n{% else %}\n    {{ exceptions.raise_compiler_error(\"unit input must be one of 'mi' or 'km'. Got \" ~ unit) }}\n{% endif %}\n    2 * 3961 * asin(sqrt(power(sin(({{ radians_lat2 }} - {{ radians_lat1 }}) / 2), 2) +\n    cos({{ radians_lat1 }}) * cos({{ radians_lat2 }}) *\n    power(sin(({{ radians_lon2 }} - {{ radians_lon1 }}) / 2), 2))) * {{ conversion_rate }}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.degrees_to_radians"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0918045, "supported_languages": null}, "macro.dbt_utils.deduplicate": {"name": "deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.deduplicate", "macro_sql": "{%- macro deduplicate(relation, partition_by, order_by) -%}\n    {{ return(adapter.dispatch('deduplicate', 'dbt_utils')(relation, partition_by, order_by)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.bigquery__deduplicate"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0930874, "supported_languages": null}, "macro.dbt_utils.default__deduplicate": {"name": "default__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.default__deduplicate", "macro_sql": "\n\n{%- macro default__deduplicate(relation, partition_by, order_by) -%}\n\n    with row_numbered as (\n        select\n            _inner.*,\n            row_number() over (\n                partition by {{ partition_by }}\n                order by {{ order_by }}\n            ) as rn\n        from {{ relation }} as _inner\n    )\n\n    select\n        distinct data.*\n    from {{ relation }} as data\n    {#\n    -- Not all DBs will support natural joins but the ones that do include:\n    -- Oracle, MySQL, SQLite, Redshift, Teradata, Materialize, Databricks\n    -- Apache Spark, SingleStore, Vertica\n    -- Those that do not appear to support natural joins include:\n    -- SQLServer, Trino, Presto, Rockset, Athena\n    #}\n    natural join row_numbered\n    where row_numbered.rn = 1\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.093476, "supported_languages": null}, "macro.dbt_utils.redshift__deduplicate": {"name": "redshift__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.redshift__deduplicate", "macro_sql": "{% macro redshift__deduplicate(relation, partition_by, order_by) -%}\n\n    select *\n    from {{ relation }} as tt\n    qualify\n        row_number() over (\n            partition by {{ partition_by }}\n            order by {{ order_by }}\n        ) = 1\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0937831, "supported_languages": null}, "macro.dbt_utils.postgres__deduplicate": {"name": "postgres__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.postgres__deduplicate", "macro_sql": "\n{%- macro postgres__deduplicate(relation, partition_by, order_by) -%}\n\n    select\n        distinct on ({{ partition_by }}) *\n    from {{ relation }}\n    order by {{ partition_by }}{{ ',' ~ order_by }}\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0941293, "supported_languages": null}, "macro.dbt_utils.snowflake__deduplicate": {"name": "snowflake__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.snowflake__deduplicate", "macro_sql": "\n{%- macro snowflake__deduplicate(relation, partition_by, order_by) -%}\n\n    select *\n    from {{ relation }}\n    qualify\n        row_number() over (\n            partition by {{ partition_by }}\n            order by {{ order_by }}\n        ) = 1\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0944312, "supported_languages": null}, "macro.dbt_utils.databricks__deduplicate": {"name": "databricks__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.databricks__deduplicate", "macro_sql": "\n{%- macro databricks__deduplicate(relation, partition_by, order_by) -%}\n\n    select *\n    from {{ relation }}\n    qualify\n        row_number() over (\n            partition by {{ partition_by }}\n            order by {{ order_by }}\n        ) = 1\n\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.094731, "supported_languages": null}, "macro.dbt_utils.bigquery__deduplicate": {"name": "bigquery__deduplicate", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/deduplicate.sql", "original_file_path": "macros/sql/deduplicate.sql", "unique_id": "macro.dbt_utils.bigquery__deduplicate", "macro_sql": "\n{%- macro bigquery__deduplicate(relation, partition_by, order_by) -%}\n\n    select unique.*\n    from (\n        select\n            array_agg (\n                original\n                order by {{ order_by }}\n                limit 1\n            )[offset(0)] unique\n        from {{ relation }} original\n        group by {{ partition_by }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0950403, "supported_languages": null}, "macro.dbt_utils.safe_divide": {"name": "safe_divide", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_divide.sql", "original_file_path": "macros/sql/safe_divide.sql", "unique_id": "macro.dbt_utils.safe_divide", "macro_sql": "{% macro safe_divide(numerator, denominator) -%}\n  {{ return(adapter.dispatch('safe_divide', 'dbt_utils')(numerator, denominator)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__safe_divide"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.09558, "supported_languages": null}, "macro.dbt_utils.default__safe_divide": {"name": "default__safe_divide", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_divide.sql", "original_file_path": "macros/sql/safe_divide.sql", "unique_id": "macro.dbt_utils.default__safe_divide", "macro_sql": "{% macro default__safe_divide(numerator, denominator) %}\n    ( {{ numerator }} ) / nullif( ( {{ denominator }} ), 0)\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.0958364, "supported_languages": null}, "macro.dbt_utils.get_column_values": {"name": "get_column_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_column_values.sql", "original_file_path": "macros/sql/get_column_values.sql", "unique_id": "macro.dbt_utils.get_column_values", "macro_sql": "{% macro get_column_values(table, column, order_by='count(*) desc', max_records=none, default=none, where=none) -%}\n    {{ return(adapter.dispatch('get_column_values', 'dbt_utils')(table, column, order_by, max_records, default, where)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_column_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.097384, "supported_languages": null}, "macro.dbt_utils.default__get_column_values": {"name": "default__get_column_values", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_column_values.sql", "original_file_path": "macros/sql/get_column_values.sql", "unique_id": "macro.dbt_utils.default__get_column_values", "macro_sql": "{% macro default__get_column_values(table, column, order_by='count(*) desc', max_records=none, default=none, where=none) -%}\n    {#-- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. #}\n    {%- if not execute -%}\n        {% set default = [] if not default %}\n        {{ return(default) }}\n    {% endif %}\n\n    {%- do dbt_utils._is_ephemeral(table, 'get_column_values') -%}\n\n    {# Not all relations are tables. Renaming for internal clarity without breaking functionality for anyone using named arguments #}\n    {# TODO: Change the method signature in a future 0.x.0 release #}\n    {%- set target_relation = table -%}\n\n    {# adapter.load_relation is a convenience wrapper to avoid building a Relation when we already have one #}\n    {% set relation_exists = (load_relation(target_relation)) is not none %}\n\n    {%- call statement('get_column_values', fetch_result=true) %}\n\n        {%- if not relation_exists and default is none -%}\n\n          {{ exceptions.raise_compiler_error(\"In get_column_values(): relation \" ~ target_relation ~ \" does not exist and no default value was provided.\") }}\n\n        {%- elif not relation_exists and default is not none -%}\n\n          {{ log(\"Relation \" ~ target_relation ~ \" does not exist. Returning the default value: \" ~ default) }}\n\n          {{ return(default) }}\n\n        {%- else -%}\n\n\n            select\n                {{ column }} as value\n\n            from {{ target_relation }}\n\n            {% if where is not none %}\n            where {{ where }}\n            {% endif %}\n\n            group by {{ column }}\n            order by {{ order_by }}\n\n            {% if max_records is not none %}\n            limit {{ max_records }}\n            {% endif %}\n\n        {% endif %}\n\n    {%- endcall -%}\n\n    {%- set value_list = load_result('get_column_values') -%}\n\n    {%- if value_list and value_list['data'] -%}\n        {%- set values = value_list['data'] | map(attribute=0) | list %}\n        {{ return(values) }}\n    {%- else -%}\n        {{ return(default) }}\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_ephemeral", "macro.dbt.load_relation", "macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1001668, "supported_languages": null}, "macro.dbt_utils.get_tables_by_pattern_sql": {"name": "get_tables_by_pattern_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_pattern_sql.sql", "original_file_path": "macros/sql/get_tables_by_pattern_sql.sql", "unique_id": "macro.dbt_utils.get_tables_by_pattern_sql", "macro_sql": "{% macro get_tables_by_pattern_sql(schema_pattern, table_pattern, exclude='', database=target.database) %}\n    {{ return(adapter.dispatch('get_tables_by_pattern_sql', 'dbt_utils')\n        (schema_pattern, table_pattern, exclude, database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.bigquery__get_tables_by_pattern_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.104136, "supported_languages": null}, "macro.dbt_utils.default__get_tables_by_pattern_sql": {"name": "default__get_tables_by_pattern_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_pattern_sql.sql", "original_file_path": "macros/sql/get_tables_by_pattern_sql.sql", "unique_id": "macro.dbt_utils.default__get_tables_by_pattern_sql", "macro_sql": "{% macro default__get_tables_by_pattern_sql(schema_pattern, table_pattern, exclude='', database=target.database) %}\n\n        select distinct\n            table_schema as {{ adapter.quote('table_schema') }},\n            table_name as {{ adapter.quote('table_name') }},\n            {{ dbt_utils.get_table_types_sql() }}\n        from {{ database }}.information_schema.tables\n        where table_schema ilike '{{ schema_pattern }}'\n        and table_name ilike '{{ table_pattern }}'\n        and table_name not ilike '{{ exclude }}'\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_table_types_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1048234, "supported_languages": null}, "macro.dbt_utils.redshift__get_tables_by_pattern_sql": {"name": "redshift__get_tables_by_pattern_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_pattern_sql.sql", "original_file_path": "macros/sql/get_tables_by_pattern_sql.sql", "unique_id": "macro.dbt_utils.redshift__get_tables_by_pattern_sql", "macro_sql": "{% macro redshift__get_tables_by_pattern_sql(schema_pattern, table_pattern, exclude='', database=target.database) %}\n\n    {% set sql %}\n        select distinct\n            table_schema as {{ adapter.quote('table_schema') }},\n            table_name as {{ adapter.quote('table_name') }},\n            {{ dbt_utils.get_table_types_sql() }}\n        from \"{{ database }}\".\"information_schema\".\"tables\"\n        where table_schema ilike '{{ schema_pattern }}'\n        and table_name ilike '{{ table_pattern }}'\n        and table_name not ilike '{{ exclude }}'\n        union all\n        select distinct\n            schemaname as {{ adapter.quote('table_schema') }},\n            tablename as {{ adapter.quote('table_name') }},\n            'external' as {{ adapter.quote('table_type') }}\n        from svv_external_tables\n        where redshift_database_name = '{{ database }}'\n        and schemaname ilike '{{ schema_pattern }}'\n        and table_name ilike '{{ table_pattern }}'\n        and table_name not ilike '{{ exclude }}'\n    {% endset %}\n\n    {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_table_types_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1060352, "supported_languages": null}, "macro.dbt_utils.bigquery__get_tables_by_pattern_sql": {"name": "bigquery__get_tables_by_pattern_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_pattern_sql.sql", "original_file_path": "macros/sql/get_tables_by_pattern_sql.sql", "unique_id": "macro.dbt_utils.bigquery__get_tables_by_pattern_sql", "macro_sql": "{% macro bigquery__get_tables_by_pattern_sql(schema_pattern, table_pattern, exclude='', database=target.database) %}\n\n    {% if '%' in schema_pattern %}\n        {% set schemata=dbt_utils._bigquery__get_matching_schemata(schema_pattern, database) %}\n    {% else %}\n        {% set schemata=[schema_pattern] %}\n    {% endif %}\n\n    {% set sql %}\n        {% for schema in schemata %}\n            select distinct\n                table_schema,\n                table_name,\n                {{ dbt_utils.get_table_types_sql() }}\n\n            from {{ adapter.quote(database) }}.{{ schema }}.INFORMATION_SCHEMA.TABLES\n            where lower(table_name) like lower ('{{ table_pattern }}')\n                and lower(table_name) not like lower ('{{ exclude }}')\n\n            {% if not loop.last %} union all {% endif %}\n\n        {% endfor %}\n    {% endset %}\n\n    {{ return(sql) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._bigquery__get_matching_schemata", "macro.dbt_utils.get_table_types_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1073275, "supported_languages": null}, "macro.dbt_utils._bigquery__get_matching_schemata": {"name": "_bigquery__get_matching_schemata", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_tables_by_pattern_sql.sql", "original_file_path": "macros/sql/get_tables_by_pattern_sql.sql", "unique_id": "macro.dbt_utils._bigquery__get_matching_schemata", "macro_sql": "{% macro _bigquery__get_matching_schemata(schema_pattern, database) %}\n    {% if execute %}\n\n        {% set sql %}\n        select schema_name from {{ adapter.quote(database) }}.INFORMATION_SCHEMA.SCHEMATA\n        where lower(schema_name) like lower('{{ schema_pattern }}')\n        {% endset %}\n\n        {% set results=run_query(sql) %}\n\n        {% set schemata=results.columns['schema_name'].values() %}\n\n        {{ return(schemata) }}\n\n    {% else %}\n\n        {{ return([]) }}\n\n    {% endif %}\n\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1082497, "supported_languages": null}, "macro.dbt_utils.star": {"name": "star", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/star.sql", "original_file_path": "macros/sql/star.sql", "unique_id": "macro.dbt_utils.star", "macro_sql": "{% macro star(from, relation_alias=False, except=[], prefix='', suffix='', quote_identifiers=True) -%}\r\n    {{ return(adapter.dispatch('star', 'dbt_utils')(from, relation_alias, except, prefix, suffix, quote_identifiers)) }}\r\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__star"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1099463, "supported_languages": null}, "macro.dbt_utils.default__star": {"name": "default__star", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/star.sql", "original_file_path": "macros/sql/star.sql", "unique_id": "macro.dbt_utils.default__star", "macro_sql": "{% macro default__star(from, relation_alias=False, except=[], prefix='', suffix='', quote_identifiers=True) -%}\r\n    {%- do dbt_utils._is_relation(from, 'star') -%}\r\n    {%- do dbt_utils._is_ephemeral(from, 'star') -%}\r\n\r\n    {#-- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. #}\r\n    {%- if not execute -%}\r\n        {% do return('*') %}\r\n    {%- endif -%}\r\n\r\n    {% set cols = dbt_utils.get_filtered_columns_in_relation(from, except) %}\r\n\r\n    {%- if cols|length <= 0 -%}\r\n        {% if flags.WHICH == 'compile' %}\r\n            {% set response %}\r\n*\r\n/* No columns were returned. Maybe the relation doesn't exist yet \r\nor all columns were excluded. This star is only output during  \r\ndbt compile, and exists to keep SQLFluff happy. */\r\n            {% endset %}\r\n            {% do return(response) %}\r\n        {% else %}\r\n            {% do return(\"/* no columns returned from star() macro */\") %}\r\n        {% endif %}\r\n    {%- else -%}\r\n        {%- for col in cols %}\r\n            {%- if relation_alias %}{{ relation_alias }}.{% else %}{%- endif -%}\r\n                {%- if quote_identifiers -%}\r\n                    {{ adapter.quote(col)|trim }} {%- if prefix!='' or suffix!='' %} as {{ adapter.quote(prefix ~ col ~ suffix)|trim }} {%- endif -%}\r\n                {%- else -%}\r\n                    {{ col|trim }} {%- if prefix!='' or suffix!='' %} as {{ (prefix ~ col ~ suffix)|trim }} {%- endif -%}\r\n                {% endif %}\r\n            {%- if not loop.last %},{{ '\\n  ' }}{%- endif -%}\r\n        {%- endfor -%}\r\n    {% endif %}\r\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral", "macro.dbt_utils.get_filtered_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1124334, "supported_languages": null}, "macro.dbt_utils.surrogate_key": {"name": "surrogate_key", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/surrogate_key.sql", "original_file_path": "macros/sql/surrogate_key.sql", "unique_id": "macro.dbt_utils.surrogate_key", "macro_sql": "{%- macro surrogate_key(field_list) -%}\n    {% set frustrating_jinja_feature = varargs %}\n    {{ return(adapter.dispatch('surrogate_key', 'dbt_utils')(field_list, *varargs)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__surrogate_key"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1131, "supported_languages": null}, "macro.dbt_utils.default__surrogate_key": {"name": "default__surrogate_key", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/surrogate_key.sql", "original_file_path": "macros/sql/surrogate_key.sql", "unique_id": "macro.dbt_utils.default__surrogate_key", "macro_sql": "\n\n{%- macro default__surrogate_key(field_list) -%}\n\n{%- set error_message = '\nWarning: `dbt_utils.surrogate_key` has been replaced by \\\n`dbt_utils.generate_surrogate_key`. The new macro treats null values \\\ndifferently to empty strings. To restore the behaviour of the original \\\nmacro, add a global variable in dbt_project.yml called \\\n`surrogate_key_treat_nulls_as_empty_strings` to your \\\ndbt_project.yml file with a value of True. \\\nThe {}.{} model triggered this warning. \\\n'.format(model.package_name, model.name) -%}\n\n{%- do exceptions.raise_compiler_error(error_message) -%}\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1135354, "supported_languages": null}, "macro.dbt_utils.get_relations_by_pattern": {"name": "get_relations_by_pattern", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_relations_by_pattern.sql", "original_file_path": "macros/sql/get_relations_by_pattern.sql", "unique_id": "macro.dbt_utils.get_relations_by_pattern", "macro_sql": "{% macro get_relations_by_pattern(schema_pattern, table_pattern, exclude='', database=target.database) %}\n    {{ return(adapter.dispatch('get_relations_by_pattern', 'dbt_utils')(schema_pattern, table_pattern, exclude, database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_relations_by_pattern"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1145449, "supported_languages": null}, "macro.dbt_utils.default__get_relations_by_pattern": {"name": "default__get_relations_by_pattern", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_relations_by_pattern.sql", "original_file_path": "macros/sql/get_relations_by_pattern.sql", "unique_id": "macro.dbt_utils.default__get_relations_by_pattern", "macro_sql": "{% macro default__get_relations_by_pattern(schema_pattern, table_pattern, exclude='', database=target.database) %}\n\n    {%- call statement('get_tables', fetch_result=True) %}\n\n      {{ dbt_utils.get_tables_by_pattern_sql(schema_pattern, table_pattern, exclude, database) }}\n\n    {%- endcall -%}\n\n    {%- set table_list = load_result('get_tables') -%}\n\n    {%- if table_list and table_list['table'] -%}\n        {%- set tbl_relations = [] -%}\n        {%- for row in table_list['table'] -%}\n            {%- set tbl_relation = api.Relation.create(\n                database=database,\n                schema=row.table_schema,\n                identifier=row.table_name,\n                type=row.table_type\n            ) -%}\n            {%- do tbl_relations.append(tbl_relation) -%}\n        {%- endfor -%}\n\n        {{ return(tbl_relations) }}\n    {%- else -%}\n        {{ return([]) }}\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_utils.get_tables_by_pattern_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.116104, "supported_languages": null}, "macro.dbt_utils.width_bucket": {"name": "width_bucket", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/width_bucket.sql", "original_file_path": "macros/sql/width_bucket.sql", "unique_id": "macro.dbt_utils.width_bucket", "macro_sql": "{% macro width_bucket(expr, min_value, max_value, num_buckets) %}\n  {{ return(adapter.dispatch('width_bucket', 'dbt_utils') (expr, min_value, max_value, num_buckets)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__width_bucket"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1171784, "supported_languages": null}, "macro.dbt_utils.default__width_bucket": {"name": "default__width_bucket", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/width_bucket.sql", "original_file_path": "macros/sql/width_bucket.sql", "unique_id": "macro.dbt_utils.default__width_bucket", "macro_sql": "{% macro default__width_bucket(expr, min_value, max_value, num_buckets) -%}\n\n    {% set bin_size -%}\n    (( {{ max_value }} - {{ min_value }} ) / {{ num_buckets }} )\n    {%- endset %}\n    (\n        -- to break ties when the amount is eaxtly at the bucket egde\n        case\n            when\n                mod(\n                    {{ dbt.safe_cast(expr, dbt.type_numeric() ) }},\n                    {{ dbt.safe_cast(bin_size, dbt.type_numeric() ) }}\n                ) = 0\n            then 1\n            else 0\n        end\n    ) +\n      -- Anything over max_value goes the N+1 bucket\n    least(\n        ceil(\n            ({{ expr }} - {{ min_value }})/{{ bin_size }}\n        ),\n        {{ num_buckets }} + 1\n    )\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.safe_cast", "macro.dbt.type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1179826, "supported_languages": null}, "macro.dbt_utils.snowflake__width_bucket": {"name": "snowflake__width_bucket", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/width_bucket.sql", "original_file_path": "macros/sql/width_bucket.sql", "unique_id": "macro.dbt_utils.snowflake__width_bucket", "macro_sql": "{% macro snowflake__width_bucket(expr, min_value, max_value, num_buckets) %}\n    width_bucket({{ expr }}, {{ min_value }}, {{ max_value }}, {{ num_buckets }} )\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.118345, "supported_languages": null}, "macro.dbt_utils.get_table_types_sql": {"name": "get_table_types_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_table_types_sql.sql", "original_file_path": "macros/sql/get_table_types_sql.sql", "unique_id": "macro.dbt_utils.get_table_types_sql", "macro_sql": "{%- macro get_table_types_sql() -%}\n  {{ return(adapter.dispatch('get_table_types_sql', 'dbt_utils')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_utils.default__get_table_types_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1191154, "supported_languages": null}, "macro.dbt_utils.default__get_table_types_sql": {"name": "default__get_table_types_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_table_types_sql.sql", "original_file_path": "macros/sql/get_table_types_sql.sql", "unique_id": "macro.dbt_utils.default__get_table_types_sql", "macro_sql": "{% macro default__get_table_types_sql() %}\n            case table_type\n                when 'BASE TABLE' then 'table'\n                when 'EXTERNAL TABLE' then 'external'\n                when 'MATERIALIZED VIEW' then 'materializedview'\n                else lower(table_type)\n            end as {{ adapter.quote('table_type') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1193867, "supported_languages": null}, "macro.dbt_utils.postgres__get_table_types_sql": {"name": "postgres__get_table_types_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_table_types_sql.sql", "original_file_path": "macros/sql/get_table_types_sql.sql", "unique_id": "macro.dbt_utils.postgres__get_table_types_sql", "macro_sql": "{% macro postgres__get_table_types_sql() %}\n            case table_type\n                when 'BASE TABLE' then 'table'\n                when 'FOREIGN' then 'external'\n                when 'MATERIALIZED VIEW' then 'materializedview'\n                else lower(table_type)\n            end as {{ adapter.quote('table_type') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1196816, "supported_languages": null}, "macro.dbt_utils.databricks__get_table_types_sql": {"name": "databricks__get_table_types_sql", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_table_types_sql.sql", "original_file_path": "macros/sql/get_table_types_sql.sql", "unique_id": "macro.dbt_utils.databricks__get_table_types_sql", "macro_sql": "{% macro databricks__get_table_types_sql() %}\n            case table_type\n                when 'MANAGED' then 'table'\n                when 'BASE TABLE' then 'table'\n                when 'MATERIALIZED VIEW' then 'materializedview'\n                else lower(table_type)\n            end as {{ adapter.quote('table_type') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1199734, "supported_languages": null}, "macro.dbt_utils.nullcheck_table": {"name": "nullcheck_table", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/nullcheck_table.sql", "original_file_path": "macros/sql/nullcheck_table.sql", "unique_id": "macro.dbt_utils.nullcheck_table", "macro_sql": "{% macro nullcheck_table(relation) %}\n    {{ return(adapter.dispatch('nullcheck_table', 'dbt_utils')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__nullcheck_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1205046, "supported_languages": null}, "macro.dbt_utils.default__nullcheck_table": {"name": "default__nullcheck_table", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/nullcheck_table.sql", "original_file_path": "macros/sql/nullcheck_table.sql", "unique_id": "macro.dbt_utils.default__nullcheck_table", "macro_sql": "{% macro default__nullcheck_table(relation) %}\n\n  {%- do dbt_utils._is_relation(relation, 'nullcheck_table') -%}\n  {%- do dbt_utils._is_ephemeral(relation, 'nullcheck_table') -%}\n  {% set cols = adapter.get_columns_in_relation(relation) %}\n\n  select {{ dbt_utils.nullcheck(cols) }}\n  from {{relation}}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral", "macro.dbt_utils.nullcheck"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1212392, "supported_languages": null}, "macro.dbt_utils.get_single_value": {"name": "get_single_value", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_single_value.sql", "original_file_path": "macros/sql/get_single_value.sql", "unique_id": "macro.dbt_utils.get_single_value", "macro_sql": "{% macro get_single_value(query, default=none) %}\n    {{ return(adapter.dispatch('get_single_value', 'dbt_utils')(query, default)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_single_value"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1220627, "supported_languages": null}, "macro.dbt_utils.default__get_single_value": {"name": "default__get_single_value", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_single_value.sql", "original_file_path": "macros/sql/get_single_value.sql", "unique_id": "macro.dbt_utils.default__get_single_value", "macro_sql": "{% macro default__get_single_value(query, default) %}\n\n{# This macro returns the (0, 0) record in a query, i.e. the first row of the first column #}\n\n    {%- call statement('get_query_result', fetch_result=True, auto_begin=false) -%}\n\n        {{ query }}\n\n    {%- endcall -%}\n\n    {%- if execute -%}\n\n        {% set r = load_result('get_query_result').table.columns[0].values() %}\n        {% if r | length == 0 %}\n            {% do print('Query `' ~ query ~ '` returned no rows. Using the default value: ' ~ default) %}\n            {% set sql_result = default %}\n        {% else %}\n            {% set sql_result = r[0] %}\n        {% endif %}\n        \n    {%- else -%}\n    \n        {% set sql_result = default %}\n    \n    {%- endif -%}\n\n    {% do return(sql_result) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1233857, "supported_languages": null}, "macro.dbt_utils.get_powers_of_two": {"name": "get_powers_of_two", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_series.sql", "original_file_path": "macros/sql/generate_series.sql", "unique_id": "macro.dbt_utils.get_powers_of_two", "macro_sql": "{% macro get_powers_of_two(upper_bound) %}\n    {{ return(adapter.dispatch('get_powers_of_two', 'dbt_utils')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1245904, "supported_languages": null}, "macro.dbt_utils.default__get_powers_of_two": {"name": "default__get_powers_of_two", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_series.sql", "original_file_path": "macros/sql/generate_series.sql", "unique_id": "macro.dbt_utils.default__get_powers_of_two", "macro_sql": "{% macro default__get_powers_of_two(upper_bound) %}\n\n    {% if upper_bound <= 0 %}\n    {{ exceptions.raise_compiler_error(\"upper bound must be positive\") }}\n    {% endif %}\n\n    {% for _ in range(1, 100) %}\n       {% if upper_bound <= 2 ** loop.index %}{{ return(loop.index) }}{% endif %}\n    {% endfor %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1253438, "supported_languages": null}, "macro.dbt_utils.generate_series": {"name": "generate_series", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_series.sql", "original_file_path": "macros/sql/generate_series.sql", "unique_id": "macro.dbt_utils.generate_series", "macro_sql": "{% macro generate_series(upper_bound) %}\n    {{ return(adapter.dispatch('generate_series', 'dbt_utils')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__generate_series"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.125699, "supported_languages": null}, "macro.dbt_utils.default__generate_series": {"name": "default__generate_series", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_series.sql", "original_file_path": "macros/sql/generate_series.sql", "unique_id": "macro.dbt_utils.default__generate_series", "macro_sql": "{% macro default__generate_series(upper_bound) %}\n\n    {% set n = dbt_utils.get_powers_of_two(upper_bound) %}\n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    {% for i in range(n) %}\n    p{{i}}.generated_number * power(2, {{i}})\n    {% if not loop.last %} + {% endif %}\n    {% endfor %}\n    + 1\n    as generated_number\n\n    from\n\n    {% for i in range(n) %}\n    p as p{{i}}\n    {% if not loop.last %} cross join {% endif %}\n    {% endfor %}\n\n    )\n\n    select *\n    from unioned\n    where generated_number <= {{upper_bound}}\n    order by generated_number\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1266367, "supported_languages": null}, "macro.dbt_utils.get_relations_by_prefix": {"name": "get_relations_by_prefix", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_relations_by_prefix.sql", "original_file_path": "macros/sql/get_relations_by_prefix.sql", "unique_id": "macro.dbt_utils.get_relations_by_prefix", "macro_sql": "{% macro get_relations_by_prefix(schema, prefix, exclude='', database=target.database) %}\n    {{ return(adapter.dispatch('get_relations_by_prefix', 'dbt_utils')(schema, prefix, exclude, database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_relations_by_prefix"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.127681, "supported_languages": null}, "macro.dbt_utils.default__get_relations_by_prefix": {"name": "default__get_relations_by_prefix", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_relations_by_prefix.sql", "original_file_path": "macros/sql/get_relations_by_prefix.sql", "unique_id": "macro.dbt_utils.default__get_relations_by_prefix", "macro_sql": "{% macro default__get_relations_by_prefix(schema, prefix, exclude='', database=target.database) %}\n\n    {%- call statement('get_tables', fetch_result=True) %}\n\n      {{ dbt_utils.get_tables_by_prefix_sql(schema, prefix, exclude, database) }}\n\n    {%- endcall -%}\n\n    {%- set table_list = load_result('get_tables') -%}\n\n    {%- if table_list and table_list['table'] -%}\n        {%- set tbl_relations = [] -%}\n        {%- for row in table_list['table'] -%}\n            {%- set tbl_relation = api.Relation.create(\n                database=database,\n                schema=row.table_schema,\n                identifier=row.table_name,\n                type=row.table_type\n            ) -%}\n            {%- do tbl_relations.append(tbl_relation) -%}\n        {%- endfor -%}\n\n        {{ return(tbl_relations) }}\n    {%- else -%}\n        {{ return([]) }}\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_utils.get_tables_by_prefix_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1291535, "supported_languages": null}, "macro.dbt_utils.get_filtered_columns_in_relation": {"name": "get_filtered_columns_in_relation", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_filtered_columns_in_relation.sql", "original_file_path": "macros/sql/get_filtered_columns_in_relation.sql", "unique_id": "macro.dbt_utils.get_filtered_columns_in_relation", "macro_sql": "{% macro get_filtered_columns_in_relation(from, except=[]) -%}\n    {{ return(adapter.dispatch('get_filtered_columns_in_relation', 'dbt_utils')(from, except)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_filtered_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.12989, "supported_languages": null}, "macro.dbt_utils.default__get_filtered_columns_in_relation": {"name": "default__get_filtered_columns_in_relation", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_filtered_columns_in_relation.sql", "original_file_path": "macros/sql/get_filtered_columns_in_relation.sql", "unique_id": "macro.dbt_utils.default__get_filtered_columns_in_relation", "macro_sql": "{% macro default__get_filtered_columns_in_relation(from, except=[]) -%}\n    {%- do dbt_utils._is_relation(from, 'get_filtered_columns_in_relation') -%}\n    {%- do dbt_utils._is_ephemeral(from, 'get_filtered_columns_in_relation') -%}\n\n    {# -- Prevent querying of db in parsing mode. This works because this macro does not create any new refs. #}\n    {%- if not execute -%}\n        {{ return('') }}\n    {% endif %}\n\n    {%- set include_cols = [] %}\n    {%- set cols = adapter.get_columns_in_relation(from) -%}\n    {%- set except = except | map(\"lower\") | list %}\n    {%- for col in cols -%}\n        {%- if col.column|lower not in except -%}\n            {% do include_cols.append(col.column) %}\n        {%- endif %}\n    {%- endfor %}\n\n    {{ return(include_cols) }}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_utils._is_relation", "macro.dbt_utils._is_ephemeral"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1311822, "supported_languages": null}, "macro.dbt_utils.generate_surrogate_key": {"name": "generate_surrogate_key", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_surrogate_key.sql", "original_file_path": "macros/sql/generate_surrogate_key.sql", "unique_id": "macro.dbt_utils.generate_surrogate_key", "macro_sql": "{%- macro generate_surrogate_key(field_list) -%}\n    {{ return(adapter.dispatch('generate_surrogate_key', 'dbt_utils')(field_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__generate_surrogate_key"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.131934, "supported_languages": null}, "macro.dbt_utils.default__generate_surrogate_key": {"name": "default__generate_surrogate_key", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/generate_surrogate_key.sql", "original_file_path": "macros/sql/generate_surrogate_key.sql", "unique_id": "macro.dbt_utils.default__generate_surrogate_key", "macro_sql": "\n\n{%- macro default__generate_surrogate_key(field_list) -%}\n\n{%- if var('surrogate_key_treat_nulls_as_empty_strings', False) -%}\n    {%- set default_null_value = \"\" -%}\n{%- else -%}\n    {%- set default_null_value = '_dbt_utils_surrogate_key_null_' -%}\n{%- endif -%}\n\n{%- set fields = [] -%}\n\n{%- for field in field_list -%}\n\n    {%- do fields.append(\n        \"coalesce(cast(\" ~ field ~ \" as \" ~ dbt.type_string() ~ \"), '\" ~ default_null_value  ~\"')\"\n    ) -%}\n\n    {%- if not loop.last %}\n        {%- do fields.append(\"'-'\") -%}\n    {%- endif -%}\n\n{%- endfor -%}\n\n{{ dbt.hash(dbt.concat(fields)) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.type_string", "macro.dbt.hash", "macro.dbt.concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1330605, "supported_languages": null}, "macro.dbt_utils.nullcheck": {"name": "nullcheck", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/nullcheck.sql", "original_file_path": "macros/sql/nullcheck.sql", "unique_id": "macro.dbt_utils.nullcheck", "macro_sql": "{% macro nullcheck(cols) %}\n    {{ return(adapter.dispatch('nullcheck', 'dbt_utils')(cols)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__nullcheck"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1336367, "supported_languages": null}, "macro.dbt_utils.default__nullcheck": {"name": "default__nullcheck", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/nullcheck.sql", "original_file_path": "macros/sql/nullcheck.sql", "unique_id": "macro.dbt_utils.default__nullcheck", "macro_sql": "{% macro default__nullcheck(cols) %}\n{%- for col in cols %}\n\n    {% if col.is_string() -%}\n\n    nullif({{col.name}},'') as {{col.name}}\n\n    {%- else -%}\n\n    {{col.name}}\n\n    {%- endif -%}\n\n{%- if not loop.last -%} , {%- endif -%}\n\n{%- endfor -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1342516, "supported_languages": null}, "macro.dbt_utils.safe_add": {"name": "safe_add", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_add.sql", "original_file_path": "macros/sql/safe_add.sql", "unique_id": "macro.dbt_utils.safe_add", "macro_sql": "{%- macro safe_add(field_list) -%}\n    {{ return(adapter.dispatch('safe_add', 'dbt_utils')(field_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__safe_add"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1348724, "supported_languages": null}, "macro.dbt_utils.default__safe_add": {"name": "default__safe_add", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_add.sql", "original_file_path": "macros/sql/safe_add.sql", "unique_id": "macro.dbt_utils.default__safe_add", "macro_sql": "\n\n{%- macro default__safe_add(field_list) -%}\n\n{%- if field_list is not iterable or field_list is string or field_list is mapping -%}\n\n{%- set error_message = '\nWarning: the `safe_add` macro now takes a single list argument instead of \\\nstring arguments. The {}.{} model triggered this warning. \\\n'.format(model.package_name, model.name) -%}\n\n{%- do exceptions.warn(error_message) -%}\n\n{%- endif -%}\n\n{% set fields = [] %}\n\n{%- for field in field_list -%}\n\n    {% do fields.append(\"coalesce(\" ~ field ~ \", 0)\") %}\n\n{%- endfor -%}\n\n{{ fields|join(' +\\n  ') }}\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1358569, "supported_languages": null}, "macro.dbt_utils.get_query_results_as_dict": {"name": "get_query_results_as_dict", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_query_results_as_dict.sql", "original_file_path": "macros/sql/get_query_results_as_dict.sql", "unique_id": "macro.dbt_utils.get_query_results_as_dict", "macro_sql": "{% macro get_query_results_as_dict(query) %}\n    {{ return(adapter.dispatch('get_query_results_as_dict', 'dbt_utils')(query)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__get_query_results_as_dict"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1364977, "supported_languages": null}, "macro.dbt_utils.default__get_query_results_as_dict": {"name": "default__get_query_results_as_dict", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/get_query_results_as_dict.sql", "original_file_path": "macros/sql/get_query_results_as_dict.sql", "unique_id": "macro.dbt_utils.default__get_query_results_as_dict", "macro_sql": "{% macro default__get_query_results_as_dict(query) %}\n\n{# This macro returns a dictionary of the form {column_name: (tuple_of_results)} #}\n\n    {%- call statement('get_query_results', fetch_result=True,auto_begin=false) -%}\n\n        {{ query }}\n\n    {%- endcall -%}\n\n    {% set sql_results={} %}\n\n    {%- if execute -%}\n        {% set sql_results_table = load_result('get_query_results').table.columns %}\n        {% for column_name, column in sql_results_table.items() %}\n            {% do sql_results.update({column_name: column.values()}) %}\n        {% endfor %}\n    {%- endif -%}\n\n    {{ return(sql_results) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1378434, "supported_languages": null}, "macro.dbt_utils.safe_subtract": {"name": "safe_subtract", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_subtract.sql", "original_file_path": "macros/sql/safe_subtract.sql", "unique_id": "macro.dbt_utils.safe_subtract", "macro_sql": "{%- macro safe_subtract(field_list) -%}\n    {{ return(adapter.dispatch('safe_subtract', 'dbt_utils')(field_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.default__safe_subtract"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1384594, "supported_languages": null}, "macro.dbt_utils.default__safe_subtract": {"name": "default__safe_subtract", "resource_type": "macro", "package_name": "dbt_utils", "path": "macros/sql/safe_subtract.sql", "original_file_path": "macros/sql/safe_subtract.sql", "unique_id": "macro.dbt_utils.default__safe_subtract", "macro_sql": "\n\n{%- macro default__safe_subtract(field_list) -%}\n\n{%- if field_list is not iterable or field_list is string or field_list is mapping -%}\n\n{%- set error_message = '\nWarning: the `safe_subtract` macro takes a single list argument instead of \\\nstring arguments. The {}.{} model triggered this warning. \\\n'.format(model.package_name, model.name) -%}\n\n{%- do exceptions.raise_compiler_error(error_message) -%}\n\n{%- endif -%}\n\n{% set fields = [] %}\n\n{%- for field in field_list -%}\n\n    {% do fields.append(\"coalesce(\" ~ field ~ \", 0)\") %}\n\n{%- endfor -%}\n\n{{ fields|join(' -\\n  ') }}\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1394532, "supported_languages": null}, "macro.audit_helper.compare_relations": {"name": "compare_relations", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relations.sql", "original_file_path": "macros/compare_relations.sql", "unique_id": "macro.audit_helper.compare_relations", "macro_sql": "{% macro compare_relations(a_relation, b_relation, exclude_columns=[], primary_key=None, summarize=true, limit=None) %}\n\n{% set column_names = dbt_utils.get_filtered_columns_in_relation(from=a_relation, except=exclude_columns) %}\n\n{% set column_selection %}\n\n  {% for column_name in column_names %} \n    {{ adapter.quote(column_name) }} \n    {% if not loop.last %}\n      , \n    {% endif %} \n  {% endfor %}\n\n{% endset %}\n\n{% set a_query %}\nselect\n\n  {{ column_selection }}\n\nfrom {{ a_relation }}\n{% endset %}\n\n{% set b_query %}\nselect\n\n  {{ column_selection }}\n\nfrom {{ b_relation }}\n{% endset %}\n\n{{ audit_helper.compare_queries(a_query, b_query, primary_key, summarize, limit) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_filtered_columns_in_relation", "macro.audit_helper.compare_queries"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1411395, "supported_languages": null}, "macro.audit_helper.compare_which_relation_columns_differ": {"name": "compare_which_relation_columns_differ", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_which_relation_columns_differ.sql", "original_file_path": "macros/compare_which_relation_columns_differ.sql", "unique_id": "macro.audit_helper.compare_which_relation_columns_differ", "macro_sql": "{% macro compare_which_relation_columns_differ(a_relation, b_relation, primary_key_columns=[], columns=[], event_time=None) %}\n    {%- if not columns -%}\n        {%- set columns = audit_helper._get_intersecting_columns_from_relations(a_relation, b_relation) -%}\n    {%- endif -%}\n\n    {{ \n        audit_helper.compare_which_query_columns_differ(\n            \"select * from \" ~ a_relation,\n            \"select * from \" ~ b_relation,\n            primary_key_columns,\n            columns,\n            event_time\n        )\n    }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._get_intersecting_columns_from_relations", "macro.audit_helper.compare_which_query_columns_differ"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.142052, "supported_languages": null}, "macro.audit_helper.quick_are_relations_identical": {"name": "quick_are_relations_identical", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/quick_are_relations_identical.sql", "original_file_path": "macros/quick_are_relations_identical.sql", "unique_id": "macro.audit_helper.quick_are_relations_identical", "macro_sql": "{% macro quick_are_relations_identical(a_relation, b_relation, columns=None, event_time=None) %}\n    {% if not columns %}\n        {% set columns = audit_helper._get_intersecting_columns_from_relations(a_relation, b_relation) %}\n    {% endif %}\n\n    {{\n        audit_helper.quick_are_queries_identical(\n            \"select * from \" ~ a_relation,\n            \"select * from \" ~ b_relation,\n            columns, \n            event_time\n        )\n    }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._get_intersecting_columns_from_relations", "macro.audit_helper.quick_are_queries_identical"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1429164, "supported_languages": null}, "macro.audit_helper.compare_which_query_columns_differ": {"name": "compare_which_query_columns_differ", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_which_query_columns_differ.sql", "original_file_path": "macros/compare_which_query_columns_differ.sql", "unique_id": "macro.audit_helper.compare_which_query_columns_differ", "macro_sql": "{% macro compare_which_query_columns_differ(a_query, b_query, primary_key_columns=[], columns=[], event_time=None) %}\n    {{ return(adapter.dispatch('compare_which_query_columns_differ', 'audit_helper')(a_query, b_query, primary_key_columns, columns, event_time)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_which_query_columns_differ"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.145758, "supported_languages": null}, "macro.audit_helper.default__compare_which_query_columns_differ": {"name": "default__compare_which_query_columns_differ", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_which_query_columns_differ.sql", "original_file_path": "macros/compare_which_query_columns_differ.sql", "unique_id": "macro.audit_helper.default__compare_which_query_columns_differ", "macro_sql": "{% macro default__compare_which_query_columns_differ(a_query, b_query, primary_key_columns, columns, event_time) %}\n    {% set columns = audit_helper._ensure_all_pks_are_in_column_set(primary_key_columns, columns) %}\n    {% if event_time %}\n        {% set event_time_props = audit_helper._get_comparison_bounds(event_time) %}\n    {% endif %}\n\n    {% set joined_cols = columns | join (\", \") %}\n\n        with a as (\n            select \n                {{ joined_cols }},\n                {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key\n            from ({{ a_query }}) as a_subq\n            {{ audit_helper.event_time_filter(event_time_props) }}\n        ),\n        b as (\n            select \n                {{ joined_cols }},\n                {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key\n            from ({{ b_query }}) as b_subq\n            {{ audit_helper.event_time_filter(event_time_props) }}\n        ),\n\n        calculated as (\n            select \n                {% for column in columns %}\n                    {% set quoted_column = adapter.quote(column) %}\n                    {% set compare_statement %}\n                        (\n                            (a.{{ quoted_column }} != b.{{ quoted_column }})\n                            or (a.{{ quoted_column }} is null and b.{{ quoted_column }} is not null)\n                            or (a.{{ quoted_column }} is not null and b.{{ quoted_column }} is null)\n                        )\n                    {% endset %}\n                \n                {{ dbt.bool_or(compare_statement) }} as {{ column | lower }}_has_difference\n\n                {%- if not loop.last %}, {% endif %}\n                {% endfor %}\n            from a\n            inner join b on a.dbt_audit_surrogate_key = b.dbt_audit_surrogate_key\n        )\n\n    {% for column in columns %}\n    \n    select \n        '{{ column }}' as column_name, \n        {{ column | lower }}_has_difference as has_difference\n    \n    from calculated\n\n    {% if not loop.last %}\n        \n    union all \n\n    {% endif %}\n\n    {% endfor %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._ensure_all_pks_are_in_column_set", "macro.audit_helper._get_comparison_bounds", "macro.audit_helper._generate_null_safe_surrogate_key", "macro.audit_helper.event_time_filter", "macro.dbt.bool_or"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1481252, "supported_languages": null}, "macro.audit_helper.compare_and_classify_query_results": {"name": "compare_and_classify_query_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_and_classify_query_results.sql", "original_file_path": "macros/compare_and_classify_query_results.sql", "unique_id": "macro.audit_helper.compare_and_classify_query_results", "macro_sql": "{% macro compare_and_classify_query_results(a_query, b_query, primary_key_columns=[], columns=[], event_time=None, sample_limit=20) %}\n    \n    {% set columns = audit_helper._ensure_all_pks_are_in_column_set(primary_key_columns, columns) %}\n    {% set joined_cols = columns | join(\", \") %}\n\n    {% if event_time %}\n        {% set event_time_props = audit_helper._get_comparison_bounds(a_query, b_query, event_time) %}\n    {% endif %}\n\n    with \n\n    {{ audit_helper._generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props)}}\n    \n    ,\n\n    all_records as (\n\n        select\n            *,\n            true as dbt_audit_in_a,\n            true as dbt_audit_in_b\n        from a_intersect_b\n\n        union all\n\n        select\n            *,\n            true as dbt_audit_in_a,\n            false as dbt_audit_in_b\n        from a_except_b\n\n        union all\n\n        select\n            *,\n            false as dbt_audit_in_a,\n            true as dbt_audit_in_b\n        from b_except_a\n\n    ),\n\n    classified as (\n        select \n            *,\n            {{ audit_helper._classify_audit_row_status() }} as dbt_audit_row_status\n        from all_records\n    ),\n\n    final as (\n        select \n            *,\n            {{ audit_helper._count_num_rows_in_status() }} as dbt_audit_num_rows_in_status,\n            -- using dense_rank so that modified rows (which have a full row for both the left and right side) both get picked up in the sample. \n            -- For every other type this is equivalent to a row_number()\n            dense_rank() over (partition by dbt_audit_row_status order by dbt_audit_surrogate_key, dbt_audit_pk_row_num) as dbt_audit_sample_number\n        from classified\n    )\n\n    select * from final\n    {% if sample_limit %}\n        where dbt_audit_sample_number <= {{ sample_limit }}\n    {% endif %}\n    order by dbt_audit_row_status, dbt_audit_sample_number\n\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._ensure_all_pks_are_in_column_set", "macro.audit_helper._get_comparison_bounds", "macro.audit_helper._generate_set_results", "macro.audit_helper._classify_audit_row_status", "macro.audit_helper._count_num_rows_in_status"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.150245, "supported_languages": null}, "macro.audit_helper.quick_are_queries_identical": {"name": "quick_are_queries_identical", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/quick_are_queries_identical.sql", "original_file_path": "macros/quick_are_queries_identical.sql", "unique_id": "macro.audit_helper.quick_are_queries_identical", "macro_sql": "{% macro quick_are_queries_identical(query_a, query_b, columns=[], event_time=None) %}\n    {{ return (adapter.dispatch('quick_are_queries_identical', 'audit_helper')(query_a, query_b, columns, event_time)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.bigquery__quick_are_queries_identical"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.152034, "supported_languages": null}, "macro.audit_helper.default__quick_are_queries_identical": {"name": "default__quick_are_queries_identical", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/quick_are_queries_identical.sql", "original_file_path": "macros/quick_are_queries_identical.sql", "unique_id": "macro.audit_helper.default__quick_are_queries_identical", "macro_sql": "{% macro default__quick_are_queries_identical(query_a, query_b, columns, event_time) %}\n    {% if execute %}\n        {# Need to only throw this error when the macro is actually trying to be used, not during intial parse phase #}\n        {# if/when unit tests get support for `enabled` config, this check can be removed as they won't be supplied for parse anyway #}\n        {% do exceptions.raise_compiler_error(\"quick_are_queries_identical() is not implemented for adapter '\"~ target.type ~ \"'\" ) %}\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1525478, "supported_languages": null}, "macro.audit_helper.bigquery__quick_are_queries_identical": {"name": "bigquery__quick_are_queries_identical", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/quick_are_queries_identical.sql", "original_file_path": "macros/quick_are_queries_identical.sql", "unique_id": "macro.audit_helper.bigquery__quick_are_queries_identical", "macro_sql": "{% macro bigquery__quick_are_queries_identical(query_a, query_b, columns, event_time) %}\n    {% set joined_cols = columns | join(\", \") %}\n    {% if event_time %}\n        {% set event_time_props = audit_helper._get_comparison_bounds(a_query, b_query, event_time) %}\n    {% endif %}\n\n    with query_a as (\n        select {{ joined_cols }}\n        from ({{ query_a }})\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ), \n    query_b as (\n        select {{ joined_cols }}\n        from ({{ query_b }})\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    )\n\n    select count(distinct hash_result) = 1 as are_tables_identical\n    from (\n        select bit_xor(farm_fingerprint(to_json_string(query_a))) as hash_result\n        from query_a\n\n        union all\n        \n        select bit_xor(farm_fingerprint(to_json_string(query_b))) as hash_result\n        from query_b\n    ) as hashes\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._get_comparison_bounds", "macro.audit_helper.event_time_filter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1534977, "supported_languages": null}, "macro.audit_helper.snowflake__quick_are_queries_identical": {"name": "snowflake__quick_are_queries_identical", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/quick_are_queries_identical.sql", "original_file_path": "macros/quick_are_queries_identical.sql", "unique_id": "macro.audit_helper.snowflake__quick_are_queries_identical", "macro_sql": "{% macro snowflake__quick_are_queries_identical(query_a, query_b, columns, event_time) %}\n    {% set joined_cols = columns | join(\", \") %}\n    {% if event_time %}\n        {% set event_time_props = audit_helper._get_comparison_bounds(a_query, b_query, event_time) %}\n    {% endif %}\n\n    select count(distinct hash_result) = 1 as are_tables_identical\n    from (\n        select hash_agg({{ joined_cols }}) as hash_result\n        from ({{ query_a }}) query_a_subq\n        {{ audit_helper.event_time_filter(event_time_props) }}\n\n        union all\n        \n        select hash_agg({{ joined_cols }}) as hash_result\n        from ({{ query_b }}) query_b_subq\n        {{ audit_helper.event_time_filter(event_time_props) }}\n\n    ) as hashes\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._get_comparison_bounds", "macro.audit_helper.event_time_filter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1544409, "supported_languages": null}, "macro.audit_helper.compare_column_values_verbose": {"name": "compare_column_values_verbose", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_column_values_verbose.sql", "original_file_path": "macros/compare_column_values_verbose.sql", "unique_id": "macro.audit_helper.compare_column_values_verbose", "macro_sql": "{% macro compare_column_values_verbose(a_query, b_query, primary_key, column_to_compare) -%}\n  {{ return(adapter.dispatch('compare_column_values_verbose', 'audit_helper')(a_query, b_query, primary_key, column_to_compare)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_column_values_verbose"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1571815, "supported_languages": null}, "macro.audit_helper.default__compare_column_values_verbose": {"name": "default__compare_column_values_verbose", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_column_values_verbose.sql", "original_file_path": "macros/compare_column_values_verbose.sql", "unique_id": "macro.audit_helper.default__compare_column_values_verbose", "macro_sql": "{% macro default__compare_column_values_verbose(a_query, b_query, primary_key, column_to_compare) -%}\nwith a_query as (\n    {{ a_query }}\n),\n\nb_query as (\n    {{ b_query }}\n)\n    select\n        coalesce(a_query.{{ primary_key }}, b_query.{{ primary_key }}) as primary_key,\n\n        {% if target.name == 'postgres' or target.name == 'redshift' %}\n            '{{ column_to_compare }}'::text as column_name,\n        {% else %}\n            '{{ column_to_compare }}' as column_name,\n        {% endif %}\n\n        coalesce(\n            a_query.{{ column_to_compare }} = b_query.{{ column_to_compare }} and \n                a_query.{{ primary_key }} is not null and b_query.{{ primary_key }} is not null,\n            (a_query.{{ column_to_compare }} is null and b_query.{{ column_to_compare }} is null),\n            false\n        ) as perfect_match,\n        a_query.{{ column_to_compare }} is null and a_query.{{ primary_key }} is not null as null_in_a,\n        b_query.{{ column_to_compare }} is null and b_query.{{ primary_key }} is not null as null_in_b,\n        a_query.{{ primary_key }} is null as missing_from_a,\n        b_query.{{ primary_key }} is null as missing_from_b,\n        coalesce(\n            a_query.{{ primary_key }} is not null and b_query.{{ primary_key }} is not null and \n            -- ensure that neither value is missing before considering it a conflict\n            (\n                a_query.{{ column_to_compare }} != b_query.{{ column_to_compare }} or -- two not-null values that do not match\n                (a_query.{{ column_to_compare }} is not null and b_query.{{ column_to_compare }} is null) or -- null in b and not null in a\n                (a_query.{{ column_to_compare }} is null and b_query.{{ column_to_compare }} is not null) -- null in a and not null in b\n            ), \n            false\n        ) as conflicting_values\n        -- considered a conflict if the values do not match AND at least one of the values is not null.\n\n    from a_query\n\n    full outer join b_query on (a_query.{{ primary_key }} = b_query.{{ primary_key }})\n\n\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1586783, "supported_languages": null}, "macro.audit_helper.compare_queries": {"name": "compare_queries", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_queries.sql", "original_file_path": "macros/compare_queries.sql", "unique_id": "macro.audit_helper.compare_queries", "macro_sql": "{% macro compare_queries(a_query, b_query, primary_key=None, summarize=true, limit=None) -%}\n  {{ return(adapter.dispatch('compare_queries', 'audit_helper')(a_query, b_query, primary_key, summarize, limit)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_queries"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1599524, "supported_languages": null}, "macro.audit_helper.default__compare_queries": {"name": "default__compare_queries", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_queries.sql", "original_file_path": "macros/compare_queries.sql", "unique_id": "macro.audit_helper.default__compare_queries", "macro_sql": "{% macro default__compare_queries(a_query, b_query, primary_key=None, summarize=true, limit=None) %}\n\nwith a as (\n\n    {{ a_query }}\n\n),\n\nb as (\n\n    {{ b_query }}\n\n),\n\na_intersect_b as (\n\n    select * from a\n    {{ dbt.intersect() }}\n    select * from b\n\n),\n\na_except_b as (\n\n    select * from a\n    {{ dbt.except() }}\n    select * from b\n\n),\n\nb_except_a as (\n\n    select * from b\n    {{ dbt.except() }}\n    select * from a\n\n),\n\nall_records as (\n\n    select\n        *,\n        true as in_a,\n        true as in_b\n    from a_intersect_b\n\n    union all\n\n    select\n        *,\n        true as in_a,\n        false as in_b\n    from a_except_b\n\n    union all\n\n    select\n        *,\n        false as in_a,\n        true as in_b\n    from b_except_a\n\n),\n\n{%- if summarize %}\n\nsummary_stats as (\n\n    select\n\n        in_a,\n        in_b,\n        count(*) as count\n\n    from all_records\n    group by 1, 2\n\n),\n\nfinal as (\n\n    select\n\n        *,\n        round(100.0 * count / sum(count) over (), 2) as percent_of_total\n\n    from summary_stats\n    order by in_a desc, in_b desc\n\n)\n\n{%- else %}\n\nfinal as (\n    \n    select * from all_records\n    where not (in_a and in_b)\n    order by {{ primary_key ~ \", \" if primary_key is not none }} in_a desc, in_b desc\n\n)\n\n{%- endif %}\n\nselect * from final\n{%- if limit and not summarize %}\nlimit {{ limit }}\n{%- endif %}\n\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.intersect", "macro.dbt.except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1611228, "supported_languages": null}, "macro.audit_helper.compare_and_classify_relation_rows": {"name": "compare_and_classify_relation_rows", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_and_classify_relation_rows.sql", "original_file_path": "macros/compare_and_classify_relation_rows.sql", "unique_id": "macro.audit_helper.compare_and_classify_relation_rows", "macro_sql": "{% macro compare_and_classify_relation_rows(a_relation, b_relation, primary_key_columns=[], columns=None, event_time=None, sample_limit=20) %}\n    {%- if not columns -%}\n        {%- set columns = audit_helper._get_intersecting_columns_from_relations(a_relation, b_relation) -%}\n    {%- endif -%}\n\n    {{ \n        audit_helper.compare_and_classify_query_results(\n            \"select * from \" ~ a_relation,\n            \"select * from \" ~ b_relation,\n            primary_key_columns,\n            columns,\n            event_time,\n            sample_limit\n        )\n    }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._get_intersecting_columns_from_relations", "macro.audit_helper.compare_and_classify_query_results"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.162125, "supported_languages": null}, "macro.audit_helper.compare_row_counts": {"name": "compare_row_counts", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_row_counts.sql", "original_file_path": "macros/compare_row_counts.sql", "unique_id": "macro.audit_helper.compare_row_counts", "macro_sql": "{% macro compare_row_counts(a_relation, b_relation) %}\n  {{ return(adapter.dispatch('compare_row_counts', 'audit_helper')(a_relation, b_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_row_counts"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1627808, "supported_languages": null}, "macro.audit_helper.default__compare_row_counts": {"name": "default__compare_row_counts", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_row_counts.sql", "original_file_path": "macros/compare_row_counts.sql", "unique_id": "macro.audit_helper.default__compare_row_counts", "macro_sql": "{% macro default__compare_row_counts(a_relation, b_relation) %}\n\n        select\n            '{{ a_relation }}' as relation_name,\n            count(*) as total_records\n        from {{ a_relation }}\n\n        union all\n\n        select\n            '{{ b_relation }}' as relation_name,\n            count(*) as total_records\n        from {{ b_relation }}\n  \n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1631253, "supported_languages": null}, "macro.audit_helper.compare_column_values": {"name": "compare_column_values", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_column_values.sql", "original_file_path": "macros/compare_column_values.sql", "unique_id": "macro.audit_helper.compare_column_values", "macro_sql": "{% macro compare_column_values(a_query, b_query, primary_key, column_to_compare, emojis=True, a_relation_name='a', b_relation_name='b') -%}\n  {{ return(adapter.dispatch('compare_column_values', 'audit_helper')(a_query, b_query, primary_key, column_to_compare, emojis, a_relation_name, b_relation_name)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_column_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1674848, "supported_languages": null}, "macro.audit_helper.default__compare_column_values": {"name": "default__compare_column_values", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_column_values.sql", "original_file_path": "macros/compare_column_values.sql", "unique_id": "macro.audit_helper.default__compare_column_values", "macro_sql": "{% macro default__compare_column_values(a_query, b_query, primary_key, column_to_compare, emojis, a_relation_name, b_relation_name) -%}\nwith a_query as (\n    {{ a_query }}\n),\n\nb_query as (\n    {{ b_query }}\n),\n\njoined as (\n    select\n        coalesce(a_query.{{ primary_key }}, b_query.{{ primary_key }}) as {{ primary_key }},\n        a_query.{{ column_to_compare }} as a_query_value,\n        b_query.{{ column_to_compare }} as b_query_value,\n        case\n            when a_query.{{ column_to_compare }} = b_query.{{ column_to_compare }} then '{% if emojis %}\u2705: {% endif %}perfect match'\n            when a_query.{{ column_to_compare }} is null and b_query.{{ column_to_compare }} is null then '{% if emojis %}\u2705: {% endif %}both are null'\n            when a_query.{{ primary_key }} is null then '{% if emojis %}\ud83e\udd37: {% endif %}missing from {{ a_relation_name }}'\n            when b_query.{{ primary_key }} is null then '{% if emojis %}\ud83e\udd37: {% endif %}missing from {{ b_relation_name }}'\n            when a_query.{{ column_to_compare }} is null then '{% if emojis %}\ud83e\udd37: {% endif %}value is null in {{ a_relation_name }} only'\n            when b_query.{{ column_to_compare }} is null then '{% if emojis %}\ud83e\udd37: {% endif %}value is null in {{ b_relation_name }} only'\n            when a_query.{{ column_to_compare }} != b_query.{{ column_to_compare }} then '{% if emojis %}\u274c: {% endif %}\u200dvalues do not match'\n            else 'unknown' -- this should never happen\n        end as match_status,\n        case\n            when a_query.{{ column_to_compare }} = b_query.{{ column_to_compare }} then 0\n            when a_query.{{ column_to_compare }} is null and b_query.{{ column_to_compare }} is null then 1\n            when a_query.{{ primary_key }} is null then 2\n            when b_query.{{ primary_key }} is null then 3\n            when a_query.{{ column_to_compare }} is null then 4\n            when b_query.{{ column_to_compare }} is null then 5\n            when a_query.{{ column_to_compare }} != b_query.{{ column_to_compare }} then 6\n            else 7 -- this should never happen\n        end as match_order\n\n    from a_query\n\n    full outer join b_query on a_query.{{ primary_key }} = b_query.{{ primary_key }}\n),\n\naggregated as (\n    select\n        '{{ column_to_compare }}' as column_name,\n        match_status,\n        match_order,\n        count(*) as count_records\n    from joined\n\n    group by column_name, match_status, match_order\n)\n\nselect\n    column_name,\n    match_status,\n    count_records,\n    round(100.0 * count_records / sum(count_records) over (), 2) as percent_of_total\n\nfrom aggregated\n\norder by match_order\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1697388, "supported_languages": null}, "macro.audit_helper.compare_all_columns": {"name": "compare_all_columns", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_all_columns.sql", "original_file_path": "macros/compare_all_columns.sql", "unique_id": "macro.audit_helper.compare_all_columns", "macro_sql": "{% macro compare_all_columns( a_relation, b_relation, primary_key,  exclude_columns=[],summarize=true ) -%}\n  {{ return(adapter.dispatch('compare_all_columns', 'audit_helper')( a_relation, b_relation, primary_key, exclude_columns, summarize )) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_all_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1716225, "supported_languages": null}, "macro.audit_helper.default__compare_all_columns": {"name": "default__compare_all_columns", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_all_columns.sql", "original_file_path": "macros/compare_all_columns.sql", "unique_id": "macro.audit_helper.default__compare_all_columns", "macro_sql": "{% macro default__compare_all_columns( a_relation, b_relation, primary_key, exclude_columns=[], summarize=true ) -%}\n\n  {% set column_names = dbt_utils.get_filtered_columns_in_relation(from=a_relation, except=exclude_columns) %}\n\n  {# We explictly select the primary_key and rename to support any sql as the primary_key -\n  a column or concatenated columns. this assumes that a_relation and b_relation do not already \n  have a field named dbt_audit_helper_pk #}\n\n  {% set a_query %}      \n    select\n      *,\n      {{ primary_key }} as dbt_audit_helper_pk\n    from {{ a_relation }}\n  {% endset %}\n\n  {% set b_query %}\n    select\n      *,\n      {{ primary_key }} as dbt_audit_helper_pk\n    from {{ b_relation }}\n  {% endset %}\n\n  {% for column_name in column_names %}\n\n    {% set audit_query = audit_helper.compare_column_values_verbose(\n      a_query=a_query,\n      b_query=b_query,\n      primary_key=\"dbt_audit_helper_pk\",\n      column_to_compare=column_name\n    ) %}\n\n    /*  Create a query combining results from all columns so that the user, or the \n    test suite, can examine all at once.\n    */\n    \n    {% if loop.first %}\n\n    /*  Create a CTE that wraps all the unioned subqueries that are created\n        in this for loop\n    */\n      with main as ( \n\n    {% endif %}\n\n    /*  There will be one audit_query subquery for each column\n    */\n    ( {{ audit_query }} )\n\n    {% if not loop.last %}\n\n      union all\n\n    {% else %}\n\n    ), \n    \n      {%- if summarize %}\n\n        final as (\n          select\n            upper(column_name) as column_name,\n            sum(case when perfect_match then 1 else 0 end) as perfect_match,\n            sum(case when null_in_a then 1 else 0 end) as null_in_a,\n            sum(case when null_in_b then 1 else 0 end) as null_in_b,\n            sum(case when missing_from_a then 1 else 0 end) as missing_from_a,\n            sum(case when missing_from_b then 1 else 0 end) as missing_from_b,\n            sum(case when conflicting_values then 1 else 0 end) as conflicting_values\n          from main\n          group by 1\n          order by column_name\n        )\n\n      {%- else %}\n\n        final as (\n          select\n            primary_key,           \n            upper(column_name) as column_name,\n            perfect_match,\n            null_in_a,\n            null_in_b,\n            missing_from_a,\n            missing_from_b,\n            conflicting_values\n          from main    \n          order by primary_key\n        )\n\n      {%- endif %}\n\n      select * from final\n    \n    {% endif %}\n\n  {% endfor %}\n    \n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_filtered_columns_in_relation", "macro.audit_helper.compare_column_values_verbose"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1733296, "supported_languages": null}, "macro.audit_helper.compare_relation_columns": {"name": "compare_relation_columns", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.compare_relation_columns", "macro_sql": "{% macro compare_relation_columns(a_relation, b_relation) %}\n  {{ return(adapter.dispatch('compare_relation_columns', 'audit_helper')(a_relation, b_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__compare_relation_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1748993, "supported_languages": null}, "macro.audit_helper.default__compare_relation_columns": {"name": "default__compare_relation_columns", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.default__compare_relation_columns", "macro_sql": "{% macro default__compare_relation_columns(a_relation, b_relation) %}\n\nwith a_cols as (\n    {{ audit_helper.get_columns_in_relation_sql(a_relation) }}\n),\n\nb_cols as (\n    {{ audit_helper.get_columns_in_relation_sql(b_relation) }}\n)\n\nselect\n    column_name,\n    a_cols.ordinal_position as a_ordinal_position,\n    b_cols.ordinal_position as b_ordinal_position,\n    a_cols.data_type as a_data_type,\n    b_cols.data_type as b_data_type,\n    coalesce(a_cols.ordinal_position = b_cols.ordinal_position, false) as has_ordinal_position_match,\n    coalesce(a_cols.data_type = b_cols.data_type, false) as has_data_type_match,\n    a_cols.data_type is not null and b_cols.data_type is null as in_a_only,\n    b_cols.data_type is not null and a_cols.data_type is null as in_b_only,\n    b_cols.data_type is not null and a_cols.data_type is not null as in_both\nfrom a_cols\nfull outer join b_cols using (column_name)\norder by coalesce(a_cols.ordinal_position, b_cols.ordinal_position)\n\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.get_columns_in_relation_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1753476, "supported_languages": null}, "macro.audit_helper.get_columns_in_relation_sql": {"name": "get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.get_columns_in_relation_sql", "macro_sql": "{% macro get_columns_in_relation_sql(relation) %}\n\n{{ adapter.dispatch('get_columns_in_relation_sql', 'audit_helper')(relation) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.bigquery__get_columns_in_relation_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1757197, "supported_languages": null}, "macro.audit_helper.default__get_columns_in_relation_sql": {"name": "default__get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.default__get_columns_in_relation_sql", "macro_sql": "{% macro default__get_columns_in_relation_sql(relation) %}\n    \n  {% set columns = adapter.get_columns_in_relation(relation) %}\n  {% for column in columns %}\n    select \n      {{ dbt.string_literal(column.name) }} as column_name, \n      {{ loop.index }} as ordinal_position,\n      {{ dbt.string_literal(column.data_type) }} as data_type\n\n  {% if not loop.last -%}\n    union all \n  {%- endif %}\n  {% endfor %}\n\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.string_literal"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1764398, "supported_languages": null}, "macro.audit_helper.redshift__get_columns_in_relation_sql": {"name": "redshift__get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.redshift__get_columns_in_relation_sql", "macro_sql": "{% macro redshift__get_columns_in_relation_sql(relation) %}\n  {# You can't store the results of an info schema query to a table/view in Redshift, because the data only lives on the leader node #}\n  {{ return (audit_helper.default__get_columns_in_relation_sql(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default__get_columns_in_relation_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1767437, "supported_languages": null}, "macro.audit_helper.snowflake__get_columns_in_relation_sql": {"name": "snowflake__get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.snowflake__get_columns_in_relation_sql", "macro_sql": "{% macro snowflake__get_columns_in_relation_sql(relation) %}\n{#-\nFrom: https://github.com/dbt-labs/dbt/blob/dev/louisa-may-alcott/plugins/snowflake/dbt/include/snowflake/macros/adapters.sql#L48\nEdited to include ordinal_position\n-#}\n  select\n      ordinal_position,\n      column_name,\n      data_type,\n      character_maximum_length,\n      numeric_precision,\n      numeric_scale\n\n  from\n  {{ relation.information_schema('columns') }}\n\n  where table_name ilike '{{ relation.identifier }}'\n    {% if relation.schema %}\n    and table_schema ilike '{{ relation.schema }}'\n    {% endif %}\n    {% if relation.database %}\n    and table_catalog ilike '{{ relation.database }}'\n    {% endif %}\n  order by ordinal_position\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1773586, "supported_languages": null}, "macro.audit_helper.postgres__get_columns_in_relation_sql": {"name": "postgres__get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.postgres__get_columns_in_relation_sql", "macro_sql": "{% macro postgres__get_columns_in_relation_sql(relation) %}\n{#-\nFrom: https://github.com/dbt-labs/dbt/blob/23484b18b71010f701b5312f920f04529ceaa6b2/plugins/postgres/dbt/include/postgres/macros/adapters.sql#L32\nEdited to include ordinal_position\n-#}\n  select\n      ordinal_position,\n      column_name,\n      data_type,\n      character_maximum_length,\n      numeric_precision,\n      numeric_scale\n\n  from {{ relation.information_schema('columns') }}\n  where table_name = '{{ relation.identifier }}'\n    {% if relation.schema %}\n    and table_schema = '{{ relation.schema }}'\n    {% endif %}\n  order by ordinal_position\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_profiler.information_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1779087, "supported_languages": null}, "macro.audit_helper.bigquery__get_columns_in_relation_sql": {"name": "bigquery__get_columns_in_relation_sql", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/compare_relation_columns.sql", "original_file_path": "macros/compare_relation_columns.sql", "unique_id": "macro.audit_helper.bigquery__get_columns_in_relation_sql", "macro_sql": "{% macro bigquery__get_columns_in_relation_sql(relation) %}\n\n  select\n      ordinal_position,\n      column_name,\n      data_type\n\n  from `{{ relation.database }}`.`{{ relation.schema }}`.INFORMATION_SCHEMA.COLUMNS\n  where table_name = '{{ relation.identifier }}'\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1782308, "supported_languages": null}, "macro.audit_helper._get_comparison_bounds": {"name": "_get_comparison_bounds", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_get_comparison_bounds.sql", "original_file_path": "macros/utils/_get_comparison_bounds.sql", "unique_id": "macro.audit_helper._get_comparison_bounds", "macro_sql": "{% macro _get_comparison_bounds(a_query, b_query, event_time) %}\n    {% set min_max_queries %}\n        with min_maxes as (\n            select min({{ event_time }}) as min_event_time, max({{ event_time }}) as max_event_time\n            from ({{ a_query }}) a_subq\n            union all \n            select min({{ event_time }}) as min_event_time, max({{ event_time }}) as max_event_time\n            from ({{ b_query }}) b_subq\n        )\n        select max(min_event_time) as min_event_time, min(max_event_time) as max_event_time\n        from min_maxes\n    {% endset %}\n\n    {% set query_response = dbt_utils.get_query_results_as_dict(min_max_queries) %}\n    \n    {% set event_time_props = {\"event_time\": event_time} %}\n    \n    {# query_response.keys() are only `min_event_time` and `max_event_time`, but they have indeterminate capitalisation #}\n    {# hence the dynamic approach for what is otherwise just two well-known values #}\n    {% for k in query_response.keys() %}\n        {% do event_time_props.update({k | lower: query_response[k][0]}) %}\n    {% endfor %}\n    \n    {% do return(event_time_props) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_query_results_as_dict"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1803105, "supported_languages": null}, "macro.audit_helper.event_time_filter": {"name": "event_time_filter", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_get_comparison_bounds.sql", "original_file_path": "macros/utils/_get_comparison_bounds.sql", "unique_id": "macro.audit_helper.event_time_filter", "macro_sql": "{% macro event_time_filter(event_time_props) %}\n    {% if event_time_props %}\n        where {{ event_time_props[\"event_time\"] }} >= '{{ event_time_props[\"min_event_time\"] }}'\n        and {{ event_time_props[\"event_time\"] }} <= '{{ event_time_props[\"max_event_time\"] }}'\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1808834, "supported_languages": null}, "macro.audit_helper._generate_null_safe_surrogate_key": {"name": "_generate_null_safe_surrogate_key", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_null_safe_sk.sql", "original_file_path": "macros/utils/_generate_null_safe_sk.sql", "unique_id": "macro.audit_helper._generate_null_safe_surrogate_key", "macro_sql": "\n\n{%- macro _generate_null_safe_surrogate_key(field_list) -%}\n    {{ return(adapter.dispatch('_generate_null_safe_surrogate_key', 'audit_helper')(field_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default___generate_null_safe_surrogate_key"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1814823, "supported_languages": null}, "macro.audit_helper.default___generate_null_safe_surrogate_key": {"name": "default___generate_null_safe_surrogate_key", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_null_safe_sk.sql", "original_file_path": "macros/utils/_generate_null_safe_sk.sql", "unique_id": "macro.audit_helper.default___generate_null_safe_surrogate_key", "macro_sql": "\n\n{%- macro default___generate_null_safe_surrogate_key(field_list) -%}\n\n{%- set fields = [] -%}\n\n{%- for field in field_list -%}\n\n    {%- do fields.append(\n        \"coalesce(cast(\" ~ field ~ \" as \" ~ dbt.type_string() ~ \"), '_dbt_audit_helper_surrogate_key_null_')\"\n    ) -%}\n\n    {%- if not loop.last %}\n        {%- do fields.append(\"'-'\") -%}\n    {%- endif -%}\n\n{%- endfor -%}\n\n{{ dbt.hash(dbt.concat(fields)) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.type_string", "macro.dbt.hash", "macro.dbt.concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1822865, "supported_languages": null}, "macro.audit_helper._generate_set_results": {"name": "_generate_set_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_set_results.sql", "original_file_path": "macros/utils/_generate_set_results.sql", "unique_id": "macro.audit_helper._generate_set_results", "macro_sql": "{% macro _generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props=None) %}\n  {{ return(adapter.dispatch('_generate_set_results', 'audit_helper')(a_query, b_query, primary_key_columns, columns, event_time_props)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.bigquery___generate_set_results"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.188505, "supported_languages": null}, "macro.audit_helper.default___generate_set_results": {"name": "default___generate_set_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_set_results.sql", "original_file_path": "macros/utils/_generate_set_results.sql", "unique_id": "macro.audit_helper.default___generate_set_results", "macro_sql": "{% macro default___generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props) %}\n    {% set joined_cols = columns | join(\", \") %}\n\n    a_base as (\n        select \n            {{ joined_cols }}, \n            {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key\n        from ( {{-  a_query  -}} ) a_base_subq\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    b_base as (\n        select \n            {{ joined_cols }}, \n            {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key\n        from ( {{-  b_query  -}} ) b_base_subq\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    a as (\n        select \n            *, \n            row_number() over (partition by dbt_audit_surrogate_key order by dbt_audit_surrogate_key) as dbt_audit_pk_row_num\n        from a_base\n    ),\n\n    b as (\n        select \n            *, \n            row_number() over (partition by dbt_audit_surrogate_key order by dbt_audit_surrogate_key) as dbt_audit_pk_row_num\n        from b_base\n    ),\n\n    a_intersect_b as (\n\n        select * from a\n        {{ dbt.intersect() }}\n        select * from b\n\n    ),\n\n    a_except_b as (\n\n        select * from a\n        {{ dbt.except() }}\n        select * from b\n\n    ),\n\n    b_except_a as (\n\n        select * from b\n        {{ dbt.except() }}\n        select * from a\n\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._generate_null_safe_surrogate_key", "macro.audit_helper.event_time_filter", "macro.dbt.intersect", "macro.dbt.except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1896598, "supported_languages": null}, "macro.audit_helper.bigquery___generate_set_results": {"name": "bigquery___generate_set_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_set_results.sql", "original_file_path": "macros/utils/_generate_set_results.sql", "unique_id": "macro.audit_helper.bigquery___generate_set_results", "macro_sql": "{% macro bigquery___generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props) %}\n    {% set joined_cols = columns | join(\", \") %}\n    {% set surrogate_key = audit_helper._generate_null_safe_surrogate_key(primary_key_columns) %}\n    subset_columns_a as (\n        select \n            {{ joined_cols }}, \n            {{ surrogate_key }} as dbt_audit_surrogate_key,\n            row_number() over (partition by {{ surrogate_key }} order by 1 ) as dbt_audit_pk_row_num\n        from ( {{-  a_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    subset_columns_b as (\n        select \n            {{ joined_cols }}, \n            {{ surrogate_key }} as dbt_audit_surrogate_key,\n            row_number() over (partition by {{ surrogate_key }} order by 1 ) as dbt_audit_pk_row_num\n        from ( {{-  b_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    a as (\n        select\n            *,\n            farm_fingerprint(to_json_string(subset_columns_a)) as dbt_audit_row_hash\n        from subset_columns_a\n    ), \n\n    b as (\n        select\n            *,\n            farm_fingerprint(to_json_string(subset_columns_b)) as dbt_audit_row_hash\n        from subset_columns_b\n    ),\n\n    a_intersect_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    a_except_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash not in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    b_except_a as (\n\n        select * from b\n        where b.dbt_audit_row_hash not in (select a.dbt_audit_row_hash from a)\n\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._generate_null_safe_surrogate_key", "macro.audit_helper.event_time_filter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1907294, "supported_languages": null}, "macro.audit_helper.databricks___generate_set_results": {"name": "databricks___generate_set_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_set_results.sql", "original_file_path": "macros/utils/_generate_set_results.sql", "unique_id": "macro.audit_helper.databricks___generate_set_results", "macro_sql": "{% macro databricks___generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props) %}\n    {% set cast_columns = [] %}\n    {# Map types can't be compared by default (you need to opt in to a legacy behaviour flag) #}\n    {# so everything needs to be cast as a string first :( #}\n    {% for col in columns %}\n        {% do cast_columns.append(dbt.cast(col, api.Column.translate_type(\"string\"))) %}\n    {% endfor %}\n    {% set joined_cols = cast_columns | join(\", \") %}\n    {% set surrogate_key = audit_helper._generate_null_safe_surrogate_key(primary_key_columns) %}\n    a as (\n        select \n            {{ joined_cols }}, \n            {{ surrogate_key }} as dbt_audit_surrogate_key,\n            row_number() over (partition by {{ surrogate_key }} order by 1 ) as dbt_audit_pk_row_num,\n            xxhash64({{ joined_cols }}, dbt_audit_pk_row_num) as dbt_audit_row_hash\n        from ( {{-  a_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    b as (\n        select \n            {{ joined_cols }}, \n            {{ surrogate_key }} as dbt_audit_surrogate_key,\n            row_number() over (partition by {{ surrogate_key }} order by 1 ) as dbt_audit_pk_row_num,\n            xxhash64({{ joined_cols }}, dbt_audit_pk_row_num) as dbt_audit_row_hash\n        from ( {{-  b_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    a_intersect_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    a_except_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash not in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    b_except_a as (\n\n        select * from b\n        where b.dbt_audit_row_hash not in (select a.dbt_audit_row_hash from a)\n\n    )   \n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._generate_null_safe_surrogate_key", "macro.audit_helper.event_time_filter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1922324, "supported_languages": null}, "macro.audit_helper.snowflake___generate_set_results": {"name": "snowflake___generate_set_results", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_generate_set_results.sql", "original_file_path": "macros/utils/_generate_set_results.sql", "unique_id": "macro.audit_helper.snowflake___generate_set_results", "macro_sql": "{% macro snowflake___generate_set_results(a_query, b_query, primary_key_columns, columns, event_time_props) %}\n    {% set joined_cols = columns | join(\", \") %}\n    a as (\n        select \n            {{ joined_cols }}, \n            {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key,\n            row_number() over (partition by dbt_audit_surrogate_key order by dbt_audit_surrogate_key ) as dbt_audit_pk_row_num,\n            hash({{ joined_cols }}, dbt_audit_pk_row_num) as dbt_audit_row_hash\n        from ( {{-  a_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    b as (\n        select \n            {{ joined_cols }}, \n            {{ audit_helper._generate_null_safe_surrogate_key(primary_key_columns) }} as dbt_audit_surrogate_key,\n            row_number() over (partition by dbt_audit_surrogate_key order by dbt_audit_surrogate_key ) as dbt_audit_pk_row_num,\n            hash({{ joined_cols }}, dbt_audit_pk_row_num) as dbt_audit_row_hash\n        from ( {{-  b_query  -}} )\n        {{ audit_helper.event_time_filter(event_time_props) }}\n    ),\n\n    a_intersect_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    a_except_b as (\n\n        select * from a\n        where a.dbt_audit_row_hash not in (select b.dbt_audit_row_hash from b)\n\n    ),\n\n    b_except_a as (\n\n        select * from b\n        where b.dbt_audit_row_hash not in (select a.dbt_audit_row_hash from a)\n\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._generate_null_safe_surrogate_key", "macro.audit_helper.event_time_filter"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1932178, "supported_languages": null}, "macro.audit_helper._count_num_rows_in_status": {"name": "_count_num_rows_in_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper._count_num_rows_in_status", "macro_sql": "{% macro _count_num_rows_in_status() %}\n    {{ return(adapter.dispatch('_count_num_rows_in_status', 'audit_helper')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.bigquery___count_num_rows_in_status"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1939611, "supported_languages": null}, "macro.audit_helper.default___count_num_rows_in_status": {"name": "default___count_num_rows_in_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper.default___count_num_rows_in_status", "macro_sql": "\n\n{%- macro default___count_num_rows_in_status() -%}\n    count(distinct dbt_audit_surrogate_key, dbt_audit_pk_row_num) over (partition by dbt_audit_row_status)\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1941266, "supported_languages": null}, "macro.audit_helper.bigquery___count_num_rows_in_status": {"name": "bigquery___count_num_rows_in_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper.bigquery___count_num_rows_in_status", "macro_sql": "\n\n{%- macro bigquery___count_num_rows_in_status() -%}\n    count(distinct {{ dbt.concat([\"dbt_audit_surrogate_key\", \"dbt_audit_pk_row_num\"]) }}) over (partition by dbt_audit_row_status)\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1944234, "supported_languages": null}, "macro.audit_helper.postgres___count_num_rows_in_status": {"name": "postgres___count_num_rows_in_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper.postgres___count_num_rows_in_status", "macro_sql": "\n\n{%- macro postgres___count_num_rows_in_status() -%}\n    {{ audit_helper._count_num_rows_in_status_without_distinct_window_func() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._count_num_rows_in_status_without_distinct_window_func"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.194652, "supported_languages": null}, "macro.audit_helper.databricks___count_num_rows_in_status": {"name": "databricks___count_num_rows_in_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper.databricks___count_num_rows_in_status", "macro_sql": "\n\n{%- macro databricks___count_num_rows_in_status() -%}\n    {{ audit_helper._count_num_rows_in_status_without_distinct_window_func() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper._count_num_rows_in_status_without_distinct_window_func"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.194893, "supported_languages": null}, "macro.audit_helper._count_num_rows_in_status_without_distinct_window_func": {"name": "_count_num_rows_in_status_without_distinct_window_func", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_count_num_rows_in_status.sql", "original_file_path": "macros/utils/_count_num_rows_in_status.sql", "unique_id": "macro.audit_helper._count_num_rows_in_status_without_distinct_window_func", "macro_sql": "{% macro _count_num_rows_in_status_without_distinct_window_func() %}\n    {#- Some platforms don't support count(distinct) inside of window functions -#}\n    {#- You can get the same outcome by dense_rank, assuming no nulls (we've already handled that) #}\n    {# https://stackoverflow.com/a/22347502 -#}\n    dense_rank() over (partition by dbt_audit_row_status order by dbt_audit_surrogate_key, dbt_audit_pk_row_num)\n    + dense_rank() over (partition by dbt_audit_row_status order by dbt_audit_surrogate_key desc, dbt_audit_pk_row_num desc)\n    - 1\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1950922, "supported_languages": null}, "macro.audit_helper._ensure_all_pks_are_in_column_set": {"name": "_ensure_all_pks_are_in_column_set", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_ensure_all_pks_are_in_column_set.sql", "original_file_path": "macros/utils/_ensure_all_pks_are_in_column_set.sql", "unique_id": "macro.audit_helper._ensure_all_pks_are_in_column_set", "macro_sql": "{% macro _ensure_all_pks_are_in_column_set(primary_key_columns, columns) %}\n    {% set lower_cols = columns | map('lower') | list %}\n    {% set missing_pks = [] %}\n\n    {% for pk in primary_key_columns %}\n        {% if pk | lower not in lower_cols %}\n            {% do missing_pks.append(pk) %}\n        {% endif %}\n    {% endfor %}\n\n    {% if missing_pks | length > 0 %}\n        {% set columns = missing_pks + columns %}\n    {% endif %}\n    \n    {% do return (columns) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1964045, "supported_languages": null}, "macro.audit_helper._classify_audit_row_status": {"name": "_classify_audit_row_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_classify_audit_row_status.sql", "original_file_path": "macros/utils/_classify_audit_row_status.sql", "unique_id": "macro.audit_helper._classify_audit_row_status", "macro_sql": "{% macro _classify_audit_row_status() %}\n    {{ return(adapter.dispatch('_classify_audit_row_status', 'audit_helper')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.audit_helper.default___classify_audit_row_status"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1970496, "supported_languages": null}, "macro.audit_helper.default___classify_audit_row_status": {"name": "default___classify_audit_row_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_classify_audit_row_status.sql", "original_file_path": "macros/utils/_classify_audit_row_status.sql", "unique_id": "macro.audit_helper.default___classify_audit_row_status", "macro_sql": "\n\n{%- macro default___classify_audit_row_status() -%}\n    case \n        when max(dbt_audit_pk_row_num) over (partition by dbt_audit_surrogate_key) > 1 then 'nonunique_pk'\n        when dbt_audit_in_a and dbt_audit_in_b then 'identical'\n        when {{ dbt.bool_or('dbt_audit_in_a') }} over (partition by dbt_audit_surrogate_key, dbt_audit_pk_row_num) \n            and {{ dbt.bool_or('dbt_audit_in_b') }} over (partition by dbt_audit_surrogate_key, dbt_audit_pk_row_num)\n            then 'modified'\n        when dbt_audit_in_a then 'removed'\n        when dbt_audit_in_b then 'added'\n    end\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.bool_or"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.197411, "supported_languages": null}, "macro.audit_helper.redshift___classify_audit_row_status": {"name": "redshift___classify_audit_row_status", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_classify_audit_row_status.sql", "original_file_path": "macros/utils/_classify_audit_row_status.sql", "unique_id": "macro.audit_helper.redshift___classify_audit_row_status", "macro_sql": "\n\n\n{%- macro redshift___classify_audit_row_status() -%}\n    {#- Redshift doesn't support bitwise operations (e.g. bool_or) inside of a window function :( -#}\n    case \n        when max(dbt_audit_pk_row_num) over (partition by dbt_audit_surrogate_key) > 1 then 'nonunique_pk'\n        when dbt_audit_in_a and dbt_audit_in_b then 'identical'\n        when max(case when dbt_audit_in_a then 1 else 0 end) over (partition by dbt_audit_surrogate_key, dbt_audit_pk_row_num) = 1\n            and max(case when dbt_audit_in_b then 1 else 0 end) over (partition by dbt_audit_surrogate_key, dbt_audit_pk_row_num) = 1\n            then 'modified'\n        when dbt_audit_in_a then 'removed'\n        when dbt_audit_in_b then 'added'\n    end{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.1976197, "supported_languages": null}, "macro.audit_helper._get_intersecting_columns_from_relations": {"name": "_get_intersecting_columns_from_relations", "resource_type": "macro", "package_name": "audit_helper", "path": "macros/utils/_get_intersecting_columns_from_relations.sql", "original_file_path": "macros/utils/_get_intersecting_columns_from_relations.sql", "unique_id": "macro.audit_helper._get_intersecting_columns_from_relations", "macro_sql": "{% macro _get_intersecting_columns_from_relations(a_relation, b_relation) %}        \n    {%- set a_cols = dbt_utils.get_filtered_columns_in_relation(a_relation) -%}\n    {%- set b_cols = dbt_utils.get_filtered_columns_in_relation(b_relation) -%}\n    \n    {%- set intersection = [] -%}\n    {%- for col in a_cols -%}\n        {%- if col in b_cols -%}\n            {%- do intersection.append(col) -%}\n        {%- endif -%}\n    {%- endfor -%}\n\n    {% do return(intersection) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_utils.get_filtered_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1727709585.198772, "supported_languages": null}}, "docs": {"doc.rj_smtr.consorcio": {"name": "consorcio", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.consorcio", "block_contents": "Cons\u00f3rcio ao qual o servi\u00e7o pertence."}, "doc.rj_smtr.id_veiculo": {"name": "id_veiculo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.id_veiculo", "block_contents": "C\u00f3digo identificador do ve\u00edculo (n\u00famero de ordem)."}, "doc.rj_smtr.datetime_ultima_atualizacao": {"name": "datetime_ultima_atualizacao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.datetime_ultima_atualizacao", "block_contents": "\u00daltima atualiza\u00e7\u00e3o (GMT-3)."}, "doc.rj_smtr.datetime_partida": {"name": "datetime_partida", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.datetime_partida", "block_contents": "Hor\u00e1rio de in\u00edcio da viagem."}, "doc.rj_smtr.datetime_chegada": {"name": "datetime_chegada", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.datetime_chegada", "block_contents": "Hor\u00e1rio de fim da viagem."}, "doc.rj_smtr.distancia_planejada": {"name": "distancia_planejada", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.distancia_planejada", "block_contents": "Dist\u00e2ncia do shape (trajeto) planejado (km)."}, "doc.rj_smtr.tipo_viagem_status": {"name": "tipo_viagem_status", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_viagem_status", "block_contents": "Classifica\u00e7\u00e3o do tipo de viagem."}, "doc.rj_smtr.servico": {"name": "servico", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.servico", "block_contents": "Servi\u00e7o realizado pelo ve\u00edculo."}, "doc.rj_smtr.id_viagem": {"name": "id_viagem", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.id_viagem", "block_contents": "C\u00f3digo \u00fanico identificador da viagem."}, "doc.rj_smtr.project_id": {"name": "project_id", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.project_id", "block_contents": "Nome do projeto (rj-smtr)"}, "doc.rj_smtr.dataset_id": {"name": "dataset_id", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.dataset_id", "block_contents": "Nome do conjunto de dados"}, "doc.rj_smtr.table_id": {"name": "table_id", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.table_id", "block_contents": "Nome da tabela"}, "doc.rj_smtr.column_name": {"name": "column_name", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.column_name", "block_contents": "Nome da coluna"}, "doc.rj_smtr.data_type": {"name": "data_type", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.data_type", "block_contents": "Tipo de dado da coluna"}, "doc.rj_smtr.metadado_descricao": {"name": "metadado_descricao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.metadado_descricao", "block_contents": "Descri\u00e7\u00e3o da coluna"}, "doc.rj_smtr.timestamp_gps": {"name": "timestamp_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.timestamp_gps", "block_contents": "Timestamp de emiss\u00e3o do sinal de GPS"}, "doc.rj_smtr.data_gps": {"name": "data_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.data_gps", "block_contents": "Data do timestamp de emiss\u00e3o do sinal de GPS"}, "doc.rj_smtr.hora_gps": {"name": "hora_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.hora_gps", "block_contents": "Hora do timestamp de emiss\u00e3o do sinal de GPS"}, "doc.rj_smtr.latitude_gps": {"name": "latitude_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.latitude_gps", "block_contents": "Parte da coordenada geogr\u00e1fica (eixo y) em graus decimais (EPSG:4326 - WGS84)"}, "doc.rj_smtr.longitude_gps": {"name": "longitude_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.longitude_gps", "block_contents": "Parte da coordenada geogr\u00e1fica (eixo x) em graus decimais (EPSG:4326 - WGS84)"}, "doc.rj_smtr.flag_em_movimento": {"name": "flag_em_movimento", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.flag_em_movimento", "block_contents": "Ve\u00edculos com 'velocidade' abaixo da 'velocidade_limiar_parado', s\u00e3o considerados como parado (false). Caso contr\u00e1rio, s\u00e3o considerados andando (true)"}, "doc.rj_smtr.flag_trajeto_correto_hist": {"name": "flag_trajeto_correto_hist", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.flag_trajeto_correto_hist", "block_contents": "Flag de verifica\u00e7\u00e3o se, nos \u00faltimos 'intervalo_max_desvio_segundos', ao menos algum ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false."}, "doc.rj_smtr.flag_em_operacao": {"name": "flag_em_operacao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.flag_em_operacao", "block_contents": "Ve\u00edculos com as flags 'flag_em_movimento' e 'flag_trajeto_correto_hist' com valor true s\u00e3o considerados como em opera\u00e7\u00e3o."}, "doc.rj_smtr.tipo_parada": {"name": "tipo_parada", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_parada", "block_contents": "Identifica ve\u00edculos parados em terminais ou garagens."}, "doc.rj_smtr.flag_linha_existe_sigmob": {"name": "flag_linha_existe_sigmob", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.flag_linha_existe_sigmob", "block_contents": "Flag de verifica\u00e7\u00e3o se a linha informada existe no SIGMOB."}, "doc.rj_smtr.flag_trajeto_correto": {"name": "flag_trajeto_correto", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.flag_trajeto_correto", "block_contents": "Flag de verifica\u00e7\u00e3o se o ponto de GPS encontra-se at\u00e9 o limite de 'tamanho_buffer_metros' do shape da linha (true). Se n\u00e3o estiver, retorna false."}, "doc.rj_smtr.status_veiculo_gps": {"name": "status_veiculo_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.status_veiculo_gps", "block_contents": "\"Em Opera\u00e7\u00e3o\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 true.\n\"Operando fora do trajeto\": Quando 'flag_em_movimento' \u00e9 true e 'flag_trajeto_correto_hist' \u00e9 false.\n\"Parado\": Quando 'flag_em_movimento' \u00e9 false:\n - Se 'tipo_parada' n\u00e3o \u00e9 nulo, o ve\u00edculo \u00e9 considerado \"Parado\" seguido pelo tipo de parada (ex.: \"Parado terminal\").\n - Se 'tipo_parada' \u00e9 nulo:\n    - Se 'flag_trajeto_correto_hist' \u00e9 true, o status \u00e9 \"Parado trajeto correto\".\n    - Se 'flag_trajeto_correto_hist' \u00e9 false, o status \u00e9 \"Parado fora trajeto\"."}, "doc.rj_smtr.velocidade_instantanea": {"name": "velocidade_instantanea", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.velocidade_instantanea", "block_contents": "Velocidade instant\u00e2nea do ve\u00edculo, conforme informado pelo GPS (km/h)"}, "doc.rj_smtr.velocidade_estimada_10_min": {"name": "velocidade_estimada_10_min", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.velocidade_estimada_10_min", "block_contents": "Velocidade m\u00e9dia nos \u00faltimos 10 minutos de opera\u00e7\u00e3o (km/h)"}, "doc.rj_smtr.distancia_gps": {"name": "distancia_gps", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.distancia_gps", "block_contents": "Dist\u00e2ncia da \u00faltima posi\u00e7\u00e3o do GPS em rela\u00e7\u00e3o \u00e0 posi\u00e7\u00e3o atual (m)"}, "doc.rj_smtr.versao": {"name": "versao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.versao", "block_contents": "C\u00f3digo de controle de vers\u00e3o do dado (SHA Github)"}, "doc.rj_smtr.id_validador": {"name": "id_validador", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.id_validador", "block_contents": "N\u00famero de s\u00e9rie do validador"}, "doc.rj_smtr.quantidade_total_transacao": {"name": "quantidade_total_transacao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.quantidade_total_transacao", "block_contents": "Quantidade total de transa\u00e7\u00f5es realizadas"}, "doc.rj_smtr.tipo_gratuidade": {"name": "tipo_gratuidade", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_gratuidade", "block_contents": "Tipo da gratuidade (Estudante, PCD, S\u00eanior)"}, "doc.rj_smtr.tipo_pagamento": {"name": "tipo_pagamento", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_pagamento", "block_contents": "Tipo de pagamento utilizado"}, "doc.rj_smtr.tipo_dia": {"name": "tipo_dia", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_dia", "block_contents": "Dia da semana - categorias: Dia \u00datil, S\u00e1bado, Domingo"}, "doc.rj_smtr.faixa_horaria_inicio": {"name": "faixa_horaria_inicio", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.faixa_horaria_inicio", "block_contents": "Hor\u00e1rio inicial da faixa hor\u00e1ria"}, "doc.rj_smtr.faixa_horaria_fim": {"name": "faixa_horaria_fim", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.faixa_horaria_fim", "block_contents": "Hor\u00e1rio final da faixa hor\u00e1ria"}, "doc.rj_smtr.partidas": {"name": "partidas", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.partidas", "block_contents": "Quantidade de partidas planejadas"}, "doc.rj_smtr.quilometragem": {"name": "quilometragem", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.quilometragem", "block_contents": "Quilometragem planejada"}, "doc.rj_smtr.timestamp_captura": {"name": "timestamp_captura", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.timestamp_captura", "block_contents": "Timestamp de captura pela SMTR"}, "doc.rj_smtr.data_versao": {"name": "data_versao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.data_versao", "block_contents": "Data de refer\u00eancia do planejamento (vers\u00e3o)."}, "doc.rj_smtr.content": {"name": "content", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.content", "block_contents": "Dados brutos capturados aninhados em formato JSON"}, "doc.rj_smtr.modo": {"name": "modo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.modo", "block_contents": "Tipo de transporte (\u00d4nibus, Van, BRT)"}, "doc.rj_smtr.vista": {"name": "vista", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.vista", "block_contents": "Itiner\u00e1rio do servi\u00e7o (ex: Bananal \u2194 Saens Pe\u00f1a)"}, "doc.rj_smtr.viagens_planejadas": {"name": "viagens_planejadas", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.viagens_planejadas", "block_contents": "Viagens planejadas no per\u00edodo"}, "doc.rj_smtr.inicio_periodo": {"name": "inicio_periodo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.inicio_periodo", "block_contents": "In\u00edcio do per\u00edodo de opera\u00e7\u00e3o planejado"}, "doc.rj_smtr.fim_periodo": {"name": "fim_periodo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.fim_periodo", "block_contents": "Fim do per\u00edodo de opera\u00e7\u00e3o planejado"}, "doc.rj_smtr.feed_start_date": {"name": "feed_start_date", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.feed_start_date", "block_contents": "(Parti\u00e7\u00e3o) Data inicial do feed (vers\u00e3o)."}, "doc.rj_smtr.linha": {"name": "linha", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.linha", "block_contents": "N\u00famero da Linha"}, "doc.rj_smtr.tipo_servico": {"name": "tipo_servico", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tipo_servico", "block_contents": "Tipo de Servi\u00e7o da Linha"}, "doc.rj_smtr.ordem_servico": {"name": "ordem_servico", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.ordem_servico", "block_contents": "Ordem de Servi\u00e7o da Linha"}, "doc.rj_smtr.codigo_veiculo": {"name": "codigo_veiculo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.codigo_veiculo", "block_contents": "C\u00f3digo do Tipo de Ve\u00edculo do Servi\u00e7o"}, "doc.rj_smtr.tarifa_codigo": {"name": "tarifa_codigo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tarifa_codigo", "block_contents": "Tarifa determinada"}, "doc.rj_smtr.tarifa_valor": {"name": "tarifa_valor", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.tarifa_valor", "block_contents": "Tarifa Praticada"}, "doc.rj_smtr.frota_determinada": {"name": "frota_determinada", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.frota_determinada", "block_contents": "Frota Determinada"}, "doc.rj_smtr.frota_licenciada": {"name": "frota_licenciada", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.frota_licenciada", "block_contents": "Frota Licenciada para a linha"}, "doc.rj_smtr.frota_operante": {"name": "frota_operante", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.frota_operante", "block_contents": "Frota Operacional do dia"}, "doc.rj_smtr.qtd_viagens": {"name": "qtd_viagens", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_viagens", "block_contents": "N\u00famero de Viagens da Linha no dia"}, "doc.rj_smtr.qtd_km_cobertos": {"name": "qtd_km_cobertos", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_km_cobertos", "block_contents": "Quilometragem Coberta"}, "doc.rj_smtr.qtd_grt_idoso": {"name": "qtd_grt_idoso", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_idoso", "block_contents": "Gratuidades Transportadas - Idosos"}, "doc.rj_smtr.qtd_grt_especial": {"name": "qtd_grt_especial", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_especial", "block_contents": "Gratuidades Transportadas - Portadores de Necessidades Especiais"}, "doc.rj_smtr.qtd_grt_estud_federal": {"name": "qtd_grt_estud_federal", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_estud_federal", "block_contents": "Gratuidades Transportadas - Estudantes da Uni\u00e3o"}, "doc.rj_smtr.qtd_grt_estud_estadual": {"name": "qtd_grt_estud_estadual", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_estud_estadual", "block_contents": "Gratuidades Transportadas - Estudantes do Estado"}, "doc.rj_smtr.qtd_grt_estud_municipal": {"name": "qtd_grt_estud_municipal", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_estud_municipal", "block_contents": "Gratuidades Transportadas - Estudantes do Munic\u00edpio"}, "doc.rj_smtr.qtd_grt_rodoviario": {"name": "qtd_grt_rodoviario", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_rodoviario", "block_contents": "Gratuidades Transportadas - Funcion\u00e1rios das Empresas"}, "doc.rj_smtr.qtd_buc_1_perna": {"name": "qtd_buc_1_perna", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_buc_1_perna", "block_contents": "Bilhete \u00fanico Carioca (1\u00aa Perna)"}, "doc.rj_smtr.qtd_buc_2_perna_integracao": {"name": "qtd_buc_2_perna_integracao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_buc_2_perna_integracao", "block_contents": "Bilhete \u00danico Carioca (2\u00aa Perna)"}, "doc.rj_smtr.receita_buc": {"name": "receita_buc", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.receita_buc", "block_contents": "Receita de Bilhete \u00danico Carioca"}, "doc.rj_smtr.qtd_buc_supervia_1_perna": {"name": "qtd_buc_supervia_1_perna", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_buc_supervia_1_perna", "block_contents": "Bilhete \u00fanico Carioca - Supervia (1\u00aa Perna)"}, "doc.rj_smtr.qtd_buc_supervia_2_perna_integracao": {"name": "qtd_buc_supervia_2_perna_integracao", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_buc_supervia_2_perna_integracao", "block_contents": "Bilhete \u00danico Carioca - Supervia (2\u00aa Perna)"}, "doc.rj_smtr.receita_buc_supervia": {"name": "receita_buc_supervia", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.receita_buc_supervia", "block_contents": "Receita de Bilhete \u00danico Carioca - Supervia"}, "doc.rj_smtr.qtd_cartoes_perna_unica_e_demais": {"name": "qtd_cartoes_perna_unica_e_demais", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_cartoes_perna_unica_e_demais", "block_contents": "Cart\u00f5es Perna \u00danica e demais transa\u00e7\u00f5es valoradas n\u00e3o contempladas nos campos deste RDO"}, "doc.rj_smtr.receita_cartoes_perna_unica_e_demais": {"name": "receita_cartoes_perna_unica_e_demais", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.receita_cartoes_perna_unica_e_demais", "block_contents": "Receita Cart\u00f5es Perna \u00danica e Receita das demais transa\u00e7\u00f5es valoradas n\u00e3o contempladas nos campos deste RDO"}, "doc.rj_smtr.qtd_pagamentos_especie": {"name": "qtd_pagamentos_especie", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_pagamentos_especie", "block_contents": "Passageiros Pagantes em Esp\u00e9cie"}, "doc.rj_smtr.receita_especie": {"name": "receita_especie", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.receita_especie", "block_contents": "Receita Passageiros Pagantes em Esp\u00e9cie"}, "doc.rj_smtr.qtd_grt_passe_livre_universitario": {"name": "qtd_grt_passe_livre_universitario", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_grt_passe_livre_universitario", "block_contents": "Gratuidades Transportadas - Passe Livre Universit\u00e1rio"}, "doc.rj_smtr.class_servico": {"name": "class_servico", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.class_servico", "block_contents": "Classifica\u00e7\u00e3o do Servi\u00e7o: Diret\u00e3o, Esta\u00e7\u00e3o do BRT, Rodovi\u00e1rio, Troncal do BRT, Urbano."}, "doc.rj_smtr.qtd_passageiros_total": {"name": "qtd_passageiros_total", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.qtd_passageiros_total", "block_contents": "Quantidade total de passageiros"}, "doc.rj_smtr.codigo": {"name": "codigo", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.codigo", "block_contents": "N\u00famero de ordem do ve\u00edculo."}, "doc.rj_smtr.trajeto": {"name": "trajeto", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.trajeto", "block_contents": "Nome do trajeto."}, "doc.rj_smtr.sentido": {"name": "sentido", "resource_type": "doc", "package_name": "rj_smtr", "path": "docs.md", "original_file_path": "models/docs.md", "unique_id": "doc.rj_smtr.sentido", "block_contents": "Sentido da linha"}, "doc.dbt.__overview__": {"name": "__overview__", "resource_type": "doc", "package_name": "dbt", "path": "overview.md", "original_file_path": "docs/overview.md", "unique_id": "doc.dbt.__overview__", "block_contents": "### Welcome!\n\nWelcome to the auto-generated documentation for your dbt project!\n\n### Navigation\n\nYou can use the `Project` and `Database` navigation tabs on the left side of the window to explore the models\nin your project.\n\n#### Project Tab\nThe `Project` tab mirrors the directory structure of your dbt project. In this tab, you can see all of the\nmodels defined in your dbt project, as well as models imported from dbt packages.\n\n#### Database Tab\nThe `Database` tab also exposes your models, but in a format that looks more like a database explorer. This view\nshows relations (tables and views) grouped into database schemas. Note that ephemeral models are _not_ shown\nin this interface, as they do not exist in the database.\n\n### Graph Exploration\nYou can click the blue icon on the bottom-right corner of the page to view the lineage graph of your models.\n\nOn model pages, you'll see the immediate parents and children of the model you're exploring. By clicking the `Expand`\nbutton at the top-right of this lineage pane, you'll be able to see all of the models that are used to build,\nor are built from, the model you're exploring.\n\nOnce expanded, you'll be able to use the `--select` and `--exclude` model selection syntax to filter the\nmodels in the graph. For more information on model selection, check out the [dbt docs](https://docs.getdbt.com/docs/model-selection-syntax).\n\nNote that you can also right-click on models to interactively filter and explore the graph.\n\n---\n\n### More information\n\n- [What is dbt](https://docs.getdbt.com/docs/introduction)?\n- Read the [dbt viewpoint](https://docs.getdbt.com/docs/viewpoint)\n- [Installation](https://docs.getdbt.com/docs/installation)\n- Join the [dbt Community](https://www.getdbt.com/community/) for questions and discussion"}}, "exposures": {}, "metrics": {}, "groups": {}, "selectors": {"apuracao_subsidio_v8": {"name": "apuracao_subsidio_v8", "description": "Apura\u00e7\u00e3o sem faixa hor\u00e1ria", "definition": {"union": [{"method": "path", "value": "models/dashboard_subsidio_sppo_staging"}, {"method": "fqn", "value": "viagem_transacao"}, {"method": "path", "value": "models/dashboard_subsidio_sppo"}]}}, "apuracao_subsidio_v9": {"name": "apuracao_subsidio_v9", "description": "Apura\u00e7\u00e3o com faixa hor\u00e1ria", "definition": {"union": [{"method": "path", "value": "models/dashboard_subsidio_sppo_staging"}, {"method": "fqn", "value": "viagem_transacao"}, {"method": "fqn", "value": "viagens_remuneradas"}, {"method": "path", "value": "models/financeiro"}, {"method": "path", "value": "models/dashboard_subsidio_sppo_v2"}]}}}, "disabled": {"model.rj_smtr.balanco_servico_dia_pos_gt": [{"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas", "name": "balanco_servico_dia_pos_gt", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/balanco_servico_dia_pos_gt.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/balanco_servico_dia_pos_gt.sql", "unique_id": "model.rj_smtr.balanco_servico_dia_pos_gt", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "balanco_servico_dia_pos_gt"], "alias": "balanco_servico_dia_pos_gt", "checksum": {"name": "sha256", "checksum": "5f3752ab32109a8461ef468d486e946c4cc3ac6c5008fa69c159dc0ed335b1f1"}, "config": {"enabled": false, "alias": null, "schema": "projeto_subsidio_sppo_encontro_contas", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "Balan\u00e7o da receita aferida e esperada por servico e dia para servi\u00e7os-dia subsidiados ap\u00f3s altera\u00e7\u00f5es do Grupo de Trabalho (Processo.Rio MTR-PRO-2024/06270). Ver metodologia em NOTA T\u00c9CNICA TR/SUBTT N\u00ba 01/2024 e 02/2024", "columns": {"data": {"name": "data", "description": "Data", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "consorcio": {"name": "consorcio", "description": "Cons\u00f3rcio", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "servico": {"name": "servico", "description": "Servi\u00e7o", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "km_subsidiada": {"name": "km_subsidiada", "description": "Quilometragem apurada e subsidiada via algoritmo [km]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_esperada": {"name": "receita_total_esperada", "description": "Receita total esperada com base na quilometragem (IRK x km) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_esperada": {"name": "receita_tarifaria_esperada", "description": "Receita tarif\u00e1ria esperada com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_esperado": {"name": "subsidio_esperado", "description": "Subs\u00eddio esperado com base na quilometragem [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_glosado": {"name": "subsidio_glosado", "description": "Subs\u00eddio glosado conforme os decretos e resolu\u00e7\u00f5es vigentes [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_total_aferida": {"name": "receita_total_aferida", "description": "Receita total aferida (receita tarif\u00e1ria + subsidio pago) [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "receita_tarifaria_aferida": {"name": "receita_tarifaria_aferida", "description": "Receita tarif\u00e1ria aferida com base no RDO informado pelos cons\u00f3rcios [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "subsidio_pago": {"name": "subsidio_pago", "description": "Subs\u00eddio pago [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}, "saldo": {"name": "saldo", "description": "Saldo entre a receita esperada e aferida, descontado o subs\u00eddio glosado [R$]", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "rj_smtr://models/projeto_subsidio_sppo_encontro_contas/schema.yml", "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "table", "schema": "projeto_subsidio_sppo_encontro_contas", "enabled": false}, "created_at": 1727709587.7523432, "config_call_dict": {"enabled": false}, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas`.`balanco_servico_dia_pos_gt`", "raw_code": "{% if var(\"encontro_contas_modo\") == \"_pos_gt\" %}\r\n-- 0. Lista servicos e dias at\u00edpicos (pagos por recurso)\r\nWITH\r\n  recursos AS (\r\n  SELECT\r\n    data,\r\n    id_recurso,\r\n    tipo_recurso,\r\n    -- consorcio,\r\n    servico,\r\n    SUM(valor_pago) AS valor_pago\r\n  FROM\r\n    {{ ref(\"recursos_sppo_servico_dia_pago\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_recursos`.`recursos_sppo_servico_dia_pago`\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3,\r\n    4),\r\nservico_dia_atipico as (\r\nSELECT\r\n  DISTINCT data, servico\r\nFROM\r\n  recursos\r\nWHERE\r\n  -- Quando o valor do recurso pago for R$ 0, desconsidera-se o recurso, pois:\r\n    -- Recurso pode ter sido cancelado (pago e depois revertido)\r\n    -- Problema reporto n\u00e3o gerou impacto na opera\u00e7\u00e3o (quando aparece apenas 1 vez)\r\n  valor_pago != 0\r\n  -- Desconsideram-se recursos do tipo \"Algoritmo\" (igual a apura\u00e7\u00e3o em produ\u00e7\u00e3o, levantado pela TR/SUBTT/CMO)\r\n  -- Desconsideram-se recursos do tipo \"Viagem Individual\" (n\u00e3o afeta servi\u00e7o-dia)\r\n  AND tipo_recurso NOT IN (\"Algoritmo\", \"Viagem Individual\")\r\n  -- Desconsideram-se recursos de reprocessamento que j\u00e1 constam em produ\u00e7\u00e3o\r\n  AND NOT (data BETWEEN \"2022-06-01\" AND \"2022-06-30\"\r\n            AND tipo_recurso = \"Reprocessamento\")\r\n),\r\n\r\n-- 1. Calcula a km subsidiada por servico e dia\r\nsumario_dia AS (  -- Km apurada por servico e dia\r\n  SELECT\r\n    data,\r\n    consorcio,\r\n    servico,\r\n    SUM(km_apurada) AS km_subsidiada,\r\n    sum(valor_subsidio_pago) as subsidio_pago\r\n  FROM\r\n    {{ ref(\"sumario_servico_dia_historico\") }}\r\n    -- `rj-smtr.dashboard_subsidio_sppo.sumario_servico_dia_historico`\r\n  WHERE\r\n    data BETWEEN \"2022-06-01\"\r\n    AND \"2023-12-31\"\r\n    and valor_subsidio_pago > 0\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3),\r\n  viagem_remunerada AS ( -- Km subsidiada pos regra do teto de 120% por servico e dia\r\n  SELECT\r\n    data,\r\n    servico,\r\n    SUM(distancia_planejada) AS km_subsidiada\r\n  FROM\r\n    {{ ref(\"viagens_remuneradas\") }}\r\n    -- `rj-smtr.dashboard_subsidio_sppo.viagens_remuneradas`\r\n  WHERE\r\n    data BETWEEN \"2023-09-16\"\r\n    AND \"2023-12-31\"\r\n    AND indicador_viagem_dentro_limite = TRUE -- useless\r\n  GROUP BY\r\n    1,\r\n    2 ),\r\nkm_subsidiada_dia as (\r\n  SELECT\r\n  sd.* except(km_subsidiada),\r\n    ifnull(case when data >= \"2023-09-16\" then vr.km_subsidiada else sd.km_subsidiada end, 0) as km_subsidiada\r\n  FROM\r\n    sumario_dia sd\r\n  LEFT JOIN\r\n    viagem_remunerada as vr\r\n  using\r\n    (data, servico)\r\n),\r\n\r\n-- 2. Filtra km subsidiada apenas em dias t\u00edpicos (remove servicos e dias pagos por recurso)\r\nkm_subsidiada_filtrada as (\r\n  select\r\n    ksd.*\r\n  from km_subsidiada_dia ksd\r\n  left join servico_dia_atipico sda\r\n  using (data, servico)\r\n  where sda.data is null\r\n  -- Demais dias que n\u00e3o foi considerada a km apurada via GPS:\r\n  and ksd.data NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\r\n),\r\n\r\n-- 3. Calcula a receita tarif\u00e1ria por servico e dia\r\nrdo AS (\r\n  SELECT\r\n    data,\r\n    consorcio,\r\n    CASE\r\n      WHEN LENGTH(linha) < 3 THEN LPAD(linha, 3, \"0\")\r\n    ELSE\r\n    CONCAT( IFNULL(REGEXP_EXTRACT(linha, r\"[A-Z]+\"), \"\"), IFNULL(REGEXP_EXTRACT(linha, r\"[0-9]+\"), \"\") )\r\n  END\r\n    AS servico,\r\n    SUM(receita_buc) + SUM(receita_buc_supervia) + SUM(receita_cartoes_perna_unica_e_demais) + SUM(receita_especie) AS receita_tarifaria_aferida\r\n  FROM\r\n    {{ ref(\"rdo40_registros\") }}\r\n    -- `rj-smtr`.`br_rj_riodejaneiro_rdo`.`rdo40_registros`\r\n  WHERE\r\n    data BETWEEN \"2022-06-01\" AND \"2023-12-31\"\r\n    AND data NOT IN (\"2022-10-02\", \"2022-10-30\", '2023-02-07', '2023-02-08', '2023-02-10', '2023-02-13', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22')\r\n    and consorcio in (\"Internorte\", \"Intersul\", \"Santa Cruz\", \"Transcarioca\")\r\n  group by 1,2,3\r\n),\r\n\r\n-- 3.1. Lista os servi\u00e7os conforme tratamento indicado em resposta aos of\u00edcios MTR-OFI-2024/03024, MTR-OFI-2024/03025, MTR-OFI-2024/03026 e MTR-OFI-2024/03027 (Processo MTR-PRO-2024/06270)\r\nrdo_correcao_servico AS (\r\n  SELECT DISTINCT\r\n    data_inicio_quinzena,\r\n    data_final_quinzena,\r\n    servico_tratado_rdo,\r\n    servico_corrigido_rioonibus\r\n  FROM\r\n    {{ ref(\"rdo_correcao_rioonibus_servico_quinzena\") }}\r\n),\r\n\r\n-- 3.2. Adiciona servi\u00e7os corrigidos do RDO\r\nrdo_servico_corrigido AS (\r\n  SELECT\r\n    data,\r\n    consorcio,\r\n    rdo.servico,\r\n    cro.servico_corrigido_rioonibus,\r\n    receita_tarifaria_aferida\r\n  FROM\r\n    rdo\r\n  LEFT JOIN\r\n    rdo_correcao_servico AS cro\r\n  ON\r\n    rdo.data BETWEEN cro.data_inicio_quinzena AND cro.data_final_quinzena\r\n    AND rdo.servico = cro.servico_tratado_rdo\r\n),\r\n\r\n-- 3.3. Corrige servi\u00e7os do RDO com base nos servi\u00e7os subsidiados (ou seja, apenas servi\u00e7os planejados no dia)\r\nrdo_corrigido AS (\r\n  SELECT\r\n    rdo.data,\r\n    ksf.consorcio,\r\n    ksf.servico,\r\n    SUM(receita_tarifaria_aferida) AS receita_tarifaria_aferida\r\n  FROM\r\n    rdo_servico_corrigido AS rdo\r\n  LEFT JOIN\r\n    km_subsidiada_filtrada AS ksf\r\n  ON\r\n    rdo.data = ksf.data\r\n    AND\r\n      (rdo.servico_corrigido_rioonibus = ksf.servico\r\n      OR rdo.servico = ksf.servico)\r\n  GROUP BY\r\n    1,\r\n    2,\r\n    3\r\n),\r\n\r\n-- 4. Calcula valores esperados de receita e subs\u00eddio com base nos par\u00e2metros de remunera\u00e7\u00e3o por km\r\nparametros as (\r\n  SELECT\r\n    DISTINCT data_inicio,\r\n    data_fim,\r\n    irk,\r\n    case\r\n      when data_fim <= \"2022-12-31\" then irk - subsidio_km  -- subsidio varia ao longo dos meses\r\n      else coalesce(irk_tarifa_publica, irk - (subsidio_km + desconto_subsidio_km)) end as irk_tarifa_publica,\r\n    (subsidio_km + desconto_subsidio_km) as subsidio_km\r\n  FROM\r\n    {{ source(\"projeto_subsidio_sppo_encontro_contas\", \"parametros_km\") }}\r\n  where data_inicio >= \"2022-06-01\" and data_fim <= \"2023-12-31\"\r\n)\r\n  select\r\n    *,\r\n    ifnull(receita_total_aferida, 0) - ifnull(receita_total_esperada - subsidio_glosado, 0) as saldo\r\n  from (\r\n    select\r\n      ks.* except(subsidio_pago),\r\n      ks.km_subsidiada * par.irk as receita_total_esperada,\r\n      ks.km_subsidiada * par.irk_tarifa_publica as receita_tarifaria_esperada,\r\n      ks.km_subsidiada * par.subsidio_km as subsidio_esperado,\r\n      case when data >= \"2023-01-01\" then (ks.km_subsidiada * par.subsidio_km - subsidio_pago) else 0 end as subsidio_glosado,\r\n      ifnull(rdo.receita_tarifaria_aferida, 0) + ifnull(ks.subsidio_pago, 0) as receita_total_aferida,\r\n      rdo.receita_tarifaria_aferida,\r\n      ks.subsidio_pago\r\n    from\r\n      km_subsidiada_filtrada ks\r\n    left join\r\n      rdo_corrigido AS rdo\r\n    using\r\n      (data, servico, consorcio)\r\n    left join\r\n      parametros par\r\n    on\r\n      ks.data between data_inicio and data_fim\r\n  )\r\n{% else %}\r\n{{ config(enabled=false) }}\r\n{% endif %}", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "defer_relation": null}], "model.rj_smtr.rdo_correcao_rioonibus_servico_quinzena": [{"database": "rj-smtr", "schema": "projeto_subsidio_sppo_encontro_contas_staging", "name": "rdo_correcao_rioonibus_servico_quinzena", "resource_type": "model", "package_name": "rj_smtr", "path": "projeto_subsidio_sppo_encontro_contas/staging/rdo_correcao_rioonibus_servico_quinzena.sql", "original_file_path": "models/projeto_subsidio_sppo_encontro_contas/staging/rdo_correcao_rioonibus_servico_quinzena.sql", "unique_id": "model.rj_smtr.rdo_correcao_rioonibus_servico_quinzena", "fqn": ["rj_smtr", "projeto_subsidio_sppo_encontro_contas", "staging", "rdo_correcao_rioonibus_servico_quinzena"], "alias": "rdo_correcao_rioonibus_servico_quinzena", "checksum": {"name": "sha256", "checksum": "b54ac99f4a16843c18f6186ce630d12567bdd12e54fb99fb648f6d503ddb35bd"}, "config": {"enabled": false, "alias": null, "schema": "projeto_subsidio_sppo_encontro_contas_staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "persist_docs": {"relation": true, "columns": true}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "access": "protected"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "deferred": false, "unrendered_config": {"persist_docs": {"relation": true, "columns": true}, "materialized": "view", "schema": "projeto_subsidio_sppo_encontro_contas_staging", "enabled": false}, "created_at": 1727709586.0085044, "config_call_dict": {"enabled": false}, "relation_name": "`rj-smtr`.`projeto_subsidio_sppo_encontro_contas_staging`.`rdo_correcao_rioonibus_servico_quinzena`", "raw_code": "/*\r\n  Etapa de tratamento com base na resposta aos of\u00edcios MTR-OFI-2024/03024, MTR-OFI-2024/03025, MTR-OFI-2024/03026 e MTR-OFI-2024/03027 (Processo.Rio MTR-PRO-2024/06270)\r\n*/\r\n\r\n{% if var(\"encontro_contas_modo\") == \"_pos_gt\" %}\r\n{{ config(alias=this.name ~ var('encontro_contas_modo')) }}\r\nSELECT\r\n    quinzena,\r\n    PARSE_DATE(\"%m/%d/%Y\", data_inicio_quinzena) AS data_inicio_quinzena,\r\n    PARSE_DATE(\"%m/%d/%Y\", data_final_quinzena) AS data_final_quinzena,\r\n    consorcio_rdo,\r\n    IF(LENGTH(servico_tratado_rdo) < 3, LPAD(servico_tratado_rdo, 3, \"0\"), servico_tratado_rdo) AS servico_tratado_rdo,\r\n    IF(LENGTH(linha_rdo) < 3, LPAD(linha_rdo, 3, \"0\"), linha_rdo) AS linha_rdo,\r\n    tipo_servico_rdo,\r\n    ordem_servico_rdo,\r\n    quantidade_dias_rdo,\r\n    SAFE_CAST(REPLACE(REGEXP_REPLACE(receita_tarifaria_aferida_rdo , r\"[^\\d,-]\", \"\"), \",\", \".\") AS FLOAT64) AS receita_tarifaria_aferida_rdo,\r\n    justificativa,\r\n    acao,\r\n    CASE\r\n      WHEN justificativa = \"SVA665 a partir de 06/2022, SVB665 a partir de 08/2022\" AND acao = \"Considerar como SVB no per\u00edodo indicado\" THEN \"SVB665\"\r\n    ELSE\r\n    REGEXP_EXTRACT(acao, \"(?:[A-Z]+|)[0-9]+\")\r\n  END\r\n    AS servico_corrigido_rioonibus,\r\nFROM\r\n    {{ source(\"projeto_subsidio_sppo_encontro_contas\", \"rdo_correcao_rioonibus_servico_quinzena\") }}\r\n{% else %}\r\n{{ config(enabled=false) }}\r\n{% endif %}", "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "defer_relation": null}]}, "parent_map": {"model.rj_smtr.view_integracao": ["model.rj_smtr.integracao", "model.rj_smtr.servicos"], "model.rj_smtr.view_passageiros_tile_hora": ["model.rj_smtr.passageiros_tile_hora", "model.rj_smtr.servicos"], "model.rj_smtr.view_passageiros_hora": ["model.rj_smtr.passageiros_hora", "model.rj_smtr.servicos", "model.rj_smtr.view_passageiros_tile_hora"], "model.rj_smtr.staging_operadora_empresa": ["source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa"], "model.rj_smtr.staging_operadora_pessoa_fisica": ["source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica"], "model.rj_smtr.veiculo_indicadores_dia": ["model.rj_smtr.gps_sppo", "model.rj_smtr.gps_validador", "model.rj_smtr.sppo_licenciamento", "model.rj_smtr.transacao_riocard", "source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae"], "model.rj_smtr.staging_recursos_sppo_bloqueio_via": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via"], "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento": ["model.rj_smtr.staging_recursos_sppo_bloqueio_via"], "model.rj_smtr.staging_recursos_sppo_viagens_individuais": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais"], "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento": ["model.rj_smtr.staging_recursos_sppo_viagens_individuais"], "model.rj_smtr.staging_recursos_sppo_reprocessamento": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento"], "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento": ["model.rj_smtr.staging_recursos_sppo_reprocessamento"], "model.rj_smtr.my_second_dbt_model": ["model.rj_smtr.my_first_dbt_model"], "model.rj_smtr.my_first_dbt_model": [], "model.rj_smtr.balanco_servico_ano": ["model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.aux_balanco_rdo_servico_dia": ["model.rj_smtr.balanco_servico_dia", "model.rj_smtr.rdo40_registros", "model.rj_smtr.recursos_sppo_servico_dia_pago", "model.rj_smtr.sumario_servico_dia_historico"], "model.rj_smtr.balanco_consorcio_ano": ["model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.balanco_servico_quinzena": ["model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.balanco_consorcio_dia": ["model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.receita_tarifaria_servico_nao_identificado_quinzena": ["model.rj_smtr.aux_balanco_rdo_servico_dia"], "model.rj_smtr.balanco_servico_dia": ["model.rj_smtr.rdo40_registros", "model.rj_smtr.recursos_sppo_servico_dia_pago", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.viagens_remuneradas", "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km"], "model.rj_smtr.passageiros_hora": ["model.rj_smtr.aux_passageiros_hora", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.ordem_pagamento_consorcio_operador_dia": ["model.rj_smtr.aux_retorno_ordem_pagamento", "model.rj_smtr.consorcios", "model.rj_smtr.operadoras", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.staging_ordem_pagamento", "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora"], "model.rj_smtr.gps_validador": ["model.rj_smtr.gps_validador_aux"], "model.rj_smtr.dicionario": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario"], "model.rj_smtr.ordem_pagamento_dia": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.staging_ordem_pagamento"], "model.rj_smtr.passageiros_tile_hora": ["model.rj_smtr.aux_h3_res9", "model.rj_smtr.aux_passageiros_hora", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.matriz_integracao": ["model.rj_smtr.staging_percentual_rateio_integracao", "source.rj_smtr.cadastro.modos"], "model.rj_smtr.gps_validador_van": ["model.rj_smtr.gps_validador_aux"], "model.rj_smtr.integracao": ["model.rj_smtr.consorcios", "model.rj_smtr.matriz_integracao", "model.rj_smtr.operadoras", "model.rj_smtr.servicos", "model.rj_smtr.staging_integracao_transacao", "model.rj_smtr.staging_linha", "model.rj_smtr.staging_linha_sem_ressarcimento", "source.rj_smtr.cadastro.modos"], "model.rj_smtr.ordem_pagamento_consorcio_dia": ["model.rj_smtr.consorcios", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.staging_ordem_pagamento_consorcio"], "model.rj_smtr.transacao": ["model.rj_smtr.consorcios", "model.rj_smtr.gratuidade_aux", "model.rj_smtr.integracao", "model.rj_smtr.operadoras", "model.rj_smtr.operadoras_contato", "model.rj_smtr.ordem_pagamento_dia", "model.rj_smtr.servico_operadora", "model.rj_smtr.servicos", "model.rj_smtr.staging_integracao_transacao", "model.rj_smtr.staging_linha", "model.rj_smtr.staging_linha_sem_ressarcimento", "model.rj_smtr.staging_transacao", "model.rj_smtr.transacao_riocard", "source.rj_smtr.cadastro.modos"], "model.rj_smtr.ordem_pagamento_servico_operador_dia": ["model.rj_smtr.consorcios", "model.rj_smtr.operadoras", "model.rj_smtr.servicos", "model.rj_smtr.staging_linha", "model.rj_smtr.staging_ordem_rateio", "model.rj_smtr.staging_ordem_ressarcimento"], "model.rj_smtr.transacao_riocard": ["model.rj_smtr.consorcios", "model.rj_smtr.operadoras", "model.rj_smtr.staging_linha", "model.rj_smtr.staging_linha_consorcio", "model.rj_smtr.staging_transacao_riocard"], "model.rj_smtr.ed_metadado_coluna": ["model.rj_smtr.metadado_coluna"], "model.rj_smtr.metadado_coluna": [], "model.rj_smtr.receita_autuacao": ["source.rj_smtr.infracao_staging.receita_autuacao"], "model.rj_smtr.autuacao": ["model.rj_smtr.autuacao_citran"], "model.rj_smtr.autuacao_citran": ["source.rj_smtr.infracao_staging.autuacoes_citran"], "model.rj_smtr.staging_rho_registros_stpl": ["source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl"], "model.rj_smtr.rho_registros_stpl_aux": ["model.rj_smtr.staging_rho_registros_stpl"], "model.rj_smtr.staging_rho_registros_sppo": ["source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo"], "model.rj_smtr.viagem_conformidade": ["model.rj_smtr.aux_viagem_circular", "model.rj_smtr.aux_viagem_registros"], "model.rj_smtr.aux_registros_status_trajeto": ["model.rj_smtr.gps_sppo", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.viagem_planejada": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.subsidio_quadro_horario", "model.rj_smtr.subsidio_shapes_geom", "model.rj_smtr.subsidio_trips_desaninhada"], "model.rj_smtr.registros_status_viagem": ["model.rj_smtr.aux_registros_status_trajeto", "model.rj_smtr.aux_viagem_circular"], "model.rj_smtr.subsidio_data_versao_efetiva": ["model.rj_smtr.subsidio_quadro_horario", "model.rj_smtr.subsidio_trips_desaninhada"], "model.rj_smtr.aux_viagem_registros": ["model.rj_smtr.registros_status_viagem"], "model.rj_smtr.aux_viagem_inicio_fim": ["model.rj_smtr.aux_registros_status_trajeto"], "model.rj_smtr.viagem_completa": ["model.rj_smtr.viagem_conformidade", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.aux_viagem_circular": ["model.rj_smtr.aux_viagem_inicio_fim"], "model.rj_smtr.subsidio_quadro_horario": [], "model.rj_smtr.subsidio_shapes_geom": ["model.rj_smtr.subsidio_data_versao_efetiva"], "model.rj_smtr.subsidio_trips_desaninhada": [], "model.rj_smtr.staging_ordem_pagamento_consorcio": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio"], "model.rj_smtr.staging_cliente": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente"], "model.rj_smtr.staging_transacao_riocard": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard"], "model.rj_smtr.staging_consorcio": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio"], "model.rj_smtr.aux_passageiros_hora": ["model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.gratuidade_aux": ["model.rj_smtr.staging_gratuidade"], "model.rj_smtr.staging_linha_consorcio_operadora_transporte": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte"], "model.rj_smtr.staging_servico_motorista": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista"], "model.rj_smtr.staging_ordem_pagamento": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento"], "model.rj_smtr.staging_percentual_rateio_integracao": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao"], "model.rj_smtr.staging_transacao": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao"], "model.rj_smtr.staging_gps_validador": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador"], "model.rj_smtr.staging_linha_sem_ressarcimento": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento"], "model.rj_smtr.staging_endereco": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco"], "model.rj_smtr.staging_linha_consorcio": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio"], "model.rj_smtr.staging_ordem_ressarcimento": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento"], "model.rj_smtr.staging_linha": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha"], "model.rj_smtr.staging_conta_bancaria": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria"], "model.rj_smtr.gps_validador_aux": ["model.rj_smtr.operadoras", "model.rj_smtr.servicos", "model.rj_smtr.staging_gps_validador", "model.rj_smtr.staging_linha"], "model.rj_smtr.staging_integracao_transacao": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao"], "model.rj_smtr.aux_h3_res9": ["source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9"], "model.rj_smtr.staging_ordem_rateio": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio"], "model.rj_smtr.staging_operadora_transporte": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte"], "model.rj_smtr.staging_gratuidade": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade"], "model.rj_smtr.staging_contato_pessoa_juridica": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica"], "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora": ["source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora"], "model.rj_smtr.ordem_servico_faixa_horaria": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria"], "model.rj_smtr.gps_sppo_15_minutos": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "model.rj_smtr.sppo_aux_registros_parada", "model.rj_smtr.sppo_aux_registros_velocidade"], "model.rj_smtr.gps_sppo": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "model.rj_smtr.sppo_aux_registros_parada", "model.rj_smtr.sppo_aux_registros_velocidade"], "model.rj_smtr.gps_brt_15_minutos": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "model.rj_smtr.brt_aux_registros_parada", "model.rj_smtr.brt_aux_registros_velocidade"], "model.rj_smtr.gps_brt": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "model.rj_smtr.brt_aux_registros_parada", "model.rj_smtr.brt_aux_registros_velocidade"], "model.rj_smtr.sumario_servico_dia_pagamento": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.subsidio_sumario_servico_dia_pagamento"], "model.rj_smtr.sumario_faixa_servico_dia": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem"], "model.rj_smtr.brt_aux_registros_flag_trajeto_correto": ["model.rj_smtr.brt_aux_registros_filtrada", "model.rj_smtr.shapes_geom"], "model.rj_smtr.brt_registros_desaninhada": ["model.rj_smtr.brt_registros"], "model.rj_smtr.brt_aux_registros_parada": ["model.rj_smtr.brt_aux_registros_filtrada"], "model.rj_smtr.brt_registros": [], "model.rj_smtr.brt_aux_registros_velocidade": ["model.rj_smtr.brt_aux_registros_filtrada"], "model.rj_smtr.brt_aux_registros_filtrada": ["model.rj_smtr.brt_registros_desaninhada"], "model.rj_smtr.viagem_transacao": ["model.rj_smtr.gps_validador", "model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard", "model.rj_smtr.viagem_completa"], "model.rj_smtr.gps_agregado_vlt": ["model.rj_smtr.gps_validador"], "model.rj_smtr.gps_agregado_brt": ["model.rj_smtr.gps_validador"], "model.rj_smtr.gps_agregado_onibus": ["model.rj_smtr.gps_validador"], "model.rj_smtr.gps_agregado_van": ["model.rj_smtr.gps_validador_van"], "model.rj_smtr.sppo_aux_registros_parada_zirix": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix"], "model.rj_smtr.sppo_aux_registros_realocacao_zirix": ["model.rj_smtr.sppo_realocacao_zirix", "model.rj_smtr.sppo_registros_zirix"], "model.rj_smtr.sppo_registros_zirix": ["source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros"], "model.rj_smtr.sppo_realocacao_zirix": ["source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao"], "model.rj_smtr.sppo_aux_registros_filtrada_zirix": ["model.rj_smtr.sppo_aux_registros_realocacao_zirix", "model.rj_smtr.sppo_registros_zirix"], "model.rj_smtr.sppo_aux_registros_velocidade_zirix": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix"], "model.rj_smtr.gps_sppo_zirix": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix", "model.rj_smtr.sppo_aux_registros_parada_zirix", "model.rj_smtr.sppo_aux_registros_velocidade_zirix"], "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix": ["model.rj_smtr.shapes_geom", "model.rj_smtr.sppo_aux_registros_filtrada_zirix"], "model.rj_smtr.viagem_informada": ["model.rj_smtr.staging_viagem_informada"], "model.rj_smtr.staging_viagem_informada": ["source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada"], "model.rj_smtr.recursos_sppo_bloqueio_via": ["model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento", "model.rj_smtr.staging_recursos_sppo_bloqueio_via"], "model.rj_smtr.recursos_sppo_servico_dia_avaliacao": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao"], "model.rj_smtr.recursos_sppo_servico_dia_pago": ["source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago"], "model.rj_smtr.recursos_sppo_viagens_individuais": ["model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento", "model.rj_smtr.staging_recursos_sppo_viagens_individuais"], "model.rj_smtr.recursos_sppo_reprocessamento": ["model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento", "model.rj_smtr.staging_recursos_sppo_reprocessamento"], "model.rj_smtr.integracao_nao_realizada": ["model.rj_smtr.integracao", "model.rj_smtr.matriz_integracao", "model.rj_smtr.transacao"], "model.rj_smtr.integracao_invalida": ["model.rj_smtr.integracao", "model.rj_smtr.matriz_integracao"], "model.rj_smtr.ordem_pagamento_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_dia_invalida", "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida"], "model.rj_smtr.transacao_invalida": ["model.rj_smtr.servicos", "model.rj_smtr.transacao"], "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.ordem_pagamento_dia", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.staging_linha_sem_ressarcimento", "model.rj_smtr.transacao_invalida"], "model.rj_smtr.aux_transacao_ordem": ["model.rj_smtr.consorcios", "model.rj_smtr.operadoras", "model.rj_smtr.staging_linha_sem_ressarcimento", "model.rj_smtr.staging_servico_motorista", "model.rj_smtr.staging_transacao"], "model.rj_smtr.ordem_pagamento_dia_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.ordem_pagamento_dia"], "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida"], "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida"], "model.rj_smtr.sppo_registro_agente_verao": ["model.rj_smtr.sppo_registro_agente_verao_staging"], "model.rj_smtr.sppo_infracao": ["model.rj_smtr.sppo_infracao_staging"], "model.rj_smtr.sppo_licenciamento": ["model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada", "model.rj_smtr.sppo_licenciamento_stu_staging"], "model.rj_smtr.sppo_veiculo_dia": ["model.rj_smtr.gps_sppo", "model.rj_smtr.sppo_infracao", "model.rj_smtr.sppo_licenciamento", "model.rj_smtr.sppo_licenciamento_stu_staging", "model.rj_smtr.sppo_registro_agente_verao", "model.rj_smtr.subsidio_parametros"], "model.rj_smtr.sppo_licenciamento_solicitacao": ["model.rj_smtr.sppo_licenciamento_solicitacao_staging"], "model.rj_smtr.sppo_registro_agente_verao_staging": ["source.rj_smtr.veiculo_staging.sppo_registro_agente_verao"], "model.rj_smtr.sppo_licenciamento_stu_staging": ["source.rj_smtr.veiculo_staging.sppo_licenciamento_stu"], "model.rj_smtr.sppo_infracao_staging": ["source.rj_smtr.veiculo_staging.sppo_infracao"], "model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada": ["model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging", "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging", "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging": ["source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024"], "model.rj_smtr.sppo_licenciamento_solicitacao_staging": ["source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao"], "model.rj_smtr.subsidio_valor_km_tipo_viagem": ["source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem"], "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa": ["model.rj_smtr.subsidio_valor_km_tipo_viagem", "model.rj_smtr.sumario_servico_dia_tipo"], "model.rj_smtr.sumario_servico_dia": ["model.rj_smtr.valor_tipo_penalidade", "model.rj_smtr.viagem_completa", "model.rj_smtr.viagem_planejada", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.valor_tipo_penalidade": [], "model.rj_smtr.sumario_servico_dia_tipo": ["model.rj_smtr.sumario_servico_dia", "model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.subsidio_parametros": [], "model.rj_smtr.sumario_servico_tipo_viagem_dia": ["model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.viagem_completa"], "model.rj_smtr.sumario_servico_dia_historico": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.sumario_dia", "model.rj_smtr.sumario_servico_dia", "model.rj_smtr.sumario_servico_dia_tipo", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.viagens_remuneradas": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.subsidio_valor_km_tipo_viagem", "model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.viagens_realizadas": ["model.rj_smtr.viagem_completa"], "model.rj_smtr.sumario_dia": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.viagem_completa", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.pagamento_bilhetagem_jae": ["model.rj_smtr.consorcios", "model.rj_smtr.staging_arquivo_retorno"], "model.rj_smtr.aux_retorno_ordem_pagamento": ["model.rj_smtr.staging_arquivo_retorno"], "model.rj_smtr.staging_arquivo_retorno": ["source.rj_smtr.controle_financeiro_staging.arquivo_retorno"], "model.rj_smtr.rdo40_registros": ["model.rj_smtr.consorcios", "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado"], "model.rj_smtr.rho_registros_sppo": ["model.rj_smtr.staging_rho_registros_sppo"], "model.rj_smtr.rho_registros_stpl": ["model.rj_smtr.rho_registros_stpl_aux", "model.rj_smtr.staging_rho_registros_stpl"], "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto": ["model.rj_smtr.shapes_geom", "model.rj_smtr.sppo_aux_registros_filtrada"], "model.rj_smtr.sppo_aux_registros_realocacao": ["model.rj_smtr.sppo_realocacao", "model.rj_smtr.sppo_registros"], "model.rj_smtr.sppo_aux_registros_velocidade": ["model.rj_smtr.sppo_aux_registros_filtrada"], "model.rj_smtr.sppo_aux_registros_parada": ["model.rj_smtr.sppo_aux_registros_filtrada"], "model.rj_smtr.sppo_realocacao": [], "model.rj_smtr.sppo_registros": [], "model.rj_smtr.sppo_aux_registros_filtrada": ["model.rj_smtr.sppo_aux_registros_realocacao", "model.rj_smtr.sppo_registros"], "model.rj_smtr.indicadores_mes": ["model.rj_smtr.frota_operante", "model.rj_smtr.idade_media_frota_operante_onibus", "model.rj_smtr.passageiro_gratuidade", "model.rj_smtr.passageiro_pagante"], "model.rj_smtr.indicadores_mes_pivot": ["model.rj_smtr.indicadores_mes"], "model.rj_smtr.passageiro_pagante": ["model.rj_smtr.consorcios", "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado"], "model.rj_smtr.passageiro_gratuidade": ["model.rj_smtr.consorcios", "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado"], "model.rj_smtr.frota_operante": ["model.rj_smtr.viagem_completa"], "model.rj_smtr.idade_media_frota_operante_onibus": ["model.rj_smtr.sppo_licenciamento", "model.rj_smtr.viagem_completa"], "model.rj_smtr.stop_times": [], "model.rj_smtr.stop_details": [], "model.rj_smtr.stop_details_desaninhada": ["model.rj_smtr.stop_details"], "model.rj_smtr.routes": [], "model.rj_smtr.shapes": [], "model.rj_smtr.holidays": [], "model.rj_smtr.stops_desaninhada": ["model.rj_smtr.stops"], "model.rj_smtr.agg_stops_vistoriadas": ["model.rj_smtr.stops"], "model.rj_smtr.frota_determinada": [], "model.rj_smtr.frota_determinada_desaninhada": ["model.rj_smtr.frota_determinada"], "model.rj_smtr.trips_desaninhada": ["model.rj_smtr.routes_desaninhada", "model.rj_smtr.trips"], "model.rj_smtr.shapes_geom": ["model.rj_smtr.routes_desaninhada", "model.rj_smtr.shapes", "model.rj_smtr.trips_desaninhada"], "model.rj_smtr.agency_desaninhada": ["model.rj_smtr.agency"], "model.rj_smtr.linhas": [], "model.rj_smtr.agency": [], "model.rj_smtr.data_versao_efetiva": ["model.rj_smtr.agency", "model.rj_smtr.calendar", "model.rj_smtr.frota_determinada", "model.rj_smtr.holidays", "model.rj_smtr.linhas", "model.rj_smtr.routes", "model.rj_smtr.shapes_geom", "model.rj_smtr.stop_details", "model.rj_smtr.stop_times", "model.rj_smtr.stops", "model.rj_smtr.trips"], "model.rj_smtr.calendar": [], "model.rj_smtr.calendar_desaninhada": ["model.rj_smtr.calendar"], "model.rj_smtr.linhas_desaninhada": ["model.rj_smtr.linhas"], "model.rj_smtr.routes_desaninhada": ["model.rj_smtr.routes"], "model.rj_smtr.stop_times_desaninhada": ["model.rj_smtr.stop_times"], "model.rj_smtr.stops": [], "model.rj_smtr.trips": [], "model.rj_smtr.subsidio_penalidade_servico_dia": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.valor_tipo_penalidade"], "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem": ["model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.viagem_completa", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.subsidio_sumario_servico_dia_pagamento": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.subsidio_penalidade_servico_dia", "model.rj_smtr.subsidio_valor_km_tipo_viagem"], "model.rj_smtr.subsidio_faixa_servico_dia": ["model.rj_smtr.viagem_planejada", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.routes_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes"], "model.rj_smtr.ordem_servico_trips_shapes_gtfs": ["model.rj_smtr.ordem_servico_faixa_horaria", "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.trips_filtrada_aux_gtfs"], "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo"], "model.rj_smtr.fare_rules_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules"], "model.rj_smtr.trips_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips"], "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.trips_filtrada_aux_gtfs"], "model.rj_smtr.shapes_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes"], "model.rj_smtr.calendar_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar"], "model.rj_smtr.stop_times_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times"], "model.rj_smtr.fare_attributes_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes"], "model.rj_smtr.trips_filtrada_aux_gtfs": ["model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs", "model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.trips_gtfs"], "model.rj_smtr.feed_info_gtfs": ["source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info"], "model.rj_smtr.frequencies_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies"], "model.rj_smtr.servicos_sentido": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.trips_gtfs"], "model.rj_smtr.ordem_servico_diaria": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.servicos_sentido", "model.rj_smtr.subsidio_data_versao_efetiva"], "model.rj_smtr.stops_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops"], "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs": ["model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs"], "model.rj_smtr.agency_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency"], "model.rj_smtr.ordem_servico_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico"], "model.rj_smtr.calendar_dates_gtfs": ["model.rj_smtr.feed_info_gtfs", "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates"], "model.rj_smtr.ordem_servico_viagens_planejadas": ["model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.subsidio_data_versao_efetiva"], "model.rj_smtr.shapes_geom_gtfs": ["model.rj_smtr.feed_info_gtfs", "model.rj_smtr.shapes_gtfs"], "model.rj_smtr.servico_operadora": ["model.rj_smtr.consorcios", "model.rj_smtr.operadoras", "model.rj_smtr.servicos", "model.rj_smtr.staging_linha_consorcio_operadora_transporte"], "model.rj_smtr.servicos": ["model.rj_smtr.aux_servicos_gtfs", "model.rj_smtr.staging_linha"], "model.rj_smtr.operadoras_contato": ["model.rj_smtr.operadoras", "model.rj_smtr.staging_cliente", "model.rj_smtr.staging_contato_pessoa_juridica", "model.rj_smtr.staging_operadora_transporte"], "model.rj_smtr.operadoras": ["model.rj_smtr.staging_cliente", "model.rj_smtr.staging_conta_bancaria", "model.rj_smtr.staging_operadora_empresa", "model.rj_smtr.staging_operadora_pessoa_fisica", "model.rj_smtr.staging_operadora_transporte", "source.rj_smtr.cadastro.modos"], "model.rj_smtr.consorcios": ["model.rj_smtr.staging_consorcio", "model.rj_smtr.staging_operadora_empresa", "source.rj_smtr.cadastro.modos", "source.rj_smtr.cadastro_staging.consorcio_modo"], "model.rj_smtr.aux_servicos_gtfs": ["model.rj_smtr.aux_routes_vigencia_gtfs", "model.rj_smtr.aux_stops_vigencia_gtfs"], "model.rj_smtr.aux_routes_vigencia_gtfs": ["model.rj_smtr.routes_gtfs"], "model.rj_smtr.aux_stops_vigencia_gtfs": ["model.rj_smtr.stops_gtfs"], "test.rj_smtr.unique_my_first_dbt_model_id.16e066b321": ["model.rj_smtr.my_first_dbt_model"], "test.rj_smtr.not_null_my_first_dbt_model_id.5fb22c2710": ["model.rj_smtr.my_first_dbt_model"], "test.rj_smtr.unique_my_second_dbt_model_id.57a0f8c493": ["model.rj_smtr.my_second_dbt_model"], "test.rj_smtr.not_null_my_second_dbt_model_id.151b76d778": ["model.rj_smtr.my_second_dbt_model"], "test.rj_smtr.not_null_viagem_planejada_consorcio.3058dfe52a": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_data.908c75b0d4": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_data_shape.5117fd368b": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_tipo_dia.a605476b6d": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.accepted_values_viagem_planejada_tipo_dia__I__V__C.fabfbe2d14": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_servico.a9fd6c7425": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_sentido.40310b764f": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_inicio_periodo.c62783ac90": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_fim_periodo.b2cf28f8cc": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_intervalo.1fb7eb9e45": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_variacao_itinerario.ea024350d5": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA.19c1ddab9e": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_sentido_shape.7b97f6ff04": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.accepted_values_viagem_planejada_sentido_shape__I__V__C.65301f5e21": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_shape.5f910173a9": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_distancia_planejada.74a4f2d184": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_viagem_planejada_distancia_total_planejada.fc1b124982": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.greater_than_zero_viagem_planejada_distancia_total_planejada.d8c80cf89c": ["model.rj_smtr.viagem_planejada"], "test.rj_smtr.not_null_aux_registros_status_trajeto_data.652ad0c445": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_id_veiculo.101e6b5227": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_gps.703590c517": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_minuto_gps.d2799a61bf": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_posicao_veiculo_geo.33c0d51e40": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_servico_informado.11333dadfe": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_shape_id.586a1a0d47": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia_planejada.39e1e1d472": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia.703c10aaaf": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_negative_aux_registros_status_trajeto_distancia.b4cb13122d": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_status_viagem.24b7f26346": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_versao_modelo.22de27b835": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido_shape.a14a95f5e8": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C.5b82f18cbf": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido.6291e69d70": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido__I__V__C.2082fbe17f": ["model.rj_smtr.aux_registros_status_trajeto"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_data.3ef5737e0d": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_veiculo.c69fdfc708": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_informado.7adb7ebfd7": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_realizado.60bf591717": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_shape_id.9b971af0ae": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido_shape.4c3ec0996b": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.9af2f7b6e0": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido.976bd6a11f": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.4f2096c560": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_viagem.9cfe2e3fdd": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.unique_aux_viagem_inicio_fim_id_viagem.321f77f756": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_partida.c668ec6882": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_chegada.2e883813e8": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_versao_modelo.7bace7cce8": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_inicio_fim_distancia_planejada.a26e748226": ["model.rj_smtr.aux_viagem_inicio_fim"], "test.rj_smtr.not_null_aux_viagem_circular_data.9696b69d2f": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_id_veiculo.f928466090": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_servico_informado.e43d2419a6": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_shape_id.d4509226b0": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_sentido_shape.ca74a5e3f0": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.accepted_values_aux_viagem_circular_sentido_shape__I__V__C.39a2bf1eea": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_sentido.d255c2ea5c": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.accepted_values_aux_viagem_circular_sentido__I__V__C.70c058ec81": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_id_viagem.48bb460a25": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.unique_aux_viagem_circular_id_viagem.1ee2d25705": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_datetime_partida.44f6ea1a28": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_datetime_chegada.129de567e2": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_versao_modelo.5c199c2365": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_aux_viagem_circular_distancia_planejada.5baf640cb6": ["model.rj_smtr.aux_viagem_circular"], "test.rj_smtr.not_null_registros_status_viagem_data.fc562948d5": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_id_veiculo.3c008a9ac4": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_id_empresa.3108e4aab8": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_timestamp_gps.01b64d27a5": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_timestamp_minuto_gps.1157bb9203": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_posicao_veiculo_geo.78b9ad4651": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_servico_informado.dd60d17ad8": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_servico_realizado.5376b0386b": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_shape_id.1d4aad9d42": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_distancia_planejada.97e1779cf0": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_distancia.85f4f41092": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_negative_registros_status_viagem_distancia.34c62e5708": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_status_viagem.d00cac767b": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_sentido_shape.88347d2c2f": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.accepted_values_registros_status_viagem_sentido_shape__I__V__C.a6ccf195ec": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_sentido.85a3d01213": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.accepted_values_registros_status_viagem_sentido__I__V__C.8b8fa70da7": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_id_viagem.b81547c9af": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.unique_registros_status_viagem_id_viagem.5e7788f7bf": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_datetime_partida.15c5410b28": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_datetime_chegada.5dbeb5b878": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_registros_status_viagem_versao_modelo.86225e08a6": ["model.rj_smtr.registros_status_viagem"], "test.rj_smtr.not_null_aux_viagem_registros_id_viagem.a786e08594": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.unique_aux_viagem_registros_id_viagem.f0eebfdeac": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_distancia_planejada.a779141cf5": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_planejada.ad85bf839a": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_distancia_aferida.af703eccfb": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_aferida.3f4f58b67a": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_middle.32807232ce": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_middle.6fda2c93f2": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_start.4e1ace515e": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_start.6777af50be": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_end.6be4269aee": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_end.e1ccb9c563": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_out.0e8817c0b4": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_out.16cc121f84": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_total.0a1be4060f": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_total.c812b681b0": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_minuto.157ae1cdaf": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_minuto.82864933b3": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_versao_modelo.4e6a36e817": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_shape.e354f14169": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_shape.d8d479f025": ["model.rj_smtr.aux_viagem_registros"], "test.rj_smtr.not_null_viagem_conformidade_data.dba44f5b88": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_id_veiculo.4dc76608fb": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_servico_informado.d130583ad1": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_servico_realizado.3bd70666f8": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_shape_id.2fd4863204": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_sentido_shape.e828f58e76": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.accepted_values_viagem_conformidade_sentido_shape__I__V__C.1c6ae2b41d": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_sentido.9ff9017055": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.accepted_values_viagem_conformidade_sentido__I__V__C.37e4bf801f": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_id_viagem.52f7dd7469": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.unique_viagem_conformidade_id_viagem.5aa802e5bf": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_datetime_partida.fd79047671": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_datetime_chegada.72c3aa8bba": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_tempo_viagem.9d731143cc": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_tempo_viagem.94e16edeba": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_distancia_planejada.9a5bf3230e": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_planejada.399d334601": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_distancia_aferida.f7b56d4343": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_aferida.14ac42d258": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_middle.7965304122": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_middle.794c022bd1": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_start.53a2b2e530": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_start.3b4d5df527": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_end.accb64d6bd": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_end.2e79c19e44": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_out.6dac645a68": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_negative_viagem_conformidade_n_registros_out.05ed52b76e": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_shape.567191d3b2": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_negative_viagem_conformidade_n_registros_shape.fa86a62956": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_total.8514b50af0": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_total.845a3f5e81": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_n_registros_minuto.a1804e8458": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_minuto.44dcb2a328": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_shape.c779adcc22": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_shape.672bafc4f5": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_distancia.e95ad3d84b": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_distancia.947723cc56": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_registros.5889951b7b": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_registros.078f53372c": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_conformidade_versao_modelo.ddf040eb5f": ["model.rj_smtr.viagem_conformidade"], "test.rj_smtr.not_null_viagem_completa_consorcio.ef41dcab9b": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_data.60008eec9c": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_tipo_dia.1718470616": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo.be741d00ee": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_id_veiculo.4b31ddd12f": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_servico_informado.3aa58feb5f": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_servico_realizado.7433281d87": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_vista.ace89b5843": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_trip_id.b9d8d1d6fd": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_shape_id.cfa5f99155": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_sentido.a8ba9e34e6": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.accepted_values_viagem_completa_sentido__I__V__C.14734d12d7": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_id_viagem.c4481cf0da": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.unique_viagem_completa_id_viagem.e7a957c7b9": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_datetime_partida.a62e5f9eac": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_datetime_chegada.fac30fe07a": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_tipo_viagem.6bda4a1de6": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta.d7777aca98": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_tempo_viagem.2d2a673c5b": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_tempo_viagem.6c4c35eea7": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_distancia_planejada.bbd49d7634": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_distancia_planejada.a4e65fb078": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_distancia_aferida.0edb9adb33": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_distancia_aferida.f5d805262a": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_n_registros_shape.9d239e7953": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_shape.8fb346344d": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_n_registros_total.4a103f1249": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_total.25967100b1": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_n_registros_minuto.4c23c345c5": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_minuto.1fa0ffac2f": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_shape.25bb80e526": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_shape.1ad412b569": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_distancia.837283bcfc": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_distancia.7087a86b2d": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_registros.0d86da0376": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_registros.8cc9a28202": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_viagem_completa_versao_modelo.08474ee6c1": ["model.rj_smtr.viagem_completa"], "test.rj_smtr.not_null_routes_desaninhada_route_id__data_versao.dd77dca831": ["model.rj_smtr.routes_desaninhada"], "test.rj_smtr.unique_key_routes_desaninhada_route_id____data_versao.c670eae320": ["model.rj_smtr.routes_desaninhada"], "test.rj_smtr.not_null_trips_desaninhada_trip_id__data_versao.bc1b38cd1a": ["model.rj_smtr.trips_desaninhada"], "test.rj_smtr.unique_key_trips_desaninhada_trip_id____data_versao.42406b5b36": ["model.rj_smtr.trips_desaninhada"], "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe": ["model.rj_smtr.shapes_geom", "model.rj_smtr.trips_desaninhada"], "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b": ["model.rj_smtr.routes_desaninhada", "model.rj_smtr.trips_desaninhada"], "test.rj_smtr.not_null_shapes_geom_shape_id__data_versao.7a66dc45a2": ["model.rj_smtr.shapes_geom"], "test.rj_smtr.not_null_shapes_geom_trip_id__data_versao.80cc520fd9": ["model.rj_smtr.shapes_geom"], "test.rj_smtr.unique_key_shapes_geom_trip_id____data_versao.a58fed7dbf": ["model.rj_smtr.shapes_geom"], "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d": ["model.rj_smtr.shapes_geom", "model.rj_smtr.trips_desaninhada"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.tipo_modal": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo": [], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria": [], "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa": [], "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica": [], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais": [], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via": [], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento": [], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao": [], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago": [], "source.rj_smtr.cadastro.modos": [], "source.rj_smtr.cadastro_staging.consorcio_modo": [], "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo": [], "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl": [], "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado": [], "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_registros_sppo": [], "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km": [], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023": [], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024": [], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024": [], "source.rj_smtr.veiculo_staging.sppo_registro_agente_verao": [], "source.rj_smtr.veiculo_staging.sppo_infracao": [], "source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao": [], "source.rj_smtr.veiculo_staging.sppo_licenciamento": [], "source.rj_smtr.veiculo_staging.sppo_licenciamento_stu": [], "source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem": [], "source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae": [], "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros": [], "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao": [], "source.rj_smtr.controle_financeiro_staging.cb": [], "source.rj_smtr.controle_financeiro_staging.cett": [], "source.rj_smtr.controle_financeiro_staging.arquivo_retorno": [], "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.rdo_correcao_rioonibus_servico_quinzena": [], "source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9": [], "source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada": [], "source.rj_smtr.infracao_staging.autuacoes_citran": [], "source.rj_smtr.infracao_staging.receita_autuacao": []}, "child_map": {"model.rj_smtr.view_integracao": [], "model.rj_smtr.view_passageiros_tile_hora": ["model.rj_smtr.view_passageiros_hora"], "model.rj_smtr.view_passageiros_hora": [], "model.rj_smtr.staging_operadora_empresa": ["model.rj_smtr.consorcios", "model.rj_smtr.operadoras"], "model.rj_smtr.staging_operadora_pessoa_fisica": ["model.rj_smtr.operadoras"], "model.rj_smtr.veiculo_indicadores_dia": [], "model.rj_smtr.staging_recursos_sppo_bloqueio_via": ["model.rj_smtr.recursos_sppo_bloqueio_via", "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento"], "model.rj_smtr.recursos_sppo_bloqueio_via_ultimo_julgamento": ["model.rj_smtr.recursos_sppo_bloqueio_via"], "model.rj_smtr.staging_recursos_sppo_viagens_individuais": ["model.rj_smtr.recursos_sppo_viagens_individuais", "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento"], "model.rj_smtr.recursos_sppo_viagens_individuais_ultimo_julgamento": ["model.rj_smtr.recursos_sppo_viagens_individuais"], "model.rj_smtr.staging_recursos_sppo_reprocessamento": ["model.rj_smtr.recursos_sppo_reprocessamento", "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento"], "model.rj_smtr.recursos_sppo_reprocessamento_ultimo_julgamento": ["model.rj_smtr.recursos_sppo_reprocessamento"], "model.rj_smtr.my_second_dbt_model": ["test.rj_smtr.not_null_my_second_dbt_model_id.151b76d778", "test.rj_smtr.unique_my_second_dbt_model_id.57a0f8c493"], "model.rj_smtr.my_first_dbt_model": ["model.rj_smtr.my_second_dbt_model", "test.rj_smtr.not_null_my_first_dbt_model_id.5fb22c2710", "test.rj_smtr.unique_my_first_dbt_model_id.16e066b321"], "model.rj_smtr.balanco_servico_ano": [], "model.rj_smtr.aux_balanco_rdo_servico_dia": ["model.rj_smtr.receita_tarifaria_servico_nao_identificado_quinzena"], "model.rj_smtr.balanco_consorcio_ano": [], "model.rj_smtr.balanco_servico_quinzena": [], "model.rj_smtr.balanco_consorcio_dia": [], "model.rj_smtr.receita_tarifaria_servico_nao_identificado_quinzena": [], "model.rj_smtr.balanco_servico_dia": ["model.rj_smtr.aux_balanco_rdo_servico_dia", "model.rj_smtr.balanco_consorcio_ano", "model.rj_smtr.balanco_consorcio_dia", "model.rj_smtr.balanco_servico_ano", "model.rj_smtr.balanco_servico_quinzena"], "model.rj_smtr.passageiros_hora": ["model.rj_smtr.view_passageiros_hora"], "model.rj_smtr.ordem_pagamento_consorcio_operador_dia": ["model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida"], "model.rj_smtr.gps_validador": ["model.rj_smtr.gps_agregado_brt", "model.rj_smtr.gps_agregado_onibus", "model.rj_smtr.gps_agregado_vlt", "model.rj_smtr.veiculo_indicadores_dia", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.dicionario": [], "model.rj_smtr.ordem_pagamento_dia": ["model.rj_smtr.ordem_pagamento_dia_invalida", "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida", "model.rj_smtr.transacao"], "model.rj_smtr.passageiros_tile_hora": ["model.rj_smtr.view_passageiros_tile_hora"], "model.rj_smtr.matriz_integracao": ["model.rj_smtr.integracao", "model.rj_smtr.integracao_invalida", "model.rj_smtr.integracao_nao_realizada"], "model.rj_smtr.gps_validador_van": ["model.rj_smtr.gps_agregado_van"], "model.rj_smtr.integracao": ["model.rj_smtr.integracao_invalida", "model.rj_smtr.integracao_nao_realizada", "model.rj_smtr.transacao", "model.rj_smtr.view_integracao"], "model.rj_smtr.ordem_pagamento_consorcio_dia": ["model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "model.rj_smtr.ordem_pagamento_dia", "model.rj_smtr.ordem_pagamento_dia_invalida"], "model.rj_smtr.transacao": ["model.rj_smtr.aux_passageiros_hora", "model.rj_smtr.integracao_nao_realizada", "model.rj_smtr.passageiros_hora", "model.rj_smtr.passageiros_tile_hora", "model.rj_smtr.transacao_invalida", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.ordem_pagamento_servico_operador_dia": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida"], "model.rj_smtr.transacao_riocard": ["model.rj_smtr.aux_passageiros_hora", "model.rj_smtr.passageiros_hora", "model.rj_smtr.passageiros_tile_hora", "model.rj_smtr.transacao", "model.rj_smtr.veiculo_indicadores_dia", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.ed_metadado_coluna": [], "model.rj_smtr.metadado_coluna": ["model.rj_smtr.ed_metadado_coluna"], "model.rj_smtr.receita_autuacao": [], "model.rj_smtr.autuacao": [], "model.rj_smtr.autuacao_citran": ["model.rj_smtr.autuacao"], "model.rj_smtr.staging_rho_registros_stpl": ["model.rj_smtr.rho_registros_stpl", "model.rj_smtr.rho_registros_stpl_aux"], "model.rj_smtr.rho_registros_stpl_aux": ["model.rj_smtr.rho_registros_stpl"], "model.rj_smtr.staging_rho_registros_sppo": ["model.rj_smtr.rho_registros_sppo"], "model.rj_smtr.viagem_conformidade": ["model.rj_smtr.viagem_completa", "test.rj_smtr.accepted_values_viagem_conformidade_sentido__I__V__C.37e4bf801f", "test.rj_smtr.accepted_values_viagem_conformidade_sentido_shape__I__V__C.1c6ae2b41d", "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_aferida.14ac42d258", "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_planejada.399d334601", "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_end.2e79c19e44", "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_middle.794c022bd1", "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_minuto.44dcb2a328", "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_start.3b4d5df527", "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_total.845a3f5e81", "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_distancia.947723cc56", "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_registros.078f53372c", "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_shape.672bafc4f5", "test.rj_smtr.greater_than_zero_viagem_conformidade_tempo_viagem.94e16edeba", "test.rj_smtr.not_negative_viagem_conformidade_n_registros_out.05ed52b76e", "test.rj_smtr.not_negative_viagem_conformidade_n_registros_shape.fa86a62956", "test.rj_smtr.not_null_viagem_conformidade_data.dba44f5b88", "test.rj_smtr.not_null_viagem_conformidade_datetime_chegada.72c3aa8bba", "test.rj_smtr.not_null_viagem_conformidade_datetime_partida.fd79047671", "test.rj_smtr.not_null_viagem_conformidade_distancia_aferida.f7b56d4343", "test.rj_smtr.not_null_viagem_conformidade_distancia_planejada.9a5bf3230e", "test.rj_smtr.not_null_viagem_conformidade_id_veiculo.4dc76608fb", "test.rj_smtr.not_null_viagem_conformidade_id_viagem.52f7dd7469", "test.rj_smtr.not_null_viagem_conformidade_n_registros_end.accb64d6bd", "test.rj_smtr.not_null_viagem_conformidade_n_registros_middle.7965304122", "test.rj_smtr.not_null_viagem_conformidade_n_registros_minuto.a1804e8458", "test.rj_smtr.not_null_viagem_conformidade_n_registros_out.6dac645a68", "test.rj_smtr.not_null_viagem_conformidade_n_registros_shape.567191d3b2", "test.rj_smtr.not_null_viagem_conformidade_n_registros_start.53a2b2e530", "test.rj_smtr.not_null_viagem_conformidade_n_registros_total.8514b50af0", "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_distancia.e95ad3d84b", "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_registros.5889951b7b", "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_shape.c779adcc22", "test.rj_smtr.not_null_viagem_conformidade_sentido.9ff9017055", "test.rj_smtr.not_null_viagem_conformidade_sentido_shape.e828f58e76", "test.rj_smtr.not_null_viagem_conformidade_servico_informado.d130583ad1", "test.rj_smtr.not_null_viagem_conformidade_servico_realizado.3bd70666f8", "test.rj_smtr.not_null_viagem_conformidade_shape_id.2fd4863204", "test.rj_smtr.not_null_viagem_conformidade_tempo_viagem.9d731143cc", "test.rj_smtr.not_null_viagem_conformidade_versao_modelo.ddf040eb5f", "test.rj_smtr.unique_viagem_conformidade_id_viagem.5aa802e5bf"], "model.rj_smtr.aux_registros_status_trajeto": ["model.rj_smtr.aux_viagem_inicio_fim", "model.rj_smtr.registros_status_viagem", "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido__I__V__C.2082fbe17f", "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C.5b82f18cbf", "test.rj_smtr.not_negative_aux_registros_status_trajeto_distancia.b4cb13122d", "test.rj_smtr.not_null_aux_registros_status_trajeto_data.652ad0c445", "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia.703c10aaaf", "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia_planejada.39e1e1d472", "test.rj_smtr.not_null_aux_registros_status_trajeto_id_veiculo.101e6b5227", "test.rj_smtr.not_null_aux_registros_status_trajeto_posicao_veiculo_geo.33c0d51e40", "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido.6291e69d70", "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido_shape.a14a95f5e8", "test.rj_smtr.not_null_aux_registros_status_trajeto_servico_informado.11333dadfe", "test.rj_smtr.not_null_aux_registros_status_trajeto_shape_id.586a1a0d47", "test.rj_smtr.not_null_aux_registros_status_trajeto_status_viagem.24b7f26346", "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_gps.703590c517", "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_minuto_gps.d2799a61bf", "test.rj_smtr.not_null_aux_registros_status_trajeto_versao_modelo.22de27b835"], "model.rj_smtr.viagem_planejada": ["model.rj_smtr.aux_registros_status_trajeto", "model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.sumario_dia", "model.rj_smtr.sumario_servico_dia", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.sumario_servico_dia_tipo", "model.rj_smtr.viagem_completa", "model.rj_smtr.viagens_remuneradas", "test.rj_smtr.accepted_values_viagem_planejada_sentido_shape__I__V__C.65301f5e21", "test.rj_smtr.accepted_values_viagem_planejada_tipo_dia__I__V__C.fabfbe2d14", "test.rj_smtr.accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA.19c1ddab9e", "test.rj_smtr.greater_than_zero_viagem_planejada_distancia_total_planejada.d8c80cf89c", "test.rj_smtr.not_null_viagem_planejada_consorcio.3058dfe52a", "test.rj_smtr.not_null_viagem_planejada_data.908c75b0d4", "test.rj_smtr.not_null_viagem_planejada_data_shape.5117fd368b", "test.rj_smtr.not_null_viagem_planejada_distancia_planejada.74a4f2d184", "test.rj_smtr.not_null_viagem_planejada_distancia_total_planejada.fc1b124982", "test.rj_smtr.not_null_viagem_planejada_fim_periodo.b2cf28f8cc", "test.rj_smtr.not_null_viagem_planejada_inicio_periodo.c62783ac90", "test.rj_smtr.not_null_viagem_planejada_intervalo.1fb7eb9e45", "test.rj_smtr.not_null_viagem_planejada_sentido.40310b764f", "test.rj_smtr.not_null_viagem_planejada_sentido_shape.7b97f6ff04", "test.rj_smtr.not_null_viagem_planejada_servico.a9fd6c7425", "test.rj_smtr.not_null_viagem_planejada_shape.5f910173a9", "test.rj_smtr.not_null_viagem_planejada_tipo_dia.a605476b6d", "test.rj_smtr.not_null_viagem_planejada_variacao_itinerario.ea024350d5"], "model.rj_smtr.registros_status_viagem": ["model.rj_smtr.aux_viagem_registros", "test.rj_smtr.accepted_values_registros_status_viagem_sentido__I__V__C.8b8fa70da7", "test.rj_smtr.accepted_values_registros_status_viagem_sentido_shape__I__V__C.a6ccf195ec", "test.rj_smtr.not_negative_registros_status_viagem_distancia.34c62e5708", "test.rj_smtr.not_null_registros_status_viagem_data.fc562948d5", "test.rj_smtr.not_null_registros_status_viagem_datetime_chegada.5dbeb5b878", "test.rj_smtr.not_null_registros_status_viagem_datetime_partida.15c5410b28", "test.rj_smtr.not_null_registros_status_viagem_distancia.85f4f41092", "test.rj_smtr.not_null_registros_status_viagem_distancia_planejada.97e1779cf0", "test.rj_smtr.not_null_registros_status_viagem_id_empresa.3108e4aab8", "test.rj_smtr.not_null_registros_status_viagem_id_veiculo.3c008a9ac4", "test.rj_smtr.not_null_registros_status_viagem_id_viagem.b81547c9af", "test.rj_smtr.not_null_registros_status_viagem_posicao_veiculo_geo.78b9ad4651", "test.rj_smtr.not_null_registros_status_viagem_sentido.85a3d01213", "test.rj_smtr.not_null_registros_status_viagem_sentido_shape.88347d2c2f", "test.rj_smtr.not_null_registros_status_viagem_servico_informado.dd60d17ad8", "test.rj_smtr.not_null_registros_status_viagem_servico_realizado.5376b0386b", "test.rj_smtr.not_null_registros_status_viagem_shape_id.1d4aad9d42", "test.rj_smtr.not_null_registros_status_viagem_status_viagem.d00cac767b", "test.rj_smtr.not_null_registros_status_viagem_timestamp_gps.01b64d27a5", "test.rj_smtr.not_null_registros_status_viagem_timestamp_minuto_gps.1157bb9203", "test.rj_smtr.not_null_registros_status_viagem_versao_modelo.86225e08a6", "test.rj_smtr.unique_registros_status_viagem_id_viagem.5e7788f7bf"], "model.rj_smtr.subsidio_data_versao_efetiva": ["model.rj_smtr.aux_registros_status_trajeto", "model.rj_smtr.ordem_servico_diaria", "model.rj_smtr.ordem_servico_viagens_planejadas", "model.rj_smtr.subsidio_shapes_geom", "model.rj_smtr.sumario_dia", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.viagem_planejada", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.aux_viagem_registros": ["model.rj_smtr.viagem_conformidade", "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_aferida.3f4f58b67a", "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_planejada.ad85bf839a", "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_end.e1ccb9c563", "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_middle.6fda2c93f2", "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_minuto.82864933b3", "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_start.6777af50be", "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_total.c812b681b0", "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_out.16cc121f84", "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_shape.d8d479f025", "test.rj_smtr.not_null_aux_viagem_registros_distancia_aferida.af703eccfb", "test.rj_smtr.not_null_aux_viagem_registros_distancia_planejada.a779141cf5", "test.rj_smtr.not_null_aux_viagem_registros_id_viagem.a786e08594", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_end.6be4269aee", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_middle.32807232ce", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_minuto.157ae1cdaf", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_out.0e8817c0b4", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_shape.e354f14169", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_start.4e1ace515e", "test.rj_smtr.not_null_aux_viagem_registros_n_registros_total.0a1be4060f", "test.rj_smtr.not_null_aux_viagem_registros_versao_modelo.4e6a36e817", "test.rj_smtr.unique_aux_viagem_registros_id_viagem.f0eebfdeac"], "model.rj_smtr.aux_viagem_inicio_fim": ["model.rj_smtr.aux_viagem_circular", "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.4f2096c560", "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.9af2f7b6e0", "test.rj_smtr.not_null_aux_viagem_inicio_fim_data.3ef5737e0d", "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_chegada.2e883813e8", "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_partida.c668ec6882", "test.rj_smtr.not_null_aux_viagem_inicio_fim_distancia_planejada.a26e748226", "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_veiculo.c69fdfc708", "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_viagem.9cfe2e3fdd", "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido.976bd6a11f", "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido_shape.4c3ec0996b", "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_informado.7adb7ebfd7", "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_realizado.60bf591717", "test.rj_smtr.not_null_aux_viagem_inicio_fim_shape_id.9b971af0ae", "test.rj_smtr.not_null_aux_viagem_inicio_fim_versao_modelo.7bace7cce8", "test.rj_smtr.unique_aux_viagem_inicio_fim_id_viagem.321f77f756"], "model.rj_smtr.viagem_completa": ["model.rj_smtr.frota_operante", "model.rj_smtr.idade_media_frota_operante_onibus", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.sumario_dia", "model.rj_smtr.sumario_servico_dia", "model.rj_smtr.sumario_servico_tipo_viagem_dia", "model.rj_smtr.viagem_transacao", "model.rj_smtr.viagens_realizadas", "test.rj_smtr.accepted_values_viagem_completa_sentido__I__V__C.14734d12d7", "test.rj_smtr.accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo.be741d00ee", "test.rj_smtr.accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta.d7777aca98", "test.rj_smtr.greater_than_zero_viagem_completa_distancia_aferida.f5d805262a", "test.rj_smtr.greater_than_zero_viagem_completa_distancia_planejada.a4e65fb078", "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_minuto.1fa0ffac2f", "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_shape.8fb346344d", "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_total.25967100b1", "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_distancia.7087a86b2d", "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_registros.8cc9a28202", "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_shape.1ad412b569", "test.rj_smtr.greater_than_zero_viagem_completa_tempo_viagem.6c4c35eea7", "test.rj_smtr.not_null_viagem_completa_consorcio.ef41dcab9b", "test.rj_smtr.not_null_viagem_completa_data.60008eec9c", "test.rj_smtr.not_null_viagem_completa_datetime_chegada.fac30fe07a", "test.rj_smtr.not_null_viagem_completa_datetime_partida.a62e5f9eac", "test.rj_smtr.not_null_viagem_completa_distancia_aferida.0edb9adb33", "test.rj_smtr.not_null_viagem_completa_distancia_planejada.bbd49d7634", "test.rj_smtr.not_null_viagem_completa_id_veiculo.4b31ddd12f", "test.rj_smtr.not_null_viagem_completa_id_viagem.c4481cf0da", "test.rj_smtr.not_null_viagem_completa_n_registros_minuto.4c23c345c5", "test.rj_smtr.not_null_viagem_completa_n_registros_shape.9d239e7953", "test.rj_smtr.not_null_viagem_completa_n_registros_total.4a103f1249", "test.rj_smtr.not_null_viagem_completa_perc_conformidade_distancia.837283bcfc", "test.rj_smtr.not_null_viagem_completa_perc_conformidade_registros.0d86da0376", "test.rj_smtr.not_null_viagem_completa_perc_conformidade_shape.25bb80e526", "test.rj_smtr.not_null_viagem_completa_sentido.a8ba9e34e6", "test.rj_smtr.not_null_viagem_completa_servico_informado.3aa58feb5f", "test.rj_smtr.not_null_viagem_completa_servico_realizado.7433281d87", "test.rj_smtr.not_null_viagem_completa_shape_id.cfa5f99155", "test.rj_smtr.not_null_viagem_completa_tempo_viagem.2d2a673c5b", "test.rj_smtr.not_null_viagem_completa_tipo_dia.1718470616", "test.rj_smtr.not_null_viagem_completa_tipo_viagem.6bda4a1de6", "test.rj_smtr.not_null_viagem_completa_trip_id.b9d8d1d6fd", "test.rj_smtr.not_null_viagem_completa_versao_modelo.08474ee6c1", "test.rj_smtr.not_null_viagem_completa_vista.ace89b5843", "test.rj_smtr.unique_viagem_completa_id_viagem.e7a957c7b9"], "model.rj_smtr.aux_viagem_circular": ["model.rj_smtr.registros_status_viagem", "model.rj_smtr.viagem_conformidade", "test.rj_smtr.accepted_values_aux_viagem_circular_sentido__I__V__C.70c058ec81", "test.rj_smtr.accepted_values_aux_viagem_circular_sentido_shape__I__V__C.39a2bf1eea", "test.rj_smtr.not_null_aux_viagem_circular_data.9696b69d2f", "test.rj_smtr.not_null_aux_viagem_circular_datetime_chegada.129de567e2", "test.rj_smtr.not_null_aux_viagem_circular_datetime_partida.44f6ea1a28", "test.rj_smtr.not_null_aux_viagem_circular_distancia_planejada.5baf640cb6", "test.rj_smtr.not_null_aux_viagem_circular_id_veiculo.f928466090", "test.rj_smtr.not_null_aux_viagem_circular_id_viagem.48bb460a25", "test.rj_smtr.not_null_aux_viagem_circular_sentido.d255c2ea5c", "test.rj_smtr.not_null_aux_viagem_circular_sentido_shape.ca74a5e3f0", "test.rj_smtr.not_null_aux_viagem_circular_servico_informado.e43d2419a6", "test.rj_smtr.not_null_aux_viagem_circular_shape_id.d4509226b0", "test.rj_smtr.not_null_aux_viagem_circular_versao_modelo.5c199c2365", "test.rj_smtr.unique_aux_viagem_circular_id_viagem.1ee2d25705"], "model.rj_smtr.subsidio_quadro_horario": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.subsidio_shapes_geom": ["model.rj_smtr.viagem_planejada"], "model.rj_smtr.subsidio_trips_desaninhada": ["model.rj_smtr.subsidio_data_versao_efetiva", "model.rj_smtr.viagem_planejada"], "model.rj_smtr.staging_ordem_pagamento_consorcio": ["model.rj_smtr.ordem_pagamento_consorcio_dia"], "model.rj_smtr.staging_cliente": ["model.rj_smtr.operadoras", "model.rj_smtr.operadoras_contato"], "model.rj_smtr.staging_transacao_riocard": ["model.rj_smtr.transacao_riocard"], "model.rj_smtr.staging_consorcio": ["model.rj_smtr.consorcios"], "model.rj_smtr.aux_passageiros_hora": ["model.rj_smtr.passageiros_hora", "model.rj_smtr.passageiros_tile_hora"], "model.rj_smtr.gratuidade_aux": ["model.rj_smtr.transacao"], "model.rj_smtr.staging_linha_consorcio_operadora_transporte": ["model.rj_smtr.servico_operadora"], "model.rj_smtr.staging_servico_motorista": ["model.rj_smtr.aux_transacao_ordem"], "model.rj_smtr.staging_ordem_pagamento": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_dia"], "model.rj_smtr.staging_percentual_rateio_integracao": ["model.rj_smtr.matriz_integracao"], "model.rj_smtr.staging_transacao": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.transacao"], "model.rj_smtr.staging_gps_validador": ["model.rj_smtr.gps_validador_aux"], "model.rj_smtr.staging_linha_sem_ressarcimento": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.integracao", "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida", "model.rj_smtr.transacao"], "model.rj_smtr.staging_endereco": [], "model.rj_smtr.staging_linha_consorcio": ["model.rj_smtr.transacao_riocard"], "model.rj_smtr.staging_ordem_ressarcimento": ["model.rj_smtr.ordem_pagamento_servico_operador_dia"], "model.rj_smtr.staging_linha": ["model.rj_smtr.gps_validador_aux", "model.rj_smtr.integracao", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.servicos", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.staging_conta_bancaria": ["model.rj_smtr.operadoras"], "model.rj_smtr.gps_validador_aux": ["model.rj_smtr.gps_validador", "model.rj_smtr.gps_validador_van"], "model.rj_smtr.staging_integracao_transacao": ["model.rj_smtr.integracao", "model.rj_smtr.transacao"], "model.rj_smtr.aux_h3_res9": ["model.rj_smtr.passageiros_tile_hora"], "model.rj_smtr.staging_ordem_rateio": ["model.rj_smtr.ordem_pagamento_servico_operador_dia"], "model.rj_smtr.staging_operadora_transporte": ["model.rj_smtr.operadoras", "model.rj_smtr.operadoras_contato"], "model.rj_smtr.staging_gratuidade": ["model.rj_smtr.gratuidade_aux"], "model.rj_smtr.staging_contato_pessoa_juridica": ["model.rj_smtr.operadoras_contato"], "model.rj_smtr.staging_ordem_pagamento_consorcio_operadora": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia"], "model.rj_smtr.ordem_servico_faixa_horaria": ["model.rj_smtr.ordem_servico_trips_shapes_gtfs"], "model.rj_smtr.gps_sppo_15_minutos": [], "model.rj_smtr.gps_sppo": ["model.rj_smtr.aux_registros_status_trajeto", "model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.veiculo_indicadores_dia"], "model.rj_smtr.gps_brt_15_minutos": [], "model.rj_smtr.gps_brt": [], "model.rj_smtr.sumario_servico_dia_pagamento": [], "model.rj_smtr.sumario_faixa_servico_dia": [], "model.rj_smtr.brt_aux_registros_flag_trajeto_correto": ["model.rj_smtr.gps_brt", "model.rj_smtr.gps_brt_15_minutos"], "model.rj_smtr.brt_registros_desaninhada": ["model.rj_smtr.brt_aux_registros_filtrada"], "model.rj_smtr.brt_aux_registros_parada": ["model.rj_smtr.gps_brt", "model.rj_smtr.gps_brt_15_minutos"], "model.rj_smtr.brt_registros": ["model.rj_smtr.brt_registros_desaninhada"], "model.rj_smtr.brt_aux_registros_velocidade": ["model.rj_smtr.gps_brt", "model.rj_smtr.gps_brt_15_minutos"], "model.rj_smtr.brt_aux_registros_filtrada": ["model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "model.rj_smtr.brt_aux_registros_parada", "model.rj_smtr.brt_aux_registros_velocidade", "model.rj_smtr.gps_brt", "model.rj_smtr.gps_brt_15_minutos"], "model.rj_smtr.viagem_transacao": ["model.rj_smtr.subsidio_faixa_servico_dia", "model.rj_smtr.sumario_servico_dia_tipo", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.gps_agregado_vlt": [], "model.rj_smtr.gps_agregado_brt": [], "model.rj_smtr.gps_agregado_onibus": [], "model.rj_smtr.gps_agregado_van": [], "model.rj_smtr.sppo_aux_registros_parada_zirix": ["model.rj_smtr.gps_sppo_zirix"], "model.rj_smtr.sppo_aux_registros_realocacao_zirix": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix"], "model.rj_smtr.sppo_registros_zirix": ["model.rj_smtr.sppo_aux_registros_filtrada_zirix", "model.rj_smtr.sppo_aux_registros_realocacao_zirix"], "model.rj_smtr.sppo_realocacao_zirix": ["model.rj_smtr.sppo_aux_registros_realocacao_zirix"], "model.rj_smtr.sppo_aux_registros_filtrada_zirix": ["model.rj_smtr.gps_sppo_zirix", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix", "model.rj_smtr.sppo_aux_registros_parada_zirix", "model.rj_smtr.sppo_aux_registros_velocidade_zirix"], "model.rj_smtr.sppo_aux_registros_velocidade_zirix": ["model.rj_smtr.gps_sppo_zirix"], "model.rj_smtr.gps_sppo_zirix": [], "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix": ["model.rj_smtr.gps_sppo_zirix"], "model.rj_smtr.viagem_informada": [], "model.rj_smtr.staging_viagem_informada": ["model.rj_smtr.viagem_informada"], "model.rj_smtr.recursos_sppo_bloqueio_via": [], "model.rj_smtr.recursos_sppo_servico_dia_avaliacao": [], "model.rj_smtr.recursos_sppo_servico_dia_pago": ["model.rj_smtr.aux_balanco_rdo_servico_dia", "model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.recursos_sppo_viagens_individuais": [], "model.rj_smtr.recursos_sppo_reprocessamento": [], "model.rj_smtr.integracao_nao_realizada": [], "model.rj_smtr.integracao_invalida": [], "model.rj_smtr.ordem_pagamento_invalida": [], "model.rj_smtr.transacao_invalida": ["model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida"], "model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida", "model.rj_smtr.ordem_pagamento_invalida"], "model.rj_smtr.aux_transacao_ordem": ["model.rj_smtr.ordem_pagamento_servico_operador_dia_invalida"], "model.rj_smtr.ordem_pagamento_dia_invalida": ["model.rj_smtr.ordem_pagamento_invalida"], "model.rj_smtr.ordem_pagamento_consorcio_operador_dia_invalida": ["model.rj_smtr.ordem_pagamento_consorcio_dia_invalida", "model.rj_smtr.ordem_pagamento_invalida"], "model.rj_smtr.ordem_pagamento_consorcio_dia_invalida": ["model.rj_smtr.ordem_pagamento_invalida"], "model.rj_smtr.sppo_registro_agente_verao": ["model.rj_smtr.sppo_veiculo_dia"], "model.rj_smtr.sppo_infracao": ["model.rj_smtr.sppo_veiculo_dia"], "model.rj_smtr.sppo_licenciamento": ["model.rj_smtr.idade_media_frota_operante_onibus", "model.rj_smtr.sppo_veiculo_dia", "model.rj_smtr.veiculo_indicadores_dia"], "model.rj_smtr.sppo_veiculo_dia": ["model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.sumario_servico_tipo_viagem_dia", "model.rj_smtr.viagem_transacao"], "model.rj_smtr.sppo_licenciamento_solicitacao": [], "model.rj_smtr.sppo_registro_agente_verao_staging": ["model.rj_smtr.sppo_registro_agente_verao"], "model.rj_smtr.sppo_licenciamento_stu_staging": ["model.rj_smtr.sppo_licenciamento", "model.rj_smtr.sppo_veiculo_dia"], "model.rj_smtr.sppo_infracao_staging": ["model.rj_smtr.sppo_infracao"], "model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada": ["model.rj_smtr.sppo_licenciamento"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging": ["model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging": ["model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada"], "model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging": ["model.rj_smtr.aux_sppo_licenciamento_vistoria_atualizada"], "model.rj_smtr.sppo_licenciamento_solicitacao_staging": ["model.rj_smtr.sppo_licenciamento_solicitacao"], "model.rj_smtr.subsidio_valor_km_tipo_viagem": ["model.rj_smtr.subsidio_sumario_servico_dia_pagamento", "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa": [], "model.rj_smtr.sumario_servico_dia": ["model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.sumario_servico_dia_tipo"], "model.rj_smtr.valor_tipo_penalidade": ["model.rj_smtr.subsidio_penalidade_servico_dia", "model.rj_smtr.sumario_servico_dia"], "model.rj_smtr.sumario_servico_dia_tipo": ["model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.sumario_servico_dia_tipo_sem_glosa"], "model.rj_smtr.subsidio_parametros": ["model.rj_smtr.sppo_veiculo_dia"], "model.rj_smtr.sumario_servico_tipo_viagem_dia": [], "model.rj_smtr.sumario_servico_dia_historico": ["model.rj_smtr.aux_balanco_rdo_servico_dia", "model.rj_smtr.balanco_servico_dia", "model.rj_smtr.sumario_servico_tipo_viagem_dia"], "model.rj_smtr.viagens_remuneradas": ["model.rj_smtr.balanco_servico_dia", "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.sumario_servico_dia"], "model.rj_smtr.viagens_realizadas": [], "model.rj_smtr.sumario_dia": ["model.rj_smtr.sumario_servico_dia_historico"], "model.rj_smtr.pagamento_bilhetagem_jae": [], "model.rj_smtr.aux_retorno_ordem_pagamento": ["model.rj_smtr.ordem_pagamento_consorcio_operador_dia"], "model.rj_smtr.staging_arquivo_retorno": ["model.rj_smtr.aux_retorno_ordem_pagamento", "model.rj_smtr.pagamento_bilhetagem_jae"], "model.rj_smtr.rdo40_registros": ["model.rj_smtr.aux_balanco_rdo_servico_dia", "model.rj_smtr.balanco_servico_dia"], "model.rj_smtr.rho_registros_sppo": [], "model.rj_smtr.rho_registros_stpl": [], "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto": ["model.rj_smtr.gps_sppo", "model.rj_smtr.gps_sppo_15_minutos"], "model.rj_smtr.sppo_aux_registros_realocacao": ["model.rj_smtr.sppo_aux_registros_filtrada"], "model.rj_smtr.sppo_aux_registros_velocidade": ["model.rj_smtr.gps_sppo", "model.rj_smtr.gps_sppo_15_minutos"], "model.rj_smtr.sppo_aux_registros_parada": ["model.rj_smtr.gps_sppo", "model.rj_smtr.gps_sppo_15_minutos"], "model.rj_smtr.sppo_realocacao": ["model.rj_smtr.sppo_aux_registros_realocacao"], "model.rj_smtr.sppo_registros": ["model.rj_smtr.sppo_aux_registros_filtrada", "model.rj_smtr.sppo_aux_registros_realocacao"], "model.rj_smtr.sppo_aux_registros_filtrada": ["model.rj_smtr.gps_sppo", "model.rj_smtr.gps_sppo_15_minutos", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "model.rj_smtr.sppo_aux_registros_parada", "model.rj_smtr.sppo_aux_registros_velocidade"], "model.rj_smtr.indicadores_mes": ["model.rj_smtr.indicadores_mes_pivot"], "model.rj_smtr.indicadores_mes_pivot": [], "model.rj_smtr.passageiro_pagante": ["model.rj_smtr.indicadores_mes"], "model.rj_smtr.passageiro_gratuidade": ["model.rj_smtr.indicadores_mes"], "model.rj_smtr.frota_operante": ["model.rj_smtr.indicadores_mes"], "model.rj_smtr.idade_media_frota_operante_onibus": ["model.rj_smtr.indicadores_mes"], "model.rj_smtr.stop_times": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.stop_times_desaninhada"], "model.rj_smtr.stop_details": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.stop_details_desaninhada"], "model.rj_smtr.stop_details_desaninhada": [], "model.rj_smtr.routes": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.routes_desaninhada"], "model.rj_smtr.shapes": ["model.rj_smtr.shapes_geom"], "model.rj_smtr.holidays": ["model.rj_smtr.data_versao_efetiva"], "model.rj_smtr.stops_desaninhada": [], "model.rj_smtr.agg_stops_vistoriadas": [], "model.rj_smtr.frota_determinada": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.frota_determinada_desaninhada"], "model.rj_smtr.frota_determinada_desaninhada": [], "model.rj_smtr.trips_desaninhada": ["model.rj_smtr.shapes_geom", "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b", "test.rj_smtr.not_null_trips_desaninhada_trip_id__data_versao.bc1b38cd1a", "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d", "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe", "test.rj_smtr.unique_key_trips_desaninhada_trip_id____data_versao.42406b5b36"], "model.rj_smtr.shapes_geom": ["model.rj_smtr.brt_aux_registros_flag_trajeto_correto", "model.rj_smtr.data_versao_efetiva", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto", "model.rj_smtr.sppo_aux_registros_flag_trajeto_correto_zirix", "test.rj_smtr.not_null_shapes_geom_shape_id__data_versao.7a66dc45a2", "test.rj_smtr.not_null_shapes_geom_trip_id__data_versao.80cc520fd9", "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d", "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe", "test.rj_smtr.unique_key_shapes_geom_trip_id____data_versao.a58fed7dbf"], "model.rj_smtr.agency_desaninhada": [], "model.rj_smtr.linhas": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.linhas_desaninhada"], "model.rj_smtr.agency": ["model.rj_smtr.agency_desaninhada", "model.rj_smtr.data_versao_efetiva"], "model.rj_smtr.data_versao_efetiva": [], "model.rj_smtr.calendar": ["model.rj_smtr.calendar_desaninhada", "model.rj_smtr.data_versao_efetiva"], "model.rj_smtr.calendar_desaninhada": [], "model.rj_smtr.linhas_desaninhada": [], "model.rj_smtr.routes_desaninhada": ["model.rj_smtr.shapes_geom", "model.rj_smtr.trips_desaninhada", "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b", "test.rj_smtr.not_null_routes_desaninhada_route_id__data_versao.dd77dca831", "test.rj_smtr.unique_key_routes_desaninhada_route_id____data_versao.c670eae320"], "model.rj_smtr.stop_times_desaninhada": [], "model.rj_smtr.stops": ["model.rj_smtr.agg_stops_vistoriadas", "model.rj_smtr.data_versao_efetiva", "model.rj_smtr.stops_desaninhada"], "model.rj_smtr.trips": ["model.rj_smtr.data_versao_efetiva", "model.rj_smtr.trips_desaninhada"], "model.rj_smtr.subsidio_penalidade_servico_dia": ["model.rj_smtr.subsidio_sumario_servico_dia_pagamento"], "model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem": ["model.rj_smtr.subsidio_sumario_servico_dia_pagamento", "model.rj_smtr.sumario_faixa_servico_dia", "model.rj_smtr.sumario_servico_dia_pagamento"], "model.rj_smtr.subsidio_sumario_servico_dia_pagamento": ["model.rj_smtr.sumario_servico_dia_pagamento"], "model.rj_smtr.subsidio_faixa_servico_dia": ["model.rj_smtr.subsidio_faixa_servico_dia_tipo_viagem", "model.rj_smtr.subsidio_penalidade_servico_dia", "model.rj_smtr.subsidio_sumario_servico_dia_pagamento", "model.rj_smtr.sumario_faixa_servico_dia", "model.rj_smtr.sumario_servico_dia_pagamento"], "model.rj_smtr.routes_gtfs": ["model.rj_smtr.aux_routes_vigencia_gtfs"], "model.rj_smtr.ordem_servico_trips_shapes_gtfs": [], "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs": ["model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "model.rj_smtr.trips_filtrada_aux_gtfs"], "model.rj_smtr.fare_rules_gtfs": [], "model.rj_smtr.trips_gtfs": ["model.rj_smtr.servicos_sentido", "model.rj_smtr.trips_filtrada_aux_gtfs"], "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs": ["model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_trips_shapes_gtfs"], "model.rj_smtr.shapes_gtfs": ["model.rj_smtr.shapes_geom_gtfs"], "model.rj_smtr.calendar_gtfs": [], "model.rj_smtr.stop_times_gtfs": [], "model.rj_smtr.fare_attributes_gtfs": [], "model.rj_smtr.trips_filtrada_aux_gtfs": ["model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_trips_shapes_gtfs"], "model.rj_smtr.feed_info_gtfs": ["model.rj_smtr.agency_gtfs", "model.rj_smtr.calendar_dates_gtfs", "model.rj_smtr.calendar_gtfs", "model.rj_smtr.fare_attributes_gtfs", "model.rj_smtr.fare_rules_gtfs", "model.rj_smtr.frequencies_gtfs", "model.rj_smtr.ordem_servico_faixa_horaria", "model.rj_smtr.ordem_servico_gtfs", "model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs", "model.rj_smtr.routes_gtfs", "model.rj_smtr.shapes_geom_gtfs", "model.rj_smtr.shapes_gtfs", "model.rj_smtr.stop_times_gtfs", "model.rj_smtr.stops_gtfs", "model.rj_smtr.trips_gtfs"], "model.rj_smtr.frequencies_gtfs": [], "model.rj_smtr.servicos_sentido": ["model.rj_smtr.ordem_servico_diaria"], "model.rj_smtr.ordem_servico_diaria": [], "model.rj_smtr.stops_gtfs": ["model.rj_smtr.aux_stops_vigencia_gtfs"], "model.rj_smtr.ordem_servico_trajeto_alternativo_sentido_atualizado_aux_gtfs": ["model.rj_smtr.ordem_servico_trips_shapes_gtfs"], "model.rj_smtr.agency_gtfs": [], "model.rj_smtr.ordem_servico_gtfs": ["model.rj_smtr.ordem_servico_diaria", "model.rj_smtr.ordem_servico_sentido_atualizado_aux_gtfs", "model.rj_smtr.ordem_servico_viagens_planejadas", "model.rj_smtr.servicos_sentido", "model.rj_smtr.sumario_servico_dia_historico", "model.rj_smtr.viagens_remuneradas"], "model.rj_smtr.calendar_dates_gtfs": [], "model.rj_smtr.ordem_servico_viagens_planejadas": [], "model.rj_smtr.shapes_geom_gtfs": ["model.rj_smtr.ordem_servico_trips_shapes_gtfs", "model.rj_smtr.servicos_sentido", "model.rj_smtr.trips_filtrada_aux_gtfs"], "model.rj_smtr.servico_operadora": ["model.rj_smtr.transacao"], "model.rj_smtr.servicos": ["model.rj_smtr.gps_validador_aux", "model.rj_smtr.integracao", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.servico_operadora", "model.rj_smtr.transacao", "model.rj_smtr.transacao_invalida", "model.rj_smtr.view_integracao", "model.rj_smtr.view_passageiros_hora", "model.rj_smtr.view_passageiros_tile_hora"], "model.rj_smtr.operadoras_contato": ["model.rj_smtr.transacao"], "model.rj_smtr.operadoras": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.gps_validador_aux", "model.rj_smtr.integracao", "model.rj_smtr.operadoras_contato", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.servico_operadora", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.consorcios": ["model.rj_smtr.aux_transacao_ordem", "model.rj_smtr.integracao", "model.rj_smtr.ordem_pagamento_consorcio_dia", "model.rj_smtr.ordem_pagamento_consorcio_operador_dia", "model.rj_smtr.ordem_pagamento_servico_operador_dia", "model.rj_smtr.pagamento_bilhetagem_jae", "model.rj_smtr.passageiro_gratuidade", "model.rj_smtr.passageiro_pagante", "model.rj_smtr.rdo40_registros", "model.rj_smtr.servico_operadora", "model.rj_smtr.transacao", "model.rj_smtr.transacao_riocard"], "model.rj_smtr.aux_servicos_gtfs": ["model.rj_smtr.servicos"], "model.rj_smtr.aux_routes_vigencia_gtfs": ["model.rj_smtr.aux_servicos_gtfs"], "model.rj_smtr.aux_stops_vigencia_gtfs": ["model.rj_smtr.aux_servicos_gtfs"], "test.rj_smtr.unique_my_first_dbt_model_id.16e066b321": [], "test.rj_smtr.not_null_my_first_dbt_model_id.5fb22c2710": [], "test.rj_smtr.unique_my_second_dbt_model_id.57a0f8c493": [], "test.rj_smtr.not_null_my_second_dbt_model_id.151b76d778": [], "test.rj_smtr.not_null_viagem_planejada_consorcio.3058dfe52a": [], "test.rj_smtr.not_null_viagem_planejada_data.908c75b0d4": [], "test.rj_smtr.not_null_viagem_planejada_data_shape.5117fd368b": [], "test.rj_smtr.not_null_viagem_planejada_tipo_dia.a605476b6d": [], "test.rj_smtr.accepted_values_viagem_planejada_tipo_dia__I__V__C.fabfbe2d14": [], "test.rj_smtr.not_null_viagem_planejada_servico.a9fd6c7425": [], "test.rj_smtr.not_null_viagem_planejada_sentido.40310b764f": [], "test.rj_smtr.not_null_viagem_planejada_inicio_periodo.c62783ac90": [], "test.rj_smtr.not_null_viagem_planejada_fim_periodo.b2cf28f8cc": [], "test.rj_smtr.not_null_viagem_planejada_intervalo.1fb7eb9e45": [], "test.rj_smtr.not_null_viagem_planejada_variacao_itinerario.ea024350d5": [], "test.rj_smtr.accepted_values_viagem_planejada_variacao_itinerario__DD__DU__SS__RT__RM__DA__SA.19c1ddab9e": [], "test.rj_smtr.not_null_viagem_planejada_sentido_shape.7b97f6ff04": [], "test.rj_smtr.accepted_values_viagem_planejada_sentido_shape__I__V__C.65301f5e21": [], "test.rj_smtr.not_null_viagem_planejada_shape.5f910173a9": [], "test.rj_smtr.not_null_viagem_planejada_distancia_planejada.74a4f2d184": [], "test.rj_smtr.not_null_viagem_planejada_distancia_total_planejada.fc1b124982": [], "test.rj_smtr.greater_than_zero_viagem_planejada_distancia_total_planejada.d8c80cf89c": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_data.652ad0c445": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_id_veiculo.101e6b5227": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_gps.703590c517": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_timestamp_minuto_gps.d2799a61bf": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_posicao_veiculo_geo.33c0d51e40": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_servico_informado.11333dadfe": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_shape_id.586a1a0d47": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia_planejada.39e1e1d472": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_distancia.703c10aaaf": [], "test.rj_smtr.not_negative_aux_registros_status_trajeto_distancia.b4cb13122d": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_status_viagem.24b7f26346": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_versao_modelo.22de27b835": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido_shape.a14a95f5e8": [], "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido_shape__I__V__C.5b82f18cbf": [], "test.rj_smtr.not_null_aux_registros_status_trajeto_sentido.6291e69d70": [], "test.rj_smtr.accepted_values_aux_registros_status_trajeto_sentido__I__V__C.2082fbe17f": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_data.3ef5737e0d": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_veiculo.c69fdfc708": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_informado.7adb7ebfd7": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_servico_realizado.60bf591717": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_shape_id.9b971af0ae": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido_shape.4c3ec0996b": [], "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido_shape__I__V__C.9af2f7b6e0": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_sentido.976bd6a11f": [], "test.rj_smtr.accepted_values_aux_viagem_inicio_fim_sentido__I__V__C.4f2096c560": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_id_viagem.9cfe2e3fdd": [], "test.rj_smtr.unique_aux_viagem_inicio_fim_id_viagem.321f77f756": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_partida.c668ec6882": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_datetime_chegada.2e883813e8": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_versao_modelo.7bace7cce8": [], "test.rj_smtr.not_null_aux_viagem_inicio_fim_distancia_planejada.a26e748226": [], "test.rj_smtr.not_null_aux_viagem_circular_data.9696b69d2f": [], "test.rj_smtr.not_null_aux_viagem_circular_id_veiculo.f928466090": [], "test.rj_smtr.not_null_aux_viagem_circular_servico_informado.e43d2419a6": [], "test.rj_smtr.not_null_aux_viagem_circular_shape_id.d4509226b0": [], "test.rj_smtr.not_null_aux_viagem_circular_sentido_shape.ca74a5e3f0": [], "test.rj_smtr.accepted_values_aux_viagem_circular_sentido_shape__I__V__C.39a2bf1eea": [], "test.rj_smtr.not_null_aux_viagem_circular_sentido.d255c2ea5c": [], "test.rj_smtr.accepted_values_aux_viagem_circular_sentido__I__V__C.70c058ec81": [], "test.rj_smtr.not_null_aux_viagem_circular_id_viagem.48bb460a25": [], "test.rj_smtr.unique_aux_viagem_circular_id_viagem.1ee2d25705": [], "test.rj_smtr.not_null_aux_viagem_circular_datetime_partida.44f6ea1a28": [], "test.rj_smtr.not_null_aux_viagem_circular_datetime_chegada.129de567e2": [], "test.rj_smtr.not_null_aux_viagem_circular_versao_modelo.5c199c2365": [], "test.rj_smtr.not_null_aux_viagem_circular_distancia_planejada.5baf640cb6": [], "test.rj_smtr.not_null_registros_status_viagem_data.fc562948d5": [], "test.rj_smtr.not_null_registros_status_viagem_id_veiculo.3c008a9ac4": [], "test.rj_smtr.not_null_registros_status_viagem_id_empresa.3108e4aab8": [], "test.rj_smtr.not_null_registros_status_viagem_timestamp_gps.01b64d27a5": [], "test.rj_smtr.not_null_registros_status_viagem_timestamp_minuto_gps.1157bb9203": [], "test.rj_smtr.not_null_registros_status_viagem_posicao_veiculo_geo.78b9ad4651": [], "test.rj_smtr.not_null_registros_status_viagem_servico_informado.dd60d17ad8": [], "test.rj_smtr.not_null_registros_status_viagem_servico_realizado.5376b0386b": [], "test.rj_smtr.not_null_registros_status_viagem_shape_id.1d4aad9d42": [], "test.rj_smtr.not_null_registros_status_viagem_distancia_planejada.97e1779cf0": [], "test.rj_smtr.not_null_registros_status_viagem_distancia.85f4f41092": [], "test.rj_smtr.not_negative_registros_status_viagem_distancia.34c62e5708": [], "test.rj_smtr.not_null_registros_status_viagem_status_viagem.d00cac767b": [], "test.rj_smtr.not_null_registros_status_viagem_sentido_shape.88347d2c2f": [], "test.rj_smtr.accepted_values_registros_status_viagem_sentido_shape__I__V__C.a6ccf195ec": [], "test.rj_smtr.not_null_registros_status_viagem_sentido.85a3d01213": [], "test.rj_smtr.accepted_values_registros_status_viagem_sentido__I__V__C.8b8fa70da7": [], "test.rj_smtr.not_null_registros_status_viagem_id_viagem.b81547c9af": [], "test.rj_smtr.unique_registros_status_viagem_id_viagem.5e7788f7bf": [], "test.rj_smtr.not_null_registros_status_viagem_datetime_partida.15c5410b28": [], "test.rj_smtr.not_null_registros_status_viagem_datetime_chegada.5dbeb5b878": [], "test.rj_smtr.not_null_registros_status_viagem_versao_modelo.86225e08a6": [], "test.rj_smtr.not_null_aux_viagem_registros_id_viagem.a786e08594": [], "test.rj_smtr.unique_aux_viagem_registros_id_viagem.f0eebfdeac": [], "test.rj_smtr.not_null_aux_viagem_registros_distancia_planejada.a779141cf5": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_planejada.ad85bf839a": [], "test.rj_smtr.not_null_aux_viagem_registros_distancia_aferida.af703eccfb": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_distancia_aferida.3f4f58b67a": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_middle.32807232ce": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_middle.6fda2c93f2": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_start.4e1ace515e": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_start.6777af50be": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_end.6be4269aee": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_end.e1ccb9c563": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_out.0e8817c0b4": [], "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_out.16cc121f84": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_total.0a1be4060f": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_total.c812b681b0": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_minuto.157ae1cdaf": [], "test.rj_smtr.greater_than_zero_aux_viagem_registros_n_registros_minuto.82864933b3": [], "test.rj_smtr.not_null_aux_viagem_registros_versao_modelo.4e6a36e817": [], "test.rj_smtr.not_null_aux_viagem_registros_n_registros_shape.e354f14169": [], "test.rj_smtr.not_negative_aux_viagem_registros_n_registros_shape.d8d479f025": [], "test.rj_smtr.not_null_viagem_conformidade_data.dba44f5b88": [], "test.rj_smtr.not_null_viagem_conformidade_id_veiculo.4dc76608fb": [], "test.rj_smtr.not_null_viagem_conformidade_servico_informado.d130583ad1": [], "test.rj_smtr.not_null_viagem_conformidade_servico_realizado.3bd70666f8": [], "test.rj_smtr.not_null_viagem_conformidade_shape_id.2fd4863204": [], "test.rj_smtr.not_null_viagem_conformidade_sentido_shape.e828f58e76": [], "test.rj_smtr.accepted_values_viagem_conformidade_sentido_shape__I__V__C.1c6ae2b41d": [], "test.rj_smtr.not_null_viagem_conformidade_sentido.9ff9017055": [], "test.rj_smtr.accepted_values_viagem_conformidade_sentido__I__V__C.37e4bf801f": [], "test.rj_smtr.not_null_viagem_conformidade_id_viagem.52f7dd7469": [], "test.rj_smtr.unique_viagem_conformidade_id_viagem.5aa802e5bf": [], "test.rj_smtr.not_null_viagem_conformidade_datetime_partida.fd79047671": [], "test.rj_smtr.not_null_viagem_conformidade_datetime_chegada.72c3aa8bba": [], "test.rj_smtr.not_null_viagem_conformidade_tempo_viagem.9d731143cc": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_tempo_viagem.94e16edeba": [], "test.rj_smtr.not_null_viagem_conformidade_distancia_planejada.9a5bf3230e": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_planejada.399d334601": [], "test.rj_smtr.not_null_viagem_conformidade_distancia_aferida.f7b56d4343": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_distancia_aferida.14ac42d258": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_middle.7965304122": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_middle.794c022bd1": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_start.53a2b2e530": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_start.3b4d5df527": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_end.accb64d6bd": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_end.2e79c19e44": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_out.6dac645a68": [], "test.rj_smtr.not_negative_viagem_conformidade_n_registros_out.05ed52b76e": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_shape.567191d3b2": [], "test.rj_smtr.not_negative_viagem_conformidade_n_registros_shape.fa86a62956": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_total.8514b50af0": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_total.845a3f5e81": [], "test.rj_smtr.not_null_viagem_conformidade_n_registros_minuto.a1804e8458": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_n_registros_minuto.44dcb2a328": [], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_shape.c779adcc22": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_shape.672bafc4f5": [], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_distancia.e95ad3d84b": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_distancia.947723cc56": [], "test.rj_smtr.not_null_viagem_conformidade_perc_conformidade_registros.5889951b7b": [], "test.rj_smtr.greater_than_zero_viagem_conformidade_perc_conformidade_registros.078f53372c": [], "test.rj_smtr.not_null_viagem_conformidade_versao_modelo.ddf040eb5f": [], "test.rj_smtr.not_null_viagem_completa_consorcio.ef41dcab9b": [], "test.rj_smtr.not_null_viagem_completa_data.60008eec9c": [], "test.rj_smtr.not_null_viagem_completa_tipo_dia.1718470616": [], "test.rj_smtr.accepted_values_viagem_completa_tipo_dia__Dia_til__Sabado__Domingo.be741d00ee": [], "test.rj_smtr.not_null_viagem_completa_id_veiculo.4b31ddd12f": [], "test.rj_smtr.not_null_viagem_completa_servico_informado.3aa58feb5f": [], "test.rj_smtr.not_null_viagem_completa_servico_realizado.7433281d87": [], "test.rj_smtr.not_null_viagem_completa_vista.ace89b5843": [], "test.rj_smtr.not_null_viagem_completa_trip_id.b9d8d1d6fd": [], "test.rj_smtr.not_null_viagem_completa_shape_id.cfa5f99155": [], "test.rj_smtr.not_null_viagem_completa_sentido.a8ba9e34e6": [], "test.rj_smtr.accepted_values_viagem_completa_sentido__I__V__C.14734d12d7": [], "test.rj_smtr.not_null_viagem_completa_id_viagem.c4481cf0da": [], "test.rj_smtr.unique_viagem_completa_id_viagem.e7a957c7b9": [], "test.rj_smtr.not_null_viagem_completa_datetime_partida.a62e5f9eac": [], "test.rj_smtr.not_null_viagem_completa_datetime_chegada.fac30fe07a": [], "test.rj_smtr.not_null_viagem_completa_tipo_viagem.6bda4a1de6": [], "test.rj_smtr.accepted_values_viagem_completa_tipo_viagem__Completa_linha_correta__Completa_linha_incorreta.d7777aca98": [], "test.rj_smtr.not_null_viagem_completa_tempo_viagem.2d2a673c5b": [], "test.rj_smtr.greater_than_zero_viagem_completa_tempo_viagem.6c4c35eea7": [], "test.rj_smtr.not_null_viagem_completa_distancia_planejada.bbd49d7634": [], "test.rj_smtr.greater_than_zero_viagem_completa_distancia_planejada.a4e65fb078": [], "test.rj_smtr.not_null_viagem_completa_distancia_aferida.0edb9adb33": [], "test.rj_smtr.greater_than_zero_viagem_completa_distancia_aferida.f5d805262a": [], "test.rj_smtr.not_null_viagem_completa_n_registros_shape.9d239e7953": [], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_shape.8fb346344d": [], "test.rj_smtr.not_null_viagem_completa_n_registros_total.4a103f1249": [], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_total.25967100b1": [], "test.rj_smtr.not_null_viagem_completa_n_registros_minuto.4c23c345c5": [], "test.rj_smtr.greater_than_zero_viagem_completa_n_registros_minuto.1fa0ffac2f": [], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_shape.25bb80e526": [], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_shape.1ad412b569": [], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_distancia.837283bcfc": [], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_distancia.7087a86b2d": [], "test.rj_smtr.not_null_viagem_completa_perc_conformidade_registros.0d86da0376": [], "test.rj_smtr.greater_than_zero_viagem_completa_perc_conformidade_registros.8cc9a28202": [], "test.rj_smtr.not_null_viagem_completa_versao_modelo.08474ee6c1": [], "test.rj_smtr.not_null_routes_desaninhada_route_id__data_versao.dd77dca831": [], "test.rj_smtr.unique_key_routes_desaninhada_route_id____data_versao.c670eae320": [], "test.rj_smtr.not_null_trips_desaninhada_trip_id__data_versao.bc1b38cd1a": [], "test.rj_smtr.unique_key_trips_desaninhada_trip_id____data_versao.42406b5b36": [], "test.rj_smtr.one_to_one_trips_desaninhada_trip_id__data_versao__ref_shapes_geom_.7192b80bfe": [], "test.rj_smtr.many_to_one_trips_desaninhada_route_id__route_id__data_versao__ref_routes_desaninhada_.eb4384bb9b": [], "test.rj_smtr.not_null_shapes_geom_shape_id__data_versao.7a66dc45a2": [], "test.rj_smtr.not_null_shapes_geom_trip_id__data_versao.80cc520fd9": [], "test.rj_smtr.unique_key_shapes_geom_trip_id____data_versao.a58fed7dbf": [], "test.rj_smtr.one_to_one_shapes_geom_trip_id__data_versao__ref_trips_desaninhada_.fa13c0400d": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao": ["model.rj_smtr.staging_transacao"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.transacao_riocard": ["model.rj_smtr.staging_transacao_riocard"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha": ["model.rj_smtr.staging_linha"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.dicionario": ["model.rj_smtr.dicionario"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.consorcio": ["model.rj_smtr.staging_consorcio"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.operadora_transporte": ["model.rj_smtr.staging_operadora_transporte"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento": ["model.rj_smtr.staging_ordem_pagamento"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_ressarcimento": ["model.rj_smtr.staging_ordem_ressarcimento"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.conta_bancaria": ["model.rj_smtr.staging_conta_bancaria"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.contato_pessoa_juridica": ["model.rj_smtr.staging_contato_pessoa_juridica"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.cliente": ["model.rj_smtr.staging_cliente"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.percentual_rateio_integracao": ["model.rj_smtr.staging_percentual_rateio_integracao"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.integracao_transacao": ["model.rj_smtr.staging_integracao_transacao"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.tipo_modal": [], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gps_validador": ["model.rj_smtr.staging_gps_validador"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.gratuidade": ["model.rj_smtr.staging_gratuidade"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_rateio": ["model.rj_smtr.staging_ordem_rateio"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.servico_motorista": ["model.rj_smtr.staging_servico_motorista"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_sem_ressarcimento": ["model.rj_smtr.staging_linha_sem_ressarcimento"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio_operadora": ["model.rj_smtr.staging_ordem_pagamento_consorcio_operadora"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.ordem_pagamento_consorcio": ["model.rj_smtr.staging_ordem_pagamento_consorcio"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio": ["model.rj_smtr.staging_linha_consorcio"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.linha_consorcio_operadora_transporte": ["model.rj_smtr.staging_linha_consorcio_operadora_transporte"], "source.rj_smtr.br_rj_riodejaneiro_bilhetagem_staging.endereco": ["model.rj_smtr.staging_endereco"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.agency": ["model.rj_smtr.agency_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar": ["model.rj_smtr.calendar_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.calendar_dates": ["model.rj_smtr.calendar_dates_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_attributes": ["model.rj_smtr.fare_attributes_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.fare_rules": ["model.rj_smtr.fare_rules_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.feed_info": ["model.rj_smtr.feed_info_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.frequencies": ["model.rj_smtr.frequencies_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.routes": ["model.rj_smtr.routes_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.shapes": ["model.rj_smtr.shapes_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stops": ["model.rj_smtr.stops_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.stop_times": ["model.rj_smtr.stop_times_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.trips": ["model.rj_smtr.trips_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico": ["model.rj_smtr.ordem_servico_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_trajeto_alternativo": ["model.rj_smtr.ordem_servico_trajeto_alternativo_gtfs"], "source.rj_smtr.br_rj_riodejaneiro_gtfs_staging.ordem_servico_faixa_horaria": ["model.rj_smtr.ordem_servico_faixa_horaria"], "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_empresa": ["model.rj_smtr.staging_operadora_empresa"], "source.rj_smtr.br_rj_riodejaneiro_stu_staging.operadora_pessoa_fisica": ["model.rj_smtr.staging_operadora_pessoa_fisica"], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_viagens_individuais": ["model.rj_smtr.staging_recursos_sppo_viagens_individuais"], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_bloqueio_via": ["model.rj_smtr.staging_recursos_sppo_bloqueio_via"], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_reprocessamento": ["model.rj_smtr.staging_recursos_sppo_reprocessamento"], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_avaliacao": ["model.rj_smtr.recursos_sppo_servico_dia_avaliacao"], "source.rj_smtr.br_rj_riodejaneiro_recursos_staging.recursos_sppo_servico_dia_pago": ["model.rj_smtr.recursos_sppo_servico_dia_pago"], "source.rj_smtr.cadastro.modos": ["model.rj_smtr.consorcios", "model.rj_smtr.integracao", "model.rj_smtr.matriz_integracao", "model.rj_smtr.operadoras", "model.rj_smtr.transacao"], "source.rj_smtr.cadastro_staging.consorcio_modo": ["model.rj_smtr.consorcios"], "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho_registros_sppo": ["model.rj_smtr.staging_rho_registros_sppo"], "source.rj_smtr.br_rj_riodejaneiro_rdo_staging.rho5_registros_stpl": ["model.rj_smtr.staging_rho_registros_stpl"], "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_tratado": ["model.rj_smtr.passageiro_gratuidade", "model.rj_smtr.passageiro_pagante", "model.rj_smtr.rdo40_registros"], "source.rj_smtr.br_rj_riodejaneiro_rdo.rdo40_registros_sppo": [], "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.parametros_km": ["model.rj_smtr.balanco_servico_dia"], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2023": ["model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2023_staging"], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_2024": ["model.rj_smtr.sppo_vistoria_tr_subtt_cglf_2024_staging"], "source.rj_smtr.veiculo_staging.sppo_vistoria_tr_subtt_cglf_pendentes_2024": ["model.rj_smtr.sppo_vistoria_tr_subtt_cglf_pendentes_2024_staging"], "source.rj_smtr.veiculo_staging.sppo_registro_agente_verao": ["model.rj_smtr.sppo_registro_agente_verao_staging"], "source.rj_smtr.veiculo_staging.sppo_infracao": ["model.rj_smtr.sppo_infracao_staging"], "source.rj_smtr.veiculo_staging.sppo_licenciamento_solicitacao": ["model.rj_smtr.sppo_licenciamento_solicitacao_staging"], "source.rj_smtr.veiculo_staging.sppo_licenciamento": [], "source.rj_smtr.veiculo_staging.sppo_licenciamento_stu": ["model.rj_smtr.sppo_licenciamento_stu_staging"], "source.rj_smtr.dashboard_subsidio_sppo_staging.subsidio_valor_km_tipo_viagem": ["model.rj_smtr.subsidio_valor_km_tipo_viagem"], "source.rj_smtr.dashboard_controle_vinculo_jae_riocard_staging.relatorio_instalacao_jae": ["model.rj_smtr.veiculo_indicadores_dia"], "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.registros": ["model.rj_smtr.sppo_registros_zirix"], "source.rj_smtr.br_rj_riodejaneiro_onibus_gps_zirix_staging.realocacao": ["model.rj_smtr.sppo_realocacao_zirix"], "source.rj_smtr.controle_financeiro_staging.cb": [], "source.rj_smtr.controle_financeiro_staging.cett": [], "source.rj_smtr.controle_financeiro_staging.arquivo_retorno": ["model.rj_smtr.staging_arquivo_retorno"], "source.rj_smtr.projeto_subsidio_sppo_encontro_contas.rdo_correcao_rioonibus_servico_quinzena": [], "source.rj_smtr.br_rj_riodejaneiro_geo.h3_res9": ["model.rj_smtr.aux_h3_res9"], "source.rj_smtr.br_rj_riodejaneiro_viagem_zirix_staging.viagem_informada": ["model.rj_smtr.staging_viagem_informada"], "source.rj_smtr.infracao_staging.autuacoes_citran": ["model.rj_smtr.autuacao_citran"], "source.rj_smtr.infracao_staging.receita_autuacao": ["model.rj_smtr.receita_autuacao"]}, "group_map": {}, "saved_queries": {}, "semantic_models": {}}